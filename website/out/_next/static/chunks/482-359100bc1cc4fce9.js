(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[482],{5815:function(e,t){"use strict";var r=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))};function n(e){return e&&0===e.length}function i(e){return void 0===e||null===e?[]:Object.keys(e)}function o(e){for(var t=[],r=Object.keys(e),n=0;n<r.length;n++)t.push(e[r[n]]);return t}function a(e,t){for(var r=[],n=i(e),o=0;o<n.length;o++){var a=n[o];r.push(t.call(null,e[a],a))}return r}function s(e,t){for(var r=[],n=0;n<e.length;n++)r.push(t.call(null,e[n],n));return r}function l(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];Array.isArray(n)?t=t.concat(l(n)):t.push(n)}return t}function c(e){return n(e)?void 0:e[0]}function u(e){var t=e&&e.length;return t?e[t-1]:void 0}function h(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t.call(null,e[r],r);else{if(!P(e))throw Error("non exhaustive match");var n=i(e);for(r=0;r<n.length;r++){var o=n[r],a=e[o];t.call(null,a,o)}}}function d(e){return"string"===typeof e}function f(e){return void 0===e}function p(e){return e instanceof Function}function m(e,t){return void 0===t&&(t=1),e.slice(t,e.length)}function g(e,t){return void 0===t&&(t=1),e.slice(0,e.length-t)}function A(e,t){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r}function v(e,t){return A(e,(function(e){return!t(e)}))}function y(e,t){for(var r=Object.keys(e),n={},i=0;i<r.length;i++){var o=r[i],a=e[o];t(a)&&(n[o]=a)}return n}function x(e,t){return!!P(e)&&e.hasOwnProperty(t)}function b(e,t){return void 0!==E(e,(function(e){return e===t}))}function w(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}function C(e){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}function E(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(t.call(null,n))return n}}function S(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r}function T(e,t,r){for(var n=Array.isArray(e),a=n?e:o(e),s=n?[]:i(e),l=r,c=0;c<a.length;c++)l=t.call(null,l,a[c],n?c:s[c]);return l}function M(e){return v(e,(function(e){return null===e||void 0===e}))}function I(e,t){void 0===t&&(t=function(e){return e});var r=[];return T(e,(function(e,n){var i=t(n);return b(r,i)?e:(r.push(i),e.concat(n))}),[])}function B(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=[null],i=n.concat(t);return Function.bind.apply(e,i)}function _(e){return Array.isArray(e)}function F(e){return e instanceof RegExp}function P(e){return e instanceof Object}function R(e,t){for(var r=0;r<e.length;r++)if(!t(e[r],r))return!1;return!0}function L(e,t){return v(e,(function(e){return b(t,e)}))}function D(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return!0;return!1}function N(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1}function k(e,t){var r=w(e);return r.sort((function(e,r){return t(e)-t(r)})),r}function O(e,t){if(e.length!==t.length)throw Error("can't zipObject with different number of keys and values!");for(var r={},n=0;n<e.length;n++)r[e[n]]=t[n];return r}function U(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++)for(var o=t[n],a=i(o),s=0;s<a.length;s++){var l=a[s];e[l]=o[l]}return e}function Q(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++)for(var o=t[n],a=i(o),s=0;s<a.length;s++){var l=a[s];x(e,l)||(e[l]=o[l])}return e}function V(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Q.apply(void 0,r([{}],e,!1))}function G(e,t){var r={};return h(e,(function(e){var n=t(e),i=r[n];i?i.push(e):r[n]=[e]})),r}function z(e,t){for(var r=C(e),n=i(t),o=0;o<n.length;o++){var a=n[o],s=t[a];r[a]=s}return r}function j(){}function H(e){return e}function W(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push(void 0!==n?n:void 0)}return t}function Z(e){console&&console.error&&console.error("Error: "+e)}function X(e){console&&console.warn&&console.warn("Warning: "+e)}function Y(){return"function"===typeof Map}function J(e){return e[e.length-1]}function q(e){var t=(new Date).getTime(),r=e();return{time:(new Date).getTime()-t,value:r}}function K(e){function t(){}t.prototype=e;var r=new t;function n(){return typeof r.bar}return n(),n(),e}function $(e){if(!e)return e;var t=te(e,0);return t.toUpperCase()+e.substring(t.length)}Object.defineProperty(t,"__esModule",{value:!0}),t.toFastProperties=t.timer=t.peek=t.isES2015MapSupported=t.PRINT_WARNING=t.PRINT_ERROR=t.packArray=t.IDENTITY=t.NOOP=t.merge=t.groupBy=t.defaults=t.assignNoOverwrite=t.assign=t.zipObject=t.sortBy=t.indexOf=t.some=t.difference=t.every=t.isObject=t.isRegExp=t.isArray=t.partial=t.uniq=t.compact=t.reduce=t.findAll=t.find=t.cloneObj=t.cloneArr=t.contains=t.has=t.pick=t.reject=t.filter=t.dropRight=t.drop=t.isFunction=t.isUndefined=t.isString=t.forEach=t.last=t.first=t.flatten=t.map=t.mapValues=t.values=t.keys=t.isEmpty=void 0,t.upperFirst=void 0,t.isEmpty=n,t.keys=i,t.values=o,t.mapValues=a,t.map=s,t.flatten=l,t.first=c,t.last=u,t.forEach=h,t.isString=d,t.isUndefined=f,t.isFunction=p,t.drop=m,t.dropRight=g,t.filter=A,t.reject=v,t.pick=y,t.has=x,t.contains=b,t.cloneArr=w,t.cloneObj=C,t.find=E,t.findAll=S,t.reduce=T,t.compact=M,t.uniq=I,t.partial=B,t.isArray=_,t.isRegExp=F,t.isObject=P,t.every=R,t.difference=L,t.some=D,t.indexOf=N,t.sortBy=k,t.zipObject=O,t.assign=U,t.assignNoOverwrite=Q,t.defaults=V,t.groupBy=G,t.merge=z,t.NOOP=j,t.IDENTITY=H,t.packArray=W,t.PRINT_ERROR=Z,t.PRINT_WARNING=X,t.isES2015MapSupported=Y,t.peek=J,t.timer=q,t.toFastProperties=K,t.upperFirst=$;var ee=/[\uD800-\uDBFF][\uDC00-\uDFFF]/;function te(e,t){var r=e.substring(t,t+1);return ee.test(r)?r:e[t]}},7548:function(e,t,r){"use strict";r.d(t,{eC:function(){return h},iG:function(){return u},Ld:function(){return b},ys:function(){return a},sb:function(){return g},He:function(){return l},f3:function(){return s}});var n=r(8777),i=r(7378);const o=Symbol.for("Animated:node"),a=e=>e&&e[o],s=(e,t)=>(0,n.dE)(e,o,t),l=e=>e&&e[o]&&e[o].getPayload();class c{constructor(){this.payload=void 0,s(this,this)}getPayload(){return this.payload||[]}}class u extends c{constructor(e){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=e,n.is.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new u(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return n.is.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,n.is.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}class h extends u{constructor(e){super(0),this._string=null,this._toString=void 0,this._toString=(0,n.mD)({output:[e,e]})}static create(e){return new h(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(n.is.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=(0,n.mD)({output:[this.getValue(),e]})),this._value=0,super.reset()}}const d={dependencies:null};class f extends c{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return(0,n.rU)(this.source,((r,i)=>{var a;(a=r)&&a[o]===a?t[i]=r.getValue(e):(0,n.j$)(r)?t[i]=(0,n.je)(r):e||(t[i]=r)})),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&(0,n.S6)(this.payload,(e=>e.reset()))}_makePayload(e){if(e){const t=new Set;return(0,n.rU)(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){d.dependencies&&(0,n.j$)(e)&&d.dependencies.add(e);const t=l(e);t&&(0,n.S6)(t,(e=>this.add(e)))}}class p extends f{constructor(e){super(e)}static create(e){return new p(e)}getValue(){return this.source.map((e=>e.getValue()))}setValue(e){const t=this.getPayload();return e.length==t.length?t.map(((t,r)=>t.setValue(e[r]))).some(Boolean):(super.setValue(e.map(m)),!0)}}function m(e){return((0,n.Df)(e)?h:u).create(e)}function g(e){const t=a(e);return t?t.constructor:n.is.arr(e)?p:(0,n.Df)(e)?h:u}function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}const v=(e,t)=>{const r=!n.is.fun(e)||e.prototype&&e.prototype.isReactComponent;return(0,i.forwardRef)(((o,a)=>{const s=(0,i.useRef)(null),l=r&&(0,i.useCallback)((e=>{s.current=function(e,t){e&&(n.is.fun(e)?e(t):e.current=t);return t}(a,e)}),[a]),[c,u]=function(e,t){const r=new Set;d.dependencies=r,e.style&&(e=A({},e,{style:t.createAnimatedStyle(e.style)}));return e=new f(e),d.dependencies=null,[e,r]}(o,t),h=(0,n.NW)(),p=()=>{const e=s.current;if(r&&!e)return;!1===(!!e&&t.applyAnimatedValues(e,c.getValue(!0)))&&h()},m=new y(p,u),g=(0,i.useRef)();(0,n.bt)((()=>{const e=g.current;g.current=m,(0,n.S6)(u,(e=>(0,n.UI)(e,m))),e&&((0,n.S6)(e.deps,(t=>(0,n.iL)(t,e))),n.Wn.cancel(e.update))})),(0,i.useEffect)(p,[]),(0,n.tf)((()=>()=>{const e=g.current;(0,n.S6)(e.deps,(t=>(0,n.iL)(t,e)))}));const v=t.getComponentProps(c.getValue());return i.createElement(e,A({},v,{ref:l}))}))};class y{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&n.Wn.write(this.update)}}const x=Symbol.for("AnimatedComponent"),b=(e,{applyAnimatedValues:t=(()=>!1),createAnimatedStyle:r=(e=>new f(e)),getComponentProps:i=(e=>e)}={})=>{const o={applyAnimatedValues:t,createAnimatedStyle:r,getComponentProps:i},a=e=>{const t=w(e)||"Anonymous";return(e=n.is.str(e)?a[e]||(a[e]=v(e,o)):e[x]||(e[x]=v(e,o))).displayName=`Animated(${t})`,e};return(0,n.rU)(e,((t,r)=>{n.is.arr(e)&&(r=w(t)),a[r]=a(t)})),{animated:a}},w=e=>n.is.str(e)?e:e&&n.is.str(e.displayName)?e.displayName:n.is.fun(e)&&e.name||null},2351:function(e,t,r){"use strict";r.r(t),r.d(t,{Globals:function(){return n.OH},createInterpolator:function(){return n.mD},BailSignal:function(){return W},Controller:function(){return pe},FrameValue:function(){return J},Interpolation:function(){return je},Spring:function(){return Ue},SpringContext:function(){return Ee},SpringRef:function(){return Ie},SpringValue:function(){return ne},Trail:function(){return Ve},Transition:function(){return ze},config:function(){return T},easings:function(){return R},inferTo:function(){return y},interpolate:function(){return Ye},to:function(){return Xe},update:function(){return Je},useChain:function(){return S},useSpring:function(){return _e},useSpringRef:function(){return Pe},useSprings:function(){return Be},useTrail:function(){return Re},useTransition:function(){return De}});var n=r(8777),i=r(7378),o=r(7548),a=r(2673),s={};for(var l in a)["default","Globals","createInterpolator","BailSignal","Controller","FrameValue","Interpolation","Spring","SpringContext","SpringRef","SpringValue","Trail","Transition","config","easings","inferTo","interpolate","to","update","useChain","useSpring","useSpringRef","useSprings","useTrail","useTransition"].indexOf(l)<0&&(s[l]=function(e){return a[e]}.bind(0,l));r.d(t,s);var c=r(5752);s={};for(var l in c)["default","Globals","createInterpolator","BailSignal","Controller","FrameValue","Interpolation","Spring","SpringContext","SpringRef","SpringValue","Trail","Transition","config","easings","inferTo","interpolate","to","update","useChain","useSpring","useSpringRef","useSprings","useTrail","useTransition"].indexOf(l)<0&&(s[l]=function(e){return c[e]}.bind(0,l));function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function h(e,...t){return n.is.fun(e)?e(...t):e}r.d(t,s);const d=(e,t)=>!0===e||!!(t&&e&&(n.is.fun(e)?e(t):(0,n.qo)(e).includes(t))),f=(e,t)=>n.is.obj(e)?t&&e[t]:e,p=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,m=e=>e,g=(e,t=m)=>{let r=A;e.default&&!0!==e.default&&(e=e.default,r=Object.keys(e));const i={};for(const o of r){const r=t(e[o],o);n.is.und(r)||(i[o]=r)}return i},A=["config","onProps","onStart","onChange","onPause","onResume","onRest"],v={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function y(e){const t=function(e){const t={};let r=0;if((0,n.rU)(e,((e,n)=>{v[n]||(t[n]=e,r++)})),r)return t}(e);if(t){const r={to:t};return(0,n.rU)(e,((e,n)=>n in t||(r[n]=e))),r}return u({},e)}function x(e){return e=(0,n.je)(e),n.is.arr(e)?e.map(x):(0,n.Df)(e)?n.OH.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function b(e){for(const t in e)return!0;return!1}function w(e){return n.is.fun(e)||n.is.arr(e)&&n.is.obj(e[0])}function C(e,t){var r;null==(r=e.ref)||r.delete(e),null==t||t.delete(e)}function E(e,t){var r;t&&e.ref!==t&&(null==(r=e.ref)||r.delete(e),t.add(e),e.ref=t)}function S(e,t,r=1e3){(0,n.bt)((()=>{if(t){let i=0;(0,n.S6)(e,((e,o)=>{const a=e.current;if(a.length){let s=r*t[o];isNaN(s)?s=i:i=s,(0,n.S6)(a,(e=>{(0,n.S6)(e.queue,(e=>{const t=e.delay;e.delay=e=>s+h(t||0,e)}))})),e.start()}}))}else{let t=Promise.resolve();(0,n.S6)(e,(e=>{const r=e.current;if(r.length){const i=r.map((e=>{const t=e.queue;return e.queue=[],t}));t=t.then((()=>((0,n.S6)(r,((e,t)=>(0,n.S6)(i[t]||[],(t=>e.queue.push(t))))),Promise.all(e.start()))))}}))}}))}const T={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},M=1.70158,I=1.525*M,B=M+1,_=2*Math.PI/3,F=2*Math.PI/4.5,P=e=>{const t=7.5625,r=2.75;return e<1/r?t*e*e:e<2/r?t*(e-=1.5/r)*e+.75:e<2.5/r?t*(e-=2.25/r)*e+.9375:t*(e-=2.625/r)*e+.984375},R={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>B*e*e*e-M*e*e,easeOutBack:e=>1+B*Math.pow(e-1,3)+M*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-I)/2:(Math.pow(2*e-2,2)*((I+1)*(2*e-2)+I)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*_),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*_)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*F)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*F)/2+1,easeInBounce:e=>1-P(1-e),easeOutBounce:P,easeInOutBounce:e=>e<.5?(1-P(1-2*e))/2:(1+P(2*e-1))/2},L=u({},T.default,{mass:1,damping:1,easing:R.linear,clamp:!1});class D{constructor(){this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,L)}}function N(e,t){if(n.is.und(t.decay)){const r=!n.is.und(t.tension)||!n.is.und(t.friction);!r&&n.is.und(t.frequency)&&n.is.und(t.damping)&&n.is.und(t.mass)||(e.duration=void 0,e.decay=void 0),r&&(e.frequency=void 0)}else e.duration=void 0}const k=[];class O{constructor(){this.changed=!1,this.values=k,this.toValues=null,this.fromValues=k,this.to=void 0,this.from=void 0,this.config=new D,this.immediate=!1}}function U(e,{key:t,props:r,defaultProps:i,state:o,actions:a}){return new Promise(((s,l)=>{var c;let f,p,m=d(null!=(c=r.cancel)?c:null==i?void 0:i.cancel,t);if(m)v();else{n.is.und(r.pause)||(o.paused=d(r.pause,t));let e=null==i?void 0:i.pause;!0!==e&&(e=o.paused||d(e,t)),f=h(r.delay||0,t),e?(o.resumeQueue.add(A),a.pause()):(a.resume(),A())}function g(){o.resumeQueue.add(A),o.timeouts.delete(p),p.cancel(),f=p.time-n.Wn.now()}function A(){f>0&&!n.OH.skipAnimation?(o.delayed=!0,p=n.Wn.setTimeout(v,f),o.pauseQueue.add(g),o.timeouts.add(p)):v()}function v(){o.delayed&&(o.delayed=!1),o.pauseQueue.delete(g),o.timeouts.delete(p),e<=(o.cancelId||0)&&(m=!0);try{a.start(u({},r,{callId:e,cancel:m}),s)}catch(t){l(t)}}}))}const Q=(e,t)=>1==t.length?t[0]:t.some((e=>e.cancelled))?z(e.get()):t.every((e=>e.noop))?V(e.get()):G(e.get(),t.every((e=>e.finished))),V=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),G=(e,t,r=!1)=>({value:e,finished:t,cancelled:r}),z=e=>({value:e,cancelled:!0,finished:!1});function j(e,t,r,i){const{callId:o,parentId:a,onRest:s}=t,{asyncTo:l,promise:c}=r;return a||e!==l||t.reset?r.promise=(async()=>{r.asyncId=o,r.asyncTo=e;const h=g(t,((e,t)=>"onRest"===t?void 0:e));let d,f;const p=new Promise(((e,t)=>(d=e,f=t))),m=e=>{const t=o<=(r.cancelId||0)&&z(i)||o!==r.asyncId&&G(i,!1);if(t)throw e.result=t,f(e),e},A=(e,t)=>{const a=new W,s=new Z;return(async()=>{if(n.OH.skipAnimation)throw H(r),s.result=G(i,!1),f(s),s;m(a);const l=n.is.obj(e)?u({},e):u({},t,{to:e});l.parentId=o,(0,n.rU)(h,((e,t)=>{n.is.und(l[t])&&(l[t]=e)}));const c=await i.start(l);return m(a),r.paused&&await new Promise((e=>{r.resumeQueue.add(e)})),c})()};let v;if(n.OH.skipAnimation)return H(r),G(i,!1);try{let t;t=n.is.arr(e)?(async e=>{for(const t of e)await A(t)})(e):Promise.resolve(e(A,i.stop.bind(i))),await Promise.all([t.then(d),p]),v=G(i.get(),!0,!1)}catch(y){if(y instanceof W)v=y.result;else{if(!(y instanceof Z))throw y;v=y.result}}finally{o==r.asyncId&&(r.asyncId=a,r.asyncTo=a?l:void 0,r.promise=a?c:void 0)}return n.is.fun(s)&&n.Wn.batchedUpdates((()=>{s(v,i,i.item)})),v})():c}function H(e,t){(0,n.yl)(e.timeouts,(e=>e.cancel())),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}class W extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise."),this.result=void 0}}class Z extends Error{constructor(){super("SkipAnimationSignal"),this.result=void 0}}const X=e=>e instanceof J;let Y=1;class J extends n.B0{constructor(...e){super(...e),this.id=Y++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=(0,o.ys)(this);return e&&e.getValue()}to(...e){return n.OH.to(this,e)}interpolate(...e){return(0,n.LW)(),n.OH.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){(0,n.k0)(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||n.fT.sort(this),(0,n.k0)(this,{type:"priority",parent:this,priority:e})}}const q=Symbol.for("SpringPhase"),K=e=>(1&e[q])>0,$=e=>(2&e[q])>0,ee=e=>(4&e[q])>0,te=(e,t)=>t?e[q]|=3:e[q]&=-3,re=(e,t)=>t?e[q]|=4:e[q]&=-5;class ne extends J{constructor(e,t){if(super(),this.key=void 0,this.animation=new O,this.queue=void 0,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!n.is.und(e)||!n.is.und(t)){const r=n.is.obj(e)?u({},e):u({},t,{from:e});n.is.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!($(this)||this._state.asyncTo)||ee(this)}get goal(){return(0,n.je)(this.animation.to)}get velocity(){const e=(0,o.ys)(this);return e instanceof o.iG?e.lastVelocity||0:e.getPayload().map((e=>e.lastVelocity||0))}get hasAnimated(){return K(this)}get isAnimating(){return $(this)}get isPaused(){return ee(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,r=!1;const i=this.animation;let{config:a,toValues:s}=i;const l=(0,o.He)(i.to);!l&&(0,n.j$)(i.to)&&(s=(0,n.qo)((0,n.je)(i.to))),i.values.forEach(((c,u)=>{if(c.done)return;const h=c.constructor==o.eC?1:l?l[u].lastPosition:s[u];let d=i.immediate,f=h;if(!d){if(f=c.lastPosition,a.tension<=0)return void(c.done=!0);let t=c.elapsedTime+=e;const r=i.fromValues[u],o=null!=c.v0?c.v0:c.v0=n.is.arr(a.velocity)?a.velocity[u]:a.velocity;let s;if(n.is.und(a.duration))if(a.decay){const e=!0===a.decay?.998:a.decay,n=Math.exp(-(1-e)*t);f=r+o/(1-e)*(1-n),d=Math.abs(c.lastPosition-f)<.1,s=o*n}else{s=null==c.lastVelocity?o:c.lastVelocity;const t=a.precision||(r==h?.005:Math.min(1,.001*Math.abs(h-r))),i=a.restVelocity||t/10,l=a.clamp?0:a.bounce,u=!n.is.und(l),p=r==h?c.v0>0:r<h;let m,g=!1;const A=1,v=Math.ceil(e/A);for(let e=0;e<v&&(m=Math.abs(s)>i,m||(d=Math.abs(h-f)<=t,!d));++e){u&&(g=f==h||f>h==p,g&&(s=-s*l,f=h));s+=(1e-6*-a.tension*(f-h)+.001*-a.friction*s)/a.mass*A,f+=s*A}}else{let n=1;a.duration>0&&(this._memoizedDuration!==a.duration&&(this._memoizedDuration=a.duration,c.durationProgress>0&&(c.elapsedTime=a.duration*c.durationProgress,t=c.elapsedTime+=e)),n=(a.progress||0)+t/this._memoizedDuration,n=n>1?1:n<0?0:n,c.durationProgress=n),f=r+a.easing(n)*(h-r),s=(f-c.lastPosition)/e,d=1==n}c.lastVelocity=s,Number.isNaN(f)&&(console.warn("Got NaN while animating:",this),d=!0)}l&&!l[u].done&&(d=!1),d?c.done=!0:t=!1,c.setValue(f,a.round)&&(r=!0)}));const c=(0,o.ys)(this),u=c.getValue();if(t){const e=(0,n.je)(i.to);u===e&&!r||a.decay?r&&a.decay&&this._onChange(u):(c.setValue(e),this._onChange(e)),this._stop()}else r&&this._onChange(u)}set(e){return n.Wn.batchedUpdates((()=>{this._stop(),this._focus(e),this._set(e)})),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if($(this)){const{to:e,config:t}=this.animation;n.Wn.batchedUpdates((()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()}))}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let r;return n.is.und(e)?(r=this.queue||[],this.queue=[]):r=[n.is.obj(e)?e:u({},t,{to:e})],Promise.all(r.map((e=>this._update(e)))).then((e=>Q(this,e)))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),H(this._state,e&&this._lastCallId),n.Wn.batchedUpdates((()=>this._stop(t,e))),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:r,from:i}=e;r=n.is.obj(r)?r[t]:r,(null==r||w(r))&&(r=void 0),i=n.is.obj(i)?i[t]:i,null==i&&(i=void 0);const a={to:r,from:i};return K(this)||(e.reverse&&([r,i]=[i,r]),i=(0,n.je)(i),n.is.und(i)?(0,o.ys)(this)||this._set(r):this._set(i)),a}_update(e,t){let r=u({},e);const{key:i,defaultProps:o}=this;r.default&&Object.assign(o,g(r,((e,t)=>/^on/.test(t)?f(e,i):e))),ue(this,r,"onProps"),he(this,"onProps",r,this);const a=this._prepareNode(r);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return U(++this._lastCallId,{key:i,props:r,defaultProps:o,state:s,actions:{pause:()=>{ee(this)||(re(this,!0),(0,n.bl)(s.pauseQueue),he(this,"onPause",G(this,ie(this,this.animation.to)),this))},resume:()=>{ee(this)&&(re(this,!1),$(this)&&this._resume(),(0,n.bl)(s.resumeQueue),he(this,"onResume",G(this,ie(this,this.animation.to)),this))},start:this._merge.bind(this,a)}}).then((e=>{if(r.loop&&e.finished&&(!t||!e.noop)){const e=oe(r);if(e)return this._update(e,!0)}return e}))}_merge(e,t,r){if(t.cancel)return this.stop(!0),r(z(this));const i=!n.is.und(e.to),a=!n.is.und(e.from);if(i||a){if(!(t.callId>this._lastToId))return r(z(this));this._lastToId=t.callId}const{key:s,defaultProps:l,animation:c}=this,{to:f,from:p}=c;let{to:m=f,from:g=p}=e;!a||i||t.default&&!n.is.und(m)||(m=g),t.reverse&&([m,g]=[g,m]);const A=!(0,n.Xy)(g,p);A&&(c.from=g),g=(0,n.je)(g);const v=!(0,n.Xy)(m,f);v&&this._focus(m);const y=w(t.to),{config:b}=c,{decay:C,velocity:E}=b;(i||a)&&(b.velocity=0),t.config&&!y&&function(e,t,r){r&&(N(r=u({},r),t),t=u({},r,t)),N(e,t),Object.assign(e,t);for(const n in L)null==e[n]&&(e[n]=L[n]);let{mass:i,frequency:o,damping:a}=e;n.is.und(o)||(o<.01&&(o=.01),a<0&&(a=0),e.tension=Math.pow(2*Math.PI/o,2)*i,e.friction=4*Math.PI*a*i/o)}(b,h(t.config,s),t.config!==l.config?h(l.config,s):void 0);let S=(0,o.ys)(this);if(!S||n.is.und(m))return r(G(this,!0));const T=n.is.und(t.reset)?a&&!t.default:!n.is.und(g)&&d(t.reset,s),M=T?g:this.get(),I=x(m),B=n.is.num(I)||n.is.arr(I)||(0,n.Df)(I),_=!y&&(!B||d(l.immediate||t.immediate,s));if(v){const e=(0,o.sb)(m);if(e!==S.constructor){if(!_)throw Error(`Cannot animate between ${S.constructor.name} and ${e.name}, as the "to" prop suggests`);S=this._set(I)}}const F=S.constructor;let P=(0,n.j$)(m),R=!1;if(!P){const e=T||!K(this)&&A;(v||e)&&(R=(0,n.Xy)(x(M),I),P=!R),((0,n.Xy)(c.immediate,_)||_)&&(0,n.Xy)(b.decay,C)&&(0,n.Xy)(b.velocity,E)||(P=!0)}if(R&&$(this)&&(c.changed&&!T?P=!0:P||this._stop(f)),!y&&((P||(0,n.j$)(f))&&(c.values=S.getPayload(),c.toValues=(0,n.j$)(m)?null:F==o.eC?[1]:(0,n.qo)(I)),c.immediate!=_&&(c.immediate=_,_||T||this._set(f)),P)){const{onRest:e}=c;(0,n.S6)(ce,(e=>ue(this,t,e)));const i=G(this,ie(this,f));(0,n.bl)(this._pendingCalls,i),this._pendingCalls.add(r),c.changed&&n.Wn.batchedUpdates((()=>{c.changed=!T,null==e||e(i,this),T?h(l.onRest,i):null==c.onStart||c.onStart(i,this)}))}T&&this._set(M),y?r(j(t.to,t,this._state,this)):P?this._start():$(this)&&!v?this._pendingCalls.add(r):r(V(M))}_focus(e){const t=this.animation;e!==t.to&&((0,n.Ll)(this)&&this._detach(),t.to=e,(0,n.Ll)(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;(0,n.j$)(t)&&((0,n.UI)(t,this),X(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;(0,n.j$)(e)&&(0,n.iL)(e,this)}_set(e,t=!0){const r=(0,n.je)(e);if(!n.is.und(r)){const e=(0,o.ys)(this);if(!e||!(0,n.Xy)(r,e.getValue())){const i=(0,o.sb)(r);e&&e.constructor==i?e.setValue(r):(0,o.f3)(this,i.create(r)),e&&n.Wn.batchedUpdates((()=>{this._onChange(r,t)}))}}return(0,o.ys)(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,he(this,"onStart",G(this,ie(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),h(this.animation.onChange,e,this)),h(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;(0,o.ys)(this).reset((0,n.je)(e.to)),e.immediate||(e.fromValues=e.values.map((e=>e.lastPosition))),$(this)||(te(this,!0),ee(this)||this._resume())}_resume(){n.OH.skipAnimation?this.finish():n.fT.start(this)}_stop(e,t){if($(this)){te(this,!1);const r=this.animation;(0,n.S6)(r.values,(e=>{e.done=!0})),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),(0,n.k0)(this,{type:"idle",parent:this});const i=t?z(this.get()):G(this.get(),ie(this,null!=e?e:r.to));(0,n.bl)(this._pendingCalls,i),r.changed&&(r.changed=!1,he(this,"onRest",i,this))}}}function ie(e,t){const r=x(t),i=x(e.get());return(0,n.Xy)(i,r)}function oe(e,t=e.loop,r=e.to){let n=h(t);if(n){const i=!0!==n&&y(n),o=(i||e).reverse,a=!i||i.reset;return ae(u({},e,{loop:t,default:!1,pause:void 0,to:!o||w(r)?r:void 0,from:a?e.from:void 0,reset:a},i))}}function ae(e){const{to:t,from:r}=e=y(e),i=new Set;return n.is.obj(t)&&le(t,i),n.is.obj(r)&&le(r,i),e.keys=i.size?Array.from(i):null,e}function se(e){const t=ae(e);return n.is.und(t.default)&&(t.default=g(t)),t}function le(e,t){(0,n.rU)(e,((e,r)=>null!=e&&t.add(r)))}const ce=["onStart","onRest","onChange","onPause","onResume"];function ue(e,t,r){e.animation[r]=t[r]!==p(t,r)?f(t[r],e.key):void 0}function he(e,t,...r){var n,i,o,a;null==(n=(i=e.animation)[t])||n.call(i,...r),null==(o=(a=e.defaultProps)[t])||o.call(a,...r)}const de=["onStart","onChange","onRest"];let fe=1;class pe{constructor(e,t){this.id=fe++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start(u({default:!0},e))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every((e=>e.idle&&!e.isDelayed&&!e.isPaused))}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each(((t,r)=>e[r]=t.get())),e}set(e){for(const t in e){const r=e[t];n.is.und(r)||this.springs[t].set(r)}}update(e){return e&&this.queue.push(ae(e)),this}start(e){let{queue:t}=this;return e?t=(0,n.qo)(e).map(ae):this.queue=[],this._flush?this._flush(this,t):(be(this,t),me(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const r=this.springs;(0,n.S6)((0,n.qo)(t),(t=>r[t].stop(!!e)))}else H(this._state,this._lastAsyncId),this.each((t=>t.stop(!!e)));return this}pause(e){if(n.is.und(e))this.start({pause:!0});else{const t=this.springs;(0,n.S6)((0,n.qo)(e),(e=>t[e].pause()))}return this}resume(e){if(n.is.und(e))this.start({pause:!1});else{const t=this.springs;(0,n.S6)((0,n.qo)(e),(e=>t[e].resume()))}return this}each(e){(0,n.rU)(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:r}=this._events,i=this._active.size>0,o=this._changed.size>0;(i&&!this._started||o&&!this._started)&&(this._started=!0,(0,n.yl)(e,(([e,t])=>{t.value=this.get(),e(t,this,this._item)})));const a=!i&&this._started,s=o||a&&r.size?this.get():null;o&&t.size&&(0,n.yl)(t,(([e,t])=>{t.value=s,e(t,this,this._item)})),a&&(this._started=!1,(0,n.yl)(r,(([e,t])=>{t.value=s,e(t,this,this._item)})))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}n.Wn.onFrame(this._onFrame)}}function me(e,t){return Promise.all(t.map((t=>ge(e,t)))).then((t=>Q(e,t)))}async function ge(e,t,r){const{keys:i,to:o,from:a,loop:s,onRest:l,onResolve:c}=t,u=n.is.obj(t.default)&&t.default;s&&(t.loop=!1),!1===o&&(t.to=null),!1===a&&(t.from=null);const h=n.is.arr(o)||n.is.fun(o)?o:void 0;h?(t.to=void 0,t.onRest=void 0,u&&(u.onRest=void 0)):(0,n.S6)(de,(r=>{const i=t[r];if(n.is.fun(i)){const n=e._events[r];t[r]=({finished:e,cancelled:t})=>{const r=n.get(i);r?(e||(r.finished=!1),t&&(r.cancelled=!0)):n.set(i,{value:null,finished:e||!1,cancelled:t||!1})},u&&(u[r]=t[r])}}));const d=e._state;t.pause===!d.paused?(d.paused=t.pause,(0,n.bl)(t.pause?d.pauseQueue:d.resumeQueue)):d.paused&&(t.pause=!0);const f=(i||Object.keys(e.springs)).map((r=>e.springs[r].start(t))),m=!0===t.cancel||!0===p(t,"cancel");(h||m&&d.asyncId)&&f.push(U(++e._lastAsyncId,{props:t,state:d,actions:{pause:n.ZT,resume:n.ZT,start(t,r){m?(H(d,e._lastAsyncId),r(z(e))):(t.onRest=l,r(j(h,t,d,e)))}}})),d.paused&&await new Promise((e=>{d.resumeQueue.add(e)}));const g=Q(e,await Promise.all(f));if(s&&g.finished&&(!r||!g.noop)){const r=oe(t,s,o);if(r)return be(e,[r]),ge(e,r,!0)}return c&&n.Wn.batchedUpdates((()=>c(g,e,e.item))),g}function Ae(e,t){const r=u({},e.springs);return t&&(0,n.S6)((0,n.qo)(t),(e=>{n.is.und(e.keys)&&(e=ae(e)),n.is.obj(e.to)||(e=u({},e,{to:void 0})),xe(r,e,(e=>ye(e)))})),ve(e,r),r}function ve(e,t){(0,n.rU)(t,((t,r)=>{e.springs[r]||(e.springs[r]=t,(0,n.UI)(t,e))}))}function ye(e,t){const r=new ne;return r.key=e,t&&(0,n.UI)(r,t),r}function xe(e,t,r){t.keys&&(0,n.S6)(t.keys,(n=>{(e[n]||(e[n]=r(n)))._prepareNode(t)}))}function be(e,t){(0,n.S6)(t,(t=>{xe(e.springs,t,(t=>ye(t,e)))}))}function we(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}const Ce=["children"],Ee=e=>{let{children:t}=e,r=we(e,Ce);const o=(0,i.useContext)(Se),a=r.pause||!!o.pause,s=r.immediate||!!o.immediate;r=(0,n.Pr)((()=>({pause:a,immediate:s})),[a,s]);const{Provider:l}=Se;return i.createElement(l,{value:r},t)},Se=(Te=Ee,Me={},Object.assign(Te,i.createContext(Me)),Te.Provider._context=Te,Te.Consumer._context=Te,Te);var Te,Me;Ee.Provider=Se.Provider,Ee.Consumer=Se.Consumer;const Ie=()=>{const e=[],t=function(t){(0,n.ZR)();const i=[];return(0,n.S6)(e,((e,o)=>{if(n.is.und(t))i.push(e.start());else{const n=r(t,e,o);n&&i.push(e.start(n))}})),i};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){const r=e.indexOf(t);~r&&e.splice(r,1)},t.pause=function(){return(0,n.S6)(e,(e=>e.pause(...arguments))),this},t.resume=function(){return(0,n.S6)(e,(e=>e.resume(...arguments))),this},t.set=function(t){(0,n.S6)(e,(e=>e.set(t)))},t.start=function(t){const r=[];return(0,n.S6)(e,((e,i)=>{if(n.is.und(t))r.push(e.start());else{const n=this._getProps(t,e,i);n&&r.push(e.start(n))}})),r},t.stop=function(){return(0,n.S6)(e,(e=>e.stop(...arguments))),this},t.update=function(t){return(0,n.S6)(e,((e,r)=>e.update(this._getProps(t,e,r)))),this};const r=function(e,t,r){return n.is.fun(e)?e(r,t):e};return t._getProps=r,t};function Be(e,t,r){const o=n.is.fun(t)&&t;o&&!r&&(r=[]);const a=(0,i.useMemo)((()=>o||3==arguments.length?Ie():void 0),[]),s=(0,i.useRef)(0),l=(0,n.NW)(),c=(0,i.useMemo)((()=>({ctrls:[],queue:[],flush(e,t){const r=Ae(e,t);return s.current>0&&!c.queue.length&&!Object.keys(r).some((t=>!e.springs[t]))?me(e,t):new Promise((n=>{ve(e,r),c.queue.push((()=>{n(me(e,t))})),l()}))}})),[]),h=(0,i.useRef)([...c.ctrls]),d=[],f=(0,n.zH)(e)||0;function p(e,r){for(let n=e;n<r;n++){const e=h.current[n]||(h.current[n]=new pe(null,c.flush)),r=o?o(n,e):t[n];r&&(d[n]=se(r))}}(0,i.useMemo)((()=>{(0,n.S6)(h.current.slice(e,f),(e=>{C(e,a),e.stop(!0)})),h.current.length=e,p(f,e)}),[e]),(0,i.useMemo)((()=>{p(0,Math.min(f,e))}),r);const m=h.current.map(((e,t)=>Ae(e,d[t]))),g=(0,i.useContext)(Ee),A=(0,n.zH)(g),v=g!==A&&b(g);(0,n.bt)((()=>{s.current++,c.ctrls=h.current;const{queue:e}=c;e.length&&(c.queue=[],(0,n.S6)(e,(e=>e()))),(0,n.S6)(h.current,((e,t)=>{null==a||a.add(e),v&&e.start({default:g});const r=d[t];r&&(E(e,r.ref),e.ref?e.queue.push(r):e.start(r))}))})),(0,n.tf)((()=>()=>{(0,n.S6)(c.ctrls,(e=>e.stop(!0)))}));const y=m.map((e=>u({},e)));return a?[y,a]:y}function _e(e,t){const r=n.is.fun(e),[[i],o]=Be(1,r?e:[e],r?t||[]:t);return r||2==arguments.length?[i,o]:i}const Fe=()=>Ie(),Pe=()=>(0,i.useState)(Fe)[0];function Re(e,t,r){var i;const o=n.is.fun(t)&&t;o&&!r&&(r=[]);let a,s=!0;const l=Be(e,((e,r)=>{const n=o?o(e,r):t;return a=n.ref,s=s&&n.reverse,n}),r||[{}]),c=null!=(i=a)?i:l[1];return(0,n.bt)((()=>{(0,n.S6)(c.current,((e,t)=>{const r=c.current[t+(s?1:-1)];r?e.start({to:r.springs}):e.start()}))}),r),c.start=e=>{const t=[];return(0,n.S6)(c.current,((r,i)=>{const o=n.is.fun(e)?e(i,r):e,a=c.current[i+(s?1:-1)];a?t.push(r.start(u({},o,{to:a.springs}))):t.push(r.start(u({},o)))})),t},o||3==arguments.length?(c._getProps=(e,t,r)=>{const i=n.is.fun(e)?e(r,t):e;if(i){const e=c.current[r+(i.reverse?1:-1)];return e&&(i.to=e.springs),i}},l):l[0]}let Le;function De(e,t,r){const o=n.is.fun(t)&&t,{reset:a,sort:s,trail:l=0,expires:c=!0,exitBeforeEnter:d=!1,onDestroyed:f,ref:p,config:m}=o?o():t,A=(0,i.useMemo)((()=>o||3==arguments.length?Ie():void 0),[]),v=(0,n.qo)(e),x=[],w=(0,i.useRef)(null),S=a?null:w.current;(0,n.bt)((()=>{w.current=x})),(0,n.tf)((()=>()=>{(0,n.S6)(w.current,(e=>{e.expired&&clearTimeout(e.expirationId),C(e.ctrl,A),e.ctrl.stop(!0)}))}));const T=ke(v,o?o():t,S),M=a&&w.current||[];(0,n.bt)((()=>(0,n.S6)(M,(({ctrl:e,item:t,key:r})=>{C(e,A),h(f,t,r)}))));const I=[];if(S&&(0,n.S6)(S,((e,t)=>{e.expired?(clearTimeout(e.expirationId),M.push(e)):~(t=I[t]=T.indexOf(e.key))&&(x[t]=e)})),(0,n.S6)(v,((e,t)=>{x[t]||(x[t]={key:T[t],item:e,phase:Le.MOUNT,ctrl:new pe},x[t].ctrl.item=e)})),I.length){let e=-1;const{leave:r}=o?o():t;(0,n.S6)(I,((t,n)=>{const i=S[n];~t?(e=x.indexOf(i),x[e]=u({},i,{item:v[t]})):r&&x.splice(++e,0,i)}))}n.is.fun(s)&&x.sort(((e,t)=>s(e.item,t.item)));let B=-l;const _=(0,n.NW)(),F=g(t),P=new Map,R=(0,i.useRef)(new Map),L=(0,i.useRef)(!1);(0,n.S6)(x,((e,r)=>{const i=e.key,a=e.phase,s=o?o():t;let f,g,A=h(s.delay||0,i);if(a==Le.MOUNT)f=s.enter,g=Le.ENTER;else{const e=T.indexOf(i)<0;if(a!=Le.LEAVE)if(e)f=s.leave,g=Le.LEAVE;else{if(!(f=s.update))return;g=Le.UPDATE}else{if(e)return;f=s.enter,g=Le.ENTER}}if(f=h(f,e.item,r),f=n.is.obj(f)?y(f):{to:f},!f.config){const t=m||F.config;f.config=h(t,e.item,r,g)}B+=l;const v=u({},F,{delay:A+B,ref:p,immediate:s.immediate,reset:!1},f);if(g==Le.ENTER&&n.is.und(v.from)){const i=o?o():t,a=n.is.und(i.initial)||S?i.from:i.initial;v.from=h(a,e.item,r)}const{onResolve:x}=v;v.onResolve=e=>{h(x,e);const t=w.current,r=t.find((e=>e.key===i));if(r&&(!e.cancelled||r.phase==Le.UPDATE)&&r.ctrl.idle){const e=t.every((e=>e.ctrl.idle));if(r.phase==Le.LEAVE){const t=h(c,r.item);if(!1!==t){const n=!0===t?0:t;if(r.expired=!0,!e&&n>0)return void(n<=2147483647&&(r.expirationId=setTimeout(_,n)))}}e&&t.some((e=>e.expired))&&(R.current.delete(r),d&&(L.current=!0),_())}};const b=Ae(e.ctrl,v);g===Le.LEAVE&&d?R.current.set(e,{phase:g,springs:b,payload:v}):P.set(e,{phase:g,springs:b,payload:v})}));const D=(0,i.useContext)(Ee),N=(0,n.zH)(D),k=D!==N&&b(D);(0,n.bt)((()=>{k&&(0,n.S6)(x,(e=>{e.ctrl.start({default:D})}))}),[D]),(0,n.S6)(P,((e,t)=>{if(R.current.size){const e=x.findIndex((e=>e.key===t.key));x.splice(e,1)}})),(0,n.bt)((()=>{(0,n.S6)(R.current.size?R.current:P,(({phase:e,payload:t},r)=>{const{ctrl:n}=r;r.phase=e,null==A||A.add(n),k&&e==Le.ENTER&&n.start({default:D}),t&&(E(n,t.ref),n.ref&&!L.current?n.update(t):(n.start(t),L.current&&(L.current=!1)))}))}),a?void 0:r);const O=e=>i.createElement(i.Fragment,null,x.map(((t,r)=>{const{springs:o}=P.get(t)||t.ctrl,a=e(u({},o),t.item,t,r);return a&&a.type?i.createElement(a.type,u({},a.props,{key:n.is.str(t.key)||n.is.num(t.key)?t.key:t.ctrl.id,ref:a.ref})):a})));return A?[O,A]:O}!function(e){e.MOUNT="mount",e.ENTER="enter",e.UPDATE="update",e.LEAVE="leave"}(Le||(Le={}));let Ne=1;function ke(e,{key:t,keys:r=t},i){if(null===r){const t=new Set;return e.map((e=>{const r=i&&i.find((r=>r.item===e&&r.phase!==Le.LEAVE&&!t.has(r)));return r?(t.add(r),r.key):Ne++}))}return n.is.und(r)?e:n.is.fun(r)?e.map(r):(0,n.qo)(r)}const Oe=["children"];function Ue(e){let{children:t}=e;return t(_e(we(e,Oe)))}const Qe=["items","children"];function Ve(e){let{items:t,children:r}=e,i=we(e,Qe);const o=Re(t.length,i);return t.map(((e,t)=>{const i=r(e,t);return n.is.fun(i)?i(o[t]):i}))}const Ge=["items","children"];function ze(e){let{items:t,children:r}=e;return De(t,we(e,Ge))(r)}class je extends J{constructor(e,t){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=e,this.calc=(0,n.mD)(...t);const r=this._get(),i=(0,o.sb)(r);(0,o.f3)(this,i.create(r))}advance(e){const t=this._get(),r=this.get();(0,n.Xy)(t,r)||((0,o.ys)(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&We(this._active)&&Ze(this)}_get(){const e=n.is.arr(this.source)?this.source.map(n.je):(0,n.qo)((0,n.je)(this.source));return this.calc(...e)}_start(){this.idle&&!We(this._active)&&(this.idle=!1,(0,n.S6)((0,o.He)(this),(e=>{e.done=!1})),n.OH.skipAnimation?(n.Wn.batchedUpdates((()=>this.advance())),Ze(this)):n.fT.start(this))}_attach(){let e=1;(0,n.S6)((0,n.qo)(this.source),(t=>{(0,n.j$)(t)&&(0,n.UI)(t,this),X(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))})),this.priority=e,this._start()}_detach(){(0,n.S6)((0,n.qo)(this.source),(e=>{(0,n.j$)(e)&&(0,n.iL)(e,this)})),this._active.clear(),Ze(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=(0,n.qo)(this.source).reduce(((e,t)=>Math.max(e,(X(t)?t.priority:0)+1)),0))}}function He(e){return!1!==e.idle}function We(e){return!e.size||Array.from(e).every(He)}function Ze(e){e.idle||(e.idle=!0,(0,n.S6)((0,o.He)(e),(e=>{e.done=!0})),(0,n.k0)(e,{type:"idle",parent:e}))}const Xe=(e,...t)=>new je(e,t),Ye=(e,...t)=>((0,n.LW)(),new je(e,t));n.OH.assign({createStringInterpolator:n.qS,to:(e,t)=>new je(e,t)});const Je=n.fT.advance},8777:function(e,t,r){"use strict";r.d(t,{B0:function(){return xe},OH:function(){return k},UI:function(){return we},k0:function(){return ye},O9:function(){return Z},mD:function(){return de},qS:function(){return Le},dE:function(){return C},ZR:function(){return Qe},LW:function(){return Oe},S6:function(){return T},rU:function(){return M},yl:function(){return B},bl:function(){return _},fT:function(){return G},Ll:function(){return ve},je:function(){return Ae},j$:function(){return ge},is:function(){return E},Df:function(){return Ve},Xy:function(){return S},ZT:function(){return w},Wn:function(){return i},iL:function(){return Ce},qo:function(){return I},NW:function(){return je},bt:function(){return Xe},Pr:function(){return We},tf:function(){return Ge},zH:function(){return Ze}});let n=y();const i=e=>m(e,n);let o=y();i.write=e=>m(e,o);let a=y();i.onStart=e=>m(e,a);let s=y();i.onFrame=e=>m(e,s);let l=y();i.onFinish=e=>m(e,l);let c=[];i.setTimeout=(e,t)=>{let r=i.now()+t,n=()=>{let e=c.findIndex((e=>e.cancel==n));~e&&c.splice(e,1),f-=~e?1:0},o={time:r,handler:e,cancel:n};return c.splice(u(r),0,o),f+=1,g(),o};let u=e=>~(~c.findIndex((t=>t.time>e))||~c.length);i.cancel=e=>{a.delete(e),s.delete(e),n.delete(e),o.delete(e),l.delete(e)},i.sync=e=>{p=!0,i.batchedUpdates(e),p=!1},i.throttle=e=>{let t;function r(){try{e(...t)}finally{t=null}}function n(...e){t=e,i.onStart(r)}return n.handler=e,n.cancel=()=>{a.delete(r),t=null},n};let h="undefined"!=typeof window?window.requestAnimationFrame:()=>{};i.use=e=>h=e,i.now="undefined"!=typeof performance?()=>performance.now():Date.now,i.batchedUpdates=e=>e(),i.catch=console.error,i.frameLoop="always",i.advance=()=>{"demand"!==i.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):v()};let d=-1,f=0,p=!1;function m(e,t){p?(t.delete(e),e(0)):(t.add(e),g())}function g(){d<0&&(d=0,"demand"!==i.frameLoop&&h(A))}function A(){~d&&(h(A),i.batchedUpdates(v))}function v(){let e=d;d=i.now();let t=u(d);t&&(x(c.splice(0,t),(e=>e.handler())),f-=t),a.flush(),n.flush(e?Math.min(64,d-e):16.667),s.flush(),o.flush(),l.flush(),f||(d=-1)}function y(){let e=new Set,t=e;return{add(r){f+=t!=e||e.has(r)?0:1,e.add(r)},delete:r=>(f-=t==e&&e.has(r)?1:0,e.delete(r)),flush(r){t.size&&(e=new Set,f-=t.size,x(t,(t=>t(r)&&e.add(t))),f+=e.size,t=e)}}}function x(e,t){e.forEach((e=>{try{t(e)}catch(r){i.catch(r)}}))}var b=r(7378);function w(){}const C=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),E={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"===typeof e,str:e=>"string"===typeof e,num:e=>"number"===typeof e,und:e=>void 0===e};function S(e,t){if(E.arr(e)){if(!E.arr(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return e===t}const T=(e,t)=>e.forEach(t);function M(e,t,r){if(E.arr(e))for(let n=0;n<e.length;n++)t.call(r,e[n],`${n}`);else for(const n in e)e.hasOwnProperty(n)&&t.call(r,e[n],n)}const I=e=>E.und(e)?[]:E.arr(e)?e:[e];function B(e,t){if(e.size){const r=Array.from(e);e.clear(),T(r,t)}}const _=(e,...t)=>B(e,(e=>e(...t))),F=()=>"undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent);let P,R,L=null,D=!1,N=w;var k=Object.freeze({__proto__:null,get createStringInterpolator(){return P},get to(){return R},get colors(){return L},get skipAnimation(){return D},get willAdvance(){return N},assign:e=>{e.to&&(R=e.to),e.now&&(i.now=e.now),void 0!==e.colors&&(L=e.colors),null!=e.skipAnimation&&(D=e.skipAnimation),e.createStringInterpolator&&(P=e.createStringInterpolator),e.requestAnimationFrame&&i.use(e.requestAnimationFrame),e.batchedUpdates&&(i.batchedUpdates=e.batchedUpdates),e.willAdvance&&(N=e.willAdvance),e.frameLoop&&(i.frameLoop=e.frameLoop)}});const O=new Set;let U=[],Q=[],V=0;const G={get idle(){return!O.size&&!U.length},start(e){V>e.priority?(O.add(e),i.onStart(z)):(j(e),i(W))},advance:W,sort(e){if(V)i.onFrame((()=>G.sort(e)));else{const t=U.indexOf(e);~t&&(U.splice(t,1),H(e))}},clear(){U=[],O.clear()}};function z(){O.forEach(j),O.clear(),i(W)}function j(e){U.includes(e)||H(e)}function H(e){U.splice(function(e,t){const r=e.findIndex(t);return r<0?e.length:r}(U,(t=>t.priority>e.priority)),0,e)}function W(e){const t=Q;for(let r=0;r<U.length;r++){const n=U[r];V=n.priority,n.idle||(N(n),n.advance(e),n.idle||t.push(n))}return V=0,Q=U,Q.length=0,U=t,U.length>0}const Z={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},X="[-+]?\\d*\\.?\\d+",Y=X+"%";function J(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}const q=new RegExp("rgb"+J(X,X,X)),K=new RegExp("rgba"+J(X,X,X,X)),$=new RegExp("hsl"+J(X,Y,Y)),ee=new RegExp("hsla"+J(X,Y,Y,X)),te=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,re=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,ne=/^#([0-9a-fA-F]{6})$/,ie=/^#([0-9a-fA-F]{8})$/;function oe(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function ae(e,t,r){const n=r<.5?r*(1+t):r+t-r*t,i=2*r-n,o=oe(i,n,e+1/3),a=oe(i,n,e),s=oe(i,n,e-1/3);return Math.round(255*o)<<24|Math.round(255*a)<<16|Math.round(255*s)<<8}function se(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function le(e){return(parseFloat(e)%360+360)%360/360}function ce(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function ue(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function he(e){let t=function(e){let t;return"number"===typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=ne.exec(e))?parseInt(t[1]+"ff",16)>>>0:L&&void 0!==L[e]?L[e]:(t=q.exec(e))?(se(t[1])<<24|se(t[2])<<16|se(t[3])<<8|255)>>>0:(t=K.exec(e))?(se(t[1])<<24|se(t[2])<<16|se(t[3])<<8|ce(t[4]))>>>0:(t=te.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=ie.exec(e))?parseInt(t[1],16)>>>0:(t=re.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=$.exec(e))?(255|ae(le(t[1]),ue(t[2]),ue(t[3])))>>>0:(t=ee.exec(e))?(ae(le(t[1]),ue(t[2]),ue(t[3]))|ce(t[4]))>>>0:null}(e);return null===t?e:(t=t||0,`rgba(${(4278190080&t)>>>24}, ${(16711680&t)>>>16}, ${(65280&t)>>>8}, ${(255&t)/255})`)}const de=(e,t,r)=>{if(E.fun(e))return e;if(E.arr(e))return de({range:e,output:t,extrapolate:r});if(E.str(e.output[0]))return P(e);const n=e,i=n.output,o=n.range||[0,1],a=n.extrapolateLeft||n.extrapolate||"extend",s=n.extrapolateRight||n.extrapolate||"extend",l=n.easing||(e=>e);return e=>{const t=function(e,t){for(var r=1;r<t.length-1&&!(t[r]>=e);++r);return r-1}(e,o);return function(e,t,r,n,i,o,a,s,l){let c=l?l(e):e;if(c<t){if("identity"===a)return c;"clamp"===a&&(c=t)}if(c>r){if("identity"===s)return c;"clamp"===s&&(c=r)}if(n===i)return n;if(t===r)return e<=t?n:i;t===-1/0?c=-c:r===1/0?c-=t:c=(c-t)/(r-t);c=o(c),n===-1/0?c=-c:i===1/0?c+=n:c=c*(i-n)+n;return c}(e,o[t],o[t+1],i[t],i[t+1],l,a,s,n.map)}};function fe(){return(fe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}const pe=Symbol.for("FluidValue.get"),me=Symbol.for("FluidValue.observers"),ge=e=>Boolean(e&&e[pe]),Ae=e=>e&&e[pe]?e[pe]():e,ve=e=>e[me]||null;function ye(e,t){let r=e[me];r&&r.forEach((e=>{!function(e,t){e.eventObserved?e.eventObserved(t):e(t)}(e,t)}))}class xe{constructor(e){if(this[pe]=void 0,this[me]=void 0,!e&&!(e=this.get))throw Error("Unknown getter");be(this,e)}}const be=(e,t)=>Ee(e,pe,t);function we(e,t){if(e[pe]){let r=e[me];r||Ee(e,me,r=new Set),r.has(t)||(r.add(t),e.observerAdded&&e.observerAdded(r.size,t))}return t}function Ce(e,t){let r=e[me];if(r&&r.has(t)){const n=r.size-1;n?r.delete(t):e[me]=null,e.observerRemoved&&e.observerRemoved(n,t)}}const Ee=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),Se=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Te=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,Me=new RegExp(`(${Se.source})(%|[a-z]+)`,"i"),Ie=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,Be=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,_e=e=>{const[t,r]=Fe(e);if(!t||F())return e;const n=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(n)return n.trim();if(r&&r.startsWith("--")){const t=window.getComputedStyle(document.documentElement).getPropertyValue(r);return t||e}return r&&Be.test(r)?_e(r):r||e},Fe=e=>{const t=Be.exec(e);if(!t)return[,];const[,r,n]=t;return[r,n]};let Pe;const Re=(e,t,r,n,i)=>`rgba(${Math.round(t)}, ${Math.round(r)}, ${Math.round(n)}, ${i})`,Le=e=>{Pe||(Pe=L?new RegExp(`(${Object.keys(L).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map((e=>Ae(e).replace(Be,_e).replace(Te,he).replace(Pe,he))),r=t.map((e=>e.match(Se).map(Number))),n=r[0].map(((e,t)=>r.map((e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})))).map((t=>de(fe({},e,{output:t}))));return e=>{var r;const i=!Me.test(t[0])&&(null==(r=t.find((e=>Me.test(e))))?void 0:r.replace(Se,""));let o=0;return t[0].replace(Se,(()=>`${n[o++](e)}${i||""}`)).replace(Ie,Re)}},De="react-spring: ",Ne=e=>{const t=e;let r=!1;if("function"!=typeof t)throw new TypeError(`${De}once requires a function parameter`);return(...e)=>{r||(t(...e),r=!0)}},ke=Ne(console.warn);function Oe(){ke(`${De}The "interpolate" function is deprecated in v9 (use "to" instead)`)}const Ue=Ne(console.warn);function Qe(){Ue(`${De}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function Ve(e){return E.str(e)&&("#"==e[0]||/\d/.test(e)||!F()&&Be.test(e)||e in(L||{}))}const Ge=e=>(0,b.useEffect)(e,ze),ze=[];function je(){const e=(0,b.useState)()[1],t=(0,b.useState)(He)[0];return Ge(t.unmount),()=>{t.current&&e({})}}function He(){const e={current:!0,unmount:()=>()=>{e.current=!1}};return e}function We(e,t){const[r]=(0,b.useState)((()=>({inputs:t,result:e()}))),n=(0,b.useRef)(),i=n.current;let o=i;if(o){Boolean(t&&o.inputs&&function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(t,o.inputs))||(o={inputs:t,result:e()})}else o=r;return(0,b.useEffect)((()=>{n.current=o,i==r&&(r.inputs=r.result=void 0)}),[o]),o.result}function Ze(e){const t=(0,b.useRef)();return(0,b.useEffect)((()=>{t.current=e})),t.current}const Xe="undefined"!==typeof window&&window.document&&window.document.createElement?b.useLayoutEffect:b.useEffect},3637:function(e,t,r){"use strict";r.r(t),r.d(t,{a:function(){return h},animated:function(){return h}});var n=r(1403),i=r(2351),o={};for(var a in i)["default","a","animated"].indexOf(a)<0&&(o[a]=function(e){return i[e]}.bind(0,a));r.d(t,o);var s=r(8777),l=r(7548),c=r(6173);const u=["primitive"].concat(Object.keys(c).filter((e=>/^[A-Z]/.test(e))).map((e=>e[0].toLowerCase()+e.slice(1))));i.Globals.assign({createStringInterpolator:s.qS,colors:s.O9,frameLoop:"demand"}),(0,n.addEffect)((()=>{s.Wn.advance()}));const h=(0,l.Ld)(u,{applyAnimatedValues:n.applyProps}).animated},2673:function(){},5752:function(){},1869:function(e,t,r){"use strict";r.d(t,{I:function(){return A},L:function(){return c}});var n=r(7378),i=r(1403),o=r(6173),a=r(8853),s=r(7129);const l=n.createContext({}),c=()=>n.useContext(l),u=2*Math.PI,h=new o.Object3D,d=new o.Matrix4,[f,p]=[new o.Quaternion,new o.Quaternion],m=new o.Vector3,g=new o.Vector3,A=({alignment:e="bottom-right",margin:t=[80,80],renderPriority:r=0,onUpdate:c,onTarget:A,children:v})=>{const y=(0,i.useThree)((({size:e})=>e)),x=(0,i.useThree)((({camera:e})=>e)),b=(0,i.useThree)((({controls:e})=>e)),w=(0,i.useThree)((({gl:e})=>e)),C=(0,i.useThree)((({scene:e})=>e)),E=(0,i.useThree)((({invalidate:e})=>e)),S=n.useRef(),T=n.useRef(),M=n.useRef(null),[I]=n.useState((()=>new o.Scene)),B=n.useRef(!1),_=n.useRef(0),F=n.useRef(new o.Vector3(0,0,0));n.useEffect((()=>(C.background&&(S.current=C.background,C.background=null,I.background=S.current),()=>{S.current&&(C.background=S.current)})),[]);(0,i.useFrame)(((e,t)=>{M.current&&T.current&&((e=>{if(!B.current)return;if(f.angleTo(p)<.01)return void(B.current=!1);const t=e*u;f.rotateTowards(p,t),x.position.set(0,0,1).applyQuaternion(f).multiplyScalar(_.current).add(F.current),x.up.set(0,1,0).applyQuaternion(f).normalize(),x.quaternion.copy(f),c?c():b&&b.update(),E()})(t),(()=>{var e;d.copy(x.matrix).invert(),null==(e=T.current)||e.quaternion.setFromRotationMatrix(d)})(),w.autoClear=!1,w.clearDepth(),w.render(I,M.current))}),r);const P={tweenCamera:e=>{B.current=!0,(b||A)&&(F.current=(null==b?void 0:b.target)||(null==A?void 0:A())),_.current=x.position.distanceTo(m),f.copy(x.quaternion),g.copy(e).multiplyScalar(_.current).add(m),h.lookAt(g),p.copy(h.quaternion),E()},raycast:(0,s.A)(M)},[R,L]=t,D=e.endsWith("-left")?-y.width/2+R:y.width/2-R,N=e.startsWith("top-")?y.height/2-L:-y.height/2+L;return(0,i.createPortal)(n.createElement(l.Provider,{value:P},n.createElement(a.i,{ref:M,makeDefault:!1,position:[0,0,200]}),n.createElement("group",{ref:T,position:[D,N,0]},v)),I)}},4064:function(e,t,r){"use strict";r.d(t,{f:function(){return u}});var n=r(5773),i=r(7378),o=r(1403),a=r(6173),s=r(1869);function l({scale:e=[.8,.05,.05],color:t,rotation:r}){return i.createElement("group",{rotation:r},i.createElement("mesh",{position:[.4,0,0]},i.createElement("boxGeometry",{args:e}),i.createElement("meshBasicMaterial",{color:t,toneMapped:!1})))}function c({onClick:e,font:t,disabled:r,arcStyle:s,label:l,labelColor:c,axisHeadScale:u=1,...h}){const d=(0,o.useThree)((e=>e.gl)),f=i.useMemo((()=>{const e=document.createElement("canvas");e.width=64,e.height=64;const r=e.getContext("2d");return r.beginPath(),r.arc(32,32,16,0,2*Math.PI),r.closePath(),r.fillStyle=s,r.fill(),l&&(r.font=t,r.textAlign="center",r.fillStyle=c,r.fillText(l,32,41)),new a.CanvasTexture(e)}),[s,l,c,t]),[p,m]=i.useState(!1),g=(l?1:.75)*(p?1.2:1)*u;return i.createElement("sprite",(0,n.Z)({scale:g,onPointerOver:r?void 0:e=>{e.stopPropagation(),m(!0)},onPointerOut:r?void 0:e||(e=>{e.stopPropagation(),m(!1)})},h),i.createElement("spriteMaterial",{map:f,"map-anisotropy":d.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:l?1:.75,toneMapped:!1}))}const u=({hideNegativeAxes:e,hideAxisHeads:t,disabled:r,font:o="18px Inter var, Arial, sans-serif",axisColors:a=["#ff3653","#0adb50","#2c8fdf"],axisHeadScale:u=1,axisScale:h,labels:d=["X","Y","Z"],labelColor:f="#000",onClick:p,...m})=>{const[g,A,v]=a,{tweenCamera:y,raycast:x}=(0,s.L)(),b={font:o,disabled:r,labelColor:f,raycast:x,onClick:p,axisHeadScale:u,onPointerDown:r?void 0:e=>{y(e.object.position),e.stopPropagation()}};return i.createElement("group",(0,n.Z)({scale:40},m),i.createElement(l,{color:g,rotation:[0,0,0],scale:h}),i.createElement(l,{color:A,rotation:[0,0,Math.PI/2],scale:h}),i.createElement(l,{color:v,rotation:[0,-Math.PI/2,0],scale:h}),!t&&i.createElement(i.Fragment,null,i.createElement(c,(0,n.Z)({arcStyle:g,position:[1,0,0],label:d[0]},b)),i.createElement(c,(0,n.Z)({arcStyle:A,position:[0,1,0],label:d[1]},b)),i.createElement(c,(0,n.Z)({arcStyle:v,position:[0,0,1],label:d[2]},b)),!e&&i.createElement(i.Fragment,null,i.createElement(c,(0,n.Z)({arcStyle:g,position:[-1,0,0]},b)),i.createElement(c,(0,n.Z)({arcStyle:A,position:[0,-1,0]},b)),i.createElement(c,(0,n.Z)({arcStyle:v,position:[0,0,-1]},b)))),i.createElement("ambientLight",{intensity:.5}),i.createElement("pointLight",{position:[10,10,10],intensity:.5}))}},8853:function(e,t,r){"use strict";r.d(t,{i:function(){return s}});var n=r(5773),i=r(7378),o=r(1403),a=r(5324);const s=i.forwardRef((({makeDefault:e,...t},r)=>{const s=(0,o.useThree)((({set:e})=>e)),l=(0,o.useThree)((({camera:e})=>e)),c=(0,o.useThree)((({size:e})=>e)),u=i.useRef();return i.useLayoutEffect((()=>{u.current&&!t.manual&&u.current.updateProjectionMatrix()}),[c,t]),i.useLayoutEffect((()=>{if(e&&u.current){const e=l;return s((()=>({camera:u.current}))),()=>s((()=>({camera:e})))}}),[l,u,e,s]),i.createElement("orthographicCamera",(0,n.Z)({left:c.width/-2,right:c.width/2,top:c.height/2,bottom:c.height/-2,ref:(0,a.Z)([u,r])},t))}))},1715:function(e,t,r){"use strict";r.d(t,{q:function(){return a}});var n=r(6173),i=r(7378),o=r(1403);function a({all:e,scene:t,camera:r}){const a=(0,o.useThree)((({gl:e})=>e)),s=(0,o.useThree)((({camera:e})=>e)),l=(0,o.useThree)((({scene:e})=>e));return i.useLayoutEffect((()=>{const i=[];e&&(t||l).traverse((e=>{!1===e.visible&&(i.push(e),e.visible=!0)})),a.compile(t||l,r||s);const o=new n.WebGLCubeRenderTarget(128);new n.CubeCamera(.01,1e5,o).update(a,t||l),o.dispose(),i.forEach((e=>e.visible=!1))}),[]),null}},7129:function(e,t,r){"use strict";r.d(t,{A:function(){return a}});var n=r(7378),i=r(6173),o=r(1403);function a(e,t){const r=(0,o.useThree)((e=>e.mouse)),[a]=n.useState((()=>{const n=new i.Raycaster;return t&&(0,o.applyProps)(n,t,{}),function(t,o){n.setFromCamera(r,e instanceof i.Camera?e:e.current);const a=this.constructor.prototype.raycast.bind(this);a&&a(n,o)}}));return a}},9741:function(e,t,r){"use strict";r.r(t),r.d(t,{AdaptiveDpr:function(){return as},AdaptiveEvents:function(){return ss},ArcballControls:function(){return gr},Backdrop:function(){return Ko},BakeShadows:function(){return es},Billboard:function(){return ze},Bounds:function(){return Oo},Box:function(){return po},CameraShake:function(){return Vo},Center:function(){return Do},Circle:function(){return mo},Cloud:function(){return ua},Cone:function(){return go},ContactShadows:function(){return Xo},CubeCamera:function(){return or},CubicBezierLine:function(){return Je},CurveModifier:function(){return $i},CycleRaycast:function(){return v},Cylinder:function(){return Ao},Detailed:function(){return Ka},DeviceOrientationControls:function(){return sr},Dodecahedron:function(){return Io},Edges:function(){return rr},Effects:function(){return Yt},Environment:function(){return Ho},Extrude:function(){return Bo},FirstPersonControls:function(){return Tr},Float:function(){return Go},FlyControls:function(){return cr},GizmoHelper:function(){return Mr.I},GizmoViewcube:function(){return Vr},GizmoViewport:function(){return Gr.f},GradientTexture:function(){return Jt},Html:function(){return A},Icosahedron:function(){return To},Image:function(){return tr},Instance:function(){return Ga},Instances:function(){return za},IsObject:function(){return Kt},Lathe:function(){return _o},Line:function(){return Ze},Loader:function(){return E},MapControls:function(){return hr},Merged:function(){return ja},MeshDistortMaterial:function(){return to},MeshReflectorMaterial:function(){return so},MeshWobbleMaterial:function(){return no},Octahedron:function(){return Mo},OrbitControls:function(){return dr},OrthographicCamera:function(){return nr.i},PerspectiveCamera:function(){return ir},Plane:function(){return yo},Point:function(){return Sa},PointMaterial:function(){return co},PointMaterialImpl:function(){return lo},PointerLockControls:function(){return Er},Points:function(){return Ma},PointsBuffer:function(){return Ta},Polyhedron:function(){return So},PositionalAudio:function(){return qe},Preload:function(){return $a.q},PresentationControls:function(){return Oe},QuadraticBezierLine:function(){return Ye},Reflector:function(){return ea},Ring:function(){return Eo},RoundedBox:function(){return Po},ScreenQuad:function(){return Lo},Scroll:function(){return P},ScrollControls:function(){return B},Segment:function(){return qa},Segments:function(){return Ya},Select:function(){return Ve},Shadow:function(){return $o},Sky:function(){return aa},Sphere:function(){return vo},SpotLight:function(){return na},Stage:function(){return Jo},Stars:function(){return ca},Stats:function(){return on},Tetrahedron:function(){return Co},Text:function(){return zt},Torus:function(){return bo},TorusKnot:function(){return wo},TrackballControls:function(){return pr},TransformControls:function(){return wr},Tube:function(){return xo},calcPosFromAngles:function(){return oa},isWebGL2Available:function(){return Xt},meshBounds:function(){return os},shaderMaterial:function(){return qt},softShadows:function(){return ho},useAnimations:function(){return Ji},useAspect:function(){return ln},useBVH:function(){return Xi},useBounds:function(){return Uo},useCamera:function(){return cn.A},useContextBridge:function(){return Yi},useCubeTexture:function(){return zr},useCursor:function(){return y},useDepthBuffer:function(){return sn},useDetectGPU:function(){return xn},useFBO:function(){return an},useFBX:function(){return Hr},useGLTF:function(){return qr},useGizmoContext:function(){return Mr.L},useHelper:function(){return bn},useIntersect:function(){return qi},useKTX2:function(){return en},useMatcapTexture:function(){return ha},useNormalTexture:function(){return da},useProgress:function(){return w},useScroll:function(){return I},useSelect:function(){return Ge},useTexture:function(){return $t}});var n=r(5773),i=r(7378),o=r(1542),a=r(6173),s=r(1403);const l=new a.Vector3,c=new a.Vector3,u=new a.Vector3;function h(e,t,r){const n=l.setFromMatrixPosition(e.matrixWorld);n.project(t);const i=r.width/2,o=r.height/2;return[n.x*i+i,-n.y*o+o]}const d=e=>Math.abs(e)<1e-10?0:e;function f(e,t,r=""){let n="matrix3d(";for(let i=0;16!==i;i++)n+=d(t[i]*e.elements[i])+(15!==i?",":")");return r+n}const p=(m=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>f(e,m));var m;const g=(e,t)=>{return f(e,[1/(r=t),1/r,1/r,1,-1/r,-1/r,-1/r,-1,1/r,1/r,1/r,1,1,1,1,1],"translate(-50%,-50%)");var r},A=i.forwardRef((({children:e,eps:t=.001,style:r,className:f,prepend:m,center:A,fullscreen:v,portal:y,distanceFactor:x,sprite:b=!1,transform:w=!1,occlude:C,onOcclude:E,zIndexRange:S=[16777271,0],calculatePosition:T=h,as:M="div",wrapperClass:I,pointerEvents:B="auto",..._},F)=>{var P;const R=(0,s.useThree)((({gl:e})=>e)),L=(0,s.useThree)((({camera:e})=>e)),D=(0,s.useThree)((({scene:e})=>e)),N=(0,s.useThree)((({size:e})=>e)),k=(0,s.useThree)((({raycaster:e})=>e)),[O]=i.useState((()=>document.createElement(M))),U=i.useRef(null),Q=i.useRef(0),V=i.useRef([0,0]),G=i.useRef(null),z=i.useRef(null),j=null!==(P=null==y?void 0:y.current)&&void 0!==P?P:R.domElement.parentNode;i.useEffect((()=>{if(U.current){if(D.updateMatrixWorld(),w)O.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const e=T(U.current,L,N);O.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return j&&(m?j.prepend(O):j.appendChild(O)),()=>{j&&j.removeChild(O),o.unmountComponentAtNode(O)}}}),[j,w]),i.useLayoutEffect((()=>{I&&(O.className=I)}),[I]);const H=i.useMemo((()=>w?{position:"absolute",top:0,left:0,width:N.width,height:N.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:A?"translate3d(-50%,-50%,0)":"none",...v&&{top:-N.height/2,left:-N.width/2,width:N.width,height:N.height},...r}),[r,A,v,N,w]),W=i.useMemo((()=>({position:"absolute",pointerEvents:B})),[B]);i.useLayoutEffect((()=>{w?o.render(i.createElement("div",{ref:G,style:H},i.createElement("div",{ref:z,style:W},i.createElement("div",{ref:F,className:f,style:r,children:e}))),O):o.render(i.createElement("div",{ref:F,style:H,className:f,children:e}),O)}));const Z=i.useRef(!0);return(0,s.useFrame)((()=>{if(U.current){L.updateMatrixWorld(),U.current.updateWorldMatrix(!0,!1);const e=w?V.current:T(U.current,L,N);if(w||Math.abs(Q.current-L.zoom)>t||Math.abs(V.current[0]-e[0])>t||Math.abs(V.current[1]-e[1])>t){const t=function(e,t){const r=l.setFromMatrixPosition(e.matrixWorld),n=c.setFromMatrixPosition(t.matrixWorld),i=r.sub(n),o=t.getWorldDirection(u);return i.angleTo(o)>Math.PI/2}(U.current,L);let r=!1;"boolean"===typeof C?!0===C&&(r=[D]):Array.isArray(C)&&(r=C.map((e=>e.current)));const n=Z.current;if(r){const e=function(e,t,r,n){const i=l.setFromMatrixPosition(e.matrixWorld),o=i.clone();o.project(t),r.setFromCamera(o,t);const a=r.intersectObjects(n,!0);if(a.length){const e=a[0].distance;return i.distanceTo(r.ray.origin)<e}return!0}(U.current,L,k,r);Z.current=e&&!t}else Z.current=!t;if(n!==Z.current&&(E?E(!Z.current):O.style.display=Z.current?"block":"none"),O.style.zIndex=`${function(e,t,r){if(t instanceof a.PerspectiveCamera||t instanceof a.OrthographicCamera){const n=l.setFromMatrixPosition(e.matrixWorld),i=c.setFromMatrixPosition(t.matrixWorld),o=n.distanceTo(i),a=(r[1]-r[0])/(t.far-t.near),s=r[1]-a*t.far;return Math.round(a*o+s)}}(U.current,L,S)}`,w){const[e,t]=[N.width/2,N.height/2],r=L.projectionMatrix.elements[5]*t,{isOrthographicCamera:n,top:i,left:o,bottom:a,right:s}=L,l=p(L.matrixWorldInverse),c=n?`scale(${r})translate(${d(-(s+o)/2)}px,${d((i+a)/2)}px)`:`translateZ(${r}px)`;let u=U.current.matrixWorld;b&&(u=L.matrixWorldInverse.clone().transpose().copyPosition(u).scale(U.current.scale),u.elements[3]=u.elements[7]=u.elements[11]=0,u.elements[15]=1),O.style.width=N.width+"px",O.style.height=N.height+"px",O.style.perspective=n?"":`${r}px`,G.current&&z.current&&(G.current.style.transform=`${c}${l}translate(${e}px,${t}px)`,z.current.style.transform=g(u,1/((x||10)/400)))}else{const t=void 0===x?1:function(e,t){if(t instanceof a.OrthographicCamera)return t.zoom;if(t instanceof a.PerspectiveCamera){const r=l.setFromMatrixPosition(e.matrixWorld),n=c.setFromMatrixPosition(t.matrixWorld),i=t.fov*Math.PI/180,o=r.distanceTo(n);return 1/(2*Math.tan(i/2)*o)}return 1}(U.current,L)*x;O.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}V.current=e,Q.current=L.zoom}}})),i.createElement("group",(0,n.Z)({},_,{ref:U}))}));function v({onChanged:e,portal:t,preventDefault:r=!0,scroll:n=!0,keyCode:o=9}){const a=i.useRef(0),l=(0,s.useThree)((e=>e.raycaster)),c=(0,s.useThree)((e=>e.get)),u=(0,s.useThree)((e=>e.gl));return i.useEffect((()=>{var i;let s,h=[];const d=l.filter,f=null!==(i=null==t?void 0:t.current)&&void 0!==i?i:u.domElement.parentNode,p=()=>f&&e&&e(h,Math.round(a.current)%h.length);l.filter=(e,t)=>{let r=[...e];r.length===h.length&&h.every((e=>r.map((e=>e.object.uuid)).includes(e.object.uuid)))||(a.current=0,h=r,p()),d&&(r=d(r,t));for(let n=0;n<Math.round(a.current)%r.length;n++){const e=r.shift();r=[...r,e]}return r};const m=e=>{var t,r;a.current=e(a.current),null==(t=c().events.handlers)||t.onPointerCancel(void 0),null==(r=c().events.handlers)||r.onPointerMove(s),p()},g=e=>{(e.keyCode||e.which===o)&&(r&&e.preventDefault(),h.length>1&&m((e=>e+1)))},A=e=>{r&&e.preventDefault();let t=0;e||(e=window.event),e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),h.length>1&&m((e=>Math.abs(e-t)))},v=e=>s=e;return document.addEventListener("pointermove",v,{passive:!0}),n&&document.addEventListener("wheel",A),void 0!==o&&document.addEventListener("keydown",g),()=>{l.filter=d,void 0!==o&&document.removeEventListener("keydown",g),n&&document.removeEventListener("wheel",A),document.removeEventListener("pointermove",v)}}),[u,c,l,r,n,o]),null}function y(e,t="pointer",r="auto"){i.useEffect((()=>{if(e)return document.body.style.cursor=t,()=>{document.body.style.cursor=r}}),[e])}var x=r(8555);let b=0;const w=(0,x.default)((e=>(a.DefaultLoadingManager.onStart=(t,r,n)=>{e({active:!0,item:t,loaded:r,total:n,progress:(r-b)/(n-b)*100})},a.DefaultLoadingManager.onLoad=()=>{e({active:!1})},a.DefaultLoadingManager.onError=t=>e((e=>({errors:[...e.errors,t]}))),a.DefaultLoadingManager.onProgress=(t,r,n)=>{r===n&&(b=n),e({active:!0,item:t,loaded:r,total:n,progress:(r-b)/(n-b)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}))),C=e=>`Loading ${e.toFixed(2)}%`;function E({containerStyles:e,innerStyles:t,barStyles:r,dataStyles:n,dataInterpolation:o=C,initialState:a=(e=>e)}){const{active:s,progress:l}=w(),c=i.useRef(0),u=i.useRef(0),h=i.useRef(null),[d,f]=i.useState(a(s));i.useEffect((()=>{let e;return s!==d&&(e=setTimeout((()=>f(s)),300)),()=>clearTimeout(e)}),[d,s]);const p=i.useCallback((()=>{h.current&&(c.current+=(l-c.current)/2,(c.current>.95*l||100===l)&&(c.current=l),h.current.innerText=o(c.current),c.current<l&&(u.current=requestAnimationFrame(p)))}),[o,l]);return i.useEffect((()=>(p(),()=>cancelAnimationFrame(u.current))),[p]),d?i.createElement("div",{style:{...S.container,opacity:s?1:0,...e}},i.createElement("div",null,i.createElement("div",{style:{...S.inner,...t}},i.createElement("div",{style:{...S.bar,transform:`scaleX(${l/100})`,...r}}),i.createElement("span",{ref:h,style:{...S.data,...n}})))):null}const S={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};var T=r(5324);const M=i.createContext(null);function I(){return i.useContext(M)}function B({eps:e=1e-5,enabled:t=!0,infinite:r,horizontal:n,pages:o=1,distance:l=1,damping:c=4,style:u={},children:h}){const{gl:d,size:f,invalidate:p,events:m,raycaster:g}=(0,s.useThree)(),[A]=i.useState((()=>document.createElement("div"))),[v]=i.useState((()=>document.createElement("div"))),[y]=i.useState((()=>document.createElement("div"))),x=d.domElement.parentNode,b=i.useRef(0),w=i.useMemo((()=>({el:A,eps:e,fill:v,fixed:y,horizontal:n,damping:c,offset:0,delta:0,scroll:b,pages:o,range(e,t,r=0){const n=e-r,i=n+t+2*r;return this.offset<n?0:this.offset>i?1:(this.offset-n)/(i-n)},curve(e,t,r=0){return Math.sin(this.range(e,t,r)*Math.PI)},visible(e,t,r=0){const n=e-r,i=n+t+2*r;return this.offset>=n&&this.offset<=i}})),[e,c,n,o]);i.useEffect((()=>{A.style.position="absolute",A.style.width="100%",A.style.height="100%",A.style[n?"overflowX":"overflowY"]="auto",A.style[n?"overflowY":"overflowX"]="hidden",A.style.top="0px",A.style.left="0px";for(const r in u)A.style[r]=u[r];y.style.position="sticky",y.style.top="0px",y.style.left="0px",y.style.width="100%",y.style.height="100%",y.style.overflow="hidden",A.appendChild(y),v.style.height=n?"100%":o*l*100+"%",v.style.width=n?o*l*100+"%":"100%",v.style.pointerEvents="none",A.appendChild(v),x.appendChild(A),A[n?"scrollLeft":"scrollTop"]=1;const e="boolean"!==typeof m.connected?m.connected:d.domElement;requestAnimationFrame((()=>null==m.connect?void 0:m.connect(A)));const t=g.computeOffsets;return g.computeOffsets=({clientX:e,clientY:t})=>({offsetX:e-x.offsetLeft,offsetY:t-x.offsetTop}),()=>{x.removeChild(A),g.computeOffsets=t,null==m.connect||m.connect(e)}}),[o,l,n,A,v,y,x]),i.useEffect((()=>{const e=f[n?"width":"height"],i=A[n?"scrollWidth":"scrollHeight"],o=i-e;let a=0,s=!0,l=!0;const c=()=>{if(t&&!l&&(p(),a=A[n?"scrollLeft":"scrollTop"],b.current=a/o,r)){if(!s)if(a>=o){const e=1-w.offset;A[n?"scrollLeft":"scrollTop"]=1,b.current=w.offset=-e,s=!0}else if(a<=0){const e=1+w.offset;A[n?"scrollLeft":"scrollTop"]=i,b.current=w.offset=e,s=!0}s&&setTimeout((()=>s=!1),40)}};A.addEventListener("scroll",c,{passive:!0}),requestAnimationFrame((()=>l=!1));const u=e=>A.scrollLeft+=e.deltaY/2;return n&&A.addEventListener("wheel",u,{passive:!0}),()=>{A.removeEventListener("scroll",c),n&&A.removeEventListener("wheel",u)}}),[A,f,r,w,p,n]);let C=0;return(0,s.useFrame)(((t,r)=>{w.offset=a.MathUtils.damp(C=w.offset,b.current,c,r),w.delta=a.MathUtils.damp(w.delta,Math.abs(C-w.offset),c,r),w.delta>e&&p()})),i.createElement(M.Provider,{value:w},h)}const _=i.forwardRef((({children:e},t)=>{const r=i.useRef(null),n=I(),{width:o,height:a}=(0,s.useThree)((e=>e.viewport));return(0,s.useFrame)((()=>{r.current.position.x=n.horizontal?-o*(n.pages-1)*n.offset:0,r.current.position.y=n.horizontal?0:a*(n.pages-1)*n.offset})),i.createElement("group",{ref:(0,T.Z)([t,r])},e)})),F=i.forwardRef((({children:e,style:t,...r},a)=>{const l=I(),c=i.useRef(null),{width:u,height:h}=(0,s.useThree)((e=>e.size)),d=i.useContext(s.context);return(0,s.useFrame)((()=>{l.delta>l.eps&&(c.current.style.transform=`translate3d(${l.horizontal?-u*(l.pages-1)*l.offset:0}px,${l.horizontal?0:h*(l.pages-1)*-l.offset}px,0)`)})),o.render(i.createElement("div",(0,n.Z)({ref:(0,T.Z)([a,c]),style:{...t,position:"absolute",top:0,left:0,willChange:"transform"}},r),i.createElement(M.Provider,{value:l},i.createElement(s.context.Provider,{value:d},e))),l.fixed),null})),P=i.forwardRef((({html:e,...t},r)=>{const o=e?F:_;return i.createElement(o,(0,n.Z)({ref:r},t))}));var R=r(3637);const L={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function D(e,t,r){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*r):e*t*r/(t+r*e)}function N(e,t,r,n=.15){return 0===n?function(e,t,r){return Math.max(t,Math.min(e,r))}(e,t,r):e<t?-D(t-e,r-t,n)+t:e>r?+D(e-r,r-t,n)+r:e}function k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){k(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const Q={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function V(e){return e?e[0].toUpperCase()+e.slice(1):""}function G(e){return"touches"in e}function z(e){return G(e)?function(e){return"touchend"===e.type?e.changedTouches:e.targetTouches}(e)[0]:e}function j(e,t){const r=t.clientX-e.clientX,n=t.clientY-e.clientY,i=(t.clientX+e.clientX)/2,o=(t.clientY+e.clientY)/2,a=Math.hypot(r,n);return{angle:-180*Math.atan2(r,n)/Math.PI,distance:a,origin:[i,o]}}function H(e){return function(e){return Array.from(e.touches).filter((t=>{var r,n;return t.target===e.currentTarget||(null===(r=e.currentTarget)||void 0===r||null===(n=r.contains)||void 0===n?void 0:n.call(r,t.target))}))}(e).map((e=>e.identifier))}function W(e,t){const[r,n]=Array.from(e.touches).filter((e=>t.includes(e.identifier)));return j(r,n)}function Z(e){const t=z(e);return G(e)?t.identifier:t.pointerId}function X(e){const t=z(e);return[t.clientX,t.clientY]}function Y(e){let{deltaX:t,deltaY:r,deltaMode:n}=e;return 1===n?(t*=40,r*=40):2===n&&(t*=800,r*=800),[t,r]}function J(e,...t){return"function"===typeof e?e(...t):e}function q(){}function K(...e){return 0===e.length?q:1===e.length?e[0]:function(){let t;for(const r of e)t=r.apply(this,arguments)||t;return t}}function $(e,t){return Object.assign({},t,e||{})}class ee{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:r,args:n}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=n,e.axis=void 0,e.memo=void 0,e.elapsedTime=0,e.direction=[0,0],e.distance=[0,0],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?J(r.from,t):t.offset,t.offset=t.lastOffset),t.startTime=t.timeStamp=e.timeStamp}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:r,shared:n}=this;t.args=this.args;let i=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,n.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,n.locked=!!document.pointerLockElement,Object.assign(n,function(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:r,altKey:n,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:r,altKey:n,metaKey:i,ctrlKey:o})}return t}(e)),n.down=n.pressed=n.buttons%2===1||n.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const e=t._delta.map(Math.abs);L.addTo(t._distance,e)}const[o,a]=t._movement,[s,l]=r.threshold,{_step:c,values:u}=t;if(r.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(o)>=s&&u[0]),!1===c[1]&&(c[1]=Math.abs(a)>=l&&u[1])):(!1===c[0]&&(c[0]=Math.abs(o)>=s&&Math.sign(o)*s),!1===c[1]&&(c[1]=Math.abs(a)>=l&&Math.sign(a)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;const h=[0,0];if(r.hasCustomTransform){const[e,t]=u;h[0]=!1!==c[0]?e-c[0]:0,h[1]=!1!==c[1]?t-c[1]:0}else h[0]=!1!==c[0]?o-c[0]:0,h[1]=!1!==c[1]?a-c[1]:0;if(this.intent&&this.intent(h),(t._active&&!t._blocked||t.active)&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=n[this.ingKey]=t._active,e)){t.first&&("bounds"in r&&(t._bounds=J(r.bounds,t)),this.setup&&this.setup()),t.movement=h;const e=t.offset;if(this.computeOffset(),!t.last||i>32){t.delta=L.sub(t.offset,e);const r=t.delta.map(Math.abs);L.addTo(t.distance,r),t.direction=t.delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[r[0]/i,r[1]/i])}}const d=t._active&&r.rubberband||[0,0];t.offset=function(e,[t,r],[n,i]){const[[o,a],[s,l]]=e;return[N(t,o,a,n),N(r,s,l,i)]}(t._bounds,t.offset,d),this.computeMovement()}emit(){const e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const n=this.handler(U(U(U({},t),e),{},{[this.aliasKey]:e.values}));void 0!==n&&(e.memo=n)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class te extends ee{constructor(...e){super(...e),k(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=L.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=L.sub(this.state.offset,this.state.lastOffset)}intent(e){this.state.axis=this.state.axis||function([e,t]){const r=Math.abs(e)-Math.abs(t);return r>0?"x":r<0?"y":void 0}(e),this.state._blocked=(this.config.lockDirection||!!this.config.axis)&&!this.state.axis||!!this.config.axis&&this.config.axis!==this.state.axis,this.state._blocked||(this.config.axis||this.config.lockDirection)&&function(e,t){switch(t){case"x":e[1]=0;break;case"y":e[0]=0}}(e,this.state.axis)}}const re=e=>e,ne={enabled:(e=!0)=>e,preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return L.toVector(e)}},from:e=>"function"===typeof e?e:null!=e?L.toVector(e):void 0,transform(e,t,r){const n=e||r.shared.transform;return this.hasCustomTransform=!!n,n||re},threshold:e=>L.toVector(e,0)};const ie=U(U({},ne),{},{axis(e,t,{axis:r}){if(this.lockDirection="lock"===r,!this.lockDirection)return r},bounds(e={}){if("function"===typeof e)return t=>ie.bounds(e(t));if("current"in e)return()=>e.current;if("function"===typeof HTMLElement&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:r=1/0,top:n=-1/0,bottom:i=1/0}=e;return[[t,r],[n,i]]}}),oe={ArrowRight:(e=1)=>[10*e,0],ArrowLeft:(e=1)=>[-10*e,0],ArrowUp:(e=1)=>[0,-10*e],ArrowDown:(e=1)=>[0,10*e]};const ae="undefined"!==typeof window&&window.document&&window.document.createElement;function se(){return ae&&"ontouchstart"in window}const le={isBrowser:ae,gesture:function(){try{return"constructor"in GestureEvent}catch(un){return!1}}(),touch:se(),touchscreen:se()||ae&&window.navigator.maxTouchPoints>1,pointer:ae&&"onpointerdown"in window,pointerLock:ae&&"exitPointerLock"in window.document},ce=U(U({},ie),{},{pointerLock(e,t,{pointer:{lock:r=!1,touch:n=!1}={}}){return this.useTouch=le.touch&&n,le.pointerLock&&r},device(e,t){return this.useTouch?"touch":this.pointerLock?"mouse":le.pointer?"pointer":le.touch?"touch":"mouse"},preventScroll(e=!1,t,{preventScrollAxis:r="y"}){return r&&(this.preventScrollAxis=r),!!le.touchscreen&&("number"===typeof e?e:!!e&&250)},pointerCapture(e,t,{pointer:{capture:r=!0,buttons:n=1}={}}){return this.pointerButtons=n,!this.pointerLock&&"pointer"===this.device&&r},threshold(e,t,{filterTaps:r=!1,axis:n}){const i=L.toVector(e,r?3:n?1:0);return this.filterTaps=r,i},swipe({velocity:e=.5,distance:t=50,duration:r=250}={}){return{velocity:this.transform(L.toVector(e)),distance:this.transform(L.toVector(t)),duration:r}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}}});const ue=U(U({},ne),{},{useTouch:(e,t,{pointer:{touch:r=!1}={}})=>le.touch&&r,device(e,t,r){if(r.shared.target&&!le.touch&&le.gesture)return"gesture";if(this.useTouch)return"touch";if(le.touchscreen){if(le.pointer)return"pointer";if(le.touch)return"touch"}},bounds(e,t,{scaleBounds:r={},angleBounds:n={}}){const i=e=>{const t=$(J(r,e),{min:-1/0,max:1/0});return[t.min,t.max]},o=e=>{const t=$(J(n,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!==typeof r&&"function"!==typeof n?[i(),o()]:e=>[i(e),o(e)]},threshold(e,t,r){this.lockDirection="lock"===r.axis;return L.toVector(e,this.lockDirection?[.1,3]:0)}});const he=U(U({},ie),{},{mouseOnly:(e=!0)=>e});const de=ie;const fe=ie;const pe=U(U({},ie),{},{mouseOnly:(e=!0)=>e}),me=new Map,ge=new Map;function Ae(e){me.set(e.key,e.engine),ge.set(e.key,e.resolver)}const ve={key:"drag",engine:class extends te{constructor(...e){super(...e),k(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),n={left:t.left-r.left+e.offset[0],right:t.right-r.right+e.offset[0],top:t.top-r.top+e.offset[1],bottom:t.bottom-r.bottom+e.offset[1]};e._bounds=ie.bounds(n)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout((()=>{this.compute(),this.emit()}),0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,r=this.state;(null==e.buttons||(Array.isArray(t.pointerButtons)?t.pointerButtons.includes(e.buttons):-1===t.pointerButtons||t.pointerButtons===e.buttons))&&(this.ctrl.setEventIds(e),t.pointerCapture&&e.target.setPointerCapture(e.pointerId),r._pointerActive||(this.start(e),this.setupPointer(e),r._pointerId=Z(e),r._pointerActive=!0,this.computeValues(X(e)),this.computeInitial(),t.preventScroll?this.setupScrollPrevention(e):t.delay>0?this.setupDelayTrigger(e):this.startPointerDrag(e)))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,r=this.config;if(!t._pointerActive)return;if(t.type===e.type&&e.timeStamp===t.timeStamp)return;const n=Z(e);if(t._pointerId&&n!==t._pointerId)return;const i=X(e);return document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=L.sub(i,t._values),this.computeValues(i)),L.addTo(t._movement,t._delta),this.compute(e),t._delayed?(this.timeoutStore.remove("dragDelay"),t.active=!1,void this.startPointerDrag(e)):r.preventScroll&&!t._preventScroll?t.axis?t.axis===r.preventScrollAxis||"xy"===r.preventScrollAxis?(t._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(e)):void 0:void this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(a){0}const t=this.state,r=this.config;if(!t._pointerActive)return;const n=Z(e);if(t._pointerId&&n!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[i,o]=t._distance;if(t.tap=i<=3&&o<=3,t.tap&&r.filterTaps)t._force=!0;else{const[e,n]=t.direction,[i,o]=t.velocity,[a,s]=t.movement,[l,c]=r.swipe.velocity,[u,h]=r.swipe.distance,d=r.swipe.duration;t.elapsedTime<d&&(Math.abs(i)>l&&Math.abs(a)>u&&(t.swipe[0]=e),Math.abs(o)>c&&Math.abs(s)>h&&(t.swipe[1]=n))}this.emit()}pointerClick(e){this.state.tap||(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config;let r=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){!function(e){"persist"in e&&"function"===typeof e.persist&&e.persist()}(e),this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1}),this.eventStore.add(this.sharedConfig.window,"touch","end",this.clean.bind(this),{passive:!1}),this.eventStore.add(this.sharedConfig.window,"touch","cancel",this.clean.bind(this),{passive:!1}),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScroll,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",this.startPointerDrag.bind(this),this.config.delay,e)}keyDown(e){const t=oe[e.key];if(t){const r=this.state,n=e.shiftKey?10:e.altKey?.1:1;r._delta=t(n),this.start(e),r._keyboardActive=!0,L.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in oe&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this))),e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this)),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0})}},resolver:ce},ye={key:"hover",engine:class extends te{constructor(...e){super(...e),k(this,"ingKey","hovering")}enter(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.start(e),this.computeValues(X(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&"mouse"!==e.pointerType)return;const t=this.state;if(!t._active)return;t._active=!1;const r=X(e);t._movement=t._delta=L.sub(r,t._values),this.computeValues(r),this.compute(e),t.delta=t.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}},resolver:pe},xe={key:"move",engine:class extends te{constructor(...e){super(...e),k(this,"ingKey","moving")}move(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(X(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;const t=X(e),r=this.state;r._delta=L.sub(t,r._values),L.addTo(r._movement,r._delta),this.computeValues(t),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}},resolver:he},be={key:"pinch",engine:class extends ee{constructor(...e){super(...e),k(this,"ingKey","pinching"),k(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:r}=this.state;this.state.offset="wheel"===e?L.add(t,r):[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}intent(e){const t=this.state;if(!t.axis){const r=30*Math.abs(e[0])-Math.abs(e[1]);r<0?t.axis="angle":r>0&&(t.axis="scale")}this.config.lockDirection&&("scale"===t.axis?e[1]=0:"angle"===t.axis&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout((()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()}),0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every((e=>r.has(e))))return;if(r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);const n=W(e,t._touchIds);this.pinchStart(e,n)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,r=t._pointerEvents,n=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every((e=>n.has(e))))return;if(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2)return;this.start(e);const i=j(...Array.from(r.values()));this.pinchStart(e,i)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=W(e,this.state._touchIds);this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const r=j(...Array.from(t.values()));this.pinchMove(e,r)}pinchMove(e,t){const r=this.state,n=r._values[1],i=t.angle-n;let o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([t.distance,t.angle-360*o]),r.origin=t.origin,r.turns=o,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some((e=>!this.ctrl.touchIds.has(e)))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(r){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=L.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){e.ctrlKey&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const t=this.state;t._delta=[-Y(e)[1]/36*t.offset[0],0],L.addTo(t._movement,t._delta),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t?(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this))):e("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:ue},we={key:"scroll",engine:class extends te{constructor(...e){super(...e),k(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const t=this.state,r=function(e){var t,r;const{scrollX:n,scrollY:i,scrollLeft:o,scrollTop:a}=e.currentTarget;return[null!==(t=null!==n&&void 0!==n?n:o)&&void 0!==t?t:0,null!==(r=null!==i&&void 0!==i?i:a)&&void 0!==r?r:0]}(e);t._delta=L.sub(r,t._values),L.addTo(t._movement,t._delta),this.computeValues(r),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}},resolver:de},Ce={key:"wheel",engine:class extends te{constructor(...e){super(...e),k(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=Y(e),L.addTo(this.state._movement,t._delta),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}},resolver:fe};function Ee(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}const Se={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=(le.isBrowser?window:void 0))=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},Te=["target","eventOptions","window","enabled","transform"];function Me(e={},t){const r={};for(const[n,i]of Object.entries(t))switch(typeof i){case"function":r[n]=i.call(r,e[n],n,e);break;case"object":r[n]=Me(e[n],i);break;case"boolean":i&&(r[n]=e[n])}return r}class Ie{constructor(e){k(this,"_listeners",[]),this._ctrl=e}add(e,t,r,n,i){const o=function(e,t=""){const r=Q[e];return e+(r&&r[t]||t)}(t,r),a=U(U({},this._ctrl.config.shared.eventOptions),i);e.addEventListener(o,n,a),this._listeners.push((()=>e.removeEventListener(o,n,a)))}clean(){this._listeners.forEach((e=>e())),this._listeners=[]}}class Be{constructor(){k(this,"_timeouts",new Map)}add(e,t,r=140,...n){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...n))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach((e=>{window.clearTimeout(e)})),this._timeouts.clear()}}class _e{constructor(e){k(this,"gestures",new Set),k(this,"_targetEventStore",new Ie(this)),k(this,"gestureEventStores",{}),k(this,"gestureTimeoutStores",{}),k(this,"handlers",{}),k(this,"config",{}),k(this,"pointerIds",new Set),k(this,"touchIds",new Set),k(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(e,t){t.drag&&Fe(e,"drag");t.wheel&&Fe(e,"wheel");t.scroll&&Fe(e,"scroll");t.move&&Fe(e,"move");t.pinch&&Fe(e,"pinch");t.hover&&Fe(e,"hover")}(this,e)}setEventIds(e){G(e)?this.touchIds=new Set(H(e)):"pointerId"in e&&("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId))}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t){const r=e,{target:n,eventOptions:i,window:o,enabled:a,transform:s}=r,l=Ee(r,Te),c={shared:Me({target:n,eventOptions:i,window:o,enabled:a,transform:s},Se)};if(t){const e=ge.get(t);c[t]=Me(U({shared:c.shared},l),e)}else for(const u in l){const e=ge.get(u);e&&(c[u]=Me(U({shared:c.shared},l[u]),e))}return c}(e,t)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,r=t.eventOptions,n={};let i;if(t.target&&(i=t.target(),!i))return;const o=Pe(n,r,!!i);if(t.enabled){for(const t of this.gestures)if(this.config[t].enabled){new(me.get(t))(this,e,t).bind(o)}for(const t in this.nativeHandlers)o(t,"",(r=>this.nativeHandlers[t](U(U({},this.state.shared),{},{event:r,args:e}))),void 0,!0)}for(const a in n)n[a]=K(...n[a]);if(!i)return n;for(const a in n){let e=a.substr(2).toLowerCase();const t=!!~e.indexOf("capture"),r=!!~e.indexOf("passive");(t||r)&&(e=e.replace(/capture|passive/g,"")),this._targetEventStore.add(i,e,"",n[a],{capture:t,passive:r})}}}function Fe(e,t){e.gestures.add(t),e.gestureEventStores[t]=new Ie(e),e.gestureTimeoutStores[t]=new Be}const Pe=(e,t,r)=>(n,i,o,a={},s=!1)=>{var l,c;const u=null!==(l=a.capture)&&void 0!==l?l:t.capture,h=null!==(c=a.passive)&&void 0!==c?c:t.passive;let d=s?n:function(e,t="",r=!1){const n=Q[e],i=n&&n[t]||t;return"on"+V(e)+V(i)+(r?"Capture":"")}(n,i,u);r&&h&&(d+="Passive"),e[d]=e[d]||[],e[d].push(o)},Re=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Le(e,t,r,n,i,o){if(!e.has(r))return;if(!me.has(n))return void 0;const a=r+"Start",s=r+"End";i[n]=e=>{let n;return e.first&&a in t&&t[a](e),r in t&&(n=t[r](e)),e.last&&s in t&&t[s](e),n},o[n]=o[n]||{}}function De(e,t){const[r,n,i]=function(e){const t={},r={},n=new Set;for(let i in e)Re.test(i)?(n.add(RegExp.lastMatch),r[i]=e[i]):t[i]=e[i];return[r,t,n]}(e),o={};return Le(i,r,"onDrag","drag",o,t),Le(i,r,"onWheel","wheel",o,t),Le(i,r,"onScroll","scroll",o,t),Le(i,r,"onPinch","pinch",o,t),Le(i,r,"onMove","move",o,t),Le(i,r,"onHover","hover",o,t),{handlers:o,config:t,nativeHandlers:n}}function Ne(e,t={},r,n){const o=i.useMemo((()=>new _e(e)),[]);if(o.applyHandlers(e,n),o.applyConfig(t,r),i.useEffect(o.effect.bind(o)),i.useEffect((()=>o.clean.bind(o)),[]),void 0===t.target)return o.bind.bind(o)}function ke(e,t={}){return([ve,be,we,Ce,xe,ye].forEach(Ae),function(e,t={}){const{handlers:r,nativeHandlers:n,config:i}=De(e,t);return Ne(r,i,void 0,n)})(e,t)}function Oe({snap:e,global:t,cursor:r=!0,children:o,speed:l=1,rotation:c=[0,0,0],zoom:u=1,polar:h=[0,Math.PI/2],azimuth:d=[-1/0,1/0],config:f={mass:1,tension:170,friction:26}}){const{size:p,gl:m}=(0,s.useThree)(),g=i.useMemo((()=>[c[0]+h[0],c[0]+h[1]]),[c[0],h[0],h[1]]),A=i.useMemo((()=>[c[1]+d[0],c[1]+d[1]]),[c[1],d[0],d[1]]),v=i.useMemo((()=>[a.MathUtils.clamp(c[0],...g),a.MathUtils.clamp(c[1],...A),c[2]]),[c[0],c[1],c[2],g,A]),[y,x]=(0,R.useSpring)((()=>({scale:1,rotation:v,config:f})));i.useEffect((()=>{x.start({scale:1,rotation:v,config:f})}),[v]),i.useEffect((()=>{t&&r&&(m.domElement.style.cursor="grab")}),[t,r,m.domElement]);const b=ke({onHover:({last:e})=>{r&&!t&&(m.domElement.style.cursor=e?"auto":"grab")},onDrag:({down:t,delta:[n,i],memo:[o,s]=y.rotation.animation.to||v})=>{r&&(m.domElement.style.cursor=t?"grabbing":"grab"),n=a.MathUtils.clamp(s+n/p.width*Math.PI*l,...A),i=a.MathUtils.clamp(o+i/p.height*Math.PI*l,...g);const c=e&&!t&&"boolean"!==typeof e?e:f;return x.start({scale:t&&i>g[1]/2?u:1,rotation:e&&!t?v:[i,n,0],config:e=>"scale"===e?{...c,friction:3*c.friction}:c}),[i,n]}},{target:t?m.domElement:void 0});return i.createElement(R.a.group,(0,n.Z)({},null==b?void 0:b(),y),o)}var Ue=r(6723);const Qe=i.createContext([]);function Ve({box:e,multiple:t,children:r,onChange:o,border:l="1px solid #55aaff",backgroundColor:c="rgba(75, 160, 255, 0.1)",filter:u=(e=>e),...h}){const{camera:d,raycaster:f,gl:p,controls:m,size:g,get:A}=(0,s.useThree)(),[v,y]=i.useState(!1),[x,b]=i.useReducer(((e,{object:t,shift:r})=>void 0===t?[]:Array.isArray(t)?t:r?e.includes(t)?e.filter((e=>e!==t)):[t,...e]:e[0]===t?[]:[t]),[]);i.useEffect((()=>{null==o||o(x)}),[x]);const w=i.useCallback((e=>{e.stopPropagation(),b({object:u([e.object])[0],shift:t&&e.shiftKey})}),[]),C=i.useCallback((e=>!v&&b({})),[v]),E=i.useRef(null);return i.useEffect((()=>{if(!e||!t)return;const r=new Ue.M(d,E.current),n=document.createElement("div");n.style.pointerEvents="none",n.style.border=l,n.style.backgroundColor=c,n.style.position="fixed";const i=new a.Vector2,o=new a.Vector2,s=new a.Vector2,h=f.enabled,v=null==m?void 0:m.enabled;let y=!1;function x(e,t){var r;const{offsetX:n,offsetY:i}=null!==(r=null==f.computeOffsets?void 0:f.computeOffsets(e,A()))&&void 0!==r?r:e,{width:o,height:a}=g;t.set(n/o*2-1,-i/a*2+1)}function w(e){e.shiftKey&&(!function(e){var t;m&&(m.enabled=!1),f.enabled=!1,y=!0,null==(t=p.domElement.parentElement)||t.appendChild(n),n.style.left=`${e.clientX}px`,n.style.top=`${e.clientY}px`,n.style.width="0px",n.style.height="0px",i.x=e.clientX,i.y=e.clientY}(e),x(e,r.startPoint))}let C=[];function S(e){if(y){!function(e){s.x=Math.max(i.x,e.clientX),s.y=Math.max(i.y,e.clientY),o.x=Math.min(i.x,e.clientX),o.y=Math.min(i.y,e.clientY),n.style.left=`${o.x}px`,n.style.top=`${o.y}px`,n.style.width=s.x-o.x+"px",n.style.height=s.y-o.y+"px"}(e),x(e,r.endPoint);const t=r.select().sort((e=>e.uuid)).filter((e=>e.isMesh));(function(e,t){if(Object.is(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(let n=0;n<r.length;n++)if(!Object.prototype.hasOwnProperty.call(t,r[n])||!Object.is(e[r[n]],t[r[n]]))return!1;return!0})(t,C)||(C=t,b({object:u(t)}))}}function T(e){y&&function(){var e;y&&(m&&(m.enabled=v),f.enabled=h,y=!1,null==(e=n.parentElement)||e.removeChild(n))}()}return document.addEventListener("pointerdown",w,{passive:!0}),document.addEventListener("pointermove",S,{passive:!0,capture:!0}),document.addEventListener("pointerup",T,{passive:!0}),()=>{document.removeEventListener("pointerdown",w),document.removeEventListener("pointermove",S),document.removeEventListener("pointerup",T)}}),[g,f,d,m,p]),i.createElement("group",(0,n.Z)({ref:E,onClick:w,onPointerOver:()=>y(!0),onPointerOut:()=>y(!1),onPointerMissed:C},h),i.createElement(Qe.Provider,{value:x},r))}function Ge(){return i.useContext(Qe)}const ze=i.forwardRef((function({follow:e=!0,lockX:t=!1,lockY:r=!1,lockZ:o=!1,...a},l){const c=i.useRef();return(0,s.useFrame)((({camera:n})=>{if(!e||!c.current)return;const i=c.current.rotation.clone();c.current.quaternion.copy(n.quaternion),t&&(c.current.rotation.x=i.x),r&&(c.current.rotation.y=i.y),o&&(c.current.rotation.z=i.z)})),i.createElement("group",(0,n.Z)({ref:(0,T.Z)([c,l])},a))}));var je=r(7180),He=r(2947),We=r(9280);const Ze=i.forwardRef((function({points:e,color:t="black",vertexColors:r,lineWidth:o,dashed:s,...l},c){const[u]=i.useState((()=>new je.w)),[h]=i.useState((()=>new He.Y)),[d]=i.useState((()=>new a.Vector2(512,512))),f=i.useMemo((()=>{const t=new We.L,n=e.map((e=>e instanceof a.Vector3?e.toArray():e));if(t.setPositions(n.flat()),r){const e=r.map((e=>e instanceof a.Color?e.toArray():e));t.setColors(e.flat())}return t}),[e,r]);return i.useLayoutEffect((()=>{u.computeLineDistances()}),[e,u]),i.useLayoutEffect((()=>{s?h.defines.USE_DASH="":delete h.defines.USE_DASH,h.needsUpdate=!0}),[s,h]),i.useEffect((()=>()=>f.dispose()),[f]),i.createElement("primitive",(0,n.Z)({object:u,ref:c},l),i.createElement("primitive",{object:f,attach:"geometry"}),i.createElement("primitive",(0,n.Z)({object:h,attach:"material",color:t,vertexColors:Boolean(r),resolution:d,linewidth:o,dashed:s},l)))})),Xe=new a.Vector3,Ye=i.forwardRef((function({start:e=[0,0,0],end:t=[0,0,0],mid:r,segments:o=20,...s},l){const c=i.useRef(null),[u]=i.useState((()=>new a.QuadraticBezierCurve3(void 0,void 0,void 0))),h=i.useCallback(((e,t,r,n=20)=>(e instanceof a.Vector3?u.v0.copy(e):u.v0.set(...e),t instanceof a.Vector3?u.v2.copy(t):u.v2.set(...t),r instanceof a.Vector3?u.v1.copy(r):u.v1.copy(u.v0.clone().add(u.v2.clone().sub(u.v0)).add(Xe.set(0,u.v0.y-u.v2.y,0))),u.getPoints(n))),[]);i.useLayoutEffect((()=>{c.current.setPoints=(e,t,r)=>{const n=h(e,t,r);c.current.geometry&&c.current.geometry.setPositions(n.map((e=>e.toArray())).flat())}}),[]);const d=i.useMemo((()=>h(e,t,r,o)),[e,t,r,o]);return i.createElement(Ze,(0,n.Z)({ref:(0,T.Z)([c,l]),points:d},s))})),Je=i.forwardRef((function({start:e,end:t,midA:r,midB:o,segments:s=20,...l},c){const u=i.useMemo((()=>{const n=e instanceof a.Vector3?e:new a.Vector3(...e),i=t instanceof a.Vector3?t:new a.Vector3(...t),l=r instanceof a.Vector3?r:new a.Vector3(...r),c=o instanceof a.Vector3?o:new a.Vector3(...o);return new a.CubicBezierCurve3(n,l,c,i).getPoints(s)}),[e,t,r,o,s]);return i.createElement(Ze,(0,n.Z)({ref:c,points:u},l))})),qe=i.forwardRef((({url:e,distance:t=1,loop:r=!0,autoplay:o,...l},c)=>{const u=i.useRef(),h=(0,s.useThree)((({camera:e})=>e)),[d]=i.useState((()=>new a.AudioListener)),f=(0,s.useLoader)(a.AudioLoader,e);return i.useEffect((()=>{const e=u.current;e&&(e.setBuffer(f),e.setRefDistance(t),e.setLoop(r),o&&!e.isPlaying&&e.play())}),[f,h,t,r]),i.useEffect((()=>{const e=u.current;return h.add(d),()=>{h.remove(d),e&&(e.isPlaying&&e.stop(),e.source&&e.source._connected&&e.disconnect())}}),[]),i.createElement("positionalAudio",(0,n.Z)({ref:(0,T.Z)([u,c]),args:[d]},l))}));r(4284);function Ke(){var e,t=0,r=[],n=0,i=0;var o=d((function(e){i||s(1,e)})),a=d((function(e){i||s(-1,e)}));function s(r,n){i++;var o=0;try{n===m&&f();var a=r>0&&h(n);a?a.call(n,d((function(e){o++,s(1,e)})),d((function(e){o++,s(-1,e)}))):(t=r,e=n,l())}catch(un){t||o||s(-1,un)}}function l(){n||(setTimeout(c,0),n=1)}function c(){var e=r;n=0,r=[],e.forEach(u)}function u(e){e()}function h(e){var t=e&&(p(e)||"object"===typeof e)&&e.then;return p(t)&&t}function d(e){var t=0;return function(){for(var r=[],n=arguments.length;n--;)r[n]=arguments[n];t++||e.apply(this,r)}}function f(){throw new TypeError("Chaining cycle detected")}var p=function(e){return"function"===typeof e},m={then:function(n,i){var o=Ke();return r.push((function(){var r=t>0?n:i;if(p(r))try{var a=r(e);a===o&&f();var s=h(a);s?s.call(a,o.resolve,o.reject):o.resolve(a)}catch(l){o.reject(l)}else o[t>0?"resolve":"reject"](e)})),t&&l(),o},resolve:o,reject:a};return m}function $e(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return{then:r.then.bind(r),resolve:e,reject:t}}Ke.all=$e.all=function(e){var t=0,r=[],n=et();return 0===e.length?n.resolve([]):e.forEach((function(i,o){var a=et();a.resolve(i),a.then((function(i){t++,r[o]=i,t===e.length&&n.resolve(r)}),n.reject)})),n};var et="function"===typeof Promise?$e:Ke;function tt(){var e=Object.create(null);function t(n,i){var o=n.id,a=n.name,s=n.dependencies;void 0===s&&(s=[]);var l=n.init;void 0===l&&(l=function(){});var c=n.getTransferables;if(void 0===c&&(c=null),!e[o])try{s=s.map((function(r){return r&&r.isWorkerModule&&(t(r,(function(e){if(e instanceof Error)throw e})),r=e[r.id].value),r})),l=r("<"+a+">.init",l),c&&(c=r("<"+a+">.getTransferables",c));var u=null;"function"===typeof l?u=l.apply(void 0,s):console.error("worker module init function failed to rehydrate"),e[o]={id:o,value:u,getTransferables:c},i(u)}catch(h){h&&h.noLog||console.error(h),i(h)}}function r(e,t){var r=void 0;self.troikaDefine=function(e){return r=e};var n=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(n)}catch(i){console.error(i)}return URL.revokeObjectURL(n),delete self.troikaDefine,r}self.addEventListener("message",(function(r){var n=r.data,i=n.messageId,o=n.action,a=n.data;try{"registerModule"===o&&t(a,(function(e){e instanceof Error?postMessage({messageId:i,success:!1,error:e.message}):postMessage({messageId:i,success:!0,result:{isCallable:"function"===typeof e}})})),"callModule"===o&&function(t,r){var n,i=t.id,o=t.args;e[i]&&"function"===typeof e[i].value||r(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var a=(n=e[i]).value.apply(n,o);a&&"function"===typeof a.then?a.then(s,(function(e){return r(e instanceof Error?e:new Error(""+e))})):s(a)}catch(l){r(l)}function s(t){try{var n=e[i].getTransferables&&e[i].getTransferables(t);n&&Array.isArray(n)&&n.length||(n=void 0),r(t,n)}catch(l){console.error(l),r(l)}}}(a,(function(e,t){e instanceof Error?postMessage({messageId:i,success:!1,error:e.message}):postMessage({messageId:i,success:!0,result:e},t||void 0)}))}catch(s){postMessage({messageId:i,success:!1,error:s.stack})}}))}var rt=function(){var e=!1;if("undefined"!==typeof window&&"undefined"!==typeof window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return rt=function(){return e},e},nt=0,it=0,ot=!1,at=Object.create(null),st=Object.create(null),lt=Object.create(null);function ct(e){if((!e||"function"!==typeof e.init)&&!ot)throw new Error("requires `options.init` function");var t=e.dependencies,r=e.init,n=e.getTransferables,i=e.workerId;if(!rt())return function(e){var t=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return t._getInitResult().then((function(t){if("function"===typeof t)return t.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return t._getInitResult=function(){var r=e.dependencies,n=e.init;r=Array.isArray(r)?r.map((function(e){return e&&e._getInitResult?e._getInitResult():e})):[];var i=et.all(r).then((function(e){return n.apply(null,e)}));return t._getInitResult=function(){return i},i},t}(e);null==i&&(i="#default");var o="workerModule"+ ++nt,a=e.name||o,s=null;function l(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!s){s=ht(i,"registerModule",l.workerModuleData);var r=function(){s=null,st[i].delete(r)};(st[i]||(st[i]=new Set)).add(r)}return s.then((function(t){if(t.isCallable)return ht(i,"callModule",{id:o,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return t=t&&t.map((function(e){return"function"!==typeof e||e.workerModuleData||(ot=!0,e=ct({workerId:i,name:"<"+a+"> function dependency: "+e.name,init:"function(){return (\n"+ut(e)+"\n)}"}),ot=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),l.workerModuleData={isWorkerModule:!0,id:o,name:a,dependencies:t,init:ut(r),getTransferables:n&&ut(n)},l}function ut(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function ht(e,t,r){var n=et(),i=++it;return lt[i]=function(e){e.success?n.resolve(e.result):n.reject(new Error("Error in worker "+t+" call: "+e.error))},function(e){var t=at[e];if(!t){var r=ut(tt);(t=at[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,r=t.messageId,n=lt[r];if(!n)throw new Error("WorkerModule response with empty or unknown messageId");delete lt[r],n(t)}}return t}(e).postMessage({messageId:i,action:t,data:r}),n}var dt=ct({name:"Thenable",dependencies:[et],init:function(e){return e}});var ft=function(){return function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},r={},n={};r.L=1,n[1]="L",Object.keys(t).forEach((function(e,t){r[e]=1<<t+1,n[r[e]]=e})),Object.freeze(r);var i=r.LRI|r.RLI|r.FSI,o=r.L|r.R|r.AL,a=r.B|r.S|r.WS|r.ON|r.FSI|r.LRI|r.RLI|r.PDI,s=r.BN|r.RLE|r.LRE|r.RLO|r.LRO|r.PDF,l=r.S|r.WS|r.B|i|r.PDI|s,c=null;function u(e){return function(){if(!c){c=new Map;var e=function(e){if(t.hasOwnProperty(e)){var n=0;t[e].split(",").forEach((function(t){var i=t.split("+"),o=i[0],a=i[1];o=parseInt(o,36),a=a?parseInt(a,36):0,c.set(n+=o,r[e]);for(var s=0;s<a;s++)c.set(++n,r[e])}))}};for(var n in t)e(n)}}(),c.get(e.codePointAt(0))||r.L}var h,d,f,p="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",m="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function g(e,t){var r,n=0,i=new Map,o=t&&new Map;return e.split(",").forEach((function e(a){if(-1!==a.indexOf("+"))for(var s=+a;s--;)e(r);else{r=a;var l=a.split(">"),c=l[0],u=l[1];c=String.fromCodePoint(n+=parseInt(c,36)),u=String.fromCodePoint(n+=parseInt(u,36)),i.set(c,u),t&&o.set(u,c)}})),{map:i,reverseMap:o}}function A(){if(!h){var e=g(p,!0),t=e.map,r=e.reverseMap;h=t,d=r,f=g(m,!1).map}}function v(e){return A(),h.get(e)||null}function y(e){return A(),d.get(e)||null}function x(e){return A(),f.get(e)||null}var b=r.L,w=r.R,C=r.EN,E=r.ES,S=r.ET,T=r.AN,M=r.CS,I=r.B,B=r.S,_=r.ON,F=r.BN,P=r.NSM,R=r.AL,L=r.LRO,D=r.RLO,N=r.LRE,k=r.RLE,O=r.PDF,U=r.LRI,Q=r.RLI,V=r.FSI,G=r.PDI;var z;function j(e){return function(){if(!z){var e=g("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach((function(e,r){t.set(r,e)})),z=t}}(),z.get(e)||null}function H(e,t,r,n){var i=e.length;r=Math.max(0,null==r?0:+r),n=Math.min(i-1,null==n?i-1:+n);var o=[];return t.paragraphs.forEach((function(i){var a=Math.max(r,i.start),s=Math.min(n,i.end);if(a<s){for(var c=t.levels.slice(a,s+1),h=s;h>=a&&u(e[h])&l;h--)c[h]=i.level;for(var d=i.level,f=1/0,p=0;p<c.length;p++){var m=c[p];m>d&&(d=m),m<f&&(f=1|m)}for(var g=d;g>=f;g--)for(var A=0;A<c.length;A++)if(c[A]>=g){for(var v=A;A+1<c.length&&c[A+1]>=g;)A++;A>v&&o.push([v+r,A+r])}}})),o}function W(e,t,r,n){for(var i=H(e,t,r,n),o=[],a=0;a<e.length;a++)o[a]=a;return i.forEach((function(e){for(var t=e[0],r=e[1],n=o.slice(t,r+1),i=n.length;i--;)o[r-i]=n[i]})),o}return e.closingToOpeningBracket=y,e.getBidiCharType=u,e.getBidiCharTypeName=function(e){return n[u(e)]},e.getCanonicalBracket=x,e.getEmbeddingLevels=function(e,t){for(var r=new Uint32Array(e.length),n=0;n<e.length;n++)r[n]=u(e[n]);var c=new Map;function h(e,t){var n=r[e];r[e]=t,c.set(n,c.get(n)-1),n&a&&c.set(a,c.get(a)-1),c.set(t,(c.get(t)||0)+1),t&a&&c.set(a,(c.get(a)||0)+1)}for(var d=new Uint8Array(e.length),f=new Map,p=[],m=null,g=0;g<e.length;g++)m||p.push(m={start:g,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:Vt(g,!1)}),r[g]&I&&(m.end=g,m=null);for(var A=k|N|D|L|i|G|O|I,z=function(e){return e+(1&e?1:2)},j=function(e){return e+(1&e?2:1)},H=0;H<p.length;H++){var W=[{_level:(m=p[H]).level,_override:0,_isolate:0}],Z=void 0,X=0,Y=0,J=0;c.clear();for(var q=m.start;q<=m.end;q++){var K=r[q];if(Z=W[W.length-1],c.set(K,(c.get(K)||0)+1),K&a&&c.set(a,(c.get(a)||0)+1),K&A)if(K&(k|N)){d[q]=Z._level;var $=(K===k?j:z)(Z._level);$<=125&&!X&&!Y?W.push({_level:$,_override:0,_isolate:0}):X||Y++}else if(K&(D|L)){d[q]=Z._level;var ee=(K===D?j:z)(Z._level);ee<=125&&!X&&!Y?W.push({_level:ee,_override:K&D?w:b,_isolate:0}):X||Y++}else if(K&i){K&V&&(K=1===Vt(q+1,!0)?Q:U),d[q]=Z._level,Z._override&&h(q,Z._override);var te=(K===Q?j:z)(Z._level);te<=125&&0===X&&0===Y?(J++,W.push({_level:te,_override:0,_isolate:1,_isolInitIndex:q})):X++}else if(K&G){if(X>0)X--;else if(J>0){for(Y=0;!W[W.length-1]._isolate;)W.pop();var re=W[W.length-1]._isolInitIndex;null!=re&&(f.set(re,q),f.set(q,re)),W.pop(),J--}Z=W[W.length-1],d[q]=Z._level,Z._override&&h(q,Z._override)}else K&O?(0===X&&(Y>0?Y--:!Z._isolate&&W.length>1&&(W.pop(),Z=W[W.length-1])),d[q]=Z._level):K&I&&(d[q]=m.level);else d[q]=Z._level,Z._override&&K!==F&&h(q,Z._override)}for(var ne=[],ie=null,oe=m.start;oe<=m.end;oe++){var ae=r[oe];if(!(ae&s)){var se=d[oe],le=ae&i,ce=ae===G;ie&&se===ie._level?(ie._end=oe,ie._endsWithIsolInit=le):ne.push(ie={_start:oe,_end:oe,_level:se,_startsWithPDI:ce,_endsWithIsolInit:le})}}for(var ue=[],he=0;he<ne.length;he++){var de=ne[he];if(!de._startsWithPDI||de._startsWithPDI&&!f.has(de._start)){for(var fe=[ie=de],pe=void 0;ie&&ie._endsWithIsolInit&&null!=(pe=f.get(ie._end));)for(var me=he+1;me<ne.length;me++)if(ne[me]._start===pe){fe.push(ie=ne[me]);break}for(var ge=[],Ae=0;Ae<fe.length;Ae++)for(var ve=fe[Ae],ye=ve._start;ye<=ve._end;ye++)ge.push(ye);for(var xe=d[ge[0]],be=m.level,we=ge[0]-1;we>=0;we--)if(!(r[we]&s)){be=d[we];break}var Ce=ge[ge.length-1],Ee=d[Ce],Se=m.level;if(!(r[Ce]&i))for(var Te=Ce+1;Te<=m.end;Te++)if(!(r[Te]&s)){Se=d[Te];break}ue.push({_seqIndices:ge,_sosType:Math.max(be,xe)%2?w:b,_eosType:Math.max(Se,Ee)%2?w:b})}}for(var Me=0;Me<ue.length;Me++){var Ie=ue[Me],Be=Ie._seqIndices,_e=Ie._sosType,Fe=Ie._eosType;if(c.get(P))for(var Pe=0;Pe<Be.length;Pe++){var Re=Be[Pe];if(r[Re]&P){for(var Le=_e,De=Pe-1;De>=0;De--)if(!(r[Be[De]]&s)){Le=r[Be[De]];break}h(Re,Le&(i|G)?_:Le)}}if(c.get(C))for(var Ne=0;Ne<Be.length;Ne++){var ke=Be[Ne];if(r[ke]&C)for(var Oe=Ne-1;Oe>=-1;Oe--){var Ue=-1===Oe?_e:r[Be[Oe]];if(Ue&o){Ue===R&&h(ke,T);break}}}if(c.get(R))for(var Qe=0;Qe<Be.length;Qe++){var Ve=Be[Qe];r[Ve]&R&&h(Ve,w)}if(c.get(E)||c.get(M))for(var Ge=1;Ge<Be.length-1;Ge++){var ze=Be[Ge];if(r[ze]&(E|M)){for(var je=0,He=0,We=Ge-1;We>=0&&(je=r[Be[We]])&s;We--);for(var Ze=Ge+1;Ze<Be.length&&(He=r[Be[Ze]])&s;Ze++);je===He&&(r[ze]===E?je===C:je&(C|T))&&h(ze,je)}}if(c.get(C))for(var Xe=0;Xe<Be.length;Xe++){var Ye=Be[Xe];if(r[Ye]&C){for(var Je=Xe-1;Je>=0&&r[Be[Je]]&(S|s);Je--)h(Be[Je],C);for(var qe=Xe+1;qe<Be.length&&r[Be[qe]]&(S|s);qe++)h(Be[qe],C)}}if(c.get(S)||c.get(E)||c.get(M))for(var Ke=0;Ke<Be.length;Ke++){var $e=Be[Ke];if(r[$e]&(S|E|M)){h($e,_);for(var et=Ke-1;et>=0&&r[Be[et]]&s;et--)h(Be[et],_);for(var tt=Ke+1;tt<Be.length&&r[Be[tt]]&s;tt++)h(Be[tt],_)}}if(c.get(C))for(var rt=0,nt=_e;rt<Be.length;rt++){var it=Be[rt],ot=r[it];ot&C?nt===b&&h(it,b):ot&o&&(nt=ot)}if(c.get(a)){for(var at=w|C|T,st=at|b,lt=[],ct=[],ut=0;ut<Be.length;ut++)if(r[Be[ut]]&a){var ht=e[Be[ut]],dt=void 0;if(null!==v(ht)){if(!(ct.length<63))break;ct.push({char:ht,seqIndex:ut})}else if(null!==(dt=y(ht)))for(var ft=ct.length-1;ft>=0;ft--){var pt=ct[ft].char;if(pt===dt||pt===y(x(ht))||v(x(pt))===ht){lt.push([ct[ft].seqIndex,ut]),ct.length=ft;break}}}lt.sort((function(e,t){return e[0]-t[0]}));for(var mt=0;mt<lt.length;mt++){for(var gt=lt[mt],At=gt[0],vt=gt[1],yt=!1,xt=0,bt=At+1;bt<vt;bt++){var wt=Be[bt];if(r[wt]&st){yt=!0;var Ct=r[wt]&at?w:b;if(Ct===zt(wt)){xt=Ct;break}}}if(yt&&!xt){xt=_e;for(var Et=At-1;Et>=0;Et--){var St=Be[Et];if(r[St]&st){var Tt=r[St]&at?w:b;xt=Tt!==zt(St)?Tt:zt(St);break}}}if(xt){if(r[Be[At]]=r[Be[vt]]=xt,xt!==zt(Be[At]))for(var Mt=At+1;Mt<Be.length;Mt++)if(!(r[Be[Mt]]&s)){u(e[Be[Mt]])&P&&(r[Be[Mt]]=xt);break}if(xt!==zt(Be[vt]))for(var It=vt+1;It<Be.length;It++)if(!(r[Be[It]]&s)){u(e[Be[It]])&P&&(r[Be[It]]=xt);break}}}for(var Bt=0;Bt<Be.length;Bt++)if(r[Be[Bt]]&a){for(var _t=Bt,Ft=Bt,Pt=_e,Rt=Bt-1;Rt>=0;Rt--){if(!(r[Be[Rt]]&s)){Pt=r[Be[Rt]]&at?w:b;break}_t=Rt}for(var Lt=Fe,Dt=Bt+1;Dt<Be.length;Dt++){if(!(r[Be[Dt]]&(a|s))){Lt=r[Be[Dt]]&at?w:b;break}Ft=Dt}for(var Nt=_t;Nt<=Ft;Nt++)r[Be[Nt]]=Pt===Lt?Pt:zt(Be[Nt]);Bt=Ft}}}for(var kt=m.start;kt<=m.end;kt++){var Ot=d[kt],Ut=r[kt];if(1&Ot?Ut&(b|C|T)&&d[kt]++:Ut&w?d[kt]++:Ut&(T|C)&&(d[kt]+=2),Ut&s&&(d[kt]=0===kt?m.level:d[kt-1]),kt===m.end||u(e[kt])&(B|I))for(var Qt=kt;Qt>=0&&u(e[Qt])&l;Qt--)d[Qt]=m.level}}return{levels:d,paragraphs:p};function Vt(t,n){for(var o=t;o<e.length;o++){var a=r[o];if(a&(w|R))return 1;if(a&(I|b)||n&&a===G)return 0;if(a&i){var s=Gt(o);o=-1===s?e.length:s}}return 0}function Gt(t){for(var n=1,o=t+1;o<e.length;o++){var a=r[o];if(a&I)break;if(a&G){if(0===--n)return o}else a&i&&n++}return-1}function zt(e){return 1&d[e]?w:b}},e.getMirroredCharacter=j,e.getMirroredCharactersMap=function(e,t,r,n){var i=e.length;r=Math.max(0,null==r?0:+r),n=Math.min(i-1,null==n?i-1:+n);for(var o=new Map,a=r;a<=n;a++)if(1&t[a]){var s=j(e[a]);null!==s&&o.set(a,s)}return o},e.getReorderSegments=H,e.getReorderedIndices=W,e.getReorderedString=function(e,t,r,n){var i=W(e,t,r,n),o=[].concat(e);return i.forEach((function(r,n){o[n]=(1&t.levels[r]?j(e[r]):null)||e[r]})),o.join("")},e.openingToClosingBracket=v,Object.defineProperty(e,"__esModule",{value:!0}),e}({})};const pt=/\bvoid\s+main\s*\(\s*\)\s*{/g;function mt(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,t){let r=a.ShaderChunk[t];return r?mt(r):e}))}const gt=[];for(let ls=0;ls<256;ls++)gt[ls]=(ls<16?"0":"")+ls.toString(16);const At=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)r.hasOwnProperty(t)&&(e[t]=r[t])}return e},vt=Date.now(),yt=new WeakMap,xt=new Map;let bt=1e10;function wt(e,t){const r=function(e){const t=JSON.stringify(e,Et);let r=Tt.get(t);null==r&&Tt.set(t,r=++St);return r}(t);let n=yt.get(e);if(n||yt.set(e,n=Object.create(null)),n[r])return new n[r];const i=`_onBeforeCompile${r}`,o=function(n){e.onBeforeCompile.call(this,n);const o=this.customProgramCacheKey()+"|"+n.vertexShader+"|"+n.fragmentShader;let a=xt[o];if(!a){const e=function({vertexShader:e,fragmentShader:t},r,n){let{vertexDefs:i,vertexMainIntro:o,vertexMainOutro:a,vertexTransform:s,fragmentDefs:l,fragmentMainIntro:c,fragmentMainOutro:u,fragmentColorTransform:h,customRewriter:d,timeUniform:f}=r;i=i||"",o=o||"",a=a||"",l=l||"",c=c||"",u=u||"",(s||d)&&(e=mt(e));(h||d)&&(t=mt(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(d){let r=d({vertexShader:e,fragmentShader:t});e=r.vertexShader,t=r.fragmentShader}if(h){let e=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(t=>(e.push(t),""))),u=`${h}\n${e.join("\n")}\n${u}`}if(f){const e=`\nuniform float ${f};\n`;i=e+i,l=e+l}s&&(i=`${i}\nvoid troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${s}\n}\n`,o=`\ntroika_position_${n} = vec3(position);\ntroika_normal_${n} = vec3(normal);\ntroika_uv_${n} = vec2(uv);\ntroikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});\n${o}\n`,e=(e=`vec3 troika_position_${n};\nvec3 troika_normal_${n};\nvec2 troika_uv_${n};\n${e}\n`).replace(/\b(position|normal|uv)\b/g,((e,t,r,i)=>/\battribute\s+vec[23]\s+$/.test(i.substr(0,r))?t:`troika_${t}_${n}`)));return e=Ct(e,n,i,o,a),t=Ct(t,n,l,c,u),{vertexShader:e,fragmentShader:t}}(n,t,r);a=xt[o]=e}n.vertexShader=a.vertexShader,n.fragmentShader=a.fragmentShader,At(n.uniforms,this.uniforms),t.timeUniform&&(n.uniforms[t.timeUniform]={get value(){return Date.now()-vt}}),this[i]&&this[i](n)},s=function(){return l(t.chained?e:e.clone())},l=function(n){const i=Object.create(n,c);return Object.defineProperty(i,"baseMaterial",{value:e}),Object.defineProperty(i,"id",{value:bt++}),i.uuid=function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(gt[255&e]+gt[e>>8&255]+gt[e>>16&255]+gt[e>>24&255]+"-"+gt[255&t]+gt[t>>8&255]+"-"+gt[t>>16&15|64]+gt[t>>24&255]+"-"+gt[63&r|128]+gt[r>>8&255]+"-"+gt[r>>16&255]+gt[r>>24&255]+gt[255&n]+gt[n>>8&255]+gt[n>>16&255]+gt[n>>24&255]).toUpperCase()}(),i.uniforms=At({},n.uniforms,t.uniforms),i.defines=At({},n.defines,t.defines),i.defines[`TROIKA_DERIVED_MATERIAL_${r}`]="",i.extensions=At({},n.extensions,t.extensions),i._listeners=void 0,i},c={constructor:{value:s},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return r}},onBeforeCompile:{get:()=>o,set(e){this[i]=e}},copy:{writable:!0,configurable:!0,value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(At(this.extensions,t.extensions),At(this.defines,t.defines),At(this.uniforms,a.UniformsUtils.clone(t.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const t=new e.constructor;return l(t).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let r=this._depthMaterial;return r||(r=this._depthMaterial=wt(e.isDerivedMaterial?e.getDepthMaterial():new a.MeshDepthMaterial({depthPacking:a.RGBADepthPacking}),t),r.defines.IS_DEPTH_MATERIAL="",r.uniforms=this.uniforms),r}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let r=this._distanceMaterial;return r||(r=this._distanceMaterial=wt(e.isDerivedMaterial?e.getDistanceMaterial():new a.MeshDistanceMaterial,t),r.defines.IS_DISTANCE_MATERIAL="",r.uniforms=this.uniforms),r}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:t,_distanceMaterial:r}=this;t&&t.dispose(),r&&r.dispose(),e.dispose.call(this)}}};return n[r]=s,new s}function Ct(e,t,r,n,i){return(n||i||r)&&(e=e.replace(pt,`\n${r}\nvoid troikaOrigMain${t}() {`),e+=`\nvoid main() {\n  ${n}\n  troikaOrigMain${t}();\n  ${i}\n}`),e}function Et(e,t){return"uniforms"===e?void 0:"function"===typeof t?t.toString():t}let St=0;const Tt=new Map;a.DoubleSide;function Mt(e){function t(e,t,r,n,i,o,a){const s=1-a;return{x:s*s*e+2*s*a*r+a*a*i,y:s*s*t+2*s*a*n+a*a*o}}function r(e,t,r,n,i,o,a,s,l){const c=1-l;return{x:c*c*c*e+3*c*c*l*r+3*c*l*l*i+l*l*l*a,y:c*c*c*t+3*c*c*l*n+3*c*l*l*o+l*l*l*s}}function n(){return(self.performance||Date).now()}return function(i,o,a,s,l,c=1){const u=n(),h=new Uint8Array(i*o),d=s[2]-s[0],f=s[3]-s[1],p=e(s),m=/([MLQCZ])([^MLQCZ]*)/g;let g,A,v,y,x;for(;g=m.exec(a);){const e=g[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map((e=>parseFloat(e)));switch(g[1]){case"M":y=A=e[0],x=v=e[1];break;case"L":e[0]===y&&e[1]===x||p.addLineSegment(y,x,y=e[0],x=e[1]);break;case"Q":{let r={x:y,y:x};for(let n=1;n<16;n++){let i=t(y,x,e[0],e[1],e[2],e[3],n/15);p.addLineSegment(r.x,r.y,i.x,i.y),r=i}y=e[2],x=e[3];break}case"C":{let t={x:y,y:x};for(let n=1;n<16;n++){let i=r(y,x,e[0],e[1],e[2],e[3],e[4],e[5],n/15);p.addLineSegment(t.x,t.y,i.x,i.y),t=i}y=e[4],x=e[5];break}case"Z":y===A&&x===v||p.addLineSegment(y,x,A,v)}}for(let e=0;e<i;e++)for(let t=0;t<o;t++){const r=p.findNearestSignedDistance(s[0]+d*(e+.5)/i,s[1]+f*(t+.5)/o,l);let n=Math.pow(1-Math.abs(r)/l,c)/2;r<0&&(n=1-n),n=Math.max(0,Math.min(255,Math.round(255*n))),h[t*i+e]=n}return{textureData:h,timing:n()-u}}}function It(e){let t=!1;const r=[];function n(){t&&(r.sort((function(e,t){return e.maxX-t.maxX})),t=!1)}function i(e,t,r,n,i,o){const a=i-r,s=o-n,l=a*a+s*s,c=l?Math.max(0,Math.min(1,((e-r)*a+(t-n)*s)/l)):0,u=e-(r+c*a),h=t-(n+c*s);return u*u+h*h}return{addLineSegment:function(e,n,i,o){const a={x0:e,y0:n,x1:i,y1:o,minX:Math.min(e,i),minY:Math.min(n,o),maxX:Math.max(e,i),maxY:Math.max(n,o)};r.push(a),t=!0},findNearestSignedDistance:function(e,t){n();let o=1/0,a=1/0;for(let n=r.length;n--;){const s=r[n];if(s.maxX+a<=e)break;if(e+a>s.minX&&t-a<s.maxY&&t+a>s.minY){const r=i(e,t,s.x0,s.y0,s.x1,s.y1);r<o&&(o=r,a=Math.sqrt(o))}}return function(e,t){n();let i=!1;for(let n=r.length;n--;){const o=r[n];if(o.maxX<=e)break;if(o.minY<t&&o.maxY>t){o.y0>t!==o.y1>t&&e<(o.x1-o.x0)*(t-o.y0)/(o.y1-o.y0)+o.x0&&(i=!i)}}return i}(e,t)&&(a=-a),a}}}const Bt=ct({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(e){var t={parse:function(e){var r=t._bin,n=new Uint8Array(e);if("ttcf"==r.readASCII(n,0,4)){var i=4;r.readUshort(n,i),i+=2,r.readUshort(n,i),i+=2;var o=r.readUint(n,i);i+=4;for(var a=[],s=0;s<o;s++){var l=r.readUint(n,i);i+=4,a.push(t._readFont(n,l))}return a}return[t._readFont(n,0)]},_readFont:function(e,r){var n=t._bin,i=r;n.readFixed(e,r),r+=4;var o=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2;for(var a=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],s={_data:e,_offset:i},l={},c=0;c<o;c++){var u=n.readASCII(e,r,4);r+=4,n.readUint(e,r),r+=4;var h=n.readUint(e,r);r+=4;var d=n.readUint(e,r);r+=4,l[u]={offset:h,length:d}}for(c=0;c<a.length;c++){var f=a[c];l[f]&&(s[f.trim()]=t[f.trim()].parse(e,l[f].offset,l[f].length,s))}return s},_tabOffset:function(e,r,n){for(var i=t._bin,o=i.readUshort(e,n+4),a=n+12,s=0;s<o;s++){var l=i.readASCII(e,a,4);a+=4,i.readUint(e,a),a+=4;var c=i.readUint(e,a);if(a+=4,i.readUint(e,a),a+=4,l==r)return c}return 0}};t._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,r){return t._bin.readShort(e,r)/16384},readInt:function(e,r){return t._bin._view(e).getInt32(r)},readInt8:function(e,r){return t._bin._view(e).getInt8(r)},readShort:function(e,r){return t._bin._view(e).getInt16(r)},readUshort:function(e,r){return t._bin._view(e).getUint16(r)},readUshorts:function(e,r,n){for(var i=[],o=0;o<n;o++)i.push(t._bin.readUshort(e,r+2*o));return i},readUint:function(e,r){return t._bin._view(e).getUint32(r)},readUint64:function(e,r){return 4294967296*t._bin.readUint(e,r)+t._bin.readUint(e,r+4)},readASCII:function(e,t,r){for(var n="",i=0;i<r;i++)n+=String.fromCharCode(e[t+i]);return n},readUnicode:function(e,t,r){for(var n="",i=0;i<r;i++){var o=e[t++]<<8|e[t++];n+=String.fromCharCode(o)}return n},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,r,n){var i=t._bin._tdec;return i&&0==r&&n==e.length?i.decode(e):t._bin.readASCII(e,r,n)},readBytes:function(e,t,r){for(var n=[],i=0;i<r;i++)n.push(e[t+i]);return n},readASCIIArray:function(e,t,r){for(var n=[],i=0;i<r;i++)n.push(String.fromCharCode(e[t+i]));return n},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,r,n,i,o){var a=t._bin,s={},l=r;a.readFixed(e,r),r+=4;var c=a.readUshort(e,r);r+=2;var u=a.readUshort(e,r);r+=2;var h=a.readUshort(e,r);return r+=2,s.scriptList=t._lctf.readScriptList(e,l+c),s.featureList=t._lctf.readFeatureList(e,l+u),s.lookupList=t._lctf.readLookupList(e,l+h,o),s},t._lctf.readLookupList=function(e,r,n){var i=t._bin,o=r,a=[],s=i.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var c=i.readUshort(e,r);r+=2;var u=t._lctf.readLookupTable(e,o+c,n);a.push(u)}return a},t._lctf.readLookupTable=function(e,r,n){var i=t._bin,o=r,a={tabs:[]};a.ltype=i.readUshort(e,r),r+=2,a.flag=i.readUshort(e,r),r+=2;var s=i.readUshort(e,r);r+=2;for(var l=a.ltype,c=0;c<s;c++){var u=i.readUshort(e,r);r+=2;var h=n(e,l,o+u,a);a.tabs.push(h)}return a},t._lctf.numOfOnes=function(e){for(var t=0,r=0;r<32;r++)0!=(e>>>r&1)&&t++;return t},t._lctf.readClassDef=function(e,r){var n=t._bin,i=[],o=n.readUshort(e,r);if(r+=2,1==o){var a=n.readUshort(e,r);r+=2;var s=n.readUshort(e,r);r+=2;for(var l=0;l<s;l++)i.push(a+l),i.push(a+l),i.push(n.readUshort(e,r)),r+=2}if(2==o){var c=n.readUshort(e,r);for(r+=2,l=0;l<c;l++)i.push(n.readUshort(e,r)),r+=2,i.push(n.readUshort(e,r)),r+=2,i.push(n.readUshort(e,r)),r+=2}return i},t._lctf.getInterval=function(e,t){for(var r=0;r<e.length;r+=3){var n=e[r],i=e[r+1];if(e[r+2],n<=t&&t<=i)return r}return-1},t._lctf.readCoverage=function(e,r){var n=t._bin,i={};i.fmt=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);return r+=2,1==i.fmt&&(i.tab=n.readUshorts(e,r,o)),2==i.fmt&&(i.tab=n.readUshorts(e,r,3*o)),i},t._lctf.coverageIndex=function(e,r){var n=e.tab;if(1==e.fmt)return n.indexOf(r);if(2==e.fmt){var i=t._lctf.getInterval(n,r);if(-1!=i)return n[i+2]+(r-n[i])}return-1},t._lctf.readFeatureList=function(e,r){var n=t._bin,i=r,o=[],a=n.readUshort(e,r);r+=2;for(var s=0;s<a;s++){var l=n.readASCII(e,r,4);r+=4;var c=n.readUshort(e,r);r+=2;var u=t._lctf.readFeatureTable(e,i+c);u.tag=l.trim(),o.push(u)}return o},t._lctf.readFeatureTable=function(e,r){var n=t._bin,i=r,o={},a=n.readUshort(e,r);r+=2,a>0&&(o.featureParams=i+a);var s=n.readUshort(e,r);r+=2,o.tab=[];for(var l=0;l<s;l++)o.tab.push(n.readUshort(e,r+2*l));return o},t._lctf.readScriptList=function(e,r){var n=t._bin,i=r,o={},a=n.readUshort(e,r);r+=2;for(var s=0;s<a;s++){var l=n.readASCII(e,r,4);r+=4;var c=n.readUshort(e,r);r+=2,o[l.trim()]=t._lctf.readScriptTable(e,i+c)}return o},t._lctf.readScriptTable=function(e,r){var n=t._bin,i=r,o={},a=n.readUshort(e,r);r+=2,o.default=t._lctf.readLangSysTable(e,i+a);var s=n.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var c=n.readASCII(e,r,4);r+=4;var u=n.readUshort(e,r);r+=2,o[c.trim()]=t._lctf.readLangSysTable(e,i+u)}return o},t._lctf.readLangSysTable=function(e,r){var n=t._bin,i={};n.readUshort(e,r),r+=2,i.reqFeature=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);return r+=2,i.features=n.readUshorts(e,r,o),i},t.CFF={},t.CFF.parse=function(e,r,n){var i=t._bin;(e=new Uint8Array(e.buffer,r,n))[r=0],e[++r],e[++r],e[++r],r++;var o=[];r=t.CFF.readIndex(e,r,o);for(var a=[],s=0;s<o.length-1;s++)a.push(i.readASCII(e,r+o[s],o[s+1]-o[s]));r+=o[o.length-1];var l=[];r=t.CFF.readIndex(e,r,l);var c=[];for(s=0;s<l.length-1;s++)c.push(t.CFF.readDict(e,r+l[s],r+l[s+1]));r+=l[l.length-1];var u=c[0],h=[];r=t.CFF.readIndex(e,r,h);var d=[];for(s=0;s<h.length-1;s++)d.push(i.readASCII(e,r+h[s],h[s+1]-h[s]));if(r+=h[h.length-1],t.CFF.readSubrs(e,r,u),u.CharStrings){r=u.CharStrings,h=[],r=t.CFF.readIndex(e,r,h);var f=[];for(s=0;s<h.length-1;s++)f.push(i.readBytes(e,r+h[s],h[s+1]-h[s]));u.CharStrings=f}if(u.ROS){r=u.FDArray;var p=[];for(r=t.CFF.readIndex(e,r,p),u.FDArray=[],s=0;s<p.length-1;s++){var m=t.CFF.readDict(e,r+p[s],r+p[s+1]);t.CFF._readFDict(e,m,d),u.FDArray.push(m)}r+=p[p.length-1],r=u.FDSelect,u.FDSelect=[];var g=e[r];if(r++,3!=g)throw g;var A=i.readUshort(e,r);for(r+=2,s=0;s<A+1;s++)u.FDSelect.push(i.readUshort(e,r),e[r+2]),r+=3}return u.Encoding&&(u.Encoding=t.CFF.readEncoding(e,u.Encoding,u.CharStrings.length)),u.charset&&(u.charset=t.CFF.readCharset(e,u.charset,u.CharStrings.length)),t.CFF._readFDict(e,u,d),u},t.CFF._readFDict=function(e,r,n){var i;for(var o in r.Private&&(i=r.Private[1],r.Private=t.CFF.readDict(e,i,i+r.Private[0]),r.Private.Subrs&&t.CFF.readSubrs(e,i+r.Private.Subrs,r.Private)),r)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(o)&&(r[o]=n[r[o]-426+35])},t.CFF.readSubrs=function(e,r,n){var i=t._bin,o=[];r=t.CFF.readIndex(e,r,o);var a,s=o.length;a=s<1240?107:s<33900?1131:32768,n.Bias=a,n.Subrs=[];for(var l=0;l<o.length-1;l++)n.Subrs.push(i.readBytes(e,r+o[l],o[l+1]-o[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var r=0;r<e.charset.length;r++)if(e.charset[r]==t)return r;return-1},t.CFF.glyphBySE=function(e,r){return r<0||r>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[r])},t.CFF.readEncoding=function(e,r,n){t._bin;var i=[".notdef"],o=e[r];if(r++,0!=o)throw"error: unknown encoding format: "+o;var a=e[r];r++;for(var s=0;s<a;s++)i.push(e[r+s]);return i},t.CFF.readCharset=function(e,r,n){var i=t._bin,o=[".notdef"],a=e[r];if(r++,0==a)for(var s=0;s<n;s++){var l=i.readUshort(e,r);r+=2,o.push(l)}else{if(1!=a&&2!=a)throw"error: format: "+a;for(;o.length<n;){l=i.readUshort(e,r),r+=2;var c=0;for(1==a?(c=e[r],r++):(c=i.readUshort(e,r),r+=2),s=0;s<=c;s++)o.push(l),l++}}return o},t.CFF.readIndex=function(e,r,n){var i=t._bin,o=i.readUshort(e,r)+1,a=e[r+=2];if(r++,1==a)for(var s=0;s<o;s++)n.push(e[r+s]);else if(2==a)for(s=0;s<o;s++)n.push(i.readUshort(e,r+2*s));else if(3==a)for(s=0;s<o;s++)n.push(16777215&i.readUint(e,r+3*s-1));else if(1!=o)throw"unsupported offset size: "+a+", count: "+o;return(r+=o*a)-1},t.CFF.getCharString=function(e,r,n){var i=t._bin,o=e[r],a=e[r+1];e[r+2],e[r+3],e[r+4];var s=1,l=null,c=null;o<=20&&(l=o,s=1),12==o&&(l=100*o+a,s=2),21<=o&&o<=27&&(l=o,s=1),28==o&&(c=i.readShort(e,r+1),s=3),29<=o&&o<=31&&(l=o,s=1),32<=o&&o<=246&&(c=o-139,s=1),247<=o&&o<=250&&(c=256*(o-247)+a+108,s=2),251<=o&&o<=254&&(c=256*-(o-251)-a-108,s=2),255==o&&(c=i.readInt(e,r+1)/65535,s=5),n.val=null!=c?c:"o"+l,n.size=s},t.CFF.readCharString=function(e,r,n){for(var i=r+n,o=t._bin,a=[];r<i;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var c=1,u=null,h=null;s<=20&&(u=s,c=1),12==s&&(u=100*s+l,c=2),19!=s&&20!=s||(u=s,c=2),21<=s&&s<=27&&(u=s,c=1),28==s&&(h=o.readShort(e,r+1),c=3),29<=s&&s<=31&&(u=s,c=1),32<=s&&s<=246&&(h=s-139,c=1),247<=s&&s<=250&&(h=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(h=256*-(s-251)-l-108,c=2),255==s&&(h=o.readInt(e,r+1)/65535,c=5),a.push(null!=h?h:"o"+u),r+=c}return a},t.CFF.readDict=function(e,r,n){for(var i=t._bin,o={},a=[];r<n;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var c=1,u=null,h=null;if(28==s&&(h=i.readShort(e,r+1),c=3),29==s&&(h=i.readInt(e,r+1),c=5),32<=s&&s<=246&&(h=s-139,c=1),247<=s&&s<=250&&(h=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(h=256*-(s-251)-l-108,c=2),255==s)throw h=i.readInt(e,r+1)/65535,c=5,"unknown number";if(30==s){var d=[];for(c=1;;){var f=e[r+c];c++;var p=f>>4,m=15&f;if(15!=p&&d.push(p),15!=m&&d.push(m),15==m)break}for(var g="",A=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],v=0;v<d.length;v++)g+=A[d[v]];h=parseFloat(g)}s<=21&&(u=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],c=1,12==s&&(u=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],c=2)),null!=u?(o[u]=1==a.length?a[0]:a,a=[]):a.push(h),r+=c}return o},t.cmap={},t.cmap.parse=function(e,r,n){e=new Uint8Array(e.buffer,r,n),r=0;var i=t._bin,o={};i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);r+=2;var s=[];o.tables=[];for(var l=0;l<a;l++){var c=i.readUshort(e,r);r+=2;var u=i.readUshort(e,r);r+=2;var h=i.readUint(e,r);r+=4;var d="p"+c+"e"+u,f=s.indexOf(h);if(-1==f){var p;f=o.tables.length,s.push(h);var m=i.readUshort(e,h);0==m?p=t.cmap.parse0(e,h):4==m?p=t.cmap.parse4(e,h):6==m?p=t.cmap.parse6(e,h):12==m?p=t.cmap.parse12(e,h):console.debug("unknown format: "+m,c,u,h),o.tables.push(p)}if(null!=o[d])throw"multiple tables for one platform+encoding";o[d]=f}return o},t.cmap.parse0=function(e,r){var n=t._bin,i={};i.format=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,i.map=[];for(var a=0;a<o-6;a++)i.map.push(e[r+a]);return i},t.cmap.parse4=function(e,r){var n=t._bin,i=r,o={};o.format=n.readUshort(e,r),r+=2;var a=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2;var l=s/2;o.searchRange=n.readUshort(e,r),r+=2,o.entrySelector=n.readUshort(e,r),r+=2,o.rangeShift=n.readUshort(e,r),r+=2,o.endCount=n.readUshorts(e,r,l),r+=2*l,r+=2,o.startCount=n.readUshorts(e,r,l),r+=2*l,o.idDelta=[];for(var c=0;c<l;c++)o.idDelta.push(n.readShort(e,r)),r+=2;for(o.idRangeOffset=n.readUshorts(e,r,l),r+=2*l,o.glyphIdArray=[];r<i+a;)o.glyphIdArray.push(n.readUshort(e,r)),r+=2;return o},t.cmap.parse6=function(e,r){var n=t._bin,i={};i.format=n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,i.firstCode=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2,i.glyphIdArray=[];for(var a=0;a<o;a++)i.glyphIdArray.push(n.readUshort(e,r)),r+=2;return i},t.cmap.parse12=function(e,r){var n=t._bin,i={};i.format=n.readUshort(e,r),r+=2,r+=2,n.readUint(e,r),r+=4,n.readUint(e,r),r+=4;var o=n.readUint(e,r);r+=4,i.groups=[];for(var a=0;a<o;a++){var s=r+12*a,l=n.readUint(e,s+0),c=n.readUint(e,s+4),u=n.readUint(e,s+8);i.groups.push([l,c,u])}return i},t.glyf={},t.glyf.parse=function(e,t,r,n){for(var i=[],o=0;o<n.maxp.numGlyphs;o++)i.push(null);return i},t.glyf._parseGlyf=function(e,r){var n=t._bin,i=e._data,o=t._tabOffset(i,"glyf",e._offset)+e.loca[r];if(e.loca[r]==e.loca[r+1])return null;var a={};if(a.noc=n.readShort(i,o),o+=2,a.xMin=n.readShort(i,o),o+=2,a.yMin=n.readShort(i,o),o+=2,a.xMax=n.readShort(i,o),o+=2,a.yMax=n.readShort(i,o),o+=2,a.xMin>=a.xMax||a.yMin>=a.yMax)return null;if(a.noc>0){a.endPts=[];for(var s=0;s<a.noc;s++)a.endPts.push(n.readUshort(i,o)),o+=2;var l=n.readUshort(i,o);if(o+=2,i.length-o<l)return null;a.instructions=n.readBytes(i,o,l),o+=l;var c=a.endPts[a.noc-1]+1;for(a.flags=[],s=0;s<c;s++){var u=i[o];if(o++,a.flags.push(u),0!=(8&u)){var h=i[o];o++;for(var d=0;d<h;d++)a.flags.push(u),s++}}for(a.xs=[],s=0;s<c;s++){var f=0!=(2&a.flags[s]),p=0!=(16&a.flags[s]);f?(a.xs.push(p?i[o]:-i[o]),o++):p?a.xs.push(0):(a.xs.push(n.readShort(i,o)),o+=2)}for(a.ys=[],s=0;s<c;s++)f=0!=(4&a.flags[s]),p=0!=(32&a.flags[s]),f?(a.ys.push(p?i[o]:-i[o]),o++):p?a.ys.push(0):(a.ys.push(n.readShort(i,o)),o+=2);var m=0,g=0;for(s=0;s<c;s++)m+=a.xs[s],g+=a.ys[s],a.xs[s]=m,a.ys[s]=g}else{var A;a.parts=[];do{A=n.readUshort(i,o),o+=2;var v={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(a.parts.push(v),v.glyphIndex=n.readUshort(i,o),o+=2,1&A){var y=n.readShort(i,o);o+=2;var x=n.readShort(i,o);o+=2}else y=n.readInt8(i,o),o++,x=n.readInt8(i,o),o++;2&A?(v.m.tx=y,v.m.ty=x):(v.p1=y,v.p2=x),8&A?(v.m.a=v.m.d=n.readF2dot14(i,o),o+=2):64&A?(v.m.a=n.readF2dot14(i,o),o+=2,v.m.d=n.readF2dot14(i,o),o+=2):128&A&&(v.m.a=n.readF2dot14(i,o),o+=2,v.m.b=n.readF2dot14(i,o),o+=2,v.m.c=n.readF2dot14(i,o),o+=2,v.m.d=n.readF2dot14(i,o),o+=2)}while(32&A);if(256&A){var b=n.readUshort(i,o);for(o+=2,a.instr=[],s=0;s<b;s++)a.instr.push(i[o]),o++}}return a},t.GPOS={},t.GPOS.parse=function(e,r,n,i){return t._lctf.parse(e,r,n,i,t.GPOS.subt)},t.GPOS.subt=function(e,r,n,i){var o=t._bin,a=n,s={};if(s.fmt=o.readUshort(e,n),n+=2,1==r||2==r||3==r||7==r||8==r&&s.fmt<=2){var l=o.readUshort(e,n);n+=2,s.coverage=t._lctf.readCoverage(e,l+a)}if(1==r&&1==s.fmt){var c=o.readUshort(e,n);n+=2;var u=t._lctf.numOfOnes(c);0!=c&&(s.pos=t.GPOS.readValueRecord(e,n,c))}else if(2==r&&s.fmt>=1&&s.fmt<=2){c=o.readUshort(e,n),n+=2;var h=o.readUshort(e,n);n+=2,u=t._lctf.numOfOnes(c);var d=t._lctf.numOfOnes(h);if(1==s.fmt){s.pairsets=[];var f=o.readUshort(e,n);n+=2;for(var p=0;p<f;p++){var m=a+o.readUshort(e,n);n+=2;var g=o.readUshort(e,m);m+=2;for(var A=[],v=0;v<g;v++){var y=o.readUshort(e,m);m+=2,0!=c&&(S=t.GPOS.readValueRecord(e,m,c),m+=2*u),0!=h&&(T=t.GPOS.readValueRecord(e,m,h),m+=2*d),A.push({gid2:y,val1:S,val2:T})}s.pairsets.push(A)}}if(2==s.fmt){var x=o.readUshort(e,n);n+=2;var b=o.readUshort(e,n);n+=2;var w=o.readUshort(e,n);n+=2;var C=o.readUshort(e,n);for(n+=2,s.classDef1=t._lctf.readClassDef(e,a+x),s.classDef2=t._lctf.readClassDef(e,a+b),s.matrix=[],p=0;p<w;p++){var E=[];for(v=0;v<C;v++){var S=null,T=null;0!=c&&(S=t.GPOS.readValueRecord(e,n,c),n+=2*u),0!=h&&(T=t.GPOS.readValueRecord(e,n,h),n+=2*d),E.push({val1:S,val2:T})}s.matrix.push(E)}}}else{if(9==r&&1==s.fmt){var M=o.readUshort(e,n);n+=2;var I=o.readUint(e,n);if(n+=4,9==i.ltype)i.ltype=M;else if(i.ltype!=M)throw"invalid extension substitution";return t.GPOS.subt(e,i.ltype,a+I)}console.debug("unsupported GPOS table LookupType",r,"format",s.fmt)}return s},t.GPOS.readValueRecord=function(e,r,n){var i=t._bin,o=[];return o.push(1&n?i.readShort(e,r):0),r+=1&n?2:0,o.push(2&n?i.readShort(e,r):0),r+=2&n?2:0,o.push(4&n?i.readShort(e,r):0),r+=4&n?2:0,o.push(8&n?i.readShort(e,r):0),r+=8&n?2:0,o},t.GSUB={},t.GSUB.parse=function(e,r,n,i){return t._lctf.parse(e,r,n,i,t.GSUB.subt)},t.GSUB.subt=function(e,r,n,i){var o=t._bin,a=n,s={};if(s.fmt=o.readUshort(e,n),n+=2,1!=r&&4!=r&&5!=r&&6!=r)return null;if(1==r||4==r||5==r&&s.fmt<=2||6==r&&s.fmt<=2){var l=o.readUshort(e,n);n+=2,s.coverage=t._lctf.readCoverage(e,a+l)}if(1==r&&s.fmt>=1&&s.fmt<=2){if(1==s.fmt)s.delta=o.readShort(e,n),n+=2;else if(2==s.fmt){var c=o.readUshort(e,n);n+=2,s.newg=o.readUshorts(e,n,c),n+=2*s.newg.length}}else if(4==r){s.vals=[],c=o.readUshort(e,n),n+=2;for(var u=0;u<c;u++){var h=o.readUshort(e,n);n+=2,s.vals.push(t.GSUB.readLigatureSet(e,a+h))}}else if(5==r&&2==s.fmt){if(2==s.fmt){var d=o.readUshort(e,n);n+=2,s.cDef=t._lctf.readClassDef(e,a+d),s.scset=[];var f=o.readUshort(e,n);for(n+=2,u=0;u<f;u++){var p=o.readUshort(e,n);n+=2,s.scset.push(0==p?null:t.GSUB.readSubClassSet(e,a+p))}}}else if(6==r&&3==s.fmt){if(3==s.fmt){for(u=0;u<3;u++){c=o.readUshort(e,n),n+=2;for(var m=[],g=0;g<c;g++)m.push(t._lctf.readCoverage(e,a+o.readUshort(e,n+2*g)));n+=2*c,0==u&&(s.backCvg=m),1==u&&(s.inptCvg=m),2==u&&(s.ahedCvg=m)}c=o.readUshort(e,n),n+=2,s.lookupRec=t.GSUB.readSubstLookupRecords(e,n,c)}}else{if(7==r&&1==s.fmt){var A=o.readUshort(e,n);n+=2;var v=o.readUint(e,n);if(n+=4,9==i.ltype)i.ltype=A;else if(i.ltype!=A)throw"invalid extension substitution";return t.GSUB.subt(e,i.ltype,a+v)}console.debug("unsupported GSUB table LookupType",r,"format",s.fmt)}return s},t.GSUB.readSubClassSet=function(e,r){var n=t._bin.readUshort,i=r,o=[],a=n(e,r);r+=2;for(var s=0;s<a;s++){var l=n(e,r);r+=2,o.push(t.GSUB.readSubClassRule(e,i+l))}return o},t.GSUB.readSubClassRule=function(e,r){var n=t._bin.readUshort,i={},o=n(e,r),a=n(e,r+=2);r+=2,i.input=[];for(var s=0;s<o-1;s++)i.input.push(n(e,r)),r+=2;return i.substLookupRecords=t.GSUB.readSubstLookupRecords(e,r,a),i},t.GSUB.readSubstLookupRecords=function(e,r,n){for(var i=t._bin.readUshort,o=[],a=0;a<n;a++)o.push(i(e,r),i(e,r+2)),r+=4;return o},t.GSUB.readChainSubClassSet=function(e,r){var n=t._bin,i=r,o=[],a=n.readUshort(e,r);r+=2;for(var s=0;s<a;s++){var l=n.readUshort(e,r);r+=2,o.push(t.GSUB.readChainSubClassRule(e,i+l))}return o},t.GSUB.readChainSubClassRule=function(e,r){for(var n=t._bin,i={},o=["backtrack","input","lookahead"],a=0;a<o.length;a++){var s=n.readUshort(e,r);r+=2,1==a&&s--,i[o[a]]=n.readUshorts(e,r,s),r+=2*i[o[a]].length}return s=n.readUshort(e,r),r+=2,i.subst=n.readUshorts(e,r,2*s),r+=2*i.subst.length,i},t.GSUB.readLigatureSet=function(e,r){var n=t._bin,i=r,o=[],a=n.readUshort(e,r);r+=2;for(var s=0;s<a;s++){var l=n.readUshort(e,r);r+=2,o.push(t.GSUB.readLigature(e,i+l))}return o},t.GSUB.readLigature=function(e,r){var n=t._bin,i={chain:[]};i.nglyph=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2;for(var a=0;a<o-1;a++)i.chain.push(n.readUshort(e,r)),r+=2;return i},t.head={},t.head.parse=function(e,r,n){var i=t._bin,o={};return i.readFixed(e,r),r+=4,o.fontRevision=i.readFixed(e,r),r+=4,i.readUint(e,r),r+=4,i.readUint(e,r),r+=4,o.flags=i.readUshort(e,r),r+=2,o.unitsPerEm=i.readUshort(e,r),r+=2,o.created=i.readUint64(e,r),r+=8,o.modified=i.readUint64(e,r),r+=8,o.xMin=i.readShort(e,r),r+=2,o.yMin=i.readShort(e,r),r+=2,o.xMax=i.readShort(e,r),r+=2,o.yMax=i.readShort(e,r),r+=2,o.macStyle=i.readUshort(e,r),r+=2,o.lowestRecPPEM=i.readUshort(e,r),r+=2,o.fontDirectionHint=i.readShort(e,r),r+=2,o.indexToLocFormat=i.readShort(e,r),r+=2,o.glyphDataFormat=i.readShort(e,r),r+=2,o},t.hhea={},t.hhea.parse=function(e,r,n){var i=t._bin,o={};return i.readFixed(e,r),r+=4,o.ascender=i.readShort(e,r),r+=2,o.descender=i.readShort(e,r),r+=2,o.lineGap=i.readShort(e,r),r+=2,o.advanceWidthMax=i.readUshort(e,r),r+=2,o.minLeftSideBearing=i.readShort(e,r),r+=2,o.minRightSideBearing=i.readShort(e,r),r+=2,o.xMaxExtent=i.readShort(e,r),r+=2,o.caretSlopeRise=i.readShort(e,r),r+=2,o.caretSlopeRun=i.readShort(e,r),r+=2,o.caretOffset=i.readShort(e,r),r+=2,r+=8,o.metricDataFormat=i.readShort(e,r),r+=2,o.numberOfHMetrics=i.readUshort(e,r),r+=2,o},t.hmtx={},t.hmtx.parse=function(e,r,n,i){for(var o=t._bin,a={aWidth:[],lsBearing:[]},s=0,l=0,c=0;c<i.maxp.numGlyphs;c++)c<i.hhea.numberOfHMetrics&&(s=o.readUshort(e,r),r+=2,l=o.readShort(e,r),r+=2),a.aWidth.push(s),a.lsBearing.push(l);return a},t.kern={},t.kern.parse=function(e,r,n,i){var o=t._bin,a=o.readUshort(e,r);if(r+=2,1==a)return t.kern.parseV1(e,r-2,n,i);var s=o.readUshort(e,r);r+=2;for(var l={glyph1:[],rval:[]},c=0;c<s;c++){r+=2,n=o.readUshort(e,r),r+=2;var u=o.readUshort(e,r);r+=2;var h=u>>>8;if(0!=(h&=15))throw"unknown kern table format: "+h;r=t.kern.readFormat0(e,r,l)}return l},t.kern.parseV1=function(e,r,n,i){var o=t._bin;o.readFixed(e,r),r+=4;var a=o.readUint(e,r);r+=4;for(var s={glyph1:[],rval:[]},l=0;l<a;l++){o.readUint(e,r),r+=4;var c=o.readUshort(e,r);r+=2,o.readUshort(e,r),r+=2;var u=c>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;r=t.kern.readFormat0(e,r,s)}return s},t.kern.readFormat0=function(e,r,n){var i=t._bin,o=-1,a=i.readUshort(e,r);r+=2,i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2;for(var s=0;s<a;s++){var l=i.readUshort(e,r);r+=2;var c=i.readUshort(e,r);r+=2;var u=i.readShort(e,r);r+=2,l!=o&&(n.glyph1.push(l),n.rval.push({glyph2:[],vals:[]}));var h=n.rval[n.rval.length-1];h.glyph2.push(c),h.vals.push(u),o=l}return r},t.loca={},t.loca.parse=function(e,r,n,i){var o=t._bin,a=[],s=i.head.indexToLocFormat,l=i.maxp.numGlyphs+1;if(0==s)for(var c=0;c<l;c++)a.push(o.readUshort(e,r+(c<<1))<<1);if(1==s)for(c=0;c<l;c++)a.push(o.readUint(e,r+(c<<2)));return a},t.maxp={},t.maxp.parse=function(e,r,n){var i=t._bin,o={},a=i.readUint(e,r);return r+=4,o.numGlyphs=i.readUshort(e,r),r+=2,65536==a&&(o.maxPoints=i.readUshort(e,r),r+=2,o.maxContours=i.readUshort(e,r),r+=2,o.maxCompositePoints=i.readUshort(e,r),r+=2,o.maxCompositeContours=i.readUshort(e,r),r+=2,o.maxZones=i.readUshort(e,r),r+=2,o.maxTwilightPoints=i.readUshort(e,r),r+=2,o.maxStorage=i.readUshort(e,r),r+=2,o.maxFunctionDefs=i.readUshort(e,r),r+=2,o.maxInstructionDefs=i.readUshort(e,r),r+=2,o.maxStackElements=i.readUshort(e,r),r+=2,o.maxSizeOfInstructions=i.readUshort(e,r),r+=2,o.maxComponentElements=i.readUshort(e,r),r+=2,o.maxComponentDepth=i.readUshort(e,r),r+=2),o},t.name={},t.name.parse=function(e,r,n){var i=t._bin,o={};i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);r+=2,i.readUshort(e,r);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=r+=2,u=0;u<a;u++){var h=i.readUshort(e,r);r+=2;var d=i.readUshort(e,r);r+=2;var f=i.readUshort(e,r);r+=2;var p=i.readUshort(e,r);r+=2;var m=i.readUshort(e,r);r+=2;var g=i.readUshort(e,r);r+=2;var A,v=l[p],y=c+12*a+g;if(0==h)A=i.readUnicode(e,y,m/2);else if(3==h&&0==d)A=i.readUnicode(e,y,m/2);else if(0==d)A=i.readASCII(e,y,m);else if(1==d)A=i.readUnicode(e,y,m/2);else if(3==d)A=i.readUnicode(e,y,m/2);else{if(1!=h)throw"unknown encoding "+d+", platformID: "+h;A=i.readASCII(e,y,m),console.debug("reading unknown MAC encoding "+d+" as ASCII")}var x="p"+h+","+f.toString(16);null==o[x]&&(o[x]={}),o[x][void 0!==v?v:p]=A,o[x]._lang=f}for(var b in o)if(null!=o[b].postScriptName&&1033==o[b]._lang)return o[b];for(var b in o)if(null!=o[b].postScriptName&&0==o[b]._lang)return o[b];for(var b in o)if(null!=o[b].postScriptName&&3084==o[b]._lang)return o[b];for(var b in o)if(null!=o[b].postScriptName)return o[b];for(var b in o){s=b;break}return console.debug("returning name table with languageID "+o[s]._lang),o[s]},t["OS/2"]={},t["OS/2"].parse=function(e,r,n){var i=t._bin.readUshort(e,r);r+=2;var o={};if(0==i)t["OS/2"].version0(e,r,o);else if(1==i)t["OS/2"].version1(e,r,o);else if(2==i||3==i||4==i)t["OS/2"].version2(e,r,o);else{if(5!=i)throw"unknown OS/2 table version: "+i;t["OS/2"].version5(e,r,o)}return o},t["OS/2"].version0=function(e,r,n){var i=t._bin;return n.xAvgCharWidth=i.readShort(e,r),r+=2,n.usWeightClass=i.readUshort(e,r),r+=2,n.usWidthClass=i.readUshort(e,r),r+=2,n.fsType=i.readUshort(e,r),r+=2,n.ySubscriptXSize=i.readShort(e,r),r+=2,n.ySubscriptYSize=i.readShort(e,r),r+=2,n.ySubscriptXOffset=i.readShort(e,r),r+=2,n.ySubscriptYOffset=i.readShort(e,r),r+=2,n.ySuperscriptXSize=i.readShort(e,r),r+=2,n.ySuperscriptYSize=i.readShort(e,r),r+=2,n.ySuperscriptXOffset=i.readShort(e,r),r+=2,n.ySuperscriptYOffset=i.readShort(e,r),r+=2,n.yStrikeoutSize=i.readShort(e,r),r+=2,n.yStrikeoutPosition=i.readShort(e,r),r+=2,n.sFamilyClass=i.readShort(e,r),r+=2,n.panose=i.readBytes(e,r,10),r+=10,n.ulUnicodeRange1=i.readUint(e,r),r+=4,n.ulUnicodeRange2=i.readUint(e,r),r+=4,n.ulUnicodeRange3=i.readUint(e,r),r+=4,n.ulUnicodeRange4=i.readUint(e,r),r+=4,n.achVendID=[i.readInt8(e,r),i.readInt8(e,r+1),i.readInt8(e,r+2),i.readInt8(e,r+3)],r+=4,n.fsSelection=i.readUshort(e,r),r+=2,n.usFirstCharIndex=i.readUshort(e,r),r+=2,n.usLastCharIndex=i.readUshort(e,r),r+=2,n.sTypoAscender=i.readShort(e,r),r+=2,n.sTypoDescender=i.readShort(e,r),r+=2,n.sTypoLineGap=i.readShort(e,r),r+=2,n.usWinAscent=i.readUshort(e,r),r+=2,n.usWinDescent=i.readUshort(e,r),r+2},t["OS/2"].version1=function(e,r,n){var i=t._bin;return r=t["OS/2"].version0(e,r,n),n.ulCodePageRange1=i.readUint(e,r),r+=4,n.ulCodePageRange2=i.readUint(e,r),r+4},t["OS/2"].version2=function(e,r,n){var i=t._bin;return r=t["OS/2"].version1(e,r,n),n.sxHeight=i.readShort(e,r),r+=2,n.sCapHeight=i.readShort(e,r),r+=2,n.usDefault=i.readUshort(e,r),r+=2,n.usBreak=i.readUshort(e,r),r+=2,n.usMaxContext=i.readUshort(e,r),r+2},t["OS/2"].version5=function(e,r,n){var i=t._bin;return r=t["OS/2"].version2(e,r,n),n.usLowerOpticalPointSize=i.readUshort(e,r),r+=2,n.usUpperOpticalPointSize=i.readUshort(e,r),r+2},t.post={},t.post.parse=function(e,r,n){var i=t._bin,o={};return o.version=i.readFixed(e,r),r+=4,o.italicAngle=i.readFixed(e,r),r+=4,o.underlinePosition=i.readShort(e,r),r+=2,o.underlineThickness=i.readShort(e,r),r+=2,o},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var r=e.cmap,n=-1;if(null!=r.p0e4?n=r.p0e4:null!=r.p3e1?n=r.p3e1:null!=r.p1e0?n=r.p1e0:null!=r.p0e3&&(n=r.p0e3),-1==n)throw"no familiar platform and encoding!";var i=r.tables[n];if(0==i.format)return t>=i.map.length?0:i.map[t];if(4==i.format){for(var o=-1,a=0;a<i.endCount.length;a++)if(t<=i.endCount[a]){o=a;break}return-1==o||i.startCount[o]>t?0:65535&(0!=i.idRangeOffset[o]?i.glyphIdArray[t-i.startCount[o]+(i.idRangeOffset[o]>>1)-(i.idRangeOffset.length-o)]:t+i.idDelta[o])}if(12==i.format){if(t>i.groups[i.groups.length-1][1])return 0;for(a=0;a<i.groups.length;a++){var s=i.groups[a];if(s[0]<=t&&t<=s[1])return s[2]+(t-s[0])}return 0}throw"unknown cmap table format "+i.format},t.U.glyphToPath=function(e,r){var n={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[r]){var i=e.SVG.entries[r];return null==i?n:("string"==typeof i&&(i=t.SVG.toPath(i),e.SVG.entries[r]=i),i)}if(e.CFF){var o={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},a=e.CFF,s=e.CFF.Private;if(a.ROS){for(var l=0;a.FDSelect[l+2]<=r;)l+=2;s=a.FDArray[a.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[r],o,a,s,n)}else e.glyf&&t.U._drawGlyf(r,e,n);return n},t.U._drawGlyf=function(e,r,n){var i=r.glyf[e];null==i&&(i=r.glyf[e]=t.glyf._parseGlyf(r,e)),null!=i&&(i.noc>-1?t.U._simpleGlyph(i,n):t.U._compoGlyph(i,r,n))},t.U._simpleGlyph=function(e,r){for(var n=0;n<e.noc;n++){for(var i=0==n?0:e.endPts[n-1]+1,o=e.endPts[n],a=i;a<=o;a++){var s=a==i?o:a-1,l=a==o?i:a+1,c=1&e.flags[a],u=1&e.flags[s],h=1&e.flags[l],d=e.xs[a],f=e.ys[a];if(a==i)if(c){if(!u){t.U.P.moveTo(r,d,f);continue}t.U.P.moveTo(r,e.xs[s],e.ys[s])}else u?t.U.P.moveTo(r,e.xs[s],e.ys[s]):t.U.P.moveTo(r,(e.xs[s]+d)/2,(e.ys[s]+f)/2);c?u&&t.U.P.lineTo(r,d,f):h?t.U.P.qcurveTo(r,d,f,e.xs[l],e.ys[l]):t.U.P.qcurveTo(r,d,f,(d+e.xs[l])/2,(f+e.ys[l])/2)}t.U.P.closePath(r)}},t.U._compoGlyph=function(e,r,n){for(var i=0;i<e.parts.length;i++){var o={cmds:[],crds:[]},a=e.parts[i];t.U._drawGlyf(a.glyphIndex,r,o);for(var s=a.m,l=0;l<o.crds.length;l+=2){var c=o.crds[l],u=o.crds[l+1];n.crds.push(c*s.a+u*s.b+s.tx),n.crds.push(c*s.c+u*s.d+s.ty)}for(l=0;l<o.cmds.length;l++)n.cmds.push(o.cmds[l])}},t.U._getGlyphClass=function(e,r){var n=t._lctf.getInterval(r,e);return-1==n?0:r[n+2]},t.U.getPairAdjustment=function(e,r,n){var i=0;if(e.GPOS)for(var o=e.GPOS,a=o.lookupList,s=o.featureList,l=[],c=0;c<s.length;c++){var u=s[c];if("kern"==u.tag)for(var h=0;h<u.tab.length;h++)if(!l[u.tab[h]]){l[u.tab[h]]=!0;for(var d=a[u.tab[h]],f=0;f<d.tabs.length;f++)if(null!=d.tabs[f]){var p,m=d.tabs[f];if(!m.coverage||-1!=(p=t._lctf.coverageIndex(m.coverage,r)))if(1==d.ltype);else if(2==d.ltype){var g;if(1==m.fmt){var A=m.pairsets[p];for(c=0;c<A.length;c++)A[c].gid2==n&&(g=A[c])}else if(2==m.fmt){var v=t.U._getGlyphClass(r,m.classDef1),y=t.U._getGlyphClass(n,m.classDef2);g=m.matrix[v][y]}g&&g.val1&&g.val1[2]&&(i+=g.val1[2]),g&&g.val2&&g.val2[0]&&(i+=g.val2[0])}}}}if(e.kern){var x=e.kern.glyph1.indexOf(r);if(-1!=x){var b=e.kern.rval[x].glyph2.indexOf(n);-1!=b&&(i+=e.kern.rval[x].vals[b])}}return i},t.U._applySubs=function(e,r,n,i){for(var o=e.length-r-1,a=0;a<n.tabs.length;a++)if(null!=n.tabs[a]){var s,l=n.tabs[a];if(!l.coverage||-1!=(s=t._lctf.coverageIndex(l.coverage,e[r])))if(1==n.ltype)e[r],1==l.fmt?e[r]=e[r]+l.delta:e[r]=l.newg[s];else if(4==n.ltype)for(var c=l.vals[s],u=0;u<c.length;u++){var h=c[u],d=h.chain.length;if(!(d>o)){for(var f=!0,p=0,m=0;m<d;m++){for(;-1==e[r+p+(1+m)];)p++;h.chain[m]!=e[r+p+(1+m)]&&(f=!1)}if(f){for(e[r]=h.nglyph,m=0;m<d+p;m++)e[r+m+1]=-1;break}}}else if(5==n.ltype&&2==l.fmt)for(var g=t._lctf.getInterval(l.cDef,e[r]),A=l.cDef[g+2],v=l.scset[A],y=0;y<v.length;y++){var x=v[y],b=x.input;if(!(b.length>o)){for(f=!0,m=0;m<b.length;m++){var w=t._lctf.getInterval(l.cDef,e[r+1+m]);if(-1==g&&l.cDef[w+2]!=b[m]){f=!1;break}}if(f){var C=x.substLookupRecords;for(u=0;u<C.length;u+=2)C[u],C[u+1]}}}else if(6==n.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,r-l.backCvg.length))continue;if(!t.U._glsCovered(e,l.inptCvg,r))continue;if(!t.U._glsCovered(e,l.ahedCvg,r+l.inptCvg.length))continue;var E=l.lookupRec;for(y=0;y<E.length;y+=2){g=E[y];var S=i[E[y+1]];t.U._applySubs(e,r+g,S,i)}}}},t.U._glsCovered=function(e,r,n){for(var i=0;i<r.length;i++)if(-1==t._lctf.coverageIndex(r[i],e[n+i]))return!1;return!0},t.U.glyphsToPath=function(e,r,n){for(var i={cmds:[],crds:[]},o=0,a=0;a<r.length;a++){var s=r[a];if(-1!=s){for(var l=a<r.length-1&&-1!=r[a+1]?r[a+1]:0,c=t.U.glyphToPath(e,s),u=0;u<c.crds.length;u+=2)i.crds.push(c.crds[u]+o),i.crds.push(c.crds[u+1]);for(n&&i.cmds.push(n),u=0;u<c.cmds.length;u++)i.cmds.push(c.cmds[u]);n&&i.cmds.push("X"),o+=e.hmtx.aWidth[s],a<r.length-1&&(o+=t.U.getPairAdjustment(e,s,l))}}return i},t.U.P={},t.U.P.moveTo=function(e,t,r){e.cmds.push("M"),e.crds.push(t,r)},t.U.P.lineTo=function(e,t,r){e.cmds.push("L"),e.crds.push(t,r)},t.U.P.curveTo=function(e,t,r,n,i,o,a){e.cmds.push("C"),e.crds.push(t,r,n,i,o,a)},t.U.P.qcurveTo=function(e,t,r,n,i){e.cmds.push("Q"),e.crds.push(t,r,n,i)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,r,n,i,o){for(var a=r.stack,s=r.nStems,l=r.haveWidth,c=r.width,u=r.open,h=0,d=r.x,f=r.y,p=0,m=0,g=0,A=0,v=0,y=0,x=0,b=0,w=0,C=0,E={val:0,size:0};h<e.length;){t.CFF.getCharString(e,h,E);var S=E.val;if(h+=E.size,"o1"==S||"o18"==S)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0;else if("o3"==S||"o23"==S)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0;else if("o4"==S)a.length>1&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),u&&t.U.P.closePath(o),f+=a.pop(),t.U.P.moveTo(o,d,f),u=!0;else if("o5"==S)for(;a.length>0;)d+=a.shift(),f+=a.shift(),t.U.P.lineTo(o,d,f);else if("o6"==S||"o7"==S)for(var T=a.length,M="o6"==S,I=0;I<T;I++){var B=a.shift();M?d+=B:f+=B,M=!M,t.U.P.lineTo(o,d,f)}else if("o8"==S||"o24"==S){T=a.length;for(var _=0;_+6<=T;)p=d+a.shift(),m=f+a.shift(),g=p+a.shift(),A=m+a.shift(),d=g+a.shift(),f=A+a.shift(),t.U.P.curveTo(o,p,m,g,A,d,f),_+=6;"o24"==S&&(d+=a.shift(),f+=a.shift(),t.U.P.lineTo(o,d,f))}else{if("o11"==S)break;if("o1234"==S||"o1235"==S||"o1236"==S||"o1237"==S)"o1234"==S&&(m=f,g=(p=d+a.shift())+a.shift(),C=A=m+a.shift(),y=A,b=f,d=(x=(v=(w=g+a.shift())+a.shift())+a.shift())+a.shift(),t.U.P.curveTo(o,p,m,g,A,w,C),t.U.P.curveTo(o,v,y,x,b,d,f)),"o1235"==S&&(p=d+a.shift(),m=f+a.shift(),g=p+a.shift(),A=m+a.shift(),w=g+a.shift(),C=A+a.shift(),v=w+a.shift(),y=C+a.shift(),x=v+a.shift(),b=y+a.shift(),d=x+a.shift(),f=b+a.shift(),a.shift(),t.U.P.curveTo(o,p,m,g,A,w,C),t.U.P.curveTo(o,v,y,x,b,d,f)),"o1236"==S&&(p=d+a.shift(),m=f+a.shift(),g=p+a.shift(),C=A=m+a.shift(),y=A,x=(v=(w=g+a.shift())+a.shift())+a.shift(),b=y+a.shift(),d=x+a.shift(),t.U.P.curveTo(o,p,m,g,A,w,C),t.U.P.curveTo(o,v,y,x,b,d,f)),"o1237"==S&&(p=d+a.shift(),m=f+a.shift(),g=p+a.shift(),A=m+a.shift(),w=g+a.shift(),C=A+a.shift(),v=w+a.shift(),y=C+a.shift(),x=v+a.shift(),b=y+a.shift(),Math.abs(x-d)>Math.abs(b-f)?d=x+a.shift():f=b+a.shift(),t.U.P.curveTo(o,p,m,g,A,w,C),t.U.P.curveTo(o,v,y,x,b,d,f));else if("o14"==S){if(a.length>0&&!l&&(c=a.shift()+n.nominalWidthX,l=!0),4==a.length){var F=a.shift(),P=a.shift(),R=a.shift(),L=a.shift(),D=t.CFF.glyphBySE(n,R),N=t.CFF.glyphBySE(n,L);t.U._drawCFF(n.CharStrings[D],r,n,i,o),r.x=F,r.y=P,t.U._drawCFF(n.CharStrings[N],r,n,i,o)}u&&(t.U.P.closePath(o),u=!1)}else if("o19"==S||"o20"==S)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0,h+=s+7>>3;else if("o21"==S)a.length>2&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),f+=a.pop(),d+=a.pop(),u&&t.U.P.closePath(o),t.U.P.moveTo(o,d,f),u=!0;else if("o22"==S)a.length>1&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),d+=a.pop(),u&&t.U.P.closePath(o),t.U.P.moveTo(o,d,f),u=!0;else if("o25"==S){for(;a.length>6;)d+=a.shift(),f+=a.shift(),t.U.P.lineTo(o,d,f);p=d+a.shift(),m=f+a.shift(),g=p+a.shift(),A=m+a.shift(),d=g+a.shift(),f=A+a.shift(),t.U.P.curveTo(o,p,m,g,A,d,f)}else if("o26"==S)for(a.length%2&&(d+=a.shift());a.length>0;)p=d,m=f+a.shift(),d=g=p+a.shift(),f=(A=m+a.shift())+a.shift(),t.U.P.curveTo(o,p,m,g,A,d,f);else if("o27"==S)for(a.length%2&&(f+=a.shift());a.length>0;)m=f,g=(p=d+a.shift())+a.shift(),A=m+a.shift(),d=g+a.shift(),f=A,t.U.P.curveTo(o,p,m,g,A,d,f);else if("o10"==S||"o29"==S){var k="o10"==S?i:n;if(0==a.length)console.debug("error: empty stack");else{var O=a.pop(),U=k.Subrs[O+k.Bias];r.x=d,r.y=f,r.nStems=s,r.haveWidth=l,r.width=c,r.open=u,t.U._drawCFF(U,r,n,i,o),d=r.x,f=r.y,s=r.nStems,l=r.haveWidth,c=r.width,u=r.open}}else if("o30"==S||"o31"==S){var Q=a.length,V=(_=0,"o31"==S);for(_+=Q-(T=-3&Q);_<T;)V?(m=f,g=(p=d+a.shift())+a.shift(),f=(A=m+a.shift())+a.shift(),T-_==5?(d=g+a.shift(),_++):d=g,V=!1):(p=d,m=f+a.shift(),g=p+a.shift(),A=m+a.shift(),d=g+a.shift(),T-_==5?(f=A+a.shift(),_++):f=A,V=!0),t.U.P.curveTo(o,p,m,g,A,d,f),_+=4}else{if("o"==(S+"").charAt(0))throw console.debug("Unknown operation: "+S,e),S;a.push(S)}}}r.x=d,r.y=f,r.nStems=s,r.haveWidth=l,r.width=c,r.open=u};var r=t,n={Typr:r};return e.Typr=r,e.default=n,Object.defineProperty(e,"__esModule",{value:!0}),e}({}).Typr},function(){return function(e){var t=Uint8Array,r=Uint16Array,n=Uint32Array,i=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),o=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(e,t){for(var i=new r(31),o=0;o<31;++o)i[o]=t+=1<<e[o-1];var a=new n(i[30]);for(o=1;o<30;++o)for(var s=i[o];s<i[o+1];++s)a[s]=s-i[o]<<5|o;return[i,a]},l=s(i,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var h=s(o,0)[0],d=new r(32768),f=0;f<32768;++f){var p=(43690&f)>>>1|(21845&f)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,d[f]=((65280&p)>>>8|(255&p)<<8)>>>1}var m=function(e,t,n){for(var i=e.length,o=0,a=new r(t);o<i;++o)++a[e[o]-1];var s,l=new r(t);for(o=0;o<t;++o)l[o]=l[o-1]+a[o-1]<<1;if(n){s=new r(1<<t);var c=15-t;for(o=0;o<i;++o)if(e[o])for(var u=o<<4|e[o],h=t-e[o],f=l[e[o]-1]++<<h,p=f|(1<<h)-1;f<=p;++f)s[d[f]>>>c]=u}else for(s=new r(i),o=0;o<i;++o)e[o]&&(s[o]=d[l[e[o]-1]++]>>>15-e[o]);return s},g=new t(288);for(f=0;f<144;++f)g[f]=8;for(f=144;f<256;++f)g[f]=9;for(f=256;f<280;++f)g[f]=7;for(f=280;f<288;++f)g[f]=8;var A=new t(32);for(f=0;f<32;++f)A[f]=5;var v=m(g,9,1),y=m(A,5,1),x=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},b=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},w=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},C=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(e,t,r){var n=new Error(t||C[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,E),!r)throw n;return n},S=function(e,s,l){var u=e.length;if(!u||l&&!l.l&&u<5)return s||new t(0);var d=!s||l,f=!l||l.i;l||(l={}),s||(s=new t(3*u));var p,g=function(e){var r=s.length;if(e>r){var n=new t(Math.max(2*r,e));n.set(s),s=n}},A=l.f||0,C=l.p||0,S=l.b||0,T=l.l,M=l.d,I=l.m,B=l.n,_=8*u;do{if(!T){l.f=A=b(e,C,1);var F=b(e,C+1,3);if(C+=3,!F){var P=e[(z=((p=C)/8|0)+(7&p&&1)+4)-4]|e[z-3]<<8,R=z+P;if(R>u){f&&E(0);break}d&&g(S+P),s.set(e.subarray(z,R),S),l.b=S+=P,l.p=C=8*R;continue}if(1==F)T=v,M=y,I=9,B=5;else if(2==F){var L=b(e,C,31)+257,D=b(e,C+10,15)+4,N=L+b(e,C+5,31)+1;C+=14;for(var k=new t(N),O=new t(19),U=0;U<D;++U)O[a[U]]=b(e,C+3*U,7);C+=3*D;var Q=x(O),V=(1<<Q)-1,G=m(O,Q,1);for(U=0;U<N;){var z,j=G[b(e,C,V)];if(C+=15&j,(z=j>>>4)<16)k[U++]=z;else{var H=0,W=0;for(16==z?(W=3+b(e,C,3),C+=2,H=k[U-1]):17==z?(W=3+b(e,C,7),C+=3):18==z&&(W=11+b(e,C,127),C+=7);W--;)k[U++]=H}}var Z=k.subarray(0,L),X=k.subarray(L);I=x(Z),B=x(X),T=m(Z,I,1),M=m(X,B,1)}else E(1);if(C>_){f&&E(0);break}}d&&g(S+131072);for(var Y=(1<<I)-1,J=(1<<B)-1,q=C;;q=C){var K=(H=T[w(e,C)&Y])>>>4;if((C+=15&H)>_){f&&E(0);break}if(H||E(2),K<256)s[S++]=K;else{if(256==K){q=C,T=null;break}var $=K-254;if(K>264){var ee=i[U=K-257];$=b(e,C,(1<<ee)-1)+c[U],C+=ee}var te=M[w(e,C)&J],re=te>>>4;if(te||E(3),C+=15&te,X=h[re],re>3&&(ee=o[re],X+=w(e,C)&(1<<ee)-1,C+=ee),C>_){f&&E(0);break}d&&g(S+131072);for(var ne=S+$;S<ne;S+=4)s[S]=s[S-X],s[S+1]=s[S+1-X],s[S+2]=s[S+2-X],s[S+3]=s[S+3-X];S=ne}}l.l=T,l.p=q,l.b=S,T&&(A=1,l.m=I,l.d=M,l.n=B)}while(!A);return S==s.length?s:function(e,i,o){(null==i||i<0)&&(i=0),(null==o||o>e.length)&&(o=e.length);var a=new(e instanceof r?r:e instanceof n?n:t)(o-i);return a.set(e.subarray(i,o)),a}(s,0,S)},T=new t(0),M="undefined"!=typeof TextDecoder&&new TextDecoder;try{M.decode(T,{stream:!0})}catch(e){}return e.convert_streams=function(e){var t=new DataView(e),r=0;function n(){var e=t.getUint16(r);return r+=2,e}function i(){var e=t.getUint32(r);return r+=4,e}function o(e){A.setUint16(v,e),v+=2}function a(e){A.setUint32(v,e),v+=4}for(var s={signature:i(),flavor:i(),length:i(),numTables:n(),reserved:n(),totalSfntSize:i(),majorVersion:n(),minorVersion:n(),metaOffset:i(),metaLength:i(),metaOrigLength:i(),privOffset:i(),privLength:i()},l=0;Math.pow(2,l)<=s.numTables;)l++;l--;for(var c=16*Math.pow(2,l),u=16*s.numTables-c,h=12,d=[],f=0;f<s.numTables;f++)d.push({tag:i(),offset:i(),compLength:i(),origLength:i(),origChecksum:i()}),h+=16;var p,m=new Uint8Array(12+16*d.length+d.reduce((function(e,t){return e+t.origLength+4}),0)),g=m.buffer,A=new DataView(g),v=0;return a(s.flavor),o(s.numTables),o(c),o(l),o(u),d.forEach((function(e){a(e.tag),a(e.origChecksum),a(h),a(e.origLength),e.outOffset=h,(h+=e.origLength)%4!=0&&(h+=4-h%4)})),d.forEach((function(t){var r,n=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var i=new Uint8Array(t.origLength);r=new Uint8Array(n,2),S(r,i)}else i=new Uint8Array(n);m.set(i,t.outOffset);var o=0;(h=t.outOffset+t.origLength)%4!=0&&(o=4-h%4),m.set(new Uint8Array(o).buffer,t.outOffset+t.origLength),p=h+o})),g.slice(0,p)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){const r={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"};let i;function o(e){if(!i){const e={R:2,L:1,D:4,C:16,U:32,T:8};i=new Map;for(let t in n){let r=0;n[t].split(",").forEach((n=>{let[o,a]=n.split("+");o=parseInt(o,36),a=a?parseInt(a,36):0,i.set(r+=o,e[t]);for(let s=a;s--;)i.set(++r,e[t])}))}}return i.get(e)||32}const a=[null,"isol","init","fina","medi"];function s(e){const t=new Uint8Array(e.length);let r=32,n=1,i=-1;for(let a=0;a<e.length;a++){const s=e.codePointAt(a);let l=0|o(s),c=1;8&l||(21&r?22&l?(c=3,1!==n&&3!==n||t[i]++):33&l&&(2!==n&&4!==n||t[i]--):34&r&&(2!==n&&4!==n||t[i]--),n=t[a]=c,r=l,i=a,s>65535&&a++)}return t}function l(t){const n=Object.create(null),i={unitsPerEm:t.head.unitsPerEm,ascender:t.hhea.ascender,descender:t.hhea.descender,forEachGlyph(o,l,c,u){let h=0;const d=1/i.unitsPerEm*l,f=function(t,r){const n=[];for(let o=0;o<r.length;o++){const i=r.codePointAt(o);i>65535&&o++,n.push(e.U.codeToGlyph(t,i))}const i=t.GSUB;if(i){const{lookupList:t,featureList:o}=i;let l;const c=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,u=[];o.forEach((i=>{if(c.test(i.tag))for(let o=0;o<i.tab.length;o++){if(u[i.tab[o]])continue;u[i.tab[o]]=!0;const c=t[i.tab[o]],h=/^(isol|init|fina|medi)$/.test(i.tag);h&&!l&&(l=s(r));for(let r=0;r<n.length;r++)l&&h&&a[l[r]]!==i.tag||e.U._applySubs(n,r,c,t)}}))}return n}(t,o);let p=0,m=-1;return f.forEach(((i,a)=>{if(-1!==i){let o=n[i];if(!o){const{cmds:a,crds:s}=e.U.glyphToPath(t,i);let l,c,u,h,d="",f=0;for(let e=0,t=a.length;e<t;e++){const t=r[a[e]];d+=a[e];for(let e=1;e<=t;e++)d+=(e>1?",":"")+s[f++]}if(s.length){l=c=1/0,u=h=-1/0;for(let e=0,t=s.length;e<t;e+=2){let t=s[e],r=s[e+1];t<l&&(l=t),r<c&&(c=r),t>u&&(u=t),r>h&&(h=r)}}else l=u=c=h=0;o=n[i]={index:i,advanceWidth:t.hmtx.aWidth[i],xMin:l,yMin:c,xMax:u,yMax:h,path:d,pathCommandCount:a.length}}-1!==m&&(h+=e.U.getPairAdjustment(t,m,i)*d),u.call(null,o,h,p),o.advanceWidth&&(h+=o.advanceWidth*d),c&&(h+=c*l),m=i}p+=o.codePointAt(p)>65535?2:1})),h}};return i}return function(r){const n=new Uint8Array(r,0,4),i=e._bin.readASCII(n,0,4);if("wOFF"===i)r=t(r);else if("wOF2"===i)throw new Error("woff2 fonts not supported");return l(e.parse(r)[0])}}],init:(e,t,r)=>r(e(),t())}),_t={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Ft=new a.Color;let Pt=!1;function Rt(){return(self.performance||Date).now()}const Lt=Object.create(null);function Dt(e,t){Pt=!0,e=Nt({},e);const r=Rt();if(e.font=function(e){kt||(kt="undefined"===typeof document?{}:document.createElement("a"));return kt.href=e,kt.href}(e.font||_t.defaultFontURL),e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||_t.sdfGlyphSize,null!=e.colorRanges){let t={};for(let r in e.colorRanges)if(e.colorRanges.hasOwnProperty(r)){let n=e.colorRanges[r];"number"!==typeof n&&(n=Ft.set(n).getHex()),t[r]=n}e.colorRanges=t}Object.freeze(e);const{textureWidth:n,sdfExponent:i}=_t,{sdfGlyphSize:o}=e;let s=`${e.font}@${o}`,l=Lt[s];l||(l=Lt[s]={count:0,glyphs:new Map,sdfTexture:new a.DataTexture(new Uint8Array(o*n*4),n,o,a.RGBAFormat,void 0,void 0,void 0,void 0,a.LinearFilter,a.LinearFilter)},l.sdfTexture.font=e.font),Qt(e).then((n=>{const{glyphIds:a,glyphPositions:s,fontSize:c,unitsPerEm:u,timings:h}=n,d=[],f=new Float32Array(4*a.length),p=c/u;let m=0,g=0;const A=Rt();a.forEach(((e,t)=>{let r=l.glyphs.get(e);if(!r){const{path:t,pathBounds:i}=n.glyphData[e],a=Math.max(i[2]-i[0],i[3]-i[1])/o*(_t.sdfMargin*o+.5),s=l.count++,c=[i[0]-a,i[1]-a,i[2]+a,i[3]+a];l.glyphs.set(e,r={path:t,atlasIndex:s,sdfViewBox:c}),d.push(r)}const{sdfViewBox:i}=r,c=s[g++],u=s[g++];f[m++]=c+i[0]*p,f[m++]=u+i[1]*p,f[m++]=c+i[2]*p,f[m++]=u+i[3]*p,a[t]=r.atlasIndex})),h.quads=(h.quads||0)+(Rt()-A);const v=Rt();h.sdf={},et.all(d.map((({path:e,atlasIndex:t,sdfViewBox:r})=>{const n=Math.max(r[2]-r[0],r[3]-r[1]);return Ut(o,o,e,r,n,_t.sdfExponent).then((({textureData:e,timing:r})=>(h.sdf[t]=r,{atlasIndex:t,textureData:e,timing:r})))}))).then((s=>{s.length&&(s.forEach((({atlasIndex:e,textureData:t,timing:r})=>{const n=l.sdfTexture.image;for(;n.data.length<(e+1)*o*o;){const e=new Uint8Array(2*n.data.length);e.set(n.data),n.data=e,n.height*=2}const i=Math.floor(e/4),a=n.width/o,s=Math.floor(i/a)*n.width*o*4+i%a*o*4+e%4;for(let l=0;l<o;l++){const e=l*o,r=s+l*n.width*4;for(let i=0;i<o;i++)n.data[r+4*i]=t[e+i]}})),l.sdfTexture.needsUpdate=!0),h.sdfTotal=Rt()-v,h.total=Rt()-r,t(Object.freeze({parameters:e,sdfTexture:l.sdfTexture,sdfGlyphSize:o,sdfExponent:i,glyphBounds:f,glyphAtlasIndices:a,glyphColors:n.glyphColors,caretPositions:n.caretPositions,caretHeight:n.caretHeight,chunkedBounds:n.chunkedBounds,ascender:n.ascender,descender:n.descender,lineHeight:n.lineHeight,topBaseline:n.topBaseline,blockBounds:n.blockBounds,visibleBounds:n.visibleBounds,timings:n.timings,get totalBounds(){return console.log("totalBounds deprecated, use blockBounds instead"),n.blockBounds},get totalBlockSize(){console.log("totalBlockSize deprecated, use blockBounds instead");const[e,t,r,i]=n.blockBounds;return[r-e,i-t]}}))}))}))}function Nt(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}let kt;const Ot=ct({name:"Typesetter",dependencies:[_t,Bt,function(e,t,r){const{defaultFontURL:n}=r,i=Object.create(null),o=1/0,a=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,s=/[\s\-\u007C\u00AD\u2010\u2012-\u2014\u2027\u2056\u2E17\u2E40]/;function l(t,r){t||(t=n);let o=i[t];o?o.pending?o.pending.push(r):r(o):(i[t]={pending:[r]},function(t,r){!function i(){const o=e=>{console.error(`Failure loading font ${t}${t===n?"":"; trying fallback"}`,e),t!==n&&(t=n,i())};try{const n=new XMLHttpRequest;n.open("get",t,!0),n.responseType="arraybuffer",n.onload=function(){if(n.status>=400)o(new Error(n.statusText));else if(n.status>0)try{const t=e(n.response);r(t)}catch(un){o(un)}},n.onerror=o,n.send()}catch(a){o(a)}}()}(t,(e=>{let r=i[t].pending;i[t]=e,r.forEach((t=>t(e)))})))}function c({text:e="",font:r=n,sdfGlyphSize:i=64,fontSize:c=1,letterSpacing:p=0,lineHeight:m="normal",maxWidth:g=o,direction:A,textAlign:v="left",textIndent:y=0,whiteSpace:x="normal",overflowWrap:b="normal",anchorX:w=0,anchorY:C=0,includeCaretPositions:E=!1,chunkedBoundsSize:S=8192,colorRanges:T=null},M,I=!1){const B=d(),_={fontLoad:0,typesetting:0};e.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),c=+c,p=+p,g=+g,m=m||"normal",y=+y,l(r,(r=>{const n=isFinite(g);let i=null,l=null,F=null,P=null,R=null,L=null,D=null,N=0,k=0,O="nowrap"!==x;const{ascender:U,descender:Q,unitsPerEm:V}=r;_.fontLoad=d()-B;const G=d(),z=c/V;"normal"===m&&(m=(U-Q)/V);const j=((m*=c)-(U-Q)*z)/2,H=-(U*z+j),W=Math.min(m,(U-Q)*z),Z=(U+Q)/2*z-W/2;let X=y,Y=new f;const J=[Y];r.forEachGlyph(e,c,p,((t,r,i)=>{const o=e.charAt(i),l=t.advanceWidth*z,u=Y.count;let h;if("isEmpty"in t||(t.isWhitespace=!!o&&/\s/.test(o),t.canBreakAfter=!!o&&s.test(o),t.isEmpty=t.xMin===t.xMax||t.yMin===t.yMax||a.test(o)),t.isWhitespace||t.isEmpty||k++,O&&n&&!t.isWhitespace&&r+l+X>g&&u){if(Y.glyphAt(u-1).glyphObj.canBreakAfter)h=new f,X=-r;else for(let e=u;e--;){if(0===e&&"break-word"===b){h=new f,X=-r;break}if(Y.glyphAt(e).glyphObj.canBreakAfter){h=Y.splitAt(e+1);const t=h.glyphAt(0).x;X-=t;for(let e=h.count;e--;)h.glyphAt(e).x-=t;break}}h&&(Y.isSoftWrapped=!0,Y=h,J.push(Y),N=g)}let d=Y.glyphAt(Y.count);d.glyphObj=t,d.x=r+X,d.width=l,d.charIndex=i,"\n"===o&&(Y=new f,J.push(Y),X=-(r+l+p*c)+y)})),J.forEach((e=>{for(let t=e.count;t--;){let{glyphObj:r,x:n,width:i}=e.glyphAt(t);if(!r.isWhitespace)return e.width=n+i,void(e.width>N&&(N=e.width))}}));let q=0,K=0;if(w&&("number"===typeof w?q=-w:"string"===typeof w&&(q=-N*("left"===w?0:"center"===w?.5:"right"===w?1:u(w)))),C)if("number"===typeof C)K=-C;else if("string"===typeof C){let e=J.length*m;K="top"===C?0:"top-baseline"===C?-H:"middle"===C?e/2:"bottom"===C?e:"bottom-baseline"===C?e-j+Q*z:u(C)*e}if(!I){const n=t.getEmbeddingLevels(e,A);i=new Uint16Array(k),l=new Float32Array(2*k),F={},L=[o,o,-1/0,-1/0],D=[];let a=H;E&&(R=new Float32Array(3*e.length)),T&&(P=new Uint8Array(3*k));let s,c,u=0,d=-1,f=-1;if(J.forEach(((p,g)=>{let{count:A,width:y}=p;if(A>0){let m=0;for(let e=A;e--&&p.glyphAt(e).glyphObj.isWhitespace;)m++;let g=0,x=0;if("center"===v)g=(N-y)/2;else if("right"===v)g=N-y;else if("justify"===v&&p.isSoftWrapped){let e=0;for(let t=A-m;t--;)p.glyphAt(t).glyphObj.isWhitespace&&e++;x=(N-y)/e}if(x||g){let e=0;for(let t=0;t<A;t++){let r=p.glyphAt(t);const n=r.glyphObj;r.x+=g+e,0!==x&&n.isWhitespace&&t<A-m&&(e+=x,r.width+=x)}}const b=t.getReorderSegments(e,n,p.glyphAt(0).charIndex,p.glyphAt(p.count-1).charIndex);for(let e=0;e<b.length;e++){const[t,r]=b[e];let n=1/0,i=-1/0;for(let e=0;e<A;e++)if(p.glyphAt(e).charIndex>=t){let t=e,o=e;for(;o<A;o++){let e=p.glyphAt(o);if(e.charIndex>r)break;o<A-m&&(n=Math.min(n,e.x),i=Math.max(i,e.x+e.width))}for(let e=t;e<o;e++){const t=p.glyphAt(e);t.x=i-(t.x+t.width-n)}break}}let w;const C=e=>w=e;for(let v=0;v<A;v++){let m=p.glyphAt(v);w=m.glyphObj;const g=w.index,A=1&n.levels[m.charIndex];if(A){const n=t.getMirroredCharacter(e[m.charIndex]);n&&r.forEachGlyph(n,0,0,C)}if(E){const{charIndex:e}=m,t=m.x+q,r=m.x+m.width+q;R[3*e]=A?r:t,R[3*e+1]=A?t:r,R[3*e+2]=a+Z+K;const n=e-d;n>1&&h(R,d,n),d=e}if(T){const{charIndex:e}=m;for(;e>f;)f++,T.hasOwnProperty(f)&&(c=T[f])}if(!w.isWhitespace&&!w.isEmpty){const e=u++;F[g]||(F[g]={path:w.path,pathBounds:[w.xMin,w.yMin,w.xMax,w.yMax]});const t=m.x+q,r=a+K;l[2*e]=t,l[2*e+1]=r;const n=t+w.xMin*z,h=r+w.yMin*z,d=t+w.xMax*z,f=r+w.yMax*z;n<L[0]&&(L[0]=n),h<L[1]&&(L[1]=h),d>L[2]&&(L[2]=d),f>L[3]&&(L[3]=f),e%S===0&&(s={start:e,end:e,rect:[o,o,-1/0,-1/0]},D.push(s)),s.end++;const p=s.rect;if(n<p[0]&&(p[0]=n),h<p[1]&&(p[1]=h),d>p[2]&&(p[2]=d),f>p[3]&&(p[3]=f),i[e]=g,T){const t=3*e;P[t]=c>>16&255,P[t+1]=c>>8&255,P[t+2]=255&c}}}}a-=m})),R){const t=e.length-d;t>1&&h(R,d,t)}}_.typesetting=d()-G,M({glyphIds:i,glyphPositions:l,glyphData:F,caretPositions:R,caretHeight:W,glyphColors:P,chunkedBounds:D,fontSize:c,unitsPerEm:V,ascender:U*z,descender:Q*z,lineHeight:m,topBaseline:H,blockBounds:[q,K-J.length*m,q+N,K],visibleBounds:L,timings:_})}))}function u(e){let t=e.match(/^([\d.]+)%$/),r=t?parseFloat(t[1]):NaN;return isNaN(r)?0:r/100}function h(e,t,r){const n=e[3*t],i=e[3*t+1],o=e[3*t+2],a=(i-n)/r;for(let s=0;s<r;s++){const r=3*(t+s);e[r]=n+a*s,e[r+1]=n+a*(s+1),e[r+2]=o}}function d(){return(self.performance||Date).now()}function f(){this.data=[]}const p=["glyphObj","x","width","charIndex"];return f.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(e){let t=f.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new f;return t.data=this.data.splice(e*p.length),t}},f.flyweight=p.reduce(((e,t,r,n)=>(Object.defineProperty(e,t,{get(){return this.data[this.index*p.length+r]},set(e){this.data[this.index*p.length+r]=e}}),e)),{data:null,index:0}),{typeset:c,measure:function(e,t){c(e,(e=>{const[r,n,i,o]=e.blockBounds;t({width:i-r,height:o-n})}),{metricsOnly:!0})},loadFont:l}},ft],init(e,t,r,n){const{defaultFontURL:i}=e;return r(t,n(),{defaultFontURL:i})}}),Ut=function(){const e={};let t=0;return function(...r){const n="TroikaTextSDFGenerator_"+t++%4;let i=e[n];return i||(i=e[n]={workerModule:ct({name:n,workerId:n,dependencies:[_t,It,Mt],init(e,t,r){const{sdfExponent:n,sdfMargin:i}=e;return r(t,{sdfExponent:n,sdfMargin:i})},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),i.requests++,clearTimeout(i.idleTimer),i.workerModule(...r).then((e=>(0===--i.requests&&(i.idleTimer=setTimeout((()=>{!function(e){st[e]&&st[e].forEach((function(e){e()})),at[e]&&(at[e].terminate(),delete at[e])}(n)}),2e3)),e)))}}(),Qt=ct({name:"Typesetter",dependencies:[Ot,dt],init:(e,t)=>function(r){const n=new t;return e.typeset(r,n.resolve),n},getTransferables(e){const t=[e.glyphPositions.buffer,e.glyphIds.buffer];return e.caretPositions&&t.push(e.caretPositions.buffer),t}});const Vt=(()=>{const e={};new a.Vector3;const t="aTroikaGlyphIndex";class r extends a.InstancedBufferGeometry{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new a.Sphere,this.boundingBox=new a.Box3}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,("number"!==typeof t||t<1)&&(t=1);let r=function(t){let r=e[t];return r||(r=e[t]=new a.PlaneBufferGeometry(1,1,t,t).translate(.5,.5,0)),r}(t);["position","normal","uv"].forEach((e=>{this.attributes[e]=r.attributes[e].clone()})),this.setIndex(r.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,r,o,a,s){n(this,"aTroikaGlyphBounds",e,4),n(this,t,r,1),n(this,"aTroikaGlyphColor",s,3),this._blockBounds=o,this._chunkedBounds=a,i(this,r.length),this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:r}=this;if(t){const{PI:n,floor:i,min:o,max:a,sin:s,cos:l}=Math,c=n/2,u=2*n,h=Math.abs(t),d=e[0]/h,f=e[2]/h,p=i((d+c)/u)!==i((f+c)/u)?-h:o(s(d)*h,s(f)*h),m=i((d-c)/u)!==i((f-c)/u)?h:a(s(d)*h,s(f)*h),g=i((d+n)/u)!==i((f+n)/u)?2*h:a(h-l(d)*h,h-l(f)*h);r.min.set(p,e[1],t<0?-g:0),r.max.set(m,e[3],t<0?0:g)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let r=this.getAttribute(t).count,n=this._chunkedBounds;if(n)for(let t=n.length;t--;){r=n[t].end;let i=n[t].rect;if(i[1]<e.w&&i[3]>e.y&&i[0]<e.z&&i[2]>e.x)break}i(this,r)}}function n(e,t,r,n){const i=e.getAttribute(t);r?i&&i.array.length===r.length?(i.array.set(r),i.needsUpdate=!0):(e.setAttribute(t,new a.InstancedBufferAttribute(r,n)),delete e._maxInstanceCount,e.dispose()):i&&e.deleteAttribute(t)}function i(e,t){e[e.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=t}return r.prototype.setAttribute||(r.prototype.setAttribute=function(e,t){return this.attributes[e]=t,this}),r})();const Gt=(()=>{const e=new a.MeshBasicMaterial({color:16777215,side:a.DoubleSide,transparent:!0}),t=8421504,r=new a.Matrix4,n=new a.Vector3,i=new a.Vector3,o=[],s=new a.Vector3,l="+x+y";function c(e){return Array.isArray(e)?e[0]:e}let u=()=>{const t=new a.Mesh(new a.PlaneBufferGeometry(1,1),e);return u=()=>t,t},h=()=>{const t=new a.Mesh(new a.PlaneBufferGeometry(1,1,32,1),e);return h=()=>t,t};const d={type:"syncstart"},f={type:"synccomplete"},p=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],m=p.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class g extends a.Mesh{constructor(){super(new Vt,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=t,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=l,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(d),Dt({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize},(t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync((()=>{r.forEach((e=>e&&e()))}))),this.dispatchEvent(f),e&&e()}))))}onBeforeRender(e,t,r,n,i,o){this.sync(),i.isTroikaTextMaterial&&this._prepareForRender(i)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let t=this._derivedMaterial;const r=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=e.clone());if(t&&t.baseMaterial===r||(t=this._derivedMaterial=function(e){const t=wt(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new a.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new a.Vector4(0,0,0,0)},uTroikaClipRect:{value:new a.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new a.Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new a.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new a.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of encoding in SDFGenerator.js\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat distance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(distance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  distance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:e,fragmentShader:t}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(t)&&(t=t.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(e)||(e=e.replace(pt,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:t}}});return t.transparent=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}(r),r.addEventListener("dispose",(function e(){r.removeEventListener("dispose",e),t.dispose()}))),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let e=t._outlineMtl;return e||(e=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),e.isTextOutlineMaterial=!0,e.depthWrite=!1,e.map=null,t.addEventListener("dispose",(function r(){t.removeEventListener("dispose",r),e.dispose()}))),[e,t]}return t}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return c(this.material).getDepthMaterial()}get customDistanceMaterial(){return c(this.material).getDistanceMaterial()}_prepareForRender(e){const o=e.isTextOutlineMaterial,c=e.uniforms,u=this.textRenderInfo;if(u){const{sdfTexture:e,blockBounds:r}=u;c.uTroikaSDFTexture.value=e,c.uTroikaSDFTextureSize.value.set(e.image.width,e.image.height),c.uTroikaSDFGlyphSize.value=u.sdfGlyphSize,c.uTroikaSDFExponent.value=u.sdfExponent,c.uTroikaTotalBounds.value.fromArray(r),c.uTroikaUseGlyphColors.value=!o&&!!u.glyphColors;let n,i,a,s=0,l=0,h=0,d=0,f=0;if(o){let{outlineWidth:e,outlineOffsetX:t,outlineOffsetY:r,outlineBlur:i,outlineOpacity:o}=this;s=this._parsePercent(e)||0,l=Math.max(0,this._parsePercent(i)||0),n=o,d=this._parsePercent(t)||0,f=this._parsePercent(r)||0}else h=Math.max(0,this._parsePercent(this.strokeWidth)||0),h&&(a=this.strokeColor,c.uTroikaStrokeColor.value.set(null==a?t:a),i=this.strokeOpacity,null==i&&(i=1)),n=this.fillOpacity;c.uTroikaDistanceOffset.value=s,c.uTroikaPositionOffset.value.set(d,f),c.uTroikaBlurRadius.value=l,c.uTroikaStrokeWidth.value=h,c.uTroikaStrokeOpacity.value=i,c.uTroikaFillOpacity.value=null==n?1:n,c.uTroikaCurveRadius.value=this.curveRadius||0;let p=this.clipRect;if(p&&Array.isArray(p)&&4===p.length)c.uTroikaClipRect.value.fromArray(p);else{const e=100*(this.fontSize||.1);c.uTroikaClipRect.value.set(r[0]-e,r[1]-e,r[2]+e,r[3]+e)}this.geometry.applyClipRect(c.uTroikaClipRect.value)}c.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const h=o?this.outlineColor||0:this.color;if(null==h)delete e.color;else{const t=e.hasOwnProperty("color")?e.color:e.color=new a.Color;h===t._input&&"object"!==typeof h||t.set(t._input=h)}let d=this.orientation||l;if(d!==e._orientation){let t=c.uTroikaOrient.value;d=d.replace(/[^-+xyz]/g,"");let o=d!==l&&d.match(/^([-+])([xyz])([-+])([xyz])$/);if(o){let[,e,a,l,c]=o;n.set(0,0,0)[a]="-"===e?1:-1,i.set(0,0,0)[c]="-"===l?-1:1,r.lookAt(s,n.cross(i),i),t.setFromMatrix4(r)}else t.identity();e._orientation=d}}_parsePercent(e){if("string"===typeof e){let t=e.match(/^(-?[\d.]+)%$/),r=t?parseFloat(t[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new a.Vector2){t.copy(e);const r=this.curveRadius;return r&&(t.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),t}worldPositionToTextCoords(e,t=new a.Vector2){return n.copy(e),this.localPositionToTextCoords(this.worldToLocal(n),t)}raycast(e,t){const{textRenderInfo:r,curveRadius:n}=this;if(r){const i=r.blockBounds,a=n?h():u(),s=a.geometry,{position:l,uv:c}=s.attributes;for(let e=0;e<c.count;e++){let t=i[0]+c.getX(e)*(i[2]-i[0]);const r=i[1]+c.getY(e)*(i[3]-i[1]);let o=0;n&&(o=n-Math.cos(t/n)*n,t=Math.sin(t/n)*n),l.setXYZ(e,t,r,o)}s.boundingSphere=this.geometry.boundingSphere,s.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,o.length=0,a.raycast(e,o);for(let e=0;e<o.length;e++)o[e].object=this,t.push(o[e])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,m.forEach((t=>{this[t]=e[t]})),this}clone(){return(new this.constructor).copy(this)}}p.forEach((e=>{const t="_private_"+e;Object.defineProperty(g.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}));let A=!1;return Object.defineProperty(g.prototype,"anchor",{get(){return this._deprecated_anchor},set(e){this._deprecated_anchor=e,A||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),A=!0),Array.isArray(e)?(this.anchorX=100*(+e[0]||0)+"%",this.anchorY=100*(+e[1]||0)+"%"):this.anchorX=this.anchorY=0}}),g})();new WeakMap;new WeakMap;const zt=i.forwardRef((({anchorX:e="center",anchorY:t="middle",children:r,onSync:o,...a},l)=>{const c=(0,s.useThree)((({invalidate:e})=>e)),[u]=i.useState((()=>new Gt)),[h,d]=i.useMemo((()=>{const e=[];let t="";return i.Children.forEach(r,(r=>{"string"===typeof r||"number"===typeof r?t+=r:e.push(r)})),[e,t]}),[r]);return i.useLayoutEffect((()=>{u.sync((()=>{c(),o&&o(u)}))})),i.useEffect((()=>()=>u.dispose()),[u]),i.createElement("primitive",(0,n.Z)({object:u,ref:l,text:d,anchorX:e,anchorY:t},a),h)}));var jt=r(1291),Ht=r(5869),Wt=r(960),Zt=r(6015);(0,s.extend)({EffectComposer:jt.x,RenderPass:Ht.C,ShaderPass:Wt.T});const Xt=()=>{try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(un){return!1}},Yt=i.forwardRef((({children:e,multisamping:t=8,renderIndex:r=1,disableGamma:o=!1,disableRenderPass:l=!1,...c},u)=>{const h=i.useRef(),d=(0,s.useThree)((({scene:e})=>e)),f=(0,s.useThree)((({camera:e})=>e)),p=(0,s.useThree)((({gl:e})=>e)),m=(0,s.useThree)((({size:e})=>e)),[g]=i.useState((()=>{if(Xt()&&t>0){const e=new a.WebGLMultisampleRenderTarget(m.width,m.height,{format:a.RGBAFormat,encoding:a.sRGBEncoding});return e.samples=8,e}}));return i.useEffect((()=>{var e,t;null==(e=h.current)||e.setSize(m.width,m.height),null==(t=h.current)||t.setPixelRatio(p.getPixelRatio())}),[p,m]),(0,s.useFrame)((()=>{var e;return null==(e=h.current)?void 0:e.render()}),r),i.createElement("effectComposer",(0,n.Z)({ref:(0,T.Z)([u,h]),args:[p,g]},c),!l&&i.createElement("renderPass",{attachArray:"passes",args:[d,f]}),!o&&i.createElement("shaderPass",{attachArray:"passes",args:[Zt.Y]}),e)}));function Jt({stops:e,colors:t,size:r=1024,...o}){const l=(0,s.useThree)((e=>e.gl)),c=i.useMemo((()=>{const n=document.createElement("canvas"),i=n.getContext("2d");n.width=16,n.height=r;const o=i.createLinearGradient(0,0,0,r);let s=e.length;for(;s--;)o.addColorStop(e[s],t[s]);i.fillStyle=o,i.fillRect(0,0,16,r);const l=new a.Texture(n);return l.needsUpdate=!0,l}),[e]);return i.useEffect((()=>()=>{c.dispose()}),[c]),i.createElement("primitive",(0,n.Z)({object:c,attach:"map",encoding:l.outputEncoding},o))}function qt(e,t,r,n){return class extends a.ShaderMaterial{constructor(){const i=Object.entries(e);super({uniforms:i.reduce(((e,[t,r])=>({...e,...a.UniformsUtils.clone({[t]:{value:r}})})),{}),vertexShader:t,fragmentShader:r}),i.forEach((([e])=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t}))),n&&n(this)}}}const Kt=e=>e===Object(e)&&!Array.isArray(e)&&"function"!==typeof e;function $t(e){const t=(0,s.useThree)((e=>e.gl)),r=(0,s.useLoader)(a.TextureLoader,Kt(e)?Object.values(e):e);if((0,i.useEffect)((()=>{(Array.isArray(r)?r:[r]).forEach(t.initTexture)}),[t,r]),Kt(e)){const t=Object.keys(e),n={};return t.forEach((e=>Object.assign(n,{[e]:r[t.indexOf(e)]}))),n}return r}$t.preload=e=>s.useLoader.preload(a.TextureLoader,e),$t.clear=e=>s.useLoader.clear(a.TextureLoader,e);const er=qt({color:new a.Color("white"),scale:[1,1],imageBounds:[1,1],map:null,zoom:1,grayscale:0},"\n  varying vec2 vUv;\n  void main() {\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n    vUv = uv;\n  }\n","\n  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44\n  varying vec2 vUv;\n  uniform vec2 scale;\n  uniform vec2 imageBounds;\n  uniform vec3 color;\n  uniform sampler2D map;\n  uniform float zoom;\n  uniform float grayscale;\n  const vec3 luma = vec3(.299, 0.587, 0.114);\n  vec4 toGrayscale(vec4 color, float intensity) {\n    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);\n  }\n  vec2 aspect(vec2 size) {\n    return size / min(size.x, size.y);\n  }\n  void main() {\n    vec2 s = aspect(scale);\n    vec2 i = aspect(imageBounds);\n    float rs = s.x / s.y;\n    float ri = i.x / i.y;\n    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);\n    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;\n    vec2 uv = vUv * s / new + offset;\n    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);\n    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, 1.0), grayscale);\n  }\n"),tr=i.forwardRef((({children:e,color:t,segments:r=1,scale:o=1,zoom:a=1,grayscale:l=0,url:c,...u},h)=>{(0,s.extend)({ImageMaterial:er});const d=$t(c),f=Array.isArray(o)?[o[0],o[1]]:[o,o],p=[d.image.width,d.image.height];return i.createElement("mesh",(0,n.Z)({ref:h,scale:o},u),i.createElement("planeGeometry",{args:[1,1,r,r]}),i.createElement("imageMaterial",{color:t,map:d,zoom:a,grayscale:l,scale:f,imageBounds:p}),e)}));function rr({userData:e,children:t,geometry:r,threshold:o=15,color:s="black",...l}){const c=i.useRef(null);return i.useLayoutEffect((()=>{const e=c.current.parent;if(e){const t=r||e.geometry;t===c.current.userData.currentGeom&&o===c.current.userData.currentThreshold||(c.current.userData.currentGeom=t,c.current.userData.currentThreshold=o,c.current.geometry=new a.EdgesGeometry(t,o))}})),i.createElement("lineSegments",(0,n.Z)({ref:c,raycast:()=>null},l),t||i.createElement("lineBasicMaterial",{color:s}))}var nr=r(8853);const ir=i.forwardRef((({makeDefault:e,...t},r)=>{const o=(0,s.useThree)((({set:e})=>e)),a=(0,s.useThree)((({camera:e})=>e)),l=(0,s.useThree)((({size:e})=>e)),c=i.useRef();return i.useLayoutEffect((()=>{const{current:e}=c;e&&!t.manual&&(e.aspect=l.width/l.height,e.updateProjectionMatrix())}),[l,t]),i.useLayoutEffect((()=>{if(e&&c.current){const e=a;return o((()=>({camera:c.current}))),()=>o((()=>({camera:e})))}}),[a,c,e,o]),i.createElement("perspectiveCamera",(0,n.Z)({ref:(0,T.Z)([c,r])},t))}));function or({children:e,fog:t,frames:r=1/0,resolution:n=256,near:o=1,far:l=1e3,...c}){const u=i.useRef(),[h,d]=i.useState(),f=(0,s.useThree)((({scene:e})=>e)),p=(0,s.useThree)((({gl:e})=>e)),m=i.useMemo((()=>new a.WebGLCubeRenderTarget(n,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,encoding:p.outputEncoding})),[n]);let g=0;return(0,s.useFrame)((()=>{if(h&&u.current&&(r===1/0||g<r)){u.current.traverse((e=>e.visible=!1));const e=f.fog;f.fog=t||e,h.update(p,f),f.fog=e,u.current.traverse((e=>e.visible=!0)),g++}})),i.createElement("group",c,i.createElement("cubeCamera",{ref:d,args:[o,l,m]}),i.createElement("group",{ref:u},e(m.texture)))}var ar=r(8096);const sr=i.forwardRef(((e,t)=>{const{camera:r,onChange:o,...a}=e,l=(0,s.useThree)((({camera:e})=>e)),c=(0,s.useThree)((({invalidate:e})=>e)),u=r||l,[h]=i.useState((()=>new ar.W(u)));return i.useEffect((()=>{const e=e=>{c(),o&&o(e)};return null==h||null==h.addEventListener||h.addEventListener("change",e),()=>null==h||null==h.removeEventListener?void 0:h.removeEventListener("change",e)}),[o,h,c]),(0,s.useFrame)((()=>null==h?void 0:h.update())),i.useEffect((()=>{const e=h;return null==e||e.connect(),()=>null==e?void 0:e.dispose()}),[h]),h?i.createElement("primitive",(0,n.Z)({ref:t,dispose:void 0,object:h},a)):null}));var lr=r(142);const cr=i.forwardRef(((e,t)=>{const{onChange:r,...o}=e,a=(0,s.useThree)((({invalidate:e})=>e)),l=(0,s.useThree)((({camera:e})=>e)),c=(0,s.useThree)((({gl:e})=>e)),[u]=i.useState((()=>new lr.m(l,c.domElement)));return i.useEffect((()=>{const e=e=>{a(),r&&r(e)};return null==u||null==u.addEventListener||u.addEventListener("change",e),()=>null==u||null==u.removeEventListener?void 0:u.removeEventListener("change",e)}),[r,u,a]),(0,s.useFrame)(((e,t)=>null==u?void 0:u.update(t))),u?i.createElement("primitive",(0,n.Z)({ref:t,dispose:void 0,object:u},o)):null}));var ur=r(9649);const hr=i.forwardRef(((e={enableDamping:!0},t)=>{const{camera:r,onChange:o,onStart:a,onEnd:l,...c}=e,u=(0,s.useThree)((({invalidate:e})=>e)),h=(0,s.useThree)((({camera:e})=>e)),d=(0,s.useThree)((({gl:e})=>e.domElement)),f=r||h,p=i.useMemo((()=>new ur.o(f)),[f]);return i.useEffect((()=>{p.connect(d);const e=e=>{u(),o&&o(e)};return p.addEventListener("change",e),a&&p.addEventListener("start",a),l&&p.addEventListener("end",l),()=>{p.dispose(),p.removeEventListener("change",e),a&&p.removeEventListener("start",a),l&&p.removeEventListener("end",l)}}),[o,a,l,p,u,d]),(0,s.useFrame)((()=>p.update())),i.createElement("primitive",(0,n.Z)({ref:t,dispose:void 0,object:p,enableDamping:!0},c))})),dr=(0,i.forwardRef)((({makeDefault:e,camera:t,regress:r,domElement:o,enableDamping:a=!0,onChange:l,onStart:c,onEnd:u,...h},d)=>{const f=(0,s.useThree)((({invalidate:e})=>e)),p=(0,s.useThree)((({camera:e})=>e)),m=(0,s.useThree)((({gl:e})=>e)),g=(0,s.useThree)((({events:e})=>e)),A=(0,s.useThree)((({set:e})=>e)),v=(0,s.useThree)((({get:e})=>e)),y=(0,s.useThree)((({performance:e})=>e)),x=t||p,b=o||("boolean"!==typeof g.connected?g.connected:m.domElement),w=(0,i.useMemo)((()=>new ur.z(x)),[x]);return(0,s.useFrame)((()=>{w.enabled&&w.update()})),(0,i.useEffect)((()=>{const e=e=>{f(),r&&y.regress(),l&&l(e)};return w.connect(b),w.addEventListener("change",e),c&&w.addEventListener("start",c),u&&w.addEventListener("end",u),()=>{w.removeEventListener("change",e),c&&w.removeEventListener("start",c),u&&w.removeEventListener("end",u),w.dispose()}}),[b,l,c,u,r,w,f]),(0,i.useEffect)((()=>{if(e){const e=v().controls;return A({controls:w}),()=>A({controls:e})}}),[e,w]),i.createElement("primitive",(0,n.Z)({ref:d,object:w,enableDamping:a},h))}));var fr=r(9097);const pr=i.forwardRef((({makeDefault:e,camera:t,domElement:r,regress:o,onChange:a,onStart:l,onEnd:c,...u},h)=>{const{invalidate:d,camera:f,gl:p,events:m,set:g,get:A,performance:v,viewport:y}=(0,s.useThree)(),x=t||f,b=r||("boolean"!==typeof m.connected?m.connected:p.domElement),w=i.useMemo((()=>new fr.$(x)),[x]);return(0,s.useFrame)((()=>{w.enabled&&w.update()})),i.useEffect((()=>{const e=e=>{d(),o&&v.regress(),a&&a(e)};return w.connect(b),w.addEventListener("change",e),l&&w.addEventListener("start",l),c&&w.addEventListener("end",c),()=>{w.removeEventListener("change",e),l&&w.removeEventListener("start",l),c&&w.removeEventListener("end",c),w.dispose()}}),[b,a,l,c,o,w,d]),i.useEffect((()=>{w.handleResize()}),[y]),i.useEffect((()=>{if(e){const e=A().controls;return g({controls:w}),()=>g({controls:e})}}),[e,w]),i.createElement("primitive",(0,n.Z)({ref:h,object:w},u))}));var mr=r(394);const gr=(0,i.forwardRef)((({camera:e,makeDefault:t,regress:r,domElement:o,onChange:a,onStart:l,onEnd:c,...u},h)=>{const d=(0,s.useThree)((({invalidate:e})=>e)),f=(0,s.useThree)((({camera:e})=>e)),p=(0,s.useThree)((({gl:e})=>e)),m=(0,s.useThree)((({events:e})=>e)),g=(0,s.useThree)((({set:e})=>e)),A=(0,s.useThree)((({get:e})=>e)),v=(0,s.useThree)((({performance:e})=>e)),y=e||f,x=o||("boolean"!==typeof m.connected?m.connected:p.domElement),b=(0,i.useMemo)((()=>new mr.A(y)),[y]);return(0,s.useFrame)((()=>{b.enabled&&b.update()})),(0,i.useEffect)((()=>{const e=e=>{d(),r&&v.regress(),a&&a(e)};return b.connect(x),b.addEventListener("change",e),l&&b.addEventListener("start",l),c&&b.addEventListener("end",c),()=>{b.removeEventListener("change",e),l&&b.removeEventListener("start",l),c&&b.removeEventListener("end",c),b.dispose()}}),[x,a,l,c,r,b,d]),(0,i.useEffect)((()=>{if(t){const e=A().controls;return g({controls:b}),()=>g({controls:e})}}),[t,b]),i.createElement("primitive",(0,n.Z)({ref:h,object:b},u))}));var Ar=r(8056),vr=r.n(Ar),yr=r(7126),xr=r.n(yr),br=r(7642);const wr=i.forwardRef((({children:e,domElement:t,onChange:r,onMouseDown:o,onMouseUp:l,onObjectChange:c,object:u,...h},d)=>{const f=["enabled","axis","mode","translationSnap","rotationSnap","scaleSnap","space","size","showX","showY","showZ"],{camera:p,...m}=h,g=xr()(m,f),A=vr()(m,f),v=(0,s.useThree)((e=>e.controls)),y=(0,s.useThree)((({gl:e})=>e)),x=(0,s.useThree)((({camera:e})=>e)),b=(0,s.useThree)((({invalidate:e})=>e)),w=p||x,C=i.useMemo((()=>new br.Ys(w,t||y.domElement)),[w,t,y.domElement]),E=i.useRef();return i.useLayoutEffect((()=>{u?null==C||C.attach(u instanceof a.Object3D?u:u.current):null==C||C.attach(E.current)}),[u,e,C]),i.useEffect((()=>{if(v){const e=e=>v.enabled=!e.value;return C.addEventListener("dragging-changed",e),()=>C.removeEventListener("dragging-changed",e)}}),[C,v]),i.useEffect((()=>{const e=e=>{b(),r&&r(e)};return null==C||null==C.addEventListener||C.addEventListener("change",e),o&&(null==C||null==C.addEventListener||C.addEventListener("mouseDown",o)),l&&(null==C||null==C.addEventListener||C.addEventListener("mouseUp",l)),c&&(null==C||null==C.addEventListener||C.addEventListener("objectChange",c)),()=>{null==C||null==C.removeEventListener||C.removeEventListener("change",e),o&&(null==C||null==C.removeEventListener||C.removeEventListener("mouseDown",o)),l&&(null==C||null==C.removeEventListener||C.removeEventListener("mouseUp",l)),c&&(null==C||null==C.removeEventListener||C.removeEventListener("objectChange",c))}}),[r,o,l,c,C,b]),C?i.createElement(i.Fragment,null,i.createElement("primitive",(0,n.Z)({ref:d,dispose:void 0,object:C},g)),i.createElement("group",(0,n.Z)({ref:E},A),e)):null}));var Cr=r(7827);const Er=i.forwardRef((({selector:e,onChange:t,onLock:r,onUnlock:o,...a},l)=>{const{camera:c,...u}=a,h=(0,s.useThree)((({gl:e})=>e)),d=(0,s.useThree)((({camera:e})=>e)),f=(0,s.useThree)((({invalidate:e})=>e)),p=c||d,[m]=i.useState((()=>new Cr.q(p,h.domElement)));return i.useEffect((()=>{const e=e=>{f(),t&&t(e)};return null==m||null==m.addEventListener||m.addEventListener("change",e),r&&(null==m||null==m.addEventListener||m.addEventListener("lock",r)),o&&(null==m||null==m.addEventListener||m.addEventListener("unlock",o)),()=>{null==m||null==m.removeEventListener||m.removeEventListener("change",e),r&&(null==m||null==m.addEventListener||m.addEventListener("lock",r)),o&&(null==m||null==m.addEventListener||m.addEventListener("unlock",o))}}),[t,r,o,m,f]),i.useEffect((()=>{const t=()=>null==m?void 0:m.lock(),r=e?Array.from(document.querySelectorAll(e)):[document];return r.forEach((e=>e&&e.addEventListener("click",t))),()=>{r.forEach((e=>e?e.removeEventListener("click",t):void 0))}}),[m,e]),m?i.createElement("primitive",(0,n.Z)({ref:l,dispose:void 0,object:m},u)):null}));var Sr=r(4466);const Tr=i.forwardRef(((e,t)=>{const r=(0,s.useThree)((({camera:e})=>e)),o=(0,s.useThree)((({gl:e})=>e)),[a]=i.useState((()=>new Sr.o(r,o.domElement)));return(0,s.useFrame)(((e,t)=>{a.update(t)})),a?i.createElement("primitive",(0,n.Z)({ref:t,object:a},e)):null}));var Mr=r(1869);const Ir="#f0f0f0",Br="#999",_r="black",Fr="black",Pr=["Right","Left","Top","Bottom","Front","Back"],Rr=e=>new a.Vector3(...e).multiplyScalar(.38),Lr=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(Rr),Dr=[.25,.25,.25],Nr=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(Rr),kr=Nr.map((e=>e.toArray().map((e=>0==e?.5:.25)))),Or=({hover:e,index:t,font:r="20px Inter var, Arial, sans-serif",faces:n=Pr,color:o=Ir,hoverColor:l=Br,textColor:c=_r,strokeColor:u=Fr,opacity:h=1})=>{const d=(0,s.useThree)((e=>e.gl)),f=i.useMemo((()=>{const e=document.createElement("canvas");e.width=128,e.height=128;const i=e.getContext("2d");return i.fillStyle=o,i.fillRect(0,0,e.width,e.height),i.strokeStyle=u,i.strokeRect(0,0,e.width,e.height),i.font=r,i.textAlign="center",i.fillStyle=c,i.fillText(n[t].toUpperCase(),64,76),new a.CanvasTexture(e)}),[t,n,r,o,c,u]);return i.createElement("meshLambertMaterial",{map:f,"map-anisotropy":d.capabilities.getMaxAnisotropy()||1,attachArray:"material",color:e?l:"white",transparent:!0,opacity:h})},Ur=e=>{const{tweenCamera:t,raycast:r}=(0,Mr.L)(),[o,a]=i.useState(null);return i.createElement("mesh",{raycast:r,onPointerOut:e=>{e.stopPropagation(),a(null)},onPointerMove:e=>{e.stopPropagation(),a(Math.floor(e.faceIndex/2))},onClick:e.onClick||(e=>{e.stopPropagation(),t(e.face.normal)})},[...Array(6)].map(((t,r)=>i.createElement(Or,(0,n.Z)({key:r,index:r,hover:o===r},e)))),i.createElement("boxGeometry",null))},Qr=({onClick:e,dimensions:t,position:r,hoverColor:n=Br})=>{const{tweenCamera:o,raycast:a}=(0,Mr.L)(),[s,l]=i.useState(!1);return i.createElement("mesh",{scale:1.01,position:r,raycast:a,onPointerOver:e=>{e.stopPropagation(),l(!0)},onPointerOut:e=>{e.stopPropagation(),l(!1)},onClick:e||(e=>{e.stopPropagation(),o(r)})},i.createElement("meshBasicMaterial",{color:s?n:"white",transparent:!0,opacity:.6,visible:s}),i.createElement("boxGeometry",{args:t}))},Vr=e=>i.createElement("group",{scale:[60,60,60]},i.createElement(Ur,e),Nr.map(((t,r)=>i.createElement(Qr,(0,n.Z)({key:r,position:t,dimensions:kr[r]},e)))),Lr.map(((t,r)=>i.createElement(Qr,(0,n.Z)({key:r,position:t,dimensions:Dr},e)))),i.createElement("ambientLight",{intensity:.5}),i.createElement("pointLight",{position:[10,10,10],intensity:.5}));var Gr=r(4064);function zr(e,{path:t}){const[r]=(0,s.useLoader)(a.CubeTextureLoader,[e],(e=>e.setPath(t)));return r}zr.preload=(e,{path:t})=>s.useLoader.preload(a.CubeTextureLoader,[e],(e=>e.setPath(t)));var jr=r(5139);function Hr(e){return(0,s.useLoader)(jr.y,e)}Hr.preload=e=>s.useLoader.preload(jr.y,e),Hr.clear=e=>s.useLoader.clear(jr.y,e);var Wr=r(1771),Zr=r(1787),Xr=r(8569);let Yr=null;function Jr(e,t,r){return n=>{r&&r(n),e&&(Yr||(Yr=new Wr._),Yr.setDecoderPath("string"===typeof e?e:"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),n.setDRACOLoader(Yr)),t&&n.setMeshoptDecoder("function"===typeof Zr.z?(0,Zr.z)():Zr.z)}}function qr(e,t=!0,r=!0,n){return(0,s.useLoader)(Xr.E,e,Jr(t,r,n))}qr.preload=(e,t=!0,r=!0,n)=>s.useLoader.preload(Xr.E,e,Jr(t,r,n)),qr.clear=e=>s.useLoader.clear(Xr.E,e);var Kr=r(3994);const $r="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function en(e,t=`${$r}/basis/`){const r=(0,s.useThree)((e=>e.gl)),n=(0,s.useLoader)(Kr.a,Kt(e)?Object.values(e):e,(e=>{e.detectSupport(r),e.setTranscoderPath(t)}));if((0,i.useEffect)((()=>{(Array.isArray(n)?n:[n]).forEach(r.initTexture)}),[r,n]),Kt(e)){const t=Object.keys(e),r={};return t.forEach((e=>Object.assign(r,{[e]:n[t.indexOf(e)]}))),r}return n}en.preload=(e,t=`${$r}/basis/`)=>s.useLoader.preload(Kr.a,e,(e=>{e.setTranscoderPath(t)})),en.clear=e=>s.useLoader.clear(Kr.a,e);var tn=r(7443),rn=r.n(tn);function nn(e,t){"function"===typeof e?e(t):null!=e&&(e.current=t)}function on({showPanel:e=0,className:t,parent:r}){const n=function(e,t=[],r){const[n,o]=i.useState();return i.useLayoutEffect((()=>{const t=e();return o(t),nn(r,t),()=>nn(r,null)}),t),n}((()=>new(rn())),[]);return i.useEffect((()=>{if(n){const i=r&&r.current||document.body;n.showPanel(e),null==i||i.appendChild(n.dom),t&&n.dom.classList.add(t);const o=(0,s.addEffect)((()=>n.begin())),a=(0,s.addAfterEffect)((()=>n.end()));return()=>{null==i||i.removeChild(n.dom),o(),a()}}}),[r,n,t,e]),null}function an(e,t,r){const n=(0,s.useThree)((({gl:e})=>e)),o=(0,s.useThree)((({size:e})=>e)),l=(0,i.useMemo)((()=>n.getPixelRatio()),[n]),c="number"===typeof e?e:o.width*l,u="number"===typeof t?t:o.height*l,h=("number"===typeof e?r:e)||{},d=(0,i.useMemo)((()=>{const{multisample:e,samples:t,...r}=h;let i;return e&&n.capabilities.isWebGL2?(i=new a.WebGLMultisampleRenderTarget(c,u,r),t&&(i.samples=t)):i=new a.WebGLRenderTarget(c,u,r),i}),[]);return(0,i.useEffect)((()=>{d.setSize(c,u)}),[d,c,u]),(0,i.useEffect)((()=>()=>d.dispose()),[]),d}function sn({size:e=256,frames:t=1/0}={}){const r=(0,s.useThree)((e=>e.viewport.dpr)),{width:n,height:o}=(0,s.useThree)((e=>e.size)),l=e||n*r,c=e||o*r,u=i.useMemo((()=>{const e=new a.DepthTexture(l,c);return e.format=a.DepthFormat,e.type=a.UnsignedShortType,{depthTexture:e}}),[l,c]);let h=0;const d=an(l,c,u);return(0,s.useFrame)((e=>{(t===1/0||h<t)&&(e.gl.setRenderTarget(d),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(null),h++)})),d.depthTexture}function ln(e,t,r=1){const n=(0,s.useThree)((e=>e.viewport)),i=t*(n.aspect>e/t?n.width/e:n.height/t);return[e*(n.aspect>e/t?n.width/e:n.height/t)*r,i*r,1]}var cn=r(7129);function un(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))}const hn=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","radeon r9 200","sgx 543","sgx543"],dn=e=>e.toLowerCase().replace(/^angle ?\((.+)\)*$/,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,""),fn="undefined"==typeof window,pn=(()=>{if(fn)return;const{userAgent:e,platform:t,maxTouchPoints:r}=window.navigator,n=/(iphone|ipod|ipad)/i.test(e),i="iPad"===t||"MacIntel"===t&&r>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(e)||n||i,isSafari12:/Version\/12.+Safari/.test(e)}})(),mn=[],gn=[],An=(e,t)=>{if(e===t)return 0;const r=e;e.length>t.length&&(e=t,t=r);let n=e.length,i=t.length;for(;n>0&&e.charCodeAt(~-n)===t.charCodeAt(~-i);)n--,i--;let o,a=0;for(;a<n&&e.charCodeAt(a)===t.charCodeAt(a);)a++;if(n-=a,i-=a,0===n)return i;let s,l,c=0,u=0,h=0;for(;u<n;)gn[u]=e.charCodeAt(a+u),mn[u]=++u;for(;h<i;)for(o=t.charCodeAt(a+h),s=h++,c=h,u=0;u<n;u++)l=o===gn[u]?s:s+1,s=mn[u],c=mn[u]=s>c?l>c?c+1:l:l>s?s+1:l;return c},vn=({mobileTiers:e=[0,15,30,60],desktopTiers:t=[0,15,30,60],override:r={},glContext:n,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:o="https://unpkg.com/detect-gpu@3.1.30/dist/benchmarks"}={})=>un(void 0,void 0,void 0,(function*(){const a={};if(fn)return{tier:0,type:"SSR"};const{isIpad:s=!!(null==pn?void 0:pn.isIpad),isMobile:l=!!(null==pn?void 0:pn.isMobile),screenSize:c=window.screen,loadBenchmarks:u=(e=>un(void 0,void 0,void 0,(function*(){const t=yield fetch(`${o}/${e}`).then((e=>e.json()));return t.shift(),t})))}=r;let{renderer:h}=r;const d=(e,t,r,n,i)=>({device:i,fps:n,gpu:r,isMobile:l,tier:e,type:t});let f,p="";if(h)h=dn(h),f=[h];else{const e=n||((e,t=!1)=>{const r={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:t,powerPreference:"high-performance",stencil:!1};e&&delete r.powerPreference;const n=window.document.createElement("canvas"),i=n.getContext("webgl",r)||n.getContext("experimental-webgl",r);return null!=i?i:void 0})(null==pn?void 0:pn.isSafari12,i);if(!e)return d(0,"WEBGL_UNSUPPORTED");const t=e.getExtension("WEBGL_debug_renderer_info");if(t&&(h=e.getParameter(t.UNMASKED_RENDERER_WEBGL)),!h)return d(1,"FALLBACK");p=h,h=dn(h),f=((e,t,r)=>"apple gpu"===t?((e,t,r)=>{let n=[t];if(r){const t="\n      precision highp float;\n      attribute vec3 aPosition;\n      varying float vvv;\n      void main() {\n        vvv = 0.31622776601683794;\n        gl_Position = vec4(aPosition, 1.0);\n      }\n    ",r="\n      precision highp float;\n      varying float vvv;\n      void main() {\n        vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n        enc = fract(enc);\n        enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n        gl_FragColor = enc;\n      }\n    ",i=e.createShader(35633),o=e.createShader(35632),a=e.createProgram();if(o&&i&&a){e.shaderSource(i,t),e.shaderSource(o,r),e.compileShader(i),e.compileShader(o),e.attachShader(a,i),e.attachShader(a,o),e.linkProgram(a),e.detachShader(a,i),e.detachShader(a,o),e.deleteShader(i),e.deleteShader(o),e.useProgram(a);const s=e.createBuffer();e.bindBuffer(34962,s),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const l=e.getAttribLocation(a,"aPosition");e.vertexAttribPointer(l,3,5126,!1,0,0),e.enableVertexAttribArray(l),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);const c=new Uint8Array(4);e.readPixels(0,0,1,1,6408,5121,c),e.deleteProgram(a),e.deleteBuffer(s),n={801621810:(null==pn?void 0:pn.isIpad)?["apple a12x gpu"]:["apple a11 gpu","apple a12 gpu","apple a13 gpu","apple a14 gpu"],8016218135:(null==pn?void 0:pn.isIpad)?["apple a9x gpu","apple a10 gpu","apple a10x gpu"]:["apple a9 gpu","apple a10 gpu"]}[c.join("")]||n}}return n})(e,t,r):[t])(e,h,l)}const m=(yield Promise.all(f.map((e=>un(void 0,void 0,void 0,(function*(){const t=(e=>{const t=l?["adreno","apple","mali-t","mali","nvidia","powervr"]:["intel","amd","radeon","nvidia","geforce"];for(const r of t)if(e.includes(r))return r})(e);if(!t)return;const r=`${l?"m":"d"}-${t}.json`,n=a[r]=a[r]||u(r);let i;try{i=yield n}catch(t){return}const o=(e=>{var t;const r=(e=e.replace(/\([^)]+\)/,"")).match(/\d+/)||e.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(t=null==r?void 0:r.join("").replace(/\W|amd/g,""))&&void 0!==t?t:""})(e),h="apple"===t;let d=i.filter((([,e])=>e===o));d.length||(d=i.filter((([t])=>t.includes(e))));const f=d.length;if(0===f)return;let p,[m,,,g]=f>1?d.map((t=>[t,An(e,t[0])])).sort((([,e],[,t])=>e-t))[0][0]:d[0],A=Number.MAX_VALUE;const{devicePixelRatio:v}=window,y=c.width*v*(c.height*v);h&&l&&(g=g.filter((([,,,e])=>{var t;return(null!==(t=null==e?void 0:e.indexOf(s?"ipad":"iphone"))&&void 0!==t?t:-1)>-1})));for(const e of g){const[t,r]=e,n=t*r,i=Math.abs(y-n);i<A&&(A=i,p=e)}if(!p)return;const[,,x,b]=p;return[A,x,m,b]})))))).filter((e=>!!e));if(!m.length){const e=hn.find((e=>h.includes(e)));return e?d(0,"BLOCKLISTED",e):d(1,"FALLBACK",`${h} (${p})`)}const[,g,A,v]=m.sort((([e=Number.MAX_VALUE],[t=Number.MAX_VALUE])=>e-t))[0];if(-1===g)return d(0,"BLOCKLISTED",A,g,v);const y=l?e:t;let x=0;for(let e=0;e<y.length;e++)g>=y[e]&&(x=e);return d(x,"BENCHMARK",A,g,v)}));var yn=r(1860);const xn=e=>(0,yn.G)((()=>vn(e)),"useDetectGPU");function bn(e,t,...r){const n=i.useRef(),o=(0,s.useThree)((e=>e.scene));return i.useEffect((()=>(t&&e.current&&(n.current=new t(e.current,...r),n.current&&o.add(n.current)),()=>{n.current&&o.remove(n.current)})),[o,t,e,r]),(0,s.useFrame)((()=>{var e;null!=(e=n.current)&&e.update&&n.current.update()})),n}const wn=new a.Vector3,Cn=new a.Vector3,En=new a.Vector3,Sn=new a.Vector2,Tn=new a.Vector2,Mn=new a.Vector2,In=new a.Vector3;function Bn(e,t,r,n,i,o,s){wn.fromBufferAttribute(t,n),Cn.fromBufferAttribute(t,i),En.fromBufferAttribute(t,o);const l=function(e,t,r,n,i,o){let s;return s=o===a.BackSide?e.intersectTriangle(n,r,t,!0,i):e.intersectTriangle(t,r,n,o!==a.DoubleSide,i),null===s?null:{distance:e.origin.distanceTo(i),point:i.clone()}}(e,wn,Cn,En,In,s);if(l){r&&(Sn.fromBufferAttribute(r,n),Tn.fromBufferAttribute(r,i),Mn.fromBufferAttribute(r,o),l.uv=a.Triangle.getUV(In,wn,Cn,En,Sn,Tn,Mn,new a.Vector2));const e={a:n,b:i,c:o,normal:new a.Vector3,materialIndex:0};a.Triangle.getNormal(wn,Cn,En,e.normal),l.face=e,l.faceIndex=n}return l}function _n(e,t,r,n,i){const o=3*n,a=e.index.getX(o),s=e.index.getX(o+1),l=e.index.getX(o+2),c=Bn(r,e.attributes.position,e.attributes.uv,a,s,l,t);return c?(c.faceIndex=n,i&&i.push(c),c):null}function Fn(e,t,r){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(r.ray.origin),e.object=t,e.distance<r.near||e.distance>r.far?null:e)}const Pn=1.25,Rn=65535,Ln=Math.pow(2,-24);class Dn{constructor(){}}function Nn(e,t,r){return r.min.x=t[e],r.min.y=t[e+1],r.min.z=t[e+2],r.max.x=t[e+3],r.max.y=t[e+4],r.max.z=t[e+5],r}function kn(e){let t=-1,r=-1/0;for(let n=0;n<3;n++){const i=e[n+3]-e[n];i>r&&(r=i,t=n)}return t}function On(e,t){t.set(e)}function Un(e,t,r){let n,i;for(let o=0;o<3;o++){const a=o+3;n=e[o],i=t[o],r[o]=n<i?n:i,n=e[a],i=t[a],r[a]=n>i?n:i}}function Qn(e,t,r){for(let n=0;n<3;n++){const i=t[e+2*n],o=t[e+2*n+1],a=i-o,s=i+o;a<r[n]&&(r[n]=a),s>r[n+3]&&(r[n+3]=s)}}function Vn(e){const t=e[3]-e[0],r=e[4]-e[1],n=e[5]-e[2];return 2*(t*r+r*n+n*t)}function Gn(e,t,r,n,i=null){let o=1/0,a=1/0,s=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,f=1/0,p=-1/0,m=-1/0,g=-1/0;const A=null!==i;for(let v=6*t,y=6*(t+r);v<y;v+=6){const t=e[v+0],r=e[v+1],n=t-r,i=t+r;n<o&&(o=n),i>l&&(l=i),A&&t<h&&(h=t),A&&t>p&&(p=t);const y=e[v+2],x=e[v+3],b=y-x,w=y+x;b<a&&(a=b),w>c&&(c=w),A&&y<d&&(d=y),A&&y>m&&(m=y);const C=e[v+4],E=e[v+5],S=C-E,T=C+E;S<s&&(s=S),T>u&&(u=T),A&&C<f&&(f=C),A&&C>g&&(g=C)}n[0]=o,n[1]=a,n[2]=s,n[3]=l,n[4]=c,n[5]=u,A&&(i[0]=h,i[1]=d,i[2]=f,i[3]=p,i[4]=m,i[5]=g)}const zn=32,jn=(e,t)=>e.candidate-t.candidate,Hn=new Array(zn).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),Wn=new Float32Array(6);function Zn(e,t){function r(e){f&&f(e/p)}function n(t,i,a,f=null,p=0){if(!m&&p>=c&&(m=!0,u&&(console.warn(`MeshBVH: Max depth of ${c} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),a<=h||p>=c)return r(i),t.offset=i,t.count=a,t;const g=function(e,t,r,n,i,o){let a=-1,s=0;if(0===o)a=kn(t),-1!==a&&(s=(t[a]+t[a+3])/2);else if(1===o)a=kn(e),-1!==a&&(s=function(e,t,r,n){let i=0;for(let o=t,a=t+r;o<a;o++)i+=e[6*o+2*n];return i/r}(r,n,i,a));else if(2===o){const o=Vn(e);let l=Pn*i;const c=6*n,u=6*(n+i);for(let e=0;e<3;e++){const n=t[e],h=(t[e+3]-n)/zn;if(i<8){const t=[...Hn];t.length=i;let n=0;for(let i=c;i<u;i+=6,n++){const o=t[n];o.candidate=r[i+2*e],o.count=0;const{bounds:a,leftCacheBounds:s,rightCacheBounds:l}=o;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0;Qn(i,r,a)}t.sort(jn);let h=i;for(let e=0;e<h;e++){const r=t[e];for(;e+1<h&&t[e+1].candidate===r.candidate;)t.splice(e+1,1),h--}for(let i=c;i<u;i+=6){const n=r[i+2*e];for(let e=0;e<h;e++){const o=t[e];n>=o.candidate?Qn(i,r,o.rightCacheBounds):(Qn(i,r,o.leftCacheBounds),o.count++)}}for(let r=0;r<h;r++){const n=t[r],c=n.count,u=i-n.count,h=n.leftCacheBounds,d=n.rightCacheBounds;let f=0;0!==c&&(f=Vn(h)/o);let p=0;0!==u&&(p=Vn(d)/o);const m=1+Pn*(f*c+p*u);m<l&&(a=e,l=m,s=n.candidate)}}else{for(let e=0;e<zn;e++){const t=Hn[e];t.count=0,t.candidate=n+h+e*h;const r=t.bounds;for(let e=0;e<3;e++)r[e]=1/0,r[e+3]=-1/0}for(let i=c;i<u;i+=6){let t=~~((r[i+2*e]-n)/h);t>=zn&&(t=31);const o=Hn[t];o.count++,Qn(i,r,o.bounds)}const t=Hn[31];On(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){const t=Hn[e],r=Hn[e+1];Un(t.bounds,r.rightCacheBounds,t.rightCacheBounds)}let d=0;for(let r=0;r<31;r++){const t=Hn[r],n=t.count,c=t.bounds,u=Hn[r+1].rightCacheBounds;0!==n&&(0===d?On(c,Wn):Un(c,Wn,Wn)),d+=n;let h=0,f=0;0!==d&&(h=Vn(Wn)/o);const p=i-d;0!==p&&(f=Vn(u)/o);const m=1+Pn*(h*d+f*p);m<l&&(a=e,l=m,s=t.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:a,pos:s}}(t.boundingData,f,s,i,a,d);if(-1===g.axis)return r(i),t.offset=i,t.count=a,t;const A=function(e,t,r,n,i){let o=r,a=r+n-1;const s=i.pos,l=2*i.axis;for(;;){for(;o<=a&&t[6*o+l]<s;)o++;for(;o<=a&&t[6*a+l]>=s;)a--;if(!(o<a))return o;for(let r=0;r<3;r++){let n=e[3*o+r];e[3*o+r]=e[3*a+r],e[3*a+r]=n;let i=t[6*o+2*r+0];t[6*o+2*r+0]=t[6*a+2*r+0],t[6*a+2*r+0]=i;let s=t[6*o+2*r+1];t[6*o+2*r+1]=t[6*a+2*r+1],t[6*a+2*r+1]=s}o++,a--}}(l,s,i,a,g);if(A===i||A===i+a)r(i),t.offset=i,t.count=a;else{t.splitAxis=g.axis;const e=new Dn,r=i,l=A-i;t.left=e,e.boundingData=new Float32Array(6),Gn(s,r,l,e.boundingData,o),n(e,r,l,o,p+1);const c=new Dn,u=A,h=a-l;t.right=c,c.boundingData=new Float32Array(6),Gn(s,u,h,c.boundingData,o),n(c,u,h,o,p+1)}return t}!function(e,t){if(!e.index){const r=e.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let i;i=r>65535?new Uint32Array(new n(4*r)):new Uint16Array(new n(2*r)),e.setIndex(new a.BufferAttribute(i,1));for(let e=0;e<r;e++)i[e]=e}}(e,t);const i=new Float32Array(6),o=new Float32Array(6),s=function(e,t){const r=e.attributes.position,n=r.array,i=e.index.array,o=i.length/3,a=new Float32Array(6*o),s=r.offset||0;let l=3;r.isInterleavedBufferAttribute&&(l=r.data.stride);for(let c=0;c<o;c++){const e=3*c,r=6*c,o=i[e+0]*l+s,u=i[e+1]*l+s,h=i[e+2]*l+s;for(let i=0;i<3;i++){const e=n[o+i],s=n[u+i],l=n[h+i];let c=e;s<c&&(c=s),l<c&&(c=l);let d=e;s>d&&(d=s),l>d&&(d=l);const f=(d-c)/2,p=2*i;a[r+p+0]=c+f,a[r+p+1]=f+(Math.abs(c)+f)*Ln,c<t[i]&&(t[i]=c),d>t[i+3]&&(t[i+3]=d)}}return a}(e,i),l=e.index.array,c=t.maxDepth,u=t.verbose,h=t.maxLeafTris,d=t.strategy,f=t.onProgress,p=e.index.count/3;let m=!1;const g=[],A=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];const t=[],r=new Set;for(const i of e.groups)r.add(i.start),r.add(i.start+i.count);const n=Array.from(r.values()).sort(((e,t)=>e-t));for(let i=0;i<n.length-1;i++){const e=n[i],r=n[i+1];t.push({offset:e/3,count:(r-e)/3})}return t}(e);if(1===A.length){const e=A[0],t=new Dn;t.boundingData=i,function(e,t,r,n){let i=1/0,o=1/0,a=1/0,s=-1/0,l=-1/0,c=-1/0;for(let u=6*t,h=6*(t+r);u<h;u+=6){const t=e[u+0];t<i&&(i=t),t>s&&(s=t);const r=e[u+2];r<o&&(o=r),r>l&&(l=r);const n=e[u+4];n<a&&(a=n),n>c&&(c=n)}n[0]=i,n[1]=o,n[2]=a,n[3]=s,n[4]=l,n[5]=c}(s,e.offset,e.count,o),n(t,e.offset,e.count,o),g.push(t)}else for(let a of A){const e=new Dn;e.boundingData=new Float32Array(6),Gn(s,a.offset,a.count,e.boundingData,o),n(e,a.offset,a.count,o),g.push(e)}return g}class Xn{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let r=1/0,n=-1/0;for(let i=0,o=e.length;i<o;i++){const o=e[i][t];r=o<r?o:r,n=o>n?o:n}this.min=r,this.max=n}setFromPoints(e,t){let r=1/0,n=-1/0;for(let i=0,o=t.length;i<o;i++){const o=t[i],a=e.dot(o);r=a<r?a:r,n=a>n?a:n}this.min=r,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}}Xn.prototype.setFromBox=function(){const e=new a.Vector3;return function(t,r){const n=r.min,i=r.max;let o=1/0,a=-1/0;for(let s=0;s<=1;s++)for(let r=0;r<=1;r++)for(let l=0;l<=1;l++){e.x=n.x*s+i.x*(1-s),e.y=n.y*r+i.y*(1-r),e.z=n.z*l+i.z*(1-l);const c=t.dot(e);o=Math.min(c,o),a=Math.max(c,a)}this.min=o,this.max=a}}();!function(){const e=new Xn}();const Yn=function(){const e=new a.Vector3,t=new a.Vector3,r=new a.Vector3;return function(n,i,o){const a=n.start,s=e,l=i.start,c=t;r.subVectors(a,l),e.subVectors(n.end,i.start),t.subVectors(i.end,i.start);const u=r.dot(c),h=c.dot(s),d=c.dot(c),f=r.dot(s),p=s.dot(s)*d-h*h;let m,g;m=0!==p?(u*h-f*d)/p:0,g=(u+m*h)/d,o.x=m,o.y=g}}(),Jn=function(){const e=new a.Vector2,t=new a.Vector3,r=new a.Vector3;return function(n,i,o,a){Yn(n,i,e);let s=e.x,l=e.y;if(s>=0&&s<=1&&l>=0&&l<=1)return n.at(s,o),void i.at(l,a);if(s>=0&&s<=1)return l<0?i.at(0,a):i.at(1,a),void n.closestPointToPoint(a,!0,o);if(l>=0&&l<=1)return s<0?n.at(0,o):n.at(1,o),void i.closestPointToPoint(o,!0,a);{let e,c;e=s<0?n.start:n.end,c=l<0?i.start:i.end;const u=t,h=r;return n.closestPointToPoint(c,!0,t),i.closestPointToPoint(e,!0,r),u.distanceToSquared(c)<=h.distanceToSquared(e)?(o.copy(u),void a.copy(c)):(o.copy(e),void a.copy(h))}}}(),qn=function(){const e=new a.Vector3,t=new a.Vector3,r=new a.Plane,n=new a.Line3;return function(i,o){const{radius:a,center:s}=i,{a:l,b:c,c:u}=o;n.start=l,n.end=c;if(n.closestPointToPoint(s,!0,e).distanceTo(s)<=a)return!0;n.start=l,n.end=u;if(n.closestPointToPoint(s,!0,e).distanceTo(s)<=a)return!0;n.start=c,n.end=u;if(n.closestPointToPoint(s,!0,e).distanceTo(s)<=a)return!0;const h=o.getPlane(r);if(Math.abs(h.distanceToPoint(s))<=a){const e=h.projectPoint(s,t);if(o.containsPoint(e))return!0}return!1}}();class Kn extends a.Triangle{constructor(...e){super(...e),this.isSeparatingAxisTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new a.Vector3)),this.satBounds=new Array(4).fill().map((()=>new Xn)),this.points=[this.a,this.b,this.c],this.sphere=new a.Sphere,this.plane=new a.Plane,this.needsUpdate=!1}intersectsSphere(e){return qn(e,this)}update(){const e=this.a,t=this.b,r=this.c,n=this.points,i=this.satAxes,o=this.satBounds,a=i[0],s=o[0];this.getNormal(a),s.setFromPoints(a,n);const l=i[1],c=o[1];l.subVectors(e,t),c.setFromPoints(l,n);const u=i[2],h=o[2];u.subVectors(t,r),h.setFromPoints(u,n);const d=i[3],f=o[3];d.subVectors(r,e),f.setFromPoints(d,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}Kn.prototype.closestPointToSegment=function(){const e=new a.Vector3,t=new a.Vector3,r=new a.Line3;return function(n,i=null,o=null){const{start:a,end:s}=n,l=this.points;let c,u=1/0;for(let h=0;h<3;h++){const a=(h+1)%3;r.start.copy(l[h]),r.end.copy(l[a]),Jn(r,n,e,t),c=e.distanceToSquared(t),c<u&&(u=c,i&&i.copy(e),o&&o.copy(t))}return this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<u&&(u=c,i&&i.copy(e),o&&o.copy(a)),this.closestPointToPoint(s,e),c=s.distanceToSquared(e),c<u&&(u=c,i&&i.copy(e),o&&o.copy(s)),Math.sqrt(u)}}(),Kn.prototype.intersectsTriangle=function(){const e=new Kn,t=new Array(3),r=new Array(3),n=new Xn,i=new Xn,o=new a.Vector3,s=new a.Vector3,l=new a.Vector3,c=new a.Vector3,u=new a.Line3,h=new a.Line3,d=new a.Line3;return function(a,f=null){this.needsUpdate&&this.update(),a.isSeparatingAxisTriangle?a.needsUpdate&&a.update():(e.copy(a),e.update(),a=e);const p=this.satBounds,m=this.satAxes;r[0]=a.a,r[1]=a.b,r[2]=a.c;for(let e=0;e<4;e++){const t=p[e],i=m[e];if(n.setFromPoints(i,r),t.isSeparated(n))return!1}const g=a.satBounds,A=a.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){const r=g[e],i=A[e];if(n.setFromPoints(i,t),r.isSeparated(n))return!1}for(let e=0;e<4;e++){const a=m[e];for(let e=0;e<4;e++){const s=A[e];if(o.crossVectors(a,s),n.setFromPoints(o,t),i.setFromPoints(o,r),n.isSeparated(i))return!1}}if(f){const e=this.plane,t=a.plane;if(Math.abs(e.normal.dot(t.normal))>1-1e-10)console.warn("SeparatingAxisTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),f.start.set(0,0,0),f.end.set(0,0,0);else{const r=this.points;let n=!1;for(let e=0;e<3;e++){const i=r[e],o=r[(e+1)%3];if(u.start.copy(i),u.end.copy(o),t.intersectLine(u,n?h.start:h.end)){if(n)break;n=!0}}const i=a.points;let o=!1;for(let t=0;t<3;t++){const r=i[t],n=i[(t+1)%3];if(u.start.copy(r),u.end.copy(n),e.intersectLine(u,o?d.start:d.end)){if(o)break;o=!0}}if(h.delta(s),d.delta(l),s.dot(l)<0){let e=d.start;d.start=d.end,d.end=e}c.subVectors(h.start,d.start),c.dot(s)>0?f.start.copy(h.start):f.start.copy(d.start),c.subVectors(h.end,d.end),c.dot(s)<0?f.end.copy(h.end):f.end.copy(d.end)}}return!0}}(),Kn.prototype.distanceToPoint=function(){const e=new a.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Kn.prototype.distanceToTriangle=function(){const e=new a.Vector3,t=new a.Vector3,r=["a","b","c"],n=new a.Line3,i=new a.Line3;return function(o,a=null,s=null){const l=a||s?n:null;if(this.intersectsTriangle(o,l))return(a||s)&&(a&&l.getCenter(a),s&&l.getCenter(s)),0;let c=1/0;for(let t=0;t<3;t++){let n;const i=r[t],l=o[i];this.closestPointToPoint(l,e),n=l.distanceToSquared(e),n<c&&(c=n,a&&a.copy(e),s&&s.copy(l));const u=this[i];o.closestPointToPoint(u,e),n=u.distanceToSquared(e),n<c&&(c=n,a&&a.copy(u),s&&s.copy(e))}for(let u=0;u<3;u++){const l=r[u],h=r[(u+1)%3];n.set(this[l],this[h]);for(let u=0;u<3;u++){const l=r[u],h=r[(u+1)%3];i.set(o[l],o[h]),Jn(n,i,e,t);const d=e.distanceToSquared(t);d<c&&(c=d,a&&a.copy(e),s&&s.copy(t))}}return Math.sqrt(c)}}();class $n extends a.Box3{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new a.Matrix4,this.invMatrix=new a.Matrix4,this.points=new Array(8).fill().map((()=>new a.Vector3)),this.satAxes=new Array(3).fill().map((()=>new a.Vector3)),this.satBounds=new Array(3).fill().map((()=>new Xn)),this.alignedSatBounds=new Array(3).fill().map((()=>new Xn)),this.needsUpdate=!1}set(e,t,r){super.set(e,t),this.matrix=r,this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}function ei(e,t,r,n){const i=e.a,o=e.b,a=e.c;let s=t,l=t+1,c=t+2;r&&(s=r.getX(t),l=r.getX(t+1),c=r.getX(t+2)),i.x=n.getX(s),i.y=n.getY(s),i.z=n.getZ(s),o.x=n.getX(l),o.y=n.getY(l),o.z=n.getZ(l),a.x=n.getX(c),a.y=n.getY(c),a.z=n.getZ(c)}function ti(e,t,r,n,i,o,a){const s=r.index,l=r.attributes.position;for(let c=e,u=t+e;c<u;c++)if(ei(a,3*c,s,l),a.needsUpdate=!0,n(a,c,i,o))return!0;return!1}$n.prototype.update=function(){const e=this.matrix,t=this.min,r=this.max,n=this.points;for(let l=0;l<=1;l++)for(let i=0;i<=1;i++)for(let o=0;o<=1;o++){const a=n[1*l|2*i|4*o];a.x=l?r.x:t.x,a.y=i?r.y:t.y,a.z=o?r.z:t.z,a.applyMatrix4(e)}const i=this.satBounds,o=this.satAxes,a=n[0];for(let l=0;l<3;l++){const e=o[l],t=i[l],r=n[1<<l];e.subVectors(a,r),t.setFromPoints(e,n)}const s=this.alignedSatBounds;s[0].setFromPointsField(n,"x"),s[1].setFromPointsField(n,"y"),s[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},$n.prototype.intersectsBox=function(){const e=new Xn;return function(t){this.needsUpdate&&this.update();const r=t.min,n=t.max,i=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(e.min=r.x,e.max=n.x,a[0].isSeparated(e))return!1;if(e.min=r.y,e.max=n.y,a[1].isSeparated(e))return!1;if(e.min=r.z,e.max=n.z,a[2].isSeparated(e))return!1;for(let s=0;s<3;s++){const r=o[s],n=i[s];if(e.setFromBox(r,t),n.isSeparated(e))return!1}return!0}}(),$n.prototype.intersectsTriangle=function(){const e=new Kn,t=new Array(3),r=new Xn,n=new Xn,i=new a.Vector3;return function(o){this.needsUpdate&&this.update(),o.isSeparatingAxisTriangle?o.needsUpdate&&o.update():(e.copy(o),e.update(),o=e);const a=this.satBounds,s=this.satAxes;t[0]=o.a,t[1]=o.b,t[2]=o.c;for(let e=0;e<3;e++){const n=a[e],i=s[e];if(r.setFromPoints(i,t),n.isSeparated(r))return!1}const l=o.satBounds,c=o.satAxes,u=this.points;for(let e=0;e<3;e++){const t=l[e],n=c[e];if(r.setFromPoints(n,u),t.isSeparated(r))return!1}for(let e=0;e<3;e++){const o=s[e];for(let e=0;e<4;e++){const a=c[e];if(i.crossVectors(o,a),r.setFromPoints(i,t),n.setFromPoints(i,u),r.isSeparated(n))return!1}}return!0}}(),$n.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},$n.prototype.distanceToPoint=function(){const e=new a.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),$n.prototype.distanceToBox=function(){const e=["x","y","z"],t=new Array(12).fill().map((()=>new a.Line3)),r=new Array(12).fill().map((()=>new a.Line3)),n=new a.Vector3,i=new a.Vector3;return function(o,a=0,s=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(s||l)&&(o.getCenter(i),this.closestPointToPoint(i,n),o.closestPointToPoint(n,i),s&&s.copy(n),l&&l.copy(i)),0;const c=a*a,u=o.min,h=o.max,d=this.points;let f=1/0;for(let e=0;e<8;e++){const t=d[e];i.copy(t).clamp(u,h);const r=t.distanceToSquared(i);if(r<f&&(f=r,s&&s.copy(t),l&&l.copy(i),r<c))return Math.sqrt(r)}let p=0;for(let n=0;n<3;n++)for(let i=0;i<=1;i++)for(let o=0;o<=1;o++){const a=(n+1)%3,s=(n+2)%3,l=1<<n|i<<a|o<<s,c=d[i<<a|o<<s],f=d[l];t[p].set(c,f);const m=e[n],g=e[a],A=e[s],v=r[p],y=v.start,x=v.end;y[m]=u[m],y[g]=i?u[g]:h[g],y[A]=o?u[A]:h[g],x[m]=h[m],x[g]=i?u[g]:h[g],x[A]=o?u[A]:h[g],p++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let r=0;r<=1;r++){i.x=e?h.x:u.x,i.y=t?h.y:u.y,i.z=r?h.z:u.z,this.closestPointToPoint(i,n);const o=i.distanceToSquared(n);if(o<f&&(f=o,s&&s.copy(n),l&&l.copy(i),o<c))return Math.sqrt(o)}for(let e=0;e<12;e++){const o=t[e];for(let e=0;e<12;e++){const t=r[e];Jn(o,t,n,i);const a=n.distanceToSquared(i);if(a<f&&(f=a,s&&s.copy(n),l&&l.copy(i),a<c))return Math.sqrt(a)}}return Math.sqrt(f)}}();class ri{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function ni(e,t){return 65535===t[e+15]}function ii(e,t){return t[e+6]}function oi(e,t){return t[e+14]}function ai(e){return e+8}function si(e,t){return t[e+6]}const li=new a.Box3,ci=new a.Vector3,ui=["x","y","z"];function hi(e,t,r,n,i){let o=2*e,a=vi,s=yi,l=xi;if(ni(o,s)){!function(e,t,r,n,i,o){for(let a=n,s=n+i;a<s;a++)_n(e,t,r,a,o)}(t,r,n,ii(e,l),oi(o,s),i)}else{const o=ai(e);mi(o,a,n,ci)&&hi(o,t,r,n,i);const s=si(e,l);mi(s,a,n,ci)&&hi(s,t,r,n,i)}}function di(e,t,r,n){let i=2*e,o=vi,a=yi,s=xi;if(ni(i,a)){return function(e,t,r,n,i){let o=1/0,a=null;for(let s=n,l=n+i;s<l;s++){const n=_n(e,t,r,s);n&&n.distance<o&&(a=n,o=n.distance)}return a}(t,r,n,ii(e,s),oi(i,a))}{const i=function(e,t){return t[e+7]}(e,s),a=ui[i],l=n.direction[a]>=0;let c,u;l?(c=ai(e),u=si(e,s)):(c=si(e,s),u=ai(e));const h=mi(c,o,n,ci)?di(c,t,r,n):null;if(h){const e=h.point[a];if(l?e<=o[u+i]:e>=o[u+i+3])return h}const d=mi(u,o,n,ci)?di(u,t,r,n):null;return h&&d?h.distance<=d.distance?h:d:h||d||null}}const fi=function(){let e,t;const r=[],n=new ri((()=>new a.Box3));return function(...o){e=n.getPrimitive(),t=n.getPrimitive(),r.push(e,t);const a=i(...o);n.releasePrimitive(e),n.releasePrimitive(t),r.pop(),r.pop();const s=r.length;return s>0&&(t=r[s-1],e=r[s-2]),a};function i(r,n,o,a,s=null,l=0,c=0){function u(e){let t=2*e,r=yi,n=xi;for(;!ni(t,r);)t=2*(e=ai(e));return ii(e,n)}function h(e){let t=2*e,r=yi,n=xi;for(;!ni(t,r);)t=2*(e=si(e,n));return ii(e,n)+oi(t,r)}let d=2*r,f=vi,p=yi,m=xi;if(ni(d,p)){const t=ii(r,m),n=oi(d,p);return Nn(r,f,e),a(t,n,!1,c,l+r,e)}{const d=ai(r),g=si(r,m);let A,v,y,x,b=d,w=g;if(s&&(y=e,x=t,Nn(b,f,y),Nn(w,f,x),A=s(y),v=s(x),v<A)){b=g,w=d;const e=A;A=v,v=e,y=x}y||(y=e,Nn(b,f,y));const C=o(y,ni(2*b,p),A,c+1,l+b);let E;if(2===C){const e=u(b);E=a(e,h(b)-e,!0,c+1,l+b,y)}else E=C&&i(b,n,o,a,s,l,c+1);if(E)return!0;x=t,Nn(w,f,x);const S=o(x,ni(2*w,p),v,c+1,l+w);let T;if(2===S){const e=u(w);T=a(e,h(w)-e,!0,c+1,l+w,x)}else T=S&&i(w,n,o,a,s,l,c+1);return!!T}}}(),pi=function(){const e=new Kn,t=new Kn,r=new a.Matrix4,n=new $n,i=new $n;return function o(a,s,l,c,u=null){let h=2*a,d=vi,f=yi,p=xi;null===u&&(l.boundingBox||l.computeBoundingBox(),n.set(l.boundingBox.min,l.boundingBox.max,c),u=n);if(!ni(h,f)){const e=a+8,t=p[a+6];Nn(e,d,li);if(u.intersectsBox(li)&&o(e,s,l,c,u))return!0;Nn(t,d,li);return!!(u.intersectsBox(li)&&o(t,s,l,c,u))}{const n=s,o=n.index,u=n.attributes.position,m=l.index,g=l.attributes.position,A=ii(a,p),v=oi(h,f);if(r.copy(c).invert(),l.boundsTree){Nn(a,d,i),i.matrix.copy(r),i.needsUpdate=!0;return l.boundsTree.shapecast({intersectsBounds:e=>i.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(c),e.b.applyMatrix4(c),e.c.applyMatrix4(c),e.needsUpdate=!0;for(let r=3*A,n=3*(v+A);r<n;r+=3)if(ei(t,r,o,u),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}})}for(let i=3*A,a=v+3*A;i<a;i+=3){ei(e,i,o,u),e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let r=0,n=m.count;r<n;r+=3)if(ei(t,r,m,g),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function mi(e,t,r,n){return Nn(e,t,li),r.intersectBox(li,n)}const gi=[];let Ai,vi,yi,xi;function bi(e){Ai&&gi.push(Ai),Ai=e,vi=new Float32Array(e),yi=new Uint16Array(e),xi=new Uint32Array(e)}function wi(){Ai=null,vi=null,yi=null,xi=null,gi.length&&bi(gi.pop())}const Ci=Symbol("skip tree generation"),Ei=new a.Box3,Si=new a.Box3,Ti=new a.Matrix4,Mi=new $n,Ii=new $n,Bi=new a.Vector3,_i=new a.Vector3,Fi=new a.Vector3,Pi=new a.Vector3,Ri=new a.Vector3,Li=new a.Box3,Di=new ri((()=>new Kn));class Ni{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Ni.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};const r=e.geometry,n=e._roots,i=r.getIndex();let o;return o=t.cloneBuffers?{roots:n.map((e=>e.slice())),index:i.array.slice()}:{roots:n,index:i.array},o}static deserialize(e,t,r={}){if("boolean"===typeof r)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Ni.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});r={setIndex:!0,...r};const{index:n,roots:i}=e,o=new Ni(t,{...r,[Ci]:!0});if(o._roots=i,r.setIndex){const r=t.getIndex();if(null===r){const r=new a.BufferAttribute(e.index,1,!1);t.setIndex(r)}else r.array!==n&&(r.array.set(n),r.needsUpdate=!0)}return o}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[Ci]:!1},t)).useSharedArrayBuffer&&"undefined"===typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[Ci]||(this._roots=function(e,t){const r=Zn(e,t);let n,i,o;const a=[],s=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<r.length;u++){const e=r[u],t=new s(32*l(e));n=new Float32Array(t),i=new Uint32Array(t),o=new Uint16Array(t),c(0,e),a.push(t)}return a;function l(e){return e.count?1:1+l(e.left)+l(e.right)}function c(e,t){const r=e/4,a=e/2,s=!!t.count,l=t.boundingData;for(let i=0;i<6;i++)n[r+i]=l[i];if(s){const n=t.offset,s=t.count;return i[r+6]=n,o[a+14]=s,o[a+15]=Rn,e+32}{const n=t.left,o=t.right,a=t.splitAxis;let s;if(s=c(e+32,n),s/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return i[r+6]=s/4,s=c(s,o),i[r+7]=a,s}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new a.Box3))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,r=t.index.array,n=t.attributes.position,i=n.array,o=n.offset||0;let a,s,l,c,u=3;n.isInterleavedBufferAttribute&&(u=n.data.stride);let h=0;const d=this._roots;for(let p=0,m=d.length;p<m;p++)a=d[p],s=new Uint32Array(a),l=new Uint16Array(a),c=new Float32Array(a),f(0,h),h+=a.byteLength;function f(t,n,a=!1){const h=2*t;if(l[h+15]===Rn){const e=s[t+6];let n=1/0,a=1/0,d=1/0,f=-1/0,p=-1/0,m=-1/0;for(let t=3*e,s=3*(e+l[h+14]);t<s;t++){const e=r[t]*u+o,s=i[e+0],l=i[e+1],c=i[e+2];s<n&&(n=s),s>f&&(f=s),l<a&&(a=l),l>p&&(p=l),c<d&&(d=c),c>m&&(m=c)}return(c[t+0]!==n||c[t+1]!==a||c[t+2]!==d||c[t+3]!==f||c[t+4]!==p||c[t+5]!==m)&&(c[t+0]=n,c[t+1]=a,c[t+2]=d,c[t+3]=f,c[t+4]=p,c[t+5]=m,!0)}{const r=t+8,i=s[t+6],o=r+n,l=i+n;let u=a,h=!1,d=!1;e?u||(h=e.has(o),d=e.has(l),u=!h&&!d):(h=!0,d=!0);const p=u||d;let m=!1;(u||h)&&(m=f(r,n,u));let g=!1;p&&(g=f(i,n,u));const A=m||g;if(A)for(let e=0;e<3;e++){const n=r+e,o=i+e,a=c[n],s=c[n+3],l=c[o],u=c[o+3];c[t+e]=a<l?a:l,c[t+e+3]=s>u?s:u}return A}}}traverse(e,t=0){const r=this._roots[t],n=new Uint32Array(r),i=new Uint16Array(r);!function t(o,a=0){const s=2*o,l=i[s+15]===Rn;if(l){const t=n[o+6],c=i[s+14];e(a,l,new Float32Array(r,4*o,6),t,c)}else{const i=o+8,s=n[o+6],c=n[o+7];e(a,l,new Float32Array(r,4*o,6),c)||(t(i,a+1),t(s,a+1))}}(0)}raycast(e,t=a.FrontSide){const r=this._roots,n=this.geometry,i=[],o=t.isMaterial,s=Array.isArray(t),l=n.groups,c=o?t.side:t;for(let a=0,u=r.length;a<u;a++){const o=s?t[l[a].materialIndex].side:c,u=i.length;if(bi(r[a]),hi(0,n,o,e,i),wi(),s){const e=l[a].materialIndex;for(let t=u,r=i.length;t<r;t++)i[t].face.materialIndex=e}}return i}raycastFirst(e,t=a.FrontSide){const r=this._roots,n=this.geometry,i=t.isMaterial,o=Array.isArray(t);let s=null;const l=n.groups,c=i?t.side:t;for(let a=0,u=r.length;a<u;a++){const i=o?t[l[a].materialIndex].side:c;bi(r[a]);const u=di(0,n,i,e);wi(),null!=u&&(null==s||u.distance<s.distance)&&(s=u,o&&(u.face.materialIndex=l[a].materialIndex))}return s}intersectsGeometry(e,t){const r=this.geometry;let n=!1;for(const i of this._roots)if(bi(i),n=pi(0,r,e,t),wi(),n)break;return n}shapecast(e,t,r){const n=this.geometry;if(e instanceof Function){if(t){const e=t;t=(t,r,n,i)=>{const o=3*r;return e(t,o,o+1,o+2,n,i)}}e={boundsTraverseOrder:r,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const i=Di.getPrimitive();let{boundsTraverseOrder:o,intersectsBounds:a,intersectsRange:s,intersectsTriangle:l}=e;if(s&&l){const e=s;s=(t,r,o,a,s)=>!!e(t,r,o,a,s)||ti(t,r,n,l,o,a,i)}else s||(s=l?(e,t,r,o)=>ti(e,t,n,l,r,o,i):(e,t,r)=>r);let c=!1,u=0;for(const h of this._roots){if(bi(h),c=fi(0,n,a,s,o,u),wi(),c)break;u+=h.byteLength}return Di.releasePrimitive(i),c}bvhcast(e,t,r){let{intersectsRanges:n,intersectsTriangles:i}=r;const o=this.geometry.index,a=this.geometry.attributes.position,s=e.geometry.index,l=e.geometry.attributes.position;Ti.copy(t).invert();const c=Di.getPrimitive(),u=Di.getPrimitive();if(i){function e(e,r,n,h,d,f,p,m){for(let g=n,A=n+h;g<A;g++){ei(u,3*g,s,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=e,n=e+r;t<n;t++)if(ei(c,3*t,o,a),c.needsUpdate=!0,i(c,u,t,g,d,f,p,m))return!0}return!1}if(n){const t=n;n=function(r,n,i,o,a,s,l,c){return!!t(r,n,i,o,a,s,l,c)||e(r,n,i,o,a,s,l,c)}}else n=e}this.getBoundingBox(Si),Si.applyMatrix4(t);const h=this.shapecast({intersectsBounds:e=>Si.intersectsBox(e),intersectsRange:(t,r,i,o,a,s)=>(Ei.copy(s),Ei.applyMatrix4(Ti),e.shapecast({intersectsBounds:e=>Ei.intersectsBox(e),intersectsRange:(e,i,s,l,c)=>n(t,r,e,i,o,a,l,c)}))});return Di.releasePrimitive(c),Di.releasePrimitive(u),h}intersectsBox(e,t){return Mi.set(e.min,e.max,t),Mi.needsUpdate=!0,this.shapecast({intersectsBounds:e=>Mi.intersectsBox(e),intersectsTriangle:e=>Mi.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,r={},n={},i=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Mi.set(e.boundingBox.min,e.boundingBox.max,t),Mi.needsUpdate=!0;const a=this.geometry,s=a.attributes.position,l=a.index,c=e.attributes.position,u=e.index,h=Di.getPrimitive(),d=Di.getPrimitive();let f=_i,p=Fi,m=null,g=null;n&&(m=Pi,g=Ri);let A=1/0,v=null,y=null;return Ti.copy(t).invert(),Ii.matrix.copy(Ti),this.shapecast({boundsTraverseOrder:e=>Mi.distanceToBox(e,Math.min(A,o)),intersectsBounds:(e,t,r)=>r<A&&r<o&&(t&&(Ii.min.copy(e.min),Ii.max.copy(e.max),Ii.needsUpdate=!0),!0),intersectsRange:(r,n)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>Ii.distanceToBox(e,Math.min(A,o)),intersectsBounds:(e,t,r)=>r<A&&r<o,intersectsRange:(e,o)=>{for(let a=3*e,x=3*(e+o);a<x;a+=3){ei(d,a,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let e=3*r,t=3*(r+n);e<t;e+=3){ei(h,e,l,s),h.needsUpdate=!0;const t=h.distanceToTriangle(d,f,m);if(t<A&&(p.copy(f),g&&g.copy(m),A=t,v=e/3,y=a/3),t<i)return!0}}}});for(let e=0,o=u?u.count:c.count;e<o;e+=3){ei(d,e,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let t=3*r,o=3*(r+n);t<o;t+=3){ei(h,t,l,s),h.needsUpdate=!0;const r=h.distanceToTriangle(d,f,m);if(r<A&&(p.copy(f),g&&g.copy(m),A=r,v=t/3,y=e/3),r<i)return!0}}}}),Di.releasePrimitive(h),Di.releasePrimitive(d),A===1/0?null:(r.point?r.point.copy(p):r.point=p.clone(),r.distance=A,r.faceIndex=v,n&&(n.point?n.point.copy(g):n.point=g.clone(),n.point.applyMatrix4(Ti),p.applyMatrix4(Ti),n.distance=p.sub(n.point).length(),n.faceIndex=y),r)}closestPointToPoint(e,t={},r=0,n=1/0){const i=r*r,o=n*n;let a=1/0,s=null;if(this.shapecast({boundsTraverseOrder:t=>(Bi.copy(e).clamp(t.min,t.max),Bi.distanceToSquared(e)),intersectsBounds:(e,t,r)=>r<a&&r<o,intersectsTriangle:(t,r)=>{t.closestPointToPoint(e,Bi);const n=e.distanceToSquared(Bi);return n<a&&(_i.copy(Bi),a=n,s=r),n<i}}),a===1/0)return null;const l=Math.sqrt(a);return t.point?t.point.copy(_i):t.point=_i.clone(),t.distance=l,t.faceIndex=s,t}getBoundingBox(e){e.makeEmpty();return this._roots.forEach((t=>{Nn(0,new Float32Array(t),Li),e.union(Li)})),e}}const ki=Ni.prototype.raycast;Ni.prototype.raycast=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');const[t,r,n,i]=e;return ki.call(this,n,t.material).forEach((e=>{(e=Fn(e,t,r))&&i.push(e)})),i}return ki.apply(this,e)};const Oi=Ni.prototype.raycastFirst;Ni.prototype.raycastFirst=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');const[t,r,n]=e;return Fn(Oi.call(this,n,t.material),t,r)}return Oi.apply(this,e)};const Ui=Ni.prototype.closestPointToPoint;Ni.prototype.closestPointToPoint=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),e.unshift();const t=e[1],r={};return e[1]=r,Ui.apply(this,e),t&&t.copy(r.point),r.distance}return Ui.apply(this,e)};const Qi=Ni.prototype.closestPointToGeometry;Ni.prototype.closestPointToGeometry=function(...e){const t=e[2],r=e[3];if(t&&t.isVector3||r&&r.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');const n={},i={},o=e[1];return e[2]=n,e[3]=i,Qi.apply(this,e),t&&t.copy(n.point),r&&r.copy(i.point).applyMatrix4(o),n.distance}return Qi.apply(this,e)};const Vi=Ni.prototype.refit;Ni.prototype.refit=function(...e){const t=e[0],r=e[1];if(r&&(r instanceof Set||Array.isArray(r))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');const e=new Set;r.forEach((t=>e.add(t))),t&&t.forEach((t=>e.add(t))),Vi.call(this,e)}else Vi.apply(this,e)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach((e=>{const t=Ni.prototype[e];Ni.prototype[e]=function(...r){return(null===r[0]||r[0].isMesh)&&(r.shift(),console.warn(`MeshBVH: The function signature for "${e}" has changed and no longer takes Mesh. See docs for new signature.`)),t.apply(this,r)}}));const Gi=new a.Ray,zi=new a.Matrix4,ji=a.Mesh.prototype.raycast;function Hi(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;zi.copy(this.matrixWorld).invert(),Gi.copy(e.ray).applyMatrix4(zi);const r=this.geometry.boundsTree;if(!0===e.firstHitOnly){const n=Fn(r.raycastFirst(Gi,this.material),this,e);n&&t.push(n)}else{const n=r.raycast(Gi,this.material);for(let r=0,i=n.length;r<i;r++){const i=Fn(n[r],this,e);i&&t.push(i)}}}else ji.call(this,e,t)}function Wi(e){return this.boundsTree=new Ni(this,e),this.boundsTree}function Zi(){this.boundsTree=null}function Xi(e,t){i.useEffect((()=>{if(e.current){e.current.raycast=Hi;const r=e.current.geometry;return r.computeBoundsTree=Wi,r.disposeBoundsTree=Zi,r.computeBoundsTree(t),()=>{r.boundsTree&&r.disposeBoundsTree()}}}),[e,t])}function Yi(...e){const t=i.useRef([]);return t.current=e.map((e=>i.useContext(e))),i.useMemo((()=>({children:r})=>e.reduceRight(((e,r,n)=>i.createElement(r.Provider,{value:t.current[n],children:e})),r)),[])}function Ji(e,t){const r=i.useRef(),[n]=i.useState((()=>t?t instanceof a.Object3D?{current:t}:t:r)),[o]=i.useState((()=>new a.AnimationMixer(void 0))),l=i.useRef({}),[c]=i.useState((()=>{const t={};return e.forEach((e=>Object.defineProperty(t,e.name,{enumerable:!0,get(){if(n.current)return l.current[e.name]||(l.current[e.name]=o.clipAction(e,n.current))}}))),{ref:n,clips:e,actions:t,names:e.map((e=>e.name)),mixer:o}}));return(0,s.useFrame)(((e,t)=>o.update(t))),i.useEffect((()=>{const e=n.current;return()=>{l.current={},Object.values(c.actions).forEach((t=>{e&&o.uncacheAction(t,e)}))}}),[e]),c}function qi(e){const t=i.useRef(null),r=i.useRef(!1),n=i.useRef(!1);return i.useEffect((()=>{const i=t.current;if(i){const t=(0,s.addEffect)((()=>(r.current=!1,!0))),o=i.onBeforeRender;i.onBeforeRender=()=>r.current=!0;const a=(0,s.addAfterEffect)((()=>(r.current!==n.current&&e(n.current=r.current),!0)));return()=>{i.onBeforeRender=o,t(),a()}}}),[]),t}var Ki=r(6149);const $i=i.forwardRef((({children:e,curve:t},r)=>{const[n,o]=i.useState(),a=i.useRef(),s=i.useRef();return i.useImperativeHandle(r,(()=>({moveAlongCurve:e=>{var t;null==(t=s.current)||t.moveAlongCurve(e)}}))),i.useEffect((()=>{!s.current&&a.current&&r&&(s.current=new Ki.Zw(a.current),o(s.current.object3D))}),[e,r]),i.useEffect((()=>{var e;a.current&&t&&(null==(e=s.current)||e.updateCurve(0,t))}),[t]),n?i.createElement("primitive",{object:n}):i.cloneElement(i.Children.only(e),{ref:a})}));class eo extends a.MeshPhysicalMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`\n      uniform float time;\n      uniform float radius;\n      uniform float distort;\n      #define GLSLIFY 1\nvec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n        float updateTime = time / 50.0;\n        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));\n        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));\n        ")}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}const to=i.forwardRef((({speed:e=1,...t},r)=>{const[o]=i.useState((()=>new eo));return(0,s.useFrame)((t=>o&&(o.time=t.clock.getElapsedTime()*e))),i.createElement("primitive",(0,n.Z)({dispose:void 0,object:o,ref:r,attach:"material"},t))}));class ro extends a.MeshStandardMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`\n      uniform float time;\n      uniform float factor;\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","float theta = sin( time + position.y ) / 2.0 * factor;\n        float c = cos( theta );\n        float s = sin( theta );\n        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );\n        vec3 transformed = vec3( position ) * m;\n        vNormal = vNormal * m;")}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}const no=i.forwardRef((({speed:e=1,...t},r)=>{const[o]=i.useState((()=>new ro));return(0,s.useFrame)((t=>o&&(o.time=t.clock.getElapsedTime()*e))),i.createElement("primitive",(0,n.Z)({dispose:void 0,object:o,ref:r,attach:"material"},t))}));class io extends a.ShaderMaterial{constructor(e=new a.Vector2){super({uniforms:{inputBuffer:new a.Uniform(null),depthBuffer:new a.Uniform(null),resolution:new a.Uniform(new a.Vector2),texelSize:new a.Uniform(new a.Vector2),halfTexelSize:new a.Uniform(new a.Vector2),kernel:new a.Uniform(0),scale:new a.Uniform(1),cameraNear:new a.Uniform(0),cameraFar:new a.Uniform(1),minDepthThreshold:new a.Uniform(0),maxDepthThreshold:new a.Uniform(1),depthScale:new a.Uniform(0),depthToBlurRatioBias:new a.Uniform(.25)},fragmentShader:"#include <common>\n        #include <dithering_pars_fragment>      \n        uniform sampler2D inputBuffer;\n        uniform sampler2D depthBuffer;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          float depthFactor = 0.0;\n          \n          #ifdef USE_DEPTH\n            vec4 depth = texture2D(depthBuffer, vUv);\n            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n            depthFactor *= depthScale;\n            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));\n          #endif\n          \n          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));\n          gl_FragColor = sum * 0.25 ;\n\n          #include <dithering_fragment>\n        }",vertexShader:"uniform vec2 texelSize;\n        uniform vec2 halfTexelSize;\n        uniform float kernel;\n        uniform float scale;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          vec2 uv = position.xy * 0.5 + 0.5;\n          vUv = uv;\n\n          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;\n          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0);\n        }",blending:a.NoBlending,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class oo{constructor({gl:e,resolution:t,width:r=500,height:n=500,minDepthThreshold:i=0,maxDepthThreshold:o=1,depthScale:s=0,depthToBlurRatioBias:l=.25}){this.renderToScreen=!1,this.renderTargetA=new a.WebGLRenderTarget(t,t,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,stencilBuffer:!1,depthBuffer:!1,encoding:e.outputEncoding}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new io,this.convolutionMaterial.setTexelSize(1/r,1/n),this.convolutionMaterial.setResolution(new a.Vector2(r,n)),this.scene=new a.Scene,this.camera=new a.Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=i,this.convolutionMaterial.uniforms.maxDepthThreshold.value=o,this.convolutionMaterial.uniforms.depthScale.value=s,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=l,this.convolutionMaterial.defines.USE_DEPTH=s>0;const c=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),u=new Float32Array([0,0,2,0,0,2]),h=new a.BufferGeometry;h.setAttribute("position",new a.BufferAttribute(c,3)),h.setAttribute("uv",new a.BufferAttribute(u,2)),this.screen=new a.Mesh(h,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,r){const n=this.scene,i=this.camera,o=this.renderTargetA,a=this.renderTargetB;let s=this.convolutionMaterial,l=s.uniforms;l.depthBuffer.value=t.depthTexture;const c=s.kernel;let u,h,d,f=t;for(h=0,d=c.length-1;h<d;++h)u=0===(1&h)?o:a,l.kernel.value=c[h],l.inputBuffer.value=f.texture,e.setRenderTarget(u),e.render(n,i),f=u;l.kernel.value=c[h],l.inputBuffer.value=f.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(n,i)}}class ao extends a.MeshStandardMaterial{constructor(e={}){super(e),this._debug={value:0},this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.debug=this._debug,e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;     \n      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader=`\n        uniform int debug;\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDiffuseBlur;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform bool hasBlur;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float mixContrast;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;        \n        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n    \n      float distortionFactor = 0.0;\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      vec4 new_vUv = my_vUv;\n      new_vUv.x += distortionFactor;\n      new_vUv.y += distortionFactor;\n\n      vec4 base = texture2DProj(tDiffuse, new_vUv);\n      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);\n      \n      vec4 merge = base;\n      \n      #ifdef USE_NORMALMAP\n        vec2 normal_uv = vec2(0.0);\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        vec3 coord = new_vUv.xyz / new_vUv.w;\n        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        vec4 base_normal = texture2D(tDiffuse, normal_uv);\n        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);\n        merge = base_normal;\n        blur = blur_normal;\n      #endif\n\n      float depthFactor = 0.0001;\n      float blurFactor = 0.0;\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2DProj(tDepth, new_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor));\n\n        #ifdef USE_BLUR\n          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);\n          merge = merge * min(1.0, depthFactor + 0.5);\n        #else\n          merge = merge * depthFactor;\n        #endif\n  \n      #endif\n\n      float reflectorRoughnessFactor = roughness;\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n      \n      #ifdef USE_BLUR\n        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);\n        merge = mix(merge, blur, blurFactor);\n      #endif\n\n      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);\n      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;\n      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;\n      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;\n\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);           \n      diffuseColor = sRGBToLinear(diffuseColor);\n      \n      if (debug == 1) {\n        diffuseColor = sRGBToLinear(vec4(vec3(depthFactor), 1.0));\n      }\n      if (debug == 2) {\n        diffuseColor = sRGBToLinear(vec4(vec3(blurFactor), 1.0));\n      }\n      if (debug == 3) {\n        diffuseColor = sRGBToLinear(texture2DProj(tDiffuse, new_vUv));\n      }\n      if (debug == 4) {\n        diffuseColor = sRGBToLinear(texture2DProj(tDiffuseBlur, new_vUv));\n      }\n      ")}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get debug(){return this._debug.value}set debug(e){this._debug.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}}(0,s.extend)({MeshReflectorMaterialImpl:ao});const so=i.forwardRef((({mixBlur:e=0,mixStrength:t=1,resolution:r=256,blur:o=[0,0],minDepthThreshold:l=.9,maxDepthThreshold:c=1,depthScale:u=0,depthToBlurRatioBias:h=.25,mirror:d=0,debug:f=0,distortion:p=1,mixContrast:m=1,distortionMap:g,reflectorOffset:A=0,...v},y)=>{const x=(0,s.useThree)((({gl:e})=>e)),b=(0,s.useThree)((({camera:e})=>e)),w=(0,s.useThree)((({scene:e})=>e)),C=(o=Array.isArray(o)?o:[o,o])[0]+o[1]>0,E=i.useRef(null),[S]=i.useState((()=>new a.Plane)),[M]=i.useState((()=>new a.Vector3)),[I]=i.useState((()=>new a.Vector3)),[B]=i.useState((()=>new a.Vector3)),[_]=i.useState((()=>new a.Matrix4)),[F]=i.useState((()=>new a.Vector3(0,0,-1))),[P]=i.useState((()=>new a.Vector4)),[R]=i.useState((()=>new a.Vector3)),[L]=i.useState((()=>new a.Vector3)),[D]=i.useState((()=>new a.Vector4)),[N]=i.useState((()=>new a.Matrix4)),[k]=i.useState((()=>new a.PerspectiveCamera)),O=i.useCallback((()=>{var e;const t=E.current.parent||(null==(e=E.current)?void 0:e.__r3f.parent);if(!t)return;if(I.setFromMatrixPosition(t.matrixWorld),B.setFromMatrixPosition(b.matrixWorld),_.extractRotation(t.matrixWorld),M.set(0,0,1),M.applyMatrix4(_),I.addScaledVector(M,A),R.subVectors(I,B),R.dot(M)>0)return;R.reflect(M).negate(),R.add(I),_.extractRotation(b.matrixWorld),F.set(0,0,-1),F.applyMatrix4(_),F.add(B),L.subVectors(I,F),L.reflect(M).negate(),L.add(I),k.position.copy(R),k.up.set(0,1,0),k.up.applyMatrix4(_),k.up.reflect(M),k.lookAt(L),k.far=b.far,k.updateMatrixWorld(),k.projectionMatrix.copy(b.projectionMatrix),N.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),N.multiply(k.projectionMatrix),N.multiply(k.matrixWorldInverse),N.multiply(t.matrixWorld),S.setFromNormalAndCoplanarPoint(M,I),S.applyMatrix4(k.matrixWorldInverse),P.set(S.normal.x,S.normal.y,S.normal.z,S.constant);const r=k.projectionMatrix;D.x=(Math.sign(P.x)+r.elements[8])/r.elements[0],D.y=(Math.sign(P.y)+r.elements[9])/r.elements[5],D.z=-1,D.w=(1+r.elements[10])/r.elements[14],P.multiplyScalar(2/P.dot(D)),r.elements[2]=P.x,r.elements[6]=P.y,r.elements[10]=P.z+1,r.elements[14]=P.w}),[b,A]),[U,Q,V,G]=i.useMemo((()=>{const n={minFilter:a.LinearFilter,magFilter:a.LinearFilter,encoding:x.outputEncoding},i=new a.WebGLRenderTarget(r,r,n);i.depthBuffer=!0,i.depthTexture=new a.DepthTexture(r,r),i.depthTexture.format=a.DepthFormat,i.depthTexture.type=a.UnsignedShortType;const s=new a.WebGLRenderTarget(r,r,n);return[i,s,new oo({gl:x,resolution:r,width:o[0],height:o[1],minDepthThreshold:l,maxDepthThreshold:c,depthScale:u,depthToBlurRatioBias:h}),{mirror:d,textureMatrix:N,mixBlur:e,tDiffuse:i.texture,tDepth:i.depthTexture,tDiffuseBlur:s.texture,hasBlur:C,mixStrength:t,minDepthThreshold:l,maxDepthThreshold:c,depthScale:u,depthToBlurRatioBias:h,transparent:!0,debug:f,distortion:p,distortionMap:g,mixContrast:m,"defines-USE_BLUR":C?"":void 0,"defines-USE_DEPTH":u>0?"":void 0,"defines-USE_DISTORTION":g?"":void 0}]}),[x,o,N,r,d,C,e,t,l,c,u,h,f,p,g,m]);return(0,s.useFrame)((()=>{var e;const t=E.current.parent||(null==(e=E.current)?void 0:e.__r3f.parent);if(!t)return;t.visible=!1;const r=x.xr.enabled,n=x.shadowMap.autoUpdate;O(),x.xr.enabled=!1,x.shadowMap.autoUpdate=!1,x.setRenderTarget(U),x.state.buffers.depth.setMask(!0),x.autoClear||x.clear(),x.render(w,k),C&&V.render(x,U,Q),x.xr.enabled=r,x.shadowMap.autoUpdate=n,t.visible=!0,x.setRenderTarget(null)})),i.createElement("meshReflectorMaterialImpl",(0,n.Z)({attach:"material",key:"key"+G["defines-USE_BLUR"]+G["defines-USE_DEPTH"]+G["defines-USE_DISTORTION"],ref:(0,T.Z)([E,y])},G,v))}));class lo extends a.ShaderMaterial{constructor(){super({transparent:!0,uniforms:{size:{value:1}},vertexShader:a.ShaderLib.points.vertexShader,fragmentShader:"\n      varying vec3 vColor;\n      void main() {\n        vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n        float r = dot(cxy, cxy);\n        float delta = fwidth(r);\n        vec3 color = vColor;\n        #ifdef TONE_MAPPING\n          color = toneMapping(color);\n        #endif\n        gl_FragColor = linearToOutputTexel(vec4(color, 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r)));\n      }",vertexColors:!0})}get scale(){return this.uniforms.size.value}set scale(e){this.uniforms.size.value=e}}const co=i.forwardRef(((e,t)=>{const[r]=i.useState((()=>new lo));return i.createElement("primitive",(0,n.Z)({object:r,ref:t,attach:"material"},e))}));let uo=!1;const ho=e=>{if(!uo){uo=!0;let t=a.ShaderChunk.shadowmap_pars_fragment;t=t.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP\n"+(({frustum:e=3.75,size:t=.005,near:r=9.5,samples:n=17,rings:i=11}={})=>`#define LIGHT_WORLD_SIZE ${t}\n#define LIGHT_FRUSTUM_WIDTH ${e}\n#define LIGHT_SIZE_UV (LIGHT_WORLD_SIZE / LIGHT_FRUSTUM_WIDTH)\n#define NEAR_PLANE ${r}\n\n#define NUM_SAMPLES ${n}\n#define NUM_RINGS ${i}\n#define BLOCKER_SEARCH_NUM_SAMPLES NUM_SAMPLES\n#define PCF_NUM_SAMPLES NUM_SAMPLES\n\nvec2 poissonDisk[NUM_SAMPLES];\n\nvoid initPoissonSamples(const in vec2 randomSeed) {\n  float ANGLE_STEP = PI2 * float(NUM_RINGS) / float(NUM_SAMPLES);\n  float INV_NUM_SAMPLES = 1.0 / float(NUM_SAMPLES);\n  float angle = rand(randomSeed) * PI2;\n  float radius = INV_NUM_SAMPLES;\n  float radiusStep = radius;\n  for (int i = 0; i < NUM_SAMPLES; i++) {\n    poissonDisk[i] = vec2(cos(angle), sin(angle)) * pow(radius, 0.75);\n    radius += radiusStep;\n    angle += ANGLE_STEP;\n  }\n}\n\nfloat penumbraSize(const in float zReceiver, const in float zBlocker) { // Parallel plane estimation\n  return (zReceiver - zBlocker) / zBlocker;\n}\n\nfloat findBlocker(sampler2D shadowMap, const in vec2 uv, const in float zReceiver) {\n  float searchRadius = LIGHT_SIZE_UV * (zReceiver - NEAR_PLANE) / zReceiver;\n  float blockerDepthSum = 0.0;\n  int numBlockers = 0;\n  for (int i = 0; i < BLOCKER_SEARCH_NUM_SAMPLES; i++) {\n    float shadowMapDepth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[i] * searchRadius));\n    if (shadowMapDepth < zReceiver) {\n      blockerDepthSum += shadowMapDepth;\n      numBlockers++;\n    }\n  }\n  if (numBlockers == 0) return -1.0;\n  return blockerDepthSum / float(numBlockers);\n}\n\nfloat PCF_Filter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius) {\n  float sum = 0.0;\n  for (int i = 0; i < PCF_NUM_SAMPLES; i++) {\n    float depth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[ i ] * filterRadius));\n    if (zReceiver <= depth) sum += 1.0;\n  }\n  for (int i = 0; i < PCF_NUM_SAMPLES; i++) {\n    float depth = unpackRGBAToDepth(texture2D(shadowMap, uv + -poissonDisk[ i ].yx * filterRadius));\n    if (zReceiver <= depth) sum += 1.0;\n  }\n  return sum / (2.0 * float(PCF_NUM_SAMPLES));\n}\n\nfloat PCSS(sampler2D shadowMap, vec4 coords) {\n  vec2 uv = coords.xy;\n  float zReceiver = coords.z; // Assumed to be eye-space z in this code\n  initPoissonSamples(uv);\n  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver);\n  if (avgBlockerDepth == -1.0) return 1.0;\n  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);\n  float filterRadius = penumbraRatio * LIGHT_SIZE_UV * NEAR_PLANE / zReceiver;\n  return PCF_Filter(shadowMap, uv, zReceiver, filterRadius);\n}`)({...e})),t=t.replace("#if defined( SHADOWMAP_TYPE_PCF )","\nreturn PCSS(shadowMap, shadowCoord);\n#if defined( SHADOWMAP_TYPE_PCF )"),a.ShaderChunk.shadowmap_pars_fragment=t}};function fo(e){const t=e+"BufferGeometry";return i.forwardRef((({args:e,children:r,...o},a)=>i.createElement("mesh",(0,n.Z)({ref:a},o),i.createElement(t,{attach:"geometry",args:e}),r)))}const po=fo("box"),mo=fo("circle"),go=fo("cone"),Ao=fo("cylinder"),vo=fo("sphere"),yo=fo("plane"),xo=fo("tube"),bo=fo("torus"),wo=fo("torusKnot"),Co=fo("tetrahedron"),Eo=fo("ring"),So=fo("polyhedron"),To=fo("icosahedron"),Mo=fo("octahedron"),Io=fo("dodecahedron"),Bo=fo("extrude"),_o=fo("lathe"),Fo=1e-5;const Po=i.forwardRef((function({args:[e=1,t=1,r=1]=[],radius:o=.05,smoothness:s=4,children:l,...c},u){const h=i.useMemo((()=>function(e,t,r){const n=new a.Shape,i=r-Fo;return n.absarc(Fo,Fo,Fo,-Math.PI/2,-Math.PI,!0),n.absarc(Fo,t-2*i,Fo,Math.PI,Math.PI/2,!0),n.absarc(e-2*i,t-2*i,Fo,Math.PI/2,0,!0),n.absarc(e-2*i,Fo,Fo,0,-Math.PI/2,!0),n}(e,t,o)),[e,t,o]),d=i.useMemo((()=>({depth:r-2*o,bevelEnabled:!0,bevelSegments:2*s,steps:1,bevelSize:o-Fo,bevelThickness:o,curveSegments:s})),[r,o,s]),f=i.useRef();return i.useLayoutEffect((()=>{f.current&&f.current.center()}),[h,d]),i.createElement("mesh",(0,n.Z)({ref:u},c),i.createElement("extrudeBufferGeometry",{attach:"geometry",ref:f,args:[h,d]}),l)}));function Ro(){const e=new a.BufferGeometry,t=new Float32Array([-1,-1,3,-1,-1,3]);return e.setAttribute("position",new a.BufferAttribute(t,2)),e}const Lo=i.forwardRef((function({children:e,...t},r){const o=i.useMemo(Ro,[]);return i.createElement("mesh",(0,n.Z)({ref:r,geometry:o,frustumCulled:!1},t),e)})),Do=i.forwardRef((function({children:e,alignTop:t,...r},o){const s=i.useRef(null),l=i.useRef(null);return i.useLayoutEffect((()=>{s.current.position.set(0,0,0),s.current.updateWorldMatrix(!0,!0);const e=(new a.Box3).setFromObject(l.current),r=new a.Vector3,n=new a.Sphere,i=e.max.y-e.min.y;e.getCenter(r),e.getBoundingSphere(n),s.current.position.set(-r.x,-r.y+(t?i/2:0),-r.z)}),[e]),i.createElement("group",(0,n.Z)({ref:o},r),i.createElement("group",{ref:s},i.createElement("group",{ref:l},e)))})),No=e=>e&&e.isOrthographicCamera,ko=i.createContext(null);function Oo({children:e,damping:t=6,fit:r,clip:n,margin:o=1.2,eps:l=.01,onFit:c}){const u=i.useRef(null),h=(0,s.useThree)((e=>e.camera)),d=(0,s.useThree)((e=>e.controls)),f=(0,s.useThree)((e=>e.invalidate)),p=i.useRef(c);function m(e,t){return Math.abs(e.x-t.x)<l&&Math.abs(e.y-t.y)<l&&Math.abs(e.z-t.z)<l}function g(e,t,r,n){e.x=a.MathUtils.damp(e.x,t.x,r,n),e.y=a.MathUtils.damp(e.y,t.y,r,n),e.z=a.MathUtils.damp(e.z,t.z,r,n)}p.current=c;const[A]=i.useState((()=>({animating:!1,focus:new a.Vector3,camera:new a.Vector3,zoom:1}))),[v]=i.useState((()=>({focus:new a.Vector3,camera:new a.Vector3,zoom:1}))),[y]=i.useState((()=>new a.Box3)),x=i.useMemo((()=>{function e(){const e=y.getSize(new a.Vector3),t=y.getCenter(new a.Vector3),r=Math.max(e.x,e.y,e.z),n=No(h)?4*r:r/(2*Math.atan(Math.PI*h.fov/360)),i=No(h)?4*r:n/h.aspect,s=o*Math.max(n,i);return{box:y,size:e,center:t,distance:s}}return{getSize:e,refresh(t){var r;if((r=t)&&r.isObject3D?y.setFromObject(t):(e=>e&&e.isBox3)(t)?y.copy(t):u.current&&y.setFromObject(u.current),y.isEmpty()){const e=h.position.length()||10;y.setFromCenterAndSize(new a.Vector3,new a.Vector3(e,e,e))}if("OrthographicTrackballControls"===(null==d?void 0:d.constructor.name)){const{distance:t}=e(),r=h.position.clone().sub(d.target).normalize().multiplyScalar(t),n=d.target.clone().add(r);h.position.copy(n)}return this},clip(){const{distance:t}=e();return d&&(d.maxDistance=10*t),h.near=t/100,h.far=100*t,h.updateProjectionMatrix(),d&&d.update(),this},fit(){A.camera.copy(h.position),d&&A.focus.copy(d.target);const{center:r,distance:n}=e(),i=r.clone().sub(h.position).normalize().multiplyScalar(n);if(v.camera.copy(r).sub(i),v.focus.copy(r),No(h)){A.zoom=h.zoom;let e=0,n=0;const i=[new a.Vector3(y.min.x,y.min.y,y.min.z),new a.Vector3(y.min.x,y.max.y,y.min.z),new a.Vector3(y.min.x,y.min.y,y.max.z),new a.Vector3(y.min.x,y.max.y,y.max.z),new a.Vector3(y.max.x,y.max.y,y.max.z),new a.Vector3(y.max.x,y.max.y,y.min.z),new a.Vector3(y.max.x,y.min.y,y.max.z),new a.Vector3(y.max.x,y.min.y,y.min.z)];r.applyMatrix4(h.matrixWorldInverse);for(const t of i)t.applyMatrix4(h.matrixWorldInverse),e=Math.max(e,Math.abs(t.y-r.y)),n=Math.max(n,Math.abs(t.x-r.x));e*=2,n*=2;const s=(h.top-h.bottom)/e,l=(h.right-h.left)/n;v.zoom=Math.min(s,l)/o,t||(h.zoom=v.zoom,h.updateProjectionMatrix())}return t?A.animating=!0:(h.position.copy(v.camera),h.lookAt(v.focus),d&&(d.target.copy(v.focus),d.update()),f()),p.current&&p.current(this.getSize()),this}}}),[y,h,d,o,t,f]);return i.useLayoutEffect((()=>{if(x.refresh(),r&&x.fit(),n&&x.clip(),d){const e=()=>A.animating=!1;return d.addEventListener("start",e),()=>d.removeEventListener("start",e)}}),[n,r,d]),(0,s.useFrame)(((e,r)=>{if(A.animating){if(g(A.focus,v.focus,t,r),g(A.camera,v.camera,t,r),A.zoom=a.MathUtils.damp(A.zoom,v.zoom,t,r),h.position.copy(A.camera),No(h)&&(h.zoom=A.zoom,h.updateProjectionMatrix()),d?(d.target.copy(A.focus),d.update()):h.lookAt(A.focus),f(),No(h)&&!(Math.abs(A.zoom-v.zoom)<l))return;if(!No(h)&&!m(A.camera,v.camera))return;if(d&&!m(A.focus,v.focus))return;A.animating=!1}})),i.createElement("group",{ref:u},i.createElement(ko.Provider,{value:x},e))}function Uo(){return i.useContext(ko)}var Qo=r(876);const Vo=i.forwardRef((({intensity:e=1,decay:t,decayRate:r=.65,maxYaw:n=.1,maxPitch:o=.1,maxRoll:a=.1,yawFrequency:l=.1,pitchFrequency:c=.1,rollFrequency:u=.1,controls:h},d)=>{const f=(0,s.useThree)((e=>e.camera)),p=(0,s.useThree)((e=>e.controls)),m=i.useRef(e),g=i.useRef(f.rotation.clone()),[A]=i.useState((()=>new Qo.L)),[v]=i.useState((()=>new Qo.L)),[y]=i.useState((()=>new Qo.L)),x=()=>{(m.current<0||m.current>1)&&(m.current=m.current<0?0:1)};return i.useImperativeHandle(d,(()=>({getIntensity:()=>m.current,setIntensity:e=>{m.current=e,x()}})),[]),i.useEffect((()=>{const e=p||(null==h?void 0:h.current),t=()=>{g.current=f.rotation.clone()};return null==e||e.addEventListener("change",t),()=>{null==e||e.removeEventListener("change",t)}}),[h,p]),(0,s.useFrame)((({clock:e},i)=>{const s=Math.pow(m.current,2),h=n*s*A.noise(e.elapsedTime*l,1),d=o*s*v.noise(e.elapsedTime*c,1),p=a*s*y.noise(e.elapsedTime*u,1);f.rotation.set(g.current.x+d,g.current.y+h,g.current.z+p),t&&m.current>0&&(m.current-=r*i,x())})),null}));function Go({children:e,speed:t=1,rotationIntensity:r=1,floatIntensity:n=1,...o}){const a=i.useRef(null),l=i.useRef(1e4*Math.random());return(0,s.useFrame)((e=>{const i=l.current+e.clock.getElapsedTime();a.current.rotation.x=Math.cos(i/4*t)/8*r,a.current.rotation.y=Math.sin(i/4*t)/8*r,a.current.rotation.z=Math.sin(i/4*t)/20*r,a.current.position.y=Math.sin(i/4*t)/10*n})),i.createElement("group",o,i.createElement("group",{ref:a},e))}var zo=r(5990);const jo={sunset:"venice_sunset_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",night:"dikhololo_night_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr",forest:"forest_slope_1k.hdr",apartment:"lebombo_1k.hdr",studio:"studio_small_03_1k.hdr",city:"potsdamer_platz_1k.hdr",park:"rooitou_park_1k.hdr",lobby:"st_fagans_interior_1k.hdr"};function Ho({background:e=!1,files:t=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:r="",preset:n,scene:o,extensions:l}){if(n){if(!(n in jo))throw new Error("Preset must be one of: "+Object.keys(jo).join(", "));t=jo[n],r="https://rawcdn.githack.com/pmndrs/drei-assets/aa3600359ba664d546d05821bcbca42013587df2/hdri/"}const c=(0,s.useThree)((({scene:e})=>e)),u=Array.isArray(t),h=u?a.CubeTextureLoader:zo.x,d=(0,s.useLoader)(h,u?[t]:t,(e=>{e.setPath(r),null==e.setDataType||e.setDataType(a.FloatType),l&&l(e)})),f=u?d[0]:d;return f.mapping=a.EquirectangularReflectionMapping,i.useLayoutEffect((()=>{const t=o?o.background:c.background,r=o?o.environment:c.environment;return o?(o.environment=f,e&&(o.background=f)):(c.environment=f,e&&(c.background=f)),()=>{o?(o.environment=r,o.background=t):(c.environment=r,c.background=t),f.dispose()}}),[f,e,o]),null}var Wo=r(9215),Zo=r(5396);const Xo=i.forwardRef((({scale:e,frames:t=1/0,opacity:r=1,width:o=1,height:l=1,blur:c=1,far:u=10,resolution:h=256,smooth:d=!0,...f},p)=>{const m=(0,s.useThree)((({scene:e})=>e)),g=(0,s.useThree)((({gl:e})=>e)),A=i.useRef(null);o*=Array.isArray(e)?e[0]:e||1,l*=Array.isArray(e)?e[1]:e||1;const[v,y,x,b,w,C,E]=i.useMemo((()=>{const e=new a.WebGLRenderTarget(h,h),t=new a.WebGLRenderTarget(h,h);t.texture.generateMipmaps=e.texture.generateMipmaps=!1;const r=new a.PlaneBufferGeometry(o,l).rotateX(Math.PI/2),n=new a.Mesh(r),i=new a.MeshDepthMaterial;i.depthTest=i.depthWrite=!1,i.onBeforeCompile=e=>e.fragmentShader=e.fragmentShader.replace("1.0 - fragCoordZ ), opacity );","0.0 ), ( 1.0 - fragCoordZ ) * 1.0 );");const s=new a.ShaderMaterial(Wo.P),c=new a.ShaderMaterial(Zo.Z);return c.depthTest=s.depthTest=!1,[e,r,i,n,s,c,t]}),[h,o,l,e]),S=i.useCallback((e=>{b.visible=!0,b.material=w,w.uniforms.tDiffuse.value=v.texture,w.uniforms.h.value=1*e/256,g.setRenderTarget(E),g.render(b,A.current),b.material=C,C.uniforms.tDiffuse.value=E.texture,C.uniforms.v.value=1*e/256,g.setRenderTarget(v),g.render(b,A.current),b.visible=!1}),[]);let T=0;return(0,s.useFrame)((()=>{if(A.current&&(t===1/0||T<t)){const e=m.background;m.background=null,m.overrideMaterial=x,g.setRenderTarget(v),g.render(m,A.current),m.overrideMaterial=null,S(c),d&&S(.4*c),g.setRenderTarget(null),m.background=e,T++}})),i.createElement("group",(0,n.Z)({"rotation-x":Math.PI/2},f,{ref:p}),i.createElement("mesh",{geometry:y,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},i.createElement("meshBasicMaterial",{map:v.texture,transparent:!0,opacity:r})),i.createElement("orthographicCamera",{ref:A,args:[-o/2,o/2,l/2,-l/2,0,u]}))})),Yo={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function Jo({children:e,controls:t,shadows:r=!0,adjustCamera:o=!0,environment:l="city",intensity:c=1,preset:u="rembrandt",shadowBias:h=0,contactShadow:d={blur:2,opacity:.5,position:[0,0,0]},...f}){const p=Yo[u],m=(0,s.useThree)((e=>e.camera)),g=(0,s.useThree)((e=>e.controls)),A=i.useRef(null),v=i.useRef(null),[{radius:y,width:x,height:b},w]=i.useState({radius:0,width:0,height:0});return i.useLayoutEffect((()=>{A.current.position.set(0,0,0),A.current.updateWorldMatrix(!0,!0);const e=(new a.Box3).setFromObject(v.current),t=new a.Vector3,r=new a.Sphere,n=e.max.y-e.min.y,i=e.max.x-e.min.x;e.getCenter(t),e.getBoundingSphere(r),w({radius:r.radius,width:i,height:n}),A.current.position.set(-t.x,-t.y+n/2,-t.z)}),[e]),i.useLayoutEffect((()=>{if(o){const e=y/(b>x?1.5:2.5);m.position.set(0,.5*y,2.5*y),m.near=.1,m.far=Math.max(5e3,4*y),m.lookAt(0,e,0);const r=g||(null==t?void 0:t.current);r&&(r.target.set(0,e,0),r.update())}}),[g,y,b,x,o]),i.createElement("group",f,i.createElement("group",{ref:A},i.createElement("group",{ref:v},e)),d&&i.createElement(Xo,(0,n.Z)({width:2*y,height:2*y,far:y/2},d)),l&&i.createElement(Ho,{preset:l}),i.createElement("ambientLight",{intensity:c/3}),i.createElement("spotLight",{penumbra:1,position:[p.main[0]*y,p.main[1]*y,p.main[2]*y],intensity:2*c,castShadow:r,"shadow-bias":h}),i.createElement("pointLight",{position:[p.fill[0]*y,p.fill[1]*y,p.fill[2]*y],intensity:c}))}const qo=e=>0===e?0:Math.pow(2,10*e-10);function Ko({children:e,floor:t=.25,segments:r=20,receiveShadow:n,...o}){const a=i.useRef(null);return i.useLayoutEffect((()=>{let e=0;const n=r/r/2,i=a.current.attributes.position;for(let o=0;o<r+1;o++)for(let a=0;a<r+1;a++)i.setXYZ(e++,o/r-n+(0===o?-t:0),a/r-n,qo(o/r));i.needsUpdate=!0,a.current.computeVertexNormals()}),[r,t]),i.createElement("group",o,i.createElement("mesh",{receiveShadow:n,rotation:[-Math.PI/2,0,Math.PI/2]},i.createElement("planeGeometry",{ref:a,args:[1,1,r,r]}),e))}const $o=i.forwardRef((({fog:e=!1,colorStop:t=0,color:r="black",opacity:o=.5,...s},l)=>{const c=i.useMemo((()=>{const e=document.createElement("canvas");e.width=128,e.height=128;const n=e.getContext("2d"),i=n.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);return i.addColorStop(t,new a.Color(r).getStyle()),i.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=i,n.fillRect(0,0,e.width,e.height),e}),[r,t]);return i.createElement("mesh",(0,n.Z)({ref:l},s),i.createElement("planeBufferGeometry",{attach:"geometry",args:[1,1]}),i.createElement("meshBasicMaterial",{attach:"material",transparent:!0,opacity:o,fog:e},i.createElement("canvasTexture",{attach:"map",args:[c]})))}));(0,s.extend)({MeshReflectorMaterial:ao});const ea=i.forwardRef((({mixBlur:e=0,mixStrength:t=.5,resolution:r=256,blur:o=[0,0],args:l=[1,1],minDepthThreshold:c=.9,maxDepthThreshold:u=1,depthScale:h=0,depthToBlurRatioBias:d=.25,mirror:f=0,children:p,debug:m=0,distortion:g=1,mixContrast:A=1,distortionMap:v,...y},x)=>{i.useEffect((()=>{console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")}),[]);const b=(0,s.useThree)((({gl:e})=>e)),w=(0,s.useThree)((({camera:e})=>e)),C=(0,s.useThree)((({scene:e})=>e)),E=(o=Array.isArray(o)?o:[o,o])[0]+o[1]>0,S=i.useRef(null),[M]=i.useState((()=>new a.Plane)),[I]=i.useState((()=>new a.Vector3)),[B]=i.useState((()=>new a.Vector3)),[_]=i.useState((()=>new a.Vector3)),[F]=i.useState((()=>new a.Matrix4)),[P]=i.useState((()=>new a.Vector3(0,0,-1))),[R]=i.useState((()=>new a.Vector4)),[L]=i.useState((()=>new a.Vector3)),[D]=i.useState((()=>new a.Vector3)),[N]=i.useState((()=>new a.Vector4)),[k]=i.useState((()=>new a.Matrix4)),[O]=i.useState((()=>new a.PerspectiveCamera)),U=i.useCallback((()=>{if(B.setFromMatrixPosition(S.current.matrixWorld),_.setFromMatrixPosition(w.matrixWorld),F.extractRotation(S.current.matrixWorld),I.set(0,0,1),I.applyMatrix4(F),L.subVectors(B,_),L.dot(I)>0)return;L.reflect(I).negate(),L.add(B),F.extractRotation(w.matrixWorld),P.set(0,0,-1),P.applyMatrix4(F),P.add(_),D.subVectors(B,P),D.reflect(I).negate(),D.add(B),O.position.copy(L),O.up.set(0,1,0),O.up.applyMatrix4(F),O.up.reflect(I),O.lookAt(D),O.far=w.far,O.updateMatrixWorld(),O.projectionMatrix.copy(w.projectionMatrix),k.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),k.multiply(O.projectionMatrix),k.multiply(O.matrixWorldInverse),k.multiply(S.current.matrixWorld),M.setFromNormalAndCoplanarPoint(I,B),M.applyMatrix4(O.matrixWorldInverse),R.set(M.normal.x,M.normal.y,M.normal.z,M.constant);const e=O.projectionMatrix;N.x=(Math.sign(R.x)+e.elements[8])/e.elements[0],N.y=(Math.sign(R.y)+e.elements[9])/e.elements[5],N.z=-1,N.w=(1+e.elements[10])/e.elements[14],R.multiplyScalar(2/R.dot(N)),e.elements[2]=R.x,e.elements[6]=R.y,e.elements[10]=R.z+1,e.elements[14]=R.w}),[]),[Q,V,G,z]=i.useMemo((()=>{const n={minFilter:a.LinearFilter,magFilter:a.LinearFilter,encoding:b.outputEncoding},i=new a.WebGLRenderTarget(r,r,n);i.depthBuffer=!0,i.depthTexture=new a.DepthTexture(r,r),i.depthTexture.format=a.DepthFormat,i.depthTexture.type=a.UnsignedShortType;const s=new a.WebGLRenderTarget(r,r,n);return[i,s,new oo({gl:b,resolution:r,width:o[0],height:o[1],minDepthThreshold:c,maxDepthThreshold:u,depthScale:h,depthToBlurRatioBias:d}),{mirror:f,textureMatrix:k,mixBlur:e,tDiffuse:i.texture,tDepth:i.depthTexture,tDiffuseBlur:s.texture,hasBlur:E,mixStrength:t,minDepthThreshold:c,maxDepthThreshold:u,depthScale:h,depthToBlurRatioBias:d,transparent:!0,debug:m,distortion:g,distortionMap:v,mixContrast:A,"defines-USE_BLUR":E?"":void 0,"defines-USE_DEPTH":h>0?"":void 0,"defines-USE_DISTORTION":v?"":void 0}]}),[b,o,k,r,f,E,e,t,c,u,h,d,m,g,v,A]);return(0,s.useFrame)((()=>{if(null==S||!S.current)return;S.current.visible=!1;const e=b.xr.enabled,t=b.shadowMap.autoUpdate;U(),b.xr.enabled=!1,b.shadowMap.autoUpdate=!1,b.setRenderTarget(Q),b.state.buffers.depth.setMask(!0),b.autoClear||b.clear(),b.render(C,O),E&&G.render(b,Q,V),b.xr.enabled=e,b.shadowMap.autoUpdate=t,S.current.visible=!0,b.setRenderTarget(null)})),i.createElement("mesh",(0,n.Z)({ref:(0,T.Z)([S,x])},y),i.createElement("planeBufferGeometry",{args:l}),p?p("meshReflectorMaterial",z):i.createElement("meshReflectorMaterial",z))}));class ta extends a.ShaderMaterial{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new a.Vector3(0,0,0)},lightColor:{value:new a.Color("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new a.Vector2(0,0)}},transparent:!0,depthWrite:!1,vertexShader:"\n      varying vec3 vNormal;\n      varying vec3 vWorldPosition;\n      varying float vViewZ;\n      varying float vIntensity;\n      uniform vec3 spotPosition;\n      uniform float attenuation;      \n\n      void main() {\n        // compute intensity\n        vNormal = normalize( normalMatrix * normal );\n        vec4 worldPosition\t= modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n        vec4 viewPosition = viewMatrix * worldPosition;\n        vViewZ = viewPosition.z;\n        float intensity\t= distance(worldPosition.xyz, spotPosition) / attenuation;\n        intensity\t= 1.0 - clamp(intensity, 0.0, 1.0);\n        vIntensity = intensity;        \n        // set gl_Position\n        gl_Position\t= projectionMatrix * viewPosition;\n\n      }",fragmentShader:"\n      #include <packing>\n\n      varying vec3 vNormal;\n      varying vec3 vWorldPosition;\n      uniform vec3 lightColor;\n      uniform vec3 spotPosition;\n      uniform float attenuation;\n      uniform float anglePower;\n      uniform sampler2D depth;\n      uniform vec2 resolution;\n      uniform float cameraNear;\n      uniform float cameraFar;\n      varying float vViewZ;\n      varying float vIntensity;\n      uniform float opacity;\n\n      float readDepth( sampler2D depthSampler, vec2 coord ) {\n        float fragCoordZ = texture2D( depthSampler, coord ).x;\n        float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);\n        return viewZ;\n      }\n\n      void main() {\n        float d = 1.0;\n        bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;\n        if (isSoft) {\n          vec2 sUv = gl_FragCoord.xy / resolution;\n          d = readDepth(depth, sUv);\n        }\n        float intensity = vIntensity;\n        vec3 normal\t= vec3(vNormal.x, vNormal.y, abs(vNormal.z));\n        float angleIntensity\t= pow( dot(normal, vec3(0.0, 0.0, 1.0)), anglePower );\n        intensity\t*= angleIntensity;\n        // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry\n        if (isSoft) {\n          intensity\t*= smoothstep(0., 1., vViewZ - d);\n        }\n        gl_FragColor = vec4(lightColor, intensity * opacity);\n      }"})}}const ra=new a.Vector3,na=i.forwardRef((({opacity:e=1,radiusTop:t,radiusBottom:r,depthBuffer:o,color:l="white",distance:c=5,angle:u=.15,attenuation:h=5,anglePower:d=5,...f},p)=>{const m=i.useRef(null),g=(0,s.useThree)((e=>e.size)),A=(0,s.useThree)((e=>e.camera)),v=(0,s.useThree)((e=>e.viewport.dpr)),[y]=i.useState((()=>new ta));t=void 0===t?.1:t,r=void 0===r?7*u:r,(0,s.useFrame)((()=>{y.uniforms.spotPosition.value.copy(m.current.getWorldPosition(ra)),m.current.lookAt(m.current.parent.target.getWorldPosition(ra))}));const x=i.useMemo((()=>{const e=new a.CylinderGeometry(t,r,c,128,64,!0);return e.applyMatrix4((new a.Matrix4).makeTranslation(0,-c/2,0)),e.applyMatrix4((new a.Matrix4).makeRotationX(-Math.PI/2)),e}),[u,c,t,r]);return i.createElement("spotLight",(0,n.Z)({ref:p,angle:u,color:l,distance:c},f),i.createElement("mesh",{ref:m,geometry:x,raycast:()=>null},i.createElement("primitive",{object:y,attach:"material","uniforms-opacity-value":e,"uniforms-lightColor-value":l,"uniforms-attenuation-value":h,"uniforms-anglePower-value":d,"uniforms-depth-value":o,"uniforms-cameraNear-value":A.near,"uniforms-cameraFar-value":A.far,"uniforms-resolution-value":o?[g.width*v,g.height*v]:[0,0]})))}));var ia=r(4921);function oa(e,t,r=new a.Vector3){const n=Math.PI*(e-.5),i=2*Math.PI*(t-.5);return r.x=Math.cos(i),r.y=Math.sin(n),r.z=Math.sin(i),r}const aa=i.forwardRef((({inclination:e=.6,azimuth:t=.1,distance:r=1e3,mieCoefficient:o=.005,mieDirectionalG:s=.8,rayleigh:l=.5,turbidity:c=10,sunPosition:u=oa(e,t),...h},d)=>{const f=i.useMemo((()=>(new a.Vector3).setScalar(r)),[r]),[p]=i.useState((()=>new ia.q));return i.createElement("primitive",(0,n.Z)({dispose:void 0,object:p,ref:d,"material-uniforms-mieCoefficient-value":o,"material-uniforms-mieDirectionalG-value":s,"material-uniforms-rayleigh-value":l,"material-uniforms-sunPosition-value":u,"material-uniforms-turbidity-value":c,scale:f},h))}));class sa extends a.ShaderMaterial{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:"\n      uniform float time;\n      attribute float size;\n      varying vec3 vColor;\n      void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);\n        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(mvPosition.x + 2.0 * time + 100.0));\n        gl_Position = projectionMatrix * mvPosition;\n      }",fragmentShader:"\n      uniform sampler2D pointTexture;\n      uniform float fade;\n      varying vec3 vColor;\n      void main() {\n        float opacity = 1.0;\n        if (fade == 1.0) {\n          float d = distance(gl_PointCoord, vec2(0.5, 0.5));\n          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));\n        }\n        gl_FragColor = vec4(vColor, opacity);\n      }"})}}const la=e=>(new a.Vector3).setFromSpherical(new a.Spherical(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI)),ca=i.forwardRef((({radius:e=100,depth:t=50,count:r=5e3,saturation:n=0,factor:o=4,fade:l=!1},c)=>{const u=i.useRef(),[h,d,f]=i.useMemo((()=>{const i=[],s=[],l=Array.from({length:r},(()=>(.5+.5*Math.random())*o)),c=new a.Color;let u=e+t;const h=t/r;for(let e=0;e<r;e++)u-=h*Math.random(),i.push(...la(u).toArray()),c.setHSL(e/r,n,.9),s.push(c.r,c.g,c.b);return[new Float32Array(i),new Float32Array(s),new Float32Array(l)]}),[r,t,o,e,n]);(0,s.useFrame)((e=>u.current&&(u.current.uniforms.time.value=e.clock.getElapsedTime())));const[p]=i.useState((()=>new sa));return i.createElement("points",{ref:c},i.createElement("bufferGeometry",{attach:"geometry"},i.createElement("bufferAttribute",{attachObject:["attributes","position"],args:[h,3]}),i.createElement("bufferAttribute",{attachObject:["attributes","color"],args:[d,3]}),i.createElement("bufferAttribute",{attachObject:["attributes","size"],args:[f,1]})),i.createElement("primitive",{dispose:void 0,ref:u,object:p,attach:"material",blending:a.AdditiveBlending,"uniforms-fade-value":l,transparent:!0,vertexColors:!0}))}));function ua({opacity:e=.5,speed:t=.4,width:r=10,depth:n=1.5,segments:o=20,...a}){const l=i.useRef(),c=$t("https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png"),u=i.useMemo((()=>[...new Array(o)].map(((e,n)=>({x:r/2-Math.random()*r,y:r/2-Math.random()*r,scale:.4+Math.sin((n+1)/o*Math.PI)*(10*(.2+Math.random())),density:Math.max(.2,Math.random()),rotation:Math.max(.002,.005*Math.random())*t})))),[r,o,t]);return(0,s.useFrame)((e=>{var t;return null==(t=l.current)?void 0:t.children.forEach(((t,r)=>{t.children[0].rotation.z+=u[r].rotation,t.children[0].scale.setScalar(u[r].scale+(1+Math.sin(e.clock.getElapsedTime()/10))/2*r/10)}))})),i.createElement("group",a,i.createElement("group",{position:[0,0,o/2*n],ref:l},u.map((({x:t,y:r,scale:o,density:a},s)=>i.createElement(ze,{key:s,position:[t,r,-s*n]},i.createElement(yo,{scale:o,rotation:[0,0,0]},i.createElement("meshStandardMaterial",{map:c,transparent:!0,opacity:o/6*a*e,depthTest:!1})))))))}function ha(e=0,t=1024){const r=(0,yn.G)((()=>new Promise((async e=>{e(await fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json").then((e=>e.json())))}))),"matcapList"),n=r[0],o=i.useMemo((()=>Object.keys(r).length),[]),a=`https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d/${t}/${`${i.useMemo((()=>"string"===typeof e?e:"number"===typeof e?r[e]:null),[e])||n}${function(e){switch(e){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}(t)}.png`}`;return[$t(a),a,o]}function da(e=0,t={}){const{repeat:r=[1,1],anisotropy:n=1,offset:o=[0,0]}=t,s=(0,yn.G)((()=>new Promise((async e=>{e(await fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json").then((e=>e.json())))}))),"normalsList"),l=i.useMemo((()=>Object.keys(s).length),[]),c=s[0],u=`https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb/normals/${s[e]||c}`,h=$t(u);return i.useLayoutEffect((()=>{h&&(h.wrapS=h.wrapT=a.RepeatWrapping,h.repeat=new a.Vector2(r[0],r[1]),h.offset=new a.Vector2(o[0],o[1]),h.anisotropy=n)}),[h,n,r,o]),[h,u,l]}const fa=new a.Matrix4,pa=new a.Matrix4,ma=[],ga=new a.Mesh;class Aa extends a.Group{constructor(){super(),this.color=new a.Color("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){const r=this.instance.current;if(!r)return;if(!r.geometry||!r.material)return;ga.geometry=r.geometry;const n=r.matrixWorld;let i=r.userData.instances.indexOf(this.instanceKey);if(!(-1===i||i>r.count)){r.getMatrixAt(i,fa),pa.multiplyMatrices(n,fa),ga.matrixWorld=pa,ga.raycast(e,ma);for(let e=0,r=ma.length;e<r;e++){const r=ma[e];r.instanceId=i,r.object=this,t.push(r)}ma.length=0}}}let va,ya;const xa=i.createContext(null),ba=new a.Matrix4,wa=new a.Vector3,Ca=new a.Color,Ea=i.forwardRef((({children:e,range:t,limit:r=1e3,...o},l)=>{const c=i.useRef(null),[u,h]=i.useState([]),[[d,f,p]]=i.useState((()=>[new Float32Array(3*r),Float32Array.from({length:3*r},(()=>1)),Float32Array.from({length:r},(()=>1))]));i.useLayoutEffect((()=>{c.current.geometry.drawRange.count=Math.min(r,void 0!==t?t:r,u.length)}),[u,t]),i.useEffect((()=>{c.current.geometry.attributes.position.needsUpdate=!0})),(0,s.useFrame)((()=>{for(c.current.updateMatrix(),c.current.updateMatrixWorld(),ba.copy(c.current.matrixWorld).invert(),va=0;va<u.length;va++)ya=u[va].current,ya.getWorldPosition(wa).applyMatrix4(ba),wa.x===d[3*va]&&wa.y===d[3*va+1]&&wa.z===d[3*va+2]||(wa.toArray(d,3*va),c.current.geometry.attributes.position.needsUpdate=!0,ya.matrixWorldNeedsUpdate=!0),ya.color.equals(Ca.fromArray(f,3*va))||(ya.color.toArray(f,3*va),c.current.geometry.attributes.color.needsUpdate=!0),ya.size!==p[va]&&(p.set([ya.size],va),c.current.geometry.attributes.size.needsUpdate=!0)}));const m=i.useMemo((()=>{const e={};for(va=0;va<u.length;va++){var t;Object.assign(e,null==(t=u[va].current)?void 0:t.__r3f.handlers)}return Object.keys(e).reduce(((e,t)=>({...e,[t]:e=>{var r,n,i;const o=null==(r=u[e.index])?void 0:r.current;return null==o||null==(n=o.__r3f)||null==(i=n.handlers)?void 0:i[t]({...e,object:o})}})),{})}),[e,u]),g=i.useMemo((()=>({subscribe:e=>(h((t=>[...t,e])),()=>h((t=>t.filter((t=>t.current!==e.current)))))})),[]);return i.createElement("points",(0,n.Z)({matrixAutoUpdate:!1,ref:(0,T.Z)([l,c])},m,o),i.createElement("bufferGeometry",null,i.createElement("bufferAttribute",{attachObject:["attributes","position"],count:d.length/3,array:d,itemSize:3,usage:a.DynamicDrawUsage}),i.createElement("bufferAttribute",{attachObject:["attributes","color"],count:f.length/3,array:f,itemSize:3,usage:a.DynamicDrawUsage}),i.createElement("bufferAttribute",{attachObject:["attributes","size"],count:p.length,array:p,itemSize:1,usage:a.DynamicDrawUsage})),i.createElement(xa.Provider,{value:g},e))})),Sa=i.forwardRef((({children:e,...t},r)=>{i.useMemo((()=>(0,s.extend)({Position:Aa})),[]);const o=i.useRef(),{subscribe:a}=i.useContext(xa);return i.useLayoutEffect((()=>a(o)),[]),i.createElement("position",(0,n.Z)({ref:(0,T.Z)([r,o])},t),e)})),Ta=i.forwardRef((({children:e,positions:t,colors:r,sizes:o,stride:l=3,...c},u)=>{const h=i.useRef(null);return(0,s.useFrame)((()=>{const e=h.current.geometry.attributes;e.position.needsUpdate=!0,r&&(e.color.needsUpdate=!0),o&&(e.size.needsUpdate=!0)})),i.createElement("points",(0,n.Z)({matrixAutoUpdate:!1,ref:(0,T.Z)([u,h])},c),i.createElement("bufferGeometry",null,i.createElement("bufferAttribute",{attachObject:["attributes","position"],count:t.length/l,array:t,itemSize:l,usage:a.DynamicDrawUsage}),r&&i.createElement("bufferAttribute",{attachObject:["attributes","color"],count:r.length/l,array:r,itemSize:3,usage:a.DynamicDrawUsage}),o&&i.createElement("bufferAttribute",{attachObject:["attributes","size"],count:o.length/l,array:o,itemSize:1,usage:a.DynamicDrawUsage})),e)})),Ma=i.forwardRef(((e,t)=>e.positions instanceof Float32Array?i.createElement(Ta,(0,n.Z)({},e,{ref:t})):i.createElement(Ea,(0,n.Z)({},e,{ref:t}))));var Ia=r(3615),Ba=r.n(Ia);function _a(e){return Fa(e.children,e.components)}function Fa(e,t,r){if(r=r||[],!t[0])return e(r);function n(n){return Fa(e,t.slice(1),r.concat([n]))}return"function"===typeof t[0]?t[0]({results:r,render:n}):(0,i.cloneElement)(t[0],{children:n})}let Pa,Ra;_a.propTypes={children:Ba().func.isRequired,components:Ba().arrayOf(Ba().oneOfType([Ba().element,Ba().func])).isRequired};const La=i.createContext(null),Da=new a.Matrix4,Na=new a.Matrix4,ka=new a.Matrix4,Oa=new a.Color,Ua=new a.Vector3,Qa=new a.Quaternion,Va=new a.Vector3,Ga=i.forwardRef((({context:e,children:t,...r},o)=>{i.useMemo((()=>(0,s.extend)({Position:Aa})),[]);const a=i.useRef(),{subscribe:l,getParent:c}=i.useContext(e||La);return i.useLayoutEffect((()=>l(a)),[]),i.createElement("position",(0,n.Z)({instance:c(),instanceKey:a,ref:(0,T.Z)([o,a])},r),t)})),za=i.forwardRef((({children:e,range:t,limit:r=1e3,frames:o=1/0,...l},c)=>{const[{context:u,instance:h}]=i.useState((()=>{const e=i.createContext(null);return{context:e,instance:i.forwardRef(((t,r)=>i.createElement(Ga,(0,n.Z)({context:e},t,{ref:r}))))}})),d=i.useRef(null),[f,p]=i.useState([]),[[m,g]]=i.useState((()=>{const e=new Float32Array(16*r);for(Pa=0;Pa<r;Pa++)ka.identity().toArray(e,16*Pa);return[e,new Float32Array([...new Array(3*r)].map((()=>1)))]}));i.useLayoutEffect((()=>{d.current.count=d.current.instanceMatrix.updateRange.count=d.current.instanceColor.updateRange.count=Math.min(r,void 0!==t?t:r,f.length)}),[f,t]),i.useEffect((()=>{d.current.instanceMatrix.needsUpdate=!0}));let A=0;(0,s.useFrame)((()=>{if(o===1/0||A<o){for(d.current.updateMatrix(),d.current.updateMatrixWorld(),Da.copy(d.current.matrixWorld).invert(),Pa=0;Pa<f.length;Pa++)Ra=f[Pa].current,Ra.matrixWorld.decompose(Ua,Qa,Va),Na.compose(Ua,Qa,Va).premultiply(Da),Na.equals(ka.fromArray(m,16*Pa))||(Na.toArray(m,16*Pa),d.current.instanceMatrix.needsUpdate=!0),Ra.color.equals(Oa.fromArray(g,3*Pa))||(Ra.color.toArray(g,3*Pa),d.current.instanceColor.needsUpdate=!0);A++}}));const v=i.useMemo((()=>({getParent:()=>d,subscribe:e=>(p((t=>[...t,e])),()=>p((t=>t.filter((t=>t.current!==e.current)))))})),[]);return i.createElement("instancedMesh",(0,n.Z)({userData:{instances:f},matrixAutoUpdate:!1,ref:(0,T.Z)([c,d]),args:[null,null,0],raycast:()=>null},l),i.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:m.length/16,array:m,itemSize:16,usage:a.DynamicDrawUsage}),i.createElement("instancedBufferAttribute",{attach:"instanceColor",count:g.length/3,array:g,itemSize:3,usage:a.DynamicDrawUsage}),"function"===typeof e?i.createElement(u.Provider,{value:v},e(h)):i.createElement(La.Provider,{value:v},e))}));function ja({meshes:e,children:t,...r}){const o=Array.isArray(e);if(!o)for(const n of Object.keys(e))e[n].isMesh||delete e[n];return i.createElement(_a,{components:(o?e:Object.values(e)).map((({geometry:e,material:t})=>i.createElement(za,(0,n.Z)({key:e.uuid,geometry:e,material:t},r))))},(r=>o?t(...r):t(Object.keys(e).filter((t=>e[t].isMesh)).reduce(((e,t,n)=>({...e,[t]:r[n]})),{}))))}var Ha=r(6141);const Wa=i.createContext(null),Za=e=>e instanceof a.Color?e.toArray():e,Xa=e=>e instanceof a.Vector3?e.toArray():e,Ya=i.forwardRef(((e,t)=>{const{limit:r=1e3,lineWidth:o=1,children:l,...c}=e,[u,h]=i.useState([]),[d]=i.useState((()=>new je.w)),[f]=i.useState((()=>new He.Y)),[p]=i.useState((()=>new Ha.z)),[m]=i.useState((()=>new a.Vector2(512,512))),[g]=i.useState((()=>Array(6*r).fill(0))),[A]=i.useState((()=>Array(6*r).fill(0))),v=i.useMemo((()=>({subscribe:e=>(h((t=>[...t,e])),()=>h((t=>t.filter((t=>t.current!==e.current)))))})),[]);return(0,s.useFrame)((()=>{for(let n=0;n<r;n++){var e;const r=null==(e=u[n])?void 0:e.current,i=r?Xa(r.start):[0,0,0],o=r?Xa(r.end):[0,0,0],a=r?Za(r.color):[1,1,1];for(var t=0;t<3;t++)g[6*n+t]=i[t],g[6*n+t+3]=o[t],A[6*n+t]=a[t],A[6*n+t+3]=a[t]}p.setColors(A),p.setPositions(g),d.computeLineDistances()})),i.createElement("primitive",{object:d,ref:t},i.createElement("primitive",{object:p,attach:"geometry"}),i.createElement("primitive",(0,n.Z)({object:f,attach:"material",vertexColors:!0,resolution:m,linewidth:o},c)),i.createElement(Wa.Provider,{value:v},l))}));class Ja{constructor(){this.color=new a.Color("white"),this.start=new a.Vector3(0,0,0),this.end=new a.Vector3(0,0,0)}}const qa=i.forwardRef(((e,t)=>{const r=i.useContext(Wa);if(!r)throw"Segment must used inside Segments component.";const o=i.useRef();return i.useMemo((()=>(0,s.extend)({SegmentObject:Ja})),[]),i.useLayoutEffect((()=>r.subscribe(o)),[]),i.createElement("segmentObject",(0,n.Z)({ref:(0,T.Z)([o,t])},e))})),Ka=i.forwardRef((({children:e,distances:t,...r},o)=>{const a=i.useRef(null);return i.useLayoutEffect((()=>{const{current:e}=a;e.levels.length=0,e.children.forEach(((r,n)=>e.levels.push({object:r,distance:t[n]})))})),(0,s.useFrame)((e=>{var t;return null==(t=a.current)?void 0:t.update(e.camera)})),i.createElement("lOD",(0,n.Z)({ref:(0,T.Z)([a,o])},r),e)}));var $a=r(1715);function es(){const e=(0,s.useThree)((e=>e.gl));return(0,i.useEffect)((()=>(e.shadowMap.autoUpdate=!1,e.shadowMap.needsUpdate=!0,()=>{e.shadowMap.autoUpdate=e.shadowMap.needsUpdate=!0})),[e.shadowMap]),null}const ts=new a.Matrix4,rs=new a.Ray,ns=new a.Sphere,is=new a.Vector3;function os(e,t){const r=this.geometry,n=this.material,i=this.matrixWorld;void 0!==n&&(null===r.boundingSphere&&r.computeBoundingSphere(),ns.copy(r.boundingSphere),ns.applyMatrix4(i),!1!==e.ray.intersectsSphere(ns)&&(ts.copy(i).invert(),rs.copy(e.ray).applyMatrix4(ts),null!==r.boundingBox&&null===rs.intersectBox(r.boundingBox,is)||t.push({distance:is.distanceTo(e.ray.origin),point:is.clone(),object:this})))}function as({pixelated:e}){const t=(0,s.useThree)((e=>e.gl)),r=(0,s.useThree)((e=>e.internal.active)),n=(0,s.useThree)((e=>e.performance.current)),o=(0,s.useThree)((e=>e.viewport.initialDpr)),a=(0,s.useThree)((e=>e.setDpr));return i.useEffect((()=>{const n=t.domElement;return()=>{r&&a(o),e&&n&&(n.style.imageRendering="auto")}}),[]),i.useEffect((()=>{a(n*o),e&&t.domElement&&(t.domElement.style.imageRendering=1===n?"auto":"pixelated")}),[n]),null}function ss(){const e=(0,s.useThree)((e=>e.get)),t=(0,s.useThree)((e=>e.performance.current));return i.useEffect((()=>{const t=e().raycaster.enabled;return()=>{e().raycaster.enabled=t}}),[]),i.useEffect((()=>{e().raycaster.enabled=1===t}),[t]),null}},1403:function(e,t,r){"use strict";r.r(t),r.d(t,{Canvas:function(){return W},ReactThreeFiber:function(){return A},_roots:function(){return ee},act:function(){return ue},addAfterEffect:function(){return O},addEffect:function(){return k},addTail:function(){return U},advance:function(){return ne},applyProps:function(){return oe},context:function(){return F},createPortal:function(){return he},dispose:function(){return ce},events:function(){return G},extend:function(){return M},invalidate:function(){return re},reconciler:function(){return ie},render:function(){return ae},unmountComponentAtNode:function(){return le},useFrame:function(){return Y},useGraph:function(){return q},useLoader:function(){return $},useStore:function(){return Z},useThree:function(){return X}});var n=r(6173),i=r(7378),o=r(8555),a=r(5861),s=r.n(a),l=r(1102),c=r(1860),u=r(5324),h=r(6415),d=r.n(h);function f(e){let{debounce:t,scroll:r,polyfill:n,offsetSize:o}=void 0===e?{debounce:0,scroll:!1,offsetSize:!1}:e;const a=n||("undefined"===typeof window?class{}:window.ResizeObserver);if(!a)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,l]=(0,i.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),c=(0,i.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s}),u=t?"number"===typeof t?t:t.scroll:null,h=t?"number"===typeof t?t:t.resize:null,f=(0,i.useRef)(!1);(0,i.useEffect)((()=>(f.current=!0,()=>{f.current=!1})));const[m,A,v]=(0,i.useMemo)((()=>{const e=()=>{if(!c.current.element)return;const{left:e,top:t,width:r,height:n,bottom:i,right:a,x:s,y:u}=c.current.element.getBoundingClientRect(),h={left:e,top:t,width:r,height:n,bottom:i,right:a,x:s,y:u};c.current.element instanceof HTMLElement&&o&&(h.height=c.current.element.offsetHeight,h.width=c.current.element.offsetWidth),Object.freeze(h),f.current&&!g(c.current.lastBounds,h)&&l(c.current.lastBounds=h)};return[e,h?d()(e,h):e,u?d()(e,u):e]}),[l,o,u,h]);function y(){c.current.scrollContainers&&(c.current.scrollContainers.forEach((e=>e.removeEventListener("scroll",v,!0))),c.current.scrollContainers=null),c.current.resizeObserver&&(c.current.resizeObserver.disconnect(),c.current.resizeObserver=null)}function x(){c.current.element&&(c.current.resizeObserver=new a(v),c.current.resizeObserver.observe(c.current.element),r&&c.current.scrollContainers&&c.current.scrollContainers.forEach((e=>e.addEventListener("scroll",v,{capture:!0,passive:!0}))))}var b,w,C;return b=v,w=Boolean(r),(0,i.useEffect)((()=>{if(w){const e=b;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",e,!0)}}}),[b,w]),C=A,(0,i.useEffect)((()=>{const e=C;return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[C]),(0,i.useEffect)((()=>{y(),x()}),[r,v,A]),(0,i.useEffect)((()=>y),[]),[e=>{e&&e!==c.current.element&&(y(),c.current.element=e,c.current.scrollContainers=p(e),x())},s,m]}function p(e){const t=[];if(!e||e===document.body)return t;const{overflow:r,overflowX:n,overflowY:i}=window.getComputedStyle(e);return[r,n,i].some((e=>"auto"===e||"scroll"===e))&&t.push(e),[...t,...p(e.parentElement)]}const m=["x","y","top","bottom","left","right","width","height"],g=(e,t)=>m.every((r=>e[r]===t[r]));var A=Object.freeze({__proto__:null});const v={obj:e=>e===Object(e)&&!v.arr(e)&&"function"!==typeof e,fun:e=>"function"===typeof e,str:e=>"string"===typeof e,num:e=>"number"===typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t){if(typeof e!==typeof t||!!e!==!!t)return!1;if(v.str(e)||v.num(e)||v.obj(e))return e===t;if(v.arr(e)&&e==t)return!0;let r;for(r in e)if(!(r in t))return!1;for(r in t)if(e[r]!==t[r])return!1;return!v.und(r)||e===t}};function y(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function x(e,t,r,n){const i=r.get(t);i&&(r.delete(t),0===r.size&&(e.delete(n),i.target.releasePointerCapture(n)))}function b(e){const t=new n.Vector3;function r(e){return e.filter((e=>["Move","Over","Enter","Out","Leave"].some((t=>{var r;return null==(r=e.__r3f)?void 0:r.handlers["onPointer"+t]}))))}function i(t){const{internal:r}=e.getState();Array.from(r.hovered.values()).forEach((e=>{if(!t.length||!t.find((t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId))){const n=e.eventObject.__r3f,i=null==n?void 0:n.handlers;if(r.hovered.delete(y(e)),null!=n&&n.eventCount){const r={...e,intersections:t||[]};null==i.onPointerOut||i.onPointerOut(r),null==i.onPointerLeave||i.onPointerLeave(r)}}}))}function o(e,t){t.forEach((t=>{var r;return null==(r=t.__r3f)||null==r.handlers.onPointerMissed?void 0:r.handlers.onPointerMissed(e)}))}return{handlePointer:n=>{switch(n){case"onPointerLeave":case"onPointerCancel":return()=>i([]);case"onLostPointerCapture":return t=>{const{internal:r}=e.getState();"pointerId"in t&&!r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),i([]))}}return a=>{const{onPointerMissed:s,internal:l}=e.getState();!function(t){var r,n,i,o;const a=e.getState(),{raycaster:s,mouse:l,camera:c,size:u}=a,h=null==s.computeOffsets?void 0:s.computeOffsets(t,a),d=null!=(r=null==h?void 0:h.offsetX)?r:t.offsetX,f=null!=(n=null==h?void 0:h.offsetY)?n:t.offsetY,p=null!=(i=null==h?void 0:h.width)?i:u.width,m=null!=(o=null==h?void 0:h.height)?o:u.height;l.set(d/p*2-1,-f/m*2+1),s.setFromCamera(l,c)}(a),l.lastEvent.current=a;const c="onPointerMove"===n,u="onClick"===n||"onContextMenu"===n||"onDoubleClick"===n,h=function(t,r){const{internal:n}=e.getState();if("pointerId"in r&&n.capturedMap.has(r.pointerId))for(let e of n.capturedMap.get(r.pointerId).values())t.push(e.intersection);return t}(function(t){const r=e.getState(),{raycaster:n,internal:i}=r;if(!n.enabled)return[];const o=new Set,a=[],s=t?t(i.interaction):i.interaction;let l=n.intersectObjects(s,!0).filter((e=>{const t=y(e);return!o.has(t)&&(o.add(t),!0)}));n.filter&&(l=n.filter(l,r));for(const e of l){let t=e.object;for(;t;){var c;null!=(c=t.__r3f)&&c.eventCount&&a.push({...e,eventObject:t}),t=t.parent}}return a}(c?r:void 0),a),d=u?function(t){const{internal:r}=e.getState(),n=t.offsetX-r.initialClick[0],i=t.offsetY-r.initialClick[1];return Math.round(Math.sqrt(n*n+i*i))}(a):0;"onPointerDown"===n&&(l.initialClick=[a.offsetX,a.offsetY],l.initialHits=h.map((e=>e.eventObject))),u&&!h.length&&d<=2&&(o(a,l.interaction),s&&s(a)),c&&i(h),function(r,n,o,a){const{raycaster:s,mouse:l,camera:c,internal:u}=e.getState();if(r.length){const e=t.set(l.x,l.y,0).unproject(c),h={stopped:!1};for(const t of r){const d=e=>{var r,n;return null!=(r=null==(n=u.capturedMap.get(e))?void 0:n.has(t.eventObject))&&r},f=e=>{const r={intersection:t,target:n.target};u.capturedMap.has(e)?u.capturedMap.get(e).set(t.eventObject,r):u.capturedMap.set(e,new Map([[t.eventObject,r]])),n.target.setPointerCapture(e)},p=e=>{const r=u.capturedMap.get(e);r&&x(u.capturedMap,t.eventObject,r,e)};let m={};for(let e in n){let t=n[e];"function"!==typeof t&&(m[e]=t)}let g={...t,...m,spaceX:l.x,spaceY:l.y,intersections:r,stopped:h.stopped,delta:o,unprojectedPoint:e,ray:s.ray,camera:c,stopPropagation:()=>{const e="pointerId"in n&&u.capturedMap.get(n.pointerId);(!e||e.has(t.eventObject))&&(g.stopped=h.stopped=!0,u.hovered.size&&Array.from(u.hovered.values()).find((e=>e.eventObject===t.eventObject)))&&i([...r.slice(0,r.indexOf(t)),t])},target:{hasPointerCapture:d,setPointerCapture:f,releasePointerCapture:p},currentTarget:{hasPointerCapture:d,setPointerCapture:f,releasePointerCapture:p},sourceEvent:n,nativeEvent:n};if(a(g),!0===h.stopped)break}}}(h,a,d,(e=>{const t=e.eventObject,r=t.__r3f,i=null==r?void 0:r.handlers;if(null!=r&&r.eventCount)if(c){if(i.onPointerOver||i.onPointerEnter||i.onPointerOut||i.onPointerLeave){const t=y(e),r=l.hovered.get(t);r?r.stopped&&e.stopPropagation():(l.hovered.set(t,e),null==i.onPointerOver||i.onPointerOver(e),null==i.onPointerEnter||i.onPointerEnter(e))}null==i.onPointerMove||i.onPointerMove(e)}else{const r=i[n];r?u&&!l.initialHits.includes(t)||(o(a,l.interaction.filter((e=>!l.initialHits.includes(e)))),r(e)):u&&l.initialHits.includes(t)&&o(a,l.interaction.filter((e=>!l.initialHits.includes(e))))}}))}}}}const w=e=>e&&!!e.getState,C=(e,t)=>{var r,n;return{root:w(e)?e:null!=(r=null==(n=e.__r3f)?void 0:n.root)?r:t.__r3f.root,container:w(e)?e.getState().scene:e}},E="__default",S={};let T={},M=e=>{T={...T,...e}};function I(e,t){const r=e;return(null!=t&&t.primitive||!r.__r3f)&&(r.__r3f={root:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}const B=e=>e&&e.isOrthographicCamera;function _(e){return Array.isArray(e)?Math.min(Math.max(e[0],window.devicePixelRatio),e[1]):e}const F=i.createContext(null);function P(e,t){const r=t.length;return t.push(e),()=>{t.splice(r,1)}}let R,L=[],D=[],N=[];const k=e=>P(e,L),O=e=>P(e,D),U=e=>P(e,N);function Q(e,t){for(R=0;R<e.length;R++)e[R](t)}function V(e,t){let r=t.clock.getDelta();for("never"===t.frameloop&&"number"===typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),R=0;R<t.internal.subscribers.length;R++)t.internal.subscribers[R].ref.current(t,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function G(e){const{handlePointer:t}=b(e),r={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};return{connected:!1,handlers:Object.keys(r).reduce(((e,r)=>({...e,[r]:t(r)})),{}),connect:t=>{var n;const{set:i,events:o}=e.getState();null==o.disconnect||o.disconnect(),i((e=>({events:{...e.events,connected:t}}))),Object.entries(null!=(n=null==o?void 0:o.handlers)?n:[]).forEach((([e,n])=>{const[i,o]=r[e];t.addEventListener(i,n,{passive:o})}))},disconnect:()=>{const{set:t,events:n}=e.getState();var i;n.connected&&(Object.entries(null!=(i=n.handlers)?i:[]).forEach((([e,t])=>{if(n&&n.connected instanceof HTMLElement){const[i]=r[e];n.connected.removeEventListener(i,t)}})),t((e=>({events:{...e.events,connected:!1}}))))}}}const z="undefined"!==typeof window?i.useLayoutEffect:i.useEffect;function j({set:e}){return z((()=>(e(new Promise((()=>null))),()=>e(!1))),[]),null}class H extends i.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}H.getDerivedStateFromError=()=>({error:!0});const W=i.forwardRef((function({children:e,fallback:t,tabIndex:r,resize:n,id:o,style:a,className:s,events:l,...c},h){const[d,{width:p,height:m}]=f({scroll:!0,debounce:{scroll:50,resize:0},...n}),g=i.useRef(null),[A,v]=i.useState(!1),[y,x]=i.useState(!1);if(A)throw A;if(y)throw y;return z((()=>{p>0&&m>0&&ae(i.createElement(H,{set:x},i.createElement(i.Suspense,{fallback:i.createElement(j,{set:v})},e)),g.current,{...c,size:{width:p,height:m},events:l||G})}),[p,m,e]),z((()=>{const e=g.current;return()=>le(e)}),[]),i.createElement("div",{ref:d,id:o,className:s,tabIndex:r,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",...a}},i.createElement("canvas",{ref:(0,u.Z)([g,h]),style:{display:"block"}},t))}));function Z(){const e=i.useContext(F);if(!e)throw"R3F hooks can only be used within the Canvas component!";return e}function X(e=(e=>e),t){return Z()(e,t)}function Y(e,t=0){const r=Z().getState().internal.subscribe,n=i.useRef(e);return i.useLayoutEffect((()=>{n.current=e}),[e]),i.useLayoutEffect((()=>r(n,t)),[t,r]),null}function J(e){const t={nodes:{},materials:{}};return e&&e.traverse((e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}function q(e){return i.useMemo((()=>J(e)),[e])}function K(e,t){return function(r,...n){const i=new r;return e&&e(i),Promise.all(n.map((e=>new Promise(((r,n)=>i.load(e,(e=>{e.scene&&Object.assign(e,J(e.scene)),r(e)}),t,(t=>n(`Could not load ${e}: ${t.message}`))))))))}}function $(e,t,r,n){const i=Array.isArray(t)?t:[t],o=(0,c.G)(K(r,n),e,...i);return Array.isArray(t)?o:o[0]}$.preload=function(e,t,r){const n=Array.isArray(t)?t:[t];return c.G.preload(K(r),e,...n)},$.clear=function(e,t){const r=Array.isArray(t)?t:[t];return c.G.clear(e,...r)};const ee=new Map,te=["legacy","blocking","concurrent"],{invalidate:re,advance:ne}=function(e){let t,r=!1;function n(i){if(r=!0,t=0,Q(L,i),e.forEach((e=>{const r=e.store.getState();r.internal.active&&("always"===r.frameloop||r.internal.frames>0)&&(t+=V(i,r))})),Q(D,i),t>0)return requestAnimationFrame(n);Q(N,i),r=!1}return{loop:n,invalidate:function t(i){if(!i)return e.forEach((e=>t(e.store.getState())));!i.vr&&i.internal.active&&"never"!==i.frameloop&&(i.internal.frames=Math.min(60,i.internal.frames+1),r||(r=!0,requestAnimationFrame(n)))},advance:function(t,r=!0,n){r&&Q(L,t),n?V(t,n):e.forEach((e=>V(t,e.store.getState()))),r&&Q(D,t)}}}(ee),{reconciler:ie,applyProps:oe}=function(e){function t(e,{children:t,key:r,ref:n,...i},{children:o,key:a,ref:s,...l}={},c=!1){var u;const h=null!=(u=null==e?void 0:e.__r3f)?u:{},d=Object.entries(i),f=[];if(c){const e=Object.keys(l);for(let t=0;t<e.length;t++)i.hasOwnProperty(e[t])||d.unshift([e[t],E+"remove"])}d.forEach((([t,r])=>{var n,i,o;if(null!=(n=e.__r3f)&&n.primitive&&"object"===t)return;if(i=r,o=l[t],v.arr(i)&&v.equ(i,o)||i===o)return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(t))return f.push([t,r,!0,[]]);let a=[];t.includes("-")&&(a=t.split("-")),f.push([t,r,!1,a])}));const p={...i};return h.memoizedProps&&h.memoizedProps.args&&(p.args=h.memoizedProps.args),h.memoizedProps&&h.memoizedProps.attach&&(p.attach=h.memoizedProps.attach),{accumulative:c,memoized:p,changes:f}}function r(e,r){var a,s,l;const c=null!=(a=null==e?void 0:e.__r3f)?a:{},u=c.root,h=null!=(s=null==u||null==u.getState?void 0:u.getState())?s:{},{memoized:d,changes:f}=(p=r)&&p.memoized&&p.changes?r:t(e,r);var p;const m=c.eventCount;if(e.__r3f&&(e.__r3f.memoizedProps=d),f.forEach((([t,r,o,a])=>{var s;let l=e,u=l[t];if(a.length&&(u=a.reduce(((e,t)=>e[t]),e),!u||!u.set)){const[r,...n]=a.reverse();l=n.reverse().reduce(((e,t)=>e[t]),e),t=r}if(r===E+"remove")if(u&&u.constructor)r=new u.constructor(d.args);else if(l.constructor){const e=new l.constructor(l.__r3f.memoizedProps.args);r=e[u],e.dispose&&e.dispose()}else r=0;const f=(null==h||null==(s=h.gl)?void 0:s.outputEncoding)===n.LinearEncoding;if(o)r?c.handlers[t]=r:delete c.handlers[t],c.eventCount=Object.keys(c.handlers).length;else if(u&&u.set&&(u.copy||u instanceof n.Layers)){if(Array.isArray(r))u.fromArray?u.fromArray(r):u.set(...r);else if(u.copy&&r&&r.constructor&&u.constructor.name===r.constructor.name)u.copy(r);else if(void 0!==r){const e=u instanceof n.Color;!e&&u.setScalar?u.setScalar(r):u instanceof n.Layers&&r instanceof n.Layers?u.mask=r.mask:u.set(r),!f&&e&&u.convertSRGBToLinear()}}else l[t]=r,!f&&l[t]instanceof n.Texture&&(l[t].encoding=n.sRGBEncoding);i(e)})),c.parent&&h.internal&&e.raycast&&m!==c.eventCount){const t=h.internal.interaction.indexOf(e);t>-1&&h.internal.interaction.splice(t,1),c.eventCount&&h.internal.interaction.push(e)}return f.length&&null!=(l=e.__r3f)&&l.parent&&o(e),e}function i(e){var t,r;const n=null==(t=e.__r3f)||null==(r=t.root)||null==r.getState?void 0:r.getState();n&&0===n.internal.frames&&n.invalidate()}function o(e){null==e.onUpdate||e.onUpdate(e)}function a(e,{args:t=[],...i},o,a,s){let l,c=`${e[0].toUpperCase()}${e.slice(1)}`;if(!w(o)&&s){const e=t=>t.return?e(t.return):t.stateNode&&t.stateNode.containerInfo;o=e(s)}if(!o||!w(o))throw`No valid root for ${c}!`;if("primitive"===e){if(void 0===i.object)throw"Primitives without 'object' are invalid!";l=I(i.object,{root:o,primitive:!0})}else{const e=T[c]||n[c];if(!e)throw`${c} is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively`;if(!Array.isArray(t))throw"The args prop must be an array!";l=I(new e(...t),{root:o,memoizedProps:{args:0===t.length?null:t}})}return"attachFns"in i||(c.endsWith("Geometry")?i={attach:"geometry",...i}:c.endsWith("Material")&&(i={attach:"material",...i})),r(l,i),l}function c(e,t){let r=!1;if(t){if(t.attachArray)v.arr(e[t.attachArray])||(e[t.attachArray]=[]),e[t.attachArray].push(t);else if(t.attachObject)v.obj(e[t.attachObject[0]])||(e[t.attachObject[0]]={}),e[t.attachObject[0]][t.attachObject[1]]=t;else if(t.attach&&!v.fun(t.attach))e[t.attach]=t;else if(v.arr(t.attachFns)){const[r]=t.attachFns;v.str(r)&&v.fun(e[r])?e[r](t):v.fun(r)&&r(t,e)}else t.isObject3D&&e.isObject3D&&(e.add(t),r=!0);r||e.__r3f.objects.push(t),t.__r3f||I(t,{}),t.__r3f.parent=e,o(t),i(t)}}function u(e,t,r){let n=!1;if(t){if(t.attachArray){const n=e[t.attachArray];v.arr(n)||(e[t.attachArray]=[]),n.splice(n.indexOf(r),0,t)}else{if(t.attachObject||t.attach&&!v.fun(t.attach))return c(e,t);if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"});const i=e.children.filter((e=>e!==t)),o=i.indexOf(r);e.children=[...i.slice(0,o),t,...i.slice(o)],n=!0}}n||e.__r3f.objects.push(t),t.__r3f||I(t,{}),t.__r3f.parent=e,o(t),i(t)}}function h(e,t,r=!1){e&&[...e].forEach((e=>d(t,e,r)))}function d(e,t,r){if(t){var n,o;if(t.__r3f&&(t.__r3f.parent=null),null!=(n=e.__r3f)&&n.objects&&(e.__r3f.objects=e.__r3f.objects.filter((e=>e!==t))),t.attachArray)e[t.attachArray]=e[t.attachArray].filter((e=>e!==t));else if(t.attachObject)delete e[t.attachObject[0]][t.attachObject[1]];else if(t.attach&&!v.fun(t.attach)&&e[t.attach]===t)e[t.attach]=null;else if(v.arr(t.attachFns)){const[,r]=t.attachFns;v.str(r)&&v.fun(e[r])?e[r](t):v.fun(r)&&r(t,e)}else if(t.isObject3D&&e.isObject3D){var a;e.remove(t),null!=(a=t.__r3f)&&a.root&&function(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter((e=>e!==t)),r.initialHits=r.initialHits.filter((e=>e!==t)),r.hovered.forEach(((e,n)=>{e.eventObject!==t&&e.object!==t||r.hovered.delete(n)})),r.capturedMap.forEach(((e,n)=>{x(r.capturedMap,t,e,n)}))}(t.__r3f.root,t)}const c=null==(o=t.__r3f)?void 0:o.primitive,u=void 0===r?null!==t.dispose&&!c:r;var s;if(!c)h(null==(s=t.__r3f)?void 0:s.objects,t,u),h(t.children,t,u);t.__r3f&&(delete t.__r3f.root,delete t.__r3f.objects,delete t.__r3f.handlers,delete t.__r3f.memoizedProps,c||delete t.__r3f),u&&t.dispose&&"Scene"!==t.type&&(0,l.unstable_runWithPriority)(l.unstable_IdlePriority,(()=>{try{t.dispose()}catch(e){}})),i(e)}}return{reconciler:s()({now:l.unstable_now,createInstance:a,removeChild:d,appendChild:c,appendInitialChild:c,insertBefore:u,warnsIfNotActing:!0,supportsMutation:!0,isPrimaryRenderer:!1,scheduleTimeout:v.fun(setTimeout)?setTimeout:void 0,cancelTimeout:v.fun(clearTimeout)?clearTimeout:void 0,setTimeout:v.fun(setTimeout)?setTimeout:void 0,clearTimeout:v.fun(clearTimeout)?clearTimeout:void 0,noTimeout:-1,appendChildToContainer:(e,t)=>{const{container:r,root:n}=C(e,t);r.__r3f.root=n,c(r,t)},removeChildFromContainer:(e,t)=>d(C(e,t).container,t),insertInContainerBefore:(e,t,r)=>u(C(e,t).container,t,r),prepareUpdate(e,r,n,i){if(e.__r3f.primitive&&i.object&&i.object!==e)return[!0];{const{args:r=[],children:o,...a}=i,{args:s=[],children:l,...u}=n;if(!Array.isArray(r))throw"The args prop must be an array!";if(r.some(((e,t)=>e!==s[t])))return[!0];const h=t(e,a,u,!0);if(h.changes.length)return[!1,h];if(e.attach&&"function"!==typeof e.attach){const t=e.__r3f.parent;t&&t[e.attach]!==e&&c(t,e)}return null}},commitUpdate(e,[t,n],i,o,s,l){t?function(e,t,r,n){var i;const o=null==(i=e.__r3f)?void 0:i.parent;if(!o)return;const s=a(t,r,e.__r3f.root);"primitive"!==t&&e.children&&(e.children.forEach((e=>c(s,e))),e.children=[]),e.__r3f.objects.forEach((e=>c(s,e))),e.__r3f.objects=[],d(o,e),c(o,s),s.raycast&&s.__r3f.eventCount&&s.__r3f.root.getState().internal.interaction.push(s);[n,n.alternate].forEach((e=>{null!==e&&(e.stateNode=s,e.ref&&("function"===typeof e.ref?e.ref(s):e.ref.current=s))}))}(e,i,s,l):r(e,n)},hideInstance(e){e.isObject3D&&(e.visible=!1,i(e))},unhideInstance(e,t){(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0,i(e))},hideTextInstance(){throw new Error("Text is not allowed in the R3F tree.")},getPublicInstance:e=>e,getRootHostContext:e=>S,getChildHostContext:e=>e,createTextInstance(){},finalizeInitialChildren(e){var t;return!!(null!=(t=null==e?void 0:e.__r3f)?t:{}).handlers},commitMount(e){var t;const r=null!=(t=null==e?void 0:e.__r3f)?t:{};e.raycast&&r.handlers&&r.eventCount&&e.__r3f.root.getState().internal.interaction.push(e)},shouldDeprioritizeSubtree:()=>!1,prepareForCommit:()=>null,preparePortalMount(e){I(e)},resetAfterCommit(){},shouldSetTextContent:()=>!1,clearContainer:()=>!1}),applyProps:r}}();function ae(e,t,{gl:r,size:a,mode:s=te[1],events:l,onCreated:c,...u}={}){var h,d,f,p,m;a||(a={width:null!=(d=null==(f=t.parentElement)?void 0:f.clientWidth)?d:0,height:null!=(p=null==(m=t.parentElement)?void 0:m.clientHeight)?p:0});let g=ee.get(t),A=null==g?void 0:g.fiber,y=null==g?void 0:g.store,x=null==(h=y)?void 0:h.getState();if(A&&x){void 0===u.dpr||v.equ(x.viewport.dpr,_(u.dpr))||x.setDpr(u.dpr),x.size.width===a.width&&x.size.height===a.height||x.setSize(a.width,a.height),x.frameloop!==u.frameloop&&x.setFrameloop(u.frameloop);u.linear!==x.internal.lastProps.linear&&(le(t),A=void 0)}if(!A){const e=((e,t)=>{const r="function"===typeof e?e(t):e;if(null!=(i=r)&&i.render)return r;var i;const o=new n.WebGLRenderer({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e});return o.outputEncoding=n.sRGBEncoding,o.toneMapping=n.ACESFilmicToneMapping,e&&oe(o,e),o})(r,t);u.vr&&(e.xr.enabled=!0,e.setAnimationLoop((e=>ne(e,!0)))),y=((e,t,r,a)=>{const{gl:s,size:l,shadows:c=!1,linear:u=!1,flat:h=!1,vr:d=!1,orthographic:f=!1,frameloop:p="always",dpr:m=1,performance:g,clock:A=new n.Clock,raycaster:v,camera:y,onPointerMissed:x}=a;c&&(s.shadowMap.enabled=!0,"object"===typeof c?Object.assign(s.shadowMap,c):s.shadowMap.type=n.PCFSoftShadowMap),u&&(s.outputEncoding=n.LinearEncoding),h&&(s.toneMapping=n.NoToneMapping),"never"===p&&(A.stop(),A.elapsedTime=0);const b=(0,o.default)(((o,l)=>{const c=new n.Raycaster,{params:b,...w}=v||{};e(c,{enabled:!0,...w,params:{...c.params,...b}});const C=y instanceof n.Camera,E=C?y:f?new n.OrthographicCamera(0,0,0,0,.1,1e3):new n.PerspectiveCamera(75,0,.1,1e3);C||(E.position.z=5,y&&e(E,y),null!=y&&y.rotation||E.lookAt(0,0,0));const S=_(m),T=new n.Vector3,M=new n.Vector3,F=new n.Vector3;function P(e=l().camera,t=M,r=l().size){const{width:i,height:o}=r,a=i/o;t instanceof n.Vector3?F.copy(t):F.set(...t);const s=e.getWorldPosition(T).distanceTo(F);if(B(e))return{width:i/e.zoom,height:o/e.zoom,factor:1,distance:s,aspect:a};{const t=e.fov*Math.PI/180,r=2*Math.tan(t/2)*s,n=r*(i/o);return{width:n,height:r,factor:i/n,distance:s,aspect:a}}}let R;const L=e=>o((t=>({performance:{...t.performance,current:e}})));return{gl:s,set:o,get:l,invalidate:()=>t(l()),advance:(e,t)=>r(e,t,l()),linear:u,flat:h,scene:I(new n.Scene),camera:E,controls:null,raycaster:c,clock:A,mouse:new n.Vector2,vr:d,frameloop:p,onPointerMissed:x,performance:{current:1,min:.5,max:1,debounce:200,...g,regress:()=>{const e=l();R&&clearTimeout(R),e.performance.current!==e.performance.min&&L(e.performance.min),R=setTimeout((()=>L(l().performance.max)),e.performance.debounce)}},size:{width:0,height:0},viewport:{initialDpr:S,dpr:S,width:0,height:0,aspect:0,distance:0,factor:0,getCurrentViewport:P},setSize:(e,t)=>{const r={width:e,height:t};o((e=>({size:r,viewport:{...e.viewport,...P(E,M,r)}})))},setDpr:e=>o((t=>({viewport:{...t.viewport,dpr:_(e)}}))),setFrameloop:(e="always")=>o((()=>({frameloop:e}))),events:{connected:!1},internal:{active:!1,priority:0,frames:0,lastProps:a,lastEvent:i.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t=0)=>(o((({internal:r})=>({internal:{...r,priority:r.priority+(t>0?1:0),subscribers:[...r.subscribers,{ref:e,priority:t}].sort(((e,t)=>e.priority-t.priority))}}))),()=>{o((({internal:r})=>({internal:{...r,priority:r.priority-(t>0?1:0),subscribers:r.subscribers.filter((t=>t.ref!==e))}})))})}}})),w=b.getState();let C=w.size,E=w.viewport.dpr;return b.subscribe((()=>{const{camera:e,size:t,viewport:r,internal:i}=b.getState();t===C&&r.dpr===E||(e.manual||i.lastProps.camera instanceof n.Camera||(B(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld()),s.setPixelRatio(r.dpr),s.setSize(t.width,t.height),C=t,E=r.dpr)})),l&&w.setSize(l.width,l.height),b.subscribe((e=>t(e))),b})(oe,re,ne,{gl:e,size:a,...u});const c=y.getState();A=ie.createContainer(y,te.indexOf(s),!1,null),ee.set(t,{fiber:A,store:y}),l&&c.set({events:l(y)})}if(y&&A)return ie.updateContainer(i.createElement(se,{store:y,element:e,onCreated:c,target:t}),A,null,(()=>{})),y;throw"Error creating root!"}function se({store:e,element:t,onCreated:r,target:n}){return i.useEffect((()=>{const t=e.getState();t.set((e=>({internal:{...e.internal,active:!0}}))),null==t.events.connect||t.events.connect(n),r&&r(t)}),[]),i.createElement(F.Provider,{value:e},t)}function le(e,t){const r=ee.get(e),n=null==r?void 0:r.fiber;if(n){const i=null==r?void 0:r.store.getState();i&&(i.internal.active=!1),ie.updateContainer(null,n,null,(()=>{i&&setTimeout((()=>{var r,n,o;null==i.events.disconnect||i.events.disconnect(),null==(r=i.gl)||null==(n=r.renderLists)||null==n.dispose||n.dispose(),null==(o=i.gl)||null==o.forceContextLoss||o.forceContextLoss(),ce(i),ee.delete(e),t&&t(e)}),500)}))}}function ce(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const n in e){var t,r;null==(t=(r=n).dispose)||t.call(r),delete e[n]}}const ue=ie.act;function he(e,t){return ie.createPortal(e,t,null,null)}ie.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:"17.0.2"})},2018:function(e,t,r){"use strict";t._b=t.H7=t.LK=t.Mf=t.SE=t.N$=t.oI=t.$9=t.pT=t.fK=t.ej=t.hI=t.Wx=t.Sj=t.r3=t.ue=t.ZW=t.z5=t.Oq=t.P7=t.bS=t.N7=t.Hs=t.vA=t.ol=t.l$=t.sd=t.dK=t.V3=t.Bw=t.hW=t._o=t.b4=t.nu=t.wd=t.q4=void 0;var n=r(758);Object.defineProperty(t,"q4",{enumerable:!0,get:function(){return n.VERSION}});var i=r(8066);Object.defineProperty(t,"wd",{enumerable:!0,get:function(){return i.CstParser}}),Object.defineProperty(t,"nu",{enumerable:!0,get:function(){return i.EmbeddedActionsParser}}),Object.defineProperty(t,"b4",{enumerable:!0,get:function(){return i.ParserDefinitionErrorType}}),Object.defineProperty(t,"_o",{enumerable:!0,get:function(){return i.EMPTY_ALT}});var o=r(7099);Object.defineProperty(t,"hW",{enumerable:!0,get:function(){return o.Lexer}}),Object.defineProperty(t,"Bw",{enumerable:!0,get:function(){return o.LexerDefinitionErrorType}});var a=r(9359);Object.defineProperty(t,"V3",{enumerable:!0,get:function(){return a.createToken}}),Object.defineProperty(t,"dK",{enumerable:!0,get:function(){return a.createTokenInstance}}),Object.defineProperty(t,"sd",{enumerable:!0,get:function(){return a.EOF}}),Object.defineProperty(t,"l$",{enumerable:!0,get:function(){return a.tokenLabel}}),Object.defineProperty(t,"ol",{enumerable:!0,get:function(){return a.tokenMatcher}}),Object.defineProperty(t,"vA",{enumerable:!0,get:function(){return a.tokenName}});var s=r(4909);Object.defineProperty(t,"Hs",{enumerable:!0,get:function(){return s.defaultParserErrorProvider}});var l=r(303);Object.defineProperty(t,"N7",{enumerable:!0,get:function(){return l.EarlyExitException}}),Object.defineProperty(t,"bS",{enumerable:!0,get:function(){return l.isRecognitionException}}),Object.defineProperty(t,"P7",{enumerable:!0,get:function(){return l.MismatchedTokenException}}),Object.defineProperty(t,"Oq",{enumerable:!0,get:function(){return l.NotAllInputParsedException}}),Object.defineProperty(t,"z5",{enumerable:!0,get:function(){return l.NoViableAltException}});var c=r(9033);Object.defineProperty(t,"ZW",{enumerable:!0,get:function(){return c.defaultLexerErrorProvider}});var u=r(4431);Object.defineProperty(t,"ue",{enumerable:!0,get:function(){return u.Alternation}}),Object.defineProperty(t,"r3",{enumerable:!0,get:function(){return u.Alternative}}),Object.defineProperty(t,"Sj",{enumerable:!0,get:function(){return u.NonTerminal}}),Object.defineProperty(t,"Wx",{enumerable:!0,get:function(){return u.Option}}),Object.defineProperty(t,"hI",{enumerable:!0,get:function(){return u.Repetition}}),Object.defineProperty(t,"ej",{enumerable:!0,get:function(){return u.RepetitionMandatory}}),Object.defineProperty(t,"fK",{enumerable:!0,get:function(){return u.RepetitionMandatoryWithSeparator}}),Object.defineProperty(t,"pT",{enumerable:!0,get:function(){return u.RepetitionWithSeparator}}),Object.defineProperty(t,"$9",{enumerable:!0,get:function(){return u.Rule}}),Object.defineProperty(t,"oI",{enumerable:!0,get:function(){return u.Terminal}});var h=r(4431);Object.defineProperty(t,"N$",{enumerable:!0,get:function(){return h.serializeGrammar}}),Object.defineProperty(t,"SE",{enumerable:!0,get:function(){return h.serializeProduction}});var d=r(655);Object.defineProperty(t,"Mf",{enumerable:!0,get:function(){return d.GAstVisitor}}),t.LK=function(){console.warn("The clearCache function was 'soft' removed from the Chevrotain API.\n\t It performs no action other than printing this message.\n\t Please avoid using it as it will be completely removed in the future")};var f=r(7740);Object.defineProperty(t,"H7",{enumerable:!0,get:function(){return f.createSyntaxDiagramsCode}});var p=function(){throw new Error("The Parser class has been deprecated, use CstParser or EmbeddedActionsParser instead.\t\nSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_7-0-0")};t._b=p},7740:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSyntaxDiagramsCode=void 0;var n=r(758);t.createSyntaxDiagramsCode=function(e,t){var r=void 0===t?{}:t,i=r.resourceBase,o=void 0===i?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/":i,a=r.css;return'\n\x3c!-- This is a generated file --\x3e\n<!DOCTYPE html>\n<meta charset="utf-8">\n<style>\n  body {\n    background-color: hsl(30, 20%, 95%)\n  }\n</style>\n\n'+("\n<link rel='stylesheet' href='"+(void 0===a?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/diagrams.css":a)+"'>\n")+("\n<script src='"+o+"vendor/railroad-diagrams.js'><\/script>\n<script src='"+o+"src/diagrams_builder.js'><\/script>\n<script src='"+o+"src/diagrams_behavior.js'><\/script>\n<script src='"+o+"src/main.js'><\/script>\n")+'\n<div id="diagrams" align="center"></div>    \n'+("\n<script>\n    window.serializedGrammar = "+JSON.stringify(e,null,"  ")+";\n<\/script>\n")+'\n<script>\n    var diagramsDiv = document.getElementById("diagrams");\n    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);\n<\/script>\n'}},2909:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineNameProp=t.functionName=t.classNameFromInstance=void 0;var n=r(5815);t.classNameFromInstance=function(e){return o(e.constructor)};var i="name";function o(e){var t=e.name;return t||"anonymous"}t.functionName=o,t.defineNameProp=function(e,t){var r=Object.getOwnPropertyDescriptor(e,i);return!(!(0,n.isUndefined)(r)&&!r.configurable)&&(Object.defineProperty(e,i,{enumerable:!1,configurable:!0,writable:!1,value:t}),!0)}},2854:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IN=void 0,t.IN="_~IN~_"},4622:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addNoneTerminalToCst=t.addTerminalToCst=t.setNodeLocationFull=t.setNodeLocationOnlyOffset=void 0,t.setNodeLocationOnlyOffset=function(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset===!0&&(e.endOffset=t.endOffset)},t.setNodeLocationFull=function(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset===!0&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)},t.addTerminalToCst=function(e,t,r){void 0===e.children[r]?e.children[r]=[t]:e.children[r].push(t)},t.addNoneTerminalToCst=function(e,t,r){void 0===e.children[t]?e.children[t]=[r]:e.children[t].push(r)}},5765:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateRedundantMethods=t.validateMissingCstMethods=t.validateVisitor=t.CstVisitorDefinitionError=t.createBaseVisitorConstructorWithDefaults=t.createBaseSemanticVisitorConstructor=t.defaultVisit=void 0;var n,i=r(5815),o=r(2909);function a(e,t){for(var r=(0,i.keys)(e),n=r.length,o=0;o<n;o++)for(var a=e[r[o]],s=a.length,l=0;l<s;l++){var c=a[l];void 0===c.tokenTypeIdx&&this[c.name](c.children,t)}}function s(e,t){var r=l(e,t),n=u(e,t);return r.concat(n)}function l(e,t){var r=(0,i.map)(t,(function(t){if(!(0,i.isFunction)(e[t]))return{msg:"Missing visitor method: <"+t+"> on "+(0,o.functionName)(e.constructor)+" CST Visitor.",type:n.MISSING_METHOD,methodName:t}}));return(0,i.compact)(r)}t.defaultVisit=a,t.createBaseSemanticVisitorConstructor=function(e,t){var r=function(){};return(0,o.defineNameProp)(r,e+"BaseSemantics"),(r.prototype={visit:function(e,t){if((0,i.isArray)(e)&&(e=e[0]),!(0,i.isUndefined)(e))return this[e.name](e.children,t)},validateVisitor:function(){var e=s(this,t);if(!(0,i.isEmpty)(e)){var r=(0,i.map)(e,(function(e){return e.msg}));throw Error("Errors Detected in CST Visitor <"+(0,o.functionName)(this.constructor)+">:\n\t"+r.join("\n\n").replace(/\n/g,"\n\t"))}}}).constructor=r,r._RULE_NAMES=t,r},t.createBaseVisitorConstructorWithDefaults=function(e,t,r){var n=function(){};(0,o.defineNameProp)(n,e+"BaseSemanticsWithDefaults");var s=Object.create(r.prototype);return(0,i.forEach)(t,(function(e){s[e]=a})),(n.prototype=s).constructor=n,n},function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"}(n=t.CstVisitorDefinitionError||(t.CstVisitorDefinitionError={})),t.validateVisitor=s,t.validateMissingCstMethods=l;var c=["constructor","visit","validateVisitor"];function u(e,t){var r=[];for(var a in e)!(0,i.isFunction)(e[a])||(0,i.contains)(c,a)||(0,i.contains)(t,a)||r.push({msg:"Redundant visitor method: <"+a+"> on "+(0,o.functionName)(e.constructor)+" CST Visitor\nThere is no Grammar Rule corresponding to this method's name.\n",type:n.REDUNDANT_METHOD,methodName:a});return r}t.validateRedundantMethods=u},4909:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultGrammarValidatorErrorProvider=t.defaultGrammarResolverErrorProvider=t.defaultParserErrorProvider=void 0;var n=r(9359),i=r(5815),o=r(5815),a=r(4431),s=r(9830);t.defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var t=e.expected,r=e.actual;e.previous,e.ruleName;return"Expecting "+((0,n.hasTokenLabel)(t)?"--\x3e "+(0,n.tokenLabel)(t)+" <--":"token of type --\x3e "+t.name+" <--")+" but found --\x3e '"+r.image+"' <--"},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;e.ruleName;return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage:function(e){var t=e.expectedPathsPerAlt,r=e.actual,i=(e.previous,e.customUserDescription),a=(e.ruleName,"Expecting: "),s="\nbut found: '"+(0,o.first)(r).image+"'";if(i)return a+i+s;var l=(0,o.reduce)(t,(function(e,t){return e.concat(t)}),[]),c=(0,o.map)(l,(function(e){return"["+(0,o.map)(e,(function(e){return(0,n.tokenLabel)(e)})).join(", ")+"]"}));return a+("one of these possible Token sequences:\n"+(0,o.map)(c,(function(e,t){return"  "+(t+1)+". "+e})).join("\n"))+s},buildEarlyExitMessage:function(e){var t=e.expectedIterationPaths,r=e.actual,i=e.customUserDescription,a=(e.ruleName,"Expecting: "),s="\nbut found: '"+(0,o.first)(r).image+"'";return i?a+i+s:a+("expecting at least one iteration which starts with one of these possible Token sequences::\n  <"+(0,o.map)(t,(function(e){return"["+(0,o.map)(e,(function(e){return(0,n.tokenLabel)(e)})).join(",")+"]"})).join(" ,")+">")+s}},Object.freeze(t.defaultParserErrorProvider),t.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"}},t.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,t){var r,n=e.name,i=(0,o.first)(t),l=i.idx,c=(0,s.getProductionDslName)(i),u=(r=i)instanceof a.Terminal?r.terminalType.name:r instanceof a.NonTerminal?r.nonTerminalName:"",h="->"+c+(l>0?l:"")+"<- "+(u?"with argument: ->"+u+"<-":"")+"\n                  appears more than once ("+t.length+" times) in the top level rule: ->"+n+"<-.                  \n                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ";return h=(h=h.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildNamespaceConflictError:function(e){return"Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+e.name+">.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(e){var t=(0,o.map)(e.prefixPath,(function(e){return(0,n.tokenLabel)(e)})).join(", "),r=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> due to common lookahead prefix\nin <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\nSee: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(e){var t=(0,o.map)(e.prefixPath,(function(e){return(0,n.tokenLabel)(e)})).join(", "),r=0===e.alternation.idx?"":e.alternation.idx,i="Ambiguous Alternatives Detected: <"+e.ambiguityIndices.join(" ,")+"> in <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\n";return i+="See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES\nFor Further details."},buildEmptyRepetitionError:function(e){var t=(0,s.getProductionDslName)(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <"+t+"> within Rule <"+e.topLevelRule.name+"> can never consume any tokens.\nThis could lead to an infinite loop."},buildTokenNameError:function(e){return"deprecated"},buildEmptyAlternationError:function(e){return"Ambiguous empty alternative: <"+(e.emptyChoiceIdx+1)+"> in <OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\nOnly the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(e){return"An Alternation cannot have more than 256 alternatives:\n<OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\n has "+(e.alternation.definition.length+1)+" alternatives."},buildLeftRecursionError:function(e){var t=e.topLevelRule.name;return"Left Recursion found in grammar.\nrule: <"+t+"> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is: \n "+(t+" --\x3e "+i.map(e.leftRecursionPath,(function(e){return e.name})).concat([t]).join(" --\x3e "))+"\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring."},buildInvalidRuleNameError:function(e){return"deprecated"},buildDuplicateRuleNameError:function(e){return"Duplicate definition, rule: ->"+(e.topLevelRule instanceof a.Rule?e.topLevelRule.name:e.topLevelRule)+"<- is already defined in the grammar: ->"+e.grammarName+"<-"}}},303:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.EarlyExitException=t.NotAllInputParsedException=t.NoViableAltException=t.MismatchedTokenException=t.isRecognitionException=void 0;var i=r(5815),o="MismatchedTokenException",a="NoViableAltException",s="EarlyExitException",l="NotAllInputParsedException",c=[o,a,s,l];Object.freeze(c),t.isRecognitionException=function(e){return(0,i.contains)(c,e.name)};var u=function(e){function t(t,r){var n=this.constructor,i=e.call(this,t)||this;return i.token=r,i.resyncedTokens=[],Object.setPrototypeOf(i,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,i.constructor),i}return n(t,e),t}(Error),h=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.previousToken=n,i.name=o,i}return n(t,e),t}(u);t.MismatchedTokenException=h;var d=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.previousToken=n,i.name=a,i}return n(t,e),t}(u);t.NoViableAltException=d;var f=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.name=l,n}return n(t,e),t}(u);t.NotAllInputParsedException=f;var p=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.previousToken=n,i.name=s,i}return n(t,e),t}(u);t.EarlyExitException=p},6722:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.checkPrefixAlternativesAmbiguities=t.validateSomeNonEmptyLookaheadPath=t.validateTooManyAlts=t.RepetionCollector=t.validateAmbiguousAlternationAlternatives=t.validateEmptyOrAlternative=t.getFirstNoneTerminal=t.validateNoLeftRecursion=t.validateRuleIsOverridden=t.validateRuleDoesNotAlreadyExist=t.OccurrenceValidationCollector=t.identifyProductionForDuplicates=t.validateGrammar=void 0;var i=r(5815),o=r(5815),a=r(8066),s=r(9830),l=r(9339),c=r(4761),u=r(4431),h=r(655);function d(e){return(0,s.getProductionDslName)(e)+"_#_"+e.idx+"_#_"+f(e)}function f(e){return e instanceof u.Terminal?e.terminalType.name:e instanceof u.NonTerminal?e.nonTerminalName:""}t.validateGrammar=function(e,t,r,n,l){var c=i.map(e,(function(e){return function(e,t){var r=new p;e.accept(r);var n=r.allProductions,o=i.groupBy(n,d),l=i.pick(o,(function(e){return e.length>1}));return i.map(i.values(l),(function(r){var n=i.first(r),o=t.buildDuplicateFoundError(e,r),l=(0,s.getProductionDslName)(n),c={message:o,type:a.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:n.idx},u=f(n);return u&&(c.parameter=u),c}))}(e,n)})),u=i.map(e,(function(e){return g(e,e,n)})),h=[],A=[],v=[];(0,o.every)(u,o.isEmpty)&&(h=(0,o.map)(e,(function(e){return y(e,n)})),A=(0,o.map)(e,(function(e){return x(e,t,n)})),v=C(e,t,n));var b=function(e,t,r){var n=[],i=(0,o.map)(t,(function(e){return e.name}));return(0,o.forEach)(e,(function(e){var t=e.name;if((0,o.contains)(i,t)){var s=r.buildNamespaceConflictError(e);n.push({message:s,type:a.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t})}})),n}(e,r,n),E=(0,o.map)(e,(function(e){return w(e,n)})),S=(0,o.map)(e,(function(t){return m(t,e,l,n)}));return i.flatten(c.concat(v,u,h,A,b,E,S))},t.identifyProductionForDuplicates=d;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return n(t,e),t.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},t.prototype.visitOption=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t.prototype.visitAlternation=function(e){this.allProductions.push(e)},t.prototype.visitTerminal=function(e){this.allProductions.push(e)},t}(h.GAstVisitor);function m(e,t,r,n){var i=[];if((0,o.reduce)(t,(function(t,r){return r.name===e.name?t+1:t}),0)>1){var s=n.buildDuplicateRuleNameError({topLevelRule:e,grammarName:r});i.push({message:s,type:a.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function g(e,t,r,n){void 0===n&&(n=[]);var o=[],s=A(t.definition);if(i.isEmpty(s))return[];var l=e.name;i.contains(s,e)&&o.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:n}),type:a.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:l});var c=i.difference(s,n.concat([e])),u=i.map(c,(function(t){var o=i.cloneArr(n);return o.push(t),g(e,t,r,o)}));return o.concat(i.flatten(u))}function A(e){var t=[];if(i.isEmpty(e))return t;var r=i.first(e);if(r instanceof u.NonTerminal)t.push(r.referencedRule);else if(r instanceof u.Alternative||r instanceof u.Option||r instanceof u.RepetitionMandatory||r instanceof u.RepetitionMandatoryWithSeparator||r instanceof u.RepetitionWithSeparator||r instanceof u.Repetition)t=t.concat(A(r.definition));else if(r instanceof u.Alternation)t=i.flatten(i.map(r.definition,(function(e){return A(e.definition)})));else if(!(r instanceof u.Terminal))throw Error("non exhaustive match");var n=(0,s.isOptionalProd)(r),o=e.length>1;if(n&&o){var a=i.drop(e);return t.concat(A(a))}return t}t.OccurrenceValidationCollector=p,t.validateRuleDoesNotAlreadyExist=m,t.validateRuleIsOverridden=function(e,t,r){var n,o=[];return i.contains(t,e)||(n="Invalid rule override, rule: ->"+e+"<- cannot be overridden in the grammar: ->"+r+"<-as it is not defined in any of the super grammars ",o.push({message:n,type:a.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),o},t.validateNoLeftRecursion=g,t.getFirstNoneTerminal=A;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.alternations=[],t}return n(t,e),t.prototype.visitAlternation=function(e){this.alternations.push(e)},t}(h.GAstVisitor);function y(e,t){var r=new v;e.accept(r);var n=r.alternations;return i.reduce(n,(function(r,n){var o=i.dropRight(n.definition),s=i.map(o,(function(r,o){var s=(0,c.nextPossibleTokensAfter)([r],[],null,1);return i.isEmpty(s)?{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:n,emptyChoiceIdx:o}),type:a.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:n.idx,alternative:o+1}:null}));return r.concat(i.compact(s))}),[])}function x(e,t,r){var n=new v;e.accept(n);var s=n.alternations;return s=(0,o.reject)(s,(function(e){return!0===e.ignoreAmbiguities})),i.reduce(s,(function(n,s){var c=s.idx,u=s.maxLookahead||t,h=(0,l.getLookaheadPathsForOr)(c,e,u,s),d=function(e,t,r,n){var s=[],c=(0,o.reduce)(e,(function(r,n,i){return!0===t.definition[i].ignoreAmbiguities||(0,o.forEach)(n,(function(n){var a=[i];(0,o.forEach)(e,(function(e,r){i!==r&&(0,l.containsPath)(e,n)&&!0!==t.definition[r].ignoreAmbiguities&&a.push(r)})),a.length>1&&!(0,l.containsPath)(s,n)&&(s.push(n),r.push({alts:a,path:n}))})),r}),[]);return i.map(c,(function(e){var i=(0,o.map)(e.alts,(function(e){return e+1}));return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:a.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:t.idx,alternatives:[e.alts]}}))}(h,s,e,r),f=E(h,s,e,r);return n.concat(d,f)}),[])}t.validateEmptyOrAlternative=y,t.validateAmbiguousAlternationAlternatives=x;var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return n(t,e),t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t}(h.GAstVisitor);function w(e,t){var r=new v;e.accept(r);var n=r.alternations;return i.reduce(n,(function(r,n){return n.definition.length>255&&r.push({message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:n}),type:a.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:e.name,occurrence:n.idx}),r}),[])}function C(e,t,r){var n=[];return(0,o.forEach)(e,(function(e){var i=new b;e.accept(i);var s=i.allProductions;(0,o.forEach)(s,(function(i){var s=(0,l.getProdType)(i),c=i.maxLookahead||t,u=i.idx,h=(0,l.getLookaheadPathsForOptionalProd)(u,e,s,c)[0];if((0,o.isEmpty)((0,o.flatten)(h))){var d=r.buildEmptyRepetitionError({topLevelRule:e,repetition:i});n.push({message:d,type:a.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:e.name})}}))})),n}function E(e,t,r,n){var i=[],s=(0,o.reduce)(e,(function(e,t,r){var n=(0,o.map)(t,(function(e){return{idx:r,path:e}}));return e.concat(n)}),[]);return(0,o.forEach)(s,(function(e){if(!0!==t.definition[e.idx].ignoreAmbiguities){var c=e.idx,u=e.path,h=(0,o.findAll)(s,(function(e){return!0!==t.definition[e.idx].ignoreAmbiguities&&e.idx<c&&(0,l.isStrictPrefixOfPath)(e.path,u)})),d=(0,o.map)(h,(function(e){var i=[e.idx+1,c+1],o=0===t.idx?"":t.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:a.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:o,alternatives:i}}));i=i.concat(d)}})),i}t.RepetionCollector=b,t.validateTooManyAlts=w,t.validateSomeNonEmptyLookaheadPath=C,t.checkPrefixAlternativesAmbiguities=E},5381:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.firstForTerminal=t.firstForBranching=t.firstForSequence=t.first=void 0;var n=r(5815),i=r(4431),o=r(9830);function a(e){if(e instanceof i.NonTerminal)return a(e.referencedRule);if(e instanceof i.Terminal)return c(e);if((0,o.isSequenceProd)(e))return s(e);if((0,o.isBranchingProd)(e))return l(e);throw Error("non exhaustive match")}function s(e){for(var t,r=[],i=e.definition,s=0,l=i.length>s,c=!0;l&&c;)t=i[s],c=(0,o.isOptionalProd)(t),r=r.concat(a(t)),s+=1,l=i.length>s;return(0,n.uniq)(r)}function l(e){var t=(0,n.map)(e.definition,(function(e){return a(e)}));return(0,n.uniq)((0,n.flatten)(t))}function c(e){return[e.terminalType]}t.first=a,t.firstForSequence=s,t.firstForBranching=l,t.firstForTerminal=c},9013:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.buildInProdFollowPrefix=t.buildBetweenProdsFollowPrefix=t.computeAllProdsFollows=t.ResyncFollowsWalker=void 0;var i=r(6286),o=r(5381),a=r(5815),s=r(2854),l=r(4431),c=function(e){function t(t){var r=e.call(this)||this;return r.topProd=t,r.follows={},r}return n(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},t.prototype.walkTerminal=function(e,t,r){},t.prototype.walkProdRef=function(e,t,r){var n=u(e.referencedRule,e.idx)+this.topProd.name,i=t.concat(r),a=new l.Alternative({definition:i}),s=(0,o.first)(a);this.follows[n]=s},t}(i.RestWalker);function u(e,t){return e.name+t+s.IN}t.ResyncFollowsWalker=c,t.computeAllProdsFollows=function(e){var t={};return(0,a.forEach)(e,(function(e){var r=new c(e).startWalking();(0,a.assign)(t,r)})),t},t.buildBetweenProdsFollowPrefix=u,t.buildInProdFollowPrefix=function(e){return e.terminalType.name+e.idx+s.IN}},9830:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.collectMethods=t.DslMethodsCollectorVisitor=t.getProductionDslName=t.isBranchingProd=t.isOptionalProd=t.isSequenceProd=void 0;var i=r(5815),o=r(4431),a=r(655);t.isSequenceProd=function(e){return e instanceof o.Alternative||e instanceof o.Option||e instanceof o.Repetition||e instanceof o.RepetitionMandatory||e instanceof o.RepetitionMandatoryWithSeparator||e instanceof o.RepetitionWithSeparator||e instanceof o.Terminal||e instanceof o.Rule},t.isOptionalProd=function e(t,r){return void 0===r&&(r=[]),!!(t instanceof o.Option||t instanceof o.Repetition||t instanceof o.RepetitionWithSeparator)||(t instanceof o.Alternation?(0,i.some)(t.definition,(function(t){return e(t,r)})):!(t instanceof o.NonTerminal&&(0,i.contains)(r,t))&&(t instanceof o.AbstractProduction&&(t instanceof o.NonTerminal&&r.push(t),(0,i.every)(t.definition,(function(t){return e(t,r)})))))},t.isBranchingProd=function(e){return e instanceof o.Alternation},t.getProductionDslName=function(e){if(e instanceof o.NonTerminal)return"SUBRULE";if(e instanceof o.Option)return"OPTION";if(e instanceof o.Alternation)return"OR";if(e instanceof o.RepetitionMandatory)return"AT_LEAST_ONE";if(e instanceof o.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(e instanceof o.RepetitionWithSeparator)return"MANY_SEP";if(e instanceof o.Repetition)return"MANY";if(e instanceof o.Terminal)return"CONSUME";throw Error("non exhaustive match")};var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return n(t,e),t.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},t.prototype.visitTerminal=function(e){var t=e.terminalType.name+this.separator+"Terminal";(0,i.has)(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitNonTerminal=function(e){var t=e.nonTerminalName+this.separator+"Terminal";(0,i.has)(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitOption=function(e){this.dslMethods.option.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},t.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},t.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)},t}(a.GAstVisitor);t.DslMethodsCollectorVisitor=s;var l=new s;t.collectMethods=function(e){l.reset(),e.accept(l);var t=l.dslMethods;return l.reset(),t}},4431:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.serializeProduction=t.serializeGrammar=t.Terminal=t.Alternation=t.RepetitionWithSeparator=t.Repetition=t.RepetitionMandatoryWithSeparator=t.RepetitionMandatory=t.Option=t.Alternative=t.Rule=t.NonTerminal=t.AbstractProduction=void 0;var i=r(5815),o=r(9359),a=function(){function e(e){this._definition=e}return Object.defineProperty(e.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e},enumerable:!1,configurable:!0}),e.prototype.accept=function(e){e.visit(this),(0,i.forEach)(this.definition,(function(t){t.accept(e)}))},e}();t.AbstractProduction=a;var s=function(e){function t(t){var r=e.call(this,[])||this;return r.idx=1,(0,i.assign)(r,(0,i.pick)(t,(function(e){return void 0!==e}))),r}return n(t,e),Object.defineProperty(t.prototype,"definition",{get:function(){return void 0!==this.referencedRule?this.referencedRule.definition:[]},set:function(e){},enumerable:!1,configurable:!0}),t.prototype.accept=function(e){e.visit(this)},t}(a);t.NonTerminal=s;var l=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.orgText="",(0,i.assign)(r,(0,i.pick)(t,(function(e){return void 0!==e}))),r}return n(t,e),t}(a);t.Rule=l;var c=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.ignoreAmbiguities=!1,(0,i.assign)(r,(0,i.pick)(t,(function(e){return void 0!==e}))),r}return n(t,e),t}(a);t.Alternative=c;var u=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,(0,i.assign)(r,(0,i.pick)(t,(function(e){return void 0!==e}))),r}return n(t,e),t}(a);t.Option=u;var h=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,(0,i.assign)(r,(0,i.pick)(t,(function(e){return void 0!==e}))),r}return n(t,e),t}(a);t.RepetitionMandatory=h;var d=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,(0,i.assign)(r,(0,i.pick)(t,(function(e){return void 0!==e}))),r}return n(t,e),t}(a);t.RepetitionMandatoryWithSeparator=d;var f=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,(0,i.assign)(r,(0,i.pick)(t,(function(e){return void 0!==e}))),r}return n(t,e),t}(a);t.Repetition=f;var p=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,(0,i.assign)(r,(0,i.pick)(t,(function(e){return void 0!==e}))),r}return n(t,e),t}(a);t.RepetitionWithSeparator=p;var m=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,r.ignoreAmbiguities=!1,r.hasPredicates=!1,(0,i.assign)(r,(0,i.pick)(t,(function(e){return void 0!==e}))),r}return n(t,e),Object.defineProperty(t.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e},enumerable:!1,configurable:!0}),t}(a);t.Alternation=m;var g=function(){function e(e){this.idx=1,(0,i.assign)(this,(0,i.pick)(e,(function(e){return void 0!==e})))}return e.prototype.accept=function(e){e.visit(this)},e}();function A(e){function t(e){return(0,i.map)(e,A)}if(e instanceof s){var r={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return(0,i.isString)(e.label)&&(r.label=e.label),r}if(e instanceof c)return{type:"Alternative",definition:t(e.definition)};if(e instanceof u)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof h)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof d)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:A(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof p)return{type:"RepetitionWithSeparator",idx:e.idx,separator:A(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof f)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof m)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof g){var n={type:"Terminal",name:e.terminalType.name,label:(0,o.tokenLabel)(e.terminalType),idx:e.idx};(0,i.isString)(e.label)&&(n.terminalLabel=e.label);var a=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=(0,i.isRegExp)(a)?a.source:a),n}if(e instanceof l)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}t.Terminal=g,t.serializeGrammar=function(e){return(0,i.map)(e,A)},t.serializeProduction=A},3202:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateGrammar=t.resolveGrammar=void 0;var n=r(5815),i=r(5995),o=r(6722),a=r(4909);t.resolveGrammar=function(e){e=(0,n.defaults)(e,{errMsgProvider:a.defaultGrammarResolverErrorProvider});var t={};return(0,n.forEach)(e.rules,(function(e){t[e.name]=e})),(0,i.resolveGrammar)(t,e.errMsgProvider)},t.validateGrammar=function(e){return e=(0,n.defaults)(e,{errMsgProvider:a.defaultGrammarValidatorErrorProvider}),(0,o.validateGrammar)(e.rules,e.maxLookahead,e.tokenTypes,e.errMsgProvider,e.grammarName)}},655:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GAstVisitor=void 0;var n=r(4431),i=function(){function e(){}return e.prototype.visit=function(e){var t=e;switch(t.constructor){case n.NonTerminal:return this.visitNonTerminal(t);case n.Alternative:return this.visitAlternative(t);case n.Option:return this.visitOption(t);case n.RepetitionMandatory:return this.visitRepetitionMandatory(t);case n.RepetitionMandatoryWithSeparator:return this.visitRepetitionMandatoryWithSeparator(t);case n.RepetitionWithSeparator:return this.visitRepetitionWithSeparator(t);case n.Repetition:return this.visitRepetition(t);case n.Alternation:return this.visitAlternation(t);case n.Terminal:return this.visitTerminal(t);case n.Rule:return this.visitRule(t);default:throw Error("non exhaustive match")}},e.prototype.visitNonTerminal=function(e){},e.prototype.visitAlternative=function(e){},e.prototype.visitOption=function(e){},e.prototype.visitRepetition=function(e){},e.prototype.visitRepetitionMandatory=function(e){},e.prototype.visitRepetitionMandatoryWithSeparator=function(e){},e.prototype.visitRepetitionWithSeparator=function(e){},e.prototype.visitAlternation=function(e){},e.prototype.visitTerminal=function(e){},e.prototype.visitRule=function(e){},e}();t.GAstVisitor=i},4761:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.nextPossibleTokensAfter=t.possiblePathsFrom=t.NextTerminalAfterAtLeastOneSepWalker=t.NextTerminalAfterAtLeastOneWalker=t.NextTerminalAfterManySepWalker=t.NextTerminalAfterManyWalker=t.AbstractNextTerminalAfterProductionWalker=t.NextAfterTokenWalker=t.AbstractNextPossibleTokensWalker=void 0;var i=r(6286),o=r(5815),a=r(5381),s=r(4431),l=function(e){function t(t,r){var n=e.call(this)||this;return n.topProd=t,n.path=r,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}return n(t,e),t.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=(0,o.cloneArr)(this.path.ruleStack).reverse(),this.occurrenceStack=(0,o.cloneArr)(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},t.prototype.walk=function(t,r){void 0===r&&(r=[]),this.found||e.prototype.walk.call(this,t,r)},t.prototype.walkProdRef=function(e,t,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){var n=t.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,n)}},t.prototype.updateExpectedNext=function(){(0,o.isEmpty)(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},t}(i.RestWalker);t.AbstractNextPossibleTokensWalker=l;var c=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.path=r,n.nextTerminalName="",n.nextTerminalOccurrence=0,n.nextTerminalName=n.path.lastTok.name,n.nextTerminalOccurrence=n.path.lastTokOccurrence,n}return n(t,e),t.prototype.walkTerminal=function(e,t,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){var n=t.concat(r),i=new s.Alternative({definition:n});this.possibleTokTypes=(0,a.first)(i),this.found=!0}},t}(l);t.NextAfterTokenWalker=c;var u=function(e){function t(t,r){var n=e.call(this)||this;return n.topRule=t,n.occurrence=r,n.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},n}return n(t,e),t.prototype.startWalking=function(){return this.walk(this.topRule),this.result},t}(i.RestWalker);t.AbstractNextTerminalAfterProductionWalker=u;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.walkMany=function(t,r,n){if(t.idx===this.occurrence){var i=(0,o.first)(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof s.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkMany.call(this,t,r,n)},t}(u);t.NextTerminalAfterManyWalker=h;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.walkManySep=function(t,r,n){if(t.idx===this.occurrence){var i=(0,o.first)(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof s.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkManySep.call(this,t,r,n)},t}(u);t.NextTerminalAfterManySepWalker=d;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.walkAtLeastOne=function(t,r,n){if(t.idx===this.occurrence){var i=(0,o.first)(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof s.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOne.call(this,t,r,n)},t}(u);t.NextTerminalAfterAtLeastOneWalker=f;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.walkAtLeastOneSep=function(t,r,n){if(t.idx===this.occurrence){var i=(0,o.first)(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof s.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOneSep.call(this,t,r,n)},t}(u);function m(e,t,r,n){var i=(0,o.cloneArr)(r);i.push(e.name);var a=(0,o.cloneArr)(n);return a.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:a}}t.NextTerminalAfterAtLeastOneSepWalker=p,t.possiblePathsFrom=function e(t,r,n){void 0===n&&(n=[]),n=(0,o.cloneArr)(n);var i=[],a=0;function l(s){var l=e(s.concat((0,o.drop)(t,a+1)),r,n);return i.concat(l)}for(;n.length<r&&a<t.length;){var c=t[a];if(c instanceof s.Alternative)return l(c.definition);if(c instanceof s.NonTerminal)return l(c.definition);if(c instanceof s.Option)i=l(c.definition);else{if(c instanceof s.RepetitionMandatory)return l(u=c.definition.concat([new s.Repetition({definition:c.definition})]));if(c instanceof s.RepetitionMandatoryWithSeparator)return l(u=[new s.Alternative({definition:c.definition}),new s.Repetition({definition:[new s.Terminal({terminalType:c.separator})].concat(c.definition)})]);if(c instanceof s.RepetitionWithSeparator){var u=c.definition.concat([new s.Repetition({definition:[new s.Terminal({terminalType:c.separator})].concat(c.definition)})]);i=l(u)}else if(c instanceof s.Repetition){u=c.definition.concat([new s.Repetition({definition:c.definition})]);i=l(u)}else{if(c instanceof s.Alternation)return(0,o.forEach)(c.definition,(function(e){!1===(0,o.isEmpty)(e.definition)&&(i=l(e.definition))})),i;if(!(c instanceof s.Terminal))throw Error("non exhaustive match");n.push(c.terminalType)}}a++}return i.push({partialPath:n,suffixDef:(0,o.drop)(t,a)}),i},t.nextPossibleTokensAfter=function(e,t,r,n){var i="EXIT_NONE_TERMINAL",a=[i],l="EXIT_ALTERNATIVE",c=!1,u=t.length,h=u-n-1,d=[],f=[];for(f.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!(0,o.isEmpty)(f);){var p=f.pop();if(p!==l){var g=p.def,A=p.idx,v=p.ruleStack,y=p.occurrenceStack;if(!(0,o.isEmpty)(g)){var x=g[0];if(x===i){var b={idx:A,def:(0,o.drop)(g),ruleStack:(0,o.dropRight)(v),occurrenceStack:(0,o.dropRight)(y)};f.push(b)}else if(x instanceof s.Terminal)if(A<u-1){var w=A+1;if(r(t[w],x.terminalType)){b={idx:w,def:(0,o.drop)(g),ruleStack:v,occurrenceStack:y};f.push(b)}}else{if(A!==u-1)throw Error("non exhaustive match");d.push({nextTokenType:x.terminalType,nextTokenOccurrence:x.idx,ruleStack:v,occurrenceStack:y}),c=!0}else if(x instanceof s.NonTerminal){var C=(0,o.cloneArr)(v);C.push(x.nonTerminalName);var E=(0,o.cloneArr)(y);E.push(x.idx);b={idx:A,def:x.definition.concat(a,(0,o.drop)(g)),ruleStack:C,occurrenceStack:E};f.push(b)}else if(x instanceof s.Option){var S={idx:A,def:(0,o.drop)(g),ruleStack:v,occurrenceStack:y};f.push(S),f.push(l);var T={idx:A,def:x.definition.concat((0,o.drop)(g)),ruleStack:v,occurrenceStack:y};f.push(T)}else if(x instanceof s.RepetitionMandatory){var M=new s.Repetition({definition:x.definition,idx:x.idx});b={idx:A,def:x.definition.concat([M],(0,o.drop)(g)),ruleStack:v,occurrenceStack:y};f.push(b)}else if(x instanceof s.RepetitionMandatoryWithSeparator){var I=new s.Terminal({terminalType:x.separator});M=new s.Repetition({definition:[I].concat(x.definition),idx:x.idx}),b={idx:A,def:x.definition.concat([M],(0,o.drop)(g)),ruleStack:v,occurrenceStack:y};f.push(b)}else if(x instanceof s.RepetitionWithSeparator){S={idx:A,def:(0,o.drop)(g),ruleStack:v,occurrenceStack:y};f.push(S),f.push(l);I=new s.Terminal({terminalType:x.separator});var B=new s.Repetition({definition:[I].concat(x.definition),idx:x.idx});T={idx:A,def:x.definition.concat([B],(0,o.drop)(g)),ruleStack:v,occurrenceStack:y};f.push(T)}else if(x instanceof s.Repetition){S={idx:A,def:(0,o.drop)(g),ruleStack:v,occurrenceStack:y};f.push(S),f.push(l);B=new s.Repetition({definition:x.definition,idx:x.idx}),T={idx:A,def:x.definition.concat([B],(0,o.drop)(g)),ruleStack:v,occurrenceStack:y};f.push(T)}else if(x instanceof s.Alternation)for(var _=x.definition.length-1;_>=0;_--){var F={idx:A,def:x.definition[_].definition.concat((0,o.drop)(g)),ruleStack:v,occurrenceStack:y};f.push(F),f.push(l)}else if(x instanceof s.Alternative)f.push({idx:A,def:x.definition.concat((0,o.drop)(g)),ruleStack:v,occurrenceStack:y});else{if(!(x instanceof s.Rule))throw Error("non exhaustive match");f.push(m(x,A,v,y))}}}else c&&(0,o.last)(f).idx<=h&&f.pop()}return d}},968:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyForAutomaticLookahead=t.AT_LEAST_ONE_SEP_IDX=t.MANY_SEP_IDX=t.AT_LEAST_ONE_IDX=t.MANY_IDX=t.OPTION_IDX=t.OR_IDX=t.BITS_FOR_ALT_IDX=t.BITS_FOR_RULE_IDX=t.BITS_FOR_OCCURRENCE_IDX=t.BITS_FOR_METHOD_TYPE=void 0,t.BITS_FOR_METHOD_TYPE=4,t.BITS_FOR_OCCURRENCE_IDX=8,t.BITS_FOR_RULE_IDX=12,t.BITS_FOR_ALT_IDX=8,t.OR_IDX=1<<t.BITS_FOR_OCCURRENCE_IDX,t.OPTION_IDX=2<<t.BITS_FOR_OCCURRENCE_IDX,t.MANY_IDX=3<<t.BITS_FOR_OCCURRENCE_IDX,t.AT_LEAST_ONE_IDX=4<<t.BITS_FOR_OCCURRENCE_IDX,t.MANY_SEP_IDX=5<<t.BITS_FOR_OCCURRENCE_IDX,t.AT_LEAST_ONE_SEP_IDX=6<<t.BITS_FOR_OCCURRENCE_IDX,t.getKeyForAutomaticLookahead=function(e,t,r){return r|t|e};t.BITS_FOR_ALT_IDX},9339:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.areTokenCategoriesNotUsed=t.isStrictPrefixOfPath=t.containsPath=t.getLookaheadPathsForOptionalProd=t.getLookaheadPathsForOr=t.lookAheadSequenceFromAlternatives=t.buildSingleAlternativeLookaheadFunction=t.buildAlternativesLookAheadFunc=t.buildLookaheadFuncForOptionalProd=t.buildLookaheadFuncForOr=t.getProdType=t.PROD_TYPE=void 0;var i,o=r(5815),a=r(4761),s=r(6286),l=r(2423),c=r(4431),u=r(655);!function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"}(i=t.PROD_TYPE||(t.PROD_TYPE={})),t.getProdType=function(e){if(e instanceof c.Option)return i.OPTION;if(e instanceof c.Repetition)return i.REPETITION;if(e instanceof c.RepetitionMandatory)return i.REPETITION_MANDATORY;if(e instanceof c.RepetitionMandatoryWithSeparator)return i.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof c.RepetitionWithSeparator)return i.REPETITION_WITH_SEPARATOR;if(e instanceof c.Alternation)return i.ALTERNATION;throw Error("non exhaustive match")},t.buildLookaheadFuncForOr=function(e,t,r,n,i,o){var a=A(e,t,r);return o(a,n,x(a)?l.tokenStructuredMatcherNoCategories:l.tokenStructuredMatcher,i)},t.buildLookaheadFuncForOptionalProd=function(e,t,r,n,i,o){var a=v(e,t,i,r),s=x(a)?l.tokenStructuredMatcherNoCategories:l.tokenStructuredMatcher;return o(a[0],s,n)},t.buildAlternativesLookAheadFunc=function(e,t,r,n){var i=e.length,a=(0,o.every)(e,(function(e){return(0,o.every)(e,(function(e){return 1===e.length}))}));if(t)return function(t){for(var n=(0,o.map)(t,(function(e){return e.GATE})),a=0;a<i;a++){var s=e[a],l=s.length,c=n[a];if(void 0===c||!1!==c.call(this))e:for(var u=0;u<l;u++){for(var h=s[u],d=h.length,f=0;f<d;f++){var p=this.LA(f+1);if(!1===r(p,h[f]))continue e}return a}}};if(a&&!n){var s=(0,o.map)(e,(function(e){return(0,o.flatten)(e)})),l=(0,o.reduce)(s,(function(e,t,r){return(0,o.forEach)(t,(function(t){(0,o.has)(e,t.tokenTypeIdx)||(e[t.tokenTypeIdx]=r),(0,o.forEach)(t.categoryMatches,(function(t){(0,o.has)(e,t)||(e[t]=r)}))})),e}),[]);return function(){var e=this.LA(1);return l[e.tokenTypeIdx]}}return function(){for(var t=0;t<i;t++){var n=e[t],o=n.length;e:for(var a=0;a<o;a++){for(var s=n[a],l=s.length,c=0;c<l;c++){var u=this.LA(c+1);if(!1===r(u,s[c]))continue e}return t}}}},t.buildSingleAlternativeLookaheadFunction=function(e,t,r){var n=(0,o.every)(e,(function(e){return 1===e.length})),i=e.length;if(n&&!r){var a=(0,o.flatten)(e);if(1===a.length&&(0,o.isEmpty)(a[0].categoryMatches)){var s=a[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===s}}var l=(0,o.reduce)(a,(function(e,t,r){return e[t.tokenTypeIdx]=!0,(0,o.forEach)(t.categoryMatches,(function(t){e[t]=!0})),e}),[]);return function(){var e=this.LA(1);return!0===l[e.tokenTypeIdx]}}return function(){e:for(var r=0;r<i;r++){for(var n=e[r],o=n.length,a=0;a<o;a++){var s=this.LA(a+1);if(!1===t(s,n[a]))continue e}return!0}return!1}};var h=function(e){function t(t,r,n){var i=e.call(this)||this;return i.topProd=t,i.targetOccurrence=r,i.targetProdType=n,i}return n(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},t.prototype.checkIsTarget=function(e,t,r,n){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=r.concat(n),!0)},t.prototype.walkOption=function(t,r,n){this.checkIsTarget(t,i.OPTION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOne=function(t,r,n){this.checkIsTarget(t,i.REPETITION_MANDATORY,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOneSep=function(t,r,n){this.checkIsTarget(t,i.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkMany=function(t,r,n){this.checkIsTarget(t,i.REPETITION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkManySep=function(t,r,n){this.checkIsTarget(t,i.REPETITION_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t}(s.RestWalker),d=function(e){function t(t,r,n){var i=e.call(this)||this;return i.targetOccurrence=t,i.targetProdType=r,i.targetRef=n,i.result=[],i}return n(t,e),t.prototype.checkIsTarget=function(e,t){e.idx!==this.targetOccurrence||this.targetProdType!==t||void 0!==this.targetRef&&e!==this.targetRef||(this.result=e.definition)},t.prototype.visitOption=function(e){this.checkIsTarget(e,i.OPTION)},t.prototype.visitRepetition=function(e){this.checkIsTarget(e,i.REPETITION)},t.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,i.REPETITION_MANDATORY)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,i.REPETITION_MANDATORY_WITH_SEPARATOR)},t.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,i.REPETITION_WITH_SEPARATOR)},t.prototype.visitAlternation=function(e){this.checkIsTarget(e,i.ALTERNATION)},t}(u.GAstVisitor);function f(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=[];return t}function p(e){for(var t=[""],r=0;r<e.length;r++){for(var n=e[r],i=[],o=0;o<t.length;o++){var a=t[o];i.push(a+"_"+n.tokenTypeIdx);for(var s=0;s<n.categoryMatches.length;s++){var l="_"+n.categoryMatches[s];i.push(a+l)}}t=i}return t}function m(e,t,r){for(var n=0;n<e.length;n++)if(n!==r)for(var i=e[n],o=0;o<t.length;o++){if(!0===i[t[o]])return!1}return!0}function g(e,t){for(var r=(0,o.map)(e,(function(e){return(0,a.possiblePathsFrom)([e],1)})),n=f(r.length),i=(0,o.map)(r,(function(e){var t={};return(0,o.forEach)(e,(function(e){var r=p(e.partialPath);(0,o.forEach)(r,(function(e){t[e]=!0}))})),t})),s=r,l=1;l<=t;l++){var c=s;s=f(c.length);for(var u=function(e){for(var r=c[e],u=0;u<r.length;u++){var h=r[u].partialPath,d=r[u].suffixDef,f=p(h);if(m(i,f,e)||(0,o.isEmpty)(d)||h.length===t){var g=n[e];if(!1===y(g,h)){g.push(h);for(var A=0;A<f.length;A++){var v=f[A];i[e][v]=!0}}}else{var x=(0,a.possiblePathsFrom)(d,l+1,h);s[e]=s[e].concat(x),(0,o.forEach)(x,(function(t){var r=p(t.partialPath);(0,o.forEach)(r,(function(t){i[e][t]=!0}))}))}}},h=0;h<c.length;h++)u(h)}return n}function A(e,t,r,n){var o=new d(e,i.ALTERNATION,n);return t.accept(o),g(o.result,r)}function v(e,t,r,n){var i=new d(e,r);t.accept(i);var o=i.result,a=new h(t,e,r).startWalking();return g([new c.Alternative({definition:o}),new c.Alternative({definition:a})],n)}function y(e,t){e:for(var r=0;r<e.length;r++){var n=e[r];if(n.length===t.length){for(var i=0;i<n.length;i++){var o=t[i],a=n[i];if(!1===(o===a||void 0!==a.categoryMatchesMap[o.tokenTypeIdx]))continue e}return!0}}return!1}function x(e){return(0,o.every)(e,(function(e){return(0,o.every)(e,(function(e){return(0,o.every)(e,(function(e){return(0,o.isEmpty)(e.categoryMatches)}))}))}))}t.lookAheadSequenceFromAlternatives=g,t.getLookaheadPathsForOr=A,t.getLookaheadPathsForOptionalProd=v,t.containsPath=y,t.isStrictPrefixOfPath=function(e,t){return e.length<t.length&&(0,o.every)(e,(function(e,r){var n=t[r];return e===n||n.categoryMatchesMap[e.tokenTypeIdx]}))},t.areTokenCategoriesNotUsed=x},5995:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.GastRefResolverVisitor=t.resolveGrammar=void 0;var i=r(8066),o=r(5815),a=r(655);t.resolveGrammar=function(e,t){var r=new s(e,t);return r.resolveRefs(),r.errors};var s=function(e){function t(t,r){var n=e.call(this)||this;return n.nameToTopRule=t,n.errMsgProvider=r,n.errors=[],n}return n(t,e),t.prototype.resolveRefs=function(){var e=this;(0,o.forEach)((0,o.values)(this.nameToTopRule),(function(t){e.currTopLevel=t,t.accept(e)}))},t.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule[e.nonTerminalName];if(t)e.referencedRule=t;else{var r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:i.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}},t}(a.GAstVisitor);t.GastRefResolverVisitor=s},6286:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RestWalker=void 0;var n=r(5815),i=r(4431),o=function(){function e(){}return e.prototype.walk=function(e,t){var r=this;void 0===t&&(t=[]),(0,n.forEach)(e.definition,(function(o,a){var s=(0,n.drop)(e.definition,a+1);if(o instanceof i.NonTerminal)r.walkProdRef(o,s,t);else if(o instanceof i.Terminal)r.walkTerminal(o,s,t);else if(o instanceof i.Alternative)r.walkFlat(o,s,t);else if(o instanceof i.Option)r.walkOption(o,s,t);else if(o instanceof i.RepetitionMandatory)r.walkAtLeastOne(o,s,t);else if(o instanceof i.RepetitionMandatoryWithSeparator)r.walkAtLeastOneSep(o,s,t);else if(o instanceof i.RepetitionWithSeparator)r.walkManySep(o,s,t);else if(o instanceof i.Repetition)r.walkMany(o,s,t);else{if(!(o instanceof i.Alternation))throw Error("non exhaustive match");r.walkOr(o,s,t)}}))},e.prototype.walkTerminal=function(e,t,r){},e.prototype.walkProdRef=function(e,t,r){},e.prototype.walkFlat=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkOption=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkAtLeastOne=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkAtLeastOneSep=function(e,t,r){var n=a(e,t,r);this.walk(e,n)},e.prototype.walkMany=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkManySep=function(e,t,r){var n=a(e,t,r);this.walk(e,n)},e.prototype.walkOr=function(e,t,r){var o=this,a=t.concat(r);(0,n.forEach)(e.definition,(function(e){var t=new i.Alternative({definition:[e]});o.walk(t,a)}))},e}();function a(e,t,r){return[new i.Option({definition:[new i.Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}t.RestWalker=o},8066:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.EmbeddedActionsParser=t.CstParser=t.Parser=t.EMPTY_ALT=t.ParserDefinitionErrorType=t.DEFAULT_RULE_CONFIG=t.DEFAULT_PARSER_CONFIG=t.END_OF_FILE=void 0;var i=r(5815),o=r(9013),a=r(9359),s=r(4909),l=r(3202),c=r(7087),u=r(2416),h=r(5174),d=r(8989),f=r(7287),p=r(5750),m=r(8047),g=r(2224),A=r(4835),v=r(2551),y=r(242);t.END_OF_FILE=(0,a.createTokenInstance)(a.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(t.END_OF_FILE),t.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:s.defaultParserErrorProvider,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),t.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS"}(t.ParserDefinitionErrorType||(t.ParserDefinitionErrorType={})),t.EMPTY_ALT=function(e){return void 0===e&&(e=void 0),function(){return e}};var x=function(){function e(e,r){this.definitionErrors=[],this.selfAnalysisDone=!1;var n=this;if(n.initErrorHandler(r),n.initLexerAdapter(),n.initLooksAhead(r),n.initRecognizerEngine(e,r),n.initRecoverable(r),n.initTreeBuilder(r),n.initContentAssist(),n.initGastRecorder(r),n.initPerformanceTracer(r),(0,i.has)(r,"ignoredIssues"))throw new Error("The <ignoredIssues> IParserConfig property has been deprecated.\n\tPlease use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.\n\tSee: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES\n\tFor further details.");this.skipValidations=(0,i.has)(r,"skipValidations")?r.skipValidations:t.DEFAULT_PARSER_CONFIG.skipValidations}return e.performSelfAnalysis=function(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.\t\nUse the **instance** method with the same name instead.")},e.prototype.performSelfAnalysis=function(){var t=this;this.TRACE_INIT("performSelfAnalysis",(function(){var r;t.selfAnalysisDone=!0;var n=t.className;t.TRACE_INIT("toFastProps",(function(){(0,i.toFastProperties)(t)})),t.TRACE_INIT("Grammar Recording",(function(){try{t.enableRecording(),(0,i.forEach)(t.definedRulesNames,(function(e){var r=t[e].originalGrammarAction,n=void 0;t.TRACE_INIT(e+" Rule",(function(){n=t.topLevelRuleRecord(e,r)})),t.gastProductionsCache[e]=n}))}finally{t.disableRecording()}}));var a=[];if(t.TRACE_INIT("Grammar Resolving",(function(){a=(0,l.resolveGrammar)({rules:(0,i.values)(t.gastProductionsCache)}),t.definitionErrors=t.definitionErrors.concat(a)})),t.TRACE_INIT("Grammar Validations",(function(){if((0,i.isEmpty)(a)&&!1===t.skipValidations){var e=(0,l.validateGrammar)({rules:(0,i.values)(t.gastProductionsCache),maxLookahead:t.maxLookahead,tokenTypes:(0,i.values)(t.tokensMap),errMsgProvider:s.defaultGrammarValidatorErrorProvider,grammarName:n});t.definitionErrors=t.definitionErrors.concat(e)}})),(0,i.isEmpty)(t.definitionErrors)&&(t.recoveryEnabled&&t.TRACE_INIT("computeAllProdsFollows",(function(){var e=(0,o.computeAllProdsFollows)((0,i.values)(t.gastProductionsCache));t.resyncFollows=e})),t.TRACE_INIT("ComputeLookaheadFunctions",(function(){t.preComputeLookaheadFunctions((0,i.values)(t.gastProductionsCache))}))),!e.DEFER_DEFINITION_ERRORS_HANDLING&&!(0,i.isEmpty)(t.definitionErrors))throw r=(0,i.map)(t.definitionErrors,(function(e){return e.message})),new Error("Parser Definition Errors detected:\n "+r.join("\n-------------------------------\n"))}))},e.DEFER_DEFINITION_ERRORS_HANDLING=!1,e}();t.Parser=x,(0,y.applyMixins)(x,[c.Recoverable,u.LooksAhead,h.TreeBuilder,d.LexerAdapter,p.RecognizerEngine,f.RecognizerApi,m.ErrorHandler,g.ContentAssist,A.GastRecorder,v.PerformanceTracer]);var b=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var o=(0,i.cloneObj)(n);return o.outputCst=!0,e.call(this,r,o)||this}return n(r,e),r}(x);t.CstParser=b;var w=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var o=(0,i.cloneObj)(n);return o.outputCst=!1,e.call(this,r,o)||this}return n(r,e),r}(x);t.EmbeddedActionsParser=w},2224:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContentAssist=void 0;var n=r(4761),i=r(5815),o=function(){function e(){}return e.prototype.initContentAssist=function(){},e.prototype.computeContentAssist=function(e,t){var r=this.gastProductionsCache[e];if((0,i.isUndefined)(r))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return(0,n.nextPossibleTokensAfter)([r],t,this.tokenMatcher,this.maxLookahead)},e.prototype.getNextPossibleTokenTypes=function(e){var t=(0,i.first)(e.ruleStack),r=this.getGAstProductions()[t];return new n.NextAfterTokenWalker(r,e).startWalking()},e}();t.ContentAssist=o},8047:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorHandler=void 0;var n=r(303),i=r(5815),o=r(9339),a=r(8066),s=function(){function e(){}return e.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=(0,i.has)(e,"errorMessageProvider")?e.errorMessageProvider:a.DEFAULT_PARSER_CONFIG.errorMessageProvider},e.prototype.SAVE_ERROR=function(e){if((0,n.isRecognitionException)(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:(0,i.cloneArr)(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(e.prototype,"errors",{get:function(){return(0,i.cloneArr)(this._errors)},set:function(e){this._errors=e},enumerable:!1,configurable:!0}),e.prototype.raiseEarlyExitException=function(e,t,r){for(var i=this.getCurrRuleFullName(),a=this.getGAstProductions()[i],s=(0,o.getLookaheadPathsForOptionalProd)(e,a,t,this.maxLookahead)[0],l=[],c=1;c<=this.maxLookahead;c++)l.push(this.LA(c));var u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:s,actual:l,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new n.EarlyExitException(u,this.LA(1),this.LA(0)))},e.prototype.raiseNoAltException=function(e,t){for(var r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],a=(0,o.getLookaheadPathsForOr)(e,i,this.maxLookahead),s=[],l=1;l<=this.maxLookahead;l++)s.push(this.LA(l));var c=this.LA(0),u=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:a,actual:s,previous:c,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new n.NoViableAltException(u,this.LA(1),c))},e}();t.ErrorHandler=s},4835:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GastRecorder=void 0;var n=r(5815),i=r(4431),o=r(7099),a=r(2423),s=r(9359),l=r(8066),c=r(968),u={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(u);var h=Math.pow(2,c.BITS_FOR_OCCURRENCE_IDX)-1,d=(0,s.createToken)({name:"RECORDING_PHASE_TOKEN",pattern:o.Lexer.NA});(0,a.augmentTokenTypes)([d]);var f=(0,s.createTokenInstance)(d,"This IToken indicates the Parser is in Recording Phase\n\tSee: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",-1,-1,-1,-1,-1,-1);Object.freeze(f);var p={name:"This CSTNode indicates the Parser is in Recording Phase\n\tSee: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",children:{}},m=function(){function e(){}return e.prototype.initGastRecorder=function(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1},e.prototype.enableRecording=function(){var e=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",(function(){for(var t=function(t){var r=t>0?t:"";e["CONSUME"+r]=function(e,r){return this.consumeInternalRecord(e,t,r)},e["SUBRULE"+r]=function(e,r){return this.subruleInternalRecord(e,t,r)},e["OPTION"+r]=function(e){return this.optionInternalRecord(e,t)},e["OR"+r]=function(e){return this.orInternalRecord(e,t)},e["MANY"+r]=function(e){this.manyInternalRecord(t,e)},e["MANY_SEP"+r]=function(e){this.manySepFirstInternalRecord(t,e)},e["AT_LEAST_ONE"+r]=function(e){this.atLeastOneInternalRecord(t,e)},e["AT_LEAST_ONE_SEP"+r]=function(e){this.atLeastOneSepFirstInternalRecord(t,e)}},r=0;r<10;r++)t(r);e.consume=function(e,t,r){return this.consumeInternalRecord(t,e,r)},e.subrule=function(e,t,r){return this.subruleInternalRecord(t,e,r)},e.option=function(e,t){return this.optionInternalRecord(t,e)},e.or=function(e,t){return this.orInternalRecord(t,e)},e.many=function(e,t){this.manyInternalRecord(e,t)},e.atLeastOne=function(e,t){this.atLeastOneInternalRecord(e,t)},e.ACTION=e.ACTION_RECORD,e.BACKTRACK=e.BACKTRACK_RECORD,e.LA=e.LA_RECORD}))},e.prototype.disableRecording=function(){var e=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",(function(){for(var t=0;t<10;t++){var r=t>0?t:"";delete e["CONSUME"+r],delete e["SUBRULE"+r],delete e["OPTION"+r],delete e["OR"+r],delete e["MANY"+r],delete e["MANY_SEP"+r],delete e["AT_LEAST_ONE"+r],delete e["AT_LEAST_ONE_SEP"+r]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA}))},e.prototype.ACTION_RECORD=function(e){},e.prototype.BACKTRACK_RECORD=function(e,t){return function(){return!0}},e.prototype.LA_RECORD=function(e){return l.END_OF_FILE},e.prototype.topLevelRuleRecord=function(e,t){try{var r=new i.Rule({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),t.call(this),this.recordingProdStack.pop(),r}catch(n){if(!0!==n.KNOWN_RECORDER_ERROR)try{n.message=n.message+'\n\t This error was thrown during the "grammar recording phase" For more info see:\n\thttps://chevrotain.io/docs/guide/internals.html#grammar-recording'}catch(o){throw n}throw n}},e.prototype.optionInternalRecord=function(e,t){return g.call(this,i.Option,e,t)},e.prototype.atLeastOneInternalRecord=function(e,t){g.call(this,i.RepetitionMandatory,t,e)},e.prototype.atLeastOneSepFirstInternalRecord=function(e,t){g.call(this,i.RepetitionMandatoryWithSeparator,t,e,true)},e.prototype.manyInternalRecord=function(e,t){g.call(this,i.Repetition,t,e)},e.prototype.manySepFirstInternalRecord=function(e,t){g.call(this,i.RepetitionWithSeparator,t,e,true)},e.prototype.orInternalRecord=function(e,t){return A.call(this,e,t)},e.prototype.subruleInternalRecord=function(e,t,r){if(y(t),!e||!1===(0,n.has)(e,"ruleName")){var o=new Error("<SUBRULE"+v(t)+"> argument is invalid expecting a Parser method reference but got: <"+JSON.stringify(e)+">\n inside top level rule: <"+this.recordingProdStack[0].name+">");throw o.KNOWN_RECORDER_ERROR=!0,o}var a=(0,n.peek)(this.recordingProdStack),s=e.ruleName,l=new i.NonTerminal({idx:t,nonTerminalName:s,label:null===r||void 0===r?void 0:r.LABEL,referencedRule:void 0});return a.definition.push(l),this.outputCst?p:u},e.prototype.consumeInternalRecord=function(e,t,r){if(y(t),!(0,a.hasShortKeyProperty)(e)){var o=new Error("<CONSUME"+v(t)+"> argument is invalid expecting a TokenType reference but got: <"+JSON.stringify(e)+">\n inside top level rule: <"+this.recordingProdStack[0].name+">");throw o.KNOWN_RECORDER_ERROR=!0,o}var s=(0,n.peek)(this.recordingProdStack),l=new i.Terminal({idx:t,terminalType:e,label:null===r||void 0===r?void 0:r.LABEL});return s.definition.push(l),f},e}();function g(e,t,r,i){void 0===i&&(i=!1),y(r);var o=(0,n.peek)(this.recordingProdStack),a=(0,n.isFunction)(t)?t:t.DEF,s=new e({definition:[],idx:r});return i&&(s.separator=t.SEP),(0,n.has)(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(s),a.call(this),o.definition.push(s),this.recordingProdStack.pop(),u}function A(e,t){var r=this;y(t);var o=(0,n.peek)(this.recordingProdStack),a=!1===(0,n.isArray)(e),s=!1===a?e:e.DEF,l=new i.Alternation({definition:[],idx:t,ignoreAmbiguities:a&&!0===e.IGNORE_AMBIGUITIES});(0,n.has)(e,"MAX_LOOKAHEAD")&&(l.maxLookahead=e.MAX_LOOKAHEAD);var c=(0,n.some)(s,(function(e){return(0,n.isFunction)(e.GATE)}));return l.hasPredicates=c,o.definition.push(l),(0,n.forEach)(s,(function(e){var t=new i.Alternative({definition:[]});l.definition.push(t),(0,n.has)(e,"IGNORE_AMBIGUITIES")?t.ignoreAmbiguities=e.IGNORE_AMBIGUITIES:(0,n.has)(e,"GATE")&&(t.ignoreAmbiguities=!0),r.recordingProdStack.push(t),e.ALT.call(r),r.recordingProdStack.pop()})),u}function v(e){return 0===e?"":""+e}function y(e){if(e<0||e>h){var t=new Error("Invalid DSL Method idx value: <"+e+">\n\tIdx value must be a none negative value smaller than "+(h+1));throw t.KNOWN_RECORDER_ERROR=!0,t}}t.GastRecorder=m},8989:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LexerAdapter=void 0;var n=r(8066),i=function(){function e(){}return e.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(e.prototype,"input",{get:function(){return this.tokVector},set:function(e){if(!0!==this.selfAnalysisDone)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!1,configurable:!0}),e.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):n.END_OF_FILE},e.prototype.LA=function(e){var t=this.currIdx+e;return t<0||this.tokVectorLength<=t?n.END_OF_FILE:this.tokVector[t]},e.prototype.consumeToken=function(){this.currIdx++},e.prototype.exportLexerState=function(){return this.currIdx},e.prototype.importLexerState=function(e){this.currIdx=e},e.prototype.resetLexerState=function(){this.currIdx=-1},e.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},e.prototype.getLexerPosition=function(){return this.exportLexerState()},e}();t.LexerAdapter=i},2416:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LooksAhead=void 0;var n=r(9339),i=r(5815),o=r(8066),a=r(968),s=r(9830),l=function(){function e(){}return e.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=(0,i.has)(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:o.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=(0,i.has)(e,"maxLookahead")?e.maxLookahead:o.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=(0,i.isES2015MapSupported)()?new Map:[],(0,i.isES2015MapSupported)()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},e.prototype.preComputeLookaheadFunctions=function(e){var t=this;(0,i.forEach)(e,(function(e){t.TRACE_INIT(e.name+" Rule Lookahead",(function(){var r=(0,s.collectMethods)(e),o=r.alternation,l=r.repetition,c=r.option,u=r.repetitionMandatory,h=r.repetitionMandatoryWithSeparator,d=r.repetitionWithSeparator;(0,i.forEach)(o,(function(r){var i=0===r.idx?"":r.idx;t.TRACE_INIT(""+(0,s.getProductionDslName)(r)+i,(function(){var i=(0,n.buildLookaheadFuncForOr)(r.idx,e,r.maxLookahead||t.maxLookahead,r.hasPredicates,t.dynamicTokensEnabled,t.lookAheadBuilderForAlternatives),o=(0,a.getKeyForAutomaticLookahead)(t.fullRuleNameToShort[e.name],a.OR_IDX,r.idx);t.setLaFuncCache(o,i)}))})),(0,i.forEach)(l,(function(r){t.computeLookaheadFunc(e,r.idx,a.MANY_IDX,n.PROD_TYPE.REPETITION,r.maxLookahead,(0,s.getProductionDslName)(r))})),(0,i.forEach)(c,(function(r){t.computeLookaheadFunc(e,r.idx,a.OPTION_IDX,n.PROD_TYPE.OPTION,r.maxLookahead,(0,s.getProductionDslName)(r))})),(0,i.forEach)(u,(function(r){t.computeLookaheadFunc(e,r.idx,a.AT_LEAST_ONE_IDX,n.PROD_TYPE.REPETITION_MANDATORY,r.maxLookahead,(0,s.getProductionDslName)(r))})),(0,i.forEach)(h,(function(r){t.computeLookaheadFunc(e,r.idx,a.AT_LEAST_ONE_SEP_IDX,n.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,r.maxLookahead,(0,s.getProductionDslName)(r))})),(0,i.forEach)(d,(function(r){t.computeLookaheadFunc(e,r.idx,a.MANY_SEP_IDX,n.PROD_TYPE.REPETITION_WITH_SEPARATOR,r.maxLookahead,(0,s.getProductionDslName)(r))}))}))}))},e.prototype.computeLookaheadFunc=function(e,t,r,i,o,s){var l=this;this.TRACE_INIT(""+s+(0===t?"":t),(function(){var s=(0,n.buildLookaheadFuncForOptionalProd)(t,e,o||l.maxLookahead,l.dynamicTokensEnabled,i,l.lookAheadBuilderForOptional),c=(0,a.getKeyForAutomaticLookahead)(l.fullRuleNameToShort[e.name],r,t);l.setLaFuncCache(c,s)}))},e.prototype.lookAheadBuilderForOptional=function(e,t,r){return(0,n.buildSingleAlternativeLookaheadFunction)(e,t,r)},e.prototype.lookAheadBuilderForAlternatives=function(e,t,r,i){return(0,n.buildAlternativesLookAheadFunc)(e,t,r,i)},e.prototype.getKeyForAutomaticLookahead=function(e,t){var r=this.getLastExplicitRuleShortName();return(0,a.getKeyForAutomaticLookahead)(r,e,t)},e.prototype.getLaFuncFromCache=function(e){},e.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},e.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},e.prototype.setLaFuncCache=function(e,t){},e.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},e.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},e}();t.LooksAhead=l},2551:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceTracer=void 0;var n=r(5815),i=r(8066),o=function(){function e(){}return e.prototype.initPerformanceTracer=function(e){if((0,n.has)(e,"traceInitPerf")){var t=e.traceInitPerf,r="number"===typeof t;this.traceInitMaxIdent=r?t:1/0,this.traceInitPerf=r?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=i.DEFAULT_PARSER_CONFIG.traceInitPerf;this.traceInitIndent=-1},e.prototype.TRACE_INIT=function(e,t){if(!0===this.traceInitPerf){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("\t");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--\x3e <"+e+">");var i=(0,n.timer)(t),o=i.time,a=i.value,s=o>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&s(r+"<-- <"+e+"> time: "+o+"ms"),this.traceInitIndent--,a}return t()},e}();t.PerformanceTracer=o},7287:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecognizerApi=void 0;var n=r(5815),i=r(303),o=r(8066),a=r(4909),s=r(6722),l=r(4431),c=function(){function e(){}return e.prototype.ACTION=function(e){return e.call(this)},e.prototype.consume=function(e,t,r){return this.consumeInternal(t,e,r)},e.prototype.subrule=function(e,t,r){return this.subruleInternal(t,e,r)},e.prototype.option=function(e,t){return this.optionInternal(t,e)},e.prototype.or=function(e,t){return this.orInternal(t,e)},e.prototype.many=function(e,t){return this.manyInternal(e,t)},e.prototype.atLeastOne=function(e,t){return this.atLeastOneInternal(e,t)},e.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},e.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},e.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},e.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},e.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},e.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},e.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},e.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},e.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},e.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},e.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},e.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},e.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},e.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},e.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},e.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},e.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},e.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},e.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},e.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},e.prototype.OPTION=function(e){return this.optionInternal(e,0)},e.prototype.OPTION1=function(e){return this.optionInternal(e,1)},e.prototype.OPTION2=function(e){return this.optionInternal(e,2)},e.prototype.OPTION3=function(e){return this.optionInternal(e,3)},e.prototype.OPTION4=function(e){return this.optionInternal(e,4)},e.prototype.OPTION5=function(e){return this.optionInternal(e,5)},e.prototype.OPTION6=function(e){return this.optionInternal(e,6)},e.prototype.OPTION7=function(e){return this.optionInternal(e,7)},e.prototype.OPTION8=function(e){return this.optionInternal(e,8)},e.prototype.OPTION9=function(e){return this.optionInternal(e,9)},e.prototype.OR=function(e){return this.orInternal(e,0)},e.prototype.OR1=function(e){return this.orInternal(e,1)},e.prototype.OR2=function(e){return this.orInternal(e,2)},e.prototype.OR3=function(e){return this.orInternal(e,3)},e.prototype.OR4=function(e){return this.orInternal(e,4)},e.prototype.OR5=function(e){return this.orInternal(e,5)},e.prototype.OR6=function(e){return this.orInternal(e,6)},e.prototype.OR7=function(e){return this.orInternal(e,7)},e.prototype.OR8=function(e){return this.orInternal(e,8)},e.prototype.OR9=function(e){return this.orInternal(e,9)},e.prototype.MANY=function(e){this.manyInternal(0,e)},e.prototype.MANY1=function(e){this.manyInternal(1,e)},e.prototype.MANY2=function(e){this.manyInternal(2,e)},e.prototype.MANY3=function(e){this.manyInternal(3,e)},e.prototype.MANY4=function(e){this.manyInternal(4,e)},e.prototype.MANY5=function(e){this.manyInternal(5,e)},e.prototype.MANY6=function(e){this.manyInternal(6,e)},e.prototype.MANY7=function(e){this.manyInternal(7,e)},e.prototype.MANY8=function(e){this.manyInternal(8,e)},e.prototype.MANY9=function(e){this.manyInternal(9,e)},e.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},e.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},e.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},e.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},e.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},e.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},e.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},e.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},e.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},e.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},e.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},e.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},e.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},e.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},e.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},e.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},e.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},e.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},e.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},e.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},e.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},e.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},e.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},e.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},e.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},e.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},e.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},e.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},e.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},e.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},e.prototype.RULE=function(e,t,r){if(void 0===r&&(r=o.DEFAULT_RULE_CONFIG),(0,n.contains)(this.definedRulesNames,e)){var i={message:a.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:o.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}this.definedRulesNames.push(e);var s=this.defineRule(e,t,r);return this[e]=s,s},e.prototype.OVERRIDE_RULE=function(e,t,r){void 0===r&&(r=o.DEFAULT_RULE_CONFIG);var n=[];n=n.concat((0,s.validateRuleIsOverridden)(e,this.definedRulesNames,this.className)),this.definitionErrors=this.definitionErrors.concat(n);var i=this.defineRule(e,t,r);return this[e]=i,i},e.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(n){if((0,i.isRecognitionException)(n))return!1;throw n}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},e.prototype.getGAstProductions=function(){return this.gastProductionsCache},e.prototype.getSerializedGastProductions=function(){return(0,l.serializeGrammar)((0,n.values)(this.gastProductionsCache))},e}();t.RecognizerApi=c},5750:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecognizerEngine=void 0;var n=r(5815),i=r(968),o=r(303),a=r(9339),s=r(4761),l=r(8066),c=r(7087),u=r(9359),h=r(2423),d=r(2909),f=function(){function e(){}return e.prototype.initRecognizerEngine=function(e,t){if(this.className=(0,d.classNameFromInstance)(this),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=h.tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},(0,n.has)(t,"serializedGrammar"))throw Error("The Parser's configuration can no longer contain a <serializedGrammar> property.\n\tSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0\n\tFor Further details.");if((0,n.isArray)(e)){if((0,n.isEmpty)(e))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"===typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if((0,n.isArray)(e))this.tokensMap=(0,n.reduce)(e,(function(e,t){return e[t.name]=t,e}),{});else if((0,n.has)(e,"modes")&&(0,n.every)((0,n.flatten)((0,n.values)(e.modes)),h.isTokenType)){var r=(0,n.flatten)((0,n.values)(e.modes)),i=(0,n.uniq)(r);this.tokensMap=(0,n.reduce)(i,(function(e,t){return e[t.name]=t,e}),{})}else{if(!(0,n.isObject)(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=(0,n.cloneObj)(e)}this.tokensMap.EOF=u.EOF;var o=(0,n.every)((0,n.values)(e),(function(e){return(0,n.isEmpty)(e.categoryMatches)}));this.tokenMatcher=o?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher,(0,h.augmentTokenTypes)((0,n.values)(this.tokensMap))},e.prototype.defineRule=function(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+"> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var o=(0,n.has)(r,"resyncEnabled")?r.resyncEnabled:l.DEFAULT_RULE_CONFIG.resyncEnabled,a=(0,n.has)(r,"recoveryValueFunc")?r.recoveryValueFunc:l.DEFAULT_RULE_CONFIG.recoveryValueFunc,s=this.ruleShortNameIdx<<i.BITS_FOR_METHOD_TYPE+i.BITS_FOR_OCCURRENCE_IDX;function c(e){try{if(!0===this.outputCst){t.apply(this,e);var r=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(r),r}return t.apply(this,e)}catch(n){return this.invokeRuleCatch(n,o,a)}finally{this.ruleFinallyStateUpdate()}}this.ruleShortNameIdx++,this.shortRuleNameToFull[s]=e,this.fullRuleNameToShort[e]=s;var u=function(t,r){return void 0===t&&(t=0),this.ruleInvocationStateUpdate(s,e,t),c.call(this,r)};return u.ruleName=e,u.originalGrammarAction=t,u},e.prototype.invokeRuleCatch=function(e,t,r){var n=1===this.RULE_STACK.length,i=t&&!this.isBackTracking()&&this.recoveryEnabled;if((0,o.isRecognitionException)(e)){var a=e;if(i){var s,l=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(l))return a.resyncedTokens=this.reSyncTo(l),this.outputCst?((s=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,s):r();throw this.outputCst&&((s=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,a.partialCstResult=s),a}if(n)return this.moveToTerminatedState(),r();throw a}throw e},e.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t);return this.optionInternalLogic(e,t,r)},e.prototype.optionInternalLogic=function(e,t,r){var n,i,o=this,a=this.getLaFuncFromCache(r);if(void 0!==e.DEF){if(n=e.DEF,void 0!==(i=e.GATE)){var s=a;a=function(){return i.call(o)&&s.call(o)}}}else n=e;if(!0===a.call(this))return n.call(this)},e.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e);return this.atLeastOneInternalLogic(e,t,r)},e.prototype.atLeastOneInternalLogic=function(e,t,r){var n,o,l=this,c=this.getLaFuncFromCache(r);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(o=t.GATE)){var u=c;c=function(){return o.call(l)&&u.call(l)}}}else n=t;if(!0!==c.call(this))throw this.raiseEarlyExitException(e,a.PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);for(var h=this.doSingleRepetition(n);!0===c.call(this)&&!0===h;)h=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],c,i.AT_LEAST_ONE_IDX,e,s.NextTerminalAfterAtLeastOneWalker)},e.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},e.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var n=this,o=t.DEF,l=t.SEP;if(!0!==this.getLaFuncFromCache(r).call(this))throw this.raiseEarlyExitException(e,a.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);o.call(this);for(var c=function(){return n.tokenMatcher(n.LA(1),l)};!0===this.tokenMatcher(this.LA(1),l);)this.CONSUME(l),o.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,l,c,o,s.NextTerminalAfterAtLeastOneSepWalker],c,i.AT_LEAST_ONE_SEP_IDX,e,s.NextTerminalAfterAtLeastOneSepWalker)},e.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_IDX,e);return this.manyInternalLogic(e,t,r)},e.prototype.manyInternalLogic=function(e,t,r){var n,o,a=this,l=this.getLaFuncFromCache(r);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(o=t.GATE)){var c=l;l=function(){return o.call(a)&&c.call(a)}}}else n=t;for(var u=!0;!0===l.call(this)&&!0===u;)u=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],l,i.MANY_IDX,e,s.NextTerminalAfterManyWalker,u)},e.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,r)},e.prototype.manySepFirstInternalLogic=function(e,t,r){var n=this,o=t.DEF,a=t.SEP;if(!0===this.getLaFuncFromCache(r).call(this)){o.call(this);for(var l=function(){return n.tokenMatcher(n.LA(1),a)};!0===this.tokenMatcher(this.LA(1),a);)this.CONSUME(a),o.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,a,l,o,s.NextTerminalAfterManySepWalker],l,i.MANY_SEP_IDX,e,s.NextTerminalAfterManySepWalker)}},e.prototype.repetitionSepSecondInternal=function(e,t,r,n,o){for(;r();)this.CONSUME(t),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,n,o],r,i.AT_LEAST_ONE_SEP_IDX,e,o)},e.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t},e.prototype.orInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OR_IDX,t),o=(0,n.isArray)(e)?e:e.DEF,a=this.getLaFuncFromCache(r).call(this,o);if(void 0!==a)return o[a].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)},e.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!1===this.isAtEndOfInput()){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new o.NotAllInputParsedException(t,e))}},e.prototype.subruleInternal=function(e,t,r){var n;try{var i=void 0!==r?r.ARGS:void 0;return n=e.call(this,t,i),this.cstPostNonTerminal(n,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),n}catch(o){this.subruleInternalError(o,r,e.ruleName)}},e.prototype.subruleInternalError=function(e,t,r){throw(0,o.isRecognitionException)(e)&&void 0!==e.partialCstResult&&(this.cstPostNonTerminal(e.partialCstResult,void 0!==t&&void 0!==t.LABEL?t.LABEL:r),delete e.partialCstResult),e},e.prototype.consumeInternal=function(e,t,r){var n;try{var i=this.LA(1);!0===this.tokenMatcher(i,e)?(this.consumeToken(),n=i):this.consumeInternalError(e,i,r)}catch(o){n=this.consumeInternalRecovery(e,t,o)}return this.cstPostTerminal(void 0!==r&&void 0!==r.LABEL?r.LABEL:e.name,n),n},e.prototype.consumeInternalError=function(e,t,r){var n,i=this.LA(0);throw n=void 0!==r&&r.ERR_MSG?r.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new o.MismatchedTokenException(n,t,i))},e.prototype.consumeInternalRecovery=function(e,t,r){if(!this.recoveryEnabled||"MismatchedTokenException"!==r.name||this.isBackTracking())throw r;var n=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,n)}catch(i){throw i.name===c.IN_RULE_RECOVERY_EXCEPTION?r:i}},e.prototype.saveRecogState=function(){var e=this.errors,t=(0,n.cloneArr)(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK}},e.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},e.prototype.ruleInvocationStateUpdate=function(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},e.prototype.isBackTracking=function(){return 0!==this.isBackTrackingStack.length},e.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]},e.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull[e]},e.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),u.EOF)},e.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},e}();t.RecognizerEngine=f},7087:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attemptInRepetitionRecovery=t.Recoverable=t.InRuleRecoveryException=t.IN_RULE_RECOVERY_EXCEPTION=t.EOF_FOLLOW_KEY=void 0;var n=r(9359),i=r(5815),o=r(303),a=r(2854),s=r(8066);function l(e){this.name=t.IN_RULE_RECOVERY_EXCEPTION,this.message=e}t.EOF_FOLLOW_KEY={},t.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException",t.InRuleRecoveryException=l,l.prototype=Error.prototype;var c=function(){function e(){}return e.prototype.initRecoverable=function(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=(0,i.has)(e,"recoveryEnabled")?e.recoveryEnabled:s.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=u)},e.prototype.getTokenToInsert=function(e){var t=(0,n.createTokenInstance)(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},e.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},e.prototype.tryInRepetitionRecovery=function(e,t,r,n){for(var a=this,s=this.findReSyncTokenType(),l=this.exportLexerState(),c=[],u=!1,h=this.LA(1),d=this.LA(1),f=function(){var e=a.LA(0),t=a.errorMessageProvider.buildMismatchTokenMessage({expected:n,actual:h,previous:e,ruleName:a.getCurrRuleFullName()}),r=new o.MismatchedTokenException(t,h,a.LA(0));r.resyncedTokens=(0,i.dropRight)(c),a.SAVE_ERROR(r)};!u;){if(this.tokenMatcher(d,n))return void f();if(r.call(this))return f(),void e.apply(this,t);this.tokenMatcher(d,s)?u=!0:(d=this.SKIP_TOKEN(),this.addToResyncTokens(d,c))}this.importLexerState(l)},e.prototype.shouldInRepetitionRecoveryBeTried=function(e,t,r){return!1!==r&&(void 0!==e&&void 0!==t&&(!this.tokenMatcher(this.LA(1),e)&&(!this.isBackTracking()&&!this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))))},e.prototype.getFollowsForInRuleRecovery=function(e,t){var r=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(r)},e.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){var r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new l("sad sad panda")},e.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},e.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e))return!1;if((0,i.isEmpty)(t))return!1;var n=this.LA(1);return void 0!==(0,i.find)(t,(function(e){return r.tokenMatcher(n,e)}))},e.prototype.canRecoverWithSingleTokenDeletion=function(e){return this.tokenMatcher(this.LA(2),e)},e.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return(0,i.contains)(r,e)},e.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var n=t.tokenType;if((0,i.contains)(e,n))return n;t=this.LA(r),r++}},e.prototype.getCurrFollowKey=function(){if(1===this.RULE_STACK.length)return t.EOF_FOLLOW_KEY;var e=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}},e.prototype.buildFullFollowKeyStack=function(){var e=this,r=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return(0,i.map)(r,(function(i,o){return 0===o?t.EOF_FOLLOW_KEY:{ruleName:e.shortRuleNameToFullName(i),idxInCallingRule:n[o],inRule:e.shortRuleNameToFullName(r[o-1])}}))},e.prototype.flattenFollowSet=function(){var e=this,t=(0,i.map)(this.buildFullFollowKeyStack(),(function(t){return e.getFollowSetFromFollowKey(t)}));return(0,i.flatten)(t)},e.prototype.getFollowSetFromFollowKey=function(e){if(e===t.EOF_FOLLOW_KEY)return[n.EOF];var r=e.ruleName+e.idxInCallingRule+a.IN+e.inRule;return this.resyncFollows[r]},e.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,n.EOF)||t.push(e),t},e.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);!1===this.tokenMatcher(r,e);)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return(0,i.dropRight)(t)},e.prototype.attemptInRepetitionRecovery=function(e,t,r,n,i,o,a){},e.prototype.getCurrentGrammarPath=function(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:(0,i.cloneArr)(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}},e.prototype.getHumanReadableRuleStack=function(){var e=this;return(0,i.map)(this.RULE_STACK,(function(t){return e.shortRuleNameToFullName(t)}))},e}();function u(e,t,r,i,o,a,s){var l=this.getKeyForAutomaticLookahead(i,o),c=this.firstAfterRepMap[l];if(void 0===c){var u=this.getCurrRuleFullName();c=new a(this.getGAstProductions()[u],o).startWalking(),this.firstAfterRepMap[l]=c}var h=c.token,d=c.occurrence,f=c.isEndOfRule;1===this.RULE_STACK.length&&f&&void 0===h&&(h=n.EOF,d=1),this.shouldInRepetitionRecoveryBeTried(h,d,s)&&this.tryInRepetitionRecovery(e,t,r,h)}t.Recoverable=c,t.attemptInRepetitionRecovery=u},5174:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TreeBuilder=void 0;var n=r(4622),i=r(5815),o=r(5765),a=r(8066),s=function(){function e(){}return e.prototype.initTreeBuilder=function(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=(0,i.has)(e,"nodeLocationTracking")?e.nodeLocationTracking:a.DEFAULT_PARSER_CONFIG.nodeLocationTracking,this.outputCst)if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=n.setNodeLocationFull,this.setNodeLocationFromNode=n.setNodeLocationFull,this.cstPostRule=i.NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=i.NOOP,this.setNodeLocationFromNode=i.NOOP,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=n.setNodeLocationOnlyOffset,this.setNodeLocationFromNode=n.setNodeLocationOnlyOffset,this.cstPostRule=i.NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=i.NOOP,this.setNodeLocationFromNode=i.NOOP,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else{if(!/none/i.test(this.nodeLocationTracking))throw Error('Invalid <nodeLocationTracking> config option: "'+e.nodeLocationTracking+'"');this.setNodeLocationFromToken=i.NOOP,this.setNodeLocationFromNode=i.NOOP,this.cstPostRule=i.NOOP,this.setInitialNodeLocation=i.NOOP}else this.cstInvocationStateUpdate=i.NOOP,this.cstFinallyStateUpdate=i.NOOP,this.cstPostTerminal=i.NOOP,this.cstPostNonTerminal=i.NOOP,this.cstPostRule=i.NOOP},e.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(e){e.location={startOffset:NaN,endOffset:NaN}},e.prototype.setInitialNodeLocationOnlyOffsetRegular=function(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},e.prototype.setInitialNodeLocationFullRecovery=function(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},e.prototype.setInitialNodeLocationFullRegular=function(e){var t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},e.prototype.cstInvocationStateUpdate=function(e,t){var r={name:e,children:{}};this.setInitialNodeLocation(r),this.CST_STACK.push(r)},e.prototype.cstFinallyStateUpdate=function(){this.CST_STACK.pop()},e.prototype.cstPostRuleFull=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset===!0?(r.endOffset=t.endOffset,r.endLine=t.endLine,r.endColumn=t.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)},e.prototype.cstPostRuleOnlyOffset=function(e){var t=this.LA(0),r=e.location;r.startOffset<=t.startOffset===!0?r.endOffset=t.endOffset:r.startOffset=NaN},e.prototype.cstPostTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];(0,n.addTerminalToCst)(r,t,e),this.setNodeLocationFromToken(r.location,t)},e.prototype.cstPostNonTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];(0,n.addNoneTerminalToCst)(r,t,e),this.setNodeLocationFromNode(r.location,e.location)},e.prototype.getBaseCstVisitorConstructor=function(){if((0,i.isUndefined)(this.baseCstVisitorConstructor)){var e=(0,o.createBaseSemanticVisitorConstructor)(this.className,(0,i.keys)(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},e.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if((0,i.isUndefined)(this.baseCstVisitorWithDefaultsConstructor)){var e=(0,o.createBaseVisitorConstructorWithDefaults)(this.className,(0,i.keys)(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},e.prototype.getLastExplicitRuleShortName=function(){var e=this.RULE_STACK;return e[e.length-1]},e.prototype.getPreviousExplicitRuleShortName=function(){var e=this.RULE_STACK;return e[e.length-2]},e.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},e}();t.TreeBuilder=s},242:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixins=void 0,t.applyMixins=function(e,t){t.forEach((function(t){var r=t.prototype;Object.getOwnPropertyNames(r).forEach((function(n){if("constructor"!==n){var i=Object.getOwnPropertyDescriptor(r,n);i&&(i.get||i.set)?Object.defineProperty(e.prototype,n,i):e.prototype[n]=t.prototype[n]}}))}))}},4958:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.charCodeToOptimizedIndex=t.minOptimizationVal=t.buildLineBreakIssueMessage=t.LineTerminatorOptimizedTester=t.isShortPattern=t.isCustomPattern=t.cloneEmptyGroups=t.performWarningRuntimeChecks=t.performRuntimeChecks=t.addStickyFlag=t.addStartOfInput=t.findUnreachablePatterns=t.findModesThatDoNotExist=t.findInvalidGroupType=t.findDuplicatePatterns=t.findUnsupportedFlags=t.findStartOfInputAnchor=t.findEmptyMatchRegExps=t.findEndOfInputAnchor=t.findInvalidPatterns=t.findMissingPatterns=t.validatePatterns=t.analyzeTokenTypes=t.enableSticky=t.disableSticky=t.SUPPORT_STICKY=t.MODES=t.DEFAULT_MODE=void 0;var i=r(2380),o=r(7099),a=r(5815),s=r(6089),l=r(8589),c="PATTERN";function u(e){var t=(0,a.filter)(e,(function(e){return!(0,a.has)(e,c)}));return{errors:(0,a.map)(t,(function(e){return{message:"Token Type: ->"+e.name+"<- missing static 'PATTERN' property",type:o.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}})),valid:(0,a.difference)(e,t)}}function h(e){var t=(0,a.filter)(e,(function(e){var t=e.PATTERN;return!(0,a.isRegExp)(t)&&!(0,a.isFunction)(t)&&!(0,a.has)(t,"exec")&&!(0,a.isString)(t)}));return{errors:(0,a.map)(t,(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:o.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}})),valid:(0,a.difference)(e,t)}}t.DEFAULT_MODE="defaultMode",t.MODES="modes",t.SUPPORT_STICKY="boolean"===typeof new RegExp("(?:)").sticky,t.disableSticky=function(){t.SUPPORT_STICKY=!1},t.enableSticky=function(){t.SUPPORT_STICKY=!0},t.analyzeTokenTypes=function(e,r){var n,i=(r=(0,a.defaults)(r,{useSticky:t.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"],tracer:function(e,t){return t()}})).tracer;i("initCharCodeToOptimizedIndexMap",(function(){!function(){if((0,a.isEmpty)(_)){_=new Array(65536);for(var e=0;e<65536;e++)_[e]=e>255?255+~~(e/255):e}}()})),i("Reject Lexer.NA",(function(){n=(0,a.reject)(e,(function(e){return e.PATTERN===o.Lexer.NA}))}));var l,c,u,h,d,f,p,m,g,A,v,y=!1;i("Transform Patterns",(function(){y=!1,l=(0,a.map)(n,(function(e){var t=e.PATTERN;if((0,a.isRegExp)(t)){var n=t.source;return 1!==n.length||"^"===n||"$"===n||"."===n||t.ignoreCase?2!==n.length||"\\"!==n[0]||(0,a.contains)(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],n[1])?r.useSticky?C(t):w(t):n[1]:n}if((0,a.isFunction)(t))return y=!0,{exec:t};if((0,a.has)(t,"exec"))return y=!0,t;if("string"===typeof t){if(1===t.length)return t;var i=t.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),o=new RegExp(i);return r.useSticky?C(o):w(o)}throw Error("non exhaustive match")}))})),i("misc mapping",(function(){c=(0,a.map)(n,(function(e){return e.tokenTypeIdx})),u=(0,a.map)(n,(function(e){var t=e.GROUP;if(t!==o.Lexer.SKIPPED){if((0,a.isString)(t))return t;if((0,a.isUndefined)(t))return!1;throw Error("non exhaustive match")}})),h=(0,a.map)(n,(function(e){var t=e.LONGER_ALT;if(t)return(0,a.isArray)(t)?(0,a.map)(t,(function(e){return(0,a.indexOf)(n,e)})):[(0,a.indexOf)(n,t)]})),d=(0,a.map)(n,(function(e){return e.PUSH_MODE})),f=(0,a.map)(n,(function(e){return(0,a.has)(e,"POP_MODE")}))})),i("Line Terminator Handling",(function(){var e=I(r.lineTerminatorCharacters);p=(0,a.map)(n,(function(e){return!1})),"onlyOffset"!==r.positionTracking&&(p=(0,a.map)(n,(function(t){return(0,a.has)(t,"LINE_BREAKS")?t.LINE_BREAKS:!1===T(t,e)?(0,s.canMatchCharCode)(e,t.PATTERN):void 0})))})),i("Misc Mapping #2",(function(){m=(0,a.map)(n,E),g=(0,a.map)(l,S),A=(0,a.reduce)(n,(function(e,t){var r=t.GROUP;return(0,a.isString)(r)&&r!==o.Lexer.SKIPPED&&(e[r]=[]),e}),{}),v=(0,a.map)(l,(function(e,t){return{pattern:l[t],longerAlt:h[t],canLineTerminator:p[t],isCustom:m[t],short:g[t],group:u[t],push:d[t],pop:f[t],tokenTypeIdx:c[t],tokenType:n[t]}}))}));var x=!0,b=[];return r.safeMode||i("First Char Optimization",(function(){b=(0,a.reduce)(n,(function(e,t,n){if("string"===typeof t.PATTERN){var i=F(t.PATTERN.charCodeAt(0));B(e,i,v[n])}else if((0,a.isArray)(t.START_CHARS_HINT)){var o;(0,a.forEach)(t.START_CHARS_HINT,(function(t){var r=F("string"===typeof t?t.charCodeAt(0):t);o!==r&&(o=r,B(e,r,v[n]))}))}else if((0,a.isRegExp)(t.PATTERN))if(t.PATTERN.unicode)x=!1,r.ensureOptimizations&&(0,a.PRINT_ERROR)(s.failedOptimizationPrefixMsg+"\tUnable to analyze < "+t.PATTERN.toString()+" > pattern.\n\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE");else{var l=(0,s.getOptimizedStartCodesIndices)(t.PATTERN,r.ensureOptimizations);(0,a.isEmpty)(l)&&(x=!1),(0,a.forEach)(l,(function(t){B(e,t,v[n])}))}else r.ensureOptimizations&&(0,a.PRINT_ERROR)(s.failedOptimizationPrefixMsg+"\tTokenType: <"+t.name+"> is using a custom token pattern without providing <start_chars_hint> parameter.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),x=!1;return e}),[])})),i("ArrayPacking",(function(){b=(0,a.packArray)(b)})),{emptyGroups:A,patternIdxToConfig:v,charCodeToPatternIdxToConfig:b,hasCustom:y,canBeOptimized:x}},t.validatePatterns=function(e,t){var r=[],n=u(e);r=r.concat(n.errors);var i=h(n.valid),o=i.valid;return r=(r=(r=(r=(r=r.concat(i.errors)).concat(function(e){var t=[],r=(0,a.filter)(e,(function(e){return(0,a.isRegExp)(e.PATTERN)}));return t=(t=(t=(t=(t=t.concat(f(r))).concat(g(r))).concat(A(r))).concat(v(r))).concat(p(r))}(o))).concat(y(o))).concat(x(o,t))).concat(b(o))},t.findMissingPatterns=u,t.findInvalidPatterns=h;var d=/[^\\][\$]/;function f(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return n(t,e),t.prototype.visitEndAnchor=function(e){this.found=!0},t}(i.BaseRegExpVisitor),r=(0,a.filter)(e,(function(e){var r=e.PATTERN;try{var n=(0,l.getRegExpAst)(r),i=new t;return i.visit(n),i.found}catch(o){return d.test(r.source)}}));return(0,a.map)(r,(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+e.name+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:o.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function p(e){var t=(0,a.filter)(e,(function(e){return e.PATTERN.test("")}));return(0,a.map)(t,(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' must not match an empty string",type:o.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}}))}t.findEndOfInputAnchor=f,t.findEmptyMatchRegExps=p;var m=/[^\\[][\^]|^\^/;function g(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return n(t,e),t.prototype.visitStartAnchor=function(e){this.found=!0},t}(i.BaseRegExpVisitor),r=(0,a.filter)(e,(function(e){var r=e.PATTERN;try{var n=(0,l.getRegExpAst)(r),i=new t;return i.visit(n),i.found}catch(o){return m.test(r.source)}}));return(0,a.map)(r,(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+e.name+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:o.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function A(e){var t=(0,a.filter)(e,(function(e){var t=e.PATTERN;return t instanceof RegExp&&(t.multiline||t.global)}));return(0,a.map)(t,(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:o.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}}))}function v(e){var t=[],r=(0,a.map)(e,(function(r){return(0,a.reduce)(e,(function(e,n){return r.PATTERN.source!==n.PATTERN.source||(0,a.contains)(t,n)||n.PATTERN===o.Lexer.NA||(t.push(n),e.push(n)),e}),[])}));r=(0,a.compact)(r);var n=(0,a.filter)(r,(function(e){return e.length>1}));return(0,a.map)(n,(function(e){var t=(0,a.map)(e,(function(e){return e.name}));return{message:"The same RegExp pattern ->"+(0,a.first)(e).PATTERN+"<-has been used in all of the following Token Types: "+t.join(", ")+" <-",type:o.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}}))}function y(e){var t=(0,a.filter)(e,(function(e){if(!(0,a.has)(e,"GROUP"))return!1;var t=e.GROUP;return t!==o.Lexer.SKIPPED&&t!==o.Lexer.NA&&!(0,a.isString)(t)}));return(0,a.map)(t,(function(e){return{message:"Token Type: ->"+e.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:o.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}}))}function x(e,t){var r=(0,a.filter)(e,(function(e){return void 0!==e.PUSH_MODE&&!(0,a.contains)(t,e.PUSH_MODE)}));return(0,a.map)(r,(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+e.PUSH_MODE+"<-which does not exist",type:o.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}}))}function b(e){var t=[],r=(0,a.reduce)(e,(function(e,t,r){var n=t.PATTERN;return n===o.Lexer.NA||((0,a.isString)(n)?e.push({str:n,idx:r,tokenType:t}):(0,a.isRegExp)(n)&&function(e){var t=[".","\\","[","]","|","^","$","(",")","?","*","+","{"];return void 0===(0,a.find)(t,(function(t){return-1!==e.source.indexOf(t)}))}(n)&&e.push({str:n.source,idx:r,tokenType:t})),e}),[]);return(0,a.forEach)(e,(function(e,n){(0,a.forEach)(r,(function(r){var i=r.str,s=r.idx,l=r.tokenType;if(n<s&&function(e,t){if((0,a.isRegExp)(t)){var r=t.exec(e);return null!==r&&0===r.index}if((0,a.isFunction)(t))return t(e,0,[],{});if((0,a.has)(t,"exec"))return t.exec(e,0,[],{});if("string"===typeof t)return t===e;throw Error("non exhaustive match")}(i,e.PATTERN)){var c="Token: ->"+l.name+"<- can never be matched.\nBecause it appears AFTER the Token Type ->"+e.name+"<-in the lexer's definition.\nSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE";t.push({message:c,type:o.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[e,l]})}}))})),t}function w(e){var t=e.ignoreCase?"i":"";return new RegExp("^(?:"+e.source+")",t)}function C(e){var t=e.ignoreCase?"iy":"y";return new RegExp(""+e.source,t)}function E(e){var t=e.PATTERN;if((0,a.isRegExp)(t))return!1;if((0,a.isFunction)(t))return!0;if((0,a.has)(t,"exec"))return!0;if((0,a.isString)(t))return!1;throw Error("non exhaustive match")}function S(e){return!(!(0,a.isString)(e)||1!==e.length)&&e.charCodeAt(0)}function T(e,t){if((0,a.has)(e,"LINE_BREAKS"))return!1;if((0,a.isRegExp)(e.PATTERN)){try{(0,s.canMatchCharCode)(t,e.PATTERN)}catch(r){return{issue:o.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:r.message}}return!1}if((0,a.isString)(e.PATTERN))return!1;if(E(e))return{issue:o.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function M(e,t){if(t.issue===o.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n\tThe problem is in the <"+e.name+"> Token Type\n\t Root cause: "+t.errMsg+".\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(t.issue===o.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n\tThe problem is in the <"+e.name+"> Token Type\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function I(e){return(0,a.map)(e,(function(e){return(0,a.isString)(e)&&e.length>0?e.charCodeAt(0):e}))}function B(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}t.findStartOfInputAnchor=g,t.findUnsupportedFlags=A,t.findDuplicatePatterns=v,t.findInvalidGroupType=y,t.findModesThatDoNotExist=x,t.findUnreachablePatterns=b,t.addStartOfInput=w,t.addStickyFlag=C,t.performRuntimeChecks=function(e,r,n){var i=[];return(0,a.has)(e,t.DEFAULT_MODE)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.DEFAULT_MODE+"> property in its definition\n",type:o.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),(0,a.has)(e,t.MODES)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.MODES+"> property in its definition\n",type:o.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),(0,a.has)(e,t.MODES)&&(0,a.has)(e,t.DEFAULT_MODE)&&!(0,a.has)(e.modes,e.defaultMode)&&i.push({message:"A MultiMode Lexer cannot be initialized with a "+t.DEFAULT_MODE+": <"+e.defaultMode+">which does not exist\n",type:o.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),(0,a.has)(e,t.MODES)&&(0,a.forEach)(e.modes,(function(e,t){(0,a.forEach)(e,(function(e,r){(0,a.isUndefined)(e)&&i.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:<"+t+"> at index: <"+r+">\n",type:o.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})}))})),i},t.performWarningRuntimeChecks=function(e,t,r){var n=[],i=!1,l=(0,a.compact)((0,a.flatten)((0,a.mapValues)(e.modes,(function(e){return e})))),c=(0,a.reject)(l,(function(e){return e.PATTERN===o.Lexer.NA})),u=I(r);return t&&(0,a.forEach)(c,(function(e){var t=T(e,u);if(!1!==t){var r={message:M(e,t),type:t.issue,tokenType:e};n.push(r)}else(0,a.has)(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(i=!0):(0,s.canMatchCharCode)(u,e.PATTERN)&&(i=!0)})),t&&!i&&n.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:o.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),n},t.cloneEmptyGroups=function(e){var t={},r=(0,a.keys)(e);return(0,a.forEach)(r,(function(r){var n=e[r];if(!(0,a.isArray)(n))throw Error("non exhaustive match");t[r]=[]})),t},t.isCustomPattern=E,t.isShortPattern=S,t.LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,r=this.lastIndex;r<t;r++){var n=e.charCodeAt(r);if(10===n)return this.lastIndex=r+1,!0;if(13===n)return 10===e.charCodeAt(r+1)?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0},t.buildLineBreakIssueMessage=M,t.minOptimizationVal=256;var _=[];function F(e){return e<t.minOptimizationVal?e:_[e]}t.charCodeToOptimizedIndex=F},9033:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLexerErrorProvider=void 0,t.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return"Unable to pop Lexer Mode after encountering Token ->"+e.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(e,t,r,n,i){return"unexpected character: ->"+e.charAt(t)+"<- at offset: "+t+", skipped "+r+" characters."}}},7099:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lexer=t.LexerDefinitionErrorType=void 0;var n=r(4958),i=r(5815),o=r(2423),a=r(9033),s=r(8589);!function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"}(t.LexerDefinitionErrorType||(t.LexerDefinitionErrorType={}));var l={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:a.defaultLexerErrorProvider,traceInitPerf:!1,skipValidations:!1};Object.freeze(l);var c=function(){function e(e,t){var r=this;if(void 0===t&&(t=l),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},"boolean"===typeof t)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");this.config=(0,i.merge)(l,t);var a=this.config.traceInitPerf;!0===a?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):"number"===typeof a&&(this.traceInitMaxIdent=a,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",(function(){var a,c=!0;r.TRACE_INIT("Lexer Config handling",(function(){if(r.config.lineTerminatorsPattern===l.lineTerminatorsPattern)r.config.lineTerminatorsPattern=n.LineTerminatorOptimizedTester;else if(r.config.lineTerminatorCharacters===l.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');r.trackStartLines=/full|onlyStart/i.test(r.config.positionTracking),r.trackEndLines=/full/i.test(r.config.positionTracking),(0,i.isArray)(e)?((a={modes:{}}).modes[n.DEFAULT_MODE]=(0,i.cloneArr)(e),a[n.DEFAULT_MODE]=n.DEFAULT_MODE):(c=!1,a=(0,i.cloneObj)(e))})),!1===r.config.skipValidations&&(r.TRACE_INIT("performRuntimeChecks",(function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat((0,n.performRuntimeChecks)(a,r.trackStartLines,r.config.lineTerminatorCharacters))})),r.TRACE_INIT("performWarningRuntimeChecks",(function(){r.lexerDefinitionWarning=r.lexerDefinitionWarning.concat((0,n.performWarningRuntimeChecks)(a,r.trackStartLines,r.config.lineTerminatorCharacters))}))),a.modes=a.modes?a.modes:{},(0,i.forEach)(a.modes,(function(e,t){a.modes[t]=(0,i.reject)(e,(function(e){return(0,i.isUndefined)(e)}))}));var u=(0,i.keys)(a.modes);if((0,i.forEach)(a.modes,(function(e,a){r.TRACE_INIT("Mode: <"+a+"> processing",(function(){var s;(r.modes.push(a),!1===r.config.skipValidations&&r.TRACE_INIT("validatePatterns",(function(){r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat((0,n.validatePatterns)(e,u))})),(0,i.isEmpty)(r.lexerDefinitionErrors))&&((0,o.augmentTokenTypes)(e),r.TRACE_INIT("analyzeTokenTypes",(function(){s=(0,n.analyzeTokenTypes)(e,{lineTerminatorCharacters:r.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:r.TRACE_INIT.bind(r)})})),r.patternIdxToConfig[a]=s.patternIdxToConfig,r.charCodeToPatternIdxToConfig[a]=s.charCodeToPatternIdxToConfig,r.emptyGroups=(0,i.merge)(r.emptyGroups,s.emptyGroups),r.hasCustom=s.hasCustom||r.hasCustom,r.canModeBeOptimized[a]=s.canBeOptimized)}))})),r.defaultMode=a.defaultMode,!(0,i.isEmpty)(r.lexerDefinitionErrors)&&!r.config.deferDefinitionErrorsHandling){var h=(0,i.map)(r.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Errors detected in definition of Lexer:\n"+h)}(0,i.forEach)(r.lexerDefinitionWarning,(function(e){(0,i.PRINT_WARNING)(e.message)})),r.TRACE_INIT("Choosing sub-methods implementations",(function(){if(n.SUPPORT_STICKY?(r.chopInput=i.IDENTITY,r.match=r.matchWithTest):(r.updateLastIndex=i.NOOP,r.match=r.matchWithExec),c&&(r.handleModes=i.NOOP),!1===r.trackStartLines&&(r.computeNewColumn=i.IDENTITY),!1===r.trackEndLines&&(r.updateTokenEndLineColumnLocation=i.NOOP),/full/i.test(r.config.positionTracking))r.createTokenInstance=r.createFullToken;else if(/onlyStart/i.test(r.config.positionTracking))r.createTokenInstance=r.createStartOnlyToken;else{if(!/onlyOffset/i.test(r.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'+r.config.positionTracking+'"');r.createTokenInstance=r.createOffsetOnlyToken}r.hasCustom?(r.addToken=r.addTokenUsingPush,r.handlePayload=r.handlePayloadWithCustom):(r.addToken=r.addTokenUsingMemberAccess,r.handlePayload=r.handlePayloadNoCustom)})),r.TRACE_INIT("Failed Optimization Warnings",(function(){var e=(0,i.reduce)(r.canModeBeOptimized,(function(e,t,r){return!1===t&&e.push(r),e}),[]);if(t.ensureOptimizations&&!(0,i.isEmpty)(e))throw Error("Lexer Modes: < "+e.join(", ")+' > cannot be optimized.\n\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')})),r.TRACE_INIT("clearRegExpParserCache",(function(){(0,s.clearRegExpParserCache)()})),r.TRACE_INIT("toFastProperties",(function(){(0,i.toFastProperties)(r)}))}))}return e.prototype.tokenize=function(e,t){if(void 0===t&&(t=this.defaultMode),!(0,i.isEmpty)(this.lexerDefinitionErrors)){var r=(0,i.map)(this.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+r)}return this.tokenizeInternal(e,t)},e.prototype.tokenizeInternal=function(e,t){var r,o,a,s,l,c,u,h,d,f,p,m,g,A,v,y=this,x=e,b=x.length,w=0,C=0,E=this.hasCustom?0:Math.floor(e.length/10),S=new Array(E),T=[],M=this.trackStartLines?1:void 0,I=this.trackStartLines?1:void 0,B=(0,n.cloneEmptyGroups)(this.emptyGroups),_=this.trackStartLines,F=this.config.lineTerminatorsPattern,P=0,R=[],L=[],D=[],N=[];Object.freeze(N);var k=void 0;function O(){return R}function U(e){var t=(0,n.charCodeToOptimizedIndex)(e),r=L[t];return void 0===r?N:r}var Q,V=function(e){if(1===D.length&&void 0===e.tokenType.PUSH_MODE){var t=y.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e);T.push({offset:e.startOffset,line:void 0!==e.startLine?e.startLine:void 0,column:void 0!==e.startColumn?e.startColumn:void 0,length:e.image.length,message:t})}else{D.pop();var r=(0,i.last)(D);R=y.patternIdxToConfig[r],L=y.charCodeToPatternIdxToConfig[r],P=R.length;var n=y.canModeBeOptimized[r]&&!1===y.config.safeMode;k=L&&n?U:O}};function G(e){D.push(e),L=this.charCodeToPatternIdxToConfig[e],R=this.patternIdxToConfig[e],P=R.length,P=R.length;var t=this.canModeBeOptimized[e]&&!1===this.config.safeMode;k=L&&t?U:O}for(G.call(this,t);w<b;){c=null;var z=x.charCodeAt(w),j=k(z),H=j.length;for(r=0;r<H;r++){var W=(Q=j[r]).pattern;if(u=null,!1!==(ne=Q.short)?z===ne&&(c=W):!0===Q.isCustom?null!==(v=W.exec(x,w,S,B))?(c=v[0],void 0!==v.payload&&(u=v.payload)):c=null:(this.updateLastIndex(W,w),c=this.match(W,e,w)),null!==c){if(void 0!==(l=Q.longerAlt)){var Z=l.length;for(a=0;a<Z;a++){var X=R[l[a]],Y=X.pattern;if(h=null,!0===X.isCustom?null!==(v=Y.exec(x,w,S,B))?(s=v[0],void 0!==v.payload&&(h=v.payload)):s=null:(this.updateLastIndex(Y,w),s=this.match(Y,e,w)),s&&s.length>c.length){c=s,u=h,Q=X;break}}}break}}if(null!==c){if(d=c.length,void 0!==(f=Q.group)&&(p=Q.tokenTypeIdx,m=this.createTokenInstance(c,w,p,Q.tokenType,M,I,d),this.handlePayload(m,u),!1===f?C=this.addToken(S,C,m):B[f].push(m)),e=this.chopInput(e,d),w+=d,I=this.computeNewColumn(I,d),!0===_&&!0===Q.canLineTerminator){var J=0,q=void 0,K=void 0;F.lastIndex=0;do{!0===(q=F.test(c))&&(K=F.lastIndex-1,J++)}while(!0===q);0!==J&&(M+=J,I=d-K,this.updateTokenEndLineColumnLocation(m,f,K,J,M,I,d))}this.handleModes(Q,V,G,m)}else{for(var $=w,ee=M,te=I,re=!1;!re&&w<b;)for(x.charCodeAt(w),e=this.chopInput(e,1),w++,o=0;o<P;o++){var ne,ie=R[o];W=ie.pattern;if(!1!==(ne=ie.short)?x.charCodeAt(w)===ne&&(re=!0):!0===ie.isCustom?re=null!==W.exec(x,w,S,B):(this.updateLastIndex(W,w),re=null!==W.exec(e)),!0===re)break}g=w-$,A=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(x,$,g,ee,te),T.push({offset:$,line:ee,column:te,length:g,message:A})}}return this.hasCustom||(S.length=C),{tokens:S,groups:B,errors:T}},e.prototype.handleModes=function(e,t,r,n){if(!0===e.pop){var i=e.push;t(n),void 0!==i&&r.call(this,i)}else void 0!==e.push&&r.call(this,e.push)},e.prototype.chopInput=function(e,t){return e.substring(t)},e.prototype.updateLastIndex=function(e,t){e.lastIndex=t},e.prototype.updateTokenEndLineColumnLocation=function(e,t,r,n,i,o,a){var s,l;void 0!==t&&(l=(s=r===a-1)?-1:0,1===n&&!0===s||(e.endLine=i+l,e.endColumn=o-1-l))},e.prototype.computeNewColumn=function(e,t){return e+t},e.prototype.createTokenInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return null},e.prototype.createOffsetOnlyToken=function(e,t,r,n){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:n}},e.prototype.createStartOnlyToken=function(e,t,r,n,i,o){return{image:e,startOffset:t,startLine:i,startColumn:o,tokenTypeIdx:r,tokenType:n}},e.prototype.createFullToken=function(e,t,r,n,i,o,a){return{image:e,startOffset:t,endOffset:t+a-1,startLine:i,endLine:i,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:n}},e.prototype.addToken=function(e,t,r){return 666},e.prototype.addTokenUsingPush=function(e,t,r){return e.push(r),t},e.prototype.addTokenUsingMemberAccess=function(e,t,r){return e[t]=r,++t},e.prototype.handlePayload=function(e,t){},e.prototype.handlePayloadNoCustom=function(e,t){},e.prototype.handlePayloadWithCustom=function(e,t){null!==t&&(e.payload=t)},e.prototype.match=function(e,t,r){return null},e.prototype.matchWithTest=function(e,t,r){return!0===e.test(t)?t.substring(r,e.lastIndex):null},e.prototype.matchWithExec=function(e,t){var r=e.exec(t);return null!==r?r[0]:r},e.prototype.TRACE_INIT=function(e,t){if(!0===this.traceInitPerf){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("\t");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--\x3e <"+e+">");var n=(0,i.timer)(t),o=n.time,a=n.value,s=o>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&s(r+"<-- <"+e+"> time: "+o+"ms"),this.traceInitIndent--,a}return t()},e.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",e.NA=/NOT_APPLICABLE/,e}();t.Lexer=c},6089:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.canMatchCharCode=t.firstCharOptimizedIndices=t.getOptimizedStartCodesIndices=t.failedOptimizationPrefixMsg=void 0;var i=r(2380),o=r(5815),a=r(8589),s=r(4958),l="Complement Sets are not supported for first char optimization";function c(e,t,r){switch(e.type){case"Disjunction":for(var n=0;n<e.value.length;n++)c(e.value[n],t,r);break;case"Alternative":var i=e.value;for(n=0;n<i.length;n++){var a=i[n];switch(a.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var h=a;switch(h.type){case"Character":u(h.value,t,r);break;case"Set":if(!0===h.complement)throw Error(l);(0,o.forEach)(h.value,(function(e){if("number"===typeof e)u(e,t,r);else{var n=e;if(!0===r)for(var i=n.from;i<=n.to;i++)u(i,t,r);else{for(i=n.from;i<=n.to&&i<s.minOptimizationVal;i++)u(i,t,r);if(n.to>=s.minOptimizationVal)for(var o=n.from>=s.minOptimizationVal?n.from:s.minOptimizationVal,a=n.to,l=(0,s.charCodeToOptimizedIndex)(o),c=(0,s.charCodeToOptimizedIndex)(a),h=l;h<=c;h++)t[h]=h}}}));break;case"Group":c(h.value,t,r);break;default:throw Error("Non Exhaustive Match")}var f=void 0!==h.quantifier&&0===h.quantifier.atLeast;if("Group"===h.type&&!1===d(h)||"Group"!==h.type&&!1===f)break}break;default:throw Error("non exhaustive match!")}return(0,o.values)(t)}function u(e,t,r){var n=(0,s.charCodeToOptimizedIndex)(e);t[n]=n,!0===r&&function(e,t){var r=String.fromCharCode(e),n=r.toUpperCase();if(n!==r){t[i=(0,s.charCodeToOptimizedIndex)(n.charCodeAt(0))]=i}else{var i,o=r.toLowerCase();if(o!==r)t[i=(0,s.charCodeToOptimizedIndex)(o.charCodeAt(0))]=i}}(e,t)}function h(e,t){return(0,o.find)(e.value,(function(e){if("number"===typeof e)return(0,o.contains)(t,e);var r=e;return void 0!==(0,o.find)(t,(function(e){return r.from<=e&&e<=r.to}))}))}function d(e){return!(!e.quantifier||0!==e.quantifier.atLeast)||!!e.value&&((0,o.isArray)(e.value)?(0,o.every)(e.value,d):d(e.value))}t.failedOptimizationPrefixMsg='Unable to use "first char" lexer optimizations:\n',t.getOptimizedStartCodesIndices=function(e,r){void 0===r&&(r=!1);try{var n=(0,a.getRegExpAst)(e);return c(n.value,{},n.flags.ignoreCase)}catch(u){if(u.message===l)r&&(0,o.PRINT_WARNING)(t.failedOptimizationPrefixMsg+"\tUnable to optimize: < "+e.toString()+" >\n\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.");else{var s="";r&&(s="\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),(0,o.PRINT_ERROR)(t.failedOptimizationPrefixMsg+"\n\tFailed parsing: < "+e.toString()+" >\n\tUsing the regexp-to-ast library version: "+i.VERSION+"\n\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+s)}}return[]},t.firstCharOptimizedIndices=c;var f=function(e){function t(t){var r=e.call(this)||this;return r.targetCharCodes=t,r.found=!1,r}return n(t,e),t.prototype.visitChildren=function(t){if(!0!==this.found){switch(t.type){case"Lookahead":return void this.visitLookahead(t);case"NegativeLookahead":return void this.visitNegativeLookahead(t)}e.prototype.visitChildren.call(this,t)}},t.prototype.visitCharacter=function(e){(0,o.contains)(this.targetCharCodes,e.value)&&(this.found=!0)},t.prototype.visitSet=function(e){e.complement?void 0===h(e,this.targetCharCodes)&&(this.found=!0):void 0!==h(e,this.targetCharCodes)&&(this.found=!0)},t}(i.BaseRegExpVisitor);t.canMatchCharCode=function(e,t){if(t instanceof RegExp){var r=(0,a.getRegExpAst)(t),n=new f(e);return n.visit(r),n.found}return void 0!==(0,o.find)(t,(function(t){return(0,o.contains)(e,t.charCodeAt(0))}))}},8589:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearRegExpParserCache=t.getRegExpAst=void 0;var n=r(2380),i={},o=new n.RegExpParser;t.getRegExpAst=function(e){var t=e.toString();if(i.hasOwnProperty(t))return i[t];var r=o.pattern(t);return i[t]=r,r},t.clearRegExpParserCache=function(){i={}}},2423:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTokenType=t.hasExtendingTokensTypesMapProperty=t.hasExtendingTokensTypesProperty=t.hasCategoriesProperty=t.hasShortKeyProperty=t.singleAssignCategoriesToksMap=t.assignCategoriesMapProp=t.assignCategoriesTokensProp=t.assignTokenDefaultProps=t.expandCategories=t.augmentTokenTypes=t.tokenIdxToClass=t.tokenShortNameIdx=t.tokenStructuredMatcherNoCategories=t.tokenStructuredMatcher=void 0;var n=r(5815);function i(e){for(var t=(0,n.cloneArr)(e),r=e,i=!0;i;){r=(0,n.compact)((0,n.flatten)((0,n.map)(r,(function(e){return e.CATEGORIES}))));var o=(0,n.difference)(r,t);t=t.concat(o),(0,n.isEmpty)(o)?i=!1:r=o}return t}function o(e){(0,n.forEach)(e,(function(e){c(e)||(t.tokenIdxToClass[t.tokenShortNameIdx]=e,e.tokenTypeIdx=t.tokenShortNameIdx++),u(e)&&!(0,n.isArray)(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),u(e)||(e.CATEGORIES=[]),h(e)||(e.categoryMatches=[]),d(e)||(e.categoryMatchesMap={})}))}function a(e){(0,n.forEach)(e,(function(e){e.categoryMatches=[],(0,n.forEach)(e.categoryMatchesMap,(function(r,n){e.categoryMatches.push(t.tokenIdxToClass[n].tokenTypeIdx)}))}))}function s(e){(0,n.forEach)(e,(function(e){l([],e)}))}function l(e,t){(0,n.forEach)(e,(function(e){t.categoryMatchesMap[e.tokenTypeIdx]=!0})),(0,n.forEach)(t.CATEGORIES,(function(r){var i=e.concat(t);(0,n.contains)(i,r)||l(i,r)}))}function c(e){return(0,n.has)(e,"tokenTypeIdx")}function u(e){return(0,n.has)(e,"CATEGORIES")}function h(e){return(0,n.has)(e,"categoryMatches")}function d(e){return(0,n.has)(e,"categoryMatchesMap")}t.tokenStructuredMatcher=function(e,t){var r=e.tokenTypeIdx;return r===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[r]},t.tokenStructuredMatcherNoCategories=function(e,t){return e.tokenTypeIdx===t.tokenTypeIdx},t.tokenShortNameIdx=1,t.tokenIdxToClass={},t.augmentTokenTypes=function(e){var t=i(e);o(t),s(t),a(t),(0,n.forEach)(t,(function(e){e.isParent=e.categoryMatches.length>0}))},t.expandCategories=i,t.assignTokenDefaultProps=o,t.assignCategoriesTokensProp=a,t.assignCategoriesMapProp=s,t.singleAssignCategoriesToksMap=l,t.hasShortKeyProperty=c,t.hasCategoriesProperty=u,t.hasExtendingTokensTypesProperty=h,t.hasExtendingTokensTypesMapProperty=d,t.isTokenType=function(e){return(0,n.has)(e,"tokenTypeIdx")}},9359:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tokenMatcher=t.createTokenInstance=t.EOF=t.createToken=t.hasTokenLabel=t.tokenName=t.tokenLabel=void 0;var n=r(5815),i=r(7099),o=r(2423);function a(e){return(0,n.isString)(e.LABEL)&&""!==e.LABEL}t.tokenLabel=function(e){return a(e)?e.LABEL:e.name},t.tokenName=function(e){return e.name},t.hasTokenLabel=a;var s="parent",l="categories",c="label",u="group",h="push_mode",d="pop_mode",f="longer_alt",p="line_breaks",m="start_chars_hint";function g(e){return function(e){var t=e.pattern,r={};r.name=e.name,(0,n.isUndefined)(t)||(r.PATTERN=t);if((0,n.has)(e,s))throw"The parent property is no longer supported.\nSee: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.";(0,n.has)(e,l)&&(r.CATEGORIES=e.categories);(0,o.augmentTokenTypes)([r]),(0,n.has)(e,c)&&(r.LABEL=e.label);(0,n.has)(e,u)&&(r.GROUP=e.group);(0,n.has)(e,d)&&(r.POP_MODE=e.pop_mode);(0,n.has)(e,h)&&(r.PUSH_MODE=e.push_mode);(0,n.has)(e,f)&&(r.LONGER_ALT=e.longer_alt);(0,n.has)(e,p)&&(r.LINE_BREAKS=e.line_breaks);(0,n.has)(e,m)&&(r.START_CHARS_HINT=e.start_chars_hint);return r}(e)}t.createToken=g,t.EOF=g({name:"EOF",pattern:i.Lexer.NA}),(0,o.augmentTokenTypes)([t.EOF]),t.createTokenInstance=function(e,t,r,n,i,o,a,s){return{image:t,startOffset:r,endOffset:n,startLine:i,endLine:o,startColumn:a,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}},t.tokenMatcher=function(e,t){return(0,o.tokenStructuredMatcher)(e,t)}},758:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="9.1.0"},42:function(e,t){var r;!function(){"use strict";var n={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var o=typeof r;if("string"===o||"number"===o)e.push(r);else if(Array.isArray(r)){if(r.length){var a=i.apply(null,r);a&&e.push(a)}}else if("object"===o)if(r.toString===Object.prototype.toString)for(var s in r)n.call(r,s)&&r[s]&&e.push(s);else e.push(r.toString())}}return e.join(" ")}e.exports?(i.default=i,e.exports=i):void 0===(r=function(){return i}.apply(t,[]))||(e.exports=r)}()},6415:function(e){function t(e,t,r){var n,i,o,a,s;function l(){var c=Date.now()-a;c<t&&c>=0?n=setTimeout(l,t-c):(n=null,r||(s=e.apply(o,i),o=i=null))}null==t&&(t=100);var c=function(){o=this,i=arguments,a=Date.now();var c=r&&!n;return n||(n=setTimeout(l,t)),c&&(s=e.apply(o,i),o=i=null),s};return c.clear=function(){n&&(clearTimeout(n),n=null)},c.flush=function(){n&&(s=e.apply(o,i),o=i=null,clearTimeout(n),n=null)},c}t.debounce=t,e.exports=t},1998:function(e){"use strict";var t="%[a-f0-9]{2}",r=new RegExp(t,"gi"),n=new RegExp("("+t+")+","gi");function i(e,t){try{return decodeURIComponent(e.join(""))}catch(o){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],i(r),i(n))}function o(e){try{return decodeURIComponent(e)}catch(o){for(var t=e.match(r),n=1;n<t.length;n++)t=(e=i(t,n).join("")).match(r);return e}}e.exports=function(e){if("string"!==typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var r={"%FE%FF":"\ufffd\ufffd","%FF%FE":"\ufffd\ufffd"},i=n.exec(e);i;){try{r[i[0]]=decodeURIComponent(i[0])}catch(t){var a=o(i[0]);a!==i[0]&&(r[i[0]]=a)}i=n.exec(e)}r["%C2"]="\ufffd";for(var s=Object.keys(r),l=0;l<s.length;l++){var c=s[l];e=e.replace(new RegExp(c,"g"),r[c])}return e}(e)}}},6471:function(e){"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,i,o;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(i=n;0!==i--;)if(!e(t[i],r[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(o=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(i=n;0!==i--;)if(!Object.prototype.hasOwnProperty.call(r,o[i]))return!1;for(i=n;0!==i--;){var a=o[i];if(!e(t[a],r[a]))return!1}return!0}return t!==t&&r!==r}},6782:function(e,t,r){"use strict";r.d(t,{_Z:function(){return re},HT:function(){return ne},TD:function(){return le},T8:function(){return ce},Xo:function(){return ge},GZ:function(){return Ae}});var n=Uint8Array,i=Uint16Array,o=Uint32Array,a=new n([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new n([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l=new n([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=function(e,t){for(var r=new i(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var a=new o(r[30]);for(n=1;n<30;++n)for(var s=r[n];s<r[n+1];++s)a[s]=s-r[n]<<5|n;return[r,a]},u=c(a,2),h=u[0],d=u[1];h[28]=258,d[258]=28;for(var f=c(s,0),p=f[0],m=f[1],g=new i(32768),A=0;A<32768;++A){var v=(43690&A)>>>1|(21845&A)<<1;v=(61680&(v=(52428&v)>>>2|(13107&v)<<2))>>>4|(3855&v)<<4,g[A]=((65280&v)>>>8|(255&v)<<8)>>>1}var y=function(e,t,r){for(var n=e.length,o=0,a=new i(t);o<n;++o)++a[e[o]-1];var s,l=new i(t);for(o=0;o<t;++o)l[o]=l[o-1]+a[o-1]<<1;if(r){s=new i(1<<t);var c=15-t;for(o=0;o<n;++o)if(e[o])for(var u=o<<4|e[o],h=t-e[o],d=l[e[o]-1]++<<h,f=d|(1<<h)-1;d<=f;++d)s[g[d]>>>c]=u}else for(s=new i(n),o=0;o<n;++o)e[o]&&(s[o]=g[l[e[o]-1]++]>>>15-e[o]);return s},x=new n(288);for(A=0;A<144;++A)x[A]=8;for(A=144;A<256;++A)x[A]=9;for(A=256;A<280;++A)x[A]=7;for(A=280;A<288;++A)x[A]=8;var b=new n(32);for(A=0;A<32;++A)b[A]=5;var w=y(x,9,0),C=y(x,9,1),E=y(b,5,0),S=y(b,5,1),T=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},M=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},I=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},B=function(e){return(e/8|0)+(7&e&&1)},_=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var a=new(e instanceof i?i:e instanceof o?o:n)(r-t);return a.set(e.subarray(t,r)),a},F=function(e,t,r){var i=e.length;if(!i||r&&!r.l&&i<5)return t||new n(0);var o=!t||r,c=!r||r.i;r||(r={}),t||(t=new n(3*i));var u=function(e){var r=t.length;if(e>r){var i=new n(Math.max(2*r,e));i.set(t),t=i}},d=r.f||0,f=r.p||0,m=r.b||0,g=r.l,A=r.d,v=r.m,x=r.n,b=8*i;do{if(!g){r.f=d=M(e,f,1);var w=M(e,f+1,3);if(f+=3,!w){var E=e[(V=B(f)+4)-4]|e[V-3]<<8,F=V+E;if(F>i){if(c)throw"unexpected EOF";break}o&&u(m+E),t.set(e.subarray(V,F),m),r.b=m+=E,r.p=f=8*F;continue}if(1==w)g=C,A=S,v=9,x=5;else{if(2!=w)throw"invalid block type";var P=M(e,f,31)+257,R=M(e,f+10,15)+4,L=P+M(e,f+5,31)+1;f+=14;for(var D=new n(L),N=new n(19),k=0;k<R;++k)N[l[k]]=M(e,f+3*k,7);f+=3*R;var O=T(N),U=(1<<O)-1,Q=y(N,O,1);for(k=0;k<L;){var V,G=Q[M(e,f,U)];if(f+=15&G,(V=G>>>4)<16)D[k++]=V;else{var z=0,j=0;for(16==V?(j=3+M(e,f,3),f+=2,z=D[k-1]):17==V?(j=3+M(e,f,7),f+=3):18==V&&(j=11+M(e,f,127),f+=7);j--;)D[k++]=z}}var H=D.subarray(0,P),W=D.subarray(P);v=T(H),x=T(W),g=y(H,v,1),A=y(W,x,1)}if(f>b){if(c)throw"unexpected EOF";break}}o&&u(m+131072);for(var Z=(1<<v)-1,X=(1<<x)-1,Y=f;;Y=f){var J=(z=g[I(e,f)&Z])>>>4;if((f+=15&z)>b){if(c)throw"unexpected EOF";break}if(!z)throw"invalid length/literal";if(J<256)t[m++]=J;else{if(256==J){Y=f,g=null;break}var q=J-254;if(J>264){var K=a[k=J-257];q=M(e,f,(1<<K)-1)+h[k],f+=K}var $=A[I(e,f)&X],ee=$>>>4;if(!$)throw"invalid distance";f+=15&$;W=p[ee];if(ee>3){K=s[ee];W+=I(e,f)&(1<<K)-1,f+=K}if(f>b){if(c)throw"unexpected EOF";break}o&&u(m+131072);for(var te=m+q;m<te;m+=4)t[m]=t[m-W],t[m+1]=t[m+1-W],t[m+2]=t[m+2-W],t[m+3]=t[m+3-W];m=te}}r.l=g,r.p=Y,r.b=m,g&&(d=1,r.m=v,r.d=A,r.n=x)}while(!d);return m==t.length?t:_(t,0,m)},P=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8},R=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},L=function(e,t){for(var r=[],o=0;o<e.length;++o)e[o]&&r.push({s:o,f:e[o]});var a=r.length,s=r.slice();if(!a)return[V,0];if(1==a){var l=new n(r[0].s+1);return l[r[0].s]=1,[l,1]}r.sort((function(e,t){return e.f-t.f})),r.push({s:-1,f:25001});var c=r[0],u=r[1],h=0,d=1,f=2;for(r[0]={s:-1,f:c.f+u.f,l:c,r:u};d!=a-1;)c=r[r[h].f<r[f].f?h++:f++],u=r[h!=d&&r[h].f<r[f].f?h++:f++],r[d++]={s:-1,f:c.f+u.f,l:c,r:u};var p=s[0].s;for(o=1;o<a;++o)s[o].s>p&&(p=s[o].s);var m=new i(p+1),g=D(r[d-1],m,0);if(g>t){o=0;var A=0,v=g-t,y=1<<v;for(s.sort((function(e,t){return m[t.s]-m[e.s]||e.f-t.f}));o<a;++o){var x=s[o].s;if(!(m[x]>t))break;A+=y-(1<<g-m[x]),m[x]=t}for(A>>>=v;A>0;){var b=s[o].s;m[b]<t?A-=1<<t-m[b]++-1:++o}for(;o>=0&&A;--o){var w=s[o].s;m[w]==t&&(--m[w],++A)}g=t}return[new n(m),g]},D=function(e,t,r){return-1==e.s?Math.max(D(e.l,t,r+1),D(e.r,t,r+1)):t[e.s]=r},N=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new i(++t),n=0,o=e[0],a=1,s=function(e){r[n++]=e},l=1;l<=t;++l)if(e[l]==o&&l!=t)++a;else{if(!o&&a>2){for(;a>138;a-=138)s(32754);a>2&&(s(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(s(o),--a;a>6;a-=6)s(8304);a>2&&(s(a-3<<5|8208),a=0)}for(;a--;)s(o);a=1,o=e[l]}return[r.subarray(0,n),t]},k=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},O=function(e,t,r){var n=r.length,i=B(t+2);e[i]=255&n,e[i+1]=n>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var o=0;o<n;++o)e[i+o+4]=r[o];return 8*(i+4+n)},U=function(e,t,r,n,o,c,u,h,d,f,p){P(t,p++,r),++o[256];for(var m=L(o,15),g=m[0],A=m[1],v=L(c,15),C=v[0],S=v[1],T=N(g),M=T[0],I=T[1],B=N(C),_=B[0],F=B[1],D=new i(19),U=0;U<M.length;++U)D[31&M[U]]++;for(U=0;U<_.length;++U)D[31&_[U]]++;for(var Q=L(D,7),V=Q[0],G=Q[1],z=19;z>4&&!V[l[z-1]];--z);var j,H,W,Z,X=f+5<<3,Y=k(o,x)+k(c,b)+u,J=k(o,g)+k(c,C)+u+14+3*z+k(D,V)+(2*D[16]+3*D[17]+7*D[18]);if(X<=Y&&X<=J)return O(t,p,e.subarray(d,d+f));if(P(t,p,1+(J<Y)),p+=2,J<Y){j=y(g,A,0),H=g,W=y(C,S,0),Z=C;var q=y(V,G,0);P(t,p,I-257),P(t,p+5,F-1),P(t,p+10,z-4),p+=14;for(U=0;U<z;++U)P(t,p+3*U,V[l[U]]);p+=3*z;for(var K=[M,_],$=0;$<2;++$){var ee=K[$];for(U=0;U<ee.length;++U){var te=31&ee[U];P(t,p,q[te]),p+=V[te],te>15&&(P(t,p,ee[U]>>>5&127),p+=ee[U]>>>12)}}}else j=w,H=x,W=E,Z=b;for(U=0;U<h;++U)if(n[U]>255){te=n[U]>>>18&31;R(t,p,j[te+257]),p+=H[te+257],te>7&&(P(t,p,n[U]>>>23&31),p+=a[te]);var re=31&n[U];R(t,p,W[re]),p+=Z[re],re>3&&(R(t,p,n[U]>>>5&8191),p+=s[re])}else R(t,p,j[n[U]]),p+=H[n[U]];return R(t,p,j[256]),p+H[256]},Q=new o([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),V=new n(0),G=function(e,t,r,l,c,u){var h=e.length,f=new n(l+h+5*(1+Math.ceil(h/7e3))+c),p=f.subarray(l,f.length-c),g=0;if(!t||h<8)for(var A=0;A<=h;A+=65535){var v=A+65535;v<h?g=O(p,g,e.subarray(A,v)):(p[A]=u,g=O(p,g,e.subarray(A,h)))}else{for(var y=Q[t-1],x=y>>>13,b=8191&y,w=(1<<r)-1,C=new i(32768),E=new i(w+1),S=Math.ceil(r/3),T=2*S,M=function(t){return(e[t]^e[t+1]<<S^e[t+2]<<T)&w},I=new o(25e3),F=new i(288),P=new i(32),R=0,L=0,D=(A=0,0),N=0,k=0;A<h;++A){var G=M(A),z=32767&A,j=E[G];if(C[z]=j,E[G]=z,N<=A){var H=h-A;if((R>7e3||D>24576)&&H>423){g=U(e,p,0,I,F,P,L,D,k,A-k,g),D=R=L=0,k=A;for(var W=0;W<286;++W)F[W]=0;for(W=0;W<30;++W)P[W]=0}var Z=2,X=0,Y=b,J=z-j&32767;if(H>2&&G==M(A-J))for(var q=Math.min(x,H)-1,K=Math.min(32767,A),$=Math.min(258,H);J<=K&&--Y&&z!=j;){if(e[A+Z]==e[A+Z-J]){for(var ee=0;ee<$&&e[A+ee]==e[A+ee-J];++ee);if(ee>Z){if(Z=ee,X=J,ee>q)break;var te=Math.min(J,ee-2),re=0;for(W=0;W<te;++W){var ne=A-J+W+32768&32767,ie=ne-C[ne]+32768&32767;ie>re&&(re=ie,j=ne)}}}J+=(z=j)-(j=C[z])+32768&32767}if(X){I[D++]=268435456|d[Z]<<18|m[X];var oe=31&d[Z],ae=31&m[X];L+=a[oe]+s[ae],++F[257+oe],++P[ae],N=A+Z,++R}else I[D++]=e[A],++F[e[A]]}}g=U(e,p,u,I,F,P,L,D,k,A-k,g),!u&&7&g&&(g=O(p,g+1,V))}return _(f,0,l+B(g)+c)},z=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(1&r&&-306674912)^r>>>1;e[t]=r}return e}(),j=function(){var e=-1;return{p:function(t){for(var r=e,n=0;n<t.length;++n)r=z[255&r^t[n]]^r>>>8;e=r},d:function(){return~e}}},H=function(e,t,r,n,i){return G(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,n,!i)},W=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},Z=function(e,t){return e[t]|e[t+1]<<8},X=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Y=function(e,t){return X(e,t)+4294967296*X(e,t+4)},J=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},q=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|2+(e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(2&t)},K=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},$=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function ee(e,t){return H(e,t||{},0,0)}function te(e,t){return F(e,t)}function re(e,t){return F(e.subarray(q(e),-8),t||new n(K(e)))}function ne(e,t){return F(($(e),e.subarray(2,-4)),t)}var ie=function(e,t,r,i){for(var o in e){var a=e[o],s=t+o;a instanceof n?r[s]=[a,i]:Array.isArray(a)?r[s]=[a[0],W(i,a[1])]:ie(a,s+"/",r,i)}},oe="undefined"!=typeof TextEncoder&&new TextEncoder,ae="undefined"!=typeof TextDecoder&&new TextDecoder;try{ae.decode(V,{stream:!0}),1}catch(ve){}var se=function(e){for(var t="",r=0;;){var n=e[r++],i=(n>127)+(n>223)+(n>239);if(r+i>e.length)return[t,_(e,r-1)];i?3==i?(n=((15&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|n>>10,56320|1023&n)):t+=1&i?String.fromCharCode((31&n)<<6|63&e[r++]):String.fromCharCode((15&n)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(n)}};function le(e,t){if(t){for(var r=new n(e.length),i=0;i<e.length;++i)r[i]=e.charCodeAt(i);return r}if(oe)return oe.encode(e);var o=e.length,a=new n(e.length+(e.length>>1)),s=0,l=function(e){a[s++]=e};for(i=0;i<o;++i){if(s+5>a.length){var c=new n(s+8+(o-i<<1));c.set(a),a=c}var u=e.charCodeAt(i);u<128||t?l(u):u<2048?(l(192|u>>6),l(128|63&u)):u>55295&&u<57344?(l(240|(u=65536+(1047552&u)|1023&e.charCodeAt(++i))>>18),l(128|u>>12&63),l(128|u>>6&63),l(128|63&u)):(l(224|u>>12),l(128|u>>6&63),l(128|63&u))}return _(a,0,s)}function ce(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}if(ae)return ae.decode(e);var i=se(e),o=i[0];if(i[1].length)throw"invalid utf-8 data";return o}var ue=function(e,t){return t+30+Z(e,t+26)+Z(e,t+28)},he=function(e,t,r){var n=Z(e,t+28),i=ce(e.subarray(t+46,t+46+n),!(2048&Z(e,t+8))),o=t+46+n,a=X(e,t+20),s=r&&4294967295==a?de(e,o):[a,X(e,t+24),X(e,t+42)],l=s[0],c=s[1],u=s[2];return[Z(e,t+10),l,c,i,o+Z(e,t+30)+Z(e,t+32),u]},de=function(e,t){for(;1!=Z(e,t);t+=4+Z(e,t+2));return[Y(e,t+12),Y(e,t+4),Y(e,t+20)]},fe=function(e){var t=0;if(e)for(var r in e){var n=e[r].length;if(n>65535)throw"extra field too long";t+=n+4}return t},pe=function(e,t,r,n,i,o,a,s){var l=n.length,c=r.extra,u=s&&s.length,h=fe(c);J(e,t,null!=a?33639248:67324752),t+=4,null!=a&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==o&&8),e[t++]=i&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var d=new Date(null==r.mtime?Date.now():r.mtime),f=d.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";if(J(e,t,f<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),t+=4,null!=o&&(J(e,t,r.crc),J(e,t+4,o),J(e,t+8,r.size)),J(e,t+12,l),J(e,t+14,h),t+=16,null!=a&&(J(e,t,u),J(e,t+6,r.attrs),J(e,t+10,a),t+=14),e.set(n,t),t+=l,h)for(var p in c){var m=c[p],g=m.length;J(e,t,+p),J(e,t+2,g),e.set(m,t+4),t+=4+g}return u&&(e.set(s,t),t+=u),t},me=function(e,t,r,n,i){J(e,t,101010256),J(e,t+8,r),J(e,t+10,r),J(e,t+12,n),J(e,t+16,i)};function ge(e,t){t||(t={});var r={},i=[];ie(e,"",r,t);var o=0,a=0;for(var s in r){var l=r[s],c=l[0],u=l[1],h=0==u.level?0:8,d=(E=le(s)).length,f=u.comment,p=f&&le(f),m=p&&p.length,g=fe(u.extra);if(d>65535)throw"filename too long";var A=h?ee(c,u):c,v=A.length,y=j();y.p(c),i.push(W(u,{size:c.length,crc:y.d(),c:A,f:E,m:p,u:d!=s.length||p&&f.length!=m,o:o,compression:h})),o+=30+d+g+v,a+=76+2*(d+g)+(m||0)+v}for(var x=new n(a+22),b=o,w=a-o,C=0;C<i.length;++C){var E=i[C];pe(x,E.o,E,E.f,E.u,E.c.length);var S=30+E.f.length+fe(E.extra);x.set(E.c,E.o+S),pe(x,o,E,E.f,E.u,E.c.length,E.o,E.m),o+=16+S+(E.m?E.m.length:0)}return me(x,o,i.length,w,b),x}function Ae(e){for(var t={},r=e.length-22;101010256!=X(e,r);--r)if(!r||e.length-r>65558)throw"invalid zip file";var i=Z(e,r+8);if(!i)return{};var o=X(e,r+16),a=4294967295==o;if(a){if(r=X(e,r-12),101075792!=X(e,r))throw"invalid zip file";i=X(e,r+32),o=X(e,r+48)}for(var s=0;s<i;++s){var l=he(e,o,a),c=l[0],u=l[1],h=l[2],d=l[3],f=l[4],p=l[5],m=ue(e,p);if(o=f,c){if(8!=c)throw"unknown compression type "+c;t[d]=te(e.subarray(m,m+u),new n(h))}else t[d]=_(e,m,m+u)}return t}},7728:function(e){"use strict";e.exports=function(e,t){for(var r={},n=Object.keys(e),i=Array.isArray(t),o=0;o<n.length;o++){var a=n[o],s=e[a];(i?-1!==t.indexOf(a):t(a,s,e))&&(r[a]=s)}return r}},8056:function(e,t,r){var n="__lodash_hash_undefined__",i=9007199254740991,o="[object Symbol]",a=/^\[object .+?Constructor\]$/,s=/^(?:0|[1-9]\d*)$/,l="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,c="object"==typeof self&&self&&self.Object===Object&&self,u=l||c||Function("return this")();function h(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function d(e,t){return!!(e?e.length:0)&&function(e,t,r){if(t!==t)return function(e,t,r,n){var i=e.length,o=r+(n?1:-1);for(;n?o--:++o<i;)if(t(e[o],o,e))return o;return-1}(e,g,r);var n=r-1,i=e.length;for(;++n<i;)if(e[n]===t)return n;return-1}(e,t,0)>-1}function f(e,t,r){for(var n=-1,i=e?e.length:0;++n<i;)if(r(t,e[n]))return!0;return!1}function p(e,t){for(var r=-1,n=e?e.length:0,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function m(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function g(e){return e!==e}function A(e,t){return e.has(t)}function v(e,t){return function(r){return e(t(r))}}var y=Array.prototype,x=Function.prototype,b=Object.prototype,w=u["__core-js_shared__"],C=function(){var e=/[^.]+$/.exec(w&&w.keys&&w.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),E=x.toString,S=b.hasOwnProperty,T=b.toString,M=RegExp("^"+E.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),I=u.Symbol,B=v(Object.getPrototypeOf,Object),_=b.propertyIsEnumerable,F=y.splice,P=I?I.isConcatSpreadable:void 0,R=Object.getOwnPropertySymbols,L=Math.max,D=X(u,"Map"),N=X(Object,"create");function k(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function O(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function U(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Q(e){var t=-1,r=e?e.length:0;for(this.__data__=new U;++t<r;)this.add(e[t])}function V(e,t){var r=te(e)||ee(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,i=!!n;for(var o in e)!t&&!S.call(e,o)||i&&("length"==o||K(o,n))||r.push(o);return r}function G(e,t){for(var r,n,i=e.length;i--;)if((r=e[i][0])===(n=t)||r!==r&&n!==n)return i;return-1}function z(e,t,r,n,i){var o=-1,a=e.length;for(r||(r=q),i||(i=[]);++o<a;){var s=e[o];t>0&&r(s)?t>1?z(s,t-1,r,n,i):m(i,s):n||(i[i.length]=s)}return i}function j(e){return!(!ie(e)||(t=e,C&&C in t))&&(ne(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(r){}return t}(e)?M:a).test(function(e){if(null!=e){try{return E.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e));var t}function H(e){if(!ie(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=function(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||b;return e===r}(e),r=[];for(var n in e)("constructor"!=n||!t&&S.call(e,n))&&r.push(n);return r}function W(e){return function(e,t,r){var n=t(e);return te(e)?n:m(n,r(e))}(e,ae,J)}function Z(e,t){var r=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function X(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return j(r)?r:void 0}k.prototype.clear=function(){this.__data__=N?N(null):{}},k.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},k.prototype.get=function(e){var t=this.__data__;if(N){var r=t[e];return r===n?void 0:r}return S.call(t,e)?t[e]:void 0},k.prototype.has=function(e){var t=this.__data__;return N?void 0!==t[e]:S.call(t,e)},k.prototype.set=function(e,t){return this.__data__[e]=N&&void 0===t?n:t,this},O.prototype.clear=function(){this.__data__=[]},O.prototype.delete=function(e){var t=this.__data__,r=G(t,e);return!(r<0)&&(r==t.length-1?t.pop():F.call(t,r,1),!0)},O.prototype.get=function(e){var t=this.__data__,r=G(t,e);return r<0?void 0:t[r][1]},O.prototype.has=function(e){return G(this.__data__,e)>-1},O.prototype.set=function(e,t){var r=this.__data__,n=G(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},U.prototype.clear=function(){this.__data__={hash:new k,map:new(D||O),string:new k}},U.prototype.delete=function(e){return Z(this,e).delete(e)},U.prototype.get=function(e){return Z(this,e).get(e)},U.prototype.has=function(e){return Z(this,e).has(e)},U.prototype.set=function(e,t){return Z(this,e).set(e,t),this},Q.prototype.add=Q.prototype.push=function(e){return this.__data__.set(e,n),this},Q.prototype.has=function(e){return this.__data__.has(e)};var Y=R?v(R,Object):ue,J=R?function(e){for(var t=[];e;)m(t,Y(e)),e=B(e);return t}:ue;function q(e){return te(e)||ee(e)||!!(P&&e&&e[P])}function K(e,t){return!!(t=null==t?i:t)&&("number"==typeof e||s.test(e))&&e>-1&&e%1==0&&e<t}function $(e){if("string"==typeof e||function(e){return"symbol"==typeof e||oe(e)&&T.call(e)==o}(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function ee(e){return function(e){return oe(e)&&re(e)}(e)&&S.call(e,"callee")&&(!_.call(e,"callee")||"[object Arguments]"==T.call(e))}var te=Array.isArray;function re(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}(e.length)&&!ne(e)}function ne(e){var t=ie(e)?T.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}function ie(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function oe(e){return!!e&&"object"==typeof e}function ae(e){return re(e)?V(e,!0):H(e)}var se,le,ce=(se=function(e,t){return null==e?{}:(t=p(z(t,1),$),function(e,t){return function(e,t,r){for(var n=-1,i=t.length,o={};++n<i;){var a=t[n],s=e[a];r(s,a)&&(o[a]=s)}return o}(e=Object(e),t,(function(t,r){return r in e}))}(e,function(e,t,r,n){var i,o=-1,a=d,s=!0,l=e.length,c=[],u=t.length;if(!l)return c;r&&(t=p(t,(i=r,function(e){return i(e)}))),n?(a=f,s=!1):t.length>=200&&(a=A,s=!1,t=new Q(t));e:for(;++o<l;){var h=e[o],m=r?r(h):h;if(h=n||0!==h?h:0,s&&m===m){for(var g=u;g--;)if(t[g]===m)continue e;c.push(h)}else a(t,m,n)||c.push(h)}return c}(W(e),t)))},le=L(void 0===le?se.length-1:le,0),function(){for(var e=arguments,t=-1,r=L(e.length-le,0),n=Array(r);++t<r;)n[t]=e[le+t];t=-1;for(var i=Array(le+1);++t<le;)i[t]=e[t];return i[le]=n,h(se,this,i)});function ue(){return[]}e.exports=ce},7126:function(e,t,r){var n=9007199254740991,i="[object Arguments]",o="[object Function]",a="[object GeneratorFunction]",s="[object Symbol]",l="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,c="object"==typeof self&&self&&self.Object===Object&&self,u=l||c||Function("return this")();function h(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function d(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}var f=Object.prototype,p=f.hasOwnProperty,m=f.toString,g=u.Symbol,A=f.propertyIsEnumerable,v=g?g.isConcatSpreadable:void 0,y=Math.max;function x(e,t,r,n,i){var o=-1,a=e.length;for(r||(r=b),i||(i=[]);++o<a;){var s=e[o];t>0&&r(s)?t>1?x(s,t-1,r,n,i):d(i,s):n||(i[i.length]=s)}return i}function b(e){return C(e)||function(e){return function(e){return E(e)&&function(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}(e.length)&&!function(e){var t=function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)?m.call(e):"";return t==o||t==a}(e)}(e)}(e)&&p.call(e,"callee")&&(!A.call(e,"callee")||m.call(e)==i)}(e)||!!(v&&e&&e[v])}function w(e){if("string"==typeof e||function(e){return"symbol"==typeof e||E(e)&&m.call(e)==s}(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}var C=Array.isArray;function E(e){return!!e&&"object"==typeof e}var S,T,M=(S=function(e,t){return null==e?{}:function(e,t){return function(e,t,r){for(var n=-1,i=t.length,o={};++n<i;){var a=t[n],s=e[a];r(s,a)&&(o[a]=s)}return o}(e=Object(e),t,(function(t,r){return r in e}))}(e,function(e,t){for(var r=-1,n=e?e.length:0,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}(x(t,1),w))},T=y(void 0===T?S.length-1:T,0),function(){for(var e=arguments,t=-1,r=y(e.length-T,0),n=Array(r);++t<r;)n[t]=e[T+t];t=-1;for(var i=Array(T+1);++t<T;)i[t]=e[t];return i[T]=n,h(S,this,i)});e.exports=M},2278:function(e,t){!function(e){"use strict";function t(){}function r(e,r){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===r||r,this.encoder=new t}function n(){}function i(){}t.prototype.s2u=function(e){for(var t=this.s2uTable,r="",n=0;n<e.length;){var i=e[n++];if(!(i>=0&&i<=126||i>=161&&i<=223)&&n<e.length&&(i=i<<8|e[n++]),void 0===t[i])return console.error("unknown char code "+i+"."),r;r+=String.fromCharCode(t[i])}return r},t.prototype.s2uTable={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:65340,33120:65374,33121:8741,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:65293,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:65504,33170:65505,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:65506,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34624:9312,34625:9313,34626:9314,34627:9315,34628:9316,34629:9317,34630:9318,34631:9319,34632:9320,34633:9321,34634:9322,34635:9323,34636:9324,34637:9325,34638:9326,34639:9327,34640:9328,34641:9329,34642:9330,34643:9331,34644:8544,34645:8545,34646:8546,34647:8547,34648:8548,34649:8549,34650:8550,34651:8551,34652:8552,34653:8553,34655:13129,34656:13076,34657:13090,34658:13133,34659:13080,34660:13095,34661:13059,34662:13110,34663:13137,34664:13143,34665:13069,34666:13094,34667:13091,34668:13099,34669:13130,34670:13115,34671:13212,34672:13213,34673:13214,34674:13198,34675:13199,34676:13252,34677:13217,34686:13179,34688:12317,34689:12319,34690:8470,34691:13261,34692:8481,34693:12964,34694:12965,34695:12966,34696:12967,34697:12968,34698:12849,34699:12850,34700:12857,34701:13182,34702:13181,34703:13180,34704:8786,34705:8801,34706:8747,34707:8750,34708:8721,34709:8730,34710:8869,34711:8736,34712:8735,34713:8895,34714:8757,34715:8745,34716:8746,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081,60736:32394,60737:35100,60738:37704,60739:37512,60740:34012,60741:20425,60742:28859,60743:26161,60744:26824,60745:37625,60746:26363,60747:24389,60748:20008,60749:20193,60750:20220,60751:20224,60752:20227,60753:20281,60754:20310,60755:20370,60756:20362,60757:20378,60758:20372,60759:20429,60760:20544,60761:20514,60762:20479,60763:20510,60764:20550,60765:20592,60766:20546,60767:20628,60768:20724,60769:20696,60770:20810,60771:20836,60772:20893,60773:20926,60774:20972,60775:21013,60776:21148,60777:21158,60778:21184,60779:21211,60780:21248,60781:21255,60782:21284,60783:21362,60784:21395,60785:21426,60786:21469,60787:64014,60788:21660,60789:21642,60790:21673,60791:21759,60792:21894,60793:22361,60794:22373,60795:22444,60796:22472,60797:22471,60798:64015,60800:64016,60801:22686,60802:22706,60803:22795,60804:22867,60805:22875,60806:22877,60807:22883,60808:22948,60809:22970,60810:23382,60811:23488,60812:29999,60813:23512,60814:23532,60815:23582,60816:23718,60817:23738,60818:23797,60819:23847,60820:23891,60821:64017,60822:23874,60823:23917,60824:23992,60825:23993,60826:24016,60827:24353,60828:24372,60829:24423,60830:24503,60831:24542,60832:24669,60833:24709,60834:24714,60835:24798,60836:24789,60837:24864,60838:24818,60839:24849,60840:24887,60841:24880,60842:24984,60843:25107,60844:25254,60845:25589,60846:25696,60847:25757,60848:25806,60849:25934,60850:26112,60851:26133,60852:26171,60853:26121,60854:26158,60855:26142,60856:26148,60857:26213,60858:26199,60859:26201,60860:64018,60861:26227,60862:26265,60863:26272,60864:26290,60865:26303,60866:26362,60867:26382,60868:63785,60869:26470,60870:26555,60871:26706,60872:26560,60873:26625,60874:26692,60875:26831,60876:64019,60877:26984,60878:64020,60879:27032,60880:27106,60881:27184,60882:27243,60883:27206,60884:27251,60885:27262,60886:27362,60887:27364,60888:27606,60889:27711,60890:27740,60891:27782,60892:27759,60893:27866,60894:27908,60895:28039,60896:28015,60897:28054,60898:28076,60899:28111,60900:28152,60901:28146,60902:28156,60903:28217,60904:28252,60905:28199,60906:28220,60907:28351,60908:28552,60909:28597,60910:28661,60911:28677,60912:28679,60913:28712,60914:28805,60915:28843,60916:28943,60917:28932,60918:29020,60919:28998,60920:28999,60921:64021,60922:29121,60923:29182,60924:29361,60992:29374,60993:29476,60994:64022,60995:29559,60996:29629,60997:29641,60998:29654,60999:29667,61e3:29650,61001:29703,61002:29685,61003:29734,61004:29738,61005:29737,61006:29742,61007:29794,61008:29833,61009:29855,61010:29953,61011:30063,61012:30338,61013:30364,61014:30366,61015:30363,61016:30374,61017:64023,61018:30534,61019:21167,61020:30753,61021:30798,61022:30820,61023:30842,61024:31024,61025:64024,61026:64025,61027:64026,61028:31124,61029:64027,61030:31131,61031:31441,61032:31463,61033:64028,61034:31467,61035:31646,61036:64029,61037:32072,61038:32092,61039:32183,61040:32160,61041:32214,61042:32338,61043:32583,61044:32673,61045:64030,61046:33537,61047:33634,61048:33663,61049:33735,61050:33782,61051:33864,61052:33972,61053:34131,61054:34137,61056:34155,61057:64031,61058:34224,61059:64032,61060:64033,61061:34823,61062:35061,61063:35346,61064:35383,61065:35449,61066:35495,61067:35518,61068:35551,61069:64034,61070:35574,61071:35667,61072:35711,61073:36080,61074:36084,61075:36114,61076:36214,61077:64035,61078:36559,61079:64036,61080:64037,61081:36967,61082:37086,61083:64038,61084:37141,61085:37159,61086:37338,61087:37335,61088:37342,61089:37357,61090:37358,61091:37348,61092:37349,61093:37382,61094:37392,61095:37386,61096:37434,61097:37440,61098:37436,61099:37454,61100:37465,61101:37457,61102:37433,61103:37479,61104:37543,61105:37495,61106:37496,61107:37607,61108:37591,61109:37593,61110:37584,61111:64039,61112:37589,61113:37600,61114:37587,61115:37669,61116:37665,61117:37627,61118:64040,61119:37662,61120:37631,61121:37661,61122:37634,61123:37744,61124:37719,61125:37796,61126:37830,61127:37854,61128:37880,61129:37937,61130:37957,61131:37960,61132:38290,61133:63964,61134:64041,61135:38557,61136:38575,61137:38707,61138:38715,61139:38723,61140:38733,61141:38735,61142:38737,61143:38741,61144:38999,61145:39013,61146:64042,61147:64043,61148:39207,61149:64044,61150:39326,61151:39502,61152:39641,61153:39644,61154:39797,61155:39794,61156:39823,61157:39857,61158:39867,61159:39936,61160:40304,61161:40299,61162:64045,61163:40473,61164:40657,61167:8560,61168:8561,61169:8562,61170:8563,61171:8564,61172:8565,61173:8566,61174:8567,61175:8568,61176:8569,61177:65506,61178:65508,61179:65287,61180:65282,61504:57344,61505:57345,61506:57346,61507:57347,61508:57348,61509:57349,61510:57350,61511:57351,61512:57352,61513:57353,61514:57354,61515:57355,61516:57356,61517:57357,61518:57358,61519:57359,61520:57360,61521:57361,61522:57362,61523:57363,61524:57364,61525:57365,61526:57366,61527:57367,61528:57368,61529:57369,61530:57370,61531:57371,61532:57372,61533:57373,61534:57374,61535:57375,61536:57376,61537:57377,61538:57378,61539:57379,61540:57380,61541:57381,61542:57382,61543:57383,61544:57384,61545:57385,61546:57386,61547:57387,61548:57388,61549:57389,61550:57390,61551:57391,61552:57392,61553:57393,61554:57394,61555:57395,61556:57396,61557:57397,61558:57398,61559:57399,61560:57400,61561:57401,61562:57402,61563:57403,61564:57404,61565:57405,61566:57406,61568:57407,61569:57408,61570:57409,61571:57410,61572:57411,61573:57412,61574:57413,61575:57414,61576:57415,61577:57416,61578:57417,61579:57418,61580:57419,61581:57420,61582:57421,61583:57422,61584:57423,61585:57424,61586:57425,61587:57426,61588:57427,61589:57428,61590:57429,61591:57430,61592:57431,61593:57432,61594:57433,61595:57434,61596:57435,61597:57436,61598:57437,61599:57438,61600:57439,61601:57440,61602:57441,61603:57442,61604:57443,61605:57444,61606:57445,61607:57446,61608:57447,61609:57448,61610:57449,61611:57450,61612:57451,61613:57452,61614:57453,61615:57454,61616:57455,61617:57456,61618:57457,61619:57458,61620:57459,61621:57460,61622:57461,61623:57462,61624:57463,61625:57464,61626:57465,61627:57466,61628:57467,61629:57468,61630:57469,61631:57470,61632:57471,61633:57472,61634:57473,61635:57474,61636:57475,61637:57476,61638:57477,61639:57478,61640:57479,61641:57480,61642:57481,61643:57482,61644:57483,61645:57484,61646:57485,61647:57486,61648:57487,61649:57488,61650:57489,61651:57490,61652:57491,61653:57492,61654:57493,61655:57494,61656:57495,61657:57496,61658:57497,61659:57498,61660:57499,61661:57500,61662:57501,61663:57502,61664:57503,61665:57504,61666:57505,61667:57506,61668:57507,61669:57508,61670:57509,61671:57510,61672:57511,61673:57512,61674:57513,61675:57514,61676:57515,61677:57516,61678:57517,61679:57518,61680:57519,61681:57520,61682:57521,61683:57522,61684:57523,61685:57524,61686:57525,61687:57526,61688:57527,61689:57528,61690:57529,61691:57530,61692:57531,61760:57532,61761:57533,61762:57534,61763:57535,61764:57536,61765:57537,61766:57538,61767:57539,61768:57540,61769:57541,61770:57542,61771:57543,61772:57544,61773:57545,61774:57546,61775:57547,61776:57548,61777:57549,61778:57550,61779:57551,61780:57552,61781:57553,61782:57554,61783:57555,61784:57556,61785:57557,61786:57558,61787:57559,61788:57560,61789:57561,61790:57562,61791:57563,61792:57564,61793:57565,61794:57566,61795:57567,61796:57568,61797:57569,61798:57570,61799:57571,61800:57572,61801:57573,61802:57574,61803:57575,61804:57576,61805:57577,61806:57578,61807:57579,61808:57580,61809:57581,61810:57582,61811:57583,61812:57584,61813:57585,61814:57586,61815:57587,61816:57588,61817:57589,61818:57590,61819:57591,61820:57592,61821:57593,61822:57594,61824:57595,61825:57596,61826:57597,61827:57598,61828:57599,61829:57600,61830:57601,61831:57602,61832:57603,61833:57604,61834:57605,61835:57606,61836:57607,61837:57608,61838:57609,61839:57610,61840:57611,61841:57612,61842:57613,61843:57614,61844:57615,61845:57616,61846:57617,61847:57618,61848:57619,61849:57620,61850:57621,61851:57622,61852:57623,61853:57624,61854:57625,61855:57626,61856:57627,61857:57628,61858:57629,61859:57630,61860:57631,61861:57632,61862:57633,61863:57634,61864:57635,61865:57636,61866:57637,61867:57638,61868:57639,61869:57640,61870:57641,61871:57642,61872:57643,61873:57644,61874:57645,61875:57646,61876:57647,61877:57648,61878:57649,61879:57650,61880:57651,61881:57652,61882:57653,61883:57654,61884:57655,61885:57656,61886:57657,61887:57658,61888:57659,61889:57660,61890:57661,61891:57662,61892:57663,61893:57664,61894:57665,61895:57666,61896:57667,61897:57668,61898:57669,61899:57670,61900:57671,61901:57672,61902:57673,61903:57674,61904:57675,61905:57676,61906:57677,61907:57678,61908:57679,61909:57680,61910:57681,61911:57682,61912:57683,61913:57684,61914:57685,61915:57686,61916:57687,61917:57688,61918:57689,61919:57690,61920:57691,61921:57692,61922:57693,61923:57694,61924:57695,61925:57696,61926:57697,61927:57698,61928:57699,61929:57700,61930:57701,61931:57702,61932:57703,61933:57704,61934:57705,61935:57706,61936:57707,61937:57708,61938:57709,61939:57710,61940:57711,61941:57712,61942:57713,61943:57714,61944:57715,61945:57716,61946:57717,61947:57718,61948:57719,62016:57720,62017:57721,62018:57722,62019:57723,62020:57724,62021:57725,62022:57726,62023:57727,62024:57728,62025:57729,62026:57730,62027:57731,62028:57732,62029:57733,62030:57734,62031:57735,62032:57736,62033:57737,62034:57738,62035:57739,62036:57740,62037:57741,62038:57742,62039:57743,62040:57744,62041:57745,62042:57746,62043:57747,62044:57748,62045:57749,62046:57750,62047:57751,62048:57752,62049:57753,62050:57754,62051:57755,62052:57756,62053:57757,62054:57758,62055:57759,62056:57760,62057:57761,62058:57762,62059:57763,62060:57764,62061:57765,62062:57766,62063:57767,62064:57768,62065:57769,62066:57770,62067:57771,62068:57772,62069:57773,62070:57774,62071:57775,62072:57776,62073:57777,62074:57778,62075:57779,62076:57780,62077:57781,62078:57782,62080:57783,62081:57784,62082:57785,62083:57786,62084:57787,62085:57788,62086:57789,62087:57790,62088:57791,62089:57792,62090:57793,62091:57794,62092:57795,62093:57796,62094:57797,62095:57798,62096:57799,62097:57800,62098:57801,62099:57802,62100:57803,62101:57804,62102:57805,62103:57806,62104:57807,62105:57808,62106:57809,62107:57810,62108:57811,62109:57812,62110:57813,62111:57814,62112:57815,62113:57816,62114:57817,62115:57818,62116:57819,62117:57820,62118:57821,62119:57822,62120:57823,62121:57824,62122:57825,62123:57826,62124:57827,62125:57828,62126:57829,62127:57830,62128:57831,62129:57832,62130:57833,62131:57834,62132:57835,62133:57836,62134:57837,62135:57838,62136:57839,62137:57840,62138:57841,62139:57842,62140:57843,62141:57844,62142:57845,62143:57846,62144:57847,62145:57848,62146:57849,62147:57850,62148:57851,62149:57852,62150:57853,62151:57854,62152:57855,62153:57856,62154:57857,62155:57858,62156:57859,62157:57860,62158:57861,62159:57862,62160:57863,62161:57864,62162:57865,62163:57866,62164:57867,62165:57868,62166:57869,62167:57870,62168:57871,62169:57872,62170:57873,62171:57874,62172:57875,62173:57876,62174:57877,62175:57878,62176:57879,62177:57880,62178:57881,62179:57882,62180:57883,62181:57884,62182:57885,62183:57886,62184:57887,62185:57888,62186:57889,62187:57890,62188:57891,62189:57892,62190:57893,62191:57894,62192:57895,62193:57896,62194:57897,62195:57898,62196:57899,62197:57900,62198:57901,62199:57902,62200:57903,62201:57904,62202:57905,62203:57906,62204:57907,62272:57908,62273:57909,62274:57910,62275:57911,62276:57912,62277:57913,62278:57914,62279:57915,62280:57916,62281:57917,62282:57918,62283:57919,62284:57920,62285:57921,62286:57922,62287:57923,62288:57924,62289:57925,62290:57926,62291:57927,62292:57928,62293:57929,62294:57930,62295:57931,62296:57932,62297:57933,62298:57934,62299:57935,62300:57936,62301:57937,62302:57938,62303:57939,62304:57940,62305:57941,62306:57942,62307:57943,62308:57944,62309:57945,62310:57946,62311:57947,62312:57948,62313:57949,62314:57950,62315:57951,62316:57952,62317:57953,62318:57954,62319:57955,62320:57956,62321:57957,62322:57958,62323:57959,62324:57960,62325:57961,62326:57962,62327:57963,62328:57964,62329:57965,62330:57966,62331:57967,62332:57968,62333:57969,62334:57970,62336:57971,62337:57972,62338:57973,62339:57974,62340:57975,62341:57976,62342:57977,62343:57978,62344:57979,62345:57980,62346:57981,62347:57982,62348:57983,62349:57984,62350:57985,62351:57986,62352:57987,62353:57988,62354:57989,62355:57990,62356:57991,62357:57992,62358:57993,62359:57994,62360:57995,62361:57996,62362:57997,62363:57998,62364:57999,62365:58e3,62366:58001,62367:58002,62368:58003,62369:58004,62370:58005,62371:58006,62372:58007,62373:58008,62374:58009,62375:58010,62376:58011,62377:58012,62378:58013,62379:58014,62380:58015,62381:58016,62382:58017,62383:58018,62384:58019,62385:58020,62386:58021,62387:58022,62388:58023,62389:58024,62390:58025,62391:58026,62392:58027,62393:58028,62394:58029,62395:58030,62396:58031,62397:58032,62398:58033,62399:58034,62400:58035,62401:58036,62402:58037,62403:58038,62404:58039,62405:58040,62406:58041,62407:58042,62408:58043,62409:58044,62410:58045,62411:58046,62412:58047,62413:58048,62414:58049,62415:58050,62416:58051,62417:58052,62418:58053,62419:58054,62420:58055,62421:58056,62422:58057,62423:58058,62424:58059,62425:58060,62426:58061,62427:58062,62428:58063,62429:58064,62430:58065,62431:58066,62432:58067,62433:58068,62434:58069,62435:58070,62436:58071,62437:58072,62438:58073,62439:58074,62440:58075,62441:58076,62442:58077,62443:58078,62444:58079,62445:58080,62446:58081,62447:58082,62448:58083,62449:58084,62450:58085,62451:58086,62452:58087,62453:58088,62454:58089,62455:58090,62456:58091,62457:58092,62458:58093,62459:58094,62460:58095,62528:58096,62529:58097,62530:58098,62531:58099,62532:58100,62533:58101,62534:58102,62535:58103,62536:58104,62537:58105,62538:58106,62539:58107,62540:58108,62541:58109,62542:58110,62543:58111,62544:58112,62545:58113,62546:58114,62547:58115,62548:58116,62549:58117,62550:58118,62551:58119,62552:58120,62553:58121,62554:58122,62555:58123,62556:58124,62557:58125,62558:58126,62559:58127,62560:58128,62561:58129,62562:58130,62563:58131,62564:58132,62565:58133,62566:58134,62567:58135,62568:58136,62569:58137,62570:58138,62571:58139,62572:58140,62573:58141,62574:58142,62575:58143,62576:58144,62577:58145,62578:58146,62579:58147,62580:58148,62581:58149,62582:58150,62583:58151,62584:58152,62585:58153,62586:58154,62587:58155,62588:58156,62589:58157,62590:58158,62592:58159,62593:58160,62594:58161,62595:58162,62596:58163,62597:58164,62598:58165,62599:58166,62600:58167,62601:58168,62602:58169,62603:58170,62604:58171,62605:58172,62606:58173,62607:58174,62608:58175,62609:58176,62610:58177,62611:58178,62612:58179,62613:58180,62614:58181,62615:58182,62616:58183,62617:58184,62618:58185,62619:58186,62620:58187,62621:58188,62622:58189,62623:58190,62624:58191,62625:58192,62626:58193,62627:58194,62628:58195,62629:58196,62630:58197,62631:58198,62632:58199,62633:58200,62634:58201,62635:58202,62636:58203,62637:58204,62638:58205,62639:58206,62640:58207,62641:58208,62642:58209,62643:58210,62644:58211,62645:58212,62646:58213,62647:58214,62648:58215,62649:58216,62650:58217,62651:58218,62652:58219,62653:58220,62654:58221,62655:58222,62656:58223,62657:58224,62658:58225,62659:58226,62660:58227,62661:58228,62662:58229,62663:58230,62664:58231,62665:58232,62666:58233,62667:58234,62668:58235,62669:58236,62670:58237,62671:58238,62672:58239,62673:58240,62674:58241,62675:58242,62676:58243,62677:58244,62678:58245,62679:58246,62680:58247,62681:58248,62682:58249,62683:58250,62684:58251,62685:58252,62686:58253,62687:58254,62688:58255,62689:58256,62690:58257,62691:58258,62692:58259,62693:58260,62694:58261,62695:58262,62696:58263,62697:58264,62698:58265,62699:58266,62700:58267,62701:58268,62702:58269,62703:58270,62704:58271,62705:58272,62706:58273,62707:58274,62708:58275,62709:58276,62710:58277,62711:58278,62712:58279,62713:58280,62714:58281,62715:58282,62716:58283,62784:58284,62785:58285,62786:58286,62787:58287,62788:58288,62789:58289,62790:58290,62791:58291,62792:58292,62793:58293,62794:58294,62795:58295,62796:58296,62797:58297,62798:58298,62799:58299,62800:58300,62801:58301,62802:58302,62803:58303,62804:58304,62805:58305,62806:58306,62807:58307,62808:58308,62809:58309,62810:58310,62811:58311,62812:58312,62813:58313,62814:58314,62815:58315,62816:58316,62817:58317,62818:58318,62819:58319,62820:58320,62821:58321,62822:58322,62823:58323,62824:58324,62825:58325,62826:58326,62827:58327,62828:58328,62829:58329,62830:58330,62831:58331,62832:58332,62833:58333,62834:58334,62835:58335,62836:58336,62837:58337,62838:58338,62839:58339,62840:58340,62841:58341,62842:58342,62843:58343,62844:58344,62845:58345,62846:58346,62848:58347,62849:58348,62850:58349,62851:58350,62852:58351,62853:58352,62854:58353,62855:58354,62856:58355,62857:58356,62858:58357,62859:58358,62860:58359,62861:58360,62862:58361,62863:58362,62864:58363,62865:58364,62866:58365,62867:58366,62868:58367,62869:58368,62870:58369,62871:58370,62872:58371,62873:58372,62874:58373,62875:58374,62876:58375,62877:58376,62878:58377,62879:58378,62880:58379,62881:58380,62882:58381,62883:58382,62884:58383,62885:58384,62886:58385,62887:58386,62888:58387,62889:58388,62890:58389,62891:58390,62892:58391,62893:58392,62894:58393,62895:58394,62896:58395,62897:58396,62898:58397,62899:58398,62900:58399,62901:58400,62902:58401,62903:58402,62904:58403,62905:58404,62906:58405,62907:58406,62908:58407,62909:58408,62910:58409,62911:58410,62912:58411,62913:58412,62914:58413,62915:58414,62916:58415,62917:58416,62918:58417,62919:58418,62920:58419,62921:58420,62922:58421,62923:58422,62924:58423,62925:58424,62926:58425,62927:58426,62928:58427,62929:58428,62930:58429,62931:58430,62932:58431,62933:58432,62934:58433,62935:58434,62936:58435,62937:58436,62938:58437,62939:58438,62940:58439,62941:58440,62942:58441,62943:58442,62944:58443,62945:58444,62946:58445,62947:58446,62948:58447,62949:58448,62950:58449,62951:58450,62952:58451,62953:58452,62954:58453,62955:58454,62956:58455,62957:58456,62958:58457,62959:58458,62960:58459,62961:58460,62962:58461,62963:58462,62964:58463,62965:58464,62966:58465,62967:58466,62968:58467,62969:58468,62970:58469,62971:58470,62972:58471,63040:58472,63041:58473,63042:58474,63043:58475,63044:58476,63045:58477,63046:58478,63047:58479,63048:58480,63049:58481,63050:58482,63051:58483,63052:58484,63053:58485,63054:58486,63055:58487,63056:58488,63057:58489,63058:58490,63059:58491,63060:58492,63061:58493,63062:58494,63063:58495,63064:58496,63065:58497,63066:58498,63067:58499,63068:58500,63069:58501,63070:58502,63071:58503,63072:58504,63073:58505,63074:58506,63075:58507,63076:58508,63077:58509,63078:58510,63079:58511,63080:58512,63081:58513,63082:58514,63083:58515,63084:58516,63085:58517,63086:58518,63087:58519,63088:58520,63089:58521,63090:58522,63091:58523,63092:58524,63093:58525,63094:58526,63095:58527,63096:58528,63097:58529,63098:58530,63099:58531,63100:58532,63101:58533,63102:58534,63104:58535,63105:58536,63106:58537,63107:58538,63108:58539,63109:58540,63110:58541,63111:58542,63112:58543,63113:58544,63114:58545,63115:58546,63116:58547,63117:58548,63118:58549,63119:58550,63120:58551,63121:58552,63122:58553,63123:58554,63124:58555,63125:58556,63126:58557,63127:58558,63128:58559,63129:58560,63130:58561,63131:58562,63132:58563,63133:58564,63134:58565,63135:58566,63136:58567,63137:58568,63138:58569,63139:58570,63140:58571,63141:58572,63142:58573,63143:58574,63144:58575,63145:58576,63146:58577,63147:58578,63148:58579,63149:58580,63150:58581,63151:58582,63152:58583,63153:58584,63154:58585,63155:58586,63156:58587,63157:58588,63158:58589,63159:58590,63160:58591,63161:58592,63162:58593,63163:58594,63164:58595,63165:58596,63166:58597,63167:58598,63168:58599,63169:58600,63170:58601,63171:58602,63172:58603,63173:58604,63174:58605,63175:58606,63176:58607,63177:58608,63178:58609,63179:58610,63180:58611,63181:58612,63182:58613,63183:58614,63184:58615,63185:58616,63186:58617,63187:58618,63188:58619,63189:58620,63190:58621,63191:58622,63192:58623,63193:58624,63194:58625,63195:58626,63196:58627,63197:58628,63198:58629,63199:58630,63200:58631,63201:58632,63202:58633,63203:58634,63204:58635,63205:58636,63206:58637,63207:58638,63208:58639,63209:58640,63210:58641,63211:58642,63212:58643,63213:58644,63214:58645,63215:58646,63216:58647,63217:58648,63218:58649,63219:58650,63220:58651,63221:58652,63222:58653,63223:58654,63224:58655,63225:58656,63226:58657,63227:58658,63228:58659,63296:58660,63297:58661,63298:58662,63299:58663,63300:58664,63301:58665,63302:58666,63303:58667,63304:58668,63305:58669,63306:58670,63307:58671,63308:58672,63309:58673,63310:58674,63311:58675,63312:58676,63313:58677,63314:58678,63315:58679,63316:58680,63317:58681,63318:58682,63319:58683,63320:58684,63321:58685,63322:58686,63323:58687,63324:58688,63325:58689,63326:58690,63327:58691,63328:58692,63329:58693,63330:58694,63331:58695,63332:58696,63333:58697,63334:58698,63335:58699,63336:58700,63337:58701,63338:58702,63339:58703,63340:58704,63341:58705,63342:58706,63343:58707,63344:58708,63345:58709,63346:58710,63347:58711,63348:58712,63349:58713,63350:58714,63351:58715,63352:58716,63353:58717,63354:58718,63355:58719,63356:58720,63357:58721,63358:58722,63360:58723,63361:58724,63362:58725,63363:58726,63364:58727,63365:58728,63366:58729,63367:58730,63368:58731,63369:58732,63370:58733,63371:58734,63372:58735,63373:58736,63374:58737,63375:58738,63376:58739,63377:58740,63378:58741,63379:58742,63380:58743,63381:58744,63382:58745,63383:58746,63384:58747,63385:58748,63386:58749,63387:58750,63388:58751,63389:58752,63390:58753,63391:58754,63392:58755,63393:58756,63394:58757,63395:58758,63396:58759,63397:58760,63398:58761,63399:58762,63400:58763,63401:58764,63402:58765,63403:58766,63404:58767,63405:58768,63406:58769,63407:58770,63408:58771,63409:58772,63410:58773,63411:58774,63412:58775,63413:58776,63414:58777,63415:58778,63416:58779,63417:58780,63418:58781,63419:58782,63420:58783,63421:58784,63422:58785,63423:58786,63424:58787,63425:58788,63426:58789,63427:58790,63428:58791,63429:58792,63430:58793,63431:58794,63432:58795,63433:58796,63434:58797,63435:58798,63436:58799,63437:58800,63438:58801,63439:58802,63440:58803,63441:58804,63442:58805,63443:58806,63444:58807,63445:58808,63446:58809,63447:58810,63448:58811,63449:58812,63450:58813,63451:58814,63452:58815,63453:58816,63454:58817,63455:58818,63456:58819,63457:58820,63458:58821,63459:58822,63460:58823,63461:58824,63462:58825,63463:58826,63464:58827,63465:58828,63466:58829,63467:58830,63468:58831,63469:58832,63470:58833,63471:58834,63472:58835,63473:58836,63474:58837,63475:58838,63476:58839,63477:58840,63478:58841,63479:58842,63480:58843,63481:58844,63482:58845,63483:58846,63484:58847,63552:58848,63553:58849,63554:58850,63555:58851,63556:58852,63557:58853,63558:58854,63559:58855,63560:58856,63561:58857,63562:58858,63563:58859,63564:58860,63565:58861,63566:58862,63567:58863,63568:58864,63569:58865,63570:58866,63571:58867,63572:58868,63573:58869,63574:58870,63575:58871,63576:58872,63577:58873,63578:58874,63579:58875,63580:58876,63581:58877,63582:58878,63583:58879,63584:58880,63585:58881,63586:58882,63587:58883,63588:58884,63589:58885,63590:58886,63591:58887,63592:58888,63593:58889,63594:58890,63595:58891,63596:58892,63597:58893,63598:58894,63599:58895,63600:58896,63601:58897,63602:58898,63603:58899,63604:58900,63605:58901,63606:58902,63607:58903,63608:58904,63609:58905,63610:58906,63611:58907,63612:58908,63613:58909,63614:58910,63616:58911,63617:58912,63618:58913,63619:58914,63620:58915,63621:58916,63622:58917,63623:58918,63624:58919,63625:58920,63626:58921,63627:58922,63628:58923,63629:58924,63630:58925,63631:58926,63632:58927,63633:58928,63634:58929,63635:58930,63636:58931,63637:58932,63638:58933,63639:58934,63640:58935,63641:58936,63642:58937,63643:58938,63644:58939,63645:58940,63646:58941,63647:58942,63648:58943,63649:58944,63650:58945,63651:58946,63652:58947,63653:58948,63654:58949,63655:58950,63656:58951,63657:58952,63658:58953,63659:58954,63660:58955,63661:58956,63662:58957,63663:58958,63664:58959,63665:58960,63666:58961,63667:58962,63668:58963,63669:58964,63670:58965,63671:58966,63672:58967,63673:58968,63674:58969,63675:58970,63676:58971,63677:58972,63678:58973,63679:58974,63680:58975,63681:58976,63682:58977,63683:58978,63684:58979,63685:58980,63686:58981,63687:58982,63688:58983,63689:58984,63690:58985,63691:58986,63692:58987,63693:58988,63694:58989,63695:58990,63696:58991,63697:58992,63698:58993,63699:58994,63700:58995,63701:58996,63702:58997,63703:58998,63704:58999,63705:59e3,63706:59001,63707:59002,63708:59003,63709:59004,63710:59005,63711:59006,63712:59007,63713:59008,63714:59009,63715:59010,63716:59011,63717:59012,63718:59013,63719:59014,63720:59015,63721:59016,63722:59017,63723:59018,63724:59019,63725:59020,63726:59021,63727:59022,63728:59023,63729:59024,63730:59025,63731:59026,63732:59027,63733:59028,63734:59029,63735:59030,63736:59031,63737:59032,63738:59033,63739:59034,63740:59035,64064:8560,64065:8561,64066:8562,64067:8563,64068:8564,64069:8565,64070:8566,64071:8567,64072:8568,64073:8569,64074:8544,64075:8545,64076:8546,64077:8547,64078:8548,64079:8549,64080:8550,64081:8551,64082:8552,64083:8553,64084:65506,64085:65508,64086:65287,64087:65282,64088:12849,64089:8470,64090:8481,64091:8757,64092:32394,64093:35100,64094:37704,64095:37512,64096:34012,64097:20425,64098:28859,64099:26161,64100:26824,64101:37625,64102:26363,64103:24389,64104:20008,64105:20193,64106:20220,64107:20224,64108:20227,64109:20281,64110:20310,64111:20370,64112:20362,64113:20378,64114:20372,64115:20429,64116:20544,64117:20514,64118:20479,64119:20510,64120:20550,64121:20592,64122:20546,64123:20628,64124:20724,64125:20696,64126:20810,64128:20836,64129:20893,64130:20926,64131:20972,64132:21013,64133:21148,64134:21158,64135:21184,64136:21211,64137:21248,64138:21255,64139:21284,64140:21362,64141:21395,64142:21426,64143:21469,64144:64014,64145:21660,64146:21642,64147:21673,64148:21759,64149:21894,64150:22361,64151:22373,64152:22444,64153:22472,64154:22471,64155:64015,64156:64016,64157:22686,64158:22706,64159:22795,64160:22867,64161:22875,64162:22877,64163:22883,64164:22948,64165:22970,64166:23382,64167:23488,64168:29999,64169:23512,64170:23532,64171:23582,64172:23718,64173:23738,64174:23797,64175:23847,64176:23891,64177:64017,64178:23874,64179:23917,64180:23992,64181:23993,64182:24016,64183:24353,64184:24372,64185:24423,64186:24503,64187:24542,64188:24669,64189:24709,64190:24714,64191:24798,64192:24789,64193:24864,64194:24818,64195:24849,64196:24887,64197:24880,64198:24984,64199:25107,64200:25254,64201:25589,64202:25696,64203:25757,64204:25806,64205:25934,64206:26112,64207:26133,64208:26171,64209:26121,64210:26158,64211:26142,64212:26148,64213:26213,64214:26199,64215:26201,64216:64018,64217:26227,64218:26265,64219:26272,64220:26290,64221:26303,64222:26362,64223:26382,64224:63785,64225:26470,64226:26555,64227:26706,64228:26560,64229:26625,64230:26692,64231:26831,64232:64019,64233:26984,64234:64020,64235:27032,64236:27106,64237:27184,64238:27243,64239:27206,64240:27251,64241:27262,64242:27362,64243:27364,64244:27606,64245:27711,64246:27740,64247:27782,64248:27759,64249:27866,64250:27908,64251:28039,64252:28015,64320:28054,64321:28076,64322:28111,64323:28152,64324:28146,64325:28156,64326:28217,64327:28252,64328:28199,64329:28220,64330:28351,64331:28552,64332:28597,64333:28661,64334:28677,64335:28679,64336:28712,64337:28805,64338:28843,64339:28943,64340:28932,64341:29020,64342:28998,64343:28999,64344:64021,64345:29121,64346:29182,64347:29361,64348:29374,64349:29476,64350:64022,64351:29559,64352:29629,64353:29641,64354:29654,64355:29667,64356:29650,64357:29703,64358:29685,64359:29734,64360:29738,64361:29737,64362:29742,64363:29794,64364:29833,64365:29855,64366:29953,64367:30063,64368:30338,64369:30364,64370:30366,64371:30363,64372:30374,64373:64023,64374:30534,64375:21167,64376:30753,64377:30798,64378:30820,64379:30842,64380:31024,64381:64024,64382:64025,64384:64026,64385:31124,64386:64027,64387:31131,64388:31441,64389:31463,64390:64028,64391:31467,64392:31646,64393:64029,64394:32072,64395:32092,64396:32183,64397:32160,64398:32214,64399:32338,64400:32583,64401:32673,64402:64030,64403:33537,64404:33634,64405:33663,64406:33735,64407:33782,64408:33864,64409:33972,64410:34131,64411:34137,64412:34155,64413:64031,64414:34224,64415:64032,64416:64033,64417:34823,64418:35061,64419:35346,64420:35383,64421:35449,64422:35495,64423:35518,64424:35551,64425:64034,64426:35574,64427:35667,64428:35711,64429:36080,64430:36084,64431:36114,64432:36214,64433:64035,64434:36559,64435:64036,64436:64037,64437:36967,64438:37086,64439:64038,64440:37141,64441:37159,64442:37338,64443:37335,64444:37342,64445:37357,64446:37358,64447:37348,64448:37349,64449:37382,64450:37392,64451:37386,64452:37434,64453:37440,64454:37436,64455:37454,64456:37465,64457:37457,64458:37433,64459:37479,64460:37543,64461:37495,64462:37496,64463:37607,64464:37591,64465:37593,64466:37584,64467:64039,64468:37589,64469:37600,64470:37587,64471:37669,64472:37665,64473:37627,64474:64040,64475:37662,64476:37631,64477:37661,64478:37634,64479:37744,64480:37719,64481:37796,64482:37830,64483:37854,64484:37880,64485:37937,64486:37957,64487:37960,64488:38290,64489:63964,64490:64041,64491:38557,64492:38575,64493:38707,64494:38715,64495:38723,64496:38733,64497:38735,64498:38737,64499:38741,64500:38999,64501:39013,64502:64042,64503:64043,64504:39207,64505:64044,64506:39326,64507:39502,64508:39641,64576:39644,64577:39797,64578:39794,64579:39823,64580:39857,64581:39867,64582:39936,64583:40304,64584:40299,64585:64045,64586:40473,64587:40657},r.prototype={constructor:r,getInt8:function(){var e=this.dv.getInt8(this.offset);return this.offset+=1,e},getInt8Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt8());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint8Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getUint8());return t},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt16Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt16());return t},getUint16:function(){var e=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,e},getUint16Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getUint16());return t},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getUint32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getUint32());return t},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getIndex:function(e,t){switch(e){case 1:return!0===t?this.getUint8():this.getInt8();case 2:return!0===t?this.getUint16():this.getInt16();case 4:return this.getInt32();default:throw"unknown number type "+e+" exception."}},getIndexArray:function(e,t,r){for(var n=[],i=0;i<t;i++)n.push(this.getIndex(e,r));return n},getChars:function(e){for(var t="";e>0;){var r=this.getUint8();if(e--,0===r)break;t+=String.fromCharCode(r)}for(;e>0;)this.getUint8(),e--;return t},getSjisStringsAsUnicode:function(e){for(var t=[];e>0;){var r=this.getUint8();if(e--,0===r)break;t.push(r)}for(;e>0;)this.getUint8(),e--;return this.encoder.s2u(new Uint8Array(t))},getUnicodeStrings:function(e){for(var t="";e>0;){var r=this.getUint16();if(e-=2,0===r)break;t+=String.fromCharCode(r)}for(;e>0;)this.getUint8(),e--;return t},getTextBuffer:function(){var e=this.getUint32();return this.getUnicodeStrings(e)}},n.prototype={constructor:n,leftToRightVector3:function(e){e[2]=-e[2]},leftToRightQuaternion:function(e){e[0]=-e[0],e[1]=-e[1]},leftToRightEuler:function(e){e[0]=-e[0],e[1]=-e[1]},leftToRightIndexOrder:function(e){var t=e[2];e[2]=e[0],e[0]=t},leftToRightVector3Range:function(e,t){var r=-t[2];t[2]=-e[2],e[2]=r},leftToRightEulerRange:function(e,t){var r=-t[0],n=-t[1];t[0]=-e[0],t[1]=-e[1],e[0]=r,e[1]=n}},i.prototype.parsePmd=function(e,t){var n={},i=new r(e);n.metadata={},n.metadata.format="pmd",n.metadata.coordinateSystem="left";var o=function(){var e=function(){var e={};return e.position=i.getFloat32Array(3),e.normal=i.getFloat32Array(3),e.uv=i.getFloat32Array(2),e.skinIndices=i.getUint16Array(2),e.skinWeights=[i.getUint8()/100],e.skinWeights.push(1-e.skinWeights[0]),e.edgeFlag=i.getUint8(),e},t=n.metadata;t.vertexCount=i.getUint32(),n.vertices=[];for(var r=0;r<t.vertexCount;r++)n.vertices.push(e())},a=function(){var e=function(){var e={};return e.indices=i.getUint16Array(3),e},t=n.metadata;t.faceCount=i.getUint32()/3,n.faces=[];for(var r=0;r<t.faceCount;r++)n.faces.push(e())},s=function(){var e=function(){var e={};return e.diffuse=i.getFloat32Array(4),e.shininess=i.getFloat32(),e.specular=i.getFloat32Array(3),e.ambient=i.getFloat32Array(3),e.toonIndex=i.getInt8(),e.edgeFlag=i.getUint8(),e.faceCount=i.getUint32()/3,e.fileName=i.getSjisStringsAsUnicode(20),e},t=n.metadata;t.materialCount=i.getUint32(),n.materials=[];for(var r=0;r<t.materialCount;r++)n.materials.push(e())},l=function(){var e=function(){var e={};return e.name=i.getSjisStringsAsUnicode(20),e.parentIndex=i.getInt16(),e.tailIndex=i.getInt16(),e.type=i.getUint8(),e.ikIndex=i.getInt16(),e.position=i.getFloat32Array(3),e},t=n.metadata;t.boneCount=i.getUint16(),n.bones=[];for(var r=0;r<t.boneCount;r++)n.bones.push(e())},c=function(){var e=function(){var e={};e.target=i.getUint16(),e.effector=i.getUint16(),e.linkCount=i.getUint8(),e.iteration=i.getUint16(),e.maxAngle=i.getFloat32(),e.links=[];for(var t=0;t<e.linkCount;t++){var r={};r.index=i.getUint16(),e.links.push(r)}return e},t=n.metadata;t.ikCount=i.getUint16(),n.iks=[];for(var r=0;r<t.ikCount;r++)n.iks.push(e())},u=function(){var e=function(){var e={};e.name=i.getSjisStringsAsUnicode(20),e.elementCount=i.getUint32(),e.type=i.getUint8(),e.elements=[];for(var t=0;t<e.elementCount;t++)e.elements.push({index:i.getUint32(),position:i.getFloat32Array(3)});return e},t=n.metadata;t.morphCount=i.getUint16(),n.morphs=[];for(var r=0;r<t.morphCount;r++)n.morphs.push(e())},h=function(){var e=function(){var e={};return e.index=i.getUint16(),e},t=n.metadata;t.morphFrameCount=i.getUint8(),n.morphFrames=[];for(var r=0;r<t.morphFrameCount;r++)n.morphFrames.push(e())},d=function(){var e=function(){var e={};return e.name=i.getSjisStringsAsUnicode(50),e},t=n.metadata;t.boneFrameNameCount=i.getUint8(),n.boneFrameNames=[];for(var r=0;r<t.boneFrameNameCount;r++)n.boneFrameNames.push(e())},f=function(){var e=function(){var e={};return e.boneIndex=i.getInt16(),e.frameIndex=i.getUint8(),e},t=n.metadata;t.boneFrameCount=i.getUint32(),n.boneFrames=[];for(var r=0;r<t.boneFrameCount;r++)n.boneFrames.push(e())},p=function(){var e=n.metadata;e.englishCompatibility=i.getUint8(),e.englishCompatibility>0&&(e.englishModelName=i.getSjisStringsAsUnicode(20),e.englishComment=i.getSjisStringsAsUnicode(256))},m=function(){var e=function(){var e={};return e.name=i.getSjisStringsAsUnicode(20),e},t=n.metadata;if(0!==t.englishCompatibility){n.englishBoneNames=[];for(var r=0;r<t.boneCount;r++)n.englishBoneNames.push(e())}},g=function(){var e=function(){var e={};return e.name=i.getSjisStringsAsUnicode(20),e},t=n.metadata;if(0!==t.englishCompatibility){n.englishMorphNames=[];for(var r=0;r<t.morphCount-1;r++)n.englishMorphNames.push(e())}},A=function(){var e=function(){var e={};return e.name=i.getSjisStringsAsUnicode(50),e},t=n.metadata;if(0!==t.englishCompatibility){n.englishBoneFrameNames=[];for(var r=0;r<t.boneFrameNameCount;r++)n.englishBoneFrameNames.push(e())}},v=function(){var e=function(){var e={};return e.fileName=i.getSjisStringsAsUnicode(100),e};n.toonTextures=[];for(var t=0;t<10;t++)n.toonTextures.push(e())},y=function(){var e=function(){var e={};return e.name=i.getSjisStringsAsUnicode(20),e.boneIndex=i.getInt16(),e.groupIndex=i.getUint8(),e.groupTarget=i.getUint16(),e.shapeType=i.getUint8(),e.width=i.getFloat32(),e.height=i.getFloat32(),e.depth=i.getFloat32(),e.position=i.getFloat32Array(3),e.rotation=i.getFloat32Array(3),e.weight=i.getFloat32(),e.positionDamping=i.getFloat32(),e.rotationDamping=i.getFloat32(),e.restitution=i.getFloat32(),e.friction=i.getFloat32(),e.type=i.getUint8(),e},t=n.metadata;t.rigidBodyCount=i.getUint32(),n.rigidBodies=[];for(var r=0;r<t.rigidBodyCount;r++)n.rigidBodies.push(e())},x=function(){var e=function(){var e={};return e.name=i.getSjisStringsAsUnicode(20),e.rigidBodyIndex1=i.getUint32(),e.rigidBodyIndex2=i.getUint32(),e.position=i.getFloat32Array(3),e.rotation=i.getFloat32Array(3),e.translationLimitation1=i.getFloat32Array(3),e.translationLimitation2=i.getFloat32Array(3),e.rotationLimitation1=i.getFloat32Array(3),e.rotationLimitation2=i.getFloat32Array(3),e.springPosition=i.getFloat32Array(3),e.springRotation=i.getFloat32Array(3),e},t=n.metadata;t.constraintCount=i.getUint32(),n.constraints=[];for(var r=0;r<t.constraintCount;r++)n.constraints.push(e())};return function(){var e=n.metadata;if(e.magic=i.getChars(3),"Pmd"!==e.magic)throw"PMD file magic is not Pmd, but "+e.magic;e.version=i.getFloat32(),e.modelName=i.getSjisStringsAsUnicode(20),e.comment=i.getSjisStringsAsUnicode(256)}(),o(),a(),s(),l(),c(),u(),h(),d(),f(),p(),m(),g(),A(),v(),y(),x(),!0===t&&this.leftToRightModel(n),n},i.prototype.parsePmx=function(e,t){var n={},i=new r(e);n.metadata={},n.metadata.format="pmx",n.metadata.coordinateSystem="left";var o=function(){var e=function(){var e={};e.position=i.getFloat32Array(3),e.normal=i.getFloat32Array(3),e.uv=i.getFloat32Array(2),e.auvs=[];for(var r=0;r<n.metadata.additionalUvNum;r++)e.auvs.push(i.getFloat32Array(4));e.type=i.getUint8();var o=t.boneIndexSize;if(0===e.type)e.skinIndices=i.getIndexArray(o,1),e.skinWeights=[1];else if(1===e.type)e.skinIndices=i.getIndexArray(o,2),e.skinWeights=i.getFloat32Array(1),e.skinWeights.push(1-e.skinWeights[0]);else if(2===e.type)e.skinIndices=i.getIndexArray(o,4),e.skinWeights=i.getFloat32Array(4);else{if(3!==e.type)throw"unsupport bone type "+e.type+" exception.";e.skinIndices=i.getIndexArray(o,2),e.skinWeights=i.getFloat32Array(1),e.skinWeights.push(1-e.skinWeights[0]),e.skinC=i.getFloat32Array(3),e.skinR0=i.getFloat32Array(3),e.skinR1=i.getFloat32Array(3),e.type=1}return e.edgeRatio=i.getFloat32(),e},t=n.metadata;t.vertexCount=i.getUint32(),n.vertices=[];for(var r=0;r<t.vertexCount;r++)n.vertices.push(e())},a=function(){var e=function(){var e={};return e.indices=i.getIndexArray(t.vertexIndexSize,3,!0),e},t=n.metadata;t.faceCount=i.getUint32()/3,n.faces=[];for(var r=0;r<t.faceCount;r++)n.faces.push(e())},s=function(){var e=function(){return i.getTextBuffer()},t=n.metadata;t.textureCount=i.getUint32(),n.textures=[];for(var r=0;r<t.textureCount;r++)n.textures.push(e())},l=function(){var e=function(){var e={};if(e.name=i.getTextBuffer(),e.englishName=i.getTextBuffer(),e.diffuse=i.getFloat32Array(4),e.specular=i.getFloat32Array(3),e.shininess=i.getFloat32(),e.ambient=i.getFloat32Array(3),e.flag=i.getUint8(),e.edgeColor=i.getFloat32Array(4),e.edgeSize=i.getFloat32(),e.textureIndex=i.getIndex(n.metadata.textureIndexSize),e.envTextureIndex=i.getIndex(n.metadata.textureIndexSize),e.envFlag=i.getUint8(),e.toonFlag=i.getUint8(),0===e.toonFlag)e.toonIndex=i.getIndex(n.metadata.textureIndexSize);else{if(1!==e.toonFlag)throw"unknown toon flag "+e.toonFlag+" exception.";e.toonIndex=i.getInt8()}return e.comment=i.getTextBuffer(),e.faceCount=i.getUint32()/3,e},t=n.metadata;t.materialCount=i.getUint32(),n.materials=[];for(var r=0;r<t.materialCount;r++)n.materials.push(e())},c=function(){var e=function(){var e={};if(e.name=i.getTextBuffer(),e.englishName=i.getTextBuffer(),e.position=i.getFloat32Array(3),e.parentIndex=i.getIndex(n.metadata.boneIndexSize),e.transformationClass=i.getUint32(),e.flag=i.getUint16(),1&e.flag?e.connectIndex=i.getIndex(n.metadata.boneIndexSize):e.offsetPosition=i.getFloat32Array(3),256&e.flag||512&e.flag){var t={};t.isLocal=0!==(128&e.flag),t.affectRotation=0!==(256&e.flag),t.affectPosition=0!==(512&e.flag),t.parentIndex=i.getIndex(n.metadata.boneIndexSize),t.ratio=i.getFloat32(),e.grant=t}if(1024&e.flag&&(e.fixAxis=i.getFloat32Array(3)),2048&e.flag&&(e.localXVector=i.getFloat32Array(3),e.localZVector=i.getFloat32Array(3)),8192&e.flag&&(e.key=i.getUint32()),32&e.flag){var r={};r.effector=i.getIndex(n.metadata.boneIndexSize),r.target=null,r.iteration=i.getUint32(),r.maxAngle=i.getFloat32(),r.linkCount=i.getUint32(),r.links=[];for(var o=0;o<r.linkCount;o++){var a={};a.index=i.getIndex(n.metadata.boneIndexSize),a.angleLimitation=i.getUint8(),1===a.angleLimitation&&(a.lowerLimitationAngle=i.getFloat32Array(3),a.upperLimitationAngle=i.getFloat32Array(3)),r.links.push(a)}e.ik=r}return e},t=n.metadata;t.boneCount=i.getUint32(),n.bones=[];for(var r=0;r<t.boneCount;r++)n.bones.push(e())},u=function(){var e=function(){var e={};e.name=i.getTextBuffer(),e.englishName=i.getTextBuffer(),e.panel=i.getUint8(),e.type=i.getUint8(),e.elementCount=i.getUint32(),e.elements=[];for(var t=0;t<e.elementCount;t++)if(0===e.type)(r={}).index=i.getIndex(n.metadata.morphIndexSize),r.ratio=i.getFloat32(),e.elements.push(r);else if(1===e.type)(r={}).index=i.getIndex(n.metadata.vertexIndexSize,!0),r.position=i.getFloat32Array(3),e.elements.push(r);else if(2===e.type)(r={}).index=i.getIndex(n.metadata.boneIndexSize),r.position=i.getFloat32Array(3),r.rotation=i.getFloat32Array(4),e.elements.push(r);else if(3===e.type)(r={}).index=i.getIndex(n.metadata.vertexIndexSize,!0),r.uv=i.getFloat32Array(4),e.elements.push(r);else if(4===e.type);else if(5===e.type);else if(6===e.type);else if(7===e.type);else if(8===e.type){var r;(r={}).index=i.getIndex(n.metadata.materialIndexSize),r.type=i.getUint8(),r.diffuse=i.getFloat32Array(4),r.specular=i.getFloat32Array(3),r.shininess=i.getFloat32(),r.ambient=i.getFloat32Array(3),r.edgeColor=i.getFloat32Array(4),r.edgeSize=i.getFloat32(),r.textureColor=i.getFloat32Array(4),r.sphereTextureColor=i.getFloat32Array(4),r.toonColor=i.getFloat32Array(4),e.elements.push(r)}return e},t=n.metadata;t.morphCount=i.getUint32(),n.morphs=[];for(var r=0;r<t.morphCount;r++)n.morphs.push(e())},h=function(){var e=function(){var e={};e.name=i.getTextBuffer(),e.englishName=i.getTextBuffer(),e.type=i.getUint8(),e.elementCount=i.getUint32(),e.elements=[];for(var t=0;t<e.elementCount;t++){var r={};r.target=i.getUint8(),r.index=0===r.target?i.getIndex(n.metadata.boneIndexSize):i.getIndex(n.metadata.morphIndexSize),e.elements.push(r)}return e},t=n.metadata;t.frameCount=i.getUint32(),n.frames=[];for(var r=0;r<t.frameCount;r++)n.frames.push(e())},d=function(){var e=function(){var e={};return e.name=i.getTextBuffer(),e.englishName=i.getTextBuffer(),e.boneIndex=i.getIndex(n.metadata.boneIndexSize),e.groupIndex=i.getUint8(),e.groupTarget=i.getUint16(),e.shapeType=i.getUint8(),e.width=i.getFloat32(),e.height=i.getFloat32(),e.depth=i.getFloat32(),e.position=i.getFloat32Array(3),e.rotation=i.getFloat32Array(3),e.weight=i.getFloat32(),e.positionDamping=i.getFloat32(),e.rotationDamping=i.getFloat32(),e.restitution=i.getFloat32(),e.friction=i.getFloat32(),e.type=i.getUint8(),e},t=n.metadata;t.rigidBodyCount=i.getUint32(),n.rigidBodies=[];for(var r=0;r<t.rigidBodyCount;r++)n.rigidBodies.push(e())},f=function(){var e=function(){var e={};return e.name=i.getTextBuffer(),e.englishName=i.getTextBuffer(),e.type=i.getUint8(),e.rigidBodyIndex1=i.getIndex(n.metadata.rigidBodyIndexSize),e.rigidBodyIndex2=i.getIndex(n.metadata.rigidBodyIndexSize),e.position=i.getFloat32Array(3),e.rotation=i.getFloat32Array(3),e.translationLimitation1=i.getFloat32Array(3),e.translationLimitation2=i.getFloat32Array(3),e.rotationLimitation1=i.getFloat32Array(3),e.rotationLimitation2=i.getFloat32Array(3),e.springPosition=i.getFloat32Array(3),e.springRotation=i.getFloat32Array(3),e},t=n.metadata;t.constraintCount=i.getUint32(),n.constraints=[];for(var r=0;r<t.constraintCount;r++)n.constraints.push(e())};return function(){var e=n.metadata;if(e.magic=i.getChars(4),"PMX "!==e.magic)throw"PMX file magic is not PMX , but "+e.magic;if(e.version=i.getFloat32(),2!==e.version&&2.1!==e.version)throw"PMX version "+e.version+" is not supported.";e.headerSize=i.getUint8(),e.encoding=i.getUint8(),e.additionalUvNum=i.getUint8(),e.vertexIndexSize=i.getUint8(),e.textureIndexSize=i.getUint8(),e.materialIndexSize=i.getUint8(),e.boneIndexSize=i.getUint8(),e.morphIndexSize=i.getUint8(),e.rigidBodyIndexSize=i.getUint8(),e.modelName=i.getTextBuffer(),e.englishModelName=i.getTextBuffer(),e.comment=i.getTextBuffer(),e.englishComment=i.getTextBuffer()}(),o(),a(),s(),l(),c(),u(),h(),d(),f(),!0===t&&this.leftToRightModel(n),n},i.prototype.parseVmd=function(e,t){var n={},i=new r(e);n.metadata={},n.metadata.coordinateSystem="left";var o=function(){var e=function(){var e={};return e.boneName=i.getSjisStringsAsUnicode(15),e.frameNum=i.getUint32(),e.position=i.getFloat32Array(3),e.rotation=i.getFloat32Array(4),e.interpolation=i.getUint8Array(64),e},t=n.metadata;t.motionCount=i.getUint32(),n.motions=[];for(var r=0;r<t.motionCount;r++)n.motions.push(e())},a=function(){var e=function(){var e={};return e.morphName=i.getSjisStringsAsUnicode(15),e.frameNum=i.getUint32(),e.weight=i.getFloat32(),e},t=n.metadata;t.morphCount=i.getUint32(),n.morphs=[];for(var r=0;r<t.morphCount;r++)n.morphs.push(e())},s=function(){var e=function(){var e={};return e.frameNum=i.getUint32(),e.distance=i.getFloat32(),e.position=i.getFloat32Array(3),e.rotation=i.getFloat32Array(3),e.interpolation=i.getUint8Array(24),e.fov=i.getUint32(),e.perspective=i.getUint8(),e},t=n.metadata;t.cameraCount=i.getUint32(),n.cameras=[];for(var r=0;r<t.cameraCount;r++)n.cameras.push(e())};return function(){var e=n.metadata;if(e.magic=i.getChars(30),"Vocaloid Motion Data 0002"!==e.magic)throw"VMD file magic is not Vocaloid Motion Data 0002, but "+e.magic;e.name=i.getSjisStringsAsUnicode(20)}(),o(),a(),s(),!0===t&&this.leftToRightVmd(n),n},i.prototype.parseVpd=function(e,t){var r={metadata:{}};r.metadata.coordinateSystem="left",r.bones=[];var n=/\/\/\w*(\r|\n|\r\n)/g,i=/\r|\n|\r\n/,o=e.replace(n,"").split(i);function a(){throw"the file seems not vpd file."}function s(){"Vocaloid Pose Data file"!==o[0]&&a()}function l(){o.length<4&&a(),r.metadata.parentFile=o[2],r.metadata.boneCount=parseInt(o[3])}function c(){for(var e=/^\s*(Bone[0-9]+)\s*\{\s*(.*)$/,t=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,n=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,i=/^\s*}/,s=r.bones,l=null,c=null,u=null,h=4;h<o.length;h++){var d,f=o[h];null!==(d=f.match(e))&&(null!==l&&a(),l=d[2]),null!==(d=f.match(t))&&(null!==c&&a(),c=[parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])]),null!==(d=f.match(n))&&(null!==u&&a(),u=[parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]),parseFloat(d[4])]),null!==(d=f.match(i))&&(null!==l&&null!==c&&null!==u||a(),s.push({name:l,translation:c,quaternion:u}),l=null,c=null,u=null)}null===l&&null===c&&null===u||a()}return s(),l(),c(),!0===t&&this.leftToRightVpd(r),r},i.prototype.mergeVmds=function(e){var t={metadata:{}};t.metadata.name=e[0].metadata.name,t.metadata.coordinateSystem=e[0].metadata.coordinateSystem,t.metadata.motionCount=0,t.metadata.morphCount=0,t.metadata.cameraCount=0,t.motions=[],t.morphs=[],t.cameras=[];for(var r=0;r<e.length;r++){var n=e[r];t.metadata.motionCount+=n.metadata.motionCount,t.metadata.morphCount+=n.metadata.morphCount,t.metadata.cameraCount+=n.metadata.cameraCount;for(var i=0;i<n.metadata.motionCount;i++)t.motions.push(n.motions[i]);for(i=0;i<n.metadata.morphCount;i++)t.morphs.push(n.morphs[i]);for(i=0;i<n.metadata.cameraCount;i++)t.cameras.push(n.cameras[i])}return t},i.prototype.leftToRightModel=function(e){if("right"!==e.metadata.coordinateSystem){e.metadata.coordinateSystem="right";for(var t=new n,r=0;r<e.metadata.vertexCount;r++)t.leftToRightVector3(e.vertices[r].position),t.leftToRightVector3(e.vertices[r].normal);for(r=0;r<e.metadata.faceCount;r++)t.leftToRightIndexOrder(e.faces[r].indices);for(r=0;r<e.metadata.boneCount;r++)t.leftToRightVector3(e.bones[r].position);for(r=0;r<e.metadata.morphCount;r++){var i=e.morphs[r];if("pmx"!==e.metadata.format||1===i.type)for(var o=0;o<i.elements.length;o++)t.leftToRightVector3(i.elements[o].position)}for(r=0;r<e.metadata.rigidBodyCount;r++)t.leftToRightVector3(e.rigidBodies[r].position),t.leftToRightEuler(e.rigidBodies[r].rotation);for(r=0;r<e.metadata.constraintCount;r++)t.leftToRightVector3(e.constraints[r].position),t.leftToRightEuler(e.constraints[r].rotation),t.leftToRightVector3Range(e.constraints[r].translationLimitation1,e.constraints[r].translationLimitation2),t.leftToRightEulerRange(e.constraints[r].rotationLimitation1,e.constraints[r].rotationLimitation2)}},i.prototype.leftToRightVmd=function(e){if("right"!==e.metadata.coordinateSystem){e.metadata.coordinateSystem="right";for(var t=new n,r=0;r<e.metadata.motionCount;r++)t.leftToRightVector3(e.motions[r].position),t.leftToRightQuaternion(e.motions[r].rotation);for(r=0;r<e.metadata.cameraCount;r++)t.leftToRightVector3(e.cameras[r].position),t.leftToRightEuler(e.cameras[r].rotation)}},i.prototype.leftToRightVpd=function(e){if("right"!==e.metadata.coordinateSystem){e.metadata.coordinateSystem="right";for(var t=new n,r=0;r<e.bones.length;r++)t.leftToRightVector3(e.bones[r].translation),t.leftToRightQuaternion(e.bones[r].quaternion)}};var o={CharsetEncoder:t,Parser:i};e.MMDParser=o,e.CharsetEncoder=t,e.Parser=i,Object.defineProperty(e,"__esModule",{value:!0})}(t)},4284:function(e,t,r){"use strict";var n,i;e.exports=(null===(n=r.g.process)||void 0===n?void 0:n.env)&&"object"===typeof(null===(i=r.g.process)||void 0===i?void 0:i.env)?r.g.process:r(6118)},2241:function(e){!function(){var t={991:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,o=l(e),a=o[0],s=o[1],c=new i(function(e,t,r){return 3*(t+r)/4-r}(0,a,s)),u=0,h=s>0?a-4:a;for(r=0;r<h;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;2===s&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[u++]=255&t);1===s&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],a=16383,s=0,l=n-i;s<l;s+=a)o.push(u(e,s,s+a>l?l:s+a));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],n=[],i="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=o.length;a<s;++a)r[a]=o[a],n[o.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[63&e]}function u(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(c(n));return i.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},293:function(e,t,r){"use strict";var n=r(991),i=r(759),o="function"===typeof Symbol&&"function"===typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50;var a=2147483647;function s(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,r){if("number"===typeof e){if("string"===typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return c(e,t,r)}function c(e,t,r){if("string"===typeof e)return function(e,t){"string"===typeof t&&""!==t||(t="utf8");if(!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|m(e,t),n=s(r),i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t);if(ArrayBuffer.isView(e))return d(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return f(e,t,r);if("undefined"!==typeof SharedArrayBuffer&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return f(e,t,r);if("number"===typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return l.from(n,t,r);var i=function(e){if(l.isBuffer(e)){var t=0|p(e.length),r=s(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!==typeof e.length||z(e.length)?s(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(i)return i;if("undefined"!==typeof Symbol&&null!=Symbol.toPrimitive&&"function"===typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!==typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),s(e<0?0:0|p(e))}function d(e){for(var t=e.length<0?0:0|p(e.length),r=s(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function f(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,l.prototype),n}function p(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function m(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!==typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Q(e).length;default:if(i)return n?-1:U(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return F(this,t,r);case"utf8":case"utf-8":return M(this,t,r);case"ascii":return B(this,t,r);case"latin1":case"binary":return _(this,t,r);case"base64":return T(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function A(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function v(e,t,r,n,i){if(0===e.length)return-1;if("string"===typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),z(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"===typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"===typeof t)return t&=255,"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var o,a=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var u=-1;for(o=r;o<s;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*a}else-1!==u&&(o-=o-u),u=-1}else for(r+l>s&&(r=s-l),o=r;o>=0;o--){for(var h=!0,d=0;d<l;d++)if(c(e,o+d)!==c(t,d)){h=!1;break}if(h)return o}return-1}function x(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(z(s))return a;e[r+a]=s}return a}function b(e,t,r,n){return V(U(t,e.length-r),e,r,n)}function w(e,t,r,n){return V(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function C(e,t,r,n){return w(e,t,r,n)}function E(e,t,r,n){return V(Q(t),e,r,n)}function S(e,t,r,n){return V(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=(r=e.charCodeAt(a))>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function T(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function M(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,l,c=e[i],u=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(u=c);break;case 2:128===(192&(o=e[i+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=e[i+1],a=e[i+2],128===(192&o)&&128===(192&a)&&(l=(15&c)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128===(192&o)&&128===(192&a)&&128===(192&s)&&(l=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=h}return I(n)}t.kMaxLength=a,l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"===typeof console||"function"!==typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,r){return c(e,t,r)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,r){return function(e,t,r){return u(e),e<=0?s(e):void 0!==t?"string"===typeof r?s(e).fill(t,r):s(e).fill(t):s(e)}(e,t,r)},l.allocUnsafe=function(e){return h(e)},l.allocUnsafeSlow=function(e){return h(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(G(o,Uint8Array)&&(o=l.from(o)),!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},l.byteLength=m,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)A(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)A(this,t,t+3),A(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)A(this,t,t+7),A(this,t+1,t+6),A(this,t+2,t+5),A(this,t+3,t+4);return this},l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?M(this,0,e):g.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(e,t,r,n,i){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(o,a),c=this.slice(n,i),u=e.slice(t,r),h=0;h<s;++h)if(c[h]!==u[h]){o=c[h],a=u[h];break}return o<a?-1:a<o?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return v(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return v(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"===typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return x(this,e,t,r);case"utf8":case"utf-8":return b(this,e,t,r);case"ascii":return w(this,e,t,r);case"latin1":case"binary":return C(this,e,t,r);case"base64":return E(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function I(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}function B(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function _(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function F(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=j[e[o]];return i}function P(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function R(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,r,n,i,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function D(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function N(e,t,r,n,o){return t=+t,r>>>=0,o||D(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function k(e,t,r,n,o){return t=+t,r>>>=0,o||D(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,l.prototype),n},l.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},l.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||R(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){e>>>=0,t||R(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||R(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||R(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||R(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||R(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||L(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||L(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||L(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||L(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||L(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||L(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||L(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||L(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||L(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||L(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||L(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,r){return N(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return N(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return k(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return k(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"===typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var o=i-1;o>=0;--o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},l.prototype.fill=function(e,t,r,n){if("string"===typeof e){if("string"===typeof t?(n=t,t=0,r=this.length):"string"===typeof r&&(n=r,r=this.length),void 0!==n&&"string"!==typeof n)throw new TypeError("encoding must be a string");if("string"===typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"===typeof e?e&=255:"boolean"===typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"===typeof e)for(o=t;o<r;++o)this[o]=e;else{var a=l.isBuffer(e)?e:l.from(e,n),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<r-t;++o)this[o+t]=a[o%s]}return this};var O=/[^+/0-9A-Za-z-_]/g;function U(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Q(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(O,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function V(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function z(e){return e!==e}var j=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},759:function(e,t){t.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,l=(1<<s)-1,c=l>>1,u=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,o=f&(1<<-u)-1,f>>=-u,u+=s;u>0;o=256*o+e[t+h],h+=d,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=n;u>0;a=256*a+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=c}return(f?-1:1)*a*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var a,s,l,c=8*o-i-1,u=(1<<c)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=u?(s=0,a=u):a+h>=1?(s=(t*l-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&s,f+=p,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[r+f]=255&a,f+=p,a/=256,c-=8);e[r+f-p]|=128*m}}},r={};function n(e){var i=r[e];if(void 0!==i)return i.exports;var o=r[e]={exports:{}},a=!0;try{t[e](o,o.exports,n),a=!1}finally{a&&delete r[e]}return o.exports}n.ab="//";var i=n(293);e.exports=i}()},6118:function(e){!function(){var t={162:function(e){var t,r,n=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"===typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var s,l=[],c=!1,u=-1;function h(){c&&s&&(c=!1,s.length?l=s.concat(l):u=-1,l.length&&d())}function d(){if(!c){var e=a(h);c=!0;for(var t=l.length;t;){for(s=l,l=[];++u<t;)s&&s[u].run();u=-1,t=l.length}s=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new f(e,t)),1!==l.length||c||a(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function n(e){var i=r[e];if(void 0!==i)return i.exports;var o=r[e]={exports:{}},a=!0;try{t[e](o,o.exports,n),a=!1}finally{a&&delete r[e]}return o.exports}n.ab="//";var i=n(162);e.exports=i}()},8772:function(e,t,r){"use strict";var n=r(331);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,r,i,o,a){if(a!==n){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return r.PropTypes=r,r}},3615:function(e,t,r){e.exports=r(8772)()},331:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},8891:function(e,t,r){"use strict";const n=r(9742),i=r(1998),o=r(9400),a=r(7728),s=Symbol("encodeFragmentIdentifier");function l(e){if("string"!==typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function c(e,t){return t.encode?t.strict?n(e):encodeURIComponent(e):e}function u(e,t){return t.decode?i(e):e}function h(e){return Array.isArray(e)?e.sort():"object"===typeof e?h(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function d(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function f(e){const t=(e=d(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function p(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"===typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function m(e,t){l((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,n)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===n[e]&&(n[e]={}),n[e][t[1]]=r):n[e]=r};case"bracket":return(e,r,n)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],r):n[e]=[r]:n[e]=r};case"colon-list-separator":return(e,r,n)=>{t=/(:list)$/.exec(e),e=e.replace(/:list$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],r):n[e]=[r]:n[e]=r};case"comma":case"separator":return(t,r,n)=>{const i="string"===typeof r&&r.includes(e.arrayFormatSeparator),o="string"===typeof r&&!i&&u(r,e).includes(e.arrayFormatSeparator);r=o?u(r,e):r;const a=i||o?r.split(e.arrayFormatSeparator).map((t=>u(t,e))):null===r?r:u(r,e);n[t]=a};case"bracket-separator":return(t,r,n)=>{const i=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!i)return void(n[t]=r?u(r,e):r);const o=null===r?[]:r.split(e.arrayFormatSeparator).map((t=>u(t,e)));void 0!==n[t]?n[t]=[].concat(n[t],o):n[t]=o};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[].concat(r[e],t):r[e]=t}}}(t),n=Object.create(null);if("string"!==typeof e)return n;if(!(e=e.trim().replace(/^[?#&]/,"")))return n;for(const i of e.split("&")){if(""===i)continue;let[e,a]=o(t.decode?i.replace(/\+/g," "):i,"=");a=void 0===a?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?a:u(a,t),r(u(e,t),a,n)}for(const i of Object.keys(n)){const e=n[i];if("object"===typeof e&&null!==e)for(const r of Object.keys(e))e[r]=p(e[r],t);else n[i]=p(e,t)}return!1===t.sort?n:(!0===t.sort?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce(((e,t)=>{const r=n[t];return Boolean(r)&&"object"===typeof r&&!Array.isArray(r)?e[t]=h(r):e[t]=r,e}),Object.create(null))}t.extract=f,t.parse=m,t.stringify=(e,t)=>{if(!e)return"";l((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const r=r=>{return t.skipNull&&(null===(n=e[r])||void 0===n)||t.skipEmptyString&&""===e[r];var n},n=function(e){switch(e.arrayFormat){case"index":return t=>(r,n)=>{const i=r.length;return void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[c(t,e),"[",i,"]"].join("")]:[...r,[c(t,e),"[",c(i,e),"]=",c(n,e)].join("")]};case"bracket":return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[c(t,e),"[]"].join("")]:[...r,[c(t,e),"[]=",c(n,e)].join("")];case"colon-list-separator":return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[c(t,e),":list="].join("")]:[...r,[c(t,e),":list=",c(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return r=>(n,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?n:(i=null===i?"":i,0===n.length?[[c(r,e),t,c(i,e)].join("")]:[[n,c(i,e)].join(e.arrayFormatSeparator)])}default:return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,c(t,e)]:[...r,[c(t,e),"=",c(n,e)].join("")]}}(t),i={};for(const a of Object.keys(e))r(a)||(i[a]=e[a]);const o=Object.keys(i);return!1!==t.sort&&o.sort(t.sort),o.map((r=>{const i=e[r];return void 0===i?"":null===i?c(r,t):Array.isArray(i)?0===i.length&&"bracket-separator"===t.arrayFormat?c(r,t)+"[]":i.reduce(n(r),[]).join("&"):c(r,t)+"="+c(i,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[r,n]=o(e,"#");return Object.assign({url:r.split("?")[0]||"",query:m(f(e),t)},t&&t.parseFragmentIdentifier&&n?{fragmentIdentifier:u(n,t)}:{})},t.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[s]:!0},r);const n=d(e.url).split("?")[0]||"",i=t.extract(e.url),o=t.parse(i,{sort:!1}),a=Object.assign(o,e.query);let l=t.stringify(a,r);l&&(l=`?${l}`);let u=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);return e.fragmentIdentifier&&(u=`#${r[s]?c(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${n}${l}${u}`},t.pick=(e,r,n)=>{n=Object.assign({parseFragmentIdentifier:!0,[s]:!1},n);const{url:i,query:o,fragmentIdentifier:l}=t.parseUrl(e,n);return t.stringifyUrl({url:i,query:a(o,r),fragmentIdentifier:l},n)},t.exclude=(e,r,n)=>{const i=Array.isArray(r)?e=>!r.includes(e):(e,t)=>!r(e,t);return t.pick(e,i,n)}},5324:function(e,t){"use strict";t.Z=function(e){return function(t){e.forEach((function(e){"function"===typeof e?e(t):null!=e&&(e.current=t)}))}}},9096:function(e,t,r){(e=r.nmd(e)).exports=function(t){var n={},i=r(6493),o=r(7378),a=r(1102);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,c=60103,u=60106,h=60107,d=60108,f=60114,p=60109,m=60110,g=60112,A=60113,v=60120,y=60115,x=60116,b=60121,w=60129,C=60130,E=60131;if("function"===typeof Symbol&&Symbol.for){var S=Symbol.for;c=S("react.element"),u=S("react.portal"),h=S("react.fragment"),d=S("react.strict_mode"),f=S("react.profiler"),p=S("react.provider"),m=S("react.context"),g=S("react.forward_ref"),A=S("react.suspense"),v=S("react.suspense_list"),y=S("react.memo"),x=S("react.lazy"),b=S("react.block"),S("react.scope"),w=S("react.debug_trace_mode"),C=S("react.offscreen"),E=S("react.legacy_hidden")}var T="function"===typeof Symbol&&Symbol.iterator;function M(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=T&&e[T]||e["@@iterator"])?e:null}function I(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case h:return"Fragment";case u:return"Portal";case f:return"Profiler";case d:return"StrictMode";case A:return"Suspense";case v:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case m:return(e.displayName||"Context")+".Consumer";case p:return(e._context.displayName||"Context")+".Provider";case g:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case y:return I(e.type);case b:return I(e._render);case x:t=e._payload,e=e._init;try{return I(e(t))}catch(r){}}return null}function B(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function _(e){if(B(e)!==e)throw Error(s(188))}function F(e){var t=e.alternate;if(!t){if(null===(t=B(e)))throw Error(s(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(n=i.return)){r=n;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===r)return _(i),e;if(o===n)return _(i),t;o=o.sibling}throw Error(s(188))}if(r.return!==n.return)r=i,n=o;else{for(var a=!1,l=i.child;l;){if(l===r){a=!0,r=i,n=o;break}if(l===n){a=!0,n=i,r=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===r){a=!0,r=o,n=i;break}if(l===n){a=!0,n=o,r=i;break}l=l.sibling}if(!a)throw Error(s(189))}}if(r.alternate!==n)throw Error(s(190))}if(3!==r.tag)throw Error(s(188));return r.stateNode.current===r?e:t}function P(e){if(!(e=F(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function R(e,t){for(var r=e.alternate;null!==t;){if(t===e||t===r)return!0;t=t.return}return!1}var L,D=t.getPublicInstance,N=t.getRootHostContext,k=t.getChildHostContext,O=t.prepareForCommit,U=t.resetAfterCommit,Q=t.createInstance,V=t.appendInitialChild,G=t.finalizeInitialChildren,z=t.prepareUpdate,j=t.shouldSetTextContent,H=t.createTextInstance,W=t.scheduleTimeout,Z=t.cancelTimeout,X=t.noTimeout,Y=t.isPrimaryRenderer,J=t.supportsMutation,q=t.supportsPersistence,K=t.supportsHydration,$=t.getInstanceFromNode,ee=t.makeOpaqueHydratingObject,te=t.makeClientId,re=t.beforeActiveInstanceBlur,ne=t.afterActiveInstanceBlur,ie=t.preparePortalMount,oe=t.supportsTestSelectors,ae=t.findFiberRoot,se=t.getBoundingRect,le=t.getTextContent,ce=t.isHiddenSubtree,ue=t.matchAccessibilityRole,he=t.setFocusIfFocusable,de=t.setupIntersectionObserver,fe=t.appendChild,pe=t.appendChildToContainer,me=t.commitTextUpdate,ge=t.commitMount,Ae=t.commitUpdate,ve=t.insertBefore,ye=t.insertInContainerBefore,xe=t.removeChild,be=t.removeChildFromContainer,we=t.resetTextContent,Ce=t.hideInstance,Ee=t.hideTextInstance,Se=t.unhideInstance,Te=t.unhideTextInstance,Me=t.clearContainer,Ie=t.cloneInstance,Be=t.createContainerChildSet,_e=t.appendChildToContainerChildSet,Fe=t.finalizeContainerChildren,Pe=t.replaceContainerChildren,Re=t.cloneHiddenInstance,Le=t.cloneHiddenTextInstance,De=t.canHydrateInstance,Ne=t.canHydrateTextInstance,ke=t.isSuspenseInstancePending,Oe=t.isSuspenseInstanceFallback,Ue=t.getNextHydratableSibling,Qe=t.getFirstHydratableChild,Ve=t.hydrateInstance,Ge=t.hydrateTextInstance,ze=t.getNextHydratableInstanceAfterSuspenseInstance,je=t.commitHydratedContainer,He=t.commitHydratedSuspenseInstance;function We(e){if(void 0===L)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var Ze=!1;function Xe(e,t){if(!e||Ze)return"";Ze=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var n=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){n=l}e.call(t.prototype)}else{try{throw Error()}catch(l){n=l}e()}}catch(l){if(l&&n&&"string"===typeof l.stack){for(var i=l.stack.split("\n"),o=n.stack.split("\n"),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||i[a]!==o[s])return"\n"+i[a].replace(" at new "," at ")}while(1<=a&&0<=s);break}}}finally{Ze=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?We(e):""}var Ye=[],Je=-1;function qe(e){return{current:e}}function Ke(e){0>Je||(e.current=Ye[Je],Ye[Je]=null,Je--)}function $e(e,t){Je++,Ye[Je]=e.current,e.current=t}var et={},tt=qe(et),rt=qe(!1),nt=et;function it(e,t){var r=e.type.contextTypes;if(!r)return et;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in r)o[i]=t[i];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function ot(e){return null!==(e=e.childContextTypes)&&void 0!==e}function at(){Ke(rt),Ke(tt)}function st(e,t,r){if(tt.current!==et)throw Error(s(168));$e(tt,t),$e(rt,r)}function lt(e,t,r){var n=e.stateNode;if(e=t.childContextTypes,"function"!==typeof n.getChildContext)return r;for(var o in n=n.getChildContext())if(!(o in e))throw Error(s(108,I(t)||"Unknown",o));return i({},r,n)}function ct(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||et,nt=tt.current,$e(tt,e),$e(rt,rt.current),!0}function ut(e,t,r){var n=e.stateNode;if(!n)throw Error(s(169));r?(e=lt(e,t,nt),n.__reactInternalMemoizedMergedChildContext=e,Ke(rt),Ke(tt),$e(tt,e)):Ke(rt),$e(rt,r)}var ht=null,dt=null;(0,a.unstable_now)();var ft=0,pt=8;function mt(e){if(0!==(1&e))return pt=15,1;if(0!==(2&e))return pt=14,2;if(0!==(4&e))return pt=13,4;var t=24&e;return 0!==t?(pt=12,t):0!==(32&e)?(pt=11,32):0!==(t=192&e)?(pt=10,t):0!==(256&e)?(pt=9,256):0!==(t=3584&e)?(pt=8,t):0!==(4096&e)?(pt=7,4096):0!==(t=4186112&e)?(pt=6,t):0!==(t=62914560&e)?(pt=5,t):67108864&e?(pt=4,67108864):0!==(134217728&e)?(pt=3,134217728):0!==(t=805306368&e)?(pt=2,t):0!==(1073741824&e)?(pt=1,1073741824):(pt=8,e)}function gt(e,t){var r=e.pendingLanes;if(0===r)return pt=0;var n=0,i=0,o=e.expiredLanes,a=e.suspendedLanes,s=e.pingedLanes;if(0!==o)n=o,i=pt=15;else if(0!==(o=134217727&r)){var l=o&~a;0!==l?(n=mt(l),i=pt):0!==(s&=o)&&(n=mt(s),i=pt)}else 0!==(o=r&~a)?(n=mt(o),i=pt):0!==s&&(n=mt(s),i=pt);if(0===n)return 0;if(n=r&((0>(n=31-wt(n))?0:1<<n)<<1)-1,0!==t&&t!==n&&0===(t&a)){if(mt(t),i<=pt)return t;pt=i}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)i=1<<(r=31-wt(t)),n|=e[r],t&=~i;return n}function At(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=yt(24&~t))?vt(10,t):e;case 10:return 0===(e=yt(192&~t))?vt(8,t):e;case 8:return 0===(e=yt(3584&~t))&&(0===(e=yt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=yt(805306368&~t))&&(t=268435456),t}throw Error(s(358,e))}function yt(e){return e&-e}function xt(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function bt(e,t,r){e.pendingLanes|=t;var n=t-1;e.suspendedLanes&=n,e.pingedLanes&=n,(e=e.eventTimes)[t=31-wt(t)]=r}var wt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Ct(e)/Et|0)|0},Ct=Math.log,Et=Math.LN2;var St=a.unstable_runWithPriority,Tt=a.unstable_scheduleCallback,Mt=a.unstable_cancelCallback,It=a.unstable_shouldYield,Bt=a.unstable_requestPaint,_t=a.unstable_now,Ft=a.unstable_getCurrentPriorityLevel,Pt=a.unstable_ImmediatePriority,Rt=a.unstable_UserBlockingPriority,Lt=a.unstable_NormalPriority,Dt=a.unstable_LowPriority,Nt=a.unstable_IdlePriority,kt={},Ot=void 0!==Bt?Bt:function(){},Ut=null,Qt=null,Vt=!1,Gt=_t(),zt=1e4>Gt?_t:function(){return _t()-Gt};function jt(){switch(Ft()){case Pt:return 99;case Rt:return 98;case Lt:return 97;case Dt:return 96;case Nt:return 95;default:throw Error(s(332))}}function Ht(e){switch(e){case 99:return Pt;case 98:return Rt;case 97:return Lt;case 96:return Dt;case 95:return Nt;default:throw Error(s(332))}}function Wt(e,t){return e=Ht(e),St(e,t)}function Zt(e,t,r){return e=Ht(e),Tt(e,t,r)}function Xt(){if(null!==Qt){var e=Qt;Qt=null,Mt(e)}Yt()}function Yt(){if(!Vt&&null!==Ut){Vt=!0;var e=0;try{var t=Ut;Wt(99,(function(){for(;e<t.length;e++){var r=t[e];do{r=r(!0)}while(null!==r)}})),Ut=null}catch(r){throw null!==Ut&&(Ut=Ut.slice(e+1)),Tt(Pt,Xt),r}finally{Vt=!1}}}var Jt=l.ReactCurrentBatchConfig;var qt="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Kt=Object.prototype.hasOwnProperty;function $t(e,t){if(qt(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++)if(!Kt.call(t,r[n])||!qt(e[r[n]],t[r[n]]))return!1;return!0}function er(e){switch(e.tag){case 5:return We(e.type);case 16:return We("Lazy");case 13:return We("Suspense");case 19:return We("SuspenseList");case 0:case 2:case 15:return e=Xe(e.type,!1);case 11:return e=Xe(e.type.render,!1);case 22:return e=Xe(e.type._render,!1);case 1:return e=Xe(e.type,!0);default:return""}}function tr(e,t){if(e&&e.defaultProps){for(var r in t=i({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}return t}var rr=qe(null),nr=null,ir=null,or=null;function ar(){or=ir=nr=null}function sr(e,t){e=e.type._context,Y?($e(rr,e._currentValue),e._currentValue=t):($e(rr,e._currentValue2),e._currentValue2=t)}function lr(e){var t=rr.current;Ke(rr),e=e.type._context,Y?e._currentValue=t:e._currentValue2=t}function cr(e,t){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)===t){if(null===r||(r.childLanes&t)===t)break;r.childLanes|=t}else e.childLanes|=t,null!==r&&(r.childLanes|=t);e=e.return}}function ur(e,t){nr=e,or=ir=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Gn=!0),e.firstContext=null)}function hr(e,t){if(or!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(or=e,t=1073741823),t={context:e,observedBits:t,next:null},null===ir){if(null===nr)throw Error(s(308));ir=t,nr.dependencies={lanes:0,firstContext:t,responders:null}}else ir=ir.next=t;return Y?e._currentValue:e._currentValue2}var dr=!1;function fr(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function pr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function gr(e,t){if(null!==(e=e.updateQueue)){var r=(e=e.shared).pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}}function Ar(e,t){var r=e.updateQueue,n=e.alternate;if(null!==n&&r===(n=n.updateQueue)){var i=null,o=null;if(null!==(r=r.firstBaseUpdate)){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};null===o?i=o=a:o=o.next=a,r=r.next}while(null!==r);null===o?i=o=t:o=o.next=t}else i=o=t;return r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:n.shared,effects:n.effects},void(e.updateQueue=r)}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function vr(e,t,r,n){var o=e.updateQueue;dr=!1;var a=o.firstBaseUpdate,s=o.lastBaseUpdate,l=o.shared.pending;if(null!==l){o.shared.pending=null;var c=l,u=c.next;c.next=null,null===s?a=u:s.next=u,s=c;var h=e.alternate;if(null!==h){var d=(h=h.updateQueue).lastBaseUpdate;d!==s&&(null===d?h.firstBaseUpdate=u:d.next=u,h.lastBaseUpdate=c)}}if(null!==a){for(d=o.baseState,s=0,h=u=c=null;;){l=a.lane;var f=a.eventTime;if((n&l)===l){null!==h&&(h=h.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=e,m=a;switch(l=t,f=r,m.tag){case 1:if("function"===typeof(p=m.payload)){d=p.call(f,d,l);break e}d=p;break e;case 3:p.flags=-4097&p.flags|64;case 0:if(null===(l="function"===typeof(p=m.payload)?p.call(f,d,l):p)||void 0===l)break e;d=i({},d,l);break e;case 2:dr=!0}}null!==a.callback&&(e.flags|=32,null===(l=o.effects)?o.effects=[a]:l.push(a))}else f={eventTime:f,lane:l,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===h?(u=h=f,c=d):h=h.next=f,s|=l;if(null===(a=a.next)){if(null===(l=o.shared.pending))break;a=l.next,l.next=null,o.lastBaseUpdate=l,o.shared.pending=null}}null===h&&(c=d),o.baseState=c,o.firstBaseUpdate=u,o.lastBaseUpdate=h,ho|=s,e.lanes=s,e.memoizedState=d}}function yr(e,t,r){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(null!==i){if(n.callback=null,n=r,"function"!==typeof i)throw Error(s(191,i));i.call(n)}}}var xr=(new o.Component).refs;function br(e,t,r,n){r=null===(r=r(n,t=e.memoizedState))||void 0===r?t:i({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}var wr={isMounted:function(e){return!!(e=e._reactInternals)&&B(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=ko(),i=Oo(e),o=mr(n,i);o.payload=t,void 0!==r&&null!==r&&(o.callback=r),gr(e,o),Uo(e,i,n)},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=ko(),i=Oo(e),o=mr(n,i);o.tag=1,o.payload=t,void 0!==r&&null!==r&&(o.callback=r),gr(e,o),Uo(e,i,n)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=ko(),n=Oo(e),i=mr(r,n);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),gr(e,i),Uo(e,n,r)}};function Cr(e,t,r,n,i,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!$t(r,n)||!$t(i,o))}function Er(e,t,r){var n=!1,i=et,o=t.contextType;return"object"===typeof o&&null!==o?o=hr(o):(i=ot(t)?nt:tt.current,o=(n=null!==(n=t.contextTypes)&&void 0!==n)?it(e,i):et),t=new t(r,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=wr,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function Sr(e,t,r,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&wr.enqueueReplaceState(t,t.state,null)}function Tr(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs=xr,fr(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=hr(o):(o=ot(t)?nt:tt.current,i.context=it(e,o)),vr(e,r,i,n),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(br(e,t,o,r),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&wr.enqueueReplaceState(i,i.state,null),vr(e,r,i,n),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4)}var Mr=Array.isArray;function Ir(e,t,r){if(null!==(e=r.ref)&&"function"!==typeof e&&"object"!==typeof e){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(s(309));var n=r.stateNode}if(!n)throw Error(s(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=n.refs;t===xr&&(t=n.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}if("string"!==typeof e)throw Error(s(284));if(!r._owner)throw Error(s(290,e))}return e}function Br(e,t){if("textarea"!==e.type)throw Error(s(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function _r(e){function t(t,r){if(e){var n=t.lastEffect;null!==n?(n.nextEffect=r,t.lastEffect=r):t.firstEffect=t.lastEffect=r,r.nextEffect=null,r.flags=8}}function r(r,n){if(!e)return null;for(;null!==n;)t(r,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Ea(e,t)).index=0,e.sibling=null,e}function o(t,r,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<r?(t.flags=2,r):n:(t.flags=2,r):r}function a(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,r,n){return null===t||6!==t.tag?((t=Ia(r,e.mode,n)).return=e,t):((t=i(t,r)).return=e,t)}function d(e,t,r,n){return null!==t&&t.elementType===r.type?((n=i(t,r.props)).ref=Ir(e,t,r),n.return=e,n):((n=Sa(r.type,r.key,r.props,null,e.mode,n)).ref=Ir(e,t,r),n.return=e,n)}function f(e,t,r,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Ba(r,e.mode,n)).return=e,t):((t=i(t,r.children||[])).return=e,t)}function p(e,t,r,n,o){return null===t||7!==t.tag?((t=Ta(r,e.mode,n,o)).return=e,t):((t=i(t,r)).return=e,t)}function m(e,t,r){if("string"===typeof t||"number"===typeof t)return(t=Ia(""+t,e.mode,r)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case c:return(r=Sa(t.type,t.key,t.props,null,e.mode,r)).ref=Ir(e,null,t),r.return=e,r;case u:return(t=Ba(t,e.mode,r)).return=e,t}if(Mr(t)||M(t))return(t=Ta(t,e.mode,r,null)).return=e,t;Br(e,t)}return null}function g(e,t,r,n){var i=null!==t?t.key:null;if("string"===typeof r||"number"===typeof r)return null!==i?null:l(e,t,""+r,n);if("object"===typeof r&&null!==r){switch(r.$$typeof){case c:return r.key===i?r.type===h?p(e,t,r.props.children,n,i):d(e,t,r,n):null;case u:return r.key===i?f(e,t,r,n):null}if(Mr(r)||M(r))return null!==i?null:p(e,t,r,n,null);Br(e,r)}return null}function A(e,t,r,n,i){if("string"===typeof n||"number"===typeof n)return l(t,e=e.get(r)||null,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case c:return e=e.get(null===n.key?r:n.key)||null,n.type===h?p(t,e,n.props.children,i,n.key):d(t,e,n,i);case u:return f(t,e=e.get(null===n.key?r:n.key)||null,n,i)}if(Mr(n)||M(n))return p(t,e=e.get(r)||null,n,i,null);Br(t,n)}return null}function v(i,a,s,l){for(var c=null,u=null,h=a,d=a=0,f=null;null!==h&&d<s.length;d++){h.index>d?(f=h,h=null):f=h.sibling;var p=g(i,h,s[d],l);if(null===p){null===h&&(h=f);break}e&&h&&null===p.alternate&&t(i,h),a=o(p,a,d),null===u?c=p:u.sibling=p,u=p,h=f}if(d===s.length)return r(i,h),c;if(null===h){for(;d<s.length;d++)null!==(h=m(i,s[d],l))&&(a=o(h,a,d),null===u?c=h:u.sibling=h,u=h);return c}for(h=n(i,h);d<s.length;d++)null!==(f=A(h,i,d,s[d],l))&&(e&&null!==f.alternate&&h.delete(null===f.key?d:f.key),a=o(f,a,d),null===u?c=f:u.sibling=f,u=f);return e&&h.forEach((function(e){return t(i,e)})),c}function y(i,a,l,c){var u=M(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,d=a,f=a=0,p=null,v=l.next();null!==d&&!v.done;f++,v=l.next()){d.index>f?(p=d,d=null):p=d.sibling;var y=g(i,d,v.value,c);if(null===y){null===d&&(d=p);break}e&&d&&null===y.alternate&&t(i,d),a=o(y,a,f),null===h?u=y:h.sibling=y,h=y,d=p}if(v.done)return r(i,d),u;if(null===d){for(;!v.done;f++,v=l.next())null!==(v=m(i,v.value,c))&&(a=o(v,a,f),null===h?u=v:h.sibling=v,h=v);return u}for(d=n(i,d);!v.done;f++,v=l.next())null!==(v=A(d,i,f,v.value,c))&&(e&&null!==v.alternate&&d.delete(null===v.key?f:v.key),a=o(v,a,f),null===h?u=v:h.sibling=v,h=v);return e&&d.forEach((function(e){return t(i,e)})),u}return function(e,n,o,l){var d="object"===typeof o&&null!==o&&o.type===h&&null===o.key;d&&(o=o.props.children);var f="object"===typeof o&&null!==o;if(f)switch(o.$$typeof){case c:e:{for(f=o.key,d=n;null!==d;){if(d.key===f){switch(d.tag){case 7:if(o.type===h){r(e,d.sibling),(n=i(d,o.props.children)).return=e,e=n;break e}break;default:if(d.elementType===o.type){r(e,d.sibling),(n=i(d,o.props)).ref=Ir(e,d,o),n.return=e,e=n;break e}}r(e,d);break}t(e,d),d=d.sibling}o.type===h?((n=Ta(o.props.children,e.mode,l,o.key)).return=e,e=n):((l=Sa(o.type,o.key,o.props,null,e.mode,l)).ref=Ir(e,n,o),l.return=e,e=l)}return a(e);case u:e:{for(d=o.key;null!==n;){if(n.key===d){if(4===n.tag&&n.stateNode.containerInfo===o.containerInfo&&n.stateNode.implementation===o.implementation){r(e,n.sibling),(n=i(n,o.children||[])).return=e,e=n;break e}r(e,n);break}t(e,n),n=n.sibling}(n=Ba(o,e.mode,l)).return=e,e=n}return a(e)}if("string"===typeof o||"number"===typeof o)return o=""+o,null!==n&&6===n.tag?(r(e,n.sibling),(n=i(n,o)).return=e,e=n):(r(e,n),(n=Ia(o,e.mode,l)).return=e,e=n),a(e);if(Mr(o))return v(e,n,o,l);if(M(o))return y(e,n,o,l);if(f&&Br(e,o),"undefined"===typeof o&&!d)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(s(152,I(e.type)||"Component"))}return r(e,n)}}var Fr=_r(!0),Pr=_r(!1),Rr={},Lr=qe(Rr),Dr=qe(Rr),Nr=qe(Rr);function kr(e){if(e===Rr)throw Error(s(174));return e}function Or(e,t){$e(Nr,t),$e(Dr,e),$e(Lr,Rr),e=N(t),Ke(Lr),$e(Lr,e)}function Ur(){Ke(Lr),Ke(Dr),Ke(Nr)}function Qr(e){var t=kr(Nr.current),r=kr(Lr.current);r!==(t=k(r,e.type,t))&&($e(Dr,e),$e(Lr,t))}function Vr(e){Dr.current===e&&(Ke(Lr),Ke(Dr))}var Gr=qe(0);function zr(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||ke(r)||Oe(r)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var jr=null,Hr=null,Wr=!1;function Zr(e,t){var r=wa(5,null,null,0);r.elementType="DELETED",r.type="DELETED",r.stateNode=t,r.return=e,r.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=r,e.lastEffect=r):e.firstEffect=e.lastEffect=r}function Xr(e,t){switch(e.tag){case 5:return null!==(t=De(t,e.type,e.pendingProps))&&(e.stateNode=t,!0);case 6:return null!==(t=Ne(t,e.pendingProps))&&(e.stateNode=t,!0);case 13:default:return!1}}function Yr(e){if(Wr){var t=Hr;if(t){var r=t;if(!Xr(e,t)){if(!(t=Ue(r))||!Xr(e,t))return e.flags=-1025&e.flags|2,Wr=!1,void(jr=e);Zr(jr,r)}jr=e,Hr=Qe(t)}else e.flags=-1025&e.flags|2,Wr=!1,jr=e}}function Jr(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;jr=e}function qr(e){if(!K||e!==jr)return!1;if(!Wr)return Jr(e),Wr=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!j(t,e.memoizedProps))for(t=Hr;t;)Zr(e,t),t=Ue(t);if(Jr(e),13===e.tag){if(!K)throw Error(s(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));Hr=ze(e)}else Hr=jr?Ue(e.stateNode):null;return!0}function Kr(){K&&(Hr=jr=null,Wr=!1)}var $r=[];function en(){for(var e=0;e<$r.length;e++){var t=$r[e];Y?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}$r.length=0}var tn=l.ReactCurrentDispatcher,rn=l.ReactCurrentBatchConfig,nn=0,on=null,an=null,sn=null,ln=!1,cn=!1;function un(){throw Error(s(321))}function hn(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!qt(e[r],t[r]))return!1;return!0}function dn(e,t,r,n,i,o){if(nn=o,on=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,tn.current=null===e||null===e.memoizedState?On:Un,e=r(n,i),cn){o=0;do{if(cn=!1,!(25>o))throw Error(s(301));o+=1,sn=an=null,t.updateQueue=null,tn.current=Qn,e=r(n,i)}while(cn)}if(tn.current=kn,t=null!==an&&null!==an.next,nn=0,sn=an=on=null,ln=!1,t)throw Error(s(300));return e}function fn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===sn?on.memoizedState=sn=e:sn=sn.next=e,sn}function pn(){if(null===an){var e=on.alternate;e=null!==e?e.memoizedState:null}else e=an.next;var t=null===sn?on.memoizedState:sn.next;if(null!==t)sn=t,an=e;else{if(null===e)throw Error(s(310));e={memoizedState:(an=e).memoizedState,baseState:an.baseState,baseQueue:an.baseQueue,queue:an.queue,next:null},null===sn?on.memoizedState=sn=e:sn=sn.next=e}return sn}function mn(e,t){return"function"===typeof t?t(e):t}function gn(e){var t=pn(),r=t.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=e;var n=an,i=n.baseQueue,o=r.pending;if(null!==o){if(null!==i){var a=i.next;i.next=o.next,o.next=a}n.baseQueue=i=o,r.pending=null}if(null!==i){i=i.next,n=n.baseState;var l=a=o=null,c=i;do{var u=c.lane;if((nn&u)===u)null!==l&&(l=l.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),n=c.eagerReducer===e?c.eagerState:e(n,c.action);else{var h={lane:u,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(a=l=h,o=n):l=l.next=h,on.lanes|=u,ho|=u}c=c.next}while(null!==c&&c!==i);null===l?o=n:l.next=a,qt(n,t.memoizedState)||(Gn=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=l,r.lastRenderedState=n}return[t.memoizedState,r.dispatch]}function An(e){var t=pn(),r=t.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,o=t.memoizedState;if(null!==i){r.pending=null;var a=i=i.next;do{o=e(o,a.action),a=a.next}while(a!==i);qt(o,t.memoizedState)||(Gn=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function vn(e,t,r){var n=t._getVersion;n=n(t._source);var i=Y?t._workInProgressVersionPrimary:t._workInProgressVersionSecondary;if(null!==i?e=i===n:(e=e.mutableReadLanes,(e=(nn&e)===e)&&(Y?t._workInProgressVersionPrimary=n:t._workInProgressVersionSecondary=n,$r.push(t))),e)return r(t._source);throw $r.push(t),Error(s(350))}function yn(e,t,r,n){var i=no;if(null===i)throw Error(s(349));var o=t._getVersion,a=o(t._source),l=tn.current,c=l.useState((function(){return vn(i,t,r)})),u=c[1],h=c[0];c=sn;var d=e.memoizedState,f=d.refs,p=f.getSnapshot,m=d.source;d=d.subscribe;var g=on;return e.memoizedState={refs:f,source:t,subscribe:n},l.useEffect((function(){f.getSnapshot=r,f.setSnapshot=u;var e=o(t._source);if(!qt(a,e)){e=r(t._source),qt(h,e)||(u(e),e=Oo(g),i.mutableReadLanes|=e&i.pendingLanes),e=i.mutableReadLanes,i.entangledLanes|=e;for(var n=i.entanglements,s=e;0<s;){var l=31-wt(s),c=1<<l;n[l]|=e,s&=~c}}}),[r,t,n]),l.useEffect((function(){return n(t._source,(function(){var e=f.getSnapshot,r=f.setSnapshot;try{r(e(t._source));var n=Oo(g);i.mutableReadLanes|=n&i.pendingLanes}catch(o){r((function(){throw o}))}}))}),[t,n]),qt(p,r)&&qt(m,t)&&qt(d,n)||((e={pending:null,dispatch:null,lastRenderedReducer:mn,lastRenderedState:h}).dispatch=u=Nn.bind(null,on,e),c.queue=e,c.baseQueue=null,h=vn(i,t,r),c.memoizedState=c.baseState=h),h}function xn(e,t,r){return yn(pn(),e,t,r)}function bn(e){var t=fn();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:mn,lastRenderedState:e}).dispatch=Nn.bind(null,on,e),[t.memoizedState,e]}function wn(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},null===(t=on.updateQueue)?(t={lastEffect:null},on.updateQueue=t,t.lastEffect=e.next=e):null===(r=t.lastEffect)?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e),e}function Cn(e){return e={current:e},fn().memoizedState=e}function En(){return pn().memoizedState}function Sn(e,t,r,n){var i=fn();on.flags|=e,i.memoizedState=wn(1|t,r,void 0,void 0===n?null:n)}function Tn(e,t,r,n){var i=pn();n=void 0===n?null:n;var o=void 0;if(null!==an){var a=an.memoizedState;if(o=a.destroy,null!==n&&hn(n,a.deps))return void wn(t,r,o,n)}on.flags|=e,i.memoizedState=wn(1|t,r,o,n)}function Mn(e,t){return Sn(516,4,e,t)}function In(e,t){return Tn(516,4,e,t)}function Bn(e,t){return Tn(4,2,e,t)}function _n(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Fn(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,Tn(4,2,_n.bind(null,t,e),r)}function Pn(){}function Rn(e,t){var r=pn();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&hn(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function Ln(e,t){var r=pn();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&hn(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function Dn(e,t){var r=jt();Wt(98>r?98:r,(function(){e(!0)})),Wt(97<r?97:r,(function(){var r=rn.transition;rn.transition=1;try{e(!1),t()}finally{rn.transition=r}}))}function Nn(e,t,r){var n=ko(),i=Oo(e),o={lane:i,action:r,eagerReducer:null,eagerState:null,next:null},a=t.pending;if(null===a?o.next=o:(o.next=a.next,a.next=o),t.pending=o,a=e.alternate,e===on||null!==a&&a===on)cn=ln=!0;else{if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,l=a(s,r);if(o.eagerReducer=a,o.eagerState=l,qt(l,s))return}catch(c){}Uo(e,i,n)}}var kn={readContext:hr,useCallback:un,useContext:un,useEffect:un,useImperativeHandle:un,useLayoutEffect:un,useMemo:un,useReducer:un,useRef:un,useState:un,useDebugValue:un,useDeferredValue:un,useTransition:un,useMutableSource:un,useOpaqueIdentifier:un,unstable_isNewReconciler:!1},On={readContext:hr,useCallback:function(e,t){return fn().memoizedState=[e,void 0===t?null:t],e},useContext:hr,useEffect:Mn,useImperativeHandle:function(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,Sn(4,2,_n.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Sn(4,2,e,t)},useMemo:function(e,t){var r=fn();return t=void 0===t?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=fn();return t=void 0!==r?r(t):t,n.memoizedState=n.baseState=t,e=(e=n.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Nn.bind(null,on,e),[n.memoizedState,e]},useRef:Cn,useState:bn,useDebugValue:Pn,useDeferredValue:function(e){var t=bn(e),r=t[0],n=t[1];return Mn((function(){var t=rn.transition;rn.transition=1;try{n(e)}finally{rn.transition=t}}),[e]),r},useTransition:function(){var e=bn(!1),t=e[0];return Cn(e=Dn.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,r){var n=fn();return n.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:r},yn(n,e,t,r)},useOpaqueIdentifier:function(){if(Wr){var e=!1,t=ee((function(){throw e||(e=!0,r(te())),Error(s(355))})),r=bn(t)[1];return 0===(2&on.mode)&&(on.flags|=516,wn(5,(function(){r(te())}),void 0,null)),t}return bn(t=te()),t},unstable_isNewReconciler:!1},Un={readContext:hr,useCallback:Rn,useContext:hr,useEffect:In,useImperativeHandle:Fn,useLayoutEffect:Bn,useMemo:Ln,useReducer:gn,useRef:En,useState:function(){return gn(mn)},useDebugValue:Pn,useDeferredValue:function(e){var t=gn(mn),r=t[0],n=t[1];return In((function(){var t=rn.transition;rn.transition=1;try{n(e)}finally{rn.transition=t}}),[e]),r},useTransition:function(){var e=gn(mn)[0];return[En().current,e]},useMutableSource:xn,useOpaqueIdentifier:function(){return gn(mn)[0]},unstable_isNewReconciler:!1},Qn={readContext:hr,useCallback:Rn,useContext:hr,useEffect:In,useImperativeHandle:Fn,useLayoutEffect:Bn,useMemo:Ln,useReducer:An,useRef:En,useState:function(){return An(mn)},useDebugValue:Pn,useDeferredValue:function(e){var t=An(mn),r=t[0],n=t[1];return In((function(){var t=rn.transition;rn.transition=1;try{n(e)}finally{rn.transition=t}}),[e]),r},useTransition:function(){var e=An(mn)[0];return[En().current,e]},useMutableSource:xn,useOpaqueIdentifier:function(){return An(mn)[0]},unstable_isNewReconciler:!1},Vn=l.ReactCurrentOwner,Gn=!1;function zn(e,t,r,n){t.child=null===e?Pr(t,null,r,n):Fr(t,e.child,r,n)}function jn(e,t,r,n,i){r=r.render;var o=t.ref;return ur(t,i),n=dn(e,t,r,n,o,i),null===e||Gn?(t.flags|=1,zn(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,hi(e,t,i))}function Hn(e,t,r,n,i,o){if(null===e){var a=r.type;return"function"!==typeof a||Ca(a)||void 0!==a.defaultProps||null!==r.compare||void 0!==r.defaultProps?((e=Sa(r.type,null,n,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Wn(e,t,a,n,i,o))}return a=e.child,0===(i&o)&&(i=a.memoizedProps,(r=null!==(r=r.compare)?r:$t)(i,n)&&e.ref===t.ref)?hi(e,t,o):(t.flags|=1,(e=Ea(a,n)).ref=t.ref,e.return=t,t.child=e)}function Wn(e,t,r,n,i,o){if(null!==e&&$t(e.memoizedProps,n)&&e.ref===t.ref){if(Gn=!1,0===(o&i))return t.lanes=e.lanes,hi(e,t,o);0!==(16384&e.flags)&&(Gn=!0)}return Yn(e,t,r,n,o)}function Zn(e,t,r){var n=t.pendingProps,i=n.children,o=null!==e?e.memoizedState:null;if("hidden"===n.mode||"unstable-defer-without-hiding"===n.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},Zo(t,r);else{if(0===(1073741824&r))return e=null!==o?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},Zo(t,e),null;t.memoizedState={baseLanes:0},Zo(t,null!==o?o.baseLanes:r)}else null!==o?(n=o.baseLanes|r,t.memoizedState=null):n=r,Zo(t,n);return zn(e,t,i,r),t.child}function Xn(e,t){var r=t.ref;(null===e&&null!==r||null!==e&&e.ref!==r)&&(t.flags|=128)}function Yn(e,t,r,n,i){var o=ot(r)?nt:tt.current;return o=it(t,o),ur(t,i),r=dn(e,t,r,n,o,i),null===e||Gn?(t.flags|=1,zn(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,hi(e,t,i))}function Jn(e,t,r,n,i){if(ot(r)){var o=!0;ct(t)}else o=!1;if(ur(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),Er(t,r,n),Tr(t,r,n,i),n=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var l=a.context,c=r.contextType;"object"===typeof c&&null!==c?c=hr(c):c=it(t,c=ot(r)?nt:tt.current);var u=r.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;h||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==n||l!==c)&&Sr(t,a,n,c),dr=!1;var d=t.memoizedState;a.state=d,vr(t,n,a,i),l=t.memoizedState,s!==n||d!==l||rt.current||dr?("function"===typeof u&&(br(t,r,u,n),l=t.memoizedState),(s=dr||Cr(t,r,s,n,d,l,c))?(h||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4)):("function"===typeof a.componentDidMount&&(t.flags|=4),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=c,n=s):("function"===typeof a.componentDidMount&&(t.flags|=4),n=!1)}else{a=t.stateNode,pr(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:tr(t.type,s),a.props=c,h=t.pendingProps,d=a.context,"object"===typeof(l=r.contextType)&&null!==l?l=hr(l):l=it(t,l=ot(r)?nt:tt.current);var f=r.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==h||d!==l)&&Sr(t,a,n,l),dr=!1,d=t.memoizedState,a.state=d,vr(t,n,a,i);var p=t.memoizedState;s!==h||d!==p||rt.current||dr?("function"===typeof f&&(br(t,r,f,n),p=t.memoizedState),(c=dr||Cr(t,r,c,n,d,p,l))?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(n,p,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,p,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),t.memoizedProps=n,t.memoizedState=p),a.props=n,a.state=p,a.context=l,n=c):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),n=!1)}return qn(e,t,r,n,o,i)}function qn(e,t,r,n,i,o){Xn(e,t);var a=0!==(64&t.flags);if(!n&&!a)return i&&ut(t,r,!1),hi(e,t,o);n=t.stateNode,Vn.current=t;var s=a&&"function"!==typeof r.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&a?(t.child=Fr(t,e.child,null,o),t.child=Fr(t,null,s,o)):zn(e,t,s,o),t.memoizedState=n.state,i&&ut(t,r,!0),t.child}function Kn(e){var t=e.stateNode;t.pendingContext?st(0,t.pendingContext,t.pendingContext!==t.context):t.context&&st(0,t.context,!1),Or(e,t.containerInfo)}var $n,ei,ti,ri,ni={dehydrated:null,retryLane:0};function ii(e,t,r){var n,i=t.pendingProps,o=Gr.current,a=!1;return(n=0!==(64&t.flags))||(n=(null===e||null!==e.memoizedState)&&0!==(2&o)),n?(a=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(o|=1),$e(Gr,1&o),null===e?(void 0!==i.fallback&&Yr(t),e=i.children,o=i.fallback,a?(e=oi(t,e,o,r),t.child.memoizedState={baseLanes:r},t.memoizedState=ni,e):"number"===typeof i.unstable_expectedLoadTime?(e=oi(t,e,o,r),t.child.memoizedState={baseLanes:r},t.memoizedState=ni,t.lanes=33554432,e):((r=Ma({mode:"visible",children:e},t.mode,r,null)).return=t,t.child=r)):(e.memoizedState,a?(i=si(e,t,i.children,i.fallback,r),a=t.child,o=e.child.memoizedState,a.memoizedState=null===o?{baseLanes:r}:{baseLanes:o.baseLanes|r},a.childLanes=e.childLanes&~r,t.memoizedState=ni,i):(r=ai(e,t,i.children,r),t.memoizedState=null,r))}function oi(e,t,r,n){var i=e.mode,o=e.child;return t={mode:"hidden",children:t},0===(2&i)&&null!==o?(o.childLanes=0,o.pendingProps=t):o=Ma(t,i,0,null),r=Ta(r,i,n,null),o.return=e,r.return=e,o.sibling=r,e.child=o,r}function ai(e,t,r,n){var i=e.child;return e=i.sibling,r=Ea(i,{mode:"visible",children:r}),0===(2&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=r}function si(e,t,r,n,i){var o=t.mode,a=e.child;e=a.sibling;var s={mode:"hidden",children:r};return 0===(2&o)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=s,null!==(a=r.lastEffect)?(t.firstEffect=r.firstEffect,t.lastEffect=a,a.nextEffect=null):t.firstEffect=t.lastEffect=null):r=Ea(a,s),null!==e?n=Ea(e,n):(n=Ta(n,o,i,null)).flags|=2,n.return=t,r.return=t,r.sibling=n,t.child=r,n}function li(e,t){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),cr(e.return,t)}function ci(e,t,r,n,i,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i,lastEffect:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=r,a.tailMode=i,a.lastEffect=o)}function ui(e,t,r){var n=t.pendingProps,i=n.revealOrder,o=n.tail;if(zn(e,t,n.children,r),0!==(2&(n=Gr.current)))n=1&n|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&li(e,r);else if(19===e.tag)li(e,r);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if($e(Gr,n),0===(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;null!==r;)null!==(e=r.alternate)&&null===zr(e)&&(i=r),r=r.sibling;null===(r=i)?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),ci(t,!1,i,r,o,t.lastEffect);break;case"backwards":for(r=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===zr(e)){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}ci(t,!0,r,null,o,t.lastEffect);break;case"together":ci(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function hi(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),ho|=t.lanes,0!==(r&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(r=Ea(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Ea(e,e.pendingProps)).return=t;r.sibling=null}return t.child}return null}function di(e){e.flags|=4}if(J)$n=function(e,t){for(var r=t.child;null!==r;){if(5===r.tag||6===r.tag)V(e,r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}},ei=function(){},ti=function(e,t,r,n,i){if((e=e.memoizedProps)!==n){var o=t.stateNode,a=kr(Lr.current);r=z(o,r,e,n,i,a),(t.updateQueue=r)&&di(t)}},ri=function(e,t,r,n){r!==n&&di(t)};else if(q){$n=function(e,t,r,n){for(var i=t.child;null!==i;){if(5===i.tag){var o=i.stateNode;r&&n&&(o=Re(o,i.type,i.memoizedProps,i)),V(e,o)}else if(6===i.tag)o=i.stateNode,r&&n&&(o=Le(o,i.memoizedProps,i)),V(e,o);else if(4!==i.tag){if(13===i.tag&&0!==(4&i.flags)&&(o=null!==i.memoizedState)){var a=i.child;if(null!==a&&(null!==a.child&&(a.child.return=a,$n(e,a,!0,o)),null!==(o=a.sibling))){o.return=i,i=o;continue}}if(null!==i.child){i.child.return=i,i=i.child;continue}}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};var fi=function(e,t,r,n){for(var i=t.child;null!==i;){if(5===i.tag){var o=i.stateNode;r&&n&&(o=Re(o,i.type,i.memoizedProps,i)),_e(e,o)}else if(6===i.tag)o=i.stateNode,r&&n&&(o=Le(o,i.memoizedProps,i)),_e(e,o);else if(4!==i.tag){if(13===i.tag&&0!==(4&i.flags)&&(o=null!==i.memoizedState)){var a=i.child;if(null!==a&&(null!==a.child&&(a.child.return=a,fi(e,a,!0,o)),null!==(o=a.sibling))){o.return=i,i=o;continue}}if(null!==i.child){i.child.return=i,i=i.child;continue}}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};ei=function(e){var t=e.stateNode;if(null!==e.firstEffect){var r=t.containerInfo,n=Be(r);fi(n,e,!1,!1),t.pendingChildren=n,di(e),Fe(r,n)}},ti=function(e,t,r,n,i){var o=e.stateNode,a=e.memoizedProps;if((e=null===t.firstEffect)&&a===n)t.stateNode=o;else{var s=t.stateNode,l=kr(Lr.current),c=null;a!==n&&(c=z(s,r,a,n,i,l)),e&&null===c?t.stateNode=o:(o=Ie(o,c,r,a,n,t,e,s),G(o,r,n,i,l)&&di(t),t.stateNode=o,e?di(t):$n(o,t,!1,!1))}},ri=function(e,t,r,n){r!==n?(e=kr(Nr.current),r=kr(Lr.current),t.stateNode=H(n,e,r,t),di(t)):t.stateNode=e.stateNode}}else ei=function(){},ti=function(){},ri=function(){};function pi(e,t){if(!Wr)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;null!==r;)null!==r.alternate&&(n=r),r=r.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function mi(e,t,r){var n=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return ot(t.type)&&at(),null;case 3:return Ur(),Ke(rt),Ke(tt),en(),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(qr(t)?di(t):n.hydrate||(t.flags|=256)),ei(t),null;case 5:Vr(t);var i=kr(Nr.current);if(r=t.type,null!==e&&null!=t.stateNode)ti(e,t,r,n,i),e.ref!==t.ref&&(t.flags|=128);else{if(!n){if(null===t.stateNode)throw Error(s(166));return null}if(e=kr(Lr.current),qr(t)){if(!K)throw Error(s(175));e=Ve(t.stateNode,t.type,t.memoizedProps,i,e,t),t.updateQueue=e,null!==e&&di(t)}else{var o=Q(r,n,i,e,t);$n(o,t,!1,!1),t.stateNode=o,G(o,r,n,i,e)&&di(t)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)ri(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(s(166));if(e=kr(Nr.current),i=kr(Lr.current),qr(t)){if(!K)throw Error(s(176));Ge(t.stateNode,t.memoizedProps,t)&&di(t)}else t.stateNode=H(n,e,i,t)}return null;case 13:return Ke(Gr),n=t.memoizedState,0!==(64&t.flags)?(t.lanes=r,t):(n=null!==n,i=!1,null===e?void 0!==t.memoizedProps.fallback&&qr(t):i=null!==e.memoizedState,n&&!i&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Gr.current)?0===lo&&(lo=3):(0!==lo&&3!==lo||(lo=4),null===no||0===(134217727&ho)&&0===(134217727&fo)||zo(no,oo))),q&&n&&(t.flags|=4),J&&(n||i)&&(t.flags|=4),null);case 4:return Ur(),ei(t),null===e&&ie(t.stateNode.containerInfo),null;case 10:return lr(t),null;case 17:return ot(t.type)&&at(),null;case 19:if(Ke(Gr),null===(n=t.memoizedState))return null;if(i=0!==(64&t.flags),null===(o=n.rendering))if(i)pi(n,!1);else{if(0!==lo||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(o=zr(e))){for(t.flags|=64,pi(n,!1),null!==(e=o.updateQueue)&&(t.updateQueue=e,t.flags|=4),null===n.lastEffect&&(t.firstEffect=null),t.lastEffect=n.lastEffect,e=r,n=t.child;null!==n;)r=e,(i=n).flags&=2,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null,null===(o=i.alternate)?(i.childLanes=0,i.lanes=r,i.child=null,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,r=o.dependencies,i.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext}),n=n.sibling;return $e(Gr,1&Gr.current|2),t.child}e=e.sibling}null!==n.tail&&zt()>Ao&&(t.flags|=64,i=!0,pi(n,!1),t.lanes=33554432)}else{if(!i)if(null!==(e=zr(o))){if(t.flags|=64,i=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),pi(n,!0),null===n.tail&&"hidden"===n.tailMode&&!o.alternate&&!Wr)return null!==(t=t.lastEffect=n.lastEffect)&&(t.nextEffect=null),null}else 2*zt()-n.renderingStartTime>Ao&&1073741824!==r&&(t.flags|=64,i=!0,pi(n,!1),t.lanes=33554432);n.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=n.last)?e.sibling=o:t.child=o,n.last=o)}return null!==n.tail?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.lastEffect=t.lastEffect,n.renderingStartTime=zt(),e.sibling=null,t=Gr.current,$e(Gr,i?1&t|2:1&t),e):null;case 23:case 24:return Xo(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==n.mode&&(t.flags|=4),null}throw Error(s(156,t.tag))}function gi(e){switch(e.tag){case 1:ot(e.type)&&at();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Ur(),Ke(rt),Ke(tt),en(),0!==(64&(t=e.flags)))throw Error(s(285));return e.flags=-4097&t|64,e;case 5:return Vr(e),null;case 13:return Ke(Gr),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return Ke(Gr),null;case 4:return Ur(),null;case 10:return lr(e),null;case 23:case 24:return Xo(),null;default:return null}}function Ai(e,t){try{var r="",n=t;do{r+=er(n),n=n.return}while(n);var i=r}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i}}function vi(e,t){try{console.error(t.value)}catch(r){setTimeout((function(){throw r}))}}var yi="function"===typeof WeakMap?WeakMap:Map;function xi(e,t,r){(r=mr(-1,r)).tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){bo||(bo=!0,wo=n),vi(0,t)},r}function bi(e,t,r){(r=mr(-1,r)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var i=t.value;r.payload=function(){return vi(0,t),n(i)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(r.callback=function(){"function"!==typeof n&&(null===Co?Co=new Set([this]):Co.add(this),vi(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),r}var wi="function"===typeof WeakSet?WeakSet:Set;function Ci(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(r){ha(e,r)}else t.current=null}function Ei(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var r=e.memoizedProps,n=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?r:tr(t.type,r),n),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(J&&256&t.flags&&Me(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(s(163))}function Si(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var r=t=t.next;do{if((r.tag&e)===e){var n=r.destroy;r.destroy=void 0,void 0!==n&&n()}r=r.next}while(r!==t)}}function Ti(e,t,r){switch(r.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=r.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var n=e.create;e.destroy=n()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=r.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var i=e;n=i.next,0!==(4&(i=i.tag))&&0!==(1&i)&&(la(r,e),sa(r,e)),e=n}while(e!==t)}return;case 1:return e=r.stateNode,4&r.flags&&(null===t?e.componentDidMount():(n=r.elementType===r.type?t.memoizedProps:tr(r.type,t.memoizedProps),e.componentDidUpdate(n,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=r.updateQueue)&&yr(r,t,e));case 3:if(null!==(t=r.updateQueue)){if(e=null,null!==r.child)switch(r.child.tag){case 5:e=D(r.child.stateNode);break;case 1:e=r.child.stateNode}yr(r,t,e)}return;case 5:return e=r.stateNode,void(null===t&&4&r.flags&&ge(e,r.type,r.memoizedProps,r));case 6:case 4:case 12:return;case 13:return void(K&&null===r.memoizedState&&(r=r.alternate,null!==r&&(r=r.memoizedState,null!==r&&(r=r.dehydrated,null!==r&&He(r)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(s(163))}function Mi(e,t){if(J)for(var r=e;;){if(5===r.tag){var n=r.stateNode;t?Ce(n):Se(r.stateNode,r.memoizedProps)}else if(6===r.tag)n=r.stateNode,t?Ee(n):Te(n,r.memoizedProps);else if((23!==r.tag&&24!==r.tag||null===r.memoizedState||r===e)&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}}function Ii(e,t){if(dt&&"function"===typeof dt.onCommitFiberUnmount)try{dt.onCommitFiberUnmount(ht,t)}catch(o){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e=e.next;do{var n=r,i=n.destroy;if(n=n.tag,void 0!==i)if(0!==(4&n))la(t,r);else{n=t;try{i()}catch(o){ha(n,o)}}r=r.next}while(r!==e)}break;case 1:if(Ci(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(o){ha(t,o)}break;case 5:Ci(t);break;case 4:J?Di(e,t):q&&q&&(t=t.stateNode.containerInfo,e=Be(t),Pe(t,e))}}function Bi(e,t){for(var r=t;;)if(Ii(e,r),null===r.child||J&&4===r.tag){if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}else r.child.return=r,r=r.child}function _i(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function Fi(e){return 5===e.tag||3===e.tag||4===e.tag}function Pi(e){if(J){e:{for(var t=e.return;null!==t;){if(Fi(t))break e;t=t.return}throw Error(s(160))}var r=t;switch(t=r.stateNode,r.tag){case 5:var n=!1;break;case 3:case 4:t=t.containerInfo,n=!0;break;default:throw Error(s(161))}16&r.flags&&(we(t),r.flags&=-17);e:t:for(r=e;;){for(;null===r.sibling;){if(null===r.return||Fi(r.return)){r=null;break e}r=r.return}for(r.sibling.return=r.return,r=r.sibling;5!==r.tag&&6!==r.tag&&18!==r.tag;){if(2&r.flags)continue t;if(null===r.child||4===r.tag)continue t;r.child.return=r,r=r.child}if(!(2&r.flags)){r=r.stateNode;break e}}n?Ri(e,r,t):Li(e,r,t)}}function Ri(e,t,r){var n=e.tag,i=5===n||6===n;if(i)e=i?e.stateNode:e.stateNode.instance,t?ye(r,e,t):pe(r,e);else if(4!==n&&null!==(e=e.child))for(Ri(e,t,r),e=e.sibling;null!==e;)Ri(e,t,r),e=e.sibling}function Li(e,t,r){var n=e.tag,i=5===n||6===n;if(i)e=i?e.stateNode:e.stateNode.instance,t?ve(r,e,t):fe(r,e);else if(4!==n&&null!==(e=e.child))for(Li(e,t,r),e=e.sibling;null!==e;)Li(e,t,r),e=e.sibling}function Di(e,t){for(var r,n,i=t,o=!1;;){if(!o){o=i.return;e:for(;;){if(null===o)throw Error(s(160));switch(r=o.stateNode,o.tag){case 5:n=!1;break e;case 3:case 4:r=r.containerInfo,n=!0;break e}o=o.return}o=!0}if(5===i.tag||6===i.tag)Bi(e,i),n?be(r,i.stateNode):xe(r,i.stateNode);else if(4===i.tag){if(null!==i.child){r=i.stateNode.containerInfo,n=!0,i.child.return=i,i=i.child;continue}}else if(Ii(e,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(o=!1)}i.sibling.return=i.return,i=i.sibling}}function Ni(e,t){if(J){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void Si(3,t);case 1:return;case 5:var r=t.stateNode;if(null!=r){var n=t.memoizedProps;e=null!==e?e.memoizedProps:n;var i=t.type,o=t.updateQueue;t.updateQueue=null,null!==o&&Ae(r,o,i,e,n,t)}return;case 6:if(null===t.stateNode)throw Error(s(162));return r=t.memoizedProps,void me(t.stateNode,null!==e?e.memoizedProps:r,r);case 3:return void(K&&(t=t.stateNode,t.hydrate&&(t.hydrate=!1,je(t.containerInfo))));case 12:return;case 13:return ki(t),void Oi(t);case 19:return void Oi(t);case 17:return;case 23:case 24:return void Mi(t,null!==t.memoizedState)}throw Error(s(163))}switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void Si(3,t);case 12:return;case 13:return ki(t),void Oi(t);case 19:return void Oi(t);case 3:K&&((r=t.stateNode).hydrate&&(r.hydrate=!1,je(r.containerInfo)));break;case 23:case 24:return}e:if(q){switch(t.tag){case 1:case 5:case 6:case 20:break e;case 3:case 4:t=t.stateNode,Pe(t.containerInfo,t.pendingChildren);break e}throw Error(s(163))}}function ki(e){null!==e.memoizedState&&(go=zt(),J&&Mi(e.child,!0))}function Oi(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var r=e.stateNode;null===r&&(r=e.stateNode=new wi),t.forEach((function(t){var n=fa.bind(null,e,t);r.has(t)||(r.add(t),t.then(n,n))}))}}function Ui(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var Qi=0,Vi=1,Gi=2,zi=3,ji=4;if("function"===typeof Symbol&&Symbol.for){var Hi=Symbol.for;Qi=Hi("selector.component"),Vi=Hi("selector.has_pseudo_class"),Gi=Hi("selector.role"),zi=Hi("selector.test_id"),ji=Hi("selector.text")}function Wi(e){var t=$(e);if(null!=t){if("string"!==typeof t.memoizedProps["data-testname"])throw Error(s(364));return t}if(null===(e=ae(e)))throw Error(s(362));return e.stateNode.current}function Zi(e,t){switch(t.$$typeof){case Qi:if(e.type===t.value)return!0;break;case Vi:e:{t=t.value,e=[e,0];for(var r=0;r<e.length;){var n=e[r++],i=e[r++],o=t[i];if(5!==n.tag||!ce(n)){for(;null!=o&&Zi(n,o);)o=t[++i];if(i===t.length){t=!0;break e}for(n=n.child;null!==n;)e.push(n,i),n=n.sibling}}t=!1}return t;case Gi:if(5===e.tag&&ue(e.stateNode,t.value))return!0;break;case ji:if((5===e.tag||6===e.tag)&&(null!==(e=le(e))&&0<=e.indexOf(t.value)))return!0;break;case zi:if(5===e.tag&&("string"===typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(s(365,t))}return!1}function Xi(e){switch(e.$$typeof){case Qi:return"<"+(I(e.value)||"Unknown")+">";case Vi:return":has("+(Xi(e)||"")+")";case Gi:return'[role="'+e.value+'"]';case ji:return'"'+e.value+'"';case zi:return'[data-testname="'+e.value+'"]';default:throw Error(s(365,e))}}function Yi(e,t){var r=[];e=[e,0];for(var n=0;n<e.length;){var i=e[n++],o=e[n++],a=t[o];if(5!==i.tag||!ce(i)){for(;null!=a&&Zi(i,a);)a=t[++o];if(o===t.length)r.push(i);else for(i=i.child;null!==i;)e.push(i,o),i=i.sibling}}return r}function Ji(e,t){if(!oe)throw Error(s(363));e=Yi(e=Wi(e),t),t=[],e=Array.from(e);for(var r=0;r<e.length;){var n=e[r++];if(5===n.tag)ce(n)||t.push(n.stateNode);else for(n=n.child;null!==n;)e.push(n),n=n.sibling}return t}var qi=null;var Ki=Math.ceil,$i=l.ReactCurrentDispatcher,eo=l.ReactCurrentOwner,to=l.IsSomeRendererActing,ro=0,no=null,io=null,oo=0,ao=0,so=qe(0),lo=0,co=null,uo=0,ho=0,fo=0,po=0,mo=null,go=0,Ao=1/0;function vo(){Ao=zt()+500}var yo,xo=null,bo=!1,wo=null,Co=null,Eo=!1,So=null,To=90,Mo=[],Io=[],Bo=null,_o=0,Fo=null,Po=-1,Ro=0,Lo=0,Do=null,No=!1;function ko(){return 0!==(48&ro)?zt():-1!==Po?Po:Po=zt()}function Oo(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===jt()?1:2;if(0===Ro&&(Ro=uo),0!==Jt.transition){0!==Lo&&(Lo=null!==mo?mo.pendingLanes:0),e=Ro;var t=4186112&~Lo;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=jt(),0!==(4&ro)&&98===e?e=vt(12,Ro):e=vt(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),Ro),e}function Uo(e,t,r){if(50<_o)throw _o=0,Fo=null,Error(s(185));if(null===(e=Qo(e,t)))return null;bt(e,t,r),e===no&&(fo|=t,4===lo&&zo(e,oo));var n=jt();1===t?0!==(8&ro)&&0===(48&ro)?jo(e):(Vo(e,r),0===ro&&(vo(),Xt())):(0===(4&ro)||98!==n&&99!==n||(null===Bo?Bo=new Set([e]):Bo.add(e)),Vo(e,r)),mo=e}function Qo(e,t){e.lanes|=t;var r=e.alternate;for(null!==r&&(r.lanes|=t),r=e,e=e.return;null!==e;)e.childLanes|=t,null!==(r=e.alternate)&&(r.childLanes|=t),r=e,e=e.return;return 3===r.tag?r.stateNode:null}function Vo(e,t){for(var r=e.callbackNode,n=e.suspendedLanes,i=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var l=31-wt(a),c=1<<l,u=o[l];if(-1===u){if(0===(c&n)||0!==(c&i)){u=t,mt(c);var h=pt;o[l]=10<=h?u+250:6<=h?u+5e3:-1}}else u<=t&&(e.expiredLanes|=c);a&=~c}if(n=gt(e,e===no?oo:0),t=pt,0===n)null!==r&&(r!==kt&&Mt(r),e.callbackNode=null,e.callbackPriority=0);else{if(null!==r){if(e.callbackPriority===t)return;r!==kt&&Mt(r)}15===t?(r=jo.bind(null,e),null===Ut?(Ut=[r],Qt=Tt(Pt,Yt)):Ut.push(r),r=kt):14===t?r=Zt(99,jo.bind(null,e)):r=Zt(r=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(s(358,e))}}(t),Go.bind(null,e)),e.callbackPriority=t,e.callbackNode=r}}function Go(e){if(Po=-1,Lo=Ro=0,0!==(48&ro))throw Error(s(327));var t=e.callbackNode;if(aa()&&e.callbackNode!==t)return null;var r=gt(e,e===no?oo:0);if(0===r)return null;var n=r,i=ro;ro|=16;var o=qo();for(no===e&&oo===n||(vo(),Yo(e,n));;)try{ea();break}catch(l){Jo(e,l)}if(ar(),$i.current=o,ro=i,null!==io?n=0:(no=null,oo=0,n=lo),0!==(uo&fo))Yo(e,0);else if(0!==n){if(2===n&&(ro|=64,e.hydrate&&(e.hydrate=!1,Me(e.containerInfo)),0!==(r=At(e))&&(n=Ko(e,r))),1===n)throw t=co,Yo(e,0),zo(e,r),Vo(e,zt()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=r,n){case 0:case 1:throw Error(s(345));case 2:na(e);break;case 3:if(zo(e,r),(62914560&r)===r&&10<(n=go+500-zt())){if(0!==gt(e,0))break;if(((i=e.suspendedLanes)&r)!==r){ko(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=W(na.bind(null,e),n);break}na(e);break;case 4:if(zo(e,r),(4186112&r)===r)break;for(n=e.eventTimes,i=-1;0<r;){var a=31-wt(r);o=1<<a,(a=n[a])>i&&(i=a),r&=~o}if(r=i,10<(r=(120>(r=zt()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Ki(r/1960))-r)){e.timeoutHandle=W(na.bind(null,e),r);break}na(e);break;case 5:na(e);break;default:throw Error(s(329))}}return Vo(e,zt()),e.callbackNode===t?Go.bind(null,e):null}function zo(e,t){for(t&=~po,t&=~fo,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-wt(t),n=1<<r;e[r]=-1,t&=~n}}function jo(e){if(0!==(48&ro))throw Error(s(327));if(aa(),e===no&&0!==(e.expiredLanes&oo)){var t=oo,r=Ko(e,t);0!==(uo&fo)&&(r=Ko(e,t=gt(e,t)))}else r=Ko(e,t=gt(e,0));if(0!==e.tag&&2===r&&(ro|=64,e.hydrate&&(e.hydrate=!1,Me(e.containerInfo)),0!==(t=At(e))&&(r=Ko(e,t))),1===r)throw r=co,Yo(e,0),zo(e,t),Vo(e,zt()),r;return e.finishedWork=e.current.alternate,e.finishedLanes=t,na(e),Vo(e,zt()),null}function Ho(e,t){var r=ro;ro|=1;try{return e(t)}finally{0===(ro=r)&&(vo(),Xt())}}function Wo(e,t){var r=ro;if(0!==(48&r))return e(t);ro|=1;try{if(e)return Wt(99,e.bind(null,t))}finally{ro=r,Xt()}}function Zo(e,t){$e(so,ao),ao|=t,uo|=t}function Xo(){ao=so.current,Ke(so)}function Yo(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==X&&(e.timeoutHandle=X,Z(r)),null!==io)for(r=io.return;null!==r;){var n=r;switch(n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&at();break;case 3:Ur(),Ke(rt),Ke(tt),en();break;case 5:Vr(n);break;case 4:Ur();break;case 13:case 19:Ke(Gr);break;case 10:lr(n);break;case 23:case 24:Xo()}r=r.return}no=e,io=Ea(e.current,null),oo=ao=uo=t,lo=0,co=null,po=fo=ho=0}function Jo(e,t){for(;;){var r=io;try{if(ar(),tn.current=kn,ln){for(var n=on.memoizedState;null!==n;){var i=n.queue;null!==i&&(i.pending=null),n=n.next}ln=!1}if(nn=0,sn=an=on=null,cn=!1,eo.current=null,null===r||null===r.return){lo=1,co=t,io=null;break}e:{var o=e,a=r.return,s=r,l=t;if(t=oo,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==l&&"object"===typeof l&&"function"===typeof l.then){var c=l;if(0===(2&s.mode)){var u=s.alternate;u?(s.updateQueue=u.updateQueue,s.memoizedState=u.memoizedState,s.lanes=u.lanes):(s.updateQueue=null,s.memoizedState=null)}var h=0!==(1&Gr.current),d=a;do{var f;if(f=13===d.tag){var p=d.memoizedState;if(null!==p)f=null!==p.dehydrated;else{var m=d.memoizedProps;f=void 0!==m.fallback&&(!0!==m.unstable_avoidThisFallback||!h)}}if(f){var g=d.updateQueue;if(null===g){var A=new Set;A.add(c),d.updateQueue=A}else g.add(c);if(0===(2&d.mode)){if(d.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var v=mr(-1,1);v.tag=2,gr(s,v)}s.lanes|=1;break e}l=void 0,s=t;var y=o.pingCache;if(null===y?(y=o.pingCache=new yi,l=new Set,y.set(c,l)):void 0===(l=y.get(c))&&(l=new Set,y.set(c,l)),!l.has(s)){l.add(s);var x=da.bind(null,o,c,s);c.then(x,x)}d.flags|=4096,d.lanes=t;break e}d=d.return}while(null!==d);l=Error((I(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==lo&&(lo=2),l=Ai(l,s),d=a;do{switch(d.tag){case 3:o=l,d.flags|=4096,t&=-t,d.lanes|=t,Ar(d,xi(0,o,t));break e;case 1:o=l;var b=d.type,w=d.stateNode;if(0===(64&d.flags)&&("function"===typeof b.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===Co||!Co.has(w)))){d.flags|=4096,t&=-t,d.lanes|=t,Ar(d,bi(d,o,t));break e}}d=d.return}while(null!==d)}ra(r)}catch(C){t=C,io===r&&null!==r&&(io=r=r.return);continue}break}}function qo(){var e=$i.current;return $i.current=kn,null===e?kn:e}function Ko(e,t){var r=ro;ro|=16;var n=qo();for(no===e&&oo===t||Yo(e,t);;)try{$o();break}catch(i){Jo(e,i)}if(ar(),ro=r,$i.current=n,null!==io)throw Error(s(261));return no=null,oo=0,lo}function $o(){for(;null!==io;)ta(io)}function ea(){for(;null!==io&&!It();)ta(io)}function ta(e){var t=yo(e.alternate,e,ao);e.memoizedProps=e.pendingProps,null===t?ra(e):io=t,eo.current=null}function ra(e){var t=e;do{var r=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(r=mi(r,t,ao)))return void(io=r);if(24!==(r=t).tag&&23!==r.tag||null===r.memoizedState||0!==(1073741824&ao)||0===(4&r.mode)){for(var n=0,i=r.child;null!==i;)n|=i.lanes|i.childLanes,i=i.sibling;r.childLanes=n}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(r=gi(t)))return r.flags&=2047,void(io=r);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(io=t);io=t=e}while(null!==t);0===lo&&(lo=5)}function na(e){var t=jt();return Wt(99,ia.bind(null,e,t)),null}function ia(e,t){do{aa()}while(null!==So);if(0!==(48&ro))throw Error(s(327));var r=e.finishedWork;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(s(177));e.callbackNode=null;var n=r.lanes|r.childLanes,i=n,o=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;for(var a=e.eventTimes,l=e.expirationTimes;0<o;){var c=31-wt(o),u=1<<c;i[c]=0,a[c]=-1,l[c]=-1,o&=~u}if(null!==Bo&&0===(24&n)&&Bo.has(e)&&Bo.delete(e),e===no&&(io=no=null,oo=0),1<r.flags?null!==r.lastEffect?(r.lastEffect.nextEffect=r,n=r.firstEffect):n=r:n=r.firstEffect,null!==n){i=ro,ro|=32,eo.current=null,Do=O(e.containerInfo),No=!1,xo=n;do{try{oa()}catch(v){if(null===xo)throw Error(s(330));ha(xo,v),xo=xo.nextEffect}}while(null!==xo);Do=null,xo=n;do{try{for(a=e;null!==xo;){var h=xo.flags;if(16&h&&J&&we(xo.stateNode),128&h){var d=xo.alternate;if(null!==d){var f=d.ref;null!==f&&("function"===typeof f?f(null):f.current=null)}}switch(1038&h){case 2:Pi(xo),xo.flags&=-3;break;case 6:Pi(xo),xo.flags&=-3,Ni(xo.alternate,xo);break;case 1024:xo.flags&=-1025;break;case 1028:xo.flags&=-1025,Ni(xo.alternate,xo);break;case 4:Ni(xo.alternate,xo);break;case 8:l=a,o=xo,J?Di(l,o):Bi(l,o);var p=o.alternate;_i(o),null!==p&&_i(p)}xo=xo.nextEffect}}catch(v){if(null===xo)throw Error(s(330));ha(xo,v),xo=xo.nextEffect}}while(null!==xo);No&&ne(),U(e.containerInfo),e.current=r,xo=n;do{try{for(h=e;null!==xo;){var m=xo.flags;if(36&m&&Ti(h,xo.alternate,xo),128&m){d=void 0;var g=xo.ref;if(null!==g){var A=xo.stateNode;switch(xo.tag){case 5:d=D(A);break;default:d=A}"function"===typeof g?g(d):g.current=d}}xo=xo.nextEffect}}catch(v){if(null===xo)throw Error(s(330));ha(xo,v),xo=xo.nextEffect}}while(null!==xo);xo=null,Ot(),ro=i}else e.current=r;if(Eo)Eo=!1,So=e,To=t;else for(xo=n;null!==xo;)t=xo.nextEffect,xo.nextEffect=null,8&xo.flags&&((m=xo).sibling=null,m.stateNode=null),xo=t;if(0===(n=e.pendingLanes)&&(Co=null),1===n?e===Fo?_o++:(_o=0,Fo=e):_o=0,r=r.stateNode,dt&&"function"===typeof dt.onCommitFiberRoot)try{dt.onCommitFiberRoot(ht,r,void 0,64===(64&r.current.flags))}catch(v){}if(Vo(e,zt()),bo)throw bo=!1,e=wo,wo=null,e;return 0!==(8&ro)||Xt(),null}function oa(){for(;null!==xo;){var e=xo.alternate;No||null===Do||(0!==(8&xo.flags)?R(xo,Do)&&(No=!0,re()):13===xo.tag&&Ui(e,xo)&&R(xo,Do)&&(No=!0,re()));var t=xo.flags;0!==(256&t)&&Ei(e,xo),0===(512&t)||Eo||(Eo=!0,Zt(97,(function(){return aa(),null}))),xo=xo.nextEffect}}function aa(){if(90!==To){var e=97<To?97:To;return To=90,Wt(e,ca)}return!1}function sa(e,t){Mo.push(t,e),Eo||(Eo=!0,Zt(97,(function(){return aa(),null})))}function la(e,t){Io.push(t,e),Eo||(Eo=!0,Zt(97,(function(){return aa(),null})))}function ca(){if(null===So)return!1;var e=So;if(So=null,0!==(48&ro))throw Error(s(331));var t=ro;ro|=32;var r=Io;Io=[];for(var n=0;n<r.length;n+=2){var i=r[n],o=r[n+1],a=i.destroy;if(i.destroy=void 0,"function"===typeof a)try{a()}catch(c){if(null===o)throw Error(s(330));ha(o,c)}}for(r=Mo,Mo=[],n=0;n<r.length;n+=2){i=r[n],o=r[n+1];try{var l=i.create;i.destroy=l()}catch(c){if(null===o)throw Error(s(330));ha(o,c)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return ro=t,Xt(),!0}function ua(e,t,r){gr(e,t=xi(0,t=Ai(r,t),1)),t=ko(),null!==(e=Qo(e,1))&&(bt(e,1,t),Vo(e,t))}function ha(e,t){if(3===e.tag)ua(e,e,t);else for(var r=e.return;null!==r;){if(3===r.tag){ua(r,e,t);break}if(1===r.tag){var n=r.stateNode;if("function"===typeof r.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Co||!Co.has(n))){var i=bi(r,e=Ai(t,e),1);if(gr(r,i),i=ko(),null!==(r=Qo(r,1)))bt(r,1,i),Vo(r,i);else if("function"===typeof n.componentDidCatch&&(null===Co||!Co.has(n)))try{n.componentDidCatch(t,e)}catch(o){}break}}r=r.return}}function da(e,t,r){var n=e.pingCache;null!==n&&n.delete(t),t=ko(),e.pingedLanes|=e.suspendedLanes&r,no===e&&(oo&r)===r&&(4===lo||3===lo&&(62914560&oo)===oo&&500>zt()-go?Yo(e,0):po|=r),Vo(e,t)}function fa(e,t){var r=e.stateNode;null!==r&&r.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===jt()?1:2:(0===Ro&&(Ro=uo),0===(t=yt(62914560&~Ro))&&(t=4194304))),r=ko(),null!==(e=Qo(e,t))&&(bt(e,t,r),Vo(e,r))}yo=function(e,t,r){var n=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||rt.current)Gn=!0;else{if(0===(r&n)){switch(Gn=!1,t.tag){case 3:Kn(t),Kr();break;case 5:Qr(t);break;case 1:ot(t.type)&&ct(t);break;case 4:Or(t,t.stateNode.containerInfo);break;case 10:sr(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!==(r&t.child.childLanes)?ii(e,t,r):($e(Gr,1&Gr.current),null!==(t=hi(e,t,r))?t.sibling:null);$e(Gr,1&Gr.current);break;case 19:if(n=0!==(r&t.childLanes),0!==(64&e.flags)){if(n)return ui(e,t,r);t.flags|=64}var i=t.memoizedState;if(null!==i&&(i.rendering=null,i.tail=null,i.lastEffect=null),$e(Gr,Gr.current),n)break;return null;case 23:case 24:return t.lanes=0,Zn(e,t,r)}return hi(e,t,r)}Gn=0!==(16384&e.flags)}else Gn=!1;switch(t.lanes=0,t.tag){case 2:if(n=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=it(t,tt.current),ur(t,r),i=dn(null,t,n,e,i,r),t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,ot(n)){var o=!0;ct(t)}else o=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,fr(t);var a=n.getDerivedStateFromProps;"function"===typeof a&&br(t,n,a,e),i.updater=wr,t.stateNode=i,i._reactInternals=t,Tr(t,n,e,r),t=qn(null,t,n,!0,o,r)}else t.tag=0,zn(null,t,i,r),t=t.child;return t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(o=i._init)(i._payload),t.type=i,o=t.tag=function(e){if("function"===typeof e)return Ca(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===g)return 11;if(e===y)return 14}return 2}(i),e=tr(i,e),o){case 0:t=Yn(null,t,i,e,r);break e;case 1:t=Jn(null,t,i,e,r);break e;case 11:t=jn(null,t,i,e,r);break e;case 14:t=Hn(null,t,i,tr(i.type,e),n,r);break e}throw Error(s(306,i,""))}return t;case 0:return n=t.type,i=t.pendingProps,Yn(e,t,n,i=t.elementType===n?i:tr(n,i),r);case 1:return n=t.type,i=t.pendingProps,Jn(e,t,n,i=t.elementType===n?i:tr(n,i),r);case 3:if(Kn(t),n=t.updateQueue,null===e||null===n)throw Error(s(282));if(n=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,pr(e,t),vr(t,n,null,r),(n=t.memoizedState.element)===i)Kr(),t=hi(e,t,r);else{if((o=(i=t.stateNode).hydrate)&&(K?(Hr=Qe(t.stateNode.containerInfo),jr=t,o=Wr=!0):o=!1),o){if(K&&null!=(e=i.mutableSourceEagerHydrationData))for(i=0;i<e.length;i+=2)o=e[i],a=e[i+1],Y?o._workInProgressVersionPrimary=a:o._workInProgressVersionSecondary=a,$r.push(o);for(r=Pr(t,null,n,r),t.child=r;r;)r.flags=-3&r.flags|1024,r=r.sibling}else zn(e,t,n,r),Kr();t=t.child}return t;case 5:return Qr(t),null===e&&Yr(t),n=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,a=i.children,j(n,i)?a=null:null!==o&&j(n,o)&&(t.flags|=16),Xn(e,t),zn(e,t,a,r),t.child;case 6:return null===e&&Yr(t),null;case 13:return ii(e,t,r);case 4:return Or(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Fr(t,null,n,r):zn(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,jn(e,t,n,i=t.elementType===n?i:tr(n,i),r);case 7:return zn(e,t,t.pendingProps,r),t.child;case 8:case 12:return zn(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,i=t.pendingProps,a=t.memoizedProps,sr(t,o=i.value),null!==a){var l=a.value;if(0===(o=qt(l,o)?0:0|("function"===typeof n._calculateChangedBits?n._calculateChangedBits(l,o):1073741823))){if(a.children===i.children&&!rt.current){t=hi(e,t,r);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){a=l.child;for(var u=c.firstContext;null!==u;){if(u.context===n&&0!==(u.observedBits&o)){1===l.tag&&((u=mr(-1,r&-r)).tag=2,gr(l,u)),l.lanes|=r,null!==(u=l.alternate)&&(u.lanes|=r),cr(l.return,r),c.lanes|=r;break}u=u.next}}else a=10===l.tag&&l.type===t.type?null:l.child;if(null!==a)a.return=l;else for(a=l;null!==a;){if(a===t){a=null;break}if(null!==(l=a.sibling)){l.return=a.return,a=l;break}a=a.return}l=a}}zn(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=(o=t.pendingProps).children,ur(t,r),n=n(i=hr(i,o.unstable_observedBits)),t.flags|=1,zn(e,t,n,r),t.child;case 14:return o=tr(i=t.type,t.pendingProps),Hn(e,t,i,o=tr(i.type,o),n,r);case 15:return Wn(e,t,t.type,t.pendingProps,n,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:tr(n,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,ot(n)?(e=!0,ct(t)):e=!1,ur(t,r),Er(t,n,i),Tr(t,n,i,r),qn(null,t,n,!0,e,r);case 19:return ui(e,t,r);case 23:case 24:return Zn(e,t,r)}throw Error(s(156,t.tag))};var pa={current:!1},ma=a.unstable_flushAllWithoutAsserting,ga="function"===typeof ma;function Aa(){if(void 0!==ma)return ma();for(var e=!1;aa();)e=!0;return e}function va(t){try{Aa(),function(t){if(null===qi)try{var r=("require"+Math.random()).slice(0,7);qi=(e&&e[r]).call(e,"timers").setImmediate}catch(n){qi=function(e){var t=new MessageChannel;t.port1.onmessage=e,t.port2.postMessage(void 0)}}qi(t)}((function(){Aa()?va(t):t()}))}catch(r){t(r)}}var ya=0,xa=!1;function ba(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function wa(e,t,r,n){return new ba(e,t,r,n)}function Ca(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ea(e,t){var r=e.alternate;return null===r?((r=wa(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.nextEffect=null,r.firstEffect=null,r.lastEffect=null),r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Sa(e,t,r,n,i,o){var a=2;if(n=e,"function"===typeof e)Ca(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case h:return Ta(r.children,i,o,t);case w:a=8,i|=16;break;case d:a=8,i|=1;break;case f:return(e=wa(12,r,t,8|i)).elementType=f,e.type=f,e.lanes=o,e;case A:return(e=wa(13,r,t,i)).type=A,e.elementType=A,e.lanes=o,e;case v:return(e=wa(19,r,t,i)).elementType=v,e.lanes=o,e;case C:return Ma(r,i,o,t);case E:return(e=wa(24,r,t,i)).elementType=E,e.lanes=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case p:a=10;break e;case m:a=9;break e;case g:a=11;break e;case y:a=14;break e;case x:a=16,n=null;break e;case b:a=22;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=wa(a,r,t,i)).elementType=e,t.type=n,t.lanes=o,t}function Ta(e,t,r,n){return(e=wa(7,e,n,t)).lanes=r,e}function Ma(e,t,r,n){return(e=wa(23,e,n,t)).elementType=C,e.lanes=r,e}function Ia(e,t,r){return(e=wa(6,e,null,t)).lanes=r,e}function Ba(e,t,r){return(t=wa(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function _a(e,t,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=X,this.pendingContext=this.context=null,this.hydrate=r,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=xt(0),this.expirationTimes=xt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xt(0),K&&(this.mutableSourceEagerHydrationData=null)}function Fa(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw Error(s(268,Object.keys(e)))}return null===(e=P(t))?null:e.stateNode}function Pa(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function Ra(e,t){Pa(e,t),(e=e.alternate)&&Pa(e,t)}function La(e){return null===(e=P(e))?null:e.stateNode}function Da(){return null}return n.IsThisRendererActing=pa,n.act=function(e){function t(){ya--,to.current=r,pa.current=n}!1===xa&&(xa=!0,console.error("act(...) is not supported in production builds of React, and might not behave as expected.")),ya++;var r=to.current,n=pa.current;to.current=!0,pa.current=!0;try{var i=Ho(e)}catch(o){throw t(),o}if(null!==i&&"object"===typeof i&&"function"===typeof i.then)return{then:function(e,n){i.then((function(){1<ya||!0===ga&&!0===r?(t(),e()):va((function(r){t(),r?n(r):e()}))}),(function(e){t(),n(e)}))}};try{1!==ya||!1!==ga&&!1!==r||Aa(),t()}catch(o){throw t(),o}return{then:function(e){e()}}},n.attemptContinuousHydration=function(e){13===e.tag&&(Uo(e,67108864,ko()),Ra(e,67108864))},n.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=ko(),r=Oo(e);Uo(e,r,t),Ra(e,r)}},n.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.hydrate){var r=mt(t.pendingLanes);t.expiredLanes|=r&t.pendingLanes,Vo(t,zt()),0===(48&ro)&&(vo(),Xt())}break;case 13:var n=ko();Wo((function(){return Uo(e,1,n)})),Ra(e,4)}},n.attemptUserBlockingHydration=function(e){13===e.tag&&(Uo(e,4,ko()),Ra(e,4))},n.batchedEventUpdates=function(e,t){var r=ro;ro|=2;try{return e(t)}finally{0===(ro=r)&&(vo(),Xt())}},n.batchedUpdates=Ho,n.createComponentSelector=function(e){return{$$typeof:Qi,value:e}},n.createContainer=function(e,t,r){return e=new _a(e,t,r),t=wa(3,null,null,2===t?7:1===t?3:0),e.current=t,t.stateNode=e,fr(t),e},n.createHasPsuedoClassSelector=function(e){return{$$typeof:Vi,value:e}},n.createPortal=function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:u,key:null==n?null:""+n,children:e,containerInfo:t,implementation:r}},n.createRoleSelector=function(e){return{$$typeof:Gi,value:e}},n.createTestNameSelector=function(e){return{$$typeof:zi,value:e}},n.createTextSelector=function(e){return{$$typeof:ji,value:e}},n.deferredUpdates=function(e){return Wt(97,e)},n.discreteUpdates=function(e,t,r,n,i){var o=ro;ro|=4;try{return Wt(98,e.bind(null,t,r,n,i))}finally{0===(ro=o)&&(vo(),Xt())}},n.findAllNodes=Ji,n.findBoundingRects=function(e,t){if(!oe)throw Error(s(363));t=Ji(e,t),e=[];for(var r=0;r<t.length;r++)e.push(se(t[r]));for(t=e.length-1;0<t;t--)for(var n=(r=e[t]).x,i=n+r.width,o=r.y,a=o+r.height,l=t-1;0<=l;l--)if(t!==l){var c=e[l],u=c.x,h=u+c.width,d=c.y,f=d+c.height;if(n>=u&&o>=d&&i<=h&&a<=f){e.splice(t,1);break}if(!(n!==u||r.width!==c.width||f<o||d>a)){d>o&&(c.height+=d-o,c.y=o),f<a&&(c.height=a-d),e.splice(t,1);break}if(!(o!==d||r.height!==c.height||h<n||u>i)){u>n&&(c.width+=u-n,c.x=n),h<i&&(c.width=i-u),e.splice(t,1);break}}return e},n.findHostInstance=Fa,n.findHostInstanceWithNoPortals=function(e){return null===(e=function(e){if(!(e=F(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child&&4!==t.tag)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}(e))?null:20===e.tag?e.stateNode.instance:e.stateNode},n.findHostInstanceWithWarning=function(e){return Fa(e)},n.flushControlled=function(e){var t=ro;ro|=1;try{Wt(99,e)}finally{0===(ro=t)&&(vo(),Xt())}},n.flushDiscreteUpdates=function(){0===(49&ro)&&(function(){if(null!==Bo){var e=Bo;Bo=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,Vo(e,zt())}))}Xt()}(),aa())},n.flushPassiveEffects=aa,n.flushSync=Wo,n.focusWithin=function(e,t){if(!oe)throw Error(s(363));for(t=Yi(e=Wi(e),t),t=Array.from(t),e=0;e<t.length;){var r=t[e++];if(!ce(r)){if(5===r.tag&&he(r.stateNode))return!0;for(r=r.child;null!==r;)t.push(r),r=r.sibling}}return!1},n.getCurrentUpdateLanePriority=function(){return ft},n.getFindAllNodesFailureDescription=function(e,t){if(!oe)throw Error(s(363));var r=0,n=[];e=[Wi(e),0];for(var i=0;i<e.length;){var o=e[i++],a=e[i++],l=t[a];if((5!==o.tag||!ce(o))&&(Zi(o,l)&&(n.push(Xi(l)),++a>r&&(r=a)),a<t.length))for(o=o.child;null!==o;)e.push(o,a),o=o.sibling}if(r<t.length){for(e=[];r<t.length;r++)e.push(Xi(t[r]));return"findAllNodes was able to match part of the selector:\n  "+n.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},n.getPublicRootInstance=function(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:return D(e.child.stateNode);default:return e.child.stateNode}},n.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:l.ReactCurrentDispatcher,findHostInstanceByFiber:La,findFiberByHostInstance:e.findFiberByHostInstance||Da,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t.isDisabled&&t.supportsFiber)try{ht=t.inject(e),dt=t}catch(r){}e=!0}return e},n.observeVisibleRects=function(e,t,r,n){if(!oe)throw Error(s(363));e=Ji(e,t);var i=de(e,r,n).disconnect;return{disconnect:function(){i()}}},n.registerMutableSourceForHydration=function(e,t){var r=t._getVersion;r=r(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r)},n.runWithPriority=function(e,t){var r=ft;try{return ft=e,t()}finally{ft=r}},n.shouldSuspend=function(){return!1},n.unbatchedUpdates=function(e,t){var r=ro;ro&=-2,ro|=8;try{return e(t)}finally{0===(ro=r)&&(vo(),Xt())}},n.updateContainer=function(e,t,r,n){var i=t.current,o=ko(),a=Oo(i);e:if(r){t:{if(B(r=r._reactInternals)!==r||1!==r.tag)throw Error(s(170));var l=r;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(ot(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(s(171))}if(1===r.tag){var c=r.type;if(ot(c)){r=lt(r,c,l);break e}}r=l}else r=et;return null===t.context?t.context=r:t.pendingContext=r,(t=mr(o,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),gr(i,t),Uo(i,a,o),a},n}},5861:function(e,t,r){"use strict";e.exports=r(9096)},6458:function(e,t,r){"use strict";r.r(t);var n=r(7378),i="/Users/brians/git/react-slider/src/components/ReactSlider/ReactSlider.jsx";function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault(),!1}function l(e){return null==e?[]:Array.isArray(e)?e.slice():[e]}function c(e){return null!==e&&1===e.length?e[0]:e.slice()}function u(e){Object.keys(e).forEach((function(t){"undefined"!==typeof document&&document.addEventListener(t,e[t],!1)}))}function h(e,t){return d(function(e,t){var r=e;r<=t.min&&(r=t.min);r>=t.max&&(r=t.max);return r}(e,t),t)}function d(e,t){var r=(e-t.min)%t.step,n=e-r;return 2*Math.abs(r)>=t.step&&(n+=r>0?t.step:-t.step),parseFloat(n.toFixed(5))}var f=function(e){var t,r;function i(t){var r;(r=e.call(this,t)||this).onKeyUp=function(){r.onEnd()},r.onMouseUp=function(){r.onEnd(r.getMouseEventMap())},r.onTouchEnd=function(){r.onEnd(r.getTouchEventMap())},r.onBlur=function(){r.setState({index:-1},r.onEnd(r.getKeyDownEventMap()))},r.onMouseMove=function(e){r.setState({pending:!0});var t=r.getMousePosition(e),n=r.getDiffPosition(t[0]),i=r.getValueFromPosition(n);r.move(i)},r.onTouchMove=function(e){if(!(e.touches.length>1)){r.setState({pending:!0});var t=r.getTouchPosition(e);if("undefined"===typeof r.isScrolling){var n=t[0]-r.startPosition[0],i=t[1]-r.startPosition[1];r.isScrolling=Math.abs(i)>Math.abs(n)}if(r.isScrolling)r.setState({index:-1});else{var o=r.getDiffPosition(t[0]),a=r.getValueFromPosition(o);r.move(a)}}},r.onKeyDown=function(e){if(!(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey))switch(r.setState({pending:!0}),e.key){case"ArrowLeft":case"ArrowDown":case"Left":case"Down":e.preventDefault(),r.moveDownByStep();break;case"ArrowRight":case"ArrowUp":case"Right":case"Up":e.preventDefault(),r.moveUpByStep();break;case"Home":e.preventDefault(),r.move(r.props.min);break;case"End":e.preventDefault(),r.move(r.props.max);break;case"PageDown":e.preventDefault(),r.moveDownByStep(r.props.pageFn(r.props.step));break;case"PageUp":e.preventDefault(),r.moveUpByStep(r.props.pageFn(r.props.step))}},r.onSliderMouseDown=function(e){if(!r.props.disabled&&2!==e.button){if(r.setState({pending:!0}),!r.props.snapDragDisabled){var t=r.getMousePosition(e);r.forceValueFromPosition(t[0],(function(e){r.start(e,t[0]),u(r.getMouseEventMap())}))}s(e)}},r.onSliderClick=function(e){if(!r.props.disabled&&r.props.onSliderClick&&!r.hasMoved){var t=r.getMousePosition(e),n=h(r.calcValue(r.calcOffsetFromPosition(t[0])),r.props);r.props.onSliderClick(n)}},r.createOnKeyDown=function(e){return function(t){r.props.disabled||(r.start(e),u(r.getKeyDownEventMap()),s(t))}},r.createOnMouseDown=function(e){return function(t){if(!r.props.disabled&&2!==t.button){r.setState({pending:!0});var n=r.getMousePosition(t);r.start(e,n[0]),u(r.getMouseEventMap()),s(t)}}},r.createOnTouchStart=function(e){return function(t){if(!(r.props.disabled||t.touches.length>1)){r.setState({pending:!0});var n=r.getTouchPosition(t);r.startPosition=n,r.isScrolling=void 0,r.start(e,n[0]),u(r.getTouchEventMap()),function(e){e.stopPropagation&&e.stopPropagation()}(t)}}},r.handleResize=function(){var e=window.setTimeout((function(){r.pendingResizeTimeouts.shift(),r.resize()}),0);r.pendingResizeTimeouts.push(e)},r.renderThumb=function(e,t){var n=r.props.thumbClassName+" "+r.props.thumbClassName+"-"+t+" "+(r.state.index===t?r.props.thumbActiveClassName:""),i={ref:function(e){r["thumb"+t]=e},key:r.props.thumbClassName+"-"+t,className:n,style:e,onMouseDown:r.createOnMouseDown(t),onTouchStart:r.createOnTouchStart(t),onFocus:r.createOnKeyDown(t),tabIndex:0,role:"slider","aria-orientation":r.props.orientation,"aria-valuenow":r.state.value[t],"aria-valuemin":r.props.min,"aria-valuemax":r.props.max,"aria-label":Array.isArray(r.props.ariaLabel)?r.props.ariaLabel[t]:r.props.ariaLabel,"aria-labelledby":Array.isArray(r.props.ariaLabelledby)?r.props.ariaLabelledby[t]:r.props.ariaLabelledby},o={index:t,value:c(r.state.value),valueNow:r.state.value[t]};return r.props.ariaValuetext&&(i["aria-valuetext"]="string"===typeof r.props.ariaValuetext?r.props.ariaValuetext:r.props.ariaValuetext(o)),r.props.renderThumb(i,o)},r.renderTrack=function(e,t,n){var i={key:r.props.trackClassName+"-"+e,className:r.props.trackClassName+" "+r.props.trackClassName+"-"+e,style:r.buildTrackStyle(t,r.state.upperBound-n)},o={index:e,value:c(r.state.value)};return r.props.renderTrack(i,o)};var n=l(t.value);n.length||(n=l(t.defaultValue)),r.pendingResizeTimeouts=[];for(var i=[],o=0;o<n.length;o+=1)n[o]=h(n[o],t),i.push(o);return r.state={index:-1,upperBound:0,sliderLength:0,value:n,zIndices:i},r}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,a(t,r);var o=i.prototype;return o.componentDidMount=function(){"undefined"!==typeof window&&(window.addEventListener("resize",this.handleResize),this.resize())},i.getDerivedStateFromProps=function(e,t){var r=l(e.value);return r.length?t.pending?null:{value:r.map((function(t){return h(t,e)}))}:null},o.componentDidUpdate=function(){0===this.state.upperBound&&this.resize()},o.componentWillUnmount=function(){this.clearPendingResizeTimeouts(),"undefined"!==typeof window&&window.removeEventListener("resize",this.handleResize)},o.onEnd=function(e){e&&function(e){Object.keys(e).forEach((function(t){"undefined"!==typeof document&&document.removeEventListener(t,e[t],!1)}))}(e),this.hasMoved&&this.fireChangeEvent("onAfterChange"),this.setState({pending:!1}),this.hasMoved=!1},o.getValue=function(){return c(this.state.value)},o.getClosestIndex=function(e){for(var t=Number.MAX_VALUE,r=-1,n=this.state.value,i=n.length,o=0;o<i;o+=1){var a=this.calcOffset(n[o]),s=Math.abs(e-a);s<t&&(t=s,r=o)}return r},o.getMousePosition=function(e){return[e["page"+this.axisKey()],e["page"+this.orthogonalAxisKey()]]},o.getTouchPosition=function(e){var t=e.touches[0];return[t["page"+this.axisKey()],t["page"+this.orthogonalAxisKey()]]},o.getKeyDownEventMap=function(){return{keydown:this.onKeyDown,keyup:this.onKeyUp,focusout:this.onBlur}},o.getMouseEventMap=function(){return{mousemove:this.onMouseMove,mouseup:this.onMouseUp}},o.getTouchEventMap=function(){return{touchmove:this.onTouchMove,touchend:this.onTouchEnd}},o.getValueFromPosition=function(e){var t=e/(this.state.sliderLength-this.state.thumbSize)*(this.props.max-this.props.min);return h(this.state.startValue+t,this.props)},o.getDiffPosition=function(e){var t=e-this.state.startPosition;return this.props.invert&&(t*=-1),t},o.resize=function(){var e=this.slider,t=this.thumb0;if(e&&t){var r=this.sizeKey(),n=e.getBoundingClientRect(),i=e[r],o=n[this.posMaxKey()],a=n[this.posMinKey()],s=t.getBoundingClientRect()[r.replace("client","").toLowerCase()],l=i-s,c=Math.abs(o-a);this.state.upperBound===l&&this.state.sliderLength===c&&this.state.thumbSize===s||this.setState({upperBound:l,sliderLength:c,thumbSize:s})}},o.calcOffset=function(e){var t=this.props.max-this.props.min;return 0===t?0:(e-this.props.min)/t*this.state.upperBound},o.calcValue=function(e){return e/this.state.upperBound*(this.props.max-this.props.min)+this.props.min},o.calcOffsetFromPosition=function(e){var t=this.slider.getBoundingClientRect(),r=t[this.posMaxKey()],n=t[this.posMinKey()],i=e-(window["page"+this.axisKey()+"Offset"]+(this.props.invert?r:n));return this.props.invert&&(i=this.state.sliderLength-i),i-=this.state.thumbSize/2},o.forceValueFromPosition=function(e,t){var r=this,n=this.calcOffsetFromPosition(e),i=this.getClosestIndex(n),o=h(this.calcValue(n),this.props),a=this.state.value.slice();a[i]=o;for(var s=0;s<a.length-1;s+=1)if(a[s+1]-a[s]<this.props.minDistance)return;this.fireChangeEvent("onBeforeChange"),this.hasMoved=!0,this.setState({value:a},(function(){t(i),r.fireChangeEvent("onChange")}))},o.clearPendingResizeTimeouts=function(){do{var e=this.pendingResizeTimeouts.shift();clearTimeout(e)}while(this.pendingResizeTimeouts.length)},o.start=function(e,t){var r=this["thumb"+e];r&&r.focus();var n=this.state.zIndices;n.splice(n.indexOf(e),1),n.push(e),this.setState((function(r){return{startValue:r.value[e],startPosition:void 0!==t?t:r.startPosition,index:e,zIndices:n}}))},o.moveUpByStep=function(e){void 0===e&&(e=this.props.step);var t=h(this.state.value[this.state.index]+e,this.props);this.move(Math.min(t,this.props.max))},o.moveDownByStep=function(e){void 0===e&&(e=this.props.step);var t=h(this.state.value[this.state.index]-e,this.props);this.move(Math.max(t,this.props.min))},o.move=function(e){var t=this.state,r=t.index,n=t.value,i=n.length,o=n[r];if(e!==o){this.hasMoved||this.fireChangeEvent("onBeforeChange"),this.hasMoved=!0;var a=this.props,s=a.pearling,l=a.max,c=a.min,u=a.minDistance;if(!s){if(r>0){var h=n[r-1];e<h+u&&(e=h+u)}if(r<i-1){var d=n[r+1];e>d-u&&(e=d-u)}}n[r]=e,s&&i>1&&(e>o?(this.pushSucceeding(n,u,r),function(e,t,r,n){for(var i=0;i<e;i+=1){var o=n-i*r;t[e-1-i]>o&&(t[e-1-i]=o)}}(i,n,u,l)):e<o&&(this.pushPreceding(n,u,r),function(e,t,r,n){for(var i=0;i<e;i+=1){var o=n+i*r;t[i]<o&&(t[i]=o)}}(i,n,u,c))),this.setState({value:n},this.fireChangeEvent.bind(this,"onChange"))}},o.pushSucceeding=function(e,t,r){var n,i;for(i=e[n=r]+t;null!==e[n+1]&&i>e[n+1];i=e[n+=1]+t)e[n+1]=d(i,this.props)},o.pushPreceding=function(e,t,r){for(var n=r,i=e[n]-t;null!==e[n-1]&&i<e[n-1];i=e[n-=1]-t)e[n-1]=d(i,this.props)},o.axisKey=function(){return"vertical"===this.props.orientation?"Y":"X"},o.orthogonalAxisKey=function(){return"vertical"===this.props.orientation?"X":"Y"},o.posMinKey=function(){return"vertical"===this.props.orientation?this.props.invert?"bottom":"top":this.props.invert?"right":"left"},o.posMaxKey=function(){return"vertical"===this.props.orientation?this.props.invert?"top":"bottom":this.props.invert?"left":"right"},o.sizeKey=function(){return"vertical"===this.props.orientation?"clientHeight":"clientWidth"},o.fireChangeEvent=function(e){this.props[e]&&this.props[e](c(this.state.value),this.state.index)},o.buildThumbStyle=function(e,t){var r={position:"absolute",touchAction:"none",willChange:this.state.index>=0?this.posMinKey():"",zIndex:this.state.zIndices.indexOf(t)+1};return r[this.posMinKey()]=e+"px",r},o.buildTrackStyle=function(e,t){var r={position:"absolute",willChange:this.state.index>=0?this.posMinKey()+","+this.posMaxKey():""};return r[this.posMinKey()]=e,r[this.posMaxKey()]=t,r},o.buildMarkStyle=function(e){var t;return(t={position:"absolute"})[this.posMinKey()]=e,t},o.renderThumbs=function(e){for(var t=e.length,r=[],n=0;n<t;n+=1)r[n]=this.buildThumbStyle(e[n],n);for(var i=[],o=0;o<t;o+=1)i[o]=this.renderThumb(r[o],o);return i},o.renderTracks=function(e){var t=[],r=e.length-1;t.push(this.renderTrack(0,0,e[0]));for(var n=0;n<r;n+=1)t.push(this.renderTrack(n+1,e[n],e[n+1]));return t.push(this.renderTrack(r+1,e[r],this.state.upperBound)),t},o.renderMarks=function(){var e=this,t=this.props.marks,r=this.props.max-this.props.min+1;return"boolean"===typeof t?t=Array.from({length:r}).map((function(e,t){return t})):"number"===typeof t&&(t=Array.from({length:r}).map((function(e,t){return t})).filter((function(e){return e%t===0}))),t.map(parseFloat).sort((function(e,t){return e-t})).map((function(t){var r=e.calcOffset(t),n={key:t,className:e.props.markClassName,style:e.buildMarkStyle(r)};return e.props.renderMark(n)}))},o.render=function(){for(var e=this,t=[],r=this.state.value,i=r.length,o=0;o<i;o+=1)t[o]=this.calcOffset(r[o],o);var a=this.props.withTracks?this.renderTracks(t):null,s=this.renderThumbs(t),l=this.props.marks?this.renderMarks():null;return n.createElement("div",{ref:function(t){e.slider=t},style:{position:"relative"},className:this.props.className+(this.props.disabled?" disabled":""),onMouseDown:this.onSliderMouseDown,onClick:this.onSliderClick},a,s,l)},i}(n.Component);f.displayName="ReactSlider",f.defaultProps={min:0,max:100,step:1,pageFn:function(e){return 10*e},minDistance:0,defaultValue:0,orientation:"horizontal",className:"slider",thumbClassName:"thumb",thumbActiveClassName:"active",trackClassName:"track",markClassName:"mark",withTracks:!0,pearling:!1,disabled:!1,snapDragDisabled:!1,invert:!1,marks:[],renderThumb:function(e){return n.createElement("div",o({},e,{__self:f,__source:{fileName:i,lineNumber:353,columnNumber:31}}))},renderTrack:function(e){return n.createElement("div",o({},e,{__self:f,__source:{fileName:i,lineNumber:354,columnNumber:31}}))},renderMark:function(e){return n.createElement("span",o({},e,{__self:f,__source:{fileName:i,lineNumber:355,columnNumber:30}}))}},f.propTypes={},t.default=f},2380:function(e,t){var r,n,i;"undefined"!==typeof self&&self,n=[],void 0===(i="function"===typeof(r=function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");var t=this.disjunction();this.consumeChar("/");for(var r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":s(r,"global");break;case"i":s(r,"ignoreCase");break;case"m":s(r,"multiLine");break;case"u":s(r,"unicode");break;case"y":s(r,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:t,loc:this.loc(0)}},e.prototype.disjunction=function(){var e=[],t=this.idx;for(e.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(t)}},e.prototype.alternative=function(){for(var e=[],t=this.idx;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(t)}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){var e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":var t;switch(this.consumeChar("?"),this.popChar()){case"=":t="Lookahead";break;case"!":t="NegativeLookahead"}l(t);var r=this.disjunction();return this.consumeChar(")"),{type:t,value:r,loc:this.loc(e)}}c()},e.prototype.quantifier=function(e){var t,r=this.idx;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":var n=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:n,atMost:n};break;case",":t=this.isDigit()?{atLeast:n,atMost:this.integerIncludingZero()}:{atLeast:n,atMost:1/0},this.consumeChar("}")}if(!0===e&&void 0===t)return;l(t)}if(!0!==e||void 0!==t)return l(t),"?"===this.peekChar(0)?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t.loc=this.loc(r),t},e.prototype.atom=function(){var e,t=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group()}return void 0===e&&this.isPatternCharacter()&&(e=this.patternCharacter()),l(e),e.loc=this.loc(t),this.isQuantifier()&&(e.quantifier=this.quantifier()),e},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[o("\n"),o("\r"),o("\u2028"),o("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){return{type:"GroupBackReference",value:this.positiveInteger()}},e.prototype.characterClassEscape=function(){var e,t=!1;switch(this.popChar()){case"d":e=u;break;case"D":e=u,t=!0;break;case"s":e=d;break;case"S":e=d,t=!0;break;case"w":e=h;break;case"W":e=h,t=!0}return l(e),{type:"Set",value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case"f":e=o("\f");break;case"n":e=o("\n");break;case"r":e=o("\r");break;case"t":e=o("\t");break;case"v":e=o("\v")}return l(e),{type:"Character",value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var e=this.popChar();if(!1===/[a-zA-Z]/.test(e))throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:o("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){return{type:"Character",value:o(this.popChar())}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:return{type:"Character",value:o(this.popChar())}}},e.prototype.characterClass=function(){var e=[],t=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),t=!0);this.isClassAtom();){var r=this.classAtom();if("Character"===r.type&&this.isRangeDash()){this.consumeChar("-");var n=this.classAtom();if("Character"===n.type){if(n.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:n.value})}else a(r.value,e),e.push(o("-")),a(n.value,e)}else a(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:o("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++}var t=this.disjunction();this.consumeChar(")");var r={type:"Group",capturing:e,value:t};return e&&(r.idx=this.groupIdx),r},e.prototype.positiveInteger=function(){var e=this.popChar();if(!1===i.test(e))throw Error("Expecting a positive integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(!1===n.test(e))throw Error("Expecting an integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:o(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return"-"===this.peekChar()&&this.isClassAtom(1)},e.prototype.isDigit=function(){return n.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){switch(void 0===e&&(e=0),this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return void 0!==this.quantifier(!0)}catch(t){return!1}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(e){for(var t="",n=0;n<e;n++){var i=this.popChar();if(!1===r.test(i))throw Error("Expecting a HexDecimal digits");t+=i}return{type:"Character",value:parseInt(t,16)}},e.prototype.peekChar=function(e){return void 0===e&&(e=0),this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);return this.consumeChar(),e},e.prototype.consumeChar=function(e){if(void 0!==e&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++},e.prototype.loc=function(e){return{begin:e,end:this.idx}};var t,r=/[0-9a-fA-F]/,n=/[0-9]/,i=/[1-9]/;function o(e){return e.charCodeAt(0)}function a(e,t){void 0!==e.length?e.forEach((function(e){t.push(e)})):t.push(e)}function s(e,t){if(!0===e[t])throw"duplicate flag "+t;e[t]=!0}function l(e){if(void 0===e)throw Error("Internal Error - Should never get here!")}function c(){throw Error("Internal Error - Should never get here!")}var u=[];for(t=o("0");t<=o("9");t++)u.push(t);var h=[o("_")].concat(u);for(t=o("a");t<=o("z");t++)h.push(t);for(t=o("A");t<=o("Z");t++)h.push(t);var d=[o(" "),o("\f"),o("\n"),o("\r"),o("\t"),o("\v"),o("\t"),o("\xa0"),o("\u1680"),o("\u2000"),o("\u2001"),o("\u2002"),o("\u2003"),o("\u2004"),o("\u2005"),o("\u2006"),o("\u2007"),o("\u2008"),o("\u2009"),o("\u200a"),o("\u2028"),o("\u2029"),o("\u202f"),o("\u205f"),o("\u3000"),o("\ufeff")];function f(){}return f.prototype.visitChildren=function(e){for(var t in e){var r=e[t];e.hasOwnProperty(t)&&(void 0!==r.type?this.visit(r):Array.isArray(r)&&r.forEach((function(e){this.visit(e)}),this))}},f.prototype.visit=function(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e)}this.visitChildren(e)},f.prototype.visitPattern=function(e){},f.prototype.visitFlags=function(e){},f.prototype.visitDisjunction=function(e){},f.prototype.visitAlternative=function(e){},f.prototype.visitStartAnchor=function(e){},f.prototype.visitEndAnchor=function(e){},f.prototype.visitWordBoundary=function(e){},f.prototype.visitNonWordBoundary=function(e){},f.prototype.visitLookahead=function(e){},f.prototype.visitNegativeLookahead=function(e){},f.prototype.visitCharacter=function(e){},f.prototype.visitSet=function(e){},f.prototype.visitGroup=function(e){},f.prototype.visitGroupBackReference=function(e){},f.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:f,VERSION:"0.5.0"}})?r.apply(t,n):r)||(e.exports=i)},9400:function(e){"use strict";e.exports=(e,t)=>{if("string"!==typeof e||"string"!==typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]}},7443:function(e){e.exports=function(){var e=function(){function t(e){return i.appendChild(e.dom),e}function r(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";n=e}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),r(++n%i.children.length)}),!1);var o=(performance||Date).now(),a=o,s=0,l=t(new e.Panel("FPS","#0ff","#002")),c=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:i,addPanel:t,showPanel:r,begin:function(){o=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-o,200),e>a+1e3&&(l.update(1e3*s/(e-a),100),a=e,s=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:i,setMode:r}};return e.Panel=function(e,t,r){var n=1/0,i=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,c=3*a,u=2*a,h=3*a,d=15*a,f=74*a,p=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=r,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,c,u),g.fillRect(h,d,f,p),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(h,d,f,p),{dom:m,update:function(l,A){n=Math.min(n,l),i=Math.max(i,l),g.fillStyle=r,g.globalAlpha=1,g.fillRect(0,0,s,d),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(n)+"-"+o(i)+")",c,u),g.drawImage(m,h+a,d,f-a,p,h,d,f-a,p),g.fillRect(h+f-a,d,a,p),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(h+f-a,d,a,o((1-l/A)*p))}}},e}()},9742:function(e){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},394:function(e,t,r){"use strict";r.d(t,{A:function(){return d}});var n=r(4649),i=r(6173);const o={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},a={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},s={x:0,y:0},l={camera:new i.Matrix4,gizmos:new i.Matrix4},c={type:"change"},u={type:"start"},h={type:"end"};class d extends i.EventDispatcher{constructor(e,t=null,r=null){super(),(0,n.Z)(this,"camera",void 0),(0,n.Z)(this,"domElement",void 0),(0,n.Z)(this,"scene",void 0),(0,n.Z)(this,"mouseActions",void 0),(0,n.Z)(this,"_mouseOp",void 0),(0,n.Z)(this,"_v2_1",void 0),(0,n.Z)(this,"_v3_1",void 0),(0,n.Z)(this,"_v3_2",void 0),(0,n.Z)(this,"_m4_1",void 0),(0,n.Z)(this,"_m4_2",void 0),(0,n.Z)(this,"_quat",void 0),(0,n.Z)(this,"_translationMatrix",void 0),(0,n.Z)(this,"_rotationMatrix",void 0),(0,n.Z)(this,"_scaleMatrix",void 0),(0,n.Z)(this,"_rotationAxis",void 0),(0,n.Z)(this,"_cameraMatrixState",void 0),(0,n.Z)(this,"_cameraProjectionState",void 0),(0,n.Z)(this,"_fovState",void 0),(0,n.Z)(this,"_upState",void 0),(0,n.Z)(this,"_zoomState",void 0),(0,n.Z)(this,"_nearPos",void 0),(0,n.Z)(this,"_farPos",void 0),(0,n.Z)(this,"_gizmoMatrixState",void 0),(0,n.Z)(this,"_up0",void 0),(0,n.Z)(this,"_zoom0",void 0),(0,n.Z)(this,"_fov0",void 0),(0,n.Z)(this,"_initialNear",void 0),(0,n.Z)(this,"_nearPos0",void 0),(0,n.Z)(this,"_initialFar",void 0),(0,n.Z)(this,"_farPos0",void 0),(0,n.Z)(this,"_cameraMatrixState0",void 0),(0,n.Z)(this,"_gizmoMatrixState0",void 0),(0,n.Z)(this,"_button",void 0),(0,n.Z)(this,"_touchStart",void 0),(0,n.Z)(this,"_touchCurrent",void 0),(0,n.Z)(this,"_input",void 0),(0,n.Z)(this,"_switchSensibility",void 0),(0,n.Z)(this,"_startFingerDistance",void 0),(0,n.Z)(this,"_currentFingerDistance",void 0),(0,n.Z)(this,"_startFingerRotation",void 0),(0,n.Z)(this,"_currentFingerRotation",void 0),(0,n.Z)(this,"_devPxRatio",void 0),(0,n.Z)(this,"_downValid",void 0),(0,n.Z)(this,"_nclicks",void 0),(0,n.Z)(this,"_downEvents",void 0),(0,n.Z)(this,"_clickStart",void 0),(0,n.Z)(this,"_maxDownTime",void 0),(0,n.Z)(this,"_maxInterval",void 0),(0,n.Z)(this,"_posThreshold",void 0),(0,n.Z)(this,"_movementThreshold",void 0),(0,n.Z)(this,"_currentCursorPosition",void 0),(0,n.Z)(this,"_startCursorPosition",void 0),(0,n.Z)(this,"_grid",void 0),(0,n.Z)(this,"_gridPosition",void 0),(0,n.Z)(this,"_gizmos",void 0),(0,n.Z)(this,"_curvePts",void 0),(0,n.Z)(this,"_timeStart",void 0),(0,n.Z)(this,"_animationId",void 0),(0,n.Z)(this,"focusAnimationTime",void 0),(0,n.Z)(this,"_timePrev",void 0),(0,n.Z)(this,"_timeCurrent",void 0),(0,n.Z)(this,"_anglePrev",void 0),(0,n.Z)(this,"_angleCurrent",void 0),(0,n.Z)(this,"_cursorPosPrev",void 0),(0,n.Z)(this,"_cursorPosCurr",void 0),(0,n.Z)(this,"_wPrev",void 0),(0,n.Z)(this,"_wCurr",void 0),(0,n.Z)(this,"adjustNearFar",void 0),(0,n.Z)(this,"scaleFactor",void 0),(0,n.Z)(this,"dampingFactor",void 0),(0,n.Z)(this,"wMax",void 0),(0,n.Z)(this,"enableAnimations",void 0),(0,n.Z)(this,"enableGrid",void 0),(0,n.Z)(this,"cursorZoom",void 0),(0,n.Z)(this,"minFov",void 0),(0,n.Z)(this,"maxFov",void 0),(0,n.Z)(this,"enabled",void 0),(0,n.Z)(this,"enablePan",void 0),(0,n.Z)(this,"enableRotate",void 0),(0,n.Z)(this,"enableZoom",void 0),(0,n.Z)(this,"minDistance",void 0),(0,n.Z)(this,"maxDistance",void 0),(0,n.Z)(this,"minZoom",void 0),(0,n.Z)(this,"maxZoom",void 0),(0,n.Z)(this,"target",void 0),(0,n.Z)(this,"_currentTarget",void 0),(0,n.Z)(this,"_tbRadius",void 0),(0,n.Z)(this,"_state",void 0),(0,n.Z)(this,"onWindowResize",(()=>{const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;if(this.camera){const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e)}const t=this._tbRadius/e,r=new i.EllipseCurve(0,0,t,t).getPoints(this._curvePts),n=(new i.BufferGeometry).setFromPoints(r);for(const i in this._gizmos.children){this._gizmos.children[i].geometry=n}this.dispatchEvent(c)})),(0,n.Z)(this,"onContextMenu",(e=>{if(this.enabled)for(let t=0;t<this.mouseActions.length;t++)if(2==this.mouseActions[t].mouse){e.preventDefault();break}})),(0,n.Z)(this,"onPointerCancel",(()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=a.NONE})),(0,n.Z)(this,"onPointerDown",(e=>{if(0==e.button&&e.isPrimary?(this._downValid=!0,this._downEvents.push(e)):this._downValid=!1,"touch"==e.pointerType&&this._input!=a.CURSOR)switch(this._touchStart.push(e),this._touchCurrent.push(e),this._input){case a.NONE:this._input=a.ONE_FINGER,this.onSinglePanStart(e,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case a.ONE_FINGER:case a.ONE_FINGER_SWITCHED:this._input=a.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case a.TWO_FINGER:this._input=a.MULT_FINGER,this.onTriplePanStart()}else if("touch"!=e.pointerType&&this._input==a.NONE){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT"),this._mouseOp=this.getOpFromAction(e.button,t),this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=a.CURSOR,this._button=e.button,this.onSinglePanStart(e,this._mouseOp))}})),(0,n.Z)(this,"onPointerMove",(e=>{if("touch"==e.pointerType&&this._input!=a.CURSOR)switch(this._input){case a.ONE_FINGER:this.updateTouchEvent(e),this.onSinglePanMove(e,o.ROTATE);break;case a.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],e)*this._devPxRatio>=this._switchSensibility){this._input=a.ONE_FINGER,this.updateTouchEvent(e),this.onSinglePanStart(e,"ROTATE");break}break;case a.TWO_FINGER:this.updateTouchEvent(e),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case a.MULT_FINGER:this.updateTouchEvent(e),this.onTriplePanMove()}else if("touch"!=e.pointerType&&this._input==a.CURSOR){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");const r=this.getOpStateFromAction(this._button,t);r&&this.onSinglePanMove(e,r)}if(this._downValid){this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],e)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}})),(0,n.Z)(this,"onPointerUp",(e=>{if("touch"==e.pointerType&&this._input!=a.CURSOR){const t=this._touchCurrent.length;for(let r=0;r<t;r++)if(this._touchCurrent[r].pointerId==e.pointerId){this._touchCurrent.splice(r,1),this._touchStart.splice(r,1);break}switch(this._input){case a.ONE_FINGER:case a.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=a.NONE,this.onSinglePanEnd();break;case a.TWO_FINGER:this.onDoublePanEnd(),this.onPinchEnd(),this.onRotateEnd(),this._input=a.ONE_FINGER_SWITCHED;break;case a.MULT_FINGER:0==this._touchCurrent.length&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=a.NONE,this.onTriplePanEnd())}}else"touch"!=e.pointerType&&this._input==a.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=a.NONE,this.onSinglePanEnd(),this._button=-1);if(e.isPrimary)if(this._downValid){if(e.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(0==this._nclicks)this._nclicks=1,this._clickStart=performance.now();else{const t=e.timeStamp-this._clickStart,r=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;t<=this._maxInterval&&r<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(e)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)})),(0,n.Z)(this,"onWheel",(e=>{var t;if(this.enabled&&this.enableZoom&&this.domElement){let l=null;e.ctrlKey||e.metaKey?l="CTRL":e.shiftKey&&(l="SHIFT");const d=this.getOpFromAction("WHEEL",l);if(d){e.preventDefault(),this.dispatchEvent(u);const l=125;let f=e.deltaY/l,p=1;switch(f>0?p=1/this.scaleFactor:f<0&&(p=this.scaleFactor),d){case"ZOOM":if(this.updateTbState(o.SCALE,!0),f>0?p=1/Math.pow(this.scaleFactor,f):f<0&&(p=Math.pow(this.scaleFactor,-f)),this.cursorZoom&&this.enablePan){var r,n;let t;var a,s;if("OrthographicCamera"===(null===(r=this.camera)||void 0===r?void 0:r.type))t=null===(a=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))||void 0===a?void 0:a.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position);if("PerspectiveCamera"===(null===(n=this.camera)||void 0===n?void 0:n.type))t=null===(s=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))||void 0===s?void 0:s.applyQuaternion(this.camera.quaternion).add(this._gizmos.position);void 0!==t&&this.applyTransformMatrix(this.applyScale(p,t))}else this.applyTransformMatrix(this.applyScale(p,this._gizmos.position));this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(o.IDLE,!1),this.dispatchEvent(c),this.dispatchEvent(h);break;case"FOV":if("PerspectiveCamera"===(null===(t=this.camera)||void 0===t?void 0:t.type)){this.updateTbState(o.FOV,!0),0!=e.deltaX&&(f=e.deltaX/l,p=1,f>0?p=1/Math.pow(this.scaleFactor,f):f<0&&(p=Math.pow(this.scaleFactor,-f))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const t=this._v3_1.distanceTo(this._gizmos.position);let r=t/p;r=i.MathUtils.clamp(r,this.minDistance,this.maxDistance);const n=t*Math.tan(i.MathUtils.DEG2RAD*this.camera.fov*.5);let a=i.MathUtils.RAD2DEG*(2*Math.atan(n/r));a>this.maxFov?a=this.maxFov:a<this.minFov&&(a=this.minFov);p=t/(n/Math.tan(i.MathUtils.DEG2RAD*(a/2))),this.setFov(a),this.applyTransformMatrix(this.applyScale(p,this._gizmos.position,!1))}this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(o.IDLE,!1),this.dispatchEvent(c),this.dispatchEvent(h)}}}})),(0,n.Z)(this,"onSinglePanStart",((e,t)=>{var r;if(this.enabled&&this.domElement)switch(this.dispatchEvent(u),this.setCenter(e.clientX,e.clientY),t){case"PAN":if(!this.enablePan)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(c)),this.camera){this.updateTbState(o.PAN,!0);const e=this.unprojectOnTbPlane(this.camera,s.x,s.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(c))}break;case"ROTATE":if(!this.enableRotate)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.camera){this.updateTbState(o.ROTATE,!0);const e=this.unprojectOnTbSurface(this.camera,s.x,s.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr)}this.dispatchEvent(c);break;case"FOV":if(!this.enableZoom)return;"PerspectiveCamera"===(null===(r=this.camera)||void 0===r?void 0:r.type)&&(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(c)),this.updateTbState(o.FOV,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(s.x,s.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition));break;case"ZOOM":if(!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(c)),this.updateTbState(o.SCALE,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(s.x,s.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}})),(0,n.Z)(this,"onSinglePanMove",((e,t)=>{var r;if(this.enabled&&this.domElement){const n=t!=this._state;switch(this.setCenter(e.clientX,e.clientY),t){case o.PAN:if(this.enablePan&&this.camera)if(n){this.dispatchEvent(h),this.dispatchEvent(u),this.updateTbState(t,!0);const e=this.unprojectOnTbPlane(this.camera,s.x,s.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)}else{const e=this.unprojectOnTbPlane(this.camera,s.x,s.y,this.domElement);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))}break;case o.ROTATE:if(this.enableRotate&&this.camera)if(n){this.dispatchEvent(h),this.dispatchEvent(u),this.updateTbState(t,!0);const e=this.unprojectOnTbSurface(this.camera,s.x,s.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0)}else{const e=this.unprojectOnTbSurface(this.camera,s.x,s.y,this.domElement,this._tbRadius);void 0!==e&&this._currentCursorPosition.copy(e);const t=this._startCursorPosition.distanceTo(this._currentCursorPosition),r=this._startCursorPosition.angleTo(this._currentCursorPosition),n=Math.max(t/this._tbRadius,r);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),n)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=n,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case o.SCALE:if(this.enableZoom)if(n)this.dispatchEvent(h),this.dispatchEvent(u),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(s.x,s.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{const e=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(s.x,s.y,this.domElement).y);const t=this._currentCursorPosition.y-this._startCursorPosition.y;let r=1;t<0?r=1/Math.pow(this.scaleFactor,-t*e):t>0&&(r=Math.pow(this.scaleFactor,t*e)),this.applyTransformMatrix(this.applyScale(r,this._gizmos.position))}break;case o.FOV:if(this.enableZoom&&"PerspectiveCamera"===(null===(r=this.camera)||void 0===r?void 0:r.type))if(n)this.dispatchEvent(h),this.dispatchEvent(u),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(s.x,s.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{const e=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(s.x,s.y,this.domElement).y);const t=this._currentCursorPosition.y-this._startCursorPosition.y;let r=1;t<0?r=1/Math.pow(this.scaleFactor,-t*e):t>0&&(r=Math.pow(this.scaleFactor,t*e)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const n=this._v3_1.distanceTo(this._gizmos.position);let o=n/r;o=i.MathUtils.clamp(o,this.minDistance,this.maxDistance);const a=n*Math.tan(i.MathUtils.DEG2RAD*this._fovState*.5);let l=i.MathUtils.RAD2DEG*(2*Math.atan(a/o));l=i.MathUtils.clamp(l,this.minFov,this.maxFov);const c=a/Math.tan(i.MathUtils.DEG2RAD*(l/2));r=n/c,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(l),this.applyTransformMatrix(this.applyScale(r,this._v3_2,!1));const u=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(c/n);this._m4_1.makeTranslation(u.x,u.y,u.z)}}this.dispatchEvent(c)}})),(0,n.Z)(this,"onSinglePanEnd",(()=>{if(this._state==o.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations){if(performance.now()-this._timeCurrent<120){const e=Math.abs((this._wPrev+this._wCurr)/2),t=this;this._animationId=window.requestAnimationFrame((function(r){t.updateTbState(o.ANIMATION_ROTATE,!0);const n=t.calculateRotationAxis(t._cursorPosPrev,t._cursorPosCurr);t.onRotationAnim(r,n,Math.min(e,t.wMax))}))}else this.updateTbState(o.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(c)}else this.updateTbState(o.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(c)}else this._state!=o.PAN&&this._state!=o.IDLE||(this.updateTbState(o.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(c));this.dispatchEvent(h)})),(0,n.Z)(this,"onDoubleTap",(e=>{if(this.enabled&&this.enablePan&&this.scene&&this.camera&&this.domElement){this.dispatchEvent(u),this.setCenter(e.clientX,e.clientY);const t=this.unprojectOnObj(this.getCursorNDC(s.x,s.y,this.domElement),this.camera);if(t&&this.enableAnimations){const e=this;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame((function(r){e.updateTbState(o.ANIMATION_FOCUS,!0),e.onFocusAnim(r,t,e._cameraMatrixState,e._gizmoMatrixState)}))}else t&&!this.enableAnimations&&(this.updateTbState(o.FOCUS,!0),this.focus(t,this.scaleFactor),this.updateTbState(o.IDLE,!1),this.dispatchEvent(c))}this.dispatchEvent(h)})),(0,n.Z)(this,"onDoublePanStart",(()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.dispatchEvent(u),this.updateTbState(o.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const e=this.unprojectOnTbPlane(this.camera,s.x,s.y,this.domElement,!0);void 0!==e&&this._startCursorPosition.copy(e),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1)}})),(0,n.Z)(this,"onDoublePanMove",(()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=o.PAN&&(this.updateTbState(o.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition));const e=this.unprojectOnTbPlane(this.camera,s.x,s.y,this.domElement,!0);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(c)}})),(0,n.Z)(this,"onDoublePanEnd",(()=>{this.updateTbState(o.IDLE,!1),this.dispatchEvent(h)})),(0,n.Z)(this,"onRotateStart",(()=>{var e;this.enabled&&this.enableRotate&&(this.dispatchEvent(u),this.updateTbState(o.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,null===(e=this.camera)||void 0===e||e.getWorldDirection(this._rotationAxis),this.enablePan||this.enableZoom||this.activateGizmos(!0))})),(0,n.Z)(this,"onRotateMove",(()=>{if(this.enabled&&this.enableRotate&&this.camera&&this.domElement){let t;if(this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=o.ZROTATE&&(this.updateTbState(o.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan){if(this.camera){var e;this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),t=null===(e=this.unprojectOnTbPlane(this.camera,s.x,s.y,this.domElement))||void 0===e?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)}}else t=(new i.Vector3).setFromMatrixPosition(this._gizmoMatrixState);const r=i.MathUtils.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);void 0!==t&&this.applyTransformMatrix(this.zRotate(t,r)),this.dispatchEvent(c)}})),(0,n.Z)(this,"onRotateEnd",(()=>{this.updateTbState(o.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(h)})),(0,n.Z)(this,"onPinchStart",(()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(u),this.updateTbState(o.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))})),(0,n.Z)(this,"onPinchMove",(()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const i=12;this._state!=o.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(o.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),i*this._devPxRatio);const a=this._currentFingerDistance/this._startFingerDistance;let l;var e,t,r;if(this.enablePan){if("OrthographicCamera"===(null===(e=this.camera)||void 0===e?void 0:e.type))l=null===(r=this.unprojectOnTbPlane(this.camera,s.x,s.y,this.domElement))||void 0===r?void 0:r.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position);else if("PerspectiveCamera"===(null===(t=this.camera)||void 0===t?void 0:t.type)){var n;l=null===(n=this.unprojectOnTbPlane(this.camera,s.x,s.y,this.domElement))||void 0===n?void 0:n.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)}}else l=this._gizmos.position;void 0!==l&&this.applyTransformMatrix(this.applyScale(a,l)),this.dispatchEvent(c)}})),(0,n.Z)(this,"onPinchEnd",(()=>{this.updateTbState(o.IDLE,!1),this.dispatchEvent(h)})),(0,n.Z)(this,"onTriplePanStart",(()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.dispatchEvent(u),this.updateTbState(o.SCALE,!0);let e=0,t=0;const r=this._touchCurrent.length;for(let n=0;n<r;n++)e+=this._touchCurrent[n].clientX,t+=this._touchCurrent[n].clientY;this.setCenter(e/r,t/r),this._startCursorPosition.setY(.5*this.getCursorNDC(s.x,s.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}})),(0,n.Z)(this,"onTriplePanMove",(()=>{if(this.enabled&&this.enableZoom&&this.camera&&this.domElement){let e=0,t=0;const r=this._touchCurrent.length;for(let i=0;i<r;i++)e+=this._touchCurrent[i].clientX,t+=this._touchCurrent[i].clientY;this.setCenter(e/r,t/r);const n=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(s.x,s.y,this.domElement).y);const o=this._currentCursorPosition.y-this._startCursorPosition.y;let a=1;o<0?a=1/Math.pow(this.scaleFactor,-o*n):o>0&&(a=Math.pow(this.scaleFactor,o*n)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const l=this._v3_1.distanceTo(this._gizmos.position);let u=l/a;u=i.MathUtils.clamp(u,this.minDistance,this.maxDistance);const h=l*Math.tan(i.MathUtils.DEG2RAD*this._fovState*.5);let d=i.MathUtils.RAD2DEG*(2*Math.atan(h/u));d=i.MathUtils.clamp(d,this.minFov,this.maxFov);const f=h/Math.tan(i.MathUtils.DEG2RAD*(d/2));a=l/f,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(d),this.applyTransformMatrix(this.applyScale(a,this._v3_2,!1));const p=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(f/l);this._m4_1.makeTranslation(p.x,p.y,p.z),this.dispatchEvent(c)}})),(0,n.Z)(this,"onTriplePanEnd",(()=>{this.updateTbState(o.IDLE,!1),this.dispatchEvent(h)})),(0,n.Z)(this,"setCenter",((e,t)=>{s.x=e,s.y=t})),(0,n.Z)(this,"initializeMouseActions",(()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")})),(0,n.Z)(this,"setMouseAction",((e,t,r=null)=>{let n;if(!["PAN","ROTATE","ZOOM","FOV"].includes(e)||![0,1,2,"WHEEL"].includes(t)||!["CTRL","SHIFT",null].includes(r))return!1;if("WHEEL"==t&&"ZOOM"!=e&&"FOV"!=e)return!1;switch(e){case"PAN":n=o.PAN;break;case"ROTATE":n=o.ROTATE;break;case"ZOOM":n=o.SCALE;break;case"FOV":n=o.FOV}const i={operation:e,mouse:t,key:r,state:n};for(let o=0;o<this.mouseActions.length;o++)if(this.mouseActions[o].mouse==i.mouse&&this.mouseActions[o].key==i.key)return this.mouseActions.splice(o,1,i),!0;return this.mouseActions.push(i),!0})),(0,n.Z)(this,"getOpFromAction",((e,t)=>{let r;for(let n=0;n<this.mouseActions.length;n++)if(r=this.mouseActions[n],r.mouse==e&&r.key==t)return r.operation;if(t)for(let n=0;n<this.mouseActions.length;n++)if(r=this.mouseActions[n],r.mouse==e&&null==r.key)return r.operation;return null})),(0,n.Z)(this,"getOpStateFromAction",((e,t)=>{let r;for(let n=0;n<this.mouseActions.length;n++)if(r=this.mouseActions[n],r.mouse==e&&r.key==t)return r.state;if(t)for(let n=0;n<this.mouseActions.length;n++)if(r=this.mouseActions[n],r.mouse==e&&null==r.key)return r.state;return null})),(0,n.Z)(this,"getAngle",((e,t)=>180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI)),(0,n.Z)(this,"updateTouchEvent",(e=>{for(let t=0;t<this._touchCurrent.length;t++)if(this._touchCurrent[t].pointerId==e.pointerId){this._touchCurrent.splice(t,1,e);break}})),(0,n.Z)(this,"calculateAngularSpeed",((e,t,r,n)=>{const i=(n-r)/1e3;return 0==i?0:(t-e)/i})),(0,n.Z)(this,"calculatePointersDistance",((e,t)=>Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2)))),(0,n.Z)(this,"calculateRotationAxis",((e,t)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(e,t).applyQuaternion(this._quat),this._rotationAxis.normalize().clone()))),(0,n.Z)(this,"calculateTbRadius",(e=>{const t=e.position.distanceTo(this._gizmos.position);if("PerspectiveCamera"==e.type){const r=i.MathUtils.DEG2RAD*e.fov*.5,n=Math.atan(e.aspect*Math.tan(r));return Math.tan(Math.min(r,n))*t*.67}if("OrthographicCamera"==e.type)return.67*Math.min(e.top,e.right)})),(0,n.Z)(this,"focus",((e,t,r=1)=>{if(this.camera){const n=e.clone();n.sub(this._gizmos.position).multiplyScalar(r),this._translationMatrix.makeTranslation(n.x,n.y,n.z);const i=this._gizmoMatrixState.clone();this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);const o=this._cameraMatrixState.clone();this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.applyScale(t,this._gizmos.position)),this._gizmoMatrixState.copy(i),this._cameraMatrixState.copy(o)}})),(0,n.Z)(this,"drawGrid",(()=>{if(this.scene){var e,t;const r=8947848,n=3;let o,a,s,l;if("OrthographicCamera"===(null===(e=this.camera)||void 0===e?void 0:e.type)){const e=this.camera.right-this.camera.left,t=this.camera.bottom-this.camera.top;s=Math.max(e,t),l=s/20,o=s/this.camera.zoom*n,a=o/l*this.camera.zoom}else if("PerspectiveCamera"===(null===(t=this.camera)||void 0===t?void 0:t.type)){const e=this.camera.position.distanceTo(this._gizmos.position),t=i.MathUtils.DEG2RAD*this.camera.fov*.5,r=Math.atan(this.camera.aspect*Math.tan(t));s=Math.tan(Math.max(t,r))*e*2,l=s/20,o=s*n,a=o/l}null==this._grid&&this.camera&&(this._grid=new i.GridHelper(o,a,r,r),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(.5*Math.PI),this.scene.add(this._grid))}})),(0,n.Z)(this,"connect",(e=>{e===document&&console.error('THREE.ArcballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.style.touchAction="none",this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onWheel)})),(0,n.Z)(this,"dispose",(()=>{var e,t,r,n,i;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),null===(e=this.domElement)||void 0===e||e.removeEventListener("pointerdown",this.onPointerDown),null===(t=this.domElement)||void 0===t||t.removeEventListener("pointercancel",this.onPointerCancel),null===(r=this.domElement)||void 0===r||r.removeEventListener("wheel",this.onWheel),null===(n=this.domElement)||void 0===n||n.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),null===(i=this.scene)||void 0===i||i.remove(this._gizmos),this.disposeGrid()})),(0,n.Z)(this,"disposeGrid",(()=>{this._grid&&this.scene&&(this.scene.remove(this._grid),this._grid=null)})),(0,n.Z)(this,"easeOutCubic",(e=>1-Math.pow(1-e,3))),(0,n.Z)(this,"activateGizmos",(e=>{for(const t of this._gizmos.children)t.material.setValues({opacity:e?1:.6})})),(0,n.Z)(this,"getCursorNDC",((e,t,r)=>{const n=r.getBoundingClientRect();return this._v2_1.setX((e-n.left)/n.width*2-1),this._v2_1.setY((n.bottom-t)/n.height*2-1),this._v2_1.clone()})),(0,n.Z)(this,"getCursorPosition",((e,t,r)=>{var n;return this._v2_1.copy(this.getCursorNDC(e,t,r)),"OrthographicCamera"===(null===(n=this.camera)||void 0===n?void 0:n.type)&&(this._v2_1.x*=.5*(this.camera.right-this.camera.left),this._v2_1.y*=.5*(this.camera.top-this.camera.bottom)),this._v2_1.clone()})),(0,n.Z)(this,"setCamera",(e=>{if(e){e.lookAt(this.target),e.updateMatrix(),"PerspectiveCamera"==(null===e||void 0===e?void 0:e.type)&&(this._fov0=e.fov,this._fovState=e.fov),this._cameraMatrixState0.copy(e.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(e.projectionMatrix),this._zoom0=e.zoom,this._zoomState=this._zoom0,this._initialNear=e.near,this._nearPos0=e.position.distanceTo(this.target)-e.near,this._nearPos=this._initialNear,this._initialFar=e.far,this._farPos0=e.position.distanceTo(this.target)-e.far,this._farPos=this._initialFar,this._up0.copy(e.up),this._upState.copy(e.up),this.camera=e,this.camera.updateProjectionMatrix();const t=this.calculateTbRadius(e);void 0!==t&&(this._tbRadius=t),this.makeGizmos(this.target,this._tbRadius)}})),(0,n.Z)(this,"makeGizmos",((e,t)=>{const r=new i.EllipseCurve(0,0,t,t).getPoints(this._curvePts),n=(new i.BufferGeometry).setFromPoints(r),o=new i.LineBasicMaterial({color:16744576,fog:!1,transparent:!0,opacity:.6}),a=new i.LineBasicMaterial({color:8454016,fog:!1,transparent:!0,opacity:.6}),s=new i.LineBasicMaterial({color:8421631,fog:!1,transparent:!0,opacity:.6}),l=new i.Line(n,o),c=new i.Line(n,a),u=new i.Line(n,s),h=.5*Math.PI;if(l.rotation.x=h,c.rotation.y=h,this._gizmoMatrixState0.identity().setPosition(e),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera&&1!=this.camera.zoom){const t=1/this.camera.zoom;this._scaleMatrix.makeScale(t,t,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(e.x,e.y,e.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(l),this._gizmos.add(c),this._gizmos.add(u)})),(0,n.Z)(this,"onFocusAnim",((e,t,r,n)=>{if(-1==this._timeStart&&(this._timeStart=e),this._state==o.ANIMATION_FOCUS){const i=(e-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(n),i>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,this.scaleFactor),this._timeStart=-1,this.updateTbState(o.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(c);else{const e=this.easeOutCubic(i),o=1-e+this.scaleFactor*e;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,o,e),this.dispatchEvent(c);const a=this;this._animationId=window.requestAnimationFrame((function(e){a.onFocusAnim(e,t,r,n.clone())}))}}else this._animationId=-1,this._timeStart=-1})),(0,n.Z)(this,"onRotationAnim",((e,t,r)=>{if(-1==this._timeStart&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=e),this._state==o.ANIMATION_ROTATE){const n=(e-this._timeStart)/1e3;if(r+-this.dampingFactor*n>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(n,2)+r*n+0,this.applyTransformMatrix(this.rotate(t,this._angleCurrent)),this.dispatchEvent(c);const e=this;this._animationId=window.requestAnimationFrame((function(n){e.onRotationAnim(n,t,r)}))}else this._animationId=-1,this._timeStart=-1,this.updateTbState(o.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(c)}else this._animationId=-1,this._timeStart=-1,this._state!=o.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(c))})),(0,n.Z)(this,"pan",((e,t,r=!1)=>{if(this.camera){const n=e.clone().sub(t);if("OrthographicCamera"===this.camera.type&&n.multiplyScalar(1/this.camera.zoom),"PerspectiveCamera"===this.camera.type&&r){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const e=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);n.multiplyScalar(1/e)}this._v3_1.set(n.x,n.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1)}return l})),(0,n.Z)(this,"reset",(()=>{if(this.camera){this.camera.zoom=this._zoom0,"PerspectiveCamera"===this.camera.type&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix();const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(o.IDLE,!1),this.dispatchEvent(c)}})),(0,n.Z)(this,"rotate",((e,t)=>{const r=this._gizmos.position;return this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._rotationMatrix.makeRotationAxis(e,-t),this._m4_1.makeTranslation(r.x,r.y,r.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),l})),(0,n.Z)(this,"copyState",(()=>{if(this.camera){var e;const t=JSON.stringify("OrthographicCamera"===(null===(e=this.camera)||void 0===e?void 0:e.type)?{arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}:{arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}});navigator.clipboard.writeText(t)}})),(0,n.Z)(this,"pasteState",(()=>{const e=this;navigator.clipboard.readText().then((function(t){e.setStateFromJSON(t)}))})),(0,n.Z)(this,"saveState",(()=>{this.camera&&(this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),"PerspectiveCamera"===this.camera.type&&(this._fov0=this.camera.fov))})),(0,n.Z)(this,"applyScale",((e,t,r=!0)=>{if(!this.camera)return;const n=t.clone();let i=1/e;if("OrthographicCamera"===this.camera.type){this.camera.zoom=this._zoomState,this.camera.zoom*=e,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,i=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,i=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(i,i,i),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),n.sub(this._v3_1);const t=n.clone().multiplyScalar(i);return n.sub(t),this._m4_1.makeTranslation(n.x,n.y,n.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),l}if("PerspectiveCamera"===this.camera.type){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let e=this._v3_1.distanceTo(n),t=e-e*i;const o=e-t;o<this.minDistance?(i=this.minDistance/e,t=e-e*i):o>this.maxDistance&&(i=this.maxDistance/e,t=e-e*i);let a=n.clone().sub(this._v3_1).normalize().multiplyScalar(t);if(this._m4_1.makeTranslation(a.x,a.y,a.z),r){const r=this._v3_2;e=r.distanceTo(n),t=e-e*i,a=n.clone().sub(this._v3_2).normalize().multiplyScalar(t),this._translationMatrix.makeTranslation(r.x,r.y,r.z),this._scaleMatrix.makeScale(i,i,i),this._m4_2.makeTranslation(a.x,a.y,a.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return l}})),(0,n.Z)(this,"setFov",(e=>{var t;"PerspectiveCamera"===(null===(t=this.camera)||void 0===t?void 0:t.type)&&(this.camera.fov=i.MathUtils.clamp(e,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())})),(0,n.Z)(this,"setTarget",((e,t,r)=>{if(this.camera){this.target.set(e,t,r),this._gizmos.position.set(e,t,r);const n=this.calculateTbRadius(this.camera);void 0!==n&&(this._tbRadius=n),this.makeGizmos(this.target,this._tbRadius),this.camera.lookAt(this.target)}})),(0,n.Z)(this,"zRotate",((e,t)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._m4_1.makeTranslation(e.x,e.y,e.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(e),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,t),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),l))),(0,n.Z)(this,"unprojectOnObj",((e,t)=>{if(!this.scene)return null;const r=new i.Raycaster;r.near=t.near,r.far=t.far,r.setFromCamera(e,t);const n=r.intersectObjects(this.scene.children,!0);for(let i=0;i<n.length;i++)if(n[i].object.uuid!=this._gizmos.uuid&&n[i].face)return n[i].point.clone();return null})),(0,n.Z)(this,"unprojectOnTbSurface",((e,t,r,n,o)=>{if("OrthographicCamera"==e.type){this._v2_1.copy(this.getCursorPosition(t,r,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const e=Math.pow(this._v2_1.x,2),i=Math.pow(this._v2_1.y,2),o=Math.pow(this._tbRadius,2);return e+i<=.5*o?this._v3_1.setZ(Math.sqrt(o-(e+i))):this._v3_1.setZ(.5*o/Math.sqrt(e+i)),this._v3_1}if("PerspectiveCamera"==e.type){this._v2_1.copy(this.getCursorNDC(t,r,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const a=this._v3_1.clone().normalize(),s=e.position.distanceTo(this._gizmos.position),l=Math.pow(o,2),c=this._v3_1.z,u=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(0==u)return a.set(this._v3_1.x,this._v3_1.y,o),a;const h=c/u,d=s;let f=Math.pow(h,2)+1,p=2*h*d,m=Math.pow(d,2)-l,g=Math.pow(p,2)-4*f*m;if(g>=0){this._v2_1.setX((-p-Math.sqrt(g))/(2*f)),this._v2_1.setY(h*this._v2_1.x+d);if(i.MathUtils.RAD2DEG*this._v2_1.angle()>=45){const e=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(s-this._v2_1.y,2));return a.multiplyScalar(e),a.z+=s,a}}f=h,p=d,m=.5*-l,g=Math.pow(p,2)-4*f*m,this._v2_1.setX((-p-Math.sqrt(g))/(2*f)),this._v2_1.setY(h*this._v2_1.x+d);const A=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(s-this._v2_1.y,2));return a.multiplyScalar(A),a.z+=s,a}})),(0,n.Z)(this,"unprojectOnTbPlane",((e,t,r,n,i=!1)=>{if("OrthographicCamera"==e.type)return this._v2_1.copy(this.getCursorPosition(t,r,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if("PerspectiveCamera"==e.type){this._v2_1.copy(this.getCursorNDC(t,r,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const o=this._v3_1.clone().normalize(),a=this._v3_1.z,s=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let l;if(l=i?this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):e.position.distanceTo(this._gizmos.position),0==s)return o.set(0,0,0),o;const c=l,u=-c/(a/s),h=Math.sqrt(Math.pow(c,2)+Math.pow(u,2));return o.multiplyScalar(h),o.z=0,o}})),(0,n.Z)(this,"updateMatrixState",(()=>{this.camera&&(this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),"OrthographicCamera"===this.camera.type&&(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom),"PerspectiveCamera"===this.camera.type&&(this._fovState=this.camera.fov))})),(0,n.Z)(this,"updateTbState",((e,t)=>{this._state=e,t&&this.updateMatrixState()})),(0,n.Z)(this,"update",(()=>{const e=1e-6;if(!this.target.equals(this._currentTarget)&&this.camera){this._gizmos.position.set(this.target.x,this.target.y,this.target.z);const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)}if(this.camera){if("OrthographicCamera"===this.camera.type&&(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom)){const e=i.MathUtils.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.applyScale(e/this.camera.zoom,this._gizmos.position,!0))}if("PerspectiveCamera"===this.camera.type){const t=this.camera.position.distanceTo(this._gizmos.position);if(t>this.maxDistance+e||t<this.minDistance-e){const e=i.MathUtils.clamp(t,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.applyScale(e/t,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=i.MathUtils.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());const r=this._tbRadius,n=this.calculateTbRadius(this.camera);if(void 0!==n&&(this._tbRadius=n),r<this._tbRadius-e||r>this._tbRadius+e){const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,t=this._tbRadius/e,r=new i.EllipseCurve(0,0,t,t).getPoints(this._curvePts),n=(new i.BufferGeometry).setFromPoints(r);for(const i in this._gizmos.children){this._gizmos.children[i].geometry=n}}}this.camera.lookAt(this._gizmos.position)}})),(0,n.Z)(this,"setStateFromJSON",(e=>{const t=JSON.parse(e);if(t.arcballState&&this.camera){this._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(t.arcballState.cameraUp),this.camera.near=t.arcballState.cameraNear,this.camera.far=t.arcballState.cameraFar,this.camera.zoom=t.arcballState.cameraZoom,"PerspectiveCamera"===this.camera.type&&(this.camera.fov=t.arcballState.cameraFov),this._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix();const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e);const r=(new i.Matrix4).copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(r),this.camera.lookAt(this._gizmos.position),this.updateTbState(o.IDLE,!1),this.dispatchEvent(c)}})),this.camera=null,this.domElement=t,this.scene=r,this.mouseActions=[],this._mouseOp=null,this._v2_1=new i.Vector2,this._v3_1=new i.Vector3,this._v3_2=new i.Vector3,this._m4_1=new i.Matrix4,this._m4_2=new i.Matrix4,this._quat=new i.Quaternion,this._translationMatrix=new i.Matrix4,this._rotationMatrix=new i.Matrix4,this._scaleMatrix=new i.Matrix4,this._rotationAxis=new i.Vector3,this._cameraMatrixState=new i.Matrix4,this._cameraProjectionState=new i.Matrix4,this._fovState=1,this._upState=new i.Vector3,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new i.Matrix4,this._up0=new i.Vector3,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new i.Matrix4,this._gizmoMatrixState0=new i.Matrix4,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=a.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new i.Vector3,this._startCursorPosition=new i.Vector3,this._grid=null,this._gridPosition=new i.Vector3,this._gizmos=new i.Group,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new i.Vector3,this._cursorPosCurr=new i.Vector3,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.target=new i.Vector3(0,0,0),this._currentTarget=new i.Vector3(0,0,0),this._tbRadius=1,this._state=o.IDLE,this.setCamera(e),this.scene&&this.scene.add(this._gizmos),this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement&&this.connect(this.domElement),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if(null!==e&&void 0!==e&&e.camera&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),this._state!=o.ROTATE&&this._state!=o.ZROTATE&&this._state!=o.ANIMATION_ROTATE||this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),null!==e&&void 0!==e&&e.gizmos&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==o.SCALE||this._state==o.FOCUS||this._state==o.ANIMATION_FOCUS)&&this.camera){const e=this.calculateTbRadius(this.camera);if(void 0!==e&&(this._tbRadius=e),this.adjustNearFar){const e=this.camera.position.distanceTo(this._gizmos.position),t=new i.Box3;t.setFromObject(this._gizmos);const r=new i.Sphere;t.getBoundingSphere(r);const n=Math.max(this._nearPos0,r.radius+r.center.length()),o=e-this._initialNear,a=Math.min(n,o);this.camera.near=e-a;const s=Math.min(this._farPos0,-r.radius+r.center.length()),l=e-this._initialFar,c=Math.min(s,l);this.camera.far=e-c,this.camera.updateProjectionMatrix()}else{let e=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,e=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,e=!0),e&&this.camera.updateProjectionMatrix()}}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(c)}setTransformationMatrices(e=null,t=null){e?l.camera?l.camera.copy(e):l.camera=e.clone():l.camera=null,t?l.gizmos?l.gizmos.copy(t):l.gizmos=t.clone():l.gizmos=null}}},8096:function(e,t,r){"use strict";r.d(t,{W:function(){return o}});var n=r(4649),i=r(6173);class o extends i.EventDispatcher{constructor(e){super(),(0,n.Z)(this,"object",void 0),(0,n.Z)(this,"changeEvent",{type:"change"}),(0,n.Z)(this,"EPS",1e-6),(0,n.Z)(this,"enabled",!0),(0,n.Z)(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),(0,n.Z)(this,"screenOrientation",0),(0,n.Z)(this,"alphaOffset",0),(0,n.Z)(this,"onDeviceOrientationChangeEvent",(e=>{this.deviceOrientation=e})),(0,n.Z)(this,"onScreenOrientationChangeEvent",(()=>{this.screenOrientation=window.orientation||0})),(0,n.Z)(this,"zee",new i.Vector3(0,0,1)),(0,n.Z)(this,"euler",new i.Euler),(0,n.Z)(this,"q0",new i.Quaternion),(0,n.Z)(this,"q1",new i.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5))),(0,n.Z)(this,"setObjectQuaternion",((e,t,r,n,i)=>{this.euler.set(r,t,-n,"YXZ"),e.setFromEuler(this.euler),e.multiply(this.q1),e.multiply(this.q0.setFromAxisAngle(this.zee,-i))})),(0,n.Z)(this,"connect",(()=>{this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"===typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))})).catch((e=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)})):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0})),(0,n.Z)(this,"disconnect",(()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1})),(0,n.Z)(this,"lastQuaternion",new i.Quaternion),(0,n.Z)(this,"update",(()=>{if(!1===this.enabled)return;const e=this.deviceOrientation;if(e){const t=e.alpha?i.MathUtils.degToRad(e.alpha)+this.alphaOffset:0,r=e.beta?i.MathUtils.degToRad(e.beta):0,n=e.gamma?i.MathUtils.degToRad(e.gamma):0,o=this.screenOrientation?i.MathUtils.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,t,r,n,o),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}})),(0,n.Z)(this,"dispose",(()=>this.disconnect())),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}},4466:function(e,t,r){"use strict";r.d(t,{o:function(){return a}});var n=r(4649),i=r(6173);const o=new i.Vector3;class a extends i.EventDispatcher{constructor(e,t){super(),(0,n.Z)(this,"object",void 0),(0,n.Z)(this,"domElement",void 0),(0,n.Z)(this,"enabled",!0),(0,n.Z)(this,"movementSpeed",1),(0,n.Z)(this,"lookSpeed",.005),(0,n.Z)(this,"lookVertical",!0),(0,n.Z)(this,"autoForward",!1),(0,n.Z)(this,"activeLook",!0),(0,n.Z)(this,"heightSpeed",!1),(0,n.Z)(this,"heightCoef",1),(0,n.Z)(this,"heightMin",0),(0,n.Z)(this,"heightMax",1),(0,n.Z)(this,"constrainVertical",!1),(0,n.Z)(this,"verticalMin",0),(0,n.Z)(this,"verticalMax",Math.PI),(0,n.Z)(this,"mouseDragOn",!1),(0,n.Z)(this,"autoSpeedFactor",0),(0,n.Z)(this,"mouseX",0),(0,n.Z)(this,"mouseY",0),(0,n.Z)(this,"moveForward",!1),(0,n.Z)(this,"moveBackward",!1),(0,n.Z)(this,"moveLeft",!1),(0,n.Z)(this,"moveRight",!1),(0,n.Z)(this,"moveUp",!1),(0,n.Z)(this,"moveDown",!1),(0,n.Z)(this,"viewHalfX",0),(0,n.Z)(this,"viewHalfY",0),(0,n.Z)(this,"lat",0),(0,n.Z)(this,"lon",0),(0,n.Z)(this,"lookDirection",new i.Vector3),(0,n.Z)(this,"spherical",new i.Spherical),(0,n.Z)(this,"target",new i.Vector3),(0,n.Z)(this,"connect",(e=>{e.setAttribute("tabindex","-1"),e.style.touchAction="none",e.addEventListener("contextmenu",this.contextmenu),e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),this.domElement=e,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize()})),(0,n.Z)(this,"dispose",(()=>{var e,t,r,n;null===(e=this.domElement)||void 0===e||e.removeEventListener("contextmenu",this.contextmenu),null===(t=this.domElement)||void 0===t||t.removeEventListener("mousedown",this.onMouseDown),null===(r=this.domElement)||void 0===r||r.removeEventListener("mousemove",this.onMouseMove),null===(n=this.domElement)||void 0===n||n.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)})),(0,n.Z)(this,"handleResize",(()=>{this.domElement&&(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)})),(0,n.Z)(this,"onMouseDown",(e=>{var t;if(null===(t=this.domElement)||void 0===t||t.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0})),(0,n.Z)(this,"onMouseUp",(e=>{if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1})),(0,n.Z)(this,"onMouseMove",(e=>{this.domElement&&(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)})),(0,n.Z)(this,"onKeyDown",(e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}})),(0,n.Z)(this,"onKeyUp",(e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}})),(0,n.Z)(this,"lookAt",((e,t,r)=>(e instanceof i.Vector3?this.target.copy(e):t&&r&&this.target.set(e,t,r),this.object.lookAt(this.target),this.setOrientation(),this))),(0,n.Z)(this,"update",(e=>{if(!this.enabled)return;if(this.heightSpeed){const t=i.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;const t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let r=e*this.lookSpeed;this.activeLook||(r=0);let n=1;this.constrainVertical&&(n=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*r,this.lookVertical&&(this.lat-=this.mouseY*r*n),this.lat=Math.max(-85,Math.min(85,this.lat));let a=i.MathUtils.degToRad(90-this.lat);const s=i.MathUtils.degToRad(this.lon);this.constrainVertical&&(a=i.MathUtils.mapLinear(a,0,Math.PI,this.verticalMin,this.verticalMax));const l=this.object.position;o.setFromSphericalCoords(1,a,s).add(l),this.object.lookAt(o)})),(0,n.Z)(this,"contextmenu",(e=>e.preventDefault())),(0,n.Z)(this,"setOrientation",(()=>{this.lookDirection.set(0,0,-1).applyQuaternion(this.object.quaternion),this.spherical.setFromVector3(this.lookDirection),this.lat=90-i.MathUtils.radToDeg(this.spherical.phi),this.lon=i.MathUtils.radToDeg(this.spherical.theta)})),this.object=e,this.domElement=t,this.setOrientation(),t&&this.connect(t)}}},142:function(e,t,r){"use strict";r.d(t,{m:function(){return a}});var n=r(4649),i=r(6173);function o(e){e.preventDefault()}class a extends i.EventDispatcher{constructor(e,t){super(),(0,n.Z)(this,"object",void 0),(0,n.Z)(this,"domElement",void 0),(0,n.Z)(this,"movementSpeed",1),(0,n.Z)(this,"rollSpeed",.005),(0,n.Z)(this,"dragToLook",!1),(0,n.Z)(this,"autoForward",!1),(0,n.Z)(this,"changeEvent",{type:"change"}),(0,n.Z)(this,"EPS",1e-6),(0,n.Z)(this,"tmpQuaternion",new i.Quaternion),(0,n.Z)(this,"mouseStatus",0),(0,n.Z)(this,"movementSpeedMultiplier",1),(0,n.Z)(this,"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),(0,n.Z)(this,"moveVector",new i.Vector3(0,0,0)),(0,n.Z)(this,"rotationVector",new i.Vector3(0,0,0)),(0,n.Z)(this,"keydown",(e=>{if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}})),(0,n.Z)(this,"keyup",(e=>{switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()})),(0,n.Z)(this,"mousedown",(e=>{if(this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}})),(0,n.Z)(this,"mousemove",(e=>{if(!this.dragToLook||this.mouseStatus>0){const t=this.getContainerDimensions(),r=t.size[0]/2,n=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-r)/r,this.moveState.pitchDown=(e.pageY-t.offset[1]-n)/n,this.updateRotationVector()}})),(0,n.Z)(this,"mouseup",(e=>{if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()})),(0,n.Z)(this,"lastQuaternion",new i.Quaternion),(0,n.Z)(this,"lastPosition",new i.Vector3),(0,n.Z)(this,"update",(e=>{const t=e*this.movementSpeed,r=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*r,this.rotationVector.y*r,this.rotationVector.z*r,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastQuaternion.copy(this.object.quaternion),this.lastPosition.copy(this.object.position))})),(0,n.Z)(this,"updateMovementVector",(()=>{const e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back})),(0,n.Z)(this,"updateRotationVector",(()=>{this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft})),(0,n.Z)(this,"getContainerDimensions",(()=>this.domElement==document||this.domElement instanceof Document?{size:[window.innerWidth,window.innerHeight],offset:[0,0]}:{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]})),(0,n.Z)(this,"dispose",(()=>{this.domElement.removeEventListener("contextmenu",o),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("mouseup",this.mouseup),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup)})),void 0===t&&(console.warn('THREE.FlyControls: The second parameter "domElement" is now mandatory.'),t=document),this.object=e,this.domElement=t,!t||t instanceof Document||t.setAttribute("tabindex",-1),this.domElement.addEventListener("contextmenu",o),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("mouseup",this.mouseup),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.updateMovementVector(),this.updateRotationVector()}}},9649:function(e,t,r){"use strict";r.d(t,{o:function(){return s},z:function(){return a}});var n=r(4649),i=r(6173);const o=(e,t)=>(e%t+t)%t;class a extends i.EventDispatcher{constructor(e,t){super(),(0,n.Z)(this,"object",void 0),(0,n.Z)(this,"domElement",void 0),(0,n.Z)(this,"enabled",!0),(0,n.Z)(this,"target",new i.Vector3),(0,n.Z)(this,"minDistance",0),(0,n.Z)(this,"maxDistance",1/0),(0,n.Z)(this,"minZoom",0),(0,n.Z)(this,"maxZoom",1/0),(0,n.Z)(this,"minPolarAngle",0),(0,n.Z)(this,"maxPolarAngle",Math.PI),(0,n.Z)(this,"minAzimuthAngle",-1/0),(0,n.Z)(this,"maxAzimuthAngle",1/0),(0,n.Z)(this,"enableDamping",!1),(0,n.Z)(this,"dampingFactor",.05),(0,n.Z)(this,"enableZoom",!0),(0,n.Z)(this,"zoomSpeed",1),(0,n.Z)(this,"enableRotate",!0),(0,n.Z)(this,"rotateSpeed",1),(0,n.Z)(this,"enablePan",!0),(0,n.Z)(this,"panSpeed",1),(0,n.Z)(this,"screenSpacePanning",!0),(0,n.Z)(this,"keyPanSpeed",7),(0,n.Z)(this,"autoRotate",!1),(0,n.Z)(this,"autoRotateSpeed",2),(0,n.Z)(this,"reverseOrbit",!1),(0,n.Z)(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),(0,n.Z)(this,"mouseButtons",{LEFT:i.MOUSE.ROTATE,MIDDLE:i.MOUSE.DOLLY,RIGHT:i.MOUSE.PAN}),(0,n.Z)(this,"touches",{ONE:i.TOUCH.ROTATE,TWO:i.TOUCH.DOLLY_PAN}),(0,n.Z)(this,"target0",void 0),(0,n.Z)(this,"position0",void 0),(0,n.Z)(this,"zoom0",void 0),(0,n.Z)(this,"_domElementKeyEvents",null),(0,n.Z)(this,"getPolarAngle",void 0),(0,n.Z)(this,"getAzimuthalAngle",void 0),(0,n.Z)(this,"setPolarAngle",void 0),(0,n.Z)(this,"setAzimuthalAngle",void 0),(0,n.Z)(this,"getDistance",void 0),(0,n.Z)(this,"listenToKeyEvents",void 0),(0,n.Z)(this,"saveState",void 0),(0,n.Z)(this,"reset",void 0),(0,n.Z)(this,"update",void 0),(0,n.Z)(this,"connect",void 0),(0,n.Z)(this,"dispose",void 0),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object instanceof i.PerspectiveCamera?this.object.zoom:1,this.getPolarAngle=()=>d.phi,this.getAzimuthalAngle=()=>d.theta,this.setPolarAngle=e=>{let t=o(e,2*Math.PI),n=d.phi;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-n);2*Math.PI-i<i&&(t<n?t+=2*Math.PI:n+=2*Math.PI),f.phi=t-n,r.update()},this.setAzimuthalAngle=e=>{let t=o(e,2*Math.PI),n=d.theta;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-n);2*Math.PI-i<i&&(t<n?t+=2*Math.PI:n+=2*Math.PI),f.theta=t-n,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",Y),this._domElementKeyEvents=e},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object instanceof i.PerspectiveCamera?r.object.zoom:1},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object instanceof i.PerspectiveCamera&&(r.object.zoom=r.zoom0,r.object.updateProjectionMatrix()),r.dispatchEvent(a),r.update(),u=c.NONE},this.update=(()=>{const t=new i.Vector3,n=(new i.Quaternion).setFromUnitVectors(e.up,new i.Vector3(0,1,0)),o=n.clone().invert(),s=new i.Vector3,l=new i.Quaternion,A=2*Math.PI;return function(){const e=r.object.position;t.copy(e).sub(r.target),t.applyQuaternion(n),d.setFromVector3(t),r.autoRotate&&u===c.NONE&&B(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(d.theta+=f.theta*r.dampingFactor,d.phi+=f.phi*r.dampingFactor):(d.theta+=f.theta,d.phi+=f.phi);let i=r.minAzimuthAngle,v=r.maxAzimuthAngle;return isFinite(i)&&isFinite(v)&&(i<-Math.PI?i+=A:i>Math.PI&&(i-=A),v<-Math.PI?v+=A:v>Math.PI&&(v-=A),d.theta=i<=v?Math.max(i,Math.min(v,d.theta)):d.theta>(i+v)/2?Math.max(i,d.theta):Math.min(v,d.theta)),d.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=p,d.radius=Math.max(r.minDistance,Math.min(r.maxDistance,d.radius)),!0===r.enableDamping?r.target.addScaledVector(m,r.dampingFactor):r.target.add(m),t.setFromSpherical(d),t.applyQuaternion(o),e.copy(r.target).add(t),r.object.lookAt(r.target),!0===r.enableDamping?(f.theta*=1-r.dampingFactor,f.phi*=1-r.dampingFactor,m.multiplyScalar(1-r.dampingFactor)):(f.set(0,0,0),m.set(0,0,0)),p=1,!!(g||s.distanceToSquared(r.object.position)>h||8*(1-l.dot(r.object.quaternion))>h)&&(r.dispatchEvent(a),s.copy(r.object.position),l.copy(r.object.quaternion),g=!1,!0)}})(),this.connect=e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),r.domElement=e,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",J),r.domElement.addEventListener("pointerdown",j),r.domElement.addEventListener("pointercancel",Z),r.domElement.addEventListener("wheel",X)},this.dispose=()=>{var e,t,n,i,o,a;null===(e=r.domElement)||void 0===e||e.removeEventListener("contextmenu",J),null===(t=r.domElement)||void 0===t||t.removeEventListener("pointerdown",j),null===(n=r.domElement)||void 0===n||n.removeEventListener("pointercancel",Z),null===(i=r.domElement)||void 0===i||i.removeEventListener("wheel",X),null===(o=r.domElement)||void 0===o||o.ownerDocument.removeEventListener("pointermove",H),null===(a=r.domElement)||void 0===a||a.ownerDocument.removeEventListener("pointerup",W),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",Y)};const r=this,a={type:"change"},s={type:"start"},l={type:"end"},c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let u=c.NONE;const h=1e-6,d=new i.Spherical,f=new i.Spherical;let p=1;const m=new i.Vector3;let g=!1;const A=new i.Vector2,v=new i.Vector2,y=new i.Vector2,x=new i.Vector2,b=new i.Vector2,w=new i.Vector2,C=new i.Vector2,E=new i.Vector2,S=new i.Vector2,T=[],M={};function I(){return Math.pow(.95,r.zoomSpeed)}function B(e){r.reverseOrbit?f.theta+=e:f.theta-=e}function _(e){r.reverseOrbit?f.phi+=e:f.phi-=e}const F=(()=>{const e=new i.Vector3;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),m.add(e)}})(),P=(()=>{const e=new i.Vector3;return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),m.add(e)}})(),R=(()=>{const e=new i.Vector3;return function(t,n){const o=r.domElement;if(o&&r.object instanceof i.PerspectiveCamera&&r.object.isPerspectiveCamera){const i=r.object.position;e.copy(i).sub(r.target);let a=e.length();a*=Math.tan(r.object.fov/2*Math.PI/180),F(2*t*a/o.clientHeight,r.object.matrix),P(2*n*a/o.clientHeight,r.object.matrix)}else o&&r.object instanceof i.OrthographicCamera&&r.object.isOrthographicCamera?(F(t*(r.object.right-r.object.left)/r.object.zoom/o.clientWidth,r.object.matrix),P(n*(r.object.top-r.object.bottom)/r.object.zoom/o.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function L(e){r.object instanceof i.PerspectiveCamera&&r.object.isPerspectiveCamera?p/=e:r.object instanceof i.OrthographicCamera&&r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function D(e){r.object instanceof i.PerspectiveCamera&&r.object.isPerspectiveCamera?p*=e:r.object instanceof i.OrthographicCamera&&r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function N(e){A.set(e.clientX,e.clientY)}function k(e){x.set(e.clientX,e.clientY)}function O(){if(1==T.length)A.set(T[0].pageX,T[0].pageY);else{const e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);A.set(e,t)}}function U(){if(1==T.length)x.set(T[0].pageX,T[0].pageY);else{const e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);x.set(e,t)}}function Q(){const e=T[0].pageX-T[1].pageX,t=T[0].pageY-T[1].pageY,r=Math.sqrt(e*e+t*t);C.set(0,r)}function V(e){if(1==T.length)v.set(e.pageX,e.pageY);else{const t=$(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);v.set(r,n)}y.subVectors(v,A).multiplyScalar(r.rotateSpeed);const t=r.domElement;t&&(B(2*Math.PI*y.x/t.clientHeight),_(2*Math.PI*y.y/t.clientHeight)),A.copy(v)}function G(e){if(1==T.length)b.set(e.pageX,e.pageY);else{const t=$(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);b.set(r,n)}w.subVectors(b,x).multiplyScalar(r.panSpeed),R(w.x,w.y),x.copy(b)}function z(e){const t=$(e),n=e.pageX-t.x,i=e.pageY-t.y,o=Math.sqrt(n*n+i*i);E.set(0,o),S.set(0,Math.pow(E.y/C.y,r.zoomSpeed)),L(S.y),C.copy(E)}function j(e){if(!1!==r.enabled){var t,n;if(0===T.length)null===(t=r.domElement)||void 0===t||t.ownerDocument.addEventListener("pointermove",H),null===(n=r.domElement)||void 0===n||n.ownerDocument.addEventListener("pointerup",W);!function(e){T.push(e)}(e),"touch"===e.pointerType?function(e){switch(K(e),T.length){case 1:switch(r.touches.ONE){case i.TOUCH.ROTATE:if(!1===r.enableRotate)return;O(),u=c.TOUCH_ROTATE;break;case i.TOUCH.PAN:if(!1===r.enablePan)return;U(),u=c.TOUCH_PAN;break;default:u=c.NONE}break;case 2:switch(r.touches.TWO){case i.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&Q(),r.enablePan&&U(),u=c.TOUCH_DOLLY_PAN;break;case i.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&Q(),r.enableRotate&&O(),u=c.TOUCH_DOLLY_ROTATE;break;default:u=c.NONE}break;default:u=c.NONE}u!==c.NONE&&r.dispatchEvent(s)}(e):function(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case i.MOUSE.DOLLY:if(!1===r.enableZoom)return;!function(e){C.set(e.clientX,e.clientY)}(e),u=c.DOLLY;break;case i.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;k(e),u=c.PAN}else{if(!1===r.enableRotate)return;N(e),u=c.ROTATE}break;case i.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;N(e),u=c.ROTATE}else{if(!1===r.enablePan)return;k(e),u=c.PAN}break;default:u=c.NONE}u!==c.NONE&&r.dispatchEvent(s)}(e)}}function H(e){!1!==r.enabled&&("touch"===e.pointerType?function(e){switch(K(e),u){case c.TOUCH_ROTATE:if(!1===r.enableRotate)return;V(e),r.update();break;case c.TOUCH_PAN:if(!1===r.enablePan)return;G(e),r.update();break;case c.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&z(e),r.enablePan&&G(e)}(e),r.update();break;case c.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&z(e),r.enableRotate&&V(e)}(e),r.update();break;default:u=c.NONE}}(e):function(e){if(!1===r.enabled)return;switch(u){case c.ROTATE:if(!1===r.enableRotate)return;!function(e){v.set(e.clientX,e.clientY),y.subVectors(v,A).multiplyScalar(r.rotateSpeed);const t=r.domElement;t&&(B(2*Math.PI*y.x/t.clientHeight),_(2*Math.PI*y.y/t.clientHeight)),A.copy(v),r.update()}(e);break;case c.DOLLY:if(!1===r.enableZoom)return;!function(e){E.set(e.clientX,e.clientY),S.subVectors(E,C),S.y>0?L(I()):S.y<0&&D(I()),C.copy(E),r.update()}(e);break;case c.PAN:if(!1===r.enablePan)return;!function(e){b.set(e.clientX,e.clientY),w.subVectors(b,x).multiplyScalar(r.panSpeed),R(w.x,w.y),x.copy(b),r.update()}(e)}}(e))}function W(e){var t,n,i;(q(e),0===T.length)&&(null===(t=r.domElement)||void 0===t||t.releasePointerCapture(e.pointerId),null===(n=r.domElement)||void 0===n||n.ownerDocument.removeEventListener("pointermove",H),null===(i=r.domElement)||void 0===i||i.ownerDocument.removeEventListener("pointerup",W));r.dispatchEvent(l),u=c.NONE}function Z(e){q(e)}function X(e){!1===r.enabled||!1===r.enableZoom||u!==c.NONE&&u!==c.ROTATE||(e.preventDefault(),r.dispatchEvent(s),function(e){e.deltaY<0?D(I()):e.deltaY>0&&L(I()),r.update()}(e),r.dispatchEvent(l))}function Y(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:R(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:R(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:R(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:R(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function J(e){!1!==r.enabled&&e.preventDefault()}function q(e){delete M[e.pointerId];for(let t=0;t<T.length;t++)if(T[t].pointerId==e.pointerId)return void T.splice(t,1)}function K(e){let t=M[e.pointerId];void 0===t&&(t=new i.Vector2,M[e.pointerId]=t),t.set(e.pageX,e.pageY)}function $(e){const t=e.pointerId===T[0].pointerId?T[1]:T[0];return M[t.pointerId]}void 0!==t&&this.connect(t),this.update()}}class s extends a{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=i.MOUSE.PAN,this.mouseButtons.RIGHT=i.MOUSE.ROTATE,this.touches.ONE=i.TOUCH.PAN,this.touches.TWO=i.TOUCH.DOLLY_ROTATE}}},7827:function(e,t,r){"use strict";r.d(t,{q:function(){return o}});var n=r(4649),i=r(6173);class o extends i.EventDispatcher{constructor(e,t){super(),(0,n.Z)(this,"camera",void 0),(0,n.Z)(this,"domElement",void 0),(0,n.Z)(this,"isLocked",!1),(0,n.Z)(this,"minPolarAngle",0),(0,n.Z)(this,"maxPolarAngle",Math.PI),(0,n.Z)(this,"changeEvent",{type:"change"}),(0,n.Z)(this,"lockEvent",{type:"lock"}),(0,n.Z)(this,"unlockEvent",{type:"unlock"}),(0,n.Z)(this,"euler",new i.Euler(0,0,0,"YXZ")),(0,n.Z)(this,"PI_2",Math.PI/2),(0,n.Z)(this,"vec",new i.Vector3),(0,n.Z)(this,"onMouseMove",(e=>{if(!1===this.isLocked)return;const t=e.movementX||e.mozMovementX||e.webkitMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||0;this.euler.setFromQuaternion(this.camera.quaternion),this.euler.y-=.002*t,this.euler.x-=.002*r,this.euler.x=Math.max(this.PI_2-this.maxPolarAngle,Math.min(this.PI_2-this.minPolarAngle,this.euler.x)),this.camera.quaternion.setFromEuler(this.euler),this.dispatchEvent(this.changeEvent)})),(0,n.Z)(this,"onPointerlockChange",(()=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(this.lockEvent),this.isLocked=!0):(this.dispatchEvent(this.unlockEvent),this.isLocked=!1)})),(0,n.Z)(this,"onPointerlockError",(()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")})),(0,n.Z)(this,"connect",(()=>{this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError)})),(0,n.Z)(this,"disconnect",(()=>{this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError)})),(0,n.Z)(this,"dispose",(()=>{this.disconnect()})),(0,n.Z)(this,"getObject",(()=>this.camera)),(0,n.Z)(this,"direction",new i.Vector3(0,0,-1)),(0,n.Z)(this,"getDirection",(e=>e.copy(this.direction).applyQuaternion(this.camera.quaternion))),(0,n.Z)(this,"moveForward",(e=>{this.vec.setFromMatrixColumn(this.camera.matrix,0),this.vec.crossVectors(this.camera.up,this.vec),this.camera.position.addScaledVector(this.vec,e)})),(0,n.Z)(this,"moveRight",(e=>{this.vec.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(this.vec,e)})),(0,n.Z)(this,"lock",(()=>{this.domElement.requestPointerLock()})),(0,n.Z)(this,"unlock",(()=>{this.domElement.ownerDocument.exitPointerLock()})),void 0===t&&(console.warn('THREE.PointerLockControls: The second parameter "domElement" is now mandatory.'),t=document.body),this.domElement=t,this.camera=e,this.connect()}}},9097:function(e,t,r){"use strict";r.d(t,{$:function(){return o}});var n=r(4649),i=r(6173);class o extends i.EventDispatcher{constructor(e,t){super(),(0,n.Z)(this,"enabled",!0),(0,n.Z)(this,"screen",{left:0,top:0,width:0,height:0}),(0,n.Z)(this,"rotateSpeed",1),(0,n.Z)(this,"zoomSpeed",1.2),(0,n.Z)(this,"panSpeed",.3),(0,n.Z)(this,"noRotate",!1),(0,n.Z)(this,"noZoom",!1),(0,n.Z)(this,"noPan",!1),(0,n.Z)(this,"staticMoving",!1),(0,n.Z)(this,"dynamicDampingFactor",.2),(0,n.Z)(this,"minDistance",0),(0,n.Z)(this,"maxDistance",1/0),(0,n.Z)(this,"keys",["KeyA","KeyS","KeyD"]),(0,n.Z)(this,"mouseButtons",{LEFT:i.MOUSE.ROTATE,MIDDLE:i.MOUSE.DOLLY,RIGHT:i.MOUSE.PAN}),(0,n.Z)(this,"object",void 0),(0,n.Z)(this,"domElement",void 0),(0,n.Z)(this,"cursorZoom",!1),(0,n.Z)(this,"target",new i.Vector3),(0,n.Z)(this,"mousePosition",new i.Vector2),(0,n.Z)(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),(0,n.Z)(this,"EPS",1e-6),(0,n.Z)(this,"lastZoom",1),(0,n.Z)(this,"lastPosition",new i.Vector3),(0,n.Z)(this,"cursorVector",new i.Vector3),(0,n.Z)(this,"targetVector",new i.Vector3),(0,n.Z)(this,"_state",this.STATE.NONE),(0,n.Z)(this,"_keyState",this.STATE.NONE),(0,n.Z)(this,"_eye",new i.Vector3),(0,n.Z)(this,"_movePrev",new i.Vector2),(0,n.Z)(this,"_moveCurr",new i.Vector2),(0,n.Z)(this,"_lastAxis",new i.Vector3),(0,n.Z)(this,"_lastAngle",0),(0,n.Z)(this,"_zoomStart",new i.Vector2),(0,n.Z)(this,"_zoomEnd",new i.Vector2),(0,n.Z)(this,"_touchZoomDistanceStart",0),(0,n.Z)(this,"_touchZoomDistanceEnd",0),(0,n.Z)(this,"_panStart",new i.Vector2),(0,n.Z)(this,"_panEnd",new i.Vector2),(0,n.Z)(this,"target0",void 0),(0,n.Z)(this,"position0",void 0),(0,n.Z)(this,"up0",void 0),(0,n.Z)(this,"zoom0",void 0),(0,n.Z)(this,"changeEvent",{type:"change"}),(0,n.Z)(this,"startEvent",{type:"start"}),(0,n.Z)(this,"endEvent",{type:"end"}),(0,n.Z)(this,"onScreenVector",new i.Vector2),(0,n.Z)(this,"getMouseOnScreen",((e,t)=>(this.onScreenVector.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),this.onScreenVector))),(0,n.Z)(this,"onCircleVector",new i.Vector2),(0,n.Z)(this,"getMouseOnCircle",((e,t)=>(this.onCircleVector.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-t))/this.screen.width),this.onCircleVector))),(0,n.Z)(this,"axis",new i.Vector3),(0,n.Z)(this,"quaternion",new i.Quaternion),(0,n.Z)(this,"eyeDirection",new i.Vector3),(0,n.Z)(this,"objectUpDirection",new i.Vector3),(0,n.Z)(this,"objectSidewaysDirection",new i.Vector3),(0,n.Z)(this,"moveDirection",new i.Vector3),(0,n.Z)(this,"angle",0),(0,n.Z)(this,"rotateCamera",(()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)})),(0,n.Z)(this,"zoomCamera",(()=>{let e;if(this._state===this.STATE.TOUCH_ZOOM_PAN)e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom/=e,this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,Math.abs(e-1)>this.EPS&&e>0&&(this.object.isPerspectiveCamera?(e>1&&this._eye.length()>=this.maxDistance-this.EPS&&(e=1),this._eye.multiplyScalar(e)):this.object.isOrthographicCamera?(e>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(e=1),this.object.zoom/=e):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let t=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(t,this.target,e)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}})),(0,n.Z)(this,"mouseChange",new i.Vector2),(0,n.Z)(this,"objectUp",new i.Vector3),(0,n.Z)(this,"pan",new i.Vector3),(0,n.Z)(this,"panCamera",(()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){const e=this.object,t=(e.right-e.left)/this.object.zoom,r=(e.top-e.bottom)/this.object.zoom;this.mouseChange.x*=t,this.mouseChange.y*=r}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}})),(0,n.Z)(this,"checkDistances",(()=>{this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))})),(0,n.Z)(this,"handleResize",(()=>{if(!this.domElement)return;const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height})),(0,n.Z)(this,"update",(()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")})),(0,n.Z)(this,"reset",(()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom})),(0,n.Z)(this,"keydown",(e=>{!1!==this.enabled&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(e.code!==this.keys[this.STATE.ROTATE]||this.noRotate?e.code!==this.keys[this.STATE.ZOOM]||this.noZoom?e.code!==this.keys[this.STATE.PAN]||this.noPan||(this._keyState=this.STATE.PAN):this._keyState=this.STATE.ZOOM:this._keyState=this.STATE.ROTATE))})),(0,n.Z)(this,"onPointerDown",(e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseDown(e)}})),(0,n.Z)(this,"onPointerMove",(e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseMove(e)}})),(0,n.Z)(this,"onPointerUp",(e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseUp()}})),(0,n.Z)(this,"keyup",(()=>{!1!==this.enabled&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))})),(0,n.Z)(this,"onMouseDown",(e=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(e.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN;break;default:this._state=this.STATE.NONE}const t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||(this._panStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)})),(0,n.Z)(this,"onMouseMove",(e=>{if(!1===this.enabled)return;const t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||this._panEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)))})),(0,n.Z)(this,"onMouseUp",(()=>{this.domElement&&!1!==this.enabled&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))})),(0,n.Z)(this,"mousewheel",(e=>{if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.mousePosition.x=e.offsetX/this.screen.width*2-1,this.mousePosition.y=-e.offsetY/this.screen.height*2+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}})),(0,n.Z)(this,"touchstart",(e=>{if(!1!==this.enabled){switch(e.preventDefault(),e.touches.length){case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this._state=this.STATE.TOUCH_ZOOM_PAN;const t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+r*r);const n=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(n,i)),this._panEnd.copy(this._panStart)}this.dispatchEvent(this.startEvent)}})),(0,n.Z)(this,"touchmove",(e=>{if(!1!==this.enabled)switch(e.preventDefault(),e.touches.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));break;default:const t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(t*t+r*r);const n=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(n,i))}})),(0,n.Z)(this,"touchend",(e=>{if(!1!==this.enabled){switch(e.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr)}this.dispatchEvent(this.endEvent)}})),(0,n.Z)(this,"contextmenu",(e=>{!1!==this.enabled&&e.preventDefault()})),(0,n.Z)(this,"connect",(e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()})),(0,n.Z)(this,"dispose",(()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))})),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,void 0!==t&&this.connect(t),this.update()}}},7642:function(e,t,r){"use strict";r.d(t,{Ys:function(){return o},JW:function(){return a},EC:function(){return s}});var n=r(4649),i=r(6173);class o extends i.Object3D{constructor(e,t){super(),(0,n.Z)(this,"isTransformControls",!0),(0,n.Z)(this,"visible",!1),(0,n.Z)(this,"domElement",void 0),(0,n.Z)(this,"raycaster",new i.Raycaster),(0,n.Z)(this,"gizmo",void 0),(0,n.Z)(this,"plane",void 0),(0,n.Z)(this,"tempVector",new i.Vector3),(0,n.Z)(this,"tempVector2",new i.Vector3),(0,n.Z)(this,"tempQuaternion",new i.Quaternion),(0,n.Z)(this,"unit",{X:new i.Vector3(1,0,0),Y:new i.Vector3(0,1,0),Z:new i.Vector3(0,0,1)}),(0,n.Z)(this,"pointStart",new i.Vector3),(0,n.Z)(this,"pointEnd",new i.Vector3),(0,n.Z)(this,"offset",new i.Vector3),(0,n.Z)(this,"rotationAxis",new i.Vector3),(0,n.Z)(this,"startNorm",new i.Vector3),(0,n.Z)(this,"endNorm",new i.Vector3),(0,n.Z)(this,"rotationAngle",0),(0,n.Z)(this,"cameraPosition",new i.Vector3),(0,n.Z)(this,"cameraQuaternion",new i.Quaternion),(0,n.Z)(this,"cameraScale",new i.Vector3),(0,n.Z)(this,"parentPosition",new i.Vector3),(0,n.Z)(this,"parentQuaternion",new i.Quaternion),(0,n.Z)(this,"parentQuaternionInv",new i.Quaternion),(0,n.Z)(this,"parentScale",new i.Vector3),(0,n.Z)(this,"worldPositionStart",new i.Vector3),(0,n.Z)(this,"worldQuaternionStart",new i.Quaternion),(0,n.Z)(this,"worldScaleStart",new i.Vector3),(0,n.Z)(this,"worldPosition",new i.Vector3),(0,n.Z)(this,"worldQuaternion",new i.Quaternion),(0,n.Z)(this,"worldQuaternionInv",new i.Quaternion),(0,n.Z)(this,"worldScale",new i.Vector3),(0,n.Z)(this,"eye",new i.Vector3),(0,n.Z)(this,"positionStart",new i.Vector3),(0,n.Z)(this,"quaternionStart",new i.Quaternion),(0,n.Z)(this,"scaleStart",new i.Vector3),(0,n.Z)(this,"camera",void 0),(0,n.Z)(this,"object",void 0),(0,n.Z)(this,"enabled",!0),(0,n.Z)(this,"axis",null),(0,n.Z)(this,"mode","translate"),(0,n.Z)(this,"translationSnap",null),(0,n.Z)(this,"rotationSnap",null),(0,n.Z)(this,"scaleSnap",null),(0,n.Z)(this,"space","world"),(0,n.Z)(this,"size",1),(0,n.Z)(this,"dragging",!1),(0,n.Z)(this,"showX",!0),(0,n.Z)(this,"showY",!0),(0,n.Z)(this,"showZ",!0),(0,n.Z)(this,"changeEvent",{type:"change"}),(0,n.Z)(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),(0,n.Z)(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),(0,n.Z)(this,"objectChangeEvent",{type:"objectChange"}),(0,n.Z)(this,"intersectObjectWithRay",((e,t,r)=>{const n=t.intersectObject(e,!0);for(let i=0;i<n.length;i++)if(n[i].object.visible||r)return n[i];return!1})),(0,n.Z)(this,"attach",(e=>(this.object=e,this.visible=!0,this))),(0,n.Z)(this,"detach",(()=>(this.object=void 0,this.visible=!1,this.axis=null,this))),(0,n.Z)(this,"updateMatrixWorld",(()=>{void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()})),(0,n.Z)(this,"pointerHover",(e=>{if(void 0===this.object||!0===this.dragging)return;this.raycaster.setFromCamera(e,this.camera);const t=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);this.axis=t?t.object.name:null})),(0,n.Z)(this,"pointerDown",(e=>{if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){this.raycaster.setFromCamera(e,this.camera);const t=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(t){let e=this.space;if("scale"===this.mode?e="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(e="world"),"local"===e&&"rotate"===this.mode){const e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}})),(0,n.Z)(this,"pointerMove",(e=>{const t=this.axis,r=this.mode,n=this.object;let i=this.space;if("scale"===r?i="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(i="world"),void 0===n||null===t||!1===this.dragging||-1!==e.button)return;this.raycaster.setFromCamera(e,this.camera);const o=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),"translate"===r)this.offset.copy(this.pointEnd).sub(this.pointStart),"local"===i&&"XYZ"!==t&&this.offset.applyQuaternion(this.worldQuaternionInv),-1===t.indexOf("X")&&(this.offset.x=0),-1===t.indexOf("Y")&&(this.offset.y=0),-1===t.indexOf("Z")&&(this.offset.z=0),"local"===i&&"XYZ"!==t?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),n.position.copy(this.offset).add(this.positionStart),this.translationSnap&&("local"===i&&(n.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this.quaternionStart)),"world"===i&&(n.parent&&n.position.add(this.tempVector.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(this.tempVector.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),this.tempVector2.set(e,e,e)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),-1===t.search("X")&&(this.tempVector2.x=1),-1===t.search("Y")&&(this.tempVector2.y=1),-1===t.search("Z")&&(this.tempVector2.z=1);n.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(-1!==t.search("X")&&(this.object.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===r){this.offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(this.unit[t]),this.tempVector.copy(this.unit[t]),"local"===i&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===i&&"E"!==t&&"XYZE"!==t?(n.quaternion.copy(this.quaternionStart),n.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),n.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}})),(0,n.Z)(this,"pointerUp",(e=>{0===e.button&&(this.dragging&&null!==this.axis&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)})),(0,n.Z)(this,"getPointer",(e=>{var t;if(this.domElement&&null!==(t=this.domElement.ownerDocument)&&void 0!==t&&t.pointerLockElement)return{x:0,y:0,button:e.button};{var r;const t=e.changedTouches?e.changedTouches[0]:e,n=null===(r=this.domElement)||void 0===r?void 0:r.getBoundingClientRect();return{x:(t.clientX-n.left)/n.width*2-1,y:-(t.clientY-n.top)/n.height*2+1,button:e.button}}})),(0,n.Z)(this,"onPointerHover",(e=>{if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(e))}})),(0,n.Z)(this,"onPointerDown",(e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(e)),this.pointerDown(this.getPointer(e)))})),(0,n.Z)(this,"onPointerMove",(e=>{this.enabled&&this.pointerMove(this.getPointer(e))})),(0,n.Z)(this,"onPointerUp",(e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(e)))})),(0,n.Z)(this,"getMode",(()=>this.mode)),(0,n.Z)(this,"setMode",(e=>{this.mode=e})),(0,n.Z)(this,"setTranslationSnap",(e=>{this.translationSnap=e})),(0,n.Z)(this,"setRotationSnap",(e=>{this.rotationSnap=e})),(0,n.Z)(this,"setScaleSnap",(e=>{this.scaleSnap=e})),(0,n.Z)(this,"setSize",(e=>{this.size=e})),(0,n.Z)(this,"setSpace",(e=>{this.space=e})),(0,n.Z)(this,"update",(()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")})),(0,n.Z)(this,"connect",(e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)})),(0,n.Z)(this,"dispose",(()=>{var e,t,r,n,i,o;null===(e=this.domElement)||void 0===e||e.removeEventListener("pointerdown",this.onPointerDown),null===(t=this.domElement)||void 0===t||t.removeEventListener("pointermove",this.onPointerHover),null===(r=this.domElement)||void 0===r||null===(n=r.ownerDocument)||void 0===n||n.removeEventListener("pointermove",this.onPointerMove),null===(i=this.domElement)||void 0===i||null===(o=i.ownerDocument)||void 0===o||o.removeEventListener("pointerup",this.onPointerUp),this.traverse((e=>{const t=e;t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))})),this.domElement=t,this.camera=e,this.gizmo=new a,this.add(this.gizmo),this.plane=new s,this.add(this.plane);const r=(e,t)=>{let r=t;Object.defineProperty(this,e,{get:function(){return void 0!==r?r:t},set:function(t){r!==t&&(r=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),this[e]=t,this.plane[e]=t,this.gizmo[e]=t};r("camera",this.camera),r("object",this.object),r("enabled",this.enabled),r("axis",this.axis),r("mode",this.mode),r("translationSnap",this.translationSnap),r("rotationSnap",this.rotationSnap),r("scaleSnap",this.scaleSnap),r("space",this.space),r("size",this.size),r("dragging",this.dragging),r("showX",this.showX),r("showY",this.showY),r("showZ",this.showZ),r("worldPosition",this.worldPosition),r("worldPositionStart",this.worldPositionStart),r("worldQuaternion",this.worldQuaternion),r("worldQuaternionStart",this.worldQuaternionStart),r("cameraPosition",this.cameraPosition),r("cameraQuaternion",this.cameraQuaternion),r("pointStart",this.pointStart),r("pointEnd",this.pointEnd),r("rotationAxis",this.rotationAxis),r("rotationAngle",this.rotationAngle),r("eye",this.eye),void 0!==t&&this.connect(t)}}class a extends i.Object3D{constructor(){super(),(0,n.Z)(this,"isTransformControlsGizmo",!0),(0,n.Z)(this,"type","TransformControlsGizmo"),(0,n.Z)(this,"tempVector",new i.Vector3(0,0,0)),(0,n.Z)(this,"tempEuler",new i.Euler),(0,n.Z)(this,"alignVector",new i.Vector3(0,1,0)),(0,n.Z)(this,"zeroVector",new i.Vector3(0,0,0)),(0,n.Z)(this,"lookAtMatrix",new i.Matrix4),(0,n.Z)(this,"tempQuaternion",new i.Quaternion),(0,n.Z)(this,"tempQuaternion2",new i.Quaternion),(0,n.Z)(this,"identityQuaternion",new i.Quaternion),(0,n.Z)(this,"unitX",new i.Vector3(1,0,0)),(0,n.Z)(this,"unitY",new i.Vector3(0,1,0)),(0,n.Z)(this,"unitZ",new i.Vector3(0,0,1)),(0,n.Z)(this,"gizmo",void 0),(0,n.Z)(this,"picker",void 0),(0,n.Z)(this,"helper",void 0),(0,n.Z)(this,"rotationAxis",new i.Vector3),(0,n.Z)(this,"cameraPosition",new i.Vector3),(0,n.Z)(this,"worldPositionStart",new i.Vector3),(0,n.Z)(this,"worldQuaternionStart",new i.Quaternion),(0,n.Z)(this,"worldPosition",new i.Vector3),(0,n.Z)(this,"worldQuaternion",new i.Quaternion),(0,n.Z)(this,"eye",new i.Vector3),(0,n.Z)(this,"camera",null),(0,n.Z)(this,"enabled",!0),(0,n.Z)(this,"axis",null),(0,n.Z)(this,"mode","translate"),(0,n.Z)(this,"space","world"),(0,n.Z)(this,"size",1),(0,n.Z)(this,"dragging",!1),(0,n.Z)(this,"showX",!0),(0,n.Z)(this,"showY",!0),(0,n.Z)(this,"showZ",!0),(0,n.Z)(this,"updateMatrixWorld",(()=>{let e=this.space;"scale"===this.mode&&(e="local");const t="local"===e?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let r=[];r=r.concat(this.picker[this.mode].children),r=r.concat(this.gizmo[this.mode].children),r=r.concat(this.helper[this.mode].children);for(let n=0;n<r.length;n++){const e=r[n];let o;if(e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition),o=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==e.tag){if(e.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const r=.99,n=.2,i=0;"X"!==e.name&&"XYZX"!==e.name||Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Y"!==e.name&&"XYZY"!==e.name||Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Z"!==e.name&&"XYZZ"!==e.name||Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XY"===e.name&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))<n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"YZ"===e.name&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))<n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XZ"===e.name&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))<n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),-1!==e.name.search("X")&&(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye)<i?"fwd"===e.tag?e.visible=!1:e.scale.x*=-1:"bwd"===e.tag&&(e.visible=!1)),-1!==e.name.search("Y")&&(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye)<i?"fwd"===e.tag?e.visible=!1:e.scale.y*=-1:"bwd"===e.tag&&(e.visible=!1)),-1!==e.name.search("Z")&&(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye)<i?"fwd"===e.tag?e.visible=!1:e.scale.z*=-1:"bwd"===e.tag&&(e.visible=!1))}else"rotate"===this.mode&&(this.tempQuaternion2.copy(t),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(t).invert()),-1!==e.name.search("E")&&e.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),"X"===e.name&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),e.quaternion.copy(this.tempQuaternion)),"Y"===e.name&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),e.quaternion.copy(this.tempQuaternion)),"Z"===e.name&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),e.quaternion.copy(this.tempQuaternion)));e.visible=e.visible&&(-1===e.name.indexOf("X")||this.showX),e.visible=e.visible&&(-1===e.name.indexOf("Y")||this.showY),e.visible=e.visible&&(-1===e.name.indexOf("Z")||this.showZ),e.visible=e.visible&&(-1===e.name.indexOf("E")||this.showX&&this.showY&&this.showZ),e.material.tempOpacity=e.material.tempOpacity||e.material.opacity,e.material.tempColor=e.material.tempColor||e.material.color.clone(),e.material.color.copy(e.material.tempColor),e.material.opacity=e.material.tempOpacity,this.enabled?this.axis&&(e.name===this.axis||this.axis.split("").some((function(t){return e.name===t}))?(e.material.opacity=1,e.material.color.lerp(new i.Color(1,1,1),.5)):(e.material.opacity*=.25,e.material.color.lerp(new i.Color(1,1,1),.5))):(e.material.opacity*=.5,e.material.color.lerp(new i.Color(1,1,1),.5))}else e.visible=!1,"AXIS"===e.name?(e.position.copy(this.worldPositionStart),e.visible=!!this.axis,"X"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),e.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Y"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),e.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Z"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),e.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"XYZE"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),e.quaternion.multiply(this.tempQuaternion),e.visible=this.dragging),"E"===this.axis&&(e.visible=!1)):"START"===e.name?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):"END"===e.name?(e.position.copy(this.worldPosition),e.visible=this.dragging):"DELTA"===e.name?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(this.tempVector),e.visible=this.dragging):(e.quaternion.copy(t),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=-1!==this.axis.search(e.name)))}super.updateMatrixWorld()}));const e=new i.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:i.DoubleSide,fog:!1,toneMapped:!1}),t=new i.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),r=e.clone();r.opacity=.15;const o=e.clone();o.opacity=.33;const a=e.clone();a.color.set(16711680);const s=e.clone();s.color.set(65280);const l=e.clone();l.color.set(255);const c=e.clone();c.opacity=.25;const u=c.clone();u.color.set(16776960);const h=c.clone();h.color.set(65535);const d=c.clone();d.color.set(16711935);e.clone().color.set(16776960);const f=t.clone();f.color.set(16711680);const p=t.clone();p.color.set(65280);const m=t.clone();m.color.set(255);const g=t.clone();g.color.set(65535);const A=t.clone();A.color.set(16711935);const v=t.clone();v.color.set(16776960);const y=t.clone();y.color.set(7895160);const x=v.clone();x.opacity=.25;const b=new i.CylinderGeometry(0,.05,.2,12,1,!1),w=new i.BoxGeometry(.125,.125,.125),C=new i.BufferGeometry;C.setAttribute("position",new i.Float32BufferAttribute([0,0,0,1,0,0],3));const E=(e,t)=>{const r=new i.BufferGeometry,n=[];for(let i=0;i<=64*t;++i)n.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return r.setAttribute("position",new i.Float32BufferAttribute(n,3)),r},S={X:[[new i.Mesh(b,a),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new i.Mesh(b,a),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new i.Line(C,f)]],Y:[[new i.Mesh(b,s),[0,1,0],null,null,"fwd"],[new i.Mesh(b,s),[0,1,0],[Math.PI,0,0],null,"bwd"],[new i.Line(C,p),null,[0,0,Math.PI/2]]],Z:[[new i.Mesh(b,l),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new i.Mesh(b,l),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new i.Line(C,m),null,[0,-Math.PI/2,0]]],XYZ:[[new i.Mesh(new i.OctahedronGeometry(.1,0),c.clone()),[0,0,0],[0,0,0]]],XY:[[new i.Mesh(new i.PlaneGeometry(.295,.295),u.clone()),[.15,.15,0]],[new i.Line(C,v),[.18,.3,0],null,[.125,1,1]],[new i.Line(C,v),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new i.Mesh(new i.PlaneGeometry(.295,.295),h.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new i.Line(C,g),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new i.Line(C,g),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new i.Mesh(new i.PlaneGeometry(.295,.295),d.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new i.Line(C,A),[.18,0,.3],null,[.125,1,1]],[new i.Line(C,A),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},T={X:[[new i.Mesh(new i.CylinderGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new i.Mesh(new i.CylinderGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new i.Mesh(new i.CylinderGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new i.Mesh(new i.OctahedronGeometry(.2,0),r)]],XY:[[new i.Mesh(new i.PlaneGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new i.Mesh(new i.PlaneGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new i.Mesh(new i.PlaneGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},M={START:[[new i.Mesh(new i.OctahedronGeometry(.01,2),o),null,null,null,"helper"]],END:[[new i.Mesh(new i.OctahedronGeometry(.01,2),o),null,null,null,"helper"]],DELTA:[[new i.Line((()=>{const e=new i.BufferGeometry;return e.setAttribute("position",new i.Float32BufferAttribute([0,0,0,1,1,1],3)),e})(),o),null,null,null,"helper"]],X:[[new i.Line(C,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new i.Line(C,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new i.Line(C,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I={X:[[new i.Line(E(1,.5),f)],[new i.Mesh(new i.OctahedronGeometry(.04,0),a),[0,0,.99],null,[1,3,1]]],Y:[[new i.Line(E(1,.5),p),null,[0,0,-Math.PI/2]],[new i.Mesh(new i.OctahedronGeometry(.04,0),s),[0,0,.99],null,[3,1,1]]],Z:[[new i.Line(E(1,.5),m),null,[0,Math.PI/2,0]],[new i.Mesh(new i.OctahedronGeometry(.04,0),l),[.99,0,0],null,[1,3,1]]],E:[[new i.Line(E(1.25,1),x),null,[0,Math.PI/2,0]],[new i.Mesh(new i.CylinderGeometry(.03,0,.15,4,1,!1),x),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new i.Mesh(new i.CylinderGeometry(.03,0,.15,4,1,!1),x),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new i.Mesh(new i.CylinderGeometry(.03,0,.15,4,1,!1),x),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new i.Mesh(new i.CylinderGeometry(.03,0,.15,4,1,!1),x),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new i.Line(E(1,1),y),null,[0,Math.PI/2,0]]]},B={AXIS:[[new i.Line(C,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},_={X:[[new i.Mesh(new i.TorusGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new i.Mesh(new i.TorusGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new i.Mesh(new i.TorusGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new i.Mesh(new i.TorusGeometry(1.25,.1,2,24),r)]],XYZE:[[new i.Mesh(new i.SphereGeometry(.7,10,8),r)]]},F={X:[[new i.Mesh(w,a),[.8,0,0],[0,0,-Math.PI/2]],[new i.Line(C,f),null,null,[.8,1,1]]],Y:[[new i.Mesh(w,s),[0,.8,0]],[new i.Line(C,p),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new i.Mesh(w,l),[0,0,.8],[Math.PI/2,0,0]],[new i.Line(C,m),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new i.Mesh(w,u),[.85,.85,0],null,[2,2,.2]],[new i.Line(C,v),[.855,.98,0],null,[.125,1,1]],[new i.Line(C,v),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new i.Mesh(w,h),[0,.85,.85],null,[.2,2,2]],[new i.Line(C,g),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new i.Line(C,g),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new i.Mesh(w,d),[.85,0,.85],null,[2,.2,2]],[new i.Line(C,A),[.855,0,.98],null,[.125,1,1]],[new i.Line(C,A),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new i.Mesh(new i.BoxGeometry(.125,.125,.125),c.clone()),[1.1,0,0]]],XYZY:[[new i.Mesh(new i.BoxGeometry(.125,.125,.125),c.clone()),[0,1.1,0]]],XYZZ:[[new i.Mesh(new i.BoxGeometry(.125,.125,.125),c.clone()),[0,0,1.1]]]},P={X:[[new i.Mesh(new i.CylinderGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new i.Mesh(new i.CylinderGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new i.Mesh(new i.CylinderGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new i.Mesh(w,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new i.Mesh(w,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new i.Mesh(w,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new i.Mesh(new i.BoxGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new i.Mesh(new i.BoxGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new i.Mesh(new i.BoxGeometry(.2,.2,.2),r),[0,0,1.1]]]},R={X:[[new i.Line(C,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new i.Line(C,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new i.Line(C,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},L=e=>{const t=new i.Object3D;for(let r in e)for(let n=e[r].length;n--;){const i=e[r][n][0].clone(),o=e[r][n][1],a=e[r][n][2],s=e[r][n][3],l=e[r][n][4];i.name=r,i.tag=l,o&&i.position.set(o[0],o[1],o[2]),a&&i.rotation.set(a[0],a[1],a[2]),s&&i.scale.set(s[0],s[1],s[2]),i.updateMatrix();const c=i.geometry.clone();c.applyMatrix4(i.matrix),i.geometry=c,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=L(S)),this.add(this.gizmo.rotate=L(I)),this.add(this.gizmo.scale=L(F)),this.add(this.picker.translate=L(T)),this.add(this.picker.rotate=L(_)),this.add(this.picker.scale=L(P)),this.add(this.helper.translate=L(M)),this.add(this.helper.rotate=L(B)),this.add(this.helper.scale=L(R)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class s extends i.Mesh{constructor(){super(new i.PlaneGeometry(1e5,1e5,2,2),new i.MeshBasicMaterial({visible:!1,wireframe:!0,side:i.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),(0,n.Z)(this,"isTransformControlsPlane",!0),(0,n.Z)(this,"type","TransformControlsPlane"),(0,n.Z)(this,"unitX",new i.Vector3(1,0,0)),(0,n.Z)(this,"unitY",new i.Vector3(0,1,0)),(0,n.Z)(this,"unitZ",new i.Vector3(0,0,1)),(0,n.Z)(this,"tempVector",new i.Vector3),(0,n.Z)(this,"dirVector",new i.Vector3),(0,n.Z)(this,"alignVector",new i.Vector3),(0,n.Z)(this,"tempMatrix",new i.Matrix4),(0,n.Z)(this,"identityQuaternion",new i.Quaternion),(0,n.Z)(this,"cameraQuaternion",new i.Quaternion),(0,n.Z)(this,"worldPosition",new i.Vector3),(0,n.Z)(this,"worldQuaternion",new i.Quaternion),(0,n.Z)(this,"eye",new i.Vector3),(0,n.Z)(this,"axis",null),(0,n.Z)(this,"mode","translate"),(0,n.Z)(this,"space","world"),(0,n.Z)(this,"updateMatrixWorld",(()=>{let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),this.unitX.set(1,0,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0)}break;case"rotate":default:this.dirVector.set(0,0,0)}0===this.dirVector.length()?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()}))}}},9080:function(e,t,r){"use strict";r.d(t,{e:function(){return o}});var n=r(6173),i=r(4090);class o extends n.Curve{constructor(e,t,r,i,o){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=o||this.knots.length-1;for(let a=0;a<r.length;++a){const e=r[a];this.controlPoints[a]=new n.Vector4(e.x,e.y,e.z,e.w)}}getPoint(e,t){const r=t||new n.Vector3,o=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=(0,i.bF)(this.degree,this.knots,this.controlPoints,o);return 1!=a.w&&a.divideScalar(a.w),r.set(a.x,a.y,a.z)}getTangent(e,t){const r=t||new n.Vector3,o=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=(0,i.MI)(this.degree,this.knots,this.controlPoints,o,1);return r.copy(a[1]).normalize(),r}}},4090:function(e,t,r){"use strict";r.d(t,{eR:function(){return l},bF:function(){return a},HB:function(){return s},EP:function(){return o},wD:function(){return c},MI:function(){return h},Yb:function(){return u},nl:function(){return d},sj:function(){return i}});var n=r(6173);function i(e,t,r){const n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;let i=e,o=n,a=Math.floor((i+o)/2);for(;t<r[a]||t>=r[a+1];)t<r[a]?o=a:i=a,a=Math.floor((i+o)/2);return a}function o(e,t,r,n){const i=[],o=[],a=[];i[0]=1;for(let s=1;s<=r;++s){o[s]=t-n[e+1-s],a[s]=n[e+s]-t;let r=0;for(let e=0;e<s;++e){const t=a[e+1],n=o[s-e],l=i[e]/(t+n);i[e]=r+t*l,r=n*l}i[s]=r}return i}function a(e,t,r,i){const o=this.findSpan(e,i,t),a=this.calcBasisFunctions(o,i,e,t),s=new n.Vector4(0,0,0,0);for(let n=0;n<=e;++n){const t=r[o-e+n],i=a[n],l=t.w*i;s.x+=t.x*l,s.y+=t.y*l,s.z+=t.z*l,s.w+=t.w*i}return s}function s(e,t,r,n,i){const o=[];for(let d=0;d<=r;++d)o[d]=0;const a=[];for(let d=0;d<=n;++d)a[d]=o.slice(0);const s=[];for(let d=0;d<=r;++d)s[d]=o.slice(0);s[0][0]=1;const l=o.slice(0),c=o.slice(0);for(let d=1;d<=r;++d){l[d]=t-i[e+1-d],c[d]=i[e+d]-t;let r=0;for(let e=0;e<d;++e){const t=c[e+1],n=l[d-e];s[d][e]=t+n;const i=s[e][d-1]/s[d][e];s[e][d]=r+t*i,r=n*i}s[d][d]=r}for(let d=0;d<=r;++d)a[0][d]=s[d][r];for(let d=0;d<=r;++d){let e=0,t=1;const i=[];for(let n=0;n<=r;++n)i[n]=o.slice(0);i[0][0]=1;for(let o=1;o<=n;++o){let n=0;const l=d-o,c=r-o;d>=o&&(i[t][0]=i[e][0]/s[c+1][l],n=i[t][0]*s[l][c]);const h=d-1<=c?o-1:r-d;for(let r=l>=-1?1:-l;r<=h;++r)i[t][r]=(i[e][r]-i[e][r-1])/s[c+1][l+r],n+=i[t][r]*s[l+r][c];d<=c&&(i[t][o]=-i[e][o-1]/s[c+1][d],n+=i[t][o]*s[d][c]),a[o][d]=n;var u=e;e=t,t=u}}var h=r;for(let d=1;d<=n;++d){for(let e=0;e<=r;++e)a[d][e]*=h;h*=r-d}return a}function l(e,t,r,i,o){const a=o<e?o:e,s=[],l=this.findSpan(e,i,t),c=this.calcBasisFunctionDerivatives(l,i,e,a,t),u=[];for(let n=0;n<r.length;++n){const e=(h=r[n].clone()).w;h.x*=e,h.y*=e,h.z*=e,u[n]=h}for(let n=0;n<=a;++n){var h=u[l-e].clone().multiplyScalar(c[n][0]);for(let t=1;t<=e;++t)h.add(u[l-e+t].clone().multiplyScalar(c[n][t]));s[n]=h}for(let d=a+1;d<=o+1;++d)s[d]=new n.Vector4(0,0,0);return s}function c(e,t){let r=1;for(let i=2;i<=e;++i)r*=i;let n=1;for(let i=2;i<=t;++i)n*=i;for(let i=2;i<=e-t;++i)n*=i;return r/n}function u(e){const t=e.length,r=[],i=[];for(let a=0;a<t;++a){const t=e[a];r[a]=new n.Vector3(t.x,t.y,t.z),i[a]=t.w}const o=[];for(let n=0;n<t;++n){const e=r[n].clone();for(let t=1;t<=n;++t)e.sub(o[n-t].clone().multiplyScalar(this.calcKoverI(n,t)*i[t]));o[n]=e.divideScalar(i[0])}return o}function h(e,t,r,n,i){const o=this.calcBSplineDerivatives(e,t,r,n,i);return this.calcRationalCurveDerivatives(o)}function d(e,t,r,i,o,a,s,l){const c=this.findSpan(e,a,r),u=this.findSpan(t,s,i),h=this.calcBasisFunctions(c,a,e,r),d=this.calcBasisFunctions(u,s,t,i),f=[];for(let m=0;m<=t;++m){f[m]=new n.Vector4(0,0,0,0);for(let r=0;r<=e;++r){const n=o[c-e+r][u-t+m].clone(),i=n.w;n.x*=i,n.y*=i,n.z*=i,f[m].add(n.multiplyScalar(h[r]))}}const p=new n.Vector4(0,0,0,0);for(let n=0;n<=t;++n)p.add(f[n].multiplyScalar(d[n]));p.divideScalar(p.w),l.set(p.x,p.y,p.z)}},1809:function(e,t,r){"use strict";r.r(t),r.d(t,{ACESFilmicToneMappingShader:function(){return Ba},AMFLoader:function(){return Dc},ARButton:function(){return $o},AdaptiveToneMappingPass:function(){return wo},AfterimagePass:function(){return Fo},AfterimageShader:function(){return _o},AmmoPhysics:function(){return ps},AnaglyphEffect:function(){return ys},AnimationClipCreator:function(){return Cn},ArcballControls:function(){return Zi.A},AsciiEffect:function(){return xs},AssimpLoader:function(){return Ks},AttributeNode:function(){return ar},BVHLoader:function(){return Rs},BasicNode:function(){return Xt},BasicNodeMaterial:function(){return rr},BasicShader:function(){return ls},BasisTextureLoader:function(){return cl.g},BleachBypassShader:function(){return Ta},BlendColorFactor:function(){return oe},BlendShader:function(){return Ma},BloomPass:function(){return jo},BlurNode:function(){return Br},BlurShaderUtils:function(){return Io},BokehDepthShader:function(){return li},BokehPass:function(){return vo},BokehShader:function(){return Ao},BokehShader2:function(){return si},BoolNode:function(){return Dr},BoxLineGeometry:function(){return ia},BrightnessContrastShader:function(){return ts},BumpMapNode:function(){return _t},BypassNode:function(){return pr},CCDIKSolver:function(){return En},CSM:function(){return ya},CSMHelper:function(){return xa},CSS2DObject:function(){return L},CSS2DRenderer:function(){return D},CSS3DObject:function(){return Me},CSS3DRenderer:function(){return Be},CSS3DSprite:function(){return Ie},CameraControls:function(){return Ni},CameraNode:function(){return sr},Capsule:function(){return Bi},CheckerNode:function(){return Fr},CinematicCamera:function(){return ci},CinquefoilKnot:function(){return Yu},ClearMaskPass:function(){return Po.M},ClearPass:function(){return Ki},ColladaExporter:function(){return An},ColladaLoader:function(){return Ls},ColorAdjustmentNode:function(){return Ir},ColorConverter:function(){return _i},ColorCorrectionShader:function(){return Pa},ColorMapKeywords:function(){return Li},ColorNode:function(){return Ft},ColorNodeUniform:function(){return ye},ColorSpaceNode:function(){return xt},ColorUniform:function(){return de},ColorifyShader:function(){return hs},ColorsNode:function(){return fr},CondNode:function(){return wr},ConstNode:function(){return lt},ConvexGeometry:function(){return d},ConvexHull:function(){return h},ConvexObjectBreaker:function(){return f},ConvolutionShader:function(){return zo},CopyShader:function(){return co.C},CubeTextureNode:function(){return Ut},CubeTexturePass:function(){return So},DDSLoader:function(){return ol},DOFMipMapShader:function(){return cs},DRACOExporter:function(){return gn},DRACOLoader:function(){return Jc._},DecalGeometry:function(){return oa},DecalVertex:function(){return aa},DecoratedTorusKnot4a:function(){return $u},DecoratedTorusKnot4b:function(){return eh},DecoratedTorusKnot5a:function(){return th},DecoratedTorusKnot5c:function(){return rh},DepthLimitedBlurShader:function(){return Mo},DeviceOrientationControls:function(){return ji.W},DigitalGlitch:function(){return $i},DotScreenPass:function(){return Do},DotScreenShader:function(){return Lo},DragControls:function(){return Gi},EXRLoader:function(){return el},EdgeSplitModifier:function(){return tt},EffectComposer:function(){return Ro.x},ExpressionNode:function(){return At},FBXLoader:function(){return Wo.y},FXAAShader:function(){return Ua},Face3:function(){return lh},FigureEightPolynomialKnot:function(){return Ku},FilmPass:function(){return lo},FilmShader:function(){return so},FirstPersonControls:function(){return Qi.o},FlakesTexture:function(){return Oe},FloatNode:function(){return at},FloatNodeUniform:function(){return me},FloatUniform:function(){return le},Flow:function(){return Ue.Zw},FlyControls:function(){return Xi.m},FocusShader:function(){return La},Font:function(){return Cs},FontLoader:function(){return ws},FreiChenShader:function(){return qa},FresnelShader:function(){return as},FullScreenQuad:function(){return qi.T},FunctionCallNode:function(){return gt},FunctionNode:function(){return mt},GCodeLoader:function(){return ll},GLTFExporter:function(){return kr},GLTFLoader:function(){return Ns.E},GPUAddressMode:function(){return Y},GPUBindingType:function(){return te},GPUBlendFactor:function(){return q},GPUBlendOperation:function(){return K},GPUColorWriteFlags:function(){return $},GPUCompareFunction:function(){return Q},GPUComputationRenderer:function(){return p},GPUCullMode:function(){return H},GPUFilterMode:function(){return J},GPUFrontFace:function(){return z},GPUIndexFormat:function(){return W},GPUInputStepMode:function(){return ie},GPULoadOp:function(){return G},GPUPrimitiveTopology:function(){return U},GPUStencilOperation:function(){return ee},GPUStoreOp:function(){return V},GPUTextureDimension:function(){return re},GPUTextureFormat:function(){return X},GPUTextureViewDimension:function(){return ne},GPUVertexFormat:function(){return Z},GammaCorrectionShader:function(){return ns.Y},Geometry:function(){return ah},GeometryCompressionUtils:function(){return oi},GlitchPass:function(){return eo},GodRaysCombineShader:function(){return Ca},GodRaysDepthMaskShader:function(){return ba},GodRaysFakeSunShader:function(){return Ea},GodRaysGenerateShader:function(){return wa},GrannyKnot:function(){return Gu},Gyroscope:function(){return m},HDRCubeTextureLoader:function(){return qc},HalftonePass:function(){return ro},HalftoneShader:function(){return to},HeartCurve:function(){return zu},HelixCurve:function(){return Wu},HorizontalBlurShader:function(){return os.P},HorizontalTiltShiftShader:function(){return $a},HueSaturationShader:function(){return ss},IFFParser:function(){return mc},ImprovedNoise:function(){return Fi},InputNode:function(){return ot},InstancedFlow:function(){return Ue.iJ},IntNode:function(){return Lr},JoinNode:function(){return xr},KMZLoader:function(){return Ds},KTX2Loader:function(){return Zs.a},KTXLoader:function(){return zc},KaleidoShader:function(){return Ia},KnotCurve:function(){return Hu},LDrawLoader:function(){return dc},LUT3dlLoader:function(){return il},LUTCubeLoader:function(){return Ts},LUTPass:function(){return Ji},LWO2Parser:function(){return pc},LWO3Parser:function(){return fc},LWOLoader:function(){return pu},Lensflare:function(){return Fn},LensflareElement:function(){return Pn},LightNode:function(){return lr},LightProbeGenerator:function(){return ku},LightProbeHelper:function(){return Tu},LightningStorm:function(){return Un},LightningStrike:function(){return On},Line2:function(){return Eu.w},LineGeometry:function(){return xu.L},LineMaterial:function(){return bu.Y},LineSegments2:function(){return Su.w},LineSegmentsGeometry:function(){return yu.z},LottieLoader:function(){return Xs},LuminanceNode:function(){return Mr},LuminosityHighPassShader:function(){return Co},LuminosityShader:function(){return xo},Lut:function(){return Ri},MD2Character:function(){return B},MD2CharacterComplex:function(){return u},MD2Loader:function(){return l},MDDLoader:function(){return $s},MMDAnimationHelper:function(){return Tn},MMDExporter:function(){return yn},MMDLoader:function(){return Nc},MMDPhysics:function(){return Sn},MTLLoader:function(){return _s},MapControls:function(){return Wi.o},MapControlsExp:function(){return Oi},MarchingCubes:function(){return Ln},MaskPass:function(){return Po.F},MathNode:function(){return yt},Matrix3Node:function(){return Ar},Matrix3NodeUniform:function(){return xe},Matrix3Uniform:function(){return fe},Matrix4Node:function(){return Pr},Matrix4NodeUniform:function(){return be},Matrix4Uniform:function(){return pe},MaxMIPLevelNode:function(){return Pt},MeshStandardNode:function(){return qt},MeshStandardNodeMaterial:function(){return tr},MeshSurfaceSampler:function(){return ui},MeshoptDecoder:function(){return ch.z},MirrorShader:function(){return Sa},MorphAnimMesh:function(){return g},MorphBlendMesh:function(){return c},NRRDLoader:function(){return Ms},NURBSCurve:function(){return Qu.e},NURBSSurface:function(){return Vu},Node:function(){return nt},NodeBuilder:function(){return jt},NodeFrame:function(){return or},NodeLib:function(){return dt},NodeMaterial:function(){return Wt},NodeMaterialLoader:function(){return uu},NodeMaterialLoaderUtils:function(){return hu},NodePass:function(){return Tr},NodePostProcessing:function(){return Er},NodeShaderStage:function(){return N},NodeType:function(){return O},NodeUniform:function(){return Dt},NodeUpdateType:function(){return k},NodeUtils:function(){return Tt},NoiseNode:function(){return _r},NormalMapNode:function(){return Bt},NormalMapShader:function(){return Ja},NormalNode:function(){return Ct},OBB:function(){return Mi},OBJExporter:function(){return bn},OBJLoader:function(){return Lc},Octree:function(){return Pi},OneMinusBlendColorFactor:function(){return ae},OperatorNode:function(){return vt},OrbitControls:function(){return Wi.z},OrbitControlsExp:function(){return ki},OutlineEffect:function(){return vs},OutlinePass:function(){return uo},PCDLoader:function(){return du},PDBLoader:function(){return Kc},PLYExporter:function(){return mn},PLYLoader:function(){return vu},PRWMLoader:function(){return iu},PVRLoader:function(){return al},PackedPhongMaterial:function(){return ai},ParallaxBarrierEffect:function(){return gs},ParallaxShader:function(){return _a},ParametricGeometries:function(){return ea},Pass:function(){return qi.w},PeppersGhostEffect:function(){return As},PhongNode:function(){return Kt},PhongNodeMaterial:function(){return er},PixelShader:function(){return Ra},PointerLockControls:function(){return zi.q},PositionNode:function(){return wt},PositionalAudioHelper:function(){return _u},ProgressiveLightMap:function(){return R},Projector:function(){return De},PropertyNode:function(){return Yt},RGBELoader:function(){return qs.x},RGBMLoader:function(){return ou},RGBShiftShader:function(){return Na},RTTNode:function(){return Nr},RawNode:function(){return Ht},RectAreaLightHelper:function(){return Du},RectAreaLightUniformsLib:function(){return Nu.a},ReflectNode:function(){return Et},Reflector:function(){return Mn},ReflectorForSSRPass:function(){return Vn},ReflectorNode:function(){return Rr},ReflectorRTT:function(){return Qn},Refractor:function(){return In},RenderPass:function(){return Go.C},RenderableFace:function(){return Fe},RenderableLine:function(){return Re},RenderableObject:function(){return _e},RenderableSprite:function(){return Le},RenderableVertex:function(){return Pe},ResolutionNode:function(){return cr},Rhino3dmLoader:function(){return wc},RollerCoasterGeometry:function(){return A},RollerCoasterLiftersGeometry:function(){return v},RollerCoasterShadowGeometry:function(){return y},RoomEnvironment:function(){return wn},RoughnessMipmapper:function(){return ei},RoundedBoxGeometry:function(){return na},SAOPass:function(){return Bo},SAOShader:function(){return To},SMAABlendShader:function(){return oo},SMAAEdgesShader:function(){return no},SMAAPass:function(){return ao},SMAAWeightsShader:function(){return io},SSAARenderPass:function(){return Qo},SSAOBlurShader:function(){return po},SSAODepthShader:function(){return fo},SSAOPass:function(){return mo},SSAOShader:function(){return ho},SSRBlurShader:function(){return Oo},SSRDepthShader:function(){return ko},SSRPass:function(){return Uo},SSRShader:function(){return No},STATE:function(){return Di},STLExporter:function(){return xn},STLLoader:function(){return Bs},SVGLoader:function(){return xc},SVGObject:function(){return Ne},SVGRenderer:function(){return ke},SavePass:function(){return go},SceneUtils:function(){return jn},ScreenNode:function(){return Cr},ScreenUVNode:function(){return ur},SelectionBox:function(){return fs.M},SelectionHelper:function(){return ds},SepiaShader:function(){return Oa},ShaderPass:function(){return Sr.T},ShadowMapViewer:function(){return ii},ShadowMesh:function(){return _n},SimplexNoise:function(){return kn.L},SimplifyModifier:function(){return et},SkeletonUtils:function(){return ti},Sky:function(){return Gn.q},SkyGeometry:function(){return x},SobelOperatorShader:function(){return rs},SpecularMIPLevelNode:function(){return Rt},SpriteNode:function(){return $t},SpriteNodeMaterial:function(){return nr},StandardNode:function(){return Lt},StandardNodeMaterial:function(){return Zt},StereoEffect:function(){return bs},StructNode:function(){return ht},SubSlotNode:function(){return gr},SubsurfaceScatteringShader:function(){return Ha},SwitchNode:function(){return Jt},TAARenderPass:function(){return Vo},TDSLoader:function(){return ul},TGALoader:function(){return Ss},TTFLoader:function(){return Js},TeapotGeometry:function(){return sa},TechnicolorShader:function(){return us},TempNode:function(){return it},TessellateModifier:function(){return rt},TextBufferGeometry:function(){return la},TextGeometry:function(){return la},TextureCubeNode:function(){return St},TextureCubeUVNode:function(){return bt},TextureNode:function(){return Ot},TexturePass:function(){return yo},ThreeMFLoader:function(){return tl},TiltLoader:function(){return Hc},TimerNode:function(){return br},ToneMapShader:function(){return bo},ToonShader1:function(){return Wa},ToonShader2:function(){return Za},ToonShaderDotted:function(){return Ya},ToonShaderHatching:function(){return Xa},TorusKnot:function(){return Xu},TrackballControls:function(){return Hi.$},TrackballControlsExp:function(){return Ui},TransformControls:function(){return Vi.Ys},TransformControlsGizmo:function(){return Vi.JW},TransformControlsPlane:function(){return Vi.EC},TreesGeometry:function(){return b},TrefoilKnot:function(){return Zu},TrefoilPolynomialKnot:function(){return Ju},TriangleBlurShader:function(){return ka},TubePainter:function(){return F},USDZExporter:function(){return pn},UVNode:function(){return It},UVTransformNode:function(){return vr},UVsDebug:function(){return Hn},UnpackDepthRGBAShader:function(){return ni},UnrealBloomPass:function(){return Eo},VOXDataTexture3D:function(){return cu},VOXLoader:function(){return su},VOXMesh:function(){return lu},VRButton:function(){return Ko},VRMLLoader:function(){return Gs},VRMLoader:function(){return ks},VTKLoader:function(){return nl},VarNode:function(){return ir},Vector2Node:function(){return Mt},Vector2NodeUniform:function(){return ge},Vector2Uniform:function(){return ce},Vector3Node:function(){return Nt},Vector3NodeUniform:function(){return Ae},Vector3Uniform:function(){return ue},Vector4Node:function(){return kt},Vector4NodeUniform:function(){return ve},Vector4Uniform:function(){return he},VelocityNode:function(){return mr},VertexNormalsHelper:function(){return Lu},VertexTangentsHelper:function(){return Bu},VerticalBlurShader:function(){return Fa.Z},VerticalTiltShiftShader:function(){return es},VignetteShader:function(){return is},VivianiCurve:function(){return ju},Volume:function(){return P},VolumeRenderShader1:function(){return Ka},VolumeSlice:function(){return _},Water:function(){return Rn},Water2:function(){return zn},WaterRefractionShader:function(){return Da},WebGPUSampled3DTexture:function(){return Se},WebGPUSampledArrayTexture:function(){return Ee},WebGPUSampledCubeTexture:function(){return Te},WebGPUSampledTexture:function(){return Ce},Wireframe:function(){return wu},WireframeGeometry2:function(){return Cu},XLoader:function(){return Ps},XREstimatedLight:function(){return qo},XRHandModelFactory:function(){return Yo},XRHandOculusMeshModel:function(){return Zo},XRHandPrimitiveModel:function(){return Ho},XYZLoader:function(){return rl},calcBSplineDerivatives:function(){return Uu.eR},calcBSplinePoint:function(){return Uu.bF},calcBasisFunctionDerivatives:function(){return Uu.HB},calcBasisFunctions:function(){return Uu.EP},calcKoverI:function(){return Uu.wD},calcNURBSDerivatives:function(){return Uu.MI},calcRationalCurveDerivatives:function(){return Uu.Yb},calcSurfacePoint:function(){return Uu.nl},computeMorphedAttributes:function(){return Xe},edgeTable:function(){return Dn},estimateBytesUsed:function(){return He},findSpan:function(){return Uu.sj},getErrorMessage:function(){return I},getUniforms:function(){return Ue.az},getWebGL2ErrorMessage:function(){return M},getWebGLErrorMessage:function(){return T},gosper:function(){return Xn},hilbert2D:function(){return Wn},hilbert3D:function(){return Zn},initSplineTexture:function(){return Ue.z_},interleaveAttributes:function(){return je},isWebGL2Available:function(){return S},isWebGLAvailable:function(){return E},mergeBufferAttributes:function(){return ze},mergeBufferGeometries:function(){return Ge},mergeVertices:function(){return We},modifyShader:function(){return Ue.i_},scaleTo:function(){return qu},toTrianglesDrawMode:function(){return Ze},triTable:function(){return Nn},updateSplineTexture:function(){return Ue.TU}});var n={};r.r(n),r.d(n,{computeMorphedAttributes:function(){return Xe},estimateBytesUsed:function(){return He},interleaveAttributes:function(){return je},mergeBufferAttributes:function(){return ze},mergeBufferGeometries:function(){return Ge},mergeVertices:function(){return We},toTrianglesDrawMode:function(){return Ze}});var o={};r.r(o),r.d(o,{AttributeNode:function(){return ar},BasicNode:function(){return Xt},BasicNodeMaterial:function(){return rr},BlurNode:function(){return Br},BoolNode:function(){return Dr},BumpMapNode:function(){return _t},BypassNode:function(){return pr},CameraNode:function(){return sr},CheckerNode:function(){return Fr},ColorAdjustmentNode:function(){return Ir},ColorNode:function(){return Ft},ColorSpaceNode:function(){return xt},ColorsNode:function(){return fr},CondNode:function(){return wr},ConstNode:function(){return lt},CubeTextureNode:function(){return Ut},ExpressionNode:function(){return At},FloatNode:function(){return at},FunctionCallNode:function(){return gt},FunctionNode:function(){return mt},InputNode:function(){return ot},IntNode:function(){return Lr},JoinNode:function(){return xr},LightNode:function(){return lr},LuminanceNode:function(){return Mr},MathNode:function(){return yt},Matrix3Node:function(){return Ar},Matrix4Node:function(){return Pr},MaxMIPLevelNode:function(){return Pt},MeshStandardNode:function(){return qt},MeshStandardNodeMaterial:function(){return tr},Node:function(){return nt},NodeBuilder:function(){return jt},NodeFrame:function(){return or},NodeLib:function(){return dt},NodeMaterial:function(){return Wt},NodePostProcessing:function(){return Er},NodeUniform:function(){return Dt},NodeUtils:function(){return Tt},NoiseNode:function(){return _r},NormalMapNode:function(){return Bt},NormalNode:function(){return Ct},OperatorNode:function(){return vt},PhongNode:function(){return Kt},PhongNodeMaterial:function(){return er},PositionNode:function(){return wt},PropertyNode:function(){return Yt},RTTNode:function(){return Nr},RawNode:function(){return Ht},ReflectNode:function(){return Et},ReflectorNode:function(){return Rr},ResolutionNode:function(){return cr},ScreenNode:function(){return Cr},ScreenUVNode:function(){return ur},SpecularMIPLevelNode:function(){return Rt},SpriteNode:function(){return $t},SpriteNodeMaterial:function(){return nr},StandardNode:function(){return Lt},StandardNodeMaterial:function(){return Zt},StructNode:function(){return ht},SubSlotNode:function(){return gr},SwitchNode:function(){return Jt},TempNode:function(){return it},TextureCubeNode:function(){return St},TextureCubeUVNode:function(){return bt},TextureNode:function(){return Ot},TimerNode:function(){return br},UVNode:function(){return It},UVTransformNode:function(){return vr},VarNode:function(){return ir},Vector2Node:function(){return Mt},Vector3Node:function(){return Nt},Vector4Node:function(){return kt},VelocityNode:function(){return mr}});var a=r(6173);const s=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];class l extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){const t=new DataView(e),r={},n=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"];for(let a=0;a<n.length;a++)r[n[a]]=t.getInt32(4*a,!0);if(844121161!==r.ident||8!==r.version)return void console.error("Not a valid MD2 file");if(r.offset_end!==t.byteLength)return void console.error("Corrupted MD2 file");const i=new a.BufferGeometry,o=[];let l=r.offset_st;for(let a=0,s=r.num_st;a<s;a++){const e=t.getInt16(l+0,!0),n=t.getInt16(l+2,!0);o.push(e/r.skinwidth,1-n/r.skinheight),l+=4}l=r.offset_tris;const c=[],u=[];for(let a=0,s=r.num_tris;a<s;a++)c.push(t.getUint16(l+0,!0),t.getUint16(l+2,!0),t.getUint16(l+4,!0)),u.push(t.getUint16(l+6,!0),t.getUint16(l+8,!0),t.getUint16(l+10,!0)),l+=12;const h=new a.Vector3,d=new a.Vector3,f=[],p=[];l=r.offset_frames;for(let a=0,w=r.num_frames;a<w;a++){d.set(t.getFloat32(l+0,!0),t.getFloat32(l+4,!0),t.getFloat32(l+8,!0)),h.set(t.getFloat32(l+12,!0),t.getFloat32(l+16,!0),t.getFloat32(l+20,!0)),l+=24;for(let r=0;r<16;r++){const e=t.getUint8(l+r,!0);if(0===e)break;f[r]=e}const e={name:String.fromCharCode.apply(null,f),vertices:[],normals:[]};l+=16;for(let n=0;n<r.num_vertices;n++){let r=t.getUint8(l++,!0),n=t.getUint8(l++,!0),i=t.getUint8(l++,!0);const o=s[t.getUint8(l++,!0)];r=r*d.x+h.x,n=n*d.y+h.y,i=i*d.z+h.z,e.vertices.push(r,i,n),e.normals.push(o[0],o[2],o[1])}p.push(e)}const m=[],g=[],A=[],v=p[0].vertices,y=p[0].normals;for(let a=0,s=c.length;a<s;a++){let e=3*c[a];const t=v[e],r=v[e+1],n=v[e+2];m.push(t,r,n);const i=y[e],s=y[e+1],l=y[e+2];g.push(i,s,l);e=2*u[a];const h=o[e],d=o[e+1];A.push(h,d)}i.setAttribute("position",new a.Float32BufferAttribute(m,3)),i.setAttribute("normal",new a.Float32BufferAttribute(g,3)),i.setAttribute("uv",new a.Float32BufferAttribute(A,2));const x=[],b=[];for(let s=0,w=p.length;s<w;s++){const e=p[s],t=e.name;if(e.vertices.length>0){const r=[];for(let t=0,i=c.length;t<i;t++){const n=3*c[t],i=e.vertices[n],o=e.vertices[n+1],a=e.vertices[n+2];r.push(i,o,a)}const n=new a.Float32BufferAttribute(r,3);n.name=t,x.push(n)}if(e.normals.length>0){const r=[];for(let t=0,i=c.length;t<i;t++){const n=3*c[t],i=e.normals[n],o=e.normals[n+1],a=e.normals[n+2];r.push(i,o,a)}const n=new a.Float32BufferAttribute(r,3);n.name=t,b.push(n)}}return i.morphAttributes.position=x,i.morphAttributes.normal=b,i.morphTargetsRelative=!1,i.animations=a.AnimationClip.CreateClipsFromMorphTargetSequences(p,10),i}}var c=function(e,t){a.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=Object.keys(this.morphTargetDictionary).length,n="__default",i=r-1,o=r/1;this.createAnimation(n,0,i,o),this.setAnimationWeight(n,1)};c.prototype=Object.assign(Object.create(a.Mesh.prototype),{constructor:c,createAnimation:function(e,t,r,n){var i={start:t,end:r,length:r-t+1,fps:n,duration:(r-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=i,this.animationsList.push(i)},autoCreateAnimations:function(e){var t,r=/([a-z]+)_?(\d+)/i,n={},i=0;for(let l in this.morphTargetDictionary){var o=l.match(r);if(o&&o.length>1){var a=o[1];n[a]||(n[a]={start:1/0,end:-1/0}),i<(s=n[a]).start&&(s.start=i),i>s.end&&(s.end=i),t||(t=a)}i++}for(let l in n){var s=n[l];this.createAnimation(l,s.start,s.end,e)}this.firstAnimation=t},setAnimationDirectionForward:function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},setAnimationDirectionBackward:function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},setAnimationFPS:function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},setAnimationDuration:function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},setAnimationWeight:function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},setAnimationTime:function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},getAnimationTime:function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},getAnimationDuration:function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},playAnimation:function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},stopAnimation:function(e){var t=this.animationsMap[e];t&&(t.active=!1)},update:function(e){for(let s=0,l=this.animationsList.length;s<l;s++){var t=this.animationsList[s];if(t.active){var r=t.duration/t.length;t.time+=t.direction*e,t.mirroredLoop?(t.time>t.duration||t.time<0)&&(t.direction*=-1,t.time>t.duration&&(t.time=t.duration,t.directionBackwards=!0),t.time<0&&(t.time=0,t.directionBackwards=!1)):(t.time=t.time%t.duration,t.time<0&&(t.time+=t.duration));var n=t.start+a.MathUtils.clamp(Math.floor(t.time/r),0,t.length-1),i=t.weight;n!==t.currentFrame&&(this.morphTargetInfluences[t.lastFrame]=0,this.morphTargetInfluences[t.currentFrame]=1*i,this.morphTargetInfluences[n]=0,t.lastFrame=t.currentFrame,t.currentFrame=n);var o=t.time%r/r;t.directionBackwards&&(o=1-o),t.currentFrame!==t.lastFrame?(this.morphTargetInfluences[t.currentFrame]=o*i,this.morphTargetInfluences[t.lastFrame]=(1-o)*i):this.morphTargetInfluences[t.currentFrame]=i}}}});var u=function(){var e=this;function t(e,t){var r=new a.TextureLoader,i=[];for(let o=0;o<t.length;o++)i[o]=r.load(e+t[o],n),i[o].mapping=a.UVMapping,i[o].name=t[o],i[o].encoding=a.sRGBEncoding;return i}function r(t,r){var n=new a.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),i=new a.MeshLambertMaterial({color:16777215,wireframe:!1,map:r,morphTargets:!0,morphNormals:!0}),o=new c(t,i);return o.rotation.y=-Math.PI/2,o.materialTexture=i,o.materialWireframe=n,o.autoCreateAnimations(e.animationFPS),o}function n(){e.loadCounter-=1,0===e.loadCounter&&e.onLoadComplete()}function i(e){return 1===e?1:1-Math.pow(2,-10*e)}this.scale=1,this.animationFPS=6,this.transitionFrames=15,this.maxSpeed=275,this.maxReverseSpeed=-275,this.frontAcceleration=600,this.backAcceleration=600,this.frontDecceleration=600,this.angularSpeed=2.5,this.root=new a.Object3D,this.meshBody=null,this.meshWeapon=null,this.controls=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.currentSkin=void 0,this.onLoadComplete=function(){},this.meshes=[],this.animations={},this.loadCounter=0,this.speed=0,this.bodyOrientation=0,this.walkSpeed=this.maxSpeed,this.crouchSpeed=.5*this.maxSpeed,this.activeAnimation=null,this.oldAnimation=null,this.enableShadows=function(e){for(let t=0;t<this.meshes.length;t++)this.meshes[t].castShadow=e,this.meshes[t].receiveShadow=e},this.setVisible=function(e){for(let t=0;t<this.meshes.length;t++)this.meshes[t].visible=e,this.meshes[t].visible=e},this.shareParts=function(e){this.animations=e.animations,this.walkSpeed=e.walkSpeed,this.crouchSpeed=e.crouchSpeed,this.skinsBody=e.skinsBody,this.skinsWeapon=e.skinsWeapon;var t=r(e.meshBody.geometry,this.skinsBody[0]);t.scale.set(this.scale,this.scale,this.scale),this.root.position.y=e.root.position.y,this.root.add(t),this.meshBody=t,this.meshes.push(t);for(let i=0;i<e.weapons.length;i++){var n=r(e.weapons[i].geometry,this.skinsWeapon[i]);n.scale.set(this.scale,this.scale,this.scale),n.visible=!1,n.name=e.weapons[i].name,this.root.add(n),this.weapons[i]=n,this.meshWeapon=n,this.meshes.push(n)}},this.loadParts=function(i){this.animations=i.animations,this.walkSpeed=i.walkSpeed,this.crouchSpeed=i.crouchSpeed,this.loadCounter=2*i.weapons.length+i.skins.length+1;var o=[];for(let e=0;e<i.weapons.length;e++)o[e]=i.weapons[e][1];this.skinsBody=t(i.baseUrl+"skins/",i.skins),this.skinsWeapon=t(i.baseUrl+"skins/",o);var s=new l;s.load(i.baseUrl+i.body,(function(t){var i=new a.Box3;i.setFromBufferAttribute(t.attributes.position),e.root.position.y=-e.scale*i.min.y;var o=r(t,e.skinsBody[0]);o.scale.set(e.scale,e.scale,e.scale),e.root.add(o),e.meshBody=o,e.meshes.push(o),n()}));var c=function(t,i){return function(o){var a=r(o,e.skinsWeapon[t]);a.scale.set(e.scale,e.scale,e.scale),a.visible=!1,a.name=i,e.root.add(a),e.weapons[t]=a,e.meshWeapon=a,e.meshes.push(a),n()}};for(let e=0;e<i.weapons.length;e++)s.load(i.baseUrl+i.weapons[e][0],c(e,i.weapons[e][0]))},this.setPlaybackRate=function(e){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/e),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/e)},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e],this.currentSkin=e)},this.setWeapon=function(e){for(let r=0;r<this.weapons.length;r++)this.weapons[r].visible=!1;var t=this.weapons[e];t&&(t.visible=!0,this.meshWeapon=t,this.activeAnimation&&(t.playAnimation(this.activeAnimation),this.meshWeapon.setAnimationTime(this.activeAnimation,this.meshBody.getAnimationTime(this.activeAnimation))))},this.setAnimation=function(e){e!==this.activeAnimation&&e&&(this.meshBody&&(this.meshBody.setAnimationWeight(e,0),this.meshBody.playAnimation(e),this.oldAnimation=this.activeAnimation,this.activeAnimation=e,this.blendCounter=this.transitionFrames),this.meshWeapon&&(this.meshWeapon.setAnimationWeight(e,0),this.meshWeapon.playAnimation(e)))},this.update=function(e){this.controls&&this.updateMovementModel(e),this.animations&&(this.updateBehaviors(),this.updateAnimations(e))},this.updateAnimations=function(e){var t=1;this.blendCounter>0&&(t=(this.transitionFrames-this.blendCounter)/this.transitionFrames,this.blendCounter-=1),this.meshBody&&(this.meshBody.update(e),this.meshBody.setAnimationWeight(this.activeAnimation,t),this.meshBody.setAnimationWeight(this.oldAnimation,1-t)),this.meshWeapon&&(this.meshWeapon.update(e),this.meshWeapon.setAnimationWeight(this.activeAnimation,t),this.meshWeapon.setAnimationWeight(this.oldAnimation,1-t))},this.updateBehaviors=function(){var e,t,r=this.controls,n=this.animations;r.crouch?(e=n.crouchMove,t=n.crouchIdle):(e=n.move,t=n.idle),r.jump&&(e=n.jump,t=n.jump),r.attack&&(r.crouch?(e=n.crouchAttack,t=n.crouchAttack):(e=n.attack,t=n.attack)),(r.moveForward||r.moveBackward||r.moveLeft||r.moveRight)&&this.activeAnimation!==e&&this.setAnimation(e),Math.abs(this.speed)<.2*this.maxSpeed&&!(r.moveLeft||r.moveRight||r.moveForward||r.moveBackward)&&this.activeAnimation!==t&&this.setAnimation(t),r.moveForward&&(this.meshBody&&(this.meshBody.setAnimationDirectionForward(this.activeAnimation),this.meshBody.setAnimationDirectionForward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionForward(this.activeAnimation),this.meshWeapon.setAnimationDirectionForward(this.oldAnimation))),r.moveBackward&&(this.meshBody&&(this.meshBody.setAnimationDirectionBackward(this.activeAnimation),this.meshBody.setAnimationDirectionBackward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionBackward(this.activeAnimation),this.meshWeapon.setAnimationDirectionBackward(this.oldAnimation)))},this.updateMovementModel=function(e){var t=this.controls;t.crouch?this.maxSpeed=this.crouchSpeed:this.maxSpeed=this.walkSpeed,this.maxReverseSpeed=-this.maxSpeed,t.moveForward&&(this.speed=a.MathUtils.clamp(this.speed+e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),t.moveBackward&&(this.speed=a.MathUtils.clamp(this.speed-e*this.backAcceleration,this.maxReverseSpeed,this.maxSpeed));if(t.moveLeft&&(this.bodyOrientation+=e*this.angularSpeed,this.speed=a.MathUtils.clamp(this.speed+1*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),t.moveRight&&(this.bodyOrientation-=e*this.angularSpeed,this.speed=a.MathUtils.clamp(this.speed+1*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),!t.moveForward&&!t.moveBackward)if(this.speed>0){var r=i(this.speed/this.maxSpeed);this.speed=a.MathUtils.clamp(this.speed-r*e*this.frontDecceleration,0,this.maxSpeed)}else{r=i(this.speed/this.maxReverseSpeed);this.speed=a.MathUtils.clamp(this.speed+r*e*this.backAcceleration,this.maxReverseSpeed,0)}var n=this.speed*e;this.root.position.x+=Math.sin(this.bodyOrientation)*n,this.root.position.z+=Math.cos(this.bodyOrientation)*n,this.root.rotation.y=this.bodyOrientation}},h=function(){var e=new a.Vector3;function t(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new o,this.unassigned=new o,this.vertices=[]}function r(){this.normal=new a.Vector3,this.midpoint=new a.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function n(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function i(e){this.point=e,this.prev=null,this.next=null,this.face=null}function o(){this.head=null,this.tail=null}return Object.assign(t.prototype,{setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.vertices.push(new i(e[t]));return this.compute(),this},setFromObject:function(e){var t=[];return e.updateMatrixWorld(!0),e.traverse((function(e){var r,n,i,o=e.geometry;if(void 0!==o){if(o.isGeometry)return void console.error("THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.");if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(r=0,n=s.count;r<n;r++)(i=new a.Vector3).fromBufferAttribute(s,r).applyMatrix4(e.matrixWorld),t.push(i)}}})),this.setFromPoints(t)},containsPoint:function(e){var t=this.faces;for(let r=0,n=t.length;r<n;r++){if(t[r].distanceToPoint(e)>this.tolerance)return!1}return!0},intersectRay:function(e,t){var r=this.faces,n=-1/0,i=1/0;for(let c=0,u=r.length;c<u;c++){var o=r[c],a=o.distanceToPoint(e.origin),s=o.normal.dot(e.direction);if(a>0&&s>=0)return null;var l=0!==s?-a/s:0;if(!(l<=0)&&(s>0?i=Math.min(l,i):n=Math.max(l,n),n>i))return null}return n!==-1/0?e.at(n,t):e.at(i,t),t},intersectsRay:function(t){return null!==this.intersectRay(t,e)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,r=e.outside;null!==r.next&&r.next.face===e;)r=r.next;return this.assigned.removeSubList(t,r),t.prev=r.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){var r=this.removeAllVerticesFromFace(e);if(void 0!==r)if(void 0===t)this.unassigned.appendChain(r);else{var n=r;do{var i=n.next;t.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,t):this.unassigned.append(n),n=i}while(null!==n)}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{var r=t.next,n=this.tolerance,i=null;for(let r=0;r<e.length;r++){var o=e[r];if(0===o.mark){var a=o.distanceToPoint(t.point);if(a>n&&(n=a,i=o),n>1e3*this.tolerance)break}}null!==i&&this.addVertexToFace(t,i),t=r}while(null!==t)}return this},computeExtremes:function(){var e,t,r,n=new a.Vector3,i=new a.Vector3,o=[],s=[];for(e=0;e<3;e++)o[e]=s[e]=this.vertices[0];for(n.copy(this.vertices[0].point),i.copy(this.vertices[0].point),e=0,t=this.vertices.length;e<t;e++){var l=this.vertices[e],c=l.point;for(r=0;r<3;r++)c.getComponent(r)<n.getComponent(r)&&(n.setComponent(r,c.getComponent(r)),o[r]=l);for(r=0;r<3;r++)c.getComponent(r)>i.getComponent(r)&&(i.setComponent(r,c.getComponent(r)),s[r]=l)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(n.x),Math.abs(i.x))+Math.max(Math.abs(n.y),Math.abs(i.y))+Math.max(Math.abs(n.z),Math.abs(i.z))),{min:o,max:s}},computeInitialHull:function(){var e,t,n;return function(){void 0===e&&(e=new a.Line3,t=new a.Plane,n=new a.Vector3);var i,o,s,l,c,u,h,d,f,p=this.vertices,m=this.computeExtremes(),g=m.min,A=m.max,v=0,y=0;for(u=0;u<3;u++)(f=A[u].point.getComponent(u)-g[u].point.getComponent(u))>v&&(v=f,y=u);for(o=g[y],s=A[y],v=0,e.set(o.point,s.point),u=0,h=this.vertices.length;u<h;u++)(i=p[u])!==o&&i!==s&&(e.closestPointToPoint(i.point,!0,n),(f=n.distanceToSquared(i.point))>v&&(v=f,l=i));for(v=-1,t.setFromCoplanarPoints(o.point,s.point,l.point),u=0,h=this.vertices.length;u<h;u++)(i=p[u])!==o&&i!==s&&i!==l&&(f=Math.abs(t.distanceToPoint(i.point)))>v&&(v=f,c=i);var x=[];if(t.distanceToPoint(c.point)<0)for(x.push(r.create(o,s,l),r.create(c,s,o),r.create(c,l,s),r.create(c,o,l)),u=0;u<3;u++)d=(u+1)%3,x[u+1].getEdge(2).setTwin(x[0].getEdge(d)),x[u+1].getEdge(1).setTwin(x[d+1].getEdge(0));else for(x.push(r.create(o,l,s),r.create(c,o,s),r.create(c,s,l),r.create(c,l,o)),u=0;u<3;u++)d=(u+1)%3,x[u+1].getEdge(2).setTwin(x[0].getEdge((3-u)%3)),x[u+1].getEdge(0).setTwin(x[d+1].getEdge(1));for(u=0;u<4;u++)this.faces.push(x[u]);for(u=0,h=p.length;u<h;u++)if((i=p[u])!==o&&i!==s&&i!==l&&i!==c){v=this.tolerance;var b=null;for(d=0;d<4;d++)(f=this.faces[d].distanceToPoint(i.point))>v&&(v=f,b=this.faces[d]);null!==b&&this.addVertexToFace(i,b)}return this}}(),reindexFaces:function(){var e=[];for(let r=0;r<this.faces.length;r++){var t=this.faces[r];0===t.mark&&e.push(t)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,r=this.assigned.first().face,n=r.outside;do{var i=r.distanceToPoint(n.point);i>t&&(t=i,e=n),n=n.next}while(null!==n&&n.face===r);return e}},computeHorizon:function(e,t,r,n){var i;this.deleteFaceVertices(r),r.mark=1,i=null===t?t=r.getEdge(0):t.next;do{var o=i.twin,a=o.face;0===a.mark&&(a.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,o,a,n):n.push(i)),i=i.next}while(i!==t);return this},addAdjoiningFace:function(e,t){var n=r.create(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setTwin(t.twin),n.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];var r=null,n=null;for(let a=0;a<t.length;a++){var i=t[a],o=this.addAdjoiningFace(e,i);null===r?r=o:o.next.setTwin(n),this.newFaces.push(o.face),n=o}return r.next.setTwin(n),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(r,{create:function(e,t,i){var o=new r,a=new n(e,o),s=new n(t,o),l=new n(i,o);return a.next=l.prev=s,s.next=a.prev=l,l.next=s.prev=a,o.edge=a,o.compute()}}),Object.assign(r.prototype,{getEdge:function(e){for(var t=this.edge;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t},compute:function(){var e;return function(){void 0===e&&(e=new a.Triangle);var t=this.edge.tail(),r=this.edge.head(),n=this.edge.next.head();return e.set(t.point,r.point,n.point),e.getNormal(this.normal),e.getMidpoint(this.midpoint),this.area=e.getArea(),this.constant=this.normal.dot(this.midpoint),this}}(),distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(n.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1},lengthSquared:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1},setTwin:function(e){return this.twin=e,e.twin=this,this}}),Object.assign(o.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this},isEmpty:function(){return null===this.head}}),t}();class d extends a.BufferGeometry{constructor(e){super();const t=[],r=[];void 0===h&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");const n=(new h).setFromPoints(e).faces;for(let i=0;i<n.length;i++){const e=n[i];let o=e.edge;do{const n=o.head().point;t.push(n.x,n.y,n.z),r.push(e.normal.x,e.normal.y,e.normal.z),o=o.next}while(o!==e.edge)}this.setAttribute("position",new a.Float32BufferAttribute(t,3)),this.setAttribute("normal",new a.Float32BufferAttribute(r,3))}}var f=function(e,t){this.minSizeForBreak=e||1.4,this.smallDelta=t||1e-4,this.tempLine1=new a.Line3,this.tempPlane1=new a.Plane,this.tempPlane2=new a.Plane,this.tempPlane_Cut=new a.Plane,this.tempCM1=new a.Vector3,this.tempCM2=new a.Vector3,this.tempVector3=new a.Vector3,this.tempVector3_2=new a.Vector3,this.tempVector3_3=new a.Vector3,this.tempVector3_P0=new a.Vector3,this.tempVector3_P1=new a.Vector3,this.tempVector3_P2=new a.Vector3,this.tempVector3_N0=new a.Vector3,this.tempVector3_N1=new a.Vector3,this.tempVector3_AB=new a.Vector3,this.tempVector3_CB=new a.Vector3,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(let r=0;r<900;r++)this.segments[r]=!1};f.prototype={constructor:f,prepareBreakableObject:function(e,t,r,n,i){e.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.");var o=e.userData;o.mass=t,o.velocity=r.clone(),o.angularVelocity=n.clone(),o.breakable=i},subdivideByImpact:function(e,t,r,n,i){var o=[],a=this.tempPlane1,s=this.tempPlane2;this.tempVector3.addVectors(t,r),a.setFromCoplanarPoints(t,e.position,this.tempVector3);var l=i+n,c=this;return function i(u,h,d,f){if(Math.random()<.05*f||f>l)o.push(u);else{var p=Math.PI;0===f?(s.normal.copy(a.normal),s.constant=a.constant):f<=n?(p=(d-h)*(.2+.6*Math.random())+h,c.tempVector3_2.copy(e.position).sub(t).applyAxisAngle(r,p).add(t),s.setFromCoplanarPoints(t,c.tempVector3,c.tempVector3_2)):(p=(.5*(1&f)+.2*(2-Math.random()))*Math.PI,c.tempVector3_2.copy(t).sub(u.position).applyAxisAngle(r,p).add(u.position),c.tempVector3_3.copy(r).add(u.position),s.setFromCoplanarPoints(u.position,c.tempVector3_3,c.tempVector3_2)),c.cutByPlane(u,s,c.tempResultObjects);var m=c.tempResultObjects.object1,g=c.tempResultObjects.object2;m&&i(m,h,p,f+1),g&&i(g,p,d,f+1)}}(e,0,2*Math.PI,0),o},cutByPlane:function(e,t,r){var n=e.geometry,i=n.attributes.position.array,o=n.attributes.normal.array,s=i.length/3,l=s/3,c=n.getIndex();function u(e,t){var r=3*e+t;return c?c[r]:r}c&&(l=(c=c.array).length/3);var h=[],p=[],m=this.smallDelta,g=s*s;for(let a=0;a<g;a++)this.segments[a]=!1;var A=this.tempVector3_P0,v=this.tempVector3_P1,y=this.tempVector3_N0,x=this.tempVector3_N1;for(let a=0;a<l-1;a++){var b=u(a,0),w=u(a,1),C=u(a,2);y.set(o[b],o[b]+1,o[b]+2);for(let e=a+1;e<l;e++){var E=u(e,0),S=u(e,1),T=u(e,2);x.set(o[E],o[E]+1,o[E]+2),1-y.dot(x)<m&&(b===E||b===S||b===T?w===E||w===S||w===T?(this.segments[b*s+w]=!0,this.segments[w*s+b]=!0):(this.segments[C*s+b]=!0,this.segments[b*s+C]=!0):w!==E&&w!==S&&w!==T||(this.segments[C*s+w]=!0,this.segments[w*s+C]=!0))}}var M=this.tempPlane_Cut;e.updateMatrix(),f.transformPlaneToLocalSpace(t,e.matrix,M);for(let d=0;d<l;d++){var I=u(d,0),B=u(d,1),_=u(d,2);for(let e=0;e<3;e++){var F=0===e?I:1===e?B:_,P=0===e?B:1===e?_:I;if(!this.segments[F*s+P]){this.segments[F*s+P]=!0,this.segments[P*s+F]=!0,A.set(i[3*F],i[3*F+1],i[3*F+2]),v.set(i[3*P],i[3*P+1],i[3*P+2]);var R=0;(L=M.distanceToPoint(A))>m?(R=2,p.push(A.clone())):L<-m?(R=1,h.push(A.clone())):(R=3,h.push(A.clone()),p.push(A.clone()));var L,D=0;if((L=M.distanceToPoint(v))>m?(D=2,p.push(v.clone())):L<-m?(D=1,h.push(v.clone())):(D=3,h.push(v.clone()),p.push(v.clone())),1===R&&2===D||2===R&&1===D){this.tempLine1.start.copy(A),this.tempLine1.end.copy(v);var N=new a.Vector3;if(void 0===(N=M.intersectLine(this.tempLine1,N)))return console.error("Internal error: segment does not intersect plane."),r.segmentedObject1=null,r.segmentedObject2=null,0;h.push(N),p.push(N.clone())}}}}var k=.5*e.userData.mass;this.tempCM1.set(0,0,0);var O=0,U=h.length;if(U>0){for(let e=0;e<U;e++)this.tempCM1.add(h[e]);this.tempCM1.divideScalar(U);for(let e=0;e<U;e++){(G=h[e]).sub(this.tempCM1),O=Math.max(O,G.x,G.y,G.z)}this.tempCM1.add(e.position)}this.tempCM2.set(0,0,0);var Q=0,V=p.length;if(V>0){for(let e=0;e<V;e++)this.tempCM2.add(p[e]);this.tempCM2.divideScalar(V);for(let e=0;e<V;e++){var G;(G=p[e]).sub(this.tempCM2),Q=Math.max(Q,G.x,G.y,G.z)}this.tempCM2.add(e.position)}var z=null,j=null,H=0;return U>4&&((z=new a.Mesh(new d(h),e.material)).position.copy(this.tempCM1),z.quaternion.copy(e.quaternion),this.prepareBreakableObject(z,k,e.userData.velocity,e.userData.angularVelocity,2*O>this.minSizeForBreak),H++),V>4&&((j=new a.Mesh(new d(p),e.material)).position.copy(this.tempCM2),j.quaternion.copy(e.quaternion),this.prepareBreakableObject(j,k,e.userData.velocity,e.userData.angularVelocity,2*Q>this.minSizeForBreak),H++),r.object1=z,r.object2=j,H}},f.transformFreeVector=function(e,t){var r=e.x,n=e.y,i=e.z,o=t.elements;return e.x=o[0]*r+o[4]*n+o[8]*i,e.y=o[1]*r+o[5]*n+o[9]*i,e.z=o[2]*r+o[6]*n+o[10]*i,e},f.transformFreeVectorInverse=function(e,t){var r=e.x,n=e.y,i=e.z,o=t.elements;return e.x=o[0]*r+o[1]*n+o[2]*i,e.y=o[4]*r+o[5]*n+o[6]*i,e.z=o[8]*r+o[9]*n+o[10]*i,e},f.transformTiedVectorInverse=function(e,t){var r=e.x,n=e.y,i=e.z,o=t.elements;return e.x=o[0]*r+o[1]*n+o[2]*i-o[12],e.y=o[4]*r+o[5]*n+o[6]*i-o[13],e.z=o[8]*r+o[9]*n+o[10]*i-o[14],e},f.transformPlaneToLocalSpace=function(){var e=new a.Vector3;return function(t,r,n){n.normal.copy(t.normal),n.constant=t.constant;var i=f.transformTiedVectorInverse(t.coplanarPoint(e),r);f.transformFreeVectorInverse(n.normal,r),n.constant=-i.dot(n.normal)}}();var p=function(e,t,r){this.variables=[],this.currentTextureIndex=0;var n=a.FloatType,i=new a.Scene,o=new a.Camera;o.position.z=1;var s={passThruTexture:{value:null}},l=h("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",s),c=new a.Mesh(new a.PlaneGeometry(2,2),l);function u(r){r.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function h(e,t){t=t||{};var r=new a.ShaderMaterial({uniforms:t,vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return u(r),r}i.add(c),this.setDataType=function(e){return n=e,this},this.addVariable=function(e,t,r){var n={name:e,initialValueTexture:r,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:a.NearestFilter,magFilter:a.NearestFilter};return this.variables.push(n),n},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!1===r.capabilities.isWebGL2&&!1===r.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===r.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let r=0;r<this.variables.length;r++){var n=this.variables[r];n.renderTargets[0]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),n.renderTargets[1]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),this.renderTexture(n.initialValueTexture,n.renderTargets[0]),this.renderTexture(n.initialValueTexture,n.renderTargets[1]);var i=n.material,o=i.uniforms;if(null!==n.dependencies)for(let e=0;e<n.dependencies.length;e++){var a=n.dependencies[e];if(a.name!==n.name){var s=!1;for(let e=0;e<this.variables.length;e++)if(a.name===this.variables[e].name){s=!0;break}if(!s)return"Variable dependency not found. Variable="+n.name+", dependency="+a.name}o[a.name]={value:null},i.fragmentShader="\nuniform sampler2D "+a.name+";\n"+i.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){var e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0;for(let o=0,a=this.variables.length;o<a;o++){var r=this.variables[o];if(null!==r.dependencies){var n=r.material.uniforms;for(let t=0,o=r.dependencies.length;t<o;t++){var i=r.dependencies[t];n[i.name].value=i.renderTargets[e].texture}}this.doRenderTarget(r.material,r.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=u,this.createShaderMaterial=h,this.createRenderTarget=function(r,i,o,s,l,c){return r=r||e,i=i||t,o=o||a.ClampToEdgeWrapping,s=s||a.ClampToEdgeWrapping,l=l||a.NearestFilter,c=c||a.NearestFilter,new a.WebGLRenderTarget(r,i,{wrapS:o,wrapT:s,minFilter:l,magFilter:c,format:a.RGBAFormat,type:n,depthBuffer:!1})},this.createTexture=function(){var r=new Float32Array(e*t*4);return new a.DataTexture(r,e,t,a.RGBAFormat,a.FloatType)},this.renderTexture=function(e,t){s.passThruTexture.value=e,this.doRenderTarget(l,t),s.passThruTexture.value=null},this.doRenderTarget=function(e,t){var n=r.getRenderTarget();c.material=e,r.setRenderTarget(t),r.render(i,o),c.material=l,r.setRenderTarget(n)}},m=function(){a.Object3D.call(this)};m.prototype=Object.create(a.Object3D.prototype),m.prototype.constructor=m,m.prototype.updateMatrixWorld=function(){var e=new a.Vector3,t=new a.Quaternion,r=new a.Vector3,n=new a.Vector3,i=new a.Quaternion,o=new a.Vector3;return function(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(null!==this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(n,i,o),this.matrix.decompose(e,t,r),this.matrixWorld.compose(n,t,o)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(let e=0,t=this.children.length;e<t;e++)this.children[e].updateMatrixWorld(a)}}();var g=function(e,t){a.Mesh.call(this,e,t),this.type="MorphAnimMesh",this.mixer=new a.AnimationMixer(this),this.activeAction=null};g.prototype=Object.create(a.Mesh.prototype),g.prototype.constructor=g,g.prototype.setDirectionForward=function(){this.mixer.timeScale=1},g.prototype.setDirectionBackward=function(){this.mixer.timeScale=-1},g.prototype.playAnimation=function(e,t){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);var r=a.AnimationClip.findByName(this,e);if(!r)throw new Error("THREE.MorphAnimMesh: animations["+e+"] undefined in .playAnimation()");var n=this.mixer.clipAction(r);n.timeScale=r.tracks.length*t/r.duration,this.activeAction=n.play()},g.prototype.updateAnimation=function(e){this.mixer.update(e)},g.prototype.copy=function(e){return a.Mesh.prototype.copy.call(this,e),this.mixer=new a.AnimationMixer(this),this};var A=function(e,t){a.BufferGeometry.call(this);var r=[],n=[],i=[],o=[1,1,1],s=[1,1,0],l=new a.Vector3(0,1,0),c=new a.Vector3,u=new a.Vector3,h=new a.Quaternion,d=new a.Quaternion;d.setFromAxisAngle(l,Math.PI/2);var f=new a.Vector3,p=new a.Vector3;p.copy(e.getPointAt(0));var m=[new a.Vector3(-.225,0,0),new a.Vector3(0,-.05,0),new a.Vector3(0,-.175,0),new a.Vector3(0,-.05,0),new a.Vector3(.225,0,0),new a.Vector3(0,-.175,0)],g=2*Math.PI,A=5,v=[];for(let L=0;L<A;L++){var y=L/A*g;v.push(new a.Vector3(.06*Math.sin(y),.06*Math.cos(y),0))}A=6;var x=[];for(let L=0;L<A;L++){y=L/A*g;x.push(new a.Vector3(.025*Math.sin(y),.025*Math.cos(y),0))}var b=new a.Vector3,w=new a.Vector3;function C(e,t){w.set(0,0,-1).applyQuaternion(h);for(let o=0;o<e.length;o++)b.copy(e[o]),b.applyQuaternion(h),b.add(f),r.push(b.x,b.y,b.z),n.push(w.x,w.y,w.z),i.push(t[0],t[1],t[2]);w.set(0,0,1).applyQuaternion(h);for(let o=e.length-1;o>=0;o--)b.copy(e[o]),b.applyQuaternion(h),b.add(f),r.push(b.x,b.y,b.z),n.push(w.x,w.y,w.z),i.push(t[0],t[1],t[2])}var E=new a.Vector3,S=new a.Vector3,T=new a.Vector3,M=new a.Vector3,I=new a.Vector3,B=new a.Vector3,_=new a.Vector3,F=new a.Vector3;function P(e,t,o){for(let l=0,c=e.length;l<c;l++){var a=e[l],s=e[(l+1)%c];E.copy(a).add(t),E.applyQuaternion(h),E.add(f),S.copy(s).add(t),S.applyQuaternion(h),S.add(f),T.copy(s).add(t),T.applyQuaternion(d),T.add(p),M.copy(a).add(t),M.applyQuaternion(d),M.add(p),r.push(E.x,E.y,E.z),r.push(S.x,S.y,S.z),r.push(M.x,M.y,M.z),r.push(S.x,S.y,S.z),r.push(T.x,T.y,T.z),r.push(M.x,M.y,M.z),I.copy(a),I.applyQuaternion(h),I.normalize(),B.copy(s),B.applyQuaternion(h),B.normalize(),_.copy(s),_.applyQuaternion(d),_.normalize(),F.copy(a),F.applyQuaternion(d),F.normalize(),n.push(I.x,I.y,I.z),n.push(B.x,B.y,B.z),n.push(F.x,F.y,F.z),n.push(B.x,B.y,B.z),n.push(_.x,_.y,_.z),n.push(F.x,F.y,F.z),i.push(o[0],o[1],o[2]),i.push(o[0],o[1],o[2]),i.push(o[0],o[1],o[2]),i.push(o[0],o[1],o[2]),i.push(o[0],o[1],o[2]),i.push(o[0],o[1],o[2])}}var R=new a.Vector3;for(let a=1;a<=t;a++){f.copy(e.getPointAt(a/t)),l.set(0,1,0),c.subVectors(f,p).normalize(),u.crossVectors(l,c).normalize(),l.crossVectors(c,u);y=Math.atan2(c.x,c.z);h.setFromAxisAngle(l,y),a%2===0&&C(m,s),P(v,R.set(0,-.125,0),s),P(x,R.set(.2,0,0),o),P(x,R.set(-.2,0,0),o),p.copy(f),d.copy(h)}this.setAttribute("position",new a.BufferAttribute(new Float32Array(r),3)),this.setAttribute("normal",new a.BufferAttribute(new Float32Array(n),3)),this.setAttribute("color",new a.BufferAttribute(new Float32Array(i),3))};A.prototype=Object.create(a.BufferGeometry.prototype);var v=function(e,t){a.BufferGeometry.call(this);var r=[],n=[],i=new a.Quaternion,o=new a.Vector3(0,1,0),s=new a.Vector3,l=new a.Vector3,c=[new a.Vector3(0,.05,-.05),new a.Vector3(0,.05,.05),new a.Vector3(0,-.05,0)],u=[new a.Vector3(-.05,0,.05),new a.Vector3(-.05,0,-.05),new a.Vector3(.05,0,0)],h=[new a.Vector3(.05,0,-.05),new a.Vector3(.05,0,.05),new a.Vector3(-.05,0,0)],d=new a.Vector3,f=new a.Vector3,p=new a.Vector3,m=new a.Vector3,g=new a.Vector3,A=new a.Vector3,v=new a.Vector3,y=new a.Vector3;function x(e,t,o){for(let l=0,c=e.length;l<c;l++){var a=e[l],s=e[(l+1)%c];d.copy(a),d.applyQuaternion(i),d.add(t),f.copy(s),f.applyQuaternion(i),f.add(t),p.copy(s),p.applyQuaternion(i),p.add(o),m.copy(a),m.applyQuaternion(i),m.add(o),r.push(d.x,d.y,d.z),r.push(f.x,f.y,f.z),r.push(m.x,m.y,m.z),r.push(f.x,f.y,f.z),r.push(p.x,p.y,p.z),r.push(m.x,m.y,m.z),g.copy(a),g.applyQuaternion(i),g.normalize(),A.copy(s),A.applyQuaternion(i),A.normalize(),v.copy(s),v.applyQuaternion(i),v.normalize(),y.copy(a),y.applyQuaternion(i),y.normalize(),n.push(g.x,g.y,g.z),n.push(A.x,A.y,A.z),n.push(y.x,y.y,y.z),n.push(A.x,A.y,A.z),n.push(v.x,v.y,v.z),n.push(y.x,y.y,y.z)}}var b=new a.Vector3,w=new a.Vector3;for(let a=1;a<=t;a++){s.copy(e.getPointAt(a/t)),l.copy(e.getTangentAt(a/t));var C=Math.atan2(l.x,l.z);i.setFromAxisAngle(o,C),s.y>10?(b.set(-.75,-.35,0),b.applyQuaternion(i),b.add(s),w.set(.75,-.35,0),w.applyQuaternion(i),w.add(s),x(c,b,w),b.set(-.7,-.3,0),b.applyQuaternion(i),b.add(s),w.set(-.7,-s.y,0),w.applyQuaternion(i),w.add(s),x(u,b,w),b.set(.7,-.3,0),b.applyQuaternion(i),b.add(s),w.set(.7,-s.y,0),w.applyQuaternion(i),w.add(s),x(h,b,w)):(b.set(0,-.2,0),b.applyQuaternion(i),b.add(s),w.set(0,-s.y,0),w.applyQuaternion(i),w.add(s),x(h,b,w))}this.setAttribute("position",new a.BufferAttribute(new Float32Array(r),3)),this.setAttribute("normal",new a.BufferAttribute(new Float32Array(n),3))};v.prototype=Object.create(a.BufferGeometry.prototype);var y=function(e,t){a.BufferGeometry.call(this);var r=[],n=new a.Vector3(0,1,0),i=new a.Vector3,o=new a.Quaternion,s=new a.Quaternion;s.setFromAxisAngle(n,Math.PI/2);var l=new a.Vector3,c=new a.Vector3;c.copy(e.getPointAt(0)),c.y=0;var u=new a.Vector3,h=new a.Vector3,d=new a.Vector3,f=new a.Vector3;for(let a=1;a<=t;a++){l.copy(e.getPointAt(a/t)),l.y=0,i.subVectors(l,c);var p=Math.atan2(i.x,i.z);o.setFromAxisAngle(n,p),u.set(-.3,0,0),u.applyQuaternion(o),u.add(l),h.set(.3,0,0),h.applyQuaternion(o),h.add(l),d.set(.3,0,0),d.applyQuaternion(s),d.add(c),f.set(-.3,0,0),f.applyQuaternion(s),f.add(c),r.push(u.x,u.y,u.z),r.push(h.x,h.y,h.z),r.push(f.x,f.y,f.z),r.push(h.x,h.y,h.z),r.push(d.x,d.y,d.z),r.push(f.x,f.y,f.z),c.copy(l),s.copy(o)}this.setAttribute("position",new a.BufferAttribute(new Float32Array(r),3))};y.prototype=Object.create(a.BufferGeometry.prototype);var x=function(){a.BufferGeometry.call(this);var e=[];for(let o=0;o<100;o++){var t=800*Math.random()-400,r=50*Math.random()+50,n=800*Math.random()-400,i=40*Math.random()+20;e.push(t-i,r,n-i),e.push(t+i,r,n-i),e.push(t-i,r,n+i),e.push(t+i,r,n-i),e.push(t+i,r,n+i),e.push(t-i,r,n+i)}this.setAttribute("position",new a.BufferAttribute(new Float32Array(e),3))};x.prototype=Object.create(a.BufferGeometry.prototype);var b=function(e){a.BufferGeometry.call(this);var t=[],r=[],n=new a.Raycaster;n.ray.direction.set(0,-1,0);for(let a=0;a<2e3;a++){var i=500*Math.random()-250,o=500*Math.random()-250;n.ray.origin.set(i,50,o);var s=n.intersectObject(e);if(0!==s.length){var l=s[0].point.y,c=5*Math.random()+.5,u=Math.random()*Math.PI*2;t.push(i+Math.sin(u),l,o+Math.cos(u)),t.push(i,l+c,o),t.push(i+Math.sin(u+Math.PI),l,o+Math.cos(u+Math.PI)),u+=Math.PI/2,t.push(i+Math.sin(u),l,o+Math.cos(u)),t.push(i,l+c,o),t.push(i+Math.sin(u+Math.PI),l,o+Math.cos(u+Math.PI));var h=.1*Math.random();for(let e=0;e<6;e++)r.push(.2+h,.4+h,0)}}this.setAttribute("position",new a.BufferAttribute(new Float32Array(t),3)),this.setAttribute("color",new a.BufferAttribute(new Float32Array(r),3))};let w,C;function E(){if(void 0!==w)return w;try{var e;let t;const r=document.createElement("canvas");return w=!(!window.WebGLRenderingContext||!(t=r.getContext("webgl"))),t&&(null===(e=t.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext()),w}catch(t){return w=!1}}function S(){if(void 0!==C)return C;try{var e;let t;const r=document.createElement("canvas");return C=!(!window.WebGL2RenderingContext||!(t=r.getContext("webgl2"))),t&&(null===(e=t.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext()),C}catch(t){return C=!1}}function T(){return this.getErrorMessage(1)}function M(){return this.getErrorMessage(2)}function I(e){const t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},r=document.createElement("div");r.id="webglmessage",r.style.fontFamily="monospace",r.style.fontSize="13px",r.style.fontWeight="normal",r.style.textAlign="center",r.style.background="#fff",r.style.color="#000",r.style.padding="1.5em",r.style.width="400px",r.style.margin="5em auto 0";let n='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>';return n=t[e]?n.replace("$0","graphics card"):n.replace("$0","browser"),n=n.replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),r.innerHTML=n,r}b.prototype=Object.create(a.BufferGeometry.prototype);var B=function(){var e=this;function t(e,t){var r=new a.TextureLoader,i=[];for(let o=0;o<t.length;o++)i[o]=r.load(e+t[o],n),i[o].mapping=a.UVMapping,i[o].name=t[o],i[o].encoding=a.sRGBEncoding;return i}function r(e,t){var r=new a.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),n=new a.MeshLambertMaterial({color:16777215,wireframe:!1,map:t,morphTargets:!0,morphNormals:!0}),i=new a.Mesh(e,n);return i.rotation.y=-Math.PI/2,i.castShadow=!0,i.receiveShadow=!0,i.materialTexture=n,i.materialWireframe=r,i}function n(){e.loadCounter-=1,0===e.loadCounter&&e.onLoadComplete()}this.scale=1,this.animationFPS=6,this.root=new a.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(i){this.loadCounter=2*i.weapons.length+i.skins.length+1;var o=[];for(let e=0;e<i.weapons.length;e++)o[e]=i.weapons[e][1];this.skinsBody=t(i.baseUrl+"skins/",i.skins),this.skinsWeapon=t(i.baseUrl+"skins/",o);var s=new l;s.load(i.baseUrl+i.body,(function(t){var i=new a.Box3;i.setFromBufferAttribute(t.attributes.position),e.root.position.y=-e.scale*i.min.y;var o=r(t,e.skinsBody[0]);o.scale.set(e.scale,e.scale,e.scale),e.root.add(o),e.meshBody=o,e.meshBody.clipOffset=0,e.activeAnimationClipName=o.geometry.animations[0].name,e.mixer=new a.AnimationMixer(o),n()}));var c=function(t,i){return function(o){var a=r(o,e.skinsWeapon[t]);a.scale.set(e.scale,e.scale,e.scale),a.visible=!1,a.name=i,e.root.add(a),e.weapons[t]=a,e.meshWeapon=a,n()}};for(let e=0;e<i.weapons.length;e++)s.load(i.baseUrl+i.weapons[e][0],c(e,i.weapons[e][0]))},this.setPlaybackRate=function(e){this.mixer.timeScale=0!==e?1/e:0},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e])},this.setWeapon=function(t){for(let e=0;e<this.weapons.length;e++)this.weapons[e].visible=!1;var r=this.weapons[t];r&&(r.visible=!0,this.meshWeapon=r,e.syncWeaponAnimation())},this.setAnimation=function(t){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);var r=this.mixer.clipAction(t,this.meshBody);r&&(this.meshBody.activeAction=r.play())}e.activeClipName=t,e.syncWeaponAnimation()},this.syncWeaponAnimation=function(){var t=e.activeClipName;if(e.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);var r=this.mixer.clipAction(t,this.meshWeapon);r&&(this.meshWeapon.activeAction=r.syncWith(this.meshBody.activeAction).play())}},this.update=function(e){this.mixer&&this.mixer.update(e)}},_=function(e,t,r){var n=this;this.volume=e,t=t||0,Object.defineProperty(this,"index",{get:function(){return t},set:function(e){return t=e,n.geometryNeedsUpdate=!0,t}}),this.axis=r||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var i=new a.Texture(this.canvas);i.minFilter=a.LinearFilter,i.wrapS=i.wrapT=a.ClampToEdgeWrapping;var o=new a.MeshBasicMaterial({map:i,side:a.DoubleSide,transparent:!0});this.mesh=new a.Mesh(this.geometry,o),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()};function F(){const e=3e6,t=new a.BufferAttribute(new Float32Array(e),3);t.usage=a.DynamicDrawUsage;const r=new a.BufferAttribute(new Float32Array(e),3);r.usage=a.DynamicDrawUsage;const n=new a.BufferAttribute(new Float32Array(e),3);n.usage=a.DynamicDrawUsage;const i=new a.BufferGeometry;i.setAttribute("position",t),i.setAttribute("normal",r),i.setAttribute("color",n),i.drawRange.count=0;const o=new a.MeshStandardMaterial({vertexColors:!0}),s=new a.Mesh(i,o);s.frustumCulled=!1;const l=new a.Vector3,c=new a.Vector3,u=new a.Vector3,h=new a.Vector3,d=new a.Color(16777215);let f=1;function p(e,o,s,p){if(0===e.distanceToSquared(o))return;let m=i.drawRange.count;const g=function(e){const t=2*Math.PI,r=[],n=.01*e;for(let i=0;i<10;i++){const e=i/10*t;r.push(new a.Vector3(Math.sin(e)*n,Math.cos(e)*n,0))}return r}(f);for(let i=0,a=g.length;i<a;i++){const f=g[i],A=g[(i+1)%a];l.copy(f).applyMatrix4(p).add(o),c.copy(A).applyMatrix4(p).add(o),u.copy(A).applyMatrix4(s).add(e),h.copy(f).applyMatrix4(s).add(e),l.toArray(t.array,3*(m+0)),c.toArray(t.array,3*(m+1)),h.toArray(t.array,3*(m+2)),c.toArray(t.array,3*(m+3)),u.toArray(t.array,3*(m+4)),h.toArray(t.array,3*(m+5)),l.copy(f).applyMatrix4(p).normalize(),c.copy(A).applyMatrix4(p).normalize(),u.copy(A).applyMatrix4(s).normalize(),h.copy(f).applyMatrix4(s).normalize(),l.toArray(r.array,3*(m+0)),c.toArray(r.array,3*(m+1)),h.toArray(r.array,3*(m+2)),c.toArray(r.array,3*(m+3)),u.toArray(r.array,3*(m+4)),h.toArray(r.array,3*(m+5)),d.toArray(n.array,3*(m+0)),d.toArray(n.array,3*(m+1)),d.toArray(n.array,3*(m+2)),d.toArray(n.array,3*(m+3)),d.toArray(n.array,3*(m+4)),d.toArray(n.array,3*(m+5)),m+=6}i.drawRange.count=m}const m=new a.Vector3(0,1,0),g=new a.Vector3,A=new a.Vector3,v=new a.Matrix4,y=new a.Matrix4;let x=0;return{mesh:s,moveTo:function(e){g.copy(e),v.lookAt(A,g,m),A.copy(e),y.copy(v)},lineTo:function(e){g.copy(e),v.lookAt(A,g,m),p(g,A,v,y),A.copy(g),y.copy(v)},setSize:function(e){f=e},update:function(){const e=x,o=i.drawRange.count;e!==o&&(t.updateRange.offset=3*e,t.updateRange.count=3*(o-e),t.needsUpdate=!0,r.updateRange.offset=3*e,r.updateRange.count=3*(o-e),r.needsUpdate=!0,n.updateRange.offset=3*e,n.updateRange.count=3*(o-e),n.needsUpdate=!0,x=i.drawRange.count)}}}_.prototype={constructor:_,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var e=this.iLength,t=this.jLength,r=this.sliceAccess,n=this.volume,i=this.canvasBuffer,o=this.ctxBuffer,a=o.getImageData(0,0,e,t),s=a.data,l=n.data,c=n.upperThreshold,u=n.lowerThreshold,h=n.windowLow,d=n.windowHigh,f=0;if("label"===n.dataType)for(let v=0;v<t;v++)for(let t=0;t<e;t++){var p=l[r(t,v)];p=p>=this.colorMap.length?p%this.colorMap.length+1:p;var m=this.colorMap[p];s[4*f]=m>>24&255,s[4*f+1]=m>>16&255,s[4*f+2]=m>>8&255,s[4*f+3]=255&m,f++}else for(let v=0;v<t;v++)for(let t=0;t<e;t++){var g=l[r(t,v)],A=255;A=c>=g&&u<=g?A:0,g=(g=Math.floor(255*(g-h)/(d-h)))>255?255:g<0?0:0|g,s[4*f]=g,s[4*f+1]=g,s[4*f+2]=g,s[4*f+3]=A,f++}o.putImageData(a,0,0),this.ctx.drawImage(i,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new a.PlaneGeometry(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix4(this.matrix)),this.geometryNeedsUpdate=!1}};var P=function(e,t,r,n,i){if(arguments.length>0){switch(this.xLength=Number(e)||1,this.yLength=Number(t)||1,this.zLength=Number(r)||1,n){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(i);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(i);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(i);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(i);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(i);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(i);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw"Error in Volume constructor : this type is not supported in JavaScript";case"Float32":case"float32":case"float":this.data=new Float32Array(i);break;case"Float64":case"float64":case"double":this.data=new Float64Array(i);break;default:this.data=new Uint8Array(i)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw"Error in Volume constructor, lengths are not matching arrayBuffer size"}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new a.Matrix3,this.matrix.identity();var o=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return o},set:function(e){o=e,this.sliceList.forEach((function(e){e.geometryNeedsUpdate=!0}))}});var s=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return s},set:function(e){s=e,this.sliceList.forEach((function(e){e.geometryNeedsUpdate=!0}))}}),this.sliceList=[]};P.prototype={constructor:P,getData:function(e,t,r){return this.data[r*this.xLength*this.yLength+t*this.xLength+e]},access:function(e,t,r){return r*this.xLength*this.yLength+t*this.xLength+e},reverseAccess:function(e){var t=Math.floor(e/(this.yLength*this.xLength)),r=Math.floor((e-t*this.yLength*this.xLength)/this.xLength);return[e-t*this.yLength*this.xLength-r*this.xLength,r,t]},map:function(e,t){var r=this.data.length;t=t||this;for(let n=0;n<r;n++)this.data[n]=e.call(t,this.data[n],n,this.data);return this},extractPerpendicularPlane:function(e,t){var r,n,i,o,s,l,c,u,h=(new a.Matrix4).identity(),d=this,f=new a.Vector3,p=new a.Vector3,m=new a.Vector3,g=new a.Vector3(this.xLength,this.yLength,this.zLength);switch(e){case"x":f.set(1,0,0),p.set(0,0,-1),m.set(0,-1,0),s=this.spacing[2],l=this.spacing[1],u=new a.Vector3(t,0,0),h.multiply((new a.Matrix4).makeRotationY(Math.PI/2)),c=(d.RASDimensions[0]-1)/2,h.setPosition(new a.Vector3(t-c,0,0));break;case"y":f.set(0,1,0),p.set(1,0,0),m.set(0,0,1),s=this.spacing[0],l=this.spacing[2],u=new a.Vector3(0,t,0),h.multiply((new a.Matrix4).makeRotationX(-Math.PI/2)),c=(d.RASDimensions[1]-1)/2,h.setPosition(new a.Vector3(0,t-c,0));break;case"z":default:f.set(0,0,1),p.set(1,0,0),m.set(0,-1,0),s=this.spacing[0],l=this.spacing[1],u=new a.Vector3(0,0,t),c=(d.RASDimensions[2]-1)/2,h.setPosition(new a.Vector3(0,0,t-c))}p.applyMatrix4(d.inverseMatrix).normalize(),p.argVar="i",m.applyMatrix4(d.inverseMatrix).normalize(),m.argVar="j",f.applyMatrix4(d.inverseMatrix).normalize(),r=Math.floor(Math.abs(p.dot(g))),n=Math.floor(Math.abs(m.dot(g))),i=Math.abs(r*s),o=Math.abs(n*l),u=Math.abs(Math.round(u.applyMatrix4(d.inverseMatrix).dot(f)));var A=[new a.Vector3(1,0,0),new a.Vector3(0,1,0),new a.Vector3(0,0,1)],v=[p,m,f].find((function(e){return Math.abs(e.dot(A[0]))>.9})),y=[p,m,f].find((function(e){return Math.abs(e.dot(A[1]))>.9})),x=[p,m,f].find((function(e){return Math.abs(e.dot(A[2]))>.9}));return{iLength:r,jLength:n,sliceAccess:function(e,t){var r=v===f?u:"i"===v.argVar?e:t,n=y===f?u:"i"===y.argVar?e:t,i=x===f?u:"i"===x.argVar?e:t,o=v.dot(A[0])>0?r:d.xLength-1-r,a=y.dot(A[1])>0?n:d.yLength-1-n,s=x.dot(A[2])>0?i:d.zLength-1-i;return d.access(o,a,s)},matrix:h,planeWidth:i,planeHeight:o}},extractSlice:function(e,t){var r=new _(this,t,e);return this.sliceList.push(r),r},repaintAllSlices:function(){return this.sliceList.forEach((function(e){e.repaint()})),this},computeMinMax:function(){var e=1/0,t=-1/0,r=this.data.length,n=0;for(n=0;n<r;n++)if(!isNaN(this.data[n])){var i=this.data[n];e=Math.min(e,i),t=Math.max(t,i)}return this.min=e,this.max=t,[e,t]}};class R{constructor(e,t=1024){this.renderer=e,this.res=t,this.lightMapContainers=[],this.compiled=!1,this.scene=new a.Scene,this.scene.background=null,this.tinyTarget=new a.WebGLRenderTarget(1,1),this.buffer1Active=!1,this.firstUpdate=!0,this.warned=!1;const r=/(Android|iPad|iPhone|iPod)/g.test(navigator.userAgent)?alfFloatType:a.FloatType;this.progressiveLightMap1=new a.WebGLRenderTarget(this.res,this.res,{type:r}),this.progressiveLightMap2=new a.WebGLRenderTarget(this.res,this.res,{type:r}),this.uvMat=new a.MeshPhongMaterial,this.uvMat.uniforms={},this.uvMat.onBeforeCompile=e=>{e.vertexShader="#define USE_LIGHTMAP\n"+e.vertexShader.slice(0,-1)+"\tgl_Position = vec4((uv2 - 0.5) * 2.0, 1.0, 1.0); }";const t=e.fragmentShader.indexOf("void main() {");e.fragmentShader="varying vec2 vUv2;\n"+e.fragmentShader.slice(0,t)+"\tuniform sampler2D previousShadowMap;\n\tuniform float averagingWindow;\n"+e.fragmentShader.slice(t-1,-1)+"\nvec3 texelOld = texture2D(previousShadowMap, vUv2).rgb;\n\t\t\t\tgl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/averagingWindow);\n\t\t\t}",e.uniforms.previousShadowMap={value:this.progressiveLightMap1.texture},e.uniforms.averagingWindow={value:100},this.uvMat.uniforms=e.uniforms,this.uvMat.userData.shader=e,this.compiled=!0}}addObjectsToLightMap(e){this.uv_boxes=[];const t=3/this.res;for(let n=0;n<e.length;n++){const r=e[n];r.isLight?this.scene.attach(r):r.geometry.hasAttribute("uv")?(null==this.blurringPlane&&this._initializeBlurPlane(this.res,this.progressiveLightMap1),r.material.lightMap=this.progressiveLightMap2.texture,r.material.dithering=!0,r.castShadow=!0,r.receiveShadow=!0,r.renderOrder=1e3+n,this.uv_boxes.push({w:1+2*t,h:1+2*t,index:n}),this.lightMapContainers.push({basicMat:r.material,object:r}),this.compiled=!1):console.warn("All lightmap objects need UVs!")}const r=function(e){let t=0,r=0;for(const a of e)t+=a.w*a.h,r=Math.max(r,a.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let i=0,o=0;for(const a of e)for(let e=n.length-1;e>=0;e--){const t=n[e];if(!(a.w>t.w||a.h>t.h)){if(a.x=t.x,a.y=t.y,o=Math.max(o,a.y+a.h),i=Math.max(i,a.x+a.w),a.w===t.w&&a.h===t.h){const t=n.pop();e<n.length&&(n[e]=t)}else a.h===t.h?(t.x+=a.w,t.w-=a.w):a.w===t.w?(t.y+=a.h,t.h-=a.h):(n.push({x:t.x+a.w,y:t.y,w:t.w-a.w,h:a.h}),t.y+=a.h,t.h-=a.h);break}}return{w:i,h:o,fill:t/(i*o)||0}}(this.uv_boxes);this.uv_boxes.forEach((n=>{const i=e[n.index].geometry.getAttribute("uv").clone();for(let e=0;e<i.array.length;e+=i.itemSize)i.array[e]=(i.array[e]+n.x+t)/r.w,i.array[e+1]=(i.array[e+1]+n.y+t)/r.h;e[n.index].geometry.setAttribute("uv2",i),e[n.index].geometry.getAttribute("uv2").needsUpdate=!0}))}update(e,t=100,r=!0){if(null==this.blurringPlane)return;const n=this.renderer.getRenderTarget();this.blurringPlane.visible=r;for(let a=0;a<this.lightMapContainers.length;a++)this.lightMapContainers[a].object.oldScene=this.lightMapContainers[a].object.parent,this.scene.attach(this.lightMapContainers[a].object);this.firstUpdate&&(this.renderer.setRenderTarget(this.tinyTarget),this.renderer.render(this.scene,e),this.firstUpdate=!1);for(let a=0;a<this.lightMapContainers.length;a++)this.uvMat.uniforms.averagingWindow={value:t},this.lightMapContainers[a].object.material=this.uvMat,this.lightMapContainers[a].object.oldFrustumCulled=this.lightMapContainers[a].object.frustumCulled,this.lightMapContainers[a].object.frustumCulled=!1;const i=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,o=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1;this.renderer.setRenderTarget(i),this.uvMat.uniforms.previousShadowMap={value:o.texture},this.blurringPlane.material.uniforms.previousShadowMap={value:o.texture},this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e);for(let a=0;a<this.lightMapContainers.length;a++)this.lightMapContainers[a].object.frustumCulled=this.lightMapContainers[a].object.oldFrustumCulled,this.lightMapContainers[a].object.material=this.lightMapContainers[a].basicMat,this.lightMapContainers[a].object.oldScene.attach(this.lightMapContainers[a].object);this.renderer.setRenderTarget(n)}showDebugLightmap(e,t){0!=this.lightMapContainers.length?(null==this.labelMesh&&(this.labelMaterial=new a.MeshBasicMaterial({map:this.progressiveLightMap1.texture,side:a.DoubleSide}),this.labelPlane=new a.PlaneGeometry(100,100),this.labelMesh=new a.Mesh(this.labelPlane,this.labelMaterial),this.labelMesh.position.y=250,this.lightMapContainers[0].object.parent.add(this.labelMesh)),void 0!=t&&this.labelMesh.position.copy(t),this.labelMesh.visible=e):this.warned||(console.warn("Call this after adding the objects!"),this.warned=!0)}_initializeBlurPlane(e,t=null){const r=new a.MeshBasicMaterial;r.uniforms={previousShadowMap:{value:null},pixelOffset:{value:1/e},polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:3},r.onBeforeCompile=n=>{n.vertexShader="#define USE_UV\n"+n.vertexShader.slice(0,-1)+"\tgl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const i=n.fragmentShader.indexOf("void main() {");n.fragmentShader="#define USE_UV\n"+n.fragmentShader.slice(0,i)+"\tuniform sampler2D previousShadowMap;\n\tuniform float pixelOffset;\n"+n.fragmentShader.slice(i-1,-1)+"\tgl_FragColor.rgb = (\n\t\t\t  texture2D(previousShadowMap, vUv + vec2( pixelOffset,  0.0        )).rgb +\n\t\t\t  texture2D(previousShadowMap, vUv + vec2( 0.0        ,  pixelOffset)).rgb +\n\t\t\t  texture2D(previousShadowMap, vUv + vec2( 0.0        , -pixelOffset)).rgb +\n\t\t\t  texture2D(previousShadowMap, vUv + vec2(-pixelOffset,  0.0        )).rgb +\n\t\t\t  texture2D(previousShadowMap, vUv + vec2( pixelOffset,  pixelOffset)).rgb +\n\t\t\t  texture2D(previousShadowMap, vUv + vec2(-pixelOffset,  pixelOffset)).rgb +\n\t\t\t  texture2D(previousShadowMap, vUv + vec2( pixelOffset, -pixelOffset)).rgb +\n\t\t\t  texture2D(previousShadowMap, vUv + vec2(-pixelOffset, -pixelOffset)).rgb)/8.0;\n\t\t}",n.uniforms.previousShadowMap={value:t.texture},n.uniforms.pixelOffset={value:.5/e},r.uniforms=n.uniforms,r.userData.shader=n,this.compiled=!0},this.blurringPlane=new a.Mesh(new a.PlaneBufferGeometry(1,1),r),this.blurringPlane.name="Blurring Plane",this.blurringPlane.frustumCulled=!1,this.blurringPlane.renderOrder=0,this.blurringPlane.material.depthWrite=!1,this.scene.add(this.blurringPlane)}}var L=function(e){a.Object3D.call(this),this.element=e||document.createElement("div"),this.element.style.position="absolute",this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))};L.prototype=Object.assign(Object.create(a.Object3D.prototype),{constructor:L,copy:function(e,t){return a.Object3D.prototype.copy.call(this,e,t),this.element=e.element.cloneNode(!0),this}});var D=function(){var e,t,r,n,i=this,o=new a.Vector3,s=new a.Matrix4,l=new a.Matrix4,c={objects:new WeakMap},u=document.createElement("div");u.style.overflow="hidden",this.domElement=u,this.getSize=function(){return{width:e,height:t}},this.setSize=function(i,o){r=(e=i)/2,n=(t=o)/2,u.style.width=i+"px",u.style.height=o+"px"};var h=function(e,t,a){if(e instanceof L){e.onBeforeRender(i,t,a),o.setFromMatrixPosition(e.matrixWorld),o.applyMatrix4(l);var s=e.element;s.style.transform="translate(-50%,-50%) translate("+(o.x*r+r)+"px,"+(-o.y*n+n)+"px)",s.style.display=e.visible&&o.z>=-1&&o.z<=1?"":"none";var f={distanceToCameraSquared:d(a,e)};c.objects.set(e,f),s.parentNode!==u&&u.appendChild(s),e.onAfterRender(i,t,a)}for(let r=0,n=e.children.length;r<n;r++)h(e.children[r],t,a)},d=function(){var e=new a.Vector3,t=new a.Vector3;return function(r,n){return e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(n.matrixWorld),e.distanceToSquared(t)}}(),f=function(e){var t=function(e){var t=[];return e.traverse((function(e){e instanceof L&&t.push(e)})),t}(e).sort((function(e,t){return c.objects.get(e).distanceToCameraSquared-c.objects.get(t).distanceToCameraSquared})),r=t.length;for(let n=0,i=t.length;n<i;n++)t[n].element.style.zIndex=r-n};this.render=function(e,t){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),s.copy(t.matrixWorldInverse),l.multiplyMatrices(t.projectionMatrix,s),h(e,e,t),f(e)}};const N={Vertex:"vertex",Fragment:"fragment"},k={None:"none",Frame:"frame",Object:"object"},O={Float:"float",Vector2:"vec2",Vector3:"vec3",Vector4:"vec4",Matrix3:"mat3",Matrix4:"mat4"},U={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Q={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},V={Store:"store",Clear:"clear"},G={Load:"load"},z={CCW:"ccw",CW:"cw"},H={None:"none",Front:"front",Back:"back"},W={Uint16:"uint16",Uint32:"uint32"},Z={Uchar2:"uchar2",Uchar4:"uchar4",Char2:"char2",Char4:"char4",Uchar2Norm:"uchar2norm",Uchar4Norm:"uchar4norm",Char2Norm:"char2norm",Char4Norm:"char4norm",Ushort2:"ushort2",Ushort4:"ushort4",Short2:"short2",Short4:"short4",Ushort2Norm:"ushort2norm",Ushort4Norm:"ushort4norm",Short2Norm:"short2norm",Short4Norm:"short4norm",Half2:"half2",Half4:"half4",Float:"float",Float2:"float2",Float3:"float3",Float4:"float4",Uint:"uint",Uint2:"uint2",Uint3:"uint3",Uint4:"uint4",Int:"int",Int2:"int2",Int3:"int3",Int4:"int4"},X={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BRGA8Unorm:"bgra8unorm",BRGA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10uFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Stencil8:"stencil8",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSNorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",Depth24UnormStencil8:"depth24unorm-stencil8",Depth32FloatStencil8:"depth32float-stencil8"},Y={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},J={Linear:"linear",Nearest:"nearest"},q={Zero:"zero",One:"one",SrcColor:"src-color",OneMinusSrcColor:"one-minus-src-color",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",DstColor:"dst-color",OneMinusDstColor:"one-minus-dst-color",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",BlendColor:"blend-color",OneMinusBlendColor:"one-minus-blend-color"},K={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},$={None:0,Red:1,Green:2,Blue:4,Alpha:8,All:15},ee={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},te={UniformBuffer:"uniform-buffer",StorageBuffer:"storage-buffer",ReadonlyStorageBuffer:"readonly-storage-buffer",Sampler:"sampler",ComparisonSampler:"comparison-sampler",SampledTexture:"sampled-texture",MultisampledTexture:"multisampled-texture",ReadonlyStorageTexture:"readonly-storage-texture",WriteonlyStorageTexture:"writeonly-storage-texture"},re={OneD:"1d",TwoD:"2d",ThreeD:"3d"},ne={OneD:"1d",TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",CubeArray:"cube-array",ThreeD:"3d"},ie={Vertex:"vertex",Instance:"instance"},oe=211,ae=212;class se{constructor(e,t=null){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class le extends se{constructor(e,t=0){super(e,t),this.boundary=4,this.itemSize=1,Object.defineProperty(this,"isFloatUniform",{value:!0})}}class ce extends se{constructor(e,t=new a.Vector2){super(e,t),this.boundary=8,this.itemSize=2,Object.defineProperty(this,"isVector2Uniform",{value:!0})}}class ue extends se{constructor(e,t=new a.Vector3){super(e,t),this.boundary=16,this.itemSize=3,Object.defineProperty(this,"isVector3Uniform",{value:!0})}}class he extends se{constructor(e,t=new a.Vector4){super(e,t),this.boundary=16,this.itemSize=4,Object.defineProperty(this,"isVector4Uniform",{value:!0})}}class de extends se{constructor(e,t=new a.Color){super(e,t),this.boundary=16,this.itemSize=3,Object.defineProperty(this,"isColorUniform",{value:!0})}}class fe extends se{constructor(e,t=new a.Matrix3){super(e,t),this.boundary=48,this.itemSize=12,Object.defineProperty(this,"isMatrix3Uniform",{value:!0})}}class pe extends se{constructor(e,t=new a.Matrix4){super(e,t),this.boundary=64,this.itemSize=16,Object.defineProperty(this,"isMatrix4Uniform",{value:!0})}}class me extends le{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class ge extends ce{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Ae extends ue{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class ve extends he{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class ye extends de{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class xe extends fe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class be extends pe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}var we=class{constructor(e=""){this.name=e,this.visibility=null,this.type=null,this.isShared=!1}setVisibility(e){this.visibility=e}};class Ce extends we{constructor(e,t){super(e),this.texture=t,this.dimension=ne.TwoD,this.type=te.SampledTexture,this.visibility=GPUShaderStage.FRAGMENT,this.textureGPU=null,Object.defineProperty(this,"isSampledTexture",{value:!0})}}class Ee extends Ce{constructor(e){super(e),this.dimension=ne.TwoDArray,Object.defineProperty(this,"isSampledArrayTexture",{value:!0})}}class Se extends Ce{constructor(e){super(e),this.dimension=ne.ThreeD,Object.defineProperty(this,"isSampled3DTexture",{value:!0})}}class Te extends Ce{constructor(e){super(e),this.dimension=ne.Cube,Object.defineProperty(this,"isSampledCubeTexture",{value:!0})}}var Me=function(e){a.Object3D.call(this),this.element=e||document.createElement("div"),this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))};Me.prototype=Object.assign(Object.create(a.Object3D.prototype),{constructor:Me,copy:function(e,t){return a.Object3D.prototype.copy.call(this,e,t),this.element=e.element.cloneNode(!0),this}});var Ie=function(e){Me.call(this,e)};Ie.prototype=Object.create(Me.prototype),Ie.prototype.constructor=Ie;var Be=function(){var e,t,r,n,i=this,o=new a.Matrix4,s={camera:{fov:0,style:""},objects:new WeakMap},l=document.createElement("div");l.style.overflow="hidden",this.domElement=l;var c=document.createElement("div");function u(e){return Math.abs(e)<1e-10?0:e}function h(e){var t=e.elements;return"matrix3d("+u(t[0])+","+u(-t[1])+","+u(t[2])+","+u(t[3])+","+u(t[4])+","+u(-t[5])+","+u(t[6])+","+u(t[7])+","+u(t[8])+","+u(-t[9])+","+u(t[10])+","+u(t[11])+","+u(t[12])+","+u(-t[13])+","+u(t[14])+","+u(t[15])+")"}function d(e){var t=e.elements;return"translate(-50%,-50%)"+("matrix3d("+u(t[0])+","+u(t[1])+","+u(t[2])+","+u(t[3])+","+u(-t[4])+","+u(-t[5])+","+u(-t[6])+","+u(-t[7])+","+u(t[8])+","+u(t[9])+","+u(t[10])+","+u(t[11])+","+u(t[12])+","+u(t[13])+","+u(t[14])+","+u(t[15])+")")}function f(e,t,r,n){if(e instanceof Me){var a;e.onBeforeRender(i,t,r),e instanceof Ie?(o.copy(r.matrixWorldInverse),o.transpose(),o.copyPosition(e.matrixWorld),o.scale(e.scale),o.elements[3]=0,o.elements[7]=0,o.elements[11]=0,o.elements[15]=1,a=d(o)):a=d(e.matrixWorld);var l=e.element,u=s.objects.get(e);if(void 0===u||u.style!==a){l.style.transform=a;var h={style:a};s.objects.set(e,h)}l.style.display=e.visible?"":"none",l.parentNode!==c&&c.appendChild(l),e.onAfterRender(i,t,r)}for(let i=0,o=e.children.length;i<o;i++)f(e.children[i],t,r)}c.style.transformStyle="preserve-3d",c.style.pointerEvents="none",l.appendChild(c),this.getSize=function(){return{width:e,height:t}},this.setSize=function(i,o){r=(e=i)/2,n=(t=o)/2,l.style.width=i+"px",l.style.height=o+"px",c.style.width=i+"px",c.style.height=o+"px"},this.render=function(e,t){var i=t.projectionMatrix.elements[5]*n;if(s.camera.fov!==i&&(l.style.perspective=t.isPerspectiveCamera?i+"px":"",s.camera.fov=i),!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.isOrthographicCamera)var o=-(t.right+t.left)/2,a=(t.top+t.bottom)/2;var d=(t.isOrthographicCamera?"scale("+i+")translate("+u(o)+"px,"+u(a)+"px)"+h(t.matrixWorldInverse):"translateZ("+i+"px)"+h(t.matrixWorldInverse))+"translate("+r+"px,"+n+"px)";s.camera.style!==d&&(c.style.transform=d,s.camera.style=d),f(e,e,t)}},_e=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},Fe=function(){this.id=0,this.v1=new Pe,this.v2=new Pe,this.v3=new Pe,this.normalModel=new a.Vector3,this.vertexNormalsModel=[new a.Vector3,new a.Vector3,new a.Vector3],this.vertexNormalsLength=0,this.color=new a.Color,this.material=null,this.uvs=[new a.Vector2,new a.Vector2,new a.Vector2],this.z=0,this.renderOrder=0},Pe=function(){this.position=new a.Vector3,this.positionWorld=new a.Vector3,this.positionScreen=new a.Vector4,this.visible=!0};Pe.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)};var Re=function(){this.id=0,this.v1=new Pe,this.v2=new Pe,this.vertexColors=[new a.Color,new a.Color],this.material=null,this.z=0,this.renderOrder=0},Le=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new a.Vector2,this.material=null,this.renderOrder=0},De=function(){var e,t,r,n,i,o,s,l,c,u,h,d=[],f=0,p=[],m=0,g=[],A=0,v=[],y=0,x=[],b=0,w={objects:[],lights:[],elements:[]},C=new a.Vector3,E=new a.Vector4,S=new a.Box3(new a.Vector3(-1,-1,-1),new a.Vector3(1,1,1)),T=new a.Box3,M=new Array(3),I=new a.Matrix4,B=new a.Matrix4,_=new a.Matrix4,F=new a.Frustum;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var P=new function(){var e=[],t=[],o=[],c=null,u=new a.Matrix3;function d(e){var t=e.position,r=e.positionWorld,n=e.positionScreen;r.copy(t).applyMatrix4(h),n.copy(r).applyMatrix4(B);var i=1/n.w;n.x*=i,n.y*=i,n.z*=i,e.visible=n.x>=-1&&n.x<=1&&n.y>=-1&&n.y<=1&&n.z>=-1&&n.z<=1}function f(e,t,r){return!0===e.visible||!0===t.visible||!0===r.visible||(M[0]=e.positionScreen,M[1]=t.positionScreen,M[2]=r.positionScreen,S.intersectsBox(T.setFromPoints(M)))}function g(e,t,r){return(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(r){c=r,u.getNormalMatrix(c.matrixWorld),e.length=0,t.length=0,o.length=0},projectVertex:d,checkTriangleVisibility:f,checkBackfaceCulling:g,pushVertex:function(e,t,i){(r=function(){if(n===m){var e=new Pe;return p.push(e),m++,n++,e}return p[n++]}()).position.set(e,t,i),d(r)},pushNormal:function(t,r,n){e.push(t,r,n)},pushColor:function(e,r,n){t.push(e,r,n)},pushUv:function(e,t){o.push(e,t)},pushLine:function(e,r){var n=p[e],i=p[r];n.positionScreen.copy(n.position).applyMatrix4(_),i.positionScreen.copy(i.position).applyMatrix4(_),!0===function(e,t){var r=0,n=1,i=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return i>=0&&o>=0&&a>=0&&s>=0||!(i<0&&o<0||a<0&&s<0)&&(i<0?r=Math.max(r,i/(i-o)):o<0&&(n=Math.min(n,i/(i-o))),a<0?r=Math.max(r,a/(a-s)):s<0&&(n=Math.min(n,a/(a-s))),!(n<r)&&(e.lerp(t,r),t.lerp(e,1-n),!0))}(n.positionScreen,i.positionScreen)&&(n.positionScreen.multiplyScalar(1/n.positionScreen.w),i.positionScreen.multiplyScalar(1/i.positionScreen.w),(s=function(){if(l===y){var e=new Re;return v.push(e),y++,l++,e}return v[l++]}()).id=c.id,s.v1.copy(n),s.v2.copy(i),s.z=Math.max(n.positionScreen.z,i.positionScreen.z),s.renderOrder=c.renderOrder,s.material=c.material,c.material.vertexColors&&(s.vertexColors[0].fromArray(t,3*e),s.vertexColors[1].fromArray(t,3*r)),w.elements.push(s))},pushTriangle:function(r,n,s,l){var h=p[r],d=p[n],m=p[s];if(!1!==f(h,d,m)&&(l.side===a.DoubleSide||!0===g(h,d,m))){(i=N()).id=c.id,i.v1.copy(h),i.v2.copy(d),i.v3.copy(m),i.z=(h.positionScreen.z+d.positionScreen.z+m.positionScreen.z)/3,i.renderOrder=c.renderOrder,C.subVectors(m.position,d.position),E.subVectors(h.position,d.position),C.cross(E),i.normalModel.copy(C),i.normalModel.applyMatrix3(u).normalize();for(let t=0;t<3;t++){var A=i.vertexNormalsModel[t];A.fromArray(e,3*arguments[t]),A.applyMatrix3(u).normalize();var v=i.uvs[t];v.fromArray(o,2*arguments[t])}i.vertexNormalsLength=3,i.material=l,l.vertexColors&&i.color.fromArray(t,3*r),w.elements.push(i)}}}};function R(e){if(!1!==e.visible){if(e.isLight)w.lights.push(e);else if(e.isMesh||e.isLine||e.isPoints){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===F.intersectsObject(e))return;L(e)}else if(e.isSprite){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===F.intersectsSprite(e))return;L(e)}var t=e.children;for(let e=0,r=t.length;e<r;e++)R(t[e])}}function L(r){(e=function(){if(t===f){var e=new _e;return d.push(e),f++,t++,e}return d[t++]}()).id=r.id,e.object=r,C.setFromMatrixPosition(r.matrixWorld),C.applyMatrix4(B),e.z=C.z,e.renderOrder=r.renderOrder,w.objects.push(e)}function D(e,t,r){var n=1/e.w;e.z*=n,e.z>=-1&&e.z<=1&&((c=function(){if(u===b){var e=new Le;return x.push(e),b++,u++,e}return x[u++]}()).id=t.id,c.x=e.x*n,c.y=e.y*n,c.z=e.z,c.renderOrder=t.renderOrder,c.object=t,c.rotation=t.rotation,c.scale.x=t.scale.x*Math.abs(c.x-(e.x+r.projectionMatrix.elements[0])/(e.w+r.projectionMatrix.elements[12])),c.scale.y=t.scale.y*Math.abs(c.y-(e.y+r.projectionMatrix.elements[5])/(e.w+r.projectionMatrix.elements[13])),c.material=t.material,w.elements.push(c))}function N(){if(o===A){var e=new Fe;return g.push(e),A++,o++,e}return g[o++]}function k(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(e,r,i,a){o=0,l=0,u=0,w.elements.length=0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),I.copy(r.matrixWorldInverse),B.multiplyMatrices(r.projectionMatrix,I),F.setFromProjectionMatrix(B),t=0,w.objects.length=0,w.lights.length=0,R(e),!0===i&&w.objects.sort(k);var s=w.objects;for(let t=0,o=s.length;t<o;t++){var c=s[t].object,d=c.geometry;if(P.setObject(c),h=c.matrixWorld,n=0,c.isMesh){if(d.isBufferGeometry){var f=c.material,p=Array.isArray(f),m=d.attributes,g=d.groups;if(void 0===m.position)continue;for(let e=0,t=(V=m.position.array).length;e<t;e+=3){var A=V[e],v=V[e+1],y=V[e+2];if(!0===f.morphTargets){var x=d.morphAttributes.position,b=d.morphTargetsRelative,C=c.morphTargetInfluences;for(let t=0,r=x.length;t<r;t++){var S=C[t];if(0!==S){var T=x[t];b?(A+=T.getX(e/3)*S,v+=T.getY(e/3)*S,y+=T.getZ(e/3)*S):(A+=(T.getX(e/3)-V[e])*S,v+=(T.getY(e/3)-V[e+1])*S,y+=(T.getZ(e/3)-V[e+2])*S)}}}P.pushVertex(A,v,y)}if(void 0!==m.normal){var M=m.normal.array;for(let e=0,t=M.length;e<t;e+=3)P.pushNormal(M[e],M[e+1],M[e+2])}if(void 0!==m.color)for(let e=0,t=(U=m.color.array).length;e<t;e+=3)P.pushColor(U[e],U[e+1],U[e+2]);if(void 0!==m.uv){var L=m.uv.array;for(let e=0,t=L.length;e<t;e+=2)P.pushUv(L[e],L[e+1])}if(null!==d.index){var N=d.index.array;if(g.length>0)for(let e=0;e<g.length;e++){var O=g[e];if(void 0!==(f=!0===p?c.material[O.materialIndex]:c.material))for(let e=O.start,t=O.start+O.count;e<t;e+=3)P.pushTriangle(N[e],N[e+1],N[e+2],f)}else for(let e=0,t=N.length;e<t;e+=3)P.pushTriangle(N[e],N[e+1],N[e+2],f)}else if(g.length>0)for(let e=0;e<g.length;e++){O=g[e];if(void 0!==(f=!0===p?c.material[O.materialIndex]:c.material))for(let e=O.start,t=O.start+O.count;e<t;e+=3)P.pushTriangle(e,e+1,e+2,f)}else for(let e=0,t=V.length/3;e<t;e+=3)P.pushTriangle(e,e+1,e+2,f)}else if(d.isGeometry)return void console.error("THREE.Projector no longer supports Geometry. Use THREE.BufferGeometry instead.")}else if(c.isLine){if(_.multiplyMatrices(B,h),d.isBufferGeometry){if(void 0!==(m=d.attributes).position){var U;for(let e=0,t=(V=m.position.array).length;e<t;e+=3)P.pushVertex(V[e],V[e+1],V[e+2]);if(void 0!==m.color)for(let e=0,t=(U=m.color.array).length;e<t;e+=3)P.pushColor(U[e],U[e+1],U[e+2]);if(null!==d.index){for(let e=0,t=(N=d.index.array).length;e<t;e+=2)P.pushLine(N[e],N[e+1])}else{var Q=c.isLineSegments?2:1;for(let e=0,t=V.length/3-1;e<t;e+=Q)P.pushLine(e,e+1)}}}else if(d.isGeometry)return void console.error("THREE.Projector no longer supports Geometry. Use THREE.BufferGeometry instead.")}else if(c.isPoints){if(_.multiplyMatrices(B,h),d.isGeometry)return void console.error("THREE.Projector no longer supports Geometry. Use THREE.BufferGeometry instead.");var V;if(d.isBufferGeometry&&void 0!==(m=d.attributes).position)for(let e=0,t=(V=m.position.array).length;e<t;e+=3)E.set(V[e],V[e+1],V[e+2],1),E.applyMatrix4(_),D(E,c,r)}else c.isSprite&&(c.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,c.matrixWorld),E.set(h.elements[12],h.elements[13],h.elements[14],1),E.applyMatrix4(B),D(E,c,r))}return!0===a&&w.elements.sort(k),w}},Ne=function(e){a.Object3D.call(this),this.node=e};Ne.prototype=Object.create(a.Object3D.prototype),Ne.prototype.constructor=Ne;var ke=function(){var e,t,r,n,i,o,s,l,c,u,h,d,f,p=this,m=new De,g=document.createElementNS("http://www.w3.org/2000/svg","svg"),A=new a.Box2,v=new a.Box2,y=new a.Color,x=new a.Color,b=new a.Color,w=new a.Color,C=new a.Color,E=new a.Color,S=new a.Vector3,T=new a.Vector3,M=new a.Vector3,I=new a.Matrix3,B=new a.Matrix4,_=new a.Matrix4,F=[],P=0,R=1,L=null;function D(){for(P=0;g.childNodes.length>0;)g.removeChild(g.childNodes[0])}function N(e){return null!==L?e.toFixed(L):e}function k(e,t,r){var n=t.scale.x*o,i=t.scale.y*s;r.isPointsMaterial&&(n*=r.size,i*=r.size);var a="M"+N(e.x-.5*n)+","+N(e.y-.5*i)+"h"+N(n)+"v"+N(i)+"h"+N(-n)+"z",l="";(r.isSpriteMaterial||r.isPointsMaterial)&&(l="fill:"+r.color.getStyle()+";fill-opacity:"+r.opacity),V(l,a)}function O(e,t,r,n){var i="M"+N(e.positionScreen.x)+","+N(e.positionScreen.y)+"L"+N(t.positionScreen.x)+","+N(t.positionScreen.y);if(n.isLineBasicMaterial){var o="fill:none;stroke:"+n.color.getStyle()+";stroke-opacity:"+n.opacity+";stroke-width:"+n.linewidth+";stroke-linecap:"+n.linecap;n.isLineDashedMaterial&&(o=o+";stroke-dasharray:"+n.dashSize+","+n.gapSize),V(o,i)}}function U(e,t,n,i,o){p.info.render.vertices+=3,p.info.render.faces++;var a="M"+N(e.positionScreen.x)+","+N(e.positionScreen.y)+"L"+N(t.positionScreen.x)+","+N(t.positionScreen.y)+"L"+N(n.positionScreen.x)+","+N(n.positionScreen.y)+"z";o.isMeshBasicMaterial?(y.copy(o.color),o.vertexColors&&y.multiply(i.color)):o.isMeshLambertMaterial||o.isMeshPhongMaterial||o.isMeshStandardMaterial?(x.copy(o.color),o.vertexColors&&x.multiply(i.color),y.copy(b),T.copy(e.positionWorld).add(t.positionWorld).add(n.positionWorld).divideScalar(3),function(e,t,r,n){for(let l=0,c=e.length;l<c;l++){var i=e[l],o=i.color;if(i.isDirectionalLight){var a=S.setFromMatrixPosition(i.matrixWorld).normalize();if((s=r.dot(a))<=0)continue;s*=i.intensity,n.r+=o.r*s,n.g+=o.g*s,n.b+=o.b*s}else if(i.isPointLight){var s;if(a=S.setFromMatrixPosition(i.matrixWorld),(s=r.dot(S.subVectors(a,t).normalize()))<=0)continue;if(0==(s*=0==i.distance?1:1-Math.min(t.distanceTo(a)/i.distance,1)))continue;s*=i.intensity,n.r+=o.r*s,n.g+=o.g*s,n.b+=o.b*s}}}(r,T,i.normalModel,y),y.multiply(x).add(o.emissive)):o.isMeshNormalMaterial&&(M.copy(i.normalModel).applyMatrix3(I).normalize(),y.setRGB(M.x,M.y,M.z).multiplyScalar(.5).addScalar(.5)),V(o.wireframe?"fill:none;stroke:"+y.getStyle()+";stroke-opacity:"+o.opacity+";stroke-width:"+o.wireframeLinewidth+";stroke-linecap:"+o.wireframeLinecap+";stroke-linejoin:"+o.wireframeLinejoin:"fill:"+y.getStyle()+";fill-opacity:"+o.opacity,a)}function Q(e,t,r){var n,i=t.x-e.x,o=t.y-e.y,a=i*i+o*o;0!==a&&(i*=n=r/Math.sqrt(a),o*=n,t.x+=i,t.y+=o,e.x-=i,e.y-=o)}function V(e,t){f===e?d+=t:(G(),f=e,d=t)}function G(){d&&((h=function(e){if(null==F[e])return F[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==R&&F[e].setAttribute("shape-rendering","crispEdges"),F[e];return F[e]}(P++)).setAttribute("d",d),h.setAttribute("style",f),g.appendChild(h)),d="",f=""}this.domElement=g,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":R=1;break;case"low":R=0}},this.setClearColor=function(e){E.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,t){o=(n=e)/2,s=(i=t)/2,g.setAttribute("viewBox",-o+" "+-s+" "+n+" "+i),g.setAttribute("width",n),g.setAttribute("height",i),A.min.set(-o,-s),A.max.set(o,s)},this.getSize=function(){return{width:n,height:i}},this.setPrecision=function(e){L=e},this.clear=function(){D(),g.style.backgroundColor=E.getStyle()},this.render=function(n,i){if(i instanceof a.Camera!==!1){var h=n.background;h&&h.isColor?(D(),g.style.backgroundColor=h.getStyle()):!0===this.autoClear&&this.clear(),p.info.render.vertices=0,p.info.render.faces=0,B.copy(i.matrixWorldInverse),_.multiplyMatrices(i.projectionMatrix,B),e=m.projectScene(n,i,this.sortObjects,this.sortElements),t=e.elements,r=e.lights,I.getNormalMatrix(i.matrixWorldInverse),function(e){b.setRGB(0,0,0),w.setRGB(0,0,0),C.setRGB(0,0,0);for(let n=0,i=e.length;n<i;n++){var t=e[n],r=t.color;t.isAmbientLight?(b.r+=r.r,b.g+=r.g,b.b+=r.b):t.isDirectionalLight?(w.r+=r.r,w.g+=r.g,w.b+=r.b):t.isPointLight&&(C.r+=r.r,C.g+=r.g,C.b+=r.b)}}(r),d="",f="";for(let e=0,r=t.length;e<r;e++){var y=t[e],x=y.material;if(void 0!==x&&0!==x.opacity)if(v.makeEmpty(),y instanceof Le)(l=y).x*=o,l.y*=-s,k(l,y,x);else if(y instanceof Re)l=y.v1,c=y.v2,l.positionScreen.x*=o,l.positionScreen.y*=-s,c.positionScreen.x*=o,c.positionScreen.y*=-s,v.setFromPoints([l.positionScreen,c.positionScreen]),!0===A.intersectsBox(v)&&O(l,c,y,x);else if(y instanceof Fe){if(l=y.v1,c=y.v2,u=y.v3,l.positionScreen.z<-1||l.positionScreen.z>1)continue;if(c.positionScreen.z<-1||c.positionScreen.z>1)continue;if(u.positionScreen.z<-1||u.positionScreen.z>1)continue;l.positionScreen.x*=o,l.positionScreen.y*=-s,c.positionScreen.x*=o,c.positionScreen.y*=-s,u.positionScreen.x*=o,u.positionScreen.y*=-s,this.overdraw>0&&(Q(l.positionScreen,c.positionScreen,this.overdraw),Q(c.positionScreen,u.positionScreen,this.overdraw),Q(u.positionScreen,l.positionScreen,this.overdraw)),v.setFromPoints([l.positionScreen,c.positionScreen,u.positionScreen]),!0===A.intersectsBox(v)&&U(l,c,u,y,x)}}G(),n.traverseVisible((function(e){if(e instanceof Ne){if(S.setFromMatrixPosition(e.matrixWorld),S.applyMatrix4(_),S.z<-1||S.z>1)return;var t=S.x*o,r=-S.y*s,n=e.node;n.setAttribute("transform","translate("+t+","+r+")"),g.appendChild(n)}}))}else console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.")}};class Oe{constructor(e=512,t=512){const r=document.createElement("canvas");r.width=e,r.height=t;const n=r.getContext("2d");n.fillStyle="rgb(127,127,255)",n.fillRect(0,0,e,t);for(let i=0;i<4e3;i++){const r=Math.random()*e,i=Math.random()*t,o=3*Math.random()+3;let a=2*Math.random()-1,s=2*Math.random()-1,l=1.5;const c=Math.sqrt(a*a+s*s+l*l);a/=c,s/=c,l/=c,n.fillStyle="rgb("+(127*a+127)+","+(127*s+127)+","+255*l+")",n.beginPath(),n.arc(r,i,o,0,2*Math.PI),n.fill()}return r}}var Ue=r(6149),Qe=r(4649);const Ve=(e,t)=>e[t],Ge=(e,t)=>{const r=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),o={},s={},l=e[0].morphTargetsRelative,c=new a.BufferGeometry;let u=0;if(e.forEach(((e,a)=>{let h=0;if(r!==(null!==e.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+a+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let t in e.attributes){if(!n.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+a+'. All geometries must have compatible attributes; make sure "'+t+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[t]&&(o[t]=[]),o[t].push(e.attributes[t]),h++}if(h!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+a+". Make sure all geometries have the same number of attributes."),null;if(l!==e.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+a+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let t in e.morphAttributes){if(!i.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+a+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===s[t]&&(s[t]=[]),s[t].push(e.morphAttributes[t])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(e.userData),t){let t;if(e.index)t=e.index.count;else{if(void 0===e.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+a+". The geometry must have either an index or a position attribute"),null;t=e.attributes.position.count}c.addGroup(u,t,a),u+=t}})),r){let t=0;const r=[];e.forEach((e=>{const n=e.index;for(let i=0;i<n.count;++i)r.push(n.getX(i)+t);t+=e.attributes.position.count})),c.setIndex(r)}for(let a in o){const e=ze(o[a]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+a+" attribute."),null;c.setAttribute(a,e)}for(let a in s){const e=s[a][0].length;if(0===e)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[a]=[];for(let t=0;t<e;++t){const e=[];for(let n=0;n<s[a].length;++n)e.push(s[a][n][t]);const r=ze(e);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+a+" morphAttribute."),null;c.morphAttributes[a].push(r)}}return c},ze=e=>{let t,r,n,i=0;if(e.forEach((e=>(void 0===t&&(t=e.array.constructor),t!==e.array.constructor?(console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null):(void 0===r&&(r=e.itemSize),r!==e.itemSize?(console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null):(void 0===n&&(n=e.normalized),n!==e.normalized?(console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null):void(i+=e.array.length)))))),t&&r){const o=new t(i);let s=0;return e.forEach((e=>{o.set(e.array,s),s+=e.array.length})),new a.BufferAttribute(o,r,n)}},je=e=>{let t,r=0,n=0;for(let a=0,u=e.length;a<u;++a){const i=e[a];if(void 0===t&&(t=i.array.constructor),t!==i.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;r+=i.array.length,n+=i.itemSize}const i=new a.InterleavedBuffer(new t(r),n);let o=0;const s=[],l=["getX","getY","getZ","getW"],c=["setX","setY","setZ","setW"];for(let u=0,h=e.length;u<h;u++){const t=e[u],r=t.itemSize,n=t.count,h=new a.InterleavedBufferAttribute(i,r,o,t.normalized);s.push(h),o+=r;for(let e=0;e<n;e++)for(let n=0;n<r;n++){Ve(h,c[n])(e,Ve(t,l[n])(e))}}return s};function He(e){let t=0;for(let n in e.attributes){const r=e.getAttribute(n);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const r=e.getIndex();return t+=r?r.count*r.itemSize*r.array.BYTES_PER_ELEMENT:0,t}function We(e,t=1e-4){t=Math.max(t,Number.EPSILON);const r={},n=e.getIndex(),i=e.getAttribute("position"),o=n?n.count:i.count;let s=0;const l=Object.keys(e.attributes),c={},u={},h=[],d=["getX","getY","getZ","getW"];for(let a=0,g=l.length;a<g;a++){const t=l[a];c[t]=[];const r=e.morphAttributes[t];r&&(u[t]=new Array(r.length).fill(0).map((()=>[])))}const f=Math.log10(1/t),p=Math.pow(10,f);for(let a=0;a<o;a++){const t=n?n.getX(a):a;let i="";for(let r=0,n=l.length;r<n;r++){const n=l[r],o=e.getAttribute(n),a=o.itemSize;for(let e=0;e<a;e++)i+=~~(o[d[e]](t)*p)+","}if(i in r)h.push(r[i]);else{for(let r=0,n=l.length;r<n;r++){const n=l[r],i=e.getAttribute(n),o=e.morphAttributes[n],a=i.itemSize,s=c[n],h=u[n];for(let e=0;e<a;e++){const r=d[e];if(s.push(i[r](t)),o)for(let e=0,n=o.length;e<n;e++)h[e].push(o[e][r](t))}}r[i]=s,h.push(s),s++}}const m=e.clone();for(let g=0,A=l.length;g<A;g++){const t=l[g],r=e.getAttribute(t),n=new r.array.constructor(c[t]),i=new a.BufferAttribute(n,r.itemSize,r.normalized);if(m.setAttribute(t,i),t in u)for(let o=0;o<u[t].length;o++){const r=e.morphAttributes[t][o],n=new r.array.constructor(u[t][o]),i=new a.BufferAttribute(n,r.itemSize,r.normalized);m.morphAttributes[t][o]=i}}return m.setIndex(h),m}function Ze(e,t){if(t===a.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===a.TriangleFanDrawMode||t===a.TriangleStripDrawMode){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const n=r.count-2,i=[];if(r)if(t===a.TriangleFanDrawMode)for(let e=1;e<=n;e++)i.push(r.getX(0)),i.push(r.getX(e)),i.push(r.getX(e+1));else for(let e=0;e<n;e++)e%2===0?(i.push(r.getX(e)),i.push(r.getX(e+1)),i.push(r.getX(e+2))):(i.push(r.getX(e+2)),i.push(r.getX(e+1)),i.push(r.getX(e)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(i),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}function Xe(e){if(!0!==e.geometry.isBufferGeometry)return console.error("THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;const t=new a.Vector3,r=new a.Vector3,n=new a.Vector3,i=new a.Vector3,o=new a.Vector3,s=new a.Vector3,l=new a.Vector3,c=new a.Vector3,u=new a.Vector3;function h(e,a,h,d,f,p,m,g,A){t.fromBufferAttribute(h,p),r.fromBufferAttribute(h,m),n.fromBufferAttribute(h,g);const v=e.morphTargetInfluences;if(a.morphTargets&&d&&v){l.set(0,0,0),c.set(0,0,0),u.set(0,0,0);for(let e=0,a=d.length;e<a;e++){const a=v[e],h=d[e];0!==a&&(i.fromBufferAttribute(h,p),o.fromBufferAttribute(h,m),s.fromBufferAttribute(h,g),f?(l.addScaledVector(i,a),c.addScaledVector(o,a),u.addScaledVector(s,a)):(l.addScaledVector(i.sub(t),a),c.addScaledVector(o.sub(r),a),u.addScaledVector(s.sub(n),a)))}t.add(l),r.add(c),n.add(u)}e.isSkinnedMesh&&(e.boneTransform(p,t),e.boneTransform(m,r),e.boneTransform(g,n)),A[3*p+0]=t.x,A[3*p+1]=t.y,A[3*p+2]=t.z,A[3*m+0]=r.x,A[3*m+1]=r.y,A[3*m+2]=r.z,A[3*g+0]=n.x,A[3*g+1]=n.y,A[3*g+2]=n.z}const d=e.geometry,f=e.material;let p,m,g;const A=d.index,v=d.attributes.position,y=d.morphAttributes.position,x=d.morphTargetsRelative,b=d.attributes.normal,w=d.morphAttributes.position,C=d.groups,E=d.drawRange;let S,T,M,I,B,_,F,P;const R=new Float32Array(v.count*v.itemSize),L=new Float32Array(b.count*b.itemSize);if(null!==A)if(Array.isArray(f))for(S=0,M=C.length;S<M;S++)for(B=C[S],_=f[B.materialIndex],F=Math.max(B.start,E.start),P=Math.min(B.start+B.count,E.start+E.count),T=F,I=P;T<I;T+=3)p=A.getX(T),m=A.getX(T+1),g=A.getX(T+2),h(e,_,v,y,x,p,m,g,R),h(e,_,b,w,x,p,m,g,L);else for(F=Math.max(0,E.start),P=Math.min(A.count,E.start+E.count),S=F,M=P;S<M;S+=3)p=A.getX(S),m=A.getX(S+1),g=A.getX(S+2),h(e,f,v,y,x,p,m,g,R),h(e,f,b,w,x,p,m,g,L);else if(void 0!==v)if(Array.isArray(f))for(S=0,M=C.length;S<M;S++)for(B=C[S],_=f[B.materialIndex],F=Math.max(B.start,E.start),P=Math.min(B.start+B.count,E.start+E.count),T=F,I=P;T<I;T+=3)p=T,m=T+1,g=T+2,h(e,_,v,y,x,p,m,g,R),h(e,_,b,w,x,p,m,g,L);else for(F=Math.max(0,E.start),P=Math.min(v.count,E.start+E.count),S=F,M=P;S<M;S+=3)p=S,m=S+1,g=S+2,h(e,f,v,y,x,p,m,g,R),h(e,f,b,w,x,p,m,g,L);return{positionAttribute:v,normalAttribute:b,morphedPositionAttribute:new a.Float32BufferAttribute(R,3),morphedNormalAttribute:new a.Float32BufferAttribute(L,3)}}const Ye=new a.Vector3,Je=new a.Vector3;function qe(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class Ke{constructor(e,t){(0,Qe.Z)(this,"position",void 0),(0,Qe.Z)(this,"id",void 0),(0,Qe.Z)(this,"faces",void 0),(0,Qe.Z)(this,"neighbors",void 0),(0,Qe.Z)(this,"collapseCost",void 0),(0,Qe.Z)(this,"collapseNeighbor",void 0),(0,Qe.Z)(this,"minCost",0),(0,Qe.Z)(this,"totalCost",0),(0,Qe.Z)(this,"costCount",0),this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}addUniqueNeighbor(e){var t,r;t=this.neighbors,r=e,-1===t.indexOf(r)&&t.push(r)}removeIfNonNeighbor(e){const t=this.neighbors,r=this.faces,n=t.indexOf(e);if(-1!==n){for(let t=0;t<r.length;t++)if(r[t].hasVertex(e))return;t.splice(n,1)}}}class $e{constructor(e,t,r,n,i,o){(0,Qe.Z)(this,"a",void 0),(0,Qe.Z)(this,"b",void 0),(0,Qe.Z)(this,"c",void 0),(0,Qe.Z)(this,"v1",void 0),(0,Qe.Z)(this,"v2",void 0),(0,Qe.Z)(this,"v3",void 0),(0,Qe.Z)(this,"normal",new a.Vector3),this.a=n,this.b=i,this.c=o,this.v1=e,this.v2=t,this.v3=r,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(e),r.addUniqueNeighbor(t)}computeNormal(){const e=this.v1.position,t=this.v2.position,r=this.v3.position;Ye.subVectors(r,t),Je.subVectors(e,t),Ye.cross(Je).normalize(),this.normal.copy(Ye)}hasVertex(e){return e===this.v1||e===this.v2||e===this.v3}replaceVertex(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),qe(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()}}class et{constructor(){(0,Qe.Z)(this,"computeEdgeCollapseCost",((e,t)=>{const r=t.position.distanceTo(e.position);let n=0;const i=[];let o,a,s,l=e.faces.length;for(o=0;o<l;o++)a=e.faces[o],a.hasVertex(t)&&i.push(a);for(o=0;o<l;o++){let t=1;a=e.faces[o];for(let e=0;e<i.length;e++){s=i[e];const r=a.normal.dot(s.normal);t=Math.min(t,(1.001-r)/2)}n=Math.max(n,t)}i.length<2&&(n=1);return r*n+0})),(0,Qe.Z)(this,"computeEdgeCostAtVertex",(e=>{if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(let t=0;t<e.neighbors.length;t++){const r=this.computeEdgeCollapseCost(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=r,e.minCost=r,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=r,r<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=r)}e.collapseCost=e.totalCost/e.costCount})),(0,Qe.Z)(this,"removeFace",((e,t)=>{qe(t,e),e.v1&&qe(e.v1.faces,e),e.v2&&qe(e.v2.faces,e),e.v3&&qe(e.v3.faces,e);const r=[e.v1,e.v2,e.v3];let n,i;for(let o=0;o<3;o++)n=r[o],i=r[(o+1)%3],n&&i&&(n.removeIfNonNeighbor(i),i.removeIfNonNeighbor(n))})),(0,Qe.Z)(this,"collapse",((e,t,r,n)=>{if(!n)return void this.removeVertex(r,e);let i;const o=[];for(i=0;i<r.neighbors.length;i++)o.push(r.neighbors[i]);for(i=r.faces.length-1;i>=0;i--)r.faces[i].hasVertex(n)&&this.removeFace(r.faces[i],t);for(i=r.faces.length-1;i>=0;i--)r.faces[i].replaceVertex(r,n);for(this.removeVertex(r,e),i=0;i<o.length;i++)this.computeEdgeCostAtVertex(o[i])})),(0,Qe.Z)(this,"minimumCostEdge",(e=>{let t=e[0];for(let r=0;r<e.length;r++)e[r].collapseCost<t.collapseCost&&(t=e[r]);return t})),(0,Qe.Z)(this,"modify",((e,t)=>{const r=(e=e.clone()).attributes;for(let a in r)"position"!==a&&e.deleteAttribute(a);const n=[],i=[],o=(e=We(e)).getAttribute("position");for(let f=0;f<o.count;f++){const e=(new a.Vector3).fromBufferAttribute(o,f),t=new Ke(e,f);n.push(t)}const s=e.getIndex();if(null!==s)for(let a=0;a<s.count;a+=3){const e=s.getX(a),t=s.getX(a+1),r=s.getX(a+2),o=new $e(n[e],n[t],n[r],e,t,r);i.push(o)}else for(let a=0;a<o.count;a+=3){const e=a,t=a+1,r=a+2,o=new $e(n[e],n[t],n[r],e,t,r);i.push(o)}for(let a=0,f=n.length;a<f;a++)this.computeEdgeCostAtVertex(n[a]);let l,c=t;for(;c--;){if(l=this.minimumCostEdge(n),!l){console.log("THREE.SimplifyModifier: No next vertex");break}this.collapse(n,i,l,l.collapseNeighbor)}const u=new a.BufferGeometry,h=[];let d=[];for(let a=0;a<n.length;a++){const e=n[a].position;h.push(e.x,e.y,e.z)}for(let a=0;a<i.length;a++){const e=i[a],t=n.indexOf(e.v1),r=n.indexOf(e.v2),o=n.indexOf(e.v3);d.push(t,r,o)}return u.setAttribute("position",new a.Float32BufferAttribute(h,3)),u.setIndex(d),u}))}removeVertex(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){qe(e.neighbors.pop().neighbors,e)}qe(t,e)}}class tt{constructor(){(0,Qe.Z)(this,"A",new a.Vector3),(0,Qe.Z)(this,"B",new a.Vector3),(0,Qe.Z)(this,"C",new a.Vector3),(0,Qe.Z)(this,"positions",[]),(0,Qe.Z)(this,"normals",new Float32Array),(0,Qe.Z)(this,"indexes",[]),(0,Qe.Z)(this,"pointToIndexMap",[]),(0,Qe.Z)(this,"splitIndexes",[]),(0,Qe.Z)(this,"oldNormals",[]),(0,Qe.Z)(this,"computeNormals",(()=>{this.normals=new Float32Array(3*this.indexes.length);for(let e=0;e<this.indexes.length;e+=3){let t=this.indexes[e];this.A.set(this.positions[3*t],this.positions[3*t+1],this.positions[3*t+2]),t=this.indexes[e+1],this.B.set(this.positions[3*t],this.positions[3*t+1],this.positions[3*t+2]),t=this.indexes[e+2],this.C.set(this.positions[3*t],this.positions[3*t+1],this.positions[3*t+2]),this.C.sub(this.B),this.A.sub(this.B);const r=this.C.cross(this.A).normalize();for(let n=0;n<3;n++)this.normals[3*(e+n)]=r.x,this.normals[3*(e+n)+1]=r.y,this.normals[3*(e+n)+2]=r.z}})),(0,Qe.Z)(this,"mapPositionsToIndexes",(()=>{this.pointToIndexMap=Array(this.positions.length/3);for(let e=0;e<this.indexes.length;e++){const t=this.indexes[e];null==this.pointToIndexMap[t]&&(this.pointToIndexMap[t]=[]),this.pointToIndexMap[t].push(e)}})),(0,Qe.Z)(this,"edgeSplitToGroups",((e,t,r)=>{this.A.set(this.normals[3*r],this.normals[3*r+1],this.normals[3*r+2]).normalize();const n={splitGroup:[],currentGroup:[r]};for(let i of e)i!==r&&(this.B.set(this.normals[3*i],this.normals[3*i+1],this.normals[3*i+2]).normalize(),this.B.dot(this.A)<t?n.splitGroup.push(i):n.currentGroup.push(i));return n})),(0,Qe.Z)(this,"edgeSplit",((e,t,r=null)=>{if(0===e.length)return;const n=[];for(let o of e)n.push(this.edgeSplitToGroups(e,t,o));let i=n[0];for(let o of n)o.currentGroup.length>i.currentGroup.length&&(i=o);null!=r&&this.splitIndexes.push({original:r,indexes:i.currentGroup}),i.splitGroup.length&&this.edgeSplit(i.splitGroup,t,r||i.currentGroup[0])})),(0,Qe.Z)(this,"modify",((e,t,r=!0)=>{let i=!1;if(e.attributes.normal&&(i=!0,e=e.clone(),!0===r&&null!==e.index&&(this.oldNormals=e.attributes.normal.array),e.deleteAttribute("normal")),null==e.index){if(void 0===n)throw"THREE.EdgeSplitModifier relies on BufferGeometryUtils";e=We(e)}this.indexes=e.index.array,this.positions=e.getAttribute("position").array,this.computeNormals(),this.mapPositionsToIndexes(),this.splitIndexes=[];for(let n of this.pointToIndexMap)this.edgeSplit(n,Math.cos(t)-.001);const o={};for(let n of Object.keys(e.attributes)){const t=e.attributes[n],r=new t.array.constructor((this.indexes.length+this.splitIndexes.length)*t.itemSize);r.set(t.array),o[n]=new a.BufferAttribute(r,t.itemSize,t.normalized)}const s=new Uint32Array(this.indexes.length);s.set(this.indexes);for(let n=0;n<this.splitIndexes.length;n++){const e=this.splitIndexes[n],t=this.indexes[e.original];for(let r of Object.values(o))for(let e=0;e<r.itemSize;e++)r.array[(this.indexes.length+n)*r.itemSize+e]=r.array[t*r.itemSize+e];for(let r of e.indexes)s[r]=this.indexes.length+n}(e=new a.BufferGeometry).setIndex(new a.BufferAttribute(s,1));for(let n of Object.keys(o))e.setAttribute(n,o[n]);if(i&&(e.computeVertexNormals(),null!==this.oldNormals)){const t=new Array(this.oldNormals.length/3).fill(!1);for(let e of this.splitIndexes)t[e.original]=!0;for(let r=0;r<t.length;r++)if(!1===t[r])for(let t=0;t<3;t++)e.attributes.normal.array[3*r+t]=this.oldNormals[3*r+t]}return e}))}}class rt{constructor(e=.1,t=6){(0,Qe.Z)(this,"maxEdgeLength",void 0),(0,Qe.Z)(this,"maxIterations",void 0),(0,Qe.Z)(this,"modify",(e=>{null!==e.index&&(e=e.toNonIndexed());const t=this.maxIterations,r=this.maxEdgeLength*this.maxEdgeLength,n=new a.Vector3,i=new a.Vector3,o=new a.Vector3,s=new a.Vector3,l=[n,i,o,s],c=new a.Vector3,u=new a.Vector3,h=new a.Vector3,d=new a.Vector3,f=[c,u,h,d],p=new a.Color,m=new a.Color,g=new a.Color,A=new a.Color,v=[p,m,g,A],y=new a.Vector2,x=new a.Vector2,b=new a.Vector2,w=new a.Vector2,C=[y,x,b,w],E=new a.Vector2,S=new a.Vector2,T=new a.Vector2,M=new a.Vector2,I=[E,S,T,M],B=e.attributes,_=void 0!==B.normal,F=void 0!==B.color,P=void 0!==B.uv,R=void 0!==B.uv2;let L=B.position.array,D=_?B.normal.array:null,N=F?B.color.array:null,k=P?B.uv.array:null,O=R?B.uv2.array:null,U=L,Q=D,V=N,G=k,z=O,j=0,H=!0;function W(e,t,r){const n=l[e],i=l[t],o=l[r];if(U.push(n.x,n.y,n.z),U.push(i.x,i.y,i.z),U.push(o.x,o.y,o.z),_){const n=f[e],i=f[t],o=f[r];Q.push(n.x,n.y,n.z),Q.push(i.x,i.y,i.z),Q.push(o.x,o.y,o.z)}if(F){const n=v[e],i=v[t],o=v[r];V.push(n.r,n.g,n.b),V.push(i.r,i.g,i.b),V.push(o.r,o.g,o.b)}if(P){const n=C[e],i=C[t],o=C[r];G.push(n.x,n.y),G.push(i.x,i.y),G.push(o.x,o.y)}if(R){const n=I[e],i=I[t],o=I[r];z.push(n.x,n.y),z.push(i.x,i.y),z.push(o.x,o.y)}}for(;H&&j<t;){j++,H=!1,L=U,U=[],_&&(D=Q,Q=[]),F&&(N=V,V=[]),P&&(k=G,G=[]),R&&(O=z,z=[]);for(let e=0,t=0,a=L.length;e<a;e+=9,t+=6){n.fromArray(L,e+0),i.fromArray(L,e+3),o.fromArray(L,e+6),_&&D&&(c.fromArray(D,e+0),u.fromArray(D,e+3),h.fromArray(D,e+6)),F&&N&&(p.fromArray(N,e+0),m.fromArray(N,e+3),g.fromArray(N,e+6)),P&&k&&(y.fromArray(k,t+0),x.fromArray(k,t+2),b.fromArray(k,t+4)),R&&O&&(E.fromArray(O,t+0),S.fromArray(O,t+2),T.fromArray(O,t+4));const a=n.distanceToSquared(i),l=i.distanceToSquared(o),f=n.distanceToSquared(o);a>r||l>r||f>r?(H=!0,a>=l&&a>=f?(s.lerpVectors(n,i,.5),_&&d.lerpVectors(c,u,.5),F&&A.lerpColors(p,m,.5),P&&w.lerpVectors(y,x,.5),R&&M.lerpVectors(E,S,.5),W(0,3,2),W(3,1,2)):l>=a&&l>=f?(s.lerpVectors(i,o,.5),_&&d.lerpVectors(u,h,.5),F&&A.lerpColors(m,g,.5),P&&w.lerpVectors(x,b,.5),R&&M.lerpVectors(S,T,.5),W(0,1,3),W(3,2,0)):(s.lerpVectors(n,o,.5),_&&d.lerpVectors(c,h,.5),F&&A.lerpColors(p,g,.5),P&&w.lerpVectors(y,b,.5),R&&M.lerpVectors(E,T,.5),W(0,1,3),W(3,1,2))):W(0,1,2)}}const Z=new a.BufferGeometry;return Z.setAttribute("position",new a.Float32BufferAttribute(U,3)),_&&Z.setAttribute("normal",new a.Float32BufferAttribute(Q,3)),F&&Z.setAttribute("color",new a.Float32BufferAttribute(V,3)),P&&Z.setAttribute("uv",new a.Float32BufferAttribute(G,2)),R&&Z.setAttribute("uv2",new a.Float32BufferAttribute(z,2)),Z})),this.maxEdgeLength=e,this.maxIterations=t}}function nt(e){this.uuid=a.MathUtils.generateUUID(),this.name="",this.type=e,this.userData={}}function it(e,t){nt.call(this,e),t=t||{},this.shared=void 0===t.shared||t.shared,this.unique=void 0!==t.unique&&t.unique}function ot(e,t){(t=t||{}).shared=void 0!==t.shared&&t.shared,it.call(this,e,t),this.readonly=!1}function at(e){ot.call(this,"f"),this.value=e||0}nt.prototype={constructor:nt,isNode:!0,hashProperties:void 0,analyze:function(e,t){t=t||{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1},analyzeAndFlow:function(e,t,r){return r=r||{},this.analyze(e,r),this.flow(e,t,r)},flow:function(e,t,r){r=r||{},e.addFlow(r.slot,r.cache,r.context);var n={};return n.result=this.build(e,t),n.code=e.clearNodeCode(),n.extra=e.context.extra,e.removeFlow(),n},build:function(e,t,r){t=t||this.getType(e,t);var n=e.getNodeData(r||this);return e.analyzing&&this.appendDepsNode(e,n,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,r)},generate:function(){},getHash:function(){var e,t,r="{";for(e in this)(t=this[e])instanceof nt&&(r+='"'+e+'":'+t.getHash()+",");if(this.hashProperties)for(let n=0;n<this.hashProperties.length;n++)t=this[e=this.hashProperties[n]],r+='"'+e+'":"'+String(t)+'",';return r+='"id":"'+this.uuid+'"}'},appendDepsNode:function(e,t,r){t.deps=(t.deps||0)+1;var n=e.getTypeLength(r);(n>(t.outputMax||0)||this.getType(e,r))&&(t.outputMax=n,t.output=r)},setName:function(e){return this.name=e,this},getName:function(){return this.name},getType:function(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type},getJSONNode:function(e){if(!(void 0===e||"string"===typeof e)&&void 0!==e.nodes[this.uuid])return e.nodes[this.uuid]},copy:function(e){return void 0!==e.name&&(this.name=e.name),void 0!==e.userData&&(this.userData=JSON.parse(JSON.stringify(e.userData))),this},createJSONNode:function(e){var t=void 0===e||"string"===typeof e,r={};if("string"!==typeof this.nodeType)throw new Error("Node does not allow serialization.");return r.uuid=this.uuid,r.nodeType=this.nodeType,""!==this.name&&(r.name=this.name),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t||(e.nodes[this.uuid]=r),r},toJSON:function(e){return this.getJSONNode(e)||this.createJSONNode(e)}},it.prototype=Object.create(nt.prototype),it.prototype.constructor=it,it.prototype.build=function(e,t,r,n){if(t=t||this.getType(e),this.getShared(e,t)){var i=this.getUnique(e,t);i&&void 0===this.constructor.uuid&&(this.constructor.uuid=a.MathUtils.generateUUID()),r=e.getUuid(r||this.getUuid(),!i);var o=e.getNodeData(r),s=o.output||this.getType(e);if(e.analyzing)return(o.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,o,t),this.generate(e,t,r)):nt.prototype.build.call(this,e,t,r);if(i)return o.name=o.name||nt.prototype.build.call(this,e,t,r),o.name;if(!this.getLabel()&&(!this.getShared(e,s)||e.context.ignoreCache||1===o.deps))return nt.prototype.build.call(this,e,t,r);r=this.getUuid(!1);var l=this.getTemp(e,r);if(l)return e.format(l,s,t);l=it.prototype.generate.call(this,e,t,r,o.output,n);var c=this.generate(e,s,r);return e.addNodeCode(l+" = "+c+";"),e.format(l,s,t)}return nt.prototype.build.call(this,e,t,r)},it.prototype.getShared=function(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared},it.prototype.getUnique=function(){return this.unique},it.prototype.setLabel=function(e){return this.label=e,this},it.prototype.getLabel=function(){return this.label},it.prototype.getUuid=function(e){var t=(e||void 0==e)&&this.constructor.uuid||this.uuid;return"string"===typeof this.scope&&(t=this.scope+"-"+t),t},it.prototype.getTemp=function(e,t){t=t||this.uuid;var r=e.getVars()[t];return r?r.name:void 0},it.prototype.generate=function(e,t,r,n,i){return this.getShared(e,t)||console.error("THREE.TempNode is not shared!"),r=r||this.uuid,e.getTempVar(r,n||this.getType(e),i,this.getLabel()).name},ot.prototype=Object.create(it.prototype),ot.prototype.constructor=ot,ot.prototype.setReadonly=function(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this},ot.prototype.getReadonly=function(){return this.readonly},ot.prototype.copy=function(e){return it.prototype.copy.call(this,e),void 0!==e.readonly&&(this.readonly=e.readonly),this},ot.prototype.createJSONNode=function(e){var t=it.prototype.createJSONNode.call(this,e);return!0===this.readonly&&(t.readonly=this.readonly),t},ot.prototype.generate=function(e,t,r,n,i,o){r=e.getUuid(r||this.getUuid()),n=n||this.getType(e);var a=e.getNodeData(r);return this.getReadonly(e)&&void 0!==this.generateReadonly?this.generateReadonly(e,t,r,n,i,o):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(n,this,i,o,this.getLabel())),e.format(a.vertex.name,n,t)):(a.fragment||(a.fragment=e.createFragmentUniform(n,this,i,o,this.getLabel())),e.format(a.fragment.name,n,t))},at.prototype=Object.create(ot.prototype),at.prototype.constructor=at,at.prototype.nodeType="Float",at.prototype.generateReadonly=function(e,t,r,n){return e.format(this.value+(this.value%1?"":".0"),n,t)},at.prototype.copy=function(e){return ot.prototype.copy.call(this,e),this.value=e.value,this},at.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t};var st=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i;function lt(e,t){it.call(this),this.parse(e||lt.PI,t)}lt.PI="PI",lt.PI2="PI2",lt.RECIPROCAL_PI="RECIPROCAL_PI",lt.RECIPROCAL_PI2="RECIPROCAL_PI2",lt.LOG2="LOG2",lt.EPSILON="EPSILON",lt.prototype=Object.create(it.prototype),lt.prototype.constructor=lt,lt.prototype.nodeType="Const",lt.prototype.getType=function(e){return e.getTypeByFormat(this.type)},lt.prototype.parse=function(e,t){this.src=e||"";var r,n,i="",o=this.src.match(st);this.useDefine=t||"#"===this.src.charAt(0),o&&o.length>1?(n=o[1],r=o[2],i=o[3]):(r=this.src,n="f"),this.name=r,this.type=n,this.value=i},lt.prototype.build=function(e,t){return"source"!==t?(e.include(this),e.format(this.name,this.getType(e),t)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":this.useDefine?this.src:void 0},lt.prototype.generate=function(e,t){return e.format(this.name,this.getType(e),t)},lt.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.parse(e.src,e.useDefine),this},lt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).src=this.src,!0===t.useDefine&&(t.useDefine=!0)),t};var ct=/^struct\s*([a-z_0-9]+)\s*{\s*((.|\n)*?)}/gim,ut=/\s*(\w*?)\s*(\w*?)(\=|\;)/gim;function ht(e){it.call(this),this.parse(e)}ht.prototype=Object.create(it.prototype),ht.prototype.constructor=ht,ht.prototype.nodeType="Struct",ht.prototype.getType=function(e){return e.getTypeByFormat(this.name)},ht.prototype.getInputByName=function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]},ht.prototype.generate=function(e,t){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)},ht.prototype.parse=function(e){this.src=e||"",this.inputs=[];var t=ct.exec(this.src);if(t){for(var r,n=t[2];r=ut.exec(n);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name},ht.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).src=this.src),t};var dt={nodes:{},keywords:{},add:function(e){this.nodes[e.name]=e},addKeyword:function(e,t,r){r=void 0===r||r,this.keywords[e]={callback:t,cache:r}},remove:function(e){delete this.nodes[e.name]},removeKeyword:function(e){delete this.keywords[e]},get:function(e){return this.nodes[e]},getKeyword:function(e,t){return this.keywords[e].callback.call(this,t)},getKeywordData:function(e){return this.keywords[e]},contains:function(e){return void 0!==this.nodes[e]},containsKeyword:function(e){return void 0!==this.keywords[e]}},ft=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,pt=/[a-z_0-9]+/gi;function mt(e,t,r,n,i){this.isMethod=void 0===i,this.isInterface=!1,it.call(this,i),this.parse(e,t,r,n)}function gt(e,t){it.call(this),this.setFunction(e,t)}function At(e,t,r,n,i){mt.call(this,e,i,n,r,t)}function vt(e,t,r){it.call(this),this.a=e,this.b=t,this.op=r}function yt(e,t,r,n){it.call(this),this.a=e,"string"!==typeof t?this.b=t:n=t,"string"!==typeof r?this.c=r:n=r,this.method=n}function xt(e,t){it.call(this,"v4"),this.input=e,this.method=t||xt.LINEAR_TO_LINEAR}function bt(e,t,r){it.call(this,"v4"),this.value=e,this.uv=t,this.bias=r}function wt(e){it.call(this,"v3"),this.scope=e||wt.LOCAL}function Ct(e){it.call(this,"v3"),this.scope=e||Ct.VIEW}function Et(e){it.call(this,"v3"),this.scope=e||Et.CUBE}function St(e,t,r){it.call(this,"v4"),this.value=e,this.radianceNode=new bt(this.value,t||new Et(Et.VECTOR),r),this.irradianceNode=new bt(this.value,new Ct(Ct.WORLD),new at(1).setReadonly(!0))}mt.prototype=Object.create(it.prototype),mt.prototype.constructor=mt,mt.prototype.nodeType="Function",mt.prototype.useKeywords=!0,mt.prototype.getShared=function(){return!this.isMethod},mt.prototype.getType=function(e){return e.getTypeByFormat(this.type)},mt.prototype.getInputByName=function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]},mt.prototype.getIncludeByName=function(e){for(var t=this.includes.length;t--;)if(this.includes[t].name===e)return this.includes[t]},mt.prototype.generate=function(e,t){var r=0,n=this.src;for(let h=0;h<this.includes.length;h++)e.include(this.includes[h],this);for(let h in this.extensions)e.extensions[h]=!0;for(var i=[];o=pt.exec(this.src);)i.push(o);for(let h=0;h<i.length;h++){var o,a=(o=i[h])[0],s=!this.isMethod||!this.getInputByName(a),l=a;if(this.keywords[a]||this.useKeywords&&s&&dt.containsKeyword(a)){var c=this.keywords[a];if(!c){var u=dt.getKeywordData(a);u.cache&&(c=e.keywords[a]),c=c||dt.getKeyword(a,e),u.cache&&(e.keywords[a]=c)}l=c.build(e)}a!==l&&(n=n.substring(0,o.index+r)+l+n.substring(o.index+a.length+r),r+=l.length-a.length),void 0===this.getIncludeByName(l)&&dt.contains(l)&&e.include(dt.get(l))}return"source"===t?n:this.isMethod?(this.isInterface||e.include(this,!1,n),this.name):e.format("( "+n+" )",this.getType(e),t)},mt.prototype.parse=function(e,t,r,n){if(this.src=e||"",this.includes=t||[],this.extensions=r||{},this.keywords=n||{},this.isMethod){var i=this.src.match(ft);if(this.inputs=[],i&&4==i.length){this.type=i[1],this.name=i[2];var o=i[3].match(pt);if(o)for(var a=0;a<o.length;){var s,l,c=o[a++];"in"===c||"out"===c||"inout"===c?s=o[a++]:(s=c,c=""),l=o[a++],this.inputs.push({name:l,type:s,qualifier:c})}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}},mt.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.isMethod=e.isMethod,this.useKeywords=e.useKeywords,this.parse(e.src,e.includes,e.extensions,e.keywords),void 0!==e.type&&(this.type=e.type),this},mt.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){(t=this.createJSONNode(e)).src=this.src,t.isMethod=this.isMethod,t.useKeywords=this.useKeywords,this.isMethod||(t.type=this.type),t.extensions=JSON.parse(JSON.stringify(this.extensions)),t.keywords={};for(let r in this.keywords)t.keywords[r]=this.keywords[r].toJSON(e).uuid;if(this.includes.length){t.includes=[];for(let r=0;r<this.includes.length;r++)t.includes.push(this.includes[r].toJSON(e).uuid)}}return t},gt.prototype=Object.create(it.prototype),gt.prototype.constructor=gt,gt.prototype.nodeType="FunctionCall",gt.prototype.setFunction=function(e,t){this.value=e,this.inputs=t||[]},gt.prototype.getFunction=function(){return this.value},gt.prototype.getType=function(e){return this.value.getType(e)},gt.prototype.generate=function(e,t){var r=this.getType(e),n=this.value,i=n.build(e,t)+"( ",o=[];for(let l=0;l<n.inputs.length;l++){var a=n.inputs[l],s=this.inputs[l]||this.inputs[a.name];o.push(s.build(e,e.getTypeByFormat(a.type)))}return i+=o.join(", ")+" )",e.format(i,r,t)},gt.prototype.copy=function(e){it.prototype.copy.call(this,e);for(let t in e.inputs)this.inputs[t]=e.inputs[t];return this.value=e.value,this},gt.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){var r=this.value;if((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,r.inputs.length){t.inputs={};for(let o=0;o<r.inputs.length;o++){var n=r.inputs[o],i=this.inputs[o]||this.inputs[n.name];t.inputs[n.name]=i.toJSON(e).uuid}}}return t},At.prototype=Object.create(mt.prototype),At.prototype.constructor=At,At.prototype.nodeType="Expression",vt.ADD="+",vt.SUB="-",vt.MUL="*",vt.DIV="/",vt.prototype=Object.create(it.prototype),vt.prototype.constructor=vt,vt.prototype.nodeType="Operator",vt.prototype.getType=function(e){var t=this.a.getType(e),r=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(r)>e.getTypeLength(t)?r:t},vt.prototype.generate=function(e,t){var r=this.getType(e),n=this.a.build(e,r),i=this.b.build(e,r);return e.format("( "+n+" "+this.op+" "+i+" )",r,t)},vt.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.op=e.op,this},vt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.op=this.op),t},yt.RAD="radians",yt.DEG="degrees",yt.EXP="exp",yt.EXP2="exp2",yt.LOG="log",yt.LOG2="log2",yt.SQRT="sqrt",yt.INV_SQRT="inversesqrt",yt.FLOOR="floor",yt.CEIL="ceil",yt.NORMALIZE="normalize",yt.FRACT="fract",yt.SATURATE="saturate",yt.SIN="sin",yt.COS="cos",yt.TAN="tan",yt.ASIN="asin",yt.ACOS="acos",yt.ARCTAN="atan",yt.ABS="abs",yt.SIGN="sign",yt.LENGTH="length",yt.NEGATE="negate",yt.INVERT="invert",yt.MIN="min",yt.MAX="max",yt.MOD="mod",yt.STEP="step",yt.REFLECT="reflect",yt.DISTANCE="distance",yt.DOT="dot",yt.CROSS="cross",yt.POW="pow",yt.MIX="mix",yt.CLAMP="clamp",yt.REFRACT="refract",yt.SMOOTHSTEP="smoothstep",yt.FACEFORWARD="faceforward",yt.prototype=Object.create(it.prototype),yt.prototype.constructor=yt,yt.prototype.nodeType="Math",yt.prototype.hashProperties=["method"],yt.prototype.getNumInputs=function(){switch(this.method){case yt.MIX:case yt.CLAMP:case yt.REFRACT:case yt.SMOOTHSTEP:case yt.FACEFORWARD:return 3;case yt.MIN:case yt.MAX:case yt.MOD:case yt.STEP:case yt.REFLECT:case yt.DISTANCE:case yt.DOT:case yt.CROSS:case yt.POW:return 2;default:return 1}},yt.prototype.getInputType=function(e){var t=e.getTypeLength(this.a.getType(e)),r=this.b?e.getTypeLength(this.b.getType(e)):0,n=this.c?e.getTypeLength(this.c.getType(e)):0;return t>r&&t>n?this.a.getType(e):r>n?this.b.getType(e):this.c.getType(e)},yt.prototype.getType=function(e){switch(this.method){case yt.LENGTH:case yt.DISTANCE:case yt.DOT:return"f";case yt.CROSS:return"v3"}return this.getInputType(e)},yt.prototype.generate=function(e,t){var r,n,i,o=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,s=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.method){case yt.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case yt.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case yt.CROSS:r=this.a.build(e,"v3"),n=this.b.build(e,"v3");break;case yt.STEP:r=this.a.build(e,1===o?"f":l),n=this.b.build(e,l);break;case yt.MIN:case yt.MAX:case yt.MOD:r=this.a.build(e,l),n=this.b.build(e,1===a?"f":l);break;case yt.REFRACT:r=this.a.build(e,l),n=this.b.build(e,l),i=this.c.build(e,"f");break;case yt.MIX:r=this.a.build(e,l),n=this.b.build(e,l),i=this.c.build(e,1===s?"f":l);break;default:r=this.a.build(e,l),this.b&&(n=this.b.build(e,l)),this.c&&(i=this.c.build(e,l))}var u=[];u.push(r),n&&u.push(n),i&&u.push(i);var h=this.getNumInputs(e);if(u.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${u.length}.`);return e.format(this.method+"( "+u.join(", ")+" )",c,t)},yt.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.c=e.c,this.method=e.method,this},yt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,this.b&&(t.b=this.b.toJSON(e).uuid),this.c&&(t.c=this.c.toJSON(e).uuid),t.method=this.method),t},xt.Nodes=function(){var e=new mt(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),t=new mt(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),r=new mt(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n")),n=new lt("const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );"),i=new mt(["vec4 LinearToLogLuv( in vec4 value ) {","\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;","\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));","\tvec4 vResult;","\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;","\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;","\tvResult.w = fract(Le);","\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;","\treturn vResult;","}"].join("\n"),[n]),o=new lt("const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );");return{LinearToLinear:e,sRGBToLinear:t,LinearTosRGB:r,cLogLuvM:n,LinearToLogLuv:i,cLogLuvInverseM:o,LogLuvToLinear:new mt(["vec4 LogLuvToLinear( in vec4 value ) {","\tfloat Le = value.z * 255.0 + value.w;","\tvec3 Xp_Y_XYZp;","\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);","\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;","\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;","\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;","\treturn vec4( max(vRGB, 0.0), 1.0 );","}"].join("\n"),[o])}}(),xt.LINEAR_TO_LINEAR="LinearToLinear",xt.SRGB_TO_LINEAR="sRGBToLinear",xt.LINEAR_TO_SRGB="LinearTosRGB",xt.RGBE_TO_LINEAR="RGBEToLinear",xt.LINEAR_TO_RGBE="LinearToRGBE",xt.LINEAR_TO_LOG_LUV="LinearToLogLuv",xt.LOG_LUV_TO_LINEAR="LogLuvToLinear",xt.getEncodingComponents=function(e){switch(e){case a.LinearEncoding:return["Linear"];case a.sRGBEncoding:return["sRGB"]}},xt.prototype=Object.create(it.prototype),xt.prototype.constructor=xt,xt.prototype.nodeType="ColorSpace",xt.prototype.hashProperties=["method"],xt.prototype.generate=function(e,t){var r=this.input.build(e,"v4"),n=this.getType(e),i=xt.Nodes[this.method],o=e.include(i);if(o===xt.LINEAR_TO_LINEAR)return e.format(r,n,t);if(2===i.inputs.length){var a=this.factor.build(e,"f");return e.format(o+"( "+r+", "+a+" )",n,t)}return e.format(o+"( "+r+" )",n,t)},xt.prototype.fromEncoding=function(e){var t=xt.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]},xt.prototype.fromDecoding=function(e){var t=xt.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]},xt.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.input=e.input,this.method=e.method,this},xt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).input=this.input.toJSON(e).uuid,t.method=this.method),t},bt.Nodes=function(){var e=new ht("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),t=new lt("float cubeUV_maxMipLevel 8.0",!0),r=new lt("float cubeUV_minMipLevel 4.0",!0),n=new lt("float cubeUV_maxTileSize 256.0",!0),i=new lt("float cubeUV_minTileSize 16.0",!0),o=new mt("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");o.useKeywords=!1;var a=new mt("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");a.useKeywords=!1;var s=new mt("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[e,o,a,t,r,n,i]);s.useKeywords=!1;var l=new lt("float r0 1.0",!0),c=new lt("float v0 0.339",!0),u=new lt("float m0 -2.0",!0);return{bilinearCubeUV:s,roughnessToMip:new mt("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[l,c,u,new lt("float r1 0.8",!0),new lt("float v1 0.276",!0),new lt("float m1 -1.0",!0),new lt("float r4 0.4",!0),new lt("float v4 0.046",!0),new lt("float m4 2.0",!0),new lt("float r5 0.305",!0),new lt("float v5 0.016",!0),new lt("float m5 3.0",!0),new lt("float r6 0.21",!0),new lt("float v6 0.0038",!0),new lt("float m6 4.0",!0)]),m0:u,cubeUV_maxMipLevel:t}}(),bt.prototype=Object.create(it.prototype),bt.prototype.constructor=bt,bt.prototype.nodeType="TextureCubeUV",bt.prototype.bilinearCubeUV=function(e,t,r,n){var i=new gt(bt.Nodes.bilinearCubeUV,[t,r,n]);this.colorSpaceTL=this.colorSpaceTL||new xt(new At("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(i.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR||new xt(new At("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(i.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL||new xt(new At("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(i.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR||new xt(new At("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(i.build(e)+".br");var o={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(o),this.colorSpaceTLExp=new At(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new At(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new At(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new At(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();var a=new At("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=i,a},bt.prototype.generate=function(e,t){if(e.isShader("fragment")){var r=this.uv,n=this.bias||e.context.roughness,i=new yt(new gt(bt.Nodes.roughnessToMip,[n]),bt.Nodes.m0,bt.Nodes.cubeUV_maxMipLevel,yt.CLAMP),o=new yt(i,yt.FLOOR),a=new yt(i,yt.FRACT),s=new yt(this.bilinearCubeUV(e,this.value,r,o),this.bilinearCubeUV(e,this.value,r,new vt(o,new at(1).setReadonly(!0),vt.ADD)),a,yt.MIX);return e.format(s.build(e),"v4",t)}return console.warn("THREE.TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)},bt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.uv=this.uv.toJSON(e).uuid,t.bias=this.bias.toJSON(e).uuid),t},wt.LOCAL="local",wt.WORLD="world",wt.VIEW="view",wt.PROJECTION="projection",wt.prototype=Object.create(it.prototype),wt.prototype.constructor=wt,wt.prototype.nodeType="Position",wt.prototype.getType=function(){switch(this.scope){case wt.PROJECTION:return"v4"}return this.type},wt.prototype.getShared=function(){switch(this.scope){case wt.LOCAL:case wt.WORLD:return!1}return!0},wt.prototype.generate=function(e,t){var r;switch(this.scope){case wt.LOCAL:e.isShader("vertex")?r="transformed":(e.requires.position=!0,r="vPosition");break;case wt.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,r="vWPosition";break;case wt.VIEW:r=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case wt.PROJECTION:r=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(r,this.getType(e),t)},wt.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.scope=e.scope,this},wt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},dt.addKeyword("position",(function(){return new wt})),dt.addKeyword("worldPosition",(function(){return new wt(wt.WORLD)})),dt.addKeyword("viewPosition",(function(){return new wt(wt.VIEW)})),Ct.LOCAL="local",Ct.WORLD="world",Ct.VIEW="view",Ct.prototype=Object.create(it.prototype),Ct.prototype.constructor=Ct,Ct.prototype.nodeType="Normal",Ct.prototype.getShared=function(){return this.scope===Ct.WORLD},Ct.prototype.build=function(e,t,r,n){var i=e.context[this.scope+"Normal"];return i?i.build(e,t,r,n):it.prototype.build.call(this,e,t,r)},Ct.prototype.generate=function(e,t){var r;switch(this.scope){case Ct.VIEW:r=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case Ct.LOCAL:e.isShader("vertex")?r="objectNormal":(e.requires.normal=!0,r="vObjectNormal");break;case Ct.WORLD:e.isShader("vertex")?r="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,r="vWNormal")}return e.format(r,this.getType(e),t)},Ct.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.scope=e.scope,this},Ct.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},dt.addKeyword("viewNormal",(function(){return new Ct(Ct.VIEW)})),dt.addKeyword("localNormal",(function(){return new Ct(Ct.NORMAL)})),dt.addKeyword("worldNormal",(function(){return new Ct(Ct.WORLD)})),Et.CUBE="cube",Et.SPHERE="sphere",Et.VECTOR="vector",Et.prototype=Object.create(it.prototype),Et.prototype.constructor=Et,Et.prototype.nodeType="Reflect",Et.prototype.getUnique=function(e){return!e.context.viewNormal},Et.prototype.getType=function(){switch(this.scope){case Et.SPHERE:return"v2"}return this.type},Et.prototype.generate=function(e,t){var r=this.getUnique(e);if(e.isShader("fragment")){var n;switch(this.scope){case Et.VECTOR:var i=new Ct(Ct.VIEW),o=e.context.roughness,a=i.build(e,"v3"),s=new wt(wt.VIEW).build(e,"v3"),l=o?o.build(e,"f"):void 0,c=`reflect( -normalize( ${s} ), ${a} )`;l&&(c=`normalize( mix( ${c}, ${a}, ${l} * ${l} ) )`);var u=`inverseTransformDirection( ${c}, viewMatrix )`;r?(e.addNodeCode(`vec3 reflectVec = ${u};`),n="reflectVec"):n=u;break;case Et.CUBE:u="vec3( -"+(h=new Et(Et.VECTOR).build(e,"v3"))+".x, "+h+".yz )";r?(e.addNodeCode(`vec3 reflectCubeVec = ${u};`),n="reflectCubeVec"):n=u;break;case Et.SPHERE:var h;u="normalize( ( viewMatrix * vec4( "+(h=new Et(Et.VECTOR).build(e,"v3"))+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";r?(e.addNodeCode(`vec2 reflectSphereVec = ${u};`),n="reflectSphereVec"):n=u}return e.format(n,this.getType(e),t)}return console.warn("THREE.ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)},Et.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},St.prototype=Object.create(it.prototype),St.prototype.constructor=St,St.prototype.nodeType="TextureCube",St.prototype.generate=function(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("THREE.TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))},St.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.value=e.value,this},St.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid),t};var Tt={elements:["x","y","z","w"],addShortcuts:function(){function e(e,t,r){return r?{get:function(){return this[e][t][r]},set:function(n){this[e][t][r]=n}}:{get:function(){return this[e][t]},set:function(r){this[e][t]=r}}}return function(t,r,n){var i={};for(let l=0;l<n.length;++l){var o=n[l].split("."),a=o[0],s=o[1];i[a]=e(r,a,s)}Object.defineProperties(t,i)}}()};function Mt(e,t){ot.call(this,"v2"),this.value=e instanceof a.Vector2?e:new a.Vector2(e,t)}function It(e){it.call(this,"v2",{shared:!1}),this.index=e||0}function Bt(e,t){it.call(this,"v3"),this.value=e,this.scale=t||new Mt(1,1)}function _t(e,t){it.call(this,"v3"),this.value=e,this.scale=t||new at(1),this.toNormalMap=!1}function Ft(e,t,r){ot.call(this,"c"),this.value=e instanceof a.Color?e:new a.Color(e||0,t,r)}function Pt(e){at.call(this),this.texture=e,this.maxMIPLevel=0}function Rt(e,t){it.call(this,"f"),this.roughness=e,this.texture=t,this.maxMIPLevel=void 0}function Lt(){nt.call(this),this.color=new Ft(16777215),this.roughness=new at(1),this.metalness=new at(0)}function Dt(e){e=e||{},this.name=e.name,this.type=e.type,this.node=e.node,this.needsUpdate=e.needsUpdate}function Nt(e,t,r){ot.call(this,"v3"),this.value=e instanceof a.Vector3?e:new a.Vector3(e,t,r)}function kt(e,t,r,n){ot.call(this,"v4"),this.value=e instanceof a.Vector4?e:new a.Vector4(e,t,r,n)}function Ot(e,t,r,n){ot.call(this,"v4",{shared:!0}),this.value=e,this.uv=t||new It,this.bias=r,this.project=void 0!==n&&n}function Ut(e,t,r){ot.call(this,"v4",{shared:!0}),this.value=e,this.uv=t||new Et,this.bias=r}Mt.prototype=Object.create(ot.prototype),Mt.prototype.constructor=Mt,Mt.prototype.nodeType="Vector2",Tt.addShortcuts(Mt.prototype,"value",["x","y"]),Mt.prototype.generateReadonly=function(e,t,r,n){return e.format("vec2( "+this.x+", "+this.y+" )",n,t)},Mt.prototype.copy=function(e){return ot.prototype.copy.call(this,e),this.value.copy(e),this},Mt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,!0===this.readonly&&(t.readonly=!0)),t},It.prototype=Object.create(it.prototype),It.prototype.constructor=It,It.prototype.nodeType="UV",It.prototype.generate=function(e,t){e.requires.uv[this.index]=!0;var r=this.index>0?this.index+1:"",n=e.isShader("vertex")?"uv"+r:"vUv"+r;return e.format(n,this.getType(e),t)},It.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.index=e.index,this},It.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).index=this.index),t},dt.addKeyword("uv",(function(){return new It})),dt.addKeyword("uv2",(function(){return new It(1)})),Bt.Nodes={perturbNormal2Arb:new mt("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 vUv, vec2 normalScale ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = map * 2.0 - 1.0;\n\n\t\tmapN.xy *= normalScale;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t// Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331\n\n\t\t\tif ( dot( cross( S, T ), N ) < 0.0 ) mapN.xy *= - 1.0;\n\n\t\t#else\n\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}",null,{derivatives:!0})},Bt.prototype=Object.create(it.prototype),Bt.prototype.constructor=Bt,Bt.prototype.nodeType="NormalMap",Bt.prototype.generate=function(e,t){if(e.isShader("fragment")){var r=e.include(Bt.Nodes.perturbNormal2Arb);this.normal=this.normal||new Ct,this.position=this.position||new wt(wt.VIEW),this.uv=this.uv||new It;var n=this.scale.build(e,"v2");return e.material.side===a.BackSide&&(n="-"+n),e.format(r+"( -"+this.position.build(e,"v3")+", "+this.normal.build(e,"v3")+", "+this.value.build(e,"v3")+", "+this.uv.build(e,"v2")+", "+n+" )",this.getType(e),t)}return console.warn("THREE.NormalMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)},Bt.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.value=e.value,this.scale=e.scale,this},Bt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.scale=this.scale.toJSON(e).uuid),t},_t.Nodes=function(){var e=new mt(["vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {","\tvec2 dSTdx = dFdx( vUv );","\tvec2 dSTdy = dFdy( vUv );","\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;","\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","\treturn vec2( dBx, dBy );","}"].join("\n"),null,{derivatives:!0});return{dHdxy_fwd:e,perturbNormalArb:new mt(["vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );","\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );","\tvec3 vN = surf_norm;","\tvec3 R1 = cross( vSigmaY, vN );","\tvec3 R2 = cross( vN, vSigmaX );","\tfloat fDet = dot( vSigmaX, R1 );","\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );","\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","\treturn normalize( abs( fDet ) * surf_norm - vGrad );","}"].join("\n"),[e],{derivatives:!0}),bumpToNormal:new mt(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {","\tvec2 dSTdx = dFdx( uv );","\tvec2 dSTdy = dFdy( uv );","\tfloat Hll = texture2D( bumpMap, uv ).x;","\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );","}"].join("\n"),null,{derivatives:!0})}}(),_t.prototype=Object.create(it.prototype),_t.prototype.constructor=_t,_t.prototype.nodeType="BumpMap",_t.prototype.hashProperties=["toNormalMap"],_t.prototype.generate=function(e,t){if(e.isShader("fragment")){if(this.toNormalMap){var r=e.include(_t.Nodes.bumpToNormal);return e.format(r+"( "+this.value.build(e,"sampler2D")+", "+this.value.uv.build(e,"v2")+", "+this.scale.build(e,"f")+" )",this.getType(e),t)}var n=e.include(_t.Nodes.dHdxy_fwd),i=e.include(_t.Nodes.perturbNormalArb);this.normal=this.normal||new Ct,this.position=this.position||new wt(wt.VIEW);var o=n+"( "+this.value.build(e,"sampler2D")+", "+this.value.uv.build(e,"v2")+", "+this.scale.build(e,"f")+" )";return e.format(i+"( -"+this.position.build(e,"v3")+", "+this.normal.build(e,"v3")+", "+o+" )",this.getType(e),t)}return console.warn("THREE.BumpMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)},_t.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.value=e.value,this.scale=e.scale,this},_t.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.scale=this.scale.toJSON(e).uuid),t},Ft.prototype=Object.create(ot.prototype),Ft.prototype.constructor=Ft,Ft.prototype.nodeType="Color",Tt.addShortcuts(Ft.prototype,"value",["r","g","b"]),Ft.prototype.generateReadonly=function(e,t,r,n){return e.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",n,t)},Ft.prototype.copy=function(e){return ot.prototype.copy.call(this,e),this.value.copy(e),this},Ft.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).r=this.r,t.g=this.g,t.b=this.b,!0===this.readonly&&(t.readonly=!0)),t},Pt.prototype=Object.create(at.prototype),Pt.prototype.constructor=Pt,Pt.prototype.nodeType="MaxMIPLevel",Object.defineProperties(Pt.prototype,{value:{get:function(){if(0===this.maxMIPLevel){var e=this.texture.value.image;Array.isArray(e)&&(e=e[0]),this.maxMIPLevel=void 0!==e?Math.log(Math.max(e.width,e.height))*Math.LOG2E:0}return this.maxMIPLevel},set:function(){}}}),Pt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).texture=this.texture.uuid),t},Rt.Nodes={getSpecularMIPLevel:new mt(["float getSpecularMIPLevel( const in float roughness, const in float maxMIPLevelScalar ) {","\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );","\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );","\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n"))},Rt.prototype=Object.create(it.prototype),Rt.prototype.constructor=Rt,Rt.prototype.nodeType="SpecularMIPLevel",Rt.prototype.setTexture=function(e){return this.texture=e,this},Rt.prototype.generate=function(e,t){if(e.isShader("fragment")){this.maxMIPLevel=this.maxMIPLevel||new Pt,this.maxMIPLevel.texture=this.texture;var r=e.include(Rt.Nodes.getSpecularMIPLevel);return e.format(r+"( "+this.roughness.build(e,"f")+", "+this.maxMIPLevel.build(e,"f")+" )",this.type,t)}return console.warn("THREE.SpecularMIPLevelNode is not compatible with "+e.shader+" shader."),e.format("0.0",this.type,t)},Rt.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.texture=e.texture,this.roughness=e.roughness,this},Rt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).texture=this.texture,t.roughness=this.roughness),t},Lt.prototype=Object.create(nt.prototype),Lt.prototype.constructor=Lt,Lt.prototype.nodeType="Standard",Lt.prototype.build=function(e){var t;e.define("STANDARD");var r=this.clearcoat||this.clearcoatRoughness||this.clearCoatNormal;if(r&&e.define("CLEARCOAT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){var n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(a.UniformsUtils.merge([a.UniformsLib.fog,a.UniformsLib.lights])),a.UniformsLib.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];n&&i.push(n.code,n.result?"transformed = "+n.result+";":""),i.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),t=i.join("\n")}else{var o=new At("material.specularRoughness","f"),s=new At("material.clearcoatRoughness","f"),l={roughness:o,bias:new Rt(o),viewNormal:new At("normal","v3"),worldNormal:new At("inverseTransformDirection( geometry.normal, viewMatrix )","v3"),gamma:!0},c={gamma:!0},u={roughness:s,bias:new Rt(s),viewNormal:new At("clearcoatNormal","v3"),worldNormal:new At("inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )","v3"),gamma:!0};this.mask&&this.mask.analyze(e),this.color.analyze(e,{slot:"color",context:c}),this.roughness.analyze(e),this.metalness.analyze(e),this.alpha&&this.alpha.analyze(e),this.normal&&this.normal.analyze(e),this.clearcoat&&this.clearcoat.analyze(e),this.clearcoatRoughness&&this.clearcoatRoughness.analyze(e),this.clearcoatNormal&&this.clearcoatNormal.analyze(e),this.reflectivity&&this.reflectivity.analyze(e),this.light&&this.light.analyze(e,{cache:"light"}),this.ao&&this.ao.analyze(e),this.ambient&&this.ambient.analyze(e),this.shadow&&this.shadow.analyze(e),this.emissive&&this.emissive.analyze(e,{slot:"emissive"}),this.environment&&(this.environment.analyze(e,{cache:"radiance",context:l,slot:"radiance"}),e.requires.irradiance&&this.environment.analyze(e,{cache:"irradiance",context:l,slot:"irradiance"})),this.sheen&&this.sheen.analyze(e);var h,d=this.mask?this.mask.flow(e,"b"):void 0,f=this.color.flow(e,"c",{slot:"color",context:c}),p=this.roughness.flow(e,"f"),m=this.metalness.flow(e,"f"),g=this.alpha?this.alpha.flow(e,"f"):void 0,A=this.normal?this.normal.flow(e,"v3"):void 0,v=this.clearcoat?this.clearcoat.flow(e,"f"):void 0,y=(s=this.clearcoatRoughness?this.clearcoatRoughness.flow(e,"f"):void 0,this.clearcoatNormal?this.clearcoatNormal.flow(e,"v3"):void 0),x=this.reflectivity?this.reflectivity.flow(e,"f"):void 0,b=this.light?this.light.flow(e,"v3",{cache:"light"}):void 0,w=this.ao?this.ao.flow(e,"f"):void 0,C=this.ambient?this.ambient.flow(e,"c"):void 0,E=this.shadow?this.shadow.flow(e,"c"):void 0,S=this.emissive?this.emissive.flow(e,"c",{slot:"emissive"}):void 0;this.environment&&(h={radiance:this.environment.flow(e,"c",{cache:"radiance",context:l,slot:"radiance"})},e.requires.irradiance&&(h.irradiance=this.environment.flow(e,"c",{cache:"irradiance",context:l,slot:"irradiance"})));var T=r&&h?this.environment.flow(e,"c",{cache:"clearcoat",context:u,slot:"environment"}):void 0,M=this.sheen?this.sheen.flow(e,"c"):void 0;e.requires.transparent=void 0!==g,e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));i=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\t#include <clearcoat_normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];d&&i.push(d.code,"if ( ! "+d.result+" ) discard;"),i.push(f.code,"\tvec3 diffuseColor = "+f.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",p.code,"\tfloat roughnessFactor = "+p.result+";",m.code,"\tfloat metalnessFactor = "+m.result+";"),g&&i.push(g.code,"#ifdef ALPHATEST","\tif ( "+g.result+" <= ALPHATEST ) discard;","#endif"),A&&i.push(A.code,"normal = "+A.result+";"),y&&i.push(y.code,"clearcoatNormal = "+y.result+";"),i.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),i.push("material.diffuseColor = "+(b?"vec3( 1.0 )":"diffuseColor * ( 1.0 - metalnessFactor )")+";","material.specularRoughness = max( roughnessFactor, 0.0525 );","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );"),v?i.push(v.code,"material.clearcoat = saturate( "+v.result+" );"):r&&i.push("material.clearcoat = 0.0;"),s?i.push(s.code,"material.clearcoatRoughness = max( "+s.result+", 0.0525 );","material.clearcoatRoughness += geometryRoughness;","material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );"):r&&i.push("material.clearcoatRoughness = 0.0;"),M&&i.push("material.sheenColor = "+M.result+";"),x?i.push(x.code,"material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+x.result+" ) ), diffuseColor, metalnessFactor );"):i.push("material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),i.push("#include <lights_fragment_begin>"),b&&(i.push(b.code,"reflectedLight.directDiffuse = "+b.result+";"),i.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),w&&i.push(w.code,"reflectedLight.indirectDiffuse *= "+w.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+w.result+", material.specularRoughness );"),C&&i.push(C.code,"reflectedLight.indirectDiffuse += "+C.result+";"),E&&i.push(E.code,"reflectedLight.directDiffuse *= "+E.result+";","reflectedLight.directSpecular *= "+E.result+";"),S&&i.push(S.code,"reflectedLight.directDiffuse += "+S.result+";"),h&&(i.push(h.radiance.code),e.requires.irradiance&&i.push(h.irradiance.code),T&&i.push(T.code,"clearcoatRadiance += "+T.result+";"),i.push("radiance += "+h.radiance.result+";"),e.requires.irradiance&&i.push("iblIrradiance += PI * "+h.irradiance.result+";")),i.push("#include <lights_fragment_end>"),i.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),g?i.push("gl_FragColor = vec4( outgoingLight, "+g.result+" );"):i.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),i.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>","#include <dithering_fragment>"),t=i.join("\n")}return t},Lt.prototype.copy=function(e){return nt.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,this.roughness=e.roughness,this.metalness=e.metalness,e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),e.normal&&(this.normal=e.normal),e.clearcoat&&(this.clearcoat=e.clearcoat),e.clearcoatRoughness&&(this.clearcoatRoughness=e.clearcoatRoughness),e.clearcoatNormal&&(this.clearcoatNormal=e.clearcoatNormal),e.reflectivity&&(this.reflectivity=e.reflectivity),e.light&&(this.light=e.light),e.shadow&&(this.shadow=e.shadow),e.ao&&(this.ao=e.ao),e.emissive&&(this.emissive=e.emissive),e.ambient&&(this.ambient=e.ambient),e.environment&&(this.environment=e.environment),e.sheen&&(this.sheen=e.sheen),this},Lt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,t.roughness=this.roughness.toJSON(e).uuid,t.metalness=this.metalness.toJSON(e).uuid,this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.normal&&(t.normal=this.normal.toJSON(e).uuid),this.clearcoat&&(t.clearcoat=this.clearcoat.toJSON(e).uuid),this.clearcoatRoughness&&(t.clearcoatRoughness=this.clearcoatRoughness.toJSON(e).uuid),this.clearcoatNormal&&(t.clearcoatNormal=this.clearcoatNormal.toJSON(e).uuid),this.reflectivity&&(t.reflectivity=this.reflectivity.toJSON(e).uuid),this.light&&(t.light=this.light.toJSON(e).uuid),this.shadow&&(t.shadow=this.shadow.toJSON(e).uuid),this.ao&&(t.ao=this.ao.toJSON(e).uuid),this.emissive&&(t.emissive=this.emissive.toJSON(e).uuid),this.ambient&&(t.ambient=this.ambient.toJSON(e).uuid),this.environment&&(t.environment=this.environment.toJSON(e).uuid),this.sheen&&(t.sheen=this.sheen.toJSON(e).uuid)),t},Object.defineProperties(Dt.prototype,{value:{get:function(){return this.node.value},set:function(e){this.node.value=e}}}),Nt.prototype=Object.create(ot.prototype),Nt.prototype.constructor=Nt,Nt.prototype.nodeType="Vector3",Tt.addShortcuts(Nt.prototype,"value",["x","y","z"]),Nt.prototype.generateReadonly=function(e,t,r,n){return e.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",n,t)},Nt.prototype.copy=function(e){return ot.prototype.copy.call(this,e),this.value.copy(e),this},Nt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,t.z=this.z,!0===this.readonly&&(t.readonly=!0)),t},kt.prototype=Object.create(ot.prototype),kt.prototype.constructor=kt,kt.prototype.nodeType="Vector4",Tt.addShortcuts(kt.prototype,"value",["x","y","z","w"]),kt.prototype.generateReadonly=function(e,t,r,n){return e.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",n,t)},kt.prototype.copy=function(e){return ot.prototype.copy.call(this,e),this.value.copy(e),this},kt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,!0===this.readonly&&(t.readonly=!0)),t},Ot.prototype=Object.create(ot.prototype),Ot.prototype.constructor=Ot,Ot.prototype.nodeType="Texture",Ot.prototype.getTexture=function(e,t){return ot.prototype.generate.call(this,e,t,this.value.uuid,"t")},Ot.prototype.generate=function(e,t){if("sampler2D"===t)return this.getTexture(e,t);var r,n,i=this.getTexture(e,t),o=this.uv.build(e,this.project?"v4":"v2"),a=this.bias?this.bias.build(e,"f"):void 0;void 0===a&&e.context.bias&&(a=e.context.bias.setTexture(this).build(e,"f")),r=this.project?"texture2DProj":a?"tex2DBias":"tex2D",n=a?r+"( "+i+", "+o+", "+a+" )":r+"( "+i+", "+o+" )";var s={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(s),this.colorSpace=this.colorSpace||new xt(new At("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(e,l),e.removeContext(),e.format(n,l,t)},Ot.prototype.copy=function(e){return ot.prototype.copy.call(this,e),e.value&&(this.value=e.value),this.uv=e.uv,e.bias&&(this.bias=e.bias),void 0!==e.project&&(this.project=e.project),this},Ot.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.value&&(t.value=this.value.uuid),t.uv=this.uv.toJSON(e).uuid,t.project=this.project,this.bias&&(t.bias=this.bias.toJSON(e).uuid)),t},Ut.prototype=Object.create(ot.prototype),Ut.prototype.constructor=Ut,Ut.prototype.nodeType="CubeTexture",Ut.prototype.getTexture=function(e,t){return ot.prototype.generate.call(this,e,t,this.value.uuid,"tc")},Ut.prototype.generate=function(e,t){if("samplerCube"===t)return this.getTexture(e,t);var r,n=this.getTexture(e,t),i=this.uv.build(e,"v3"),o=this.bias?this.bias.build(e,"f"):void 0;void 0===o&&e.context.bias&&(o=e.context.bias.setTexture(this).build(e,"f")),r=o?"texCubeBias( "+n+", "+i+", "+o+" )":"texCube( "+n+", "+i+" )";var a={include:e.isShader("vertex"),ignoreCache:!0},s=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace||new xt(new At("",s)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(r),r=this.colorSpace.build(e,s),e.removeContext(),e.format(r,s,t)},Ut.prototype.copy=function(e){return ot.prototype.copy.call(this,e),e.value&&(this.value=e.value),this.uv=e.uv,e.bias&&(this.bias=e.bias),this},Ut.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.uuid,t.uv=this.uv.toJSON(e).uuid,this.bias&&(t.bias=this.bias.toJSON(e).uuid)),t};var Qt=Tt.elements,Vt=["float","vec2","vec3","vec4"],Gt={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b"},zt={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"};function jt(){this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.requires={uv:[],color:[],lights:!1,fog:!1,transparent:!1,irradiance:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:"",fragment:""},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={},this.updaters=[],this.nodes=[],this.analyzing=!1}function Ht(e){nt.call(this,"v4"),this.value=e}function Wt(e,t){a.ShaderMaterial.call(this),this.vertex=e||new Ht(new wt(wt.PROJECTION)),this.fragment=t||new Ht(new Ft(16711680)),this.updaters=[]}function Zt(){var e=new Lt;Wt.call(this,e,e),this.type="StandardNodeMaterial"}function Xt(){nt.call(this),this.color=new Ft(16777215)}function Yt(e,t,r){ot.call(this,r),this.object=e,this.property=t}function Jt(e,t){nt.call(this),this.node=e,this.components=t||"x"}function qt(){Lt.call(this),this.properties={color:new a.Color(16777215),roughness:.5,metalness:.5,normalScale:new a.Vector2(1,1)},this.inputs={color:new Yt(this.properties,"color","c"),roughness:new Yt(this.properties,"roughness","f"),metalness:new Yt(this.properties,"metalness","f"),normalScale:new Yt(this.properties,"normalScale","v2")}}function Kt(){nt.call(this),this.color=new Ft(15658734),this.specular=new Ft(1118481),this.shininess=new at(30)}function $t(){nt.call(this),this.color=new Ft(15658734),this.spherical=!0}function er(){var e=new Kt;Wt.call(this,e,e),this.type="PhongNodeMaterial"}function tr(){var e=new qt;Wt.call(this,e,e),this.type="MeshStandardNodeMaterial"}function rr(){var e=new Xt;Wt.call(this,e,e),this.type="BasicNodeMaterial"}function nr(){var e=new $t;Wt.call(this,e,e),this.type="SpriteNodeMaterial"}function ir(e,t){nt.call(this,e),this.value=t}function or(e){this.time=void 0!==e?e:0,this.id=0}function ar(e,t){nt.call(this,t),this.name=e}function sr(e,t){it.call(this,"v3"),this.setScope(e||sr.POSITION),this.setCamera(t)}function lr(e){it.call(this,"v3",{shared:!1}),this.scope=e||lr.TOTAL}function cr(){Mt.call(this),this.size=new a.Vector2}function ur(e){it.call(this,"v2"),this.resolution=e||new cr}jt.prototype={constructor:jt,build:function(e,t){this.buildShader("vertex",e),this.buildShader("fragment",t);for(let n=0;n<this.requires.uv.length;n++)if(this.requires.uv[n]){var r=n>0?n+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),n>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVaryCode("varying vec3 vWPosition;"),this.addVertexFinalCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this},buildShader:function(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")},setMaterial:function(e,t){return this.material=e,this.renderer=t,this.requires.lights=e.lights,this.requires.fog=e.fog,this.mergeDefines(e.defines),this},addFlow:function(e,t,r){return this.addSlot(e).addCache(t).addContext(r)},removeFlow:function(){return this.removeSlot().removeCache().removeContext()},addCache:function(e){return this.cache=e||"",this.caches.push(this.cache),this},removeCache:function(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this},addContext:function(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this},removeContext:function(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this},addSlot:function(e){return this.slot=e||"",this.slots.push(this.slot),this},removeSlot:function(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this},addVertexCode:function(e){this.addCode(e,"vertex")},addFragmentCode:function(e){this.addCode(e,"fragment")},addCode:function(e,t){this.code[t||this.shader]+=e+"\n"},addVertexNodeCode:function(e){this.addNodeCode(e,"vertex")},addFragmentNodeCode:function(e){this.addNodeCode(e,"fragment")},addNodeCode:function(e,t){this.nodeCode[t||this.shader]+=e+"\n"},clearNodeCode:function(e){e=e||this.shader;var t=this.nodeCode[e];return this.nodeCode[e]="",t},clearVertexNodeCode:function(){return this.clearNodeCode("vertex")},clearFragmentNodeCode:function(){return this.clearNodeCode("fragment")},addVertexFinalCode:function(e){this.addFinalCode(e,"vertex")},addFragmentFinalCode:function(e){this.addFinalCode(e,"fragment")},addFinalCode:function(e,t){this.finalCode[t||this.shader]+=e+"\n"},addVertexParsCode:function(e){this.addParsCode(e,"vertex")},addFragmentParsCode:function(e){this.addParsCode(e,"fragment")},addParsCode:function(e,t){this.parsCode[t||this.shader]+=e+"\n"},addVaryCode:function(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)},isCache:function(e){return-1!==this.caches.indexOf(e)},isSlot:function(e){return-1!==this.slots.indexOf(e)},define:function(e,t){this.defines[e]=void 0===t?1:t},require:function(e){this.requires[e]=!0},isDefined:function(e){return void 0!==this.defines[e]},getVar:function(e,t,r,n="varying",i="V",o=""){var a=this.getVars(n),s=a[e];if(!s){var l=a.length;s={name:r||"node"+i+l+(o?"_"+o:""),type:t},a.push(s),a[e]=s}return s},getTempVar:function(e,t,r,n){return this.getVar(e,t,r,this.shader,"T",n)},getAttribute:function(e,t){if(!this.attributes[e]){var r=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(r.name+" = "+e+";"),this.attributes[e]={varying:r,name:e,type:t}}return this.attributes[e]},getCode:function(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")},getVarListCode:function(e,t){t=t||"";var r="";for(let s=0,l=e.length;s<l;++s){var n=e[s],i=n.type,o=n.name,a=this.getFormatByType(i);if(void 0===a)throw new Error("Node pars "+a+" not found.");r+=t+" "+a+" "+o+";\n"}return r},getVars:function(e){return this.inputs.vars[e||this.shader]},getNodeData:function(e){var t=e.isNode?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}},createUniform:function(e,t,r,n,i,o){var a=this.inputs.uniforms,s=a.list.length,l=new Dt({type:t,name:n||"nodeU"+s+(o?"_"+o:""),node:r,needsUpdate:i});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l},createVertexUniform:function(e,t,r,n,i){return this.createUniform("vertex",e,t,r,n,i)},createFragmentUniform:function(e,t,r,n,i){return this.createUniform("fragment",e,t,r,n,i)},include:function(e,t,r){var n;if(e="string"===typeof e?dt.get(e):e,!1===this.context.include)return e.name;e instanceof mt?n=this.includes.functions:e instanceof lt?n=this.includes.consts:e instanceof ht&&(n=this.includes.structs);var i=n[this.shader]=n[this.shader]||[];if(e){var o=i[e.name];if(o||(o=i[e.name]={node:e,deps:[]},i.push(o),o.src=e.build(this,"source")),e instanceof mt&&t&&i[t.name]&&-1==i[t.name].deps.indexOf(e)&&(i[t.name].deps.push(e),e.includes&&e.includes.length)){var a=0;do{this.include(e.includes[a++],t)}while(a<e.includes.length)}return r&&(o.src=r),e.name}throw new Error("Include not found.")},colorToVectorProperties:function(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},colorToVector:function(e){return e.replace(/c/g,"v3")},getIncludes:function(e,t){return this.includes[e][t||this.shader]},getIncludesCode:function(){function e(e,t){return e.deps.length-t.deps.length}return function(t,r){if(!(i=this.getIncludes(t,r)))return"";var n="",i=i.sort(e);for(let e=0;e<i.length;e++)i[e].src&&(n+=i[e].src+"\n");return n}}(),getConstructorFromLength:function(e){return Vt[e-1]},isTypeMatrix:function(e){return/^m/.test(e)},getTypeLength:function(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))},getTypeFromLength:function(e){return 1===e?"f":"v"+e},findNode:function(){for(let t=0;t<arguments.length;t++){var e=arguments[t];if(void 0!==e&&e.isNode)return e}},resolve:function(){for(let t=0;t<arguments.length;t++){var e=arguments[t];if(void 0!==e){if(e.isNode)return e;if(e.isTexture)switch(e.mapping){case a.CubeReflectionMapping:case a.CubeRefractionMapping:return new Ut(e);case a.CubeUVReflectionMapping:case a.CubeUVRefractionMapping:return new St(new Ot(e));default:return new Ot(e)}else{if(e.isVector2)return new Mt(e);if(e.isVector3)return new Nt(e);if(e.isVector4)return new kt(e)}}}},format:function(e,t,r){switch(this.colorToVector(r+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e},getTypeByFormat:function(e){return Gt[e]||e},getFormatByType:function(e){return zt[e]||e},getUuid:function(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e},getElementByIndex:function(e){return Qt[e]},getIndexByElement:function(e){return Qt.indexOf(e)},isShader:function(e){return this.shader===e},setShader:function(e){return this.shader=e,this},mergeDefines:function(e){for(let t in e)this.defines[t]=e[t];return this.defines},mergeUniform:function(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms},getTextureEncodingFromMap:function(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=a.LinearEncoding,t===a.LinearEncoding&&this.context.gamma&&(t=a.sRGBEncoding),t}},Ht.prototype=Object.create(nt.prototype),Ht.prototype.constructor=Ht,Ht.prototype.nodeType="Raw",Ht.prototype.generate=function(e){var t=this.value.analyzeAndFlow(e,this.type),r=t.code+"\n";return e.isShader("vertex")?r+="gl_Position = "+t.result+";":r+="gl_FragColor = "+t.result+";",r},Ht.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.value=e.value,this},Ht.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid),t},Wt.prototype=Object.create(a.ShaderMaterial.prototype),Wt.prototype.constructor=Wt,Wt.prototype.type="NodeMaterial",Wt.prototype.isNodeMaterial=!0,Object.defineProperties(Wt.prototype,{properties:{get:function(){return this.fragment.properties}},needsUpdate:{set:function(e){!0===e&&this.version++,this.needsCompile=e},get:function(){return this.needsCompile}}}),Wt.prototype.onBeforeCompile=function(e,t){this.build({renderer:t}),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD},Wt.prototype.customProgramCacheKey=function(){return this.getHash()},Wt.prototype.getHash=function(){var e="{";return e+='"vertex":'+this.vertex.getHash()+",",e+='"fragment":'+this.fragment.getHash(),e+="}"},Wt.prototype.updateFrame=function(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])},Wt.prototype.build=function(e){var t=(e=e||{}).builder||new jt;return t.setMaterial(this,e.renderer),t.build(this.vertex,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters,this.fog=t.requires.fog,this.lights=t.requires.lights,this.transparent=t.requires.transparent||this.blending>a.NormalBlending,this},Wt.prototype.copy=function(e){var t=this.uuid;for(let r in e)this[r]=e[r];return this.uuid=t,void 0!==e.userData&&(this.userData=JSON.parse(JSON.stringify(e.userData))),this},Wt.prototype.toJSON=function(e){if((void 0===e||"string"===typeof e)&&(e={nodes:{}}),e&&!e.materials&&(e.materials={}),!e.materials[this.uuid]){var t={};t.uuid=this.uuid,t.type=this.type,e.materials[t.uuid]=t,""!==this.name&&(t.name=this.name),void 0!==this.size&&(t.size=this.size),void 0!==this.sizeAttenuation&&(t.sizeAttenuation=this.sizeAttenuation),this.blending!==a.NormalBlending&&(t.blending=this.blending),!0===this.flatShading&&(t.flatShading=this.flatShading),this.side!==a.FrontSide&&(t.side=this.side),this.vertexColors!==a.NoColors&&(t.vertexColors=this.vertexColors),this.depthFunc!==a.LessEqualDepth&&(t.depthFunc=this.depthFunc),!1===this.depthTest&&(t.depthTest=this.depthTest),!1===this.depthWrite&&(t.depthWrite=this.depthWrite),1!==this.linewidth&&(t.linewidth=this.linewidth),void 0!==this.dashSize&&(t.dashSize=this.dashSize),void 0!==this.gapSize&&(t.gapSize=this.gapSize),void 0!==this.scale&&(t.scale=this.scale),!0===this.dithering&&(t.dithering=!0),!0===this.wireframe&&(t.wireframe=this.wireframe),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(t.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(t.wireframeLinejoin=this.wireframeLinejoin),this.alphaTest>0&&(t.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(t.premultipliedAlpha=this.premultipliedAlpha),!0===this.morphTargets&&(t.morphTargets=!0),!0===this.skinning&&(t.skinning=!0),!1===this.visible&&(t.visible=!1),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.fog=this.fog,t.lights=this.lights,t.vertex=this.vertex.toJSON(e).uuid,t.fragment=this.fragment.toJSON(e).uuid}return e.material=this.uuid,e},Zt.prototype=Object.create(Wt.prototype),Zt.prototype.constructor=Zt,Tt.addShortcuts(Zt.prototype,"fragment",["color","alpha","roughness","metalness","reflectivity","clearcoat","clearcoatRoughness","clearcoatNormal","normal","emissive","ambient","light","shadow","ao","environment","mask","position","sheen"]),Xt.prototype=Object.create(nt.prototype),Xt.prototype.constructor=Xt,Xt.prototype.nodeType="Basic",Xt.prototype.generate=function(e){var t;if(e.isShader("vertex")){var r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED"," varying vec3 vNormal;","#endif"].join("\n"));var n=["#include <beginnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED"," vNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];r&&n.push(r.code,r.result?"transformed = "+r.result+";":""),n.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),t=n.join("\n")}else{this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.mask&&this.mask.analyze(e);var i=this.color.flow(e,"c",{slot:"color"}),o=this.alpha?this.alpha.flow(e,"f"):void 0,a=this.mask?this.mask.flow(e,"b"):void 0;e.requires.transparent=void 0!==o,e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED"," varying vec3 vNormal;","#endif"].join("\n"));n=["#include <normal_fragment_begin>",i.code];a&&n.push(a.code,"if ( ! "+a.result+" ) discard;"),o&&n.push(o.code,"#ifdef ALPHATEST"," if ( "+o.result+" <= ALPHATEST ) discard;","#endif"),o?n.push("gl_FragColor = vec4("+i.result+", "+o.result+" );"):n.push("gl_FragColor = vec4("+i.result+", 1.0 );"),t=n.join("\n")}return t},Xt.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.color=e.color,e.position&&(this.position=e.position),e.alpha&&(this.alpha=e.alpha),e.mask&&(this.mask=e.mask),this},Xt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).color=this.color.toJSON(e).uuid,this.position&&(t.position=this.position.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.mask&&(t.mask=this.mask.toJSON(e).uuid)),t},Yt.prototype=Object.create(ot.prototype),Yt.prototype.constructor=Yt,Yt.prototype.nodeType="Property",Object.defineProperties(Yt.prototype,{value:{get:function(){return this.object[this.property]},set:function(e){this.object[this.property]=e}}}),Yt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,t.property=this.property),t},Jt.prototype=Object.create(nt.prototype),Jt.prototype.constructor=Jt,Jt.prototype.nodeType="Switch",Jt.prototype.getType=function(e){return e.getTypeFromLength(this.components.length)},Jt.prototype.generate=function(e,t){var r=this.node.getType(e),n=this.node.build(e,r),i=e.getTypeLength(r)-1;if(i>0){var o,a=0,s=e.colorToVectorProperties(this.components),l=s.length;for(o=0;o<l;o++)a=Math.max(a,e.getIndexByElement(s.charAt(o)));for(a>i&&(a=i),n+=".",o=0;o<l;o++){var c=e.getIndexByElement(s.charAt(o));c>a&&(c=a),n+=e.getElementByIndex(c)}return e.format(n,this.getType(e),t)}return e.format(n,r,t)},Jt.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.node=e.node,this.components=e.components,this},Jt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).node=this.node.toJSON(e).uuid,t.components=this.components),t},qt.prototype=Object.create(Lt.prototype),qt.prototype.constructor=qt,qt.prototype.nodeType="MeshStandard",qt.prototype.build=function(e){var t=this.properties,r=this.inputs;if(e.isShader("fragment")){var n=e.findNode(t.color,r.color),i=e.resolve(t.map);this.color=i?new vt(n,i,vt.MUL):n;var o=e.findNode(t.roughness,r.roughness),a=e.resolve(t.roughnessMap);this.roughness=a?new vt(o,new Jt(a,"g"),vt.MUL):o;var s=e.findNode(t.metalness,r.metalness),l=e.resolve(t.metalnessMap);this.metalness=l?new vt(s,new Jt(l,"b"),vt.MUL):s,t.normalMap?(this.normal=new Bt(e.resolve(t.normalMap)),this.normal.scale=e.findNode(t.normalScale,r.normalScale)):this.normal=void 0,this.environment=e.resolve(t.envMap)}return Lt.prototype.build.call(this,e)},qt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),console.warn(".toJSON not implemented in",this)),t},Kt.prototype=Object.create(nt.prototype),Kt.prototype.constructor=Kt,Kt.prototype.nodeType="Phong",Kt.prototype.build=function(e){var t;if(e.define("PHONG"),e.requires.lights=!0,e.isShader("vertex")){var r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(a.UniformsUtils.merge([a.UniformsLib.fog,a.UniformsLib.lights])),e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];r&&n.push(r.code,r.result?"transformed = "+r.result+";":""),n.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),t=n.join("\n")}else{this.mask&&this.mask.analyze(e),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.alpha&&this.alpha.analyze(e),this.normal&&this.normal.analyze(e),this.light&&this.light.analyze(e,{cache:"light"}),this.ao&&this.ao.analyze(e),this.ambient&&this.ambient.analyze(e),this.shadow&&this.shadow.analyze(e),this.emissive&&this.emissive.analyze(e,{slot:"emissive"}),this.environment&&this.environment.analyze(e,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.analyze(e);var i=this.mask?this.mask.flow(e,"b"):void 0,o=this.color.flow(e,"c",{slot:"color"}),s=this.specular.flow(e,"c"),l=this.shininess.flow(e,"f"),c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.normal?this.normal.flow(e,"v3"):void 0,h=this.light?this.light.flow(e,"v3",{cache:"light"}):void 0,d=this.ao?this.ao.flow(e,"f"):void 0,f=this.ambient?this.ambient.flow(e,"c"):void 0,p=this.shadow?this.shadow.flow(e,"c"):void 0,m=this.emissive?this.emissive.flow(e,"c",{slot:"emissive"}):void 0,g=this.environment?this.environment.flow(e,"c",{slot:"environment"}):void 0,A=this.environmentAlpha&&this.environment?this.environmentAlpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));n=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;"];i&&n.push(i.code,"if ( ! "+i.result+" ) discard;"),n.push(o.code,"\tvec3 diffuseColor = "+o.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",s.code,"\tvec3 specular = "+s.result+";",l.code,"\tfloat shininess = max( 0.0001, "+l.result+" );","\tfloat specularStrength = 1.0;"),c&&n.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),u&&n.push(u.code,"normal = "+u.result+";"),n.push("material.diffuseColor = "+(h?"vec3( 1.0 )":"diffuseColor")+";"),n.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h&&(n.push(h.code,"reflectedLight.directDiffuse = "+h.result+";"),n.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),d&&n.push(d.code,"reflectedLight.indirectDiffuse *= "+d.result+";"),f&&n.push(f.code,"reflectedLight.indirectDiffuse += "+f.result+";"),p&&n.push(p.code,"reflectedLight.directDiffuse *= "+p.result+";","reflectedLight.directSpecular *= "+p.result+";"),m&&n.push(m.code,"reflectedLight.directDiffuse += "+m.result+";"),n.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),g&&(n.push(g.code),A?n.push(A.code,"outgoingLight = mix( outgoingLight, "+g.result+", "+A.result+" );"):n.push("outgoingLight = "+g.result+";")),c?n.push("gl_FragColor = vec4( outgoingLight, "+c.result+" );"):n.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),n.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>"),t=n.join("\n")}return t},Kt.prototype.copy=function(e){return nt.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,this.specular=e.specular,this.shininess=e.shininess,e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),e.normal&&(this.normal=e.normal),e.light&&(this.light=e.light),e.shadow&&(this.shadow=e.shadow),e.ao&&(this.ao=e.ao),e.emissive&&(this.emissive=e.emissive),e.ambient&&(this.ambient=e.ambient),e.environment&&(this.environment=e.environment),e.environmentAlpha&&(this.environmentAlpha=e.environmentAlpha),this},Kt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,t.specular=this.specular.toJSON(e).uuid,t.shininess=this.shininess.toJSON(e).uuid,this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.normal&&(t.normal=this.normal.toJSON(e).uuid),this.light&&(t.light=this.light.toJSON(e).uuid),this.ao&&(t.ao=this.ao.toJSON(e).uuid),this.ambient&&(t.ambient=this.ambient.toJSON(e).uuid),this.shadow&&(t.shadow=this.shadow.toJSON(e).uuid),this.emissive&&(t.emissive=this.emissive.toJSON(e).uuid),this.environment&&(t.environment=this.environment.toJSON(e).uuid),this.environmentAlpha&&(t.environmentAlpha=this.environmentAlpha.toJSON(e).uuid)),t},$t.prototype=Object.create(nt.prototype),$t.prototype.constructor=$t,$t.prototype.nodeType="Sprite",$t.prototype.build=function(e){if(e.define("SPRITE"),e.requires.lights=!1,e.requires.transparent=void 0!==this.alpha,e.isShader("vertex")){var t=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(a.UniformsUtils.merge([a.UniformsLib.fog])),e.addParsCode(["#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n")),o=["#include <clipping_planes_fragment>","#include <begin_vertex>"],t&&o.push(t.code,t.result?"transformed = "+t.result+";":""),o.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||o.push("modelMtx[1][1] = 1.0;"),o.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&o.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),o.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>")}else{e.addParsCode(["#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>"].join("\n")),e.addCode(["#include <clipping_planes_fragment>","#include <logdepthbuf_fragment>"].join("\n")),this.mask&&this.mask.analyze(e),this.alpha&&this.alpha.analyze(e),this.color.analyze(e,{slot:"color"});var r=this.mask?this.mask.flow(e,"b"):void 0,n=this.alpha?this.alpha.flow(e,"f"):void 0,i=this.color.flow(e,"c",{slot:"color"}),o=[];r&&o.push(r.code,"if ( ! "+r.result+" ) discard;"),n?o.push(n.code,"#ifdef ALPHATEST","if ( "+n.result+" <= ALPHATEST ) discard;","#endif",i.code,"gl_FragColor = vec4( "+i.result+", "+n.result+" );"):o.push(i.code,"gl_FragColor = vec4( "+i.result+", 1.0 );"),o.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>")}return o.join("\n")},$t.prototype.copy=function(e){return nt.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,void 0!==e.spherical&&(this.spherical=e.spherical),e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),this},$t.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,!1===this.spherical&&(t.spherical=!1),this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid)),t},er.prototype=Object.create(Wt.prototype),er.prototype.constructor=er,Tt.addShortcuts(er.prototype,"fragment",["color","alpha","specular","shininess","normal","emissive","ambient","light","shadow","ao","environment","environmentAlpha","mask","position"]),tr.prototype=Object.create(Wt.prototype),tr.prototype.constructor=tr,Tt.addShortcuts(tr.prototype,"properties",["color","roughness","metalness","map","normalMap","normalScale","metalnessMap","roughnessMap","envMap"]),rr.prototype=Object.create(Wt.prototype),rr.prototype.constructor=rr,Tt.addShortcuts(rr.prototype,"fragment",["color","alpha","mask","position"]),nr.prototype=Object.create(Wt.prototype),nr.prototype.constructor=nr,Tt.addShortcuts(nr.prototype,"fragment",["color","alpha","mask","position","spherical"]),ir.prototype=Object.create(nt.prototype),ir.prototype.constructor=ir,ir.prototype.nodeType="Var",ir.prototype.getType=function(e){return e.getTypeByFormat(this.type)},ir.prototype.generate=function(e,t){var r=e.getVar(this.uuid,this.type);return this.value&&e.isShader("vertex")&&e.addNodeCode(r.name+" = "+this.value.build(e,this.getType(e))+";"),e.format(r.name,this.getType(e),t)},ir.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.type=e.type,this.value=e.value,this},ir.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).type=this.type,this.value&&(t.value=this.value.toJSON(e).uuid)),t},or.prototype={constructor:or,update:function(e){return++this.id,this.time+=e,this.delta=e,this},setRenderer:function(e){return this.renderer=e,this},setRenderTexture:function(e){return this.renderTexture=e,this},updateNode:function(e){return e.frameId===this.id||(e.updateFrame(this),e.frameId=this.id),this}},ar.prototype=Object.create(nt.prototype),ar.prototype.constructor=ar,ar.prototype.nodeType="Attribute",ar.prototype.getAttributeType=function(e){return"number"===typeof this.type?e.getConstructorFromLength(this.type):this.type},ar.prototype.getType=function(e){var t=this.getAttributeType(e);return e.getTypeByFormat(t)},ar.prototype.generate=function(e,t){var r=this.getAttributeType(e),n=e.getAttribute(this.name,r),i=e.isShader("vertex")?this.name:n.varying.name;return e.format(i,this.getType(e),t)},ar.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.type=e.type,this},ar.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).type=this.type),t},sr.Nodes={depthColor:new mt(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n"))},sr.POSITION="position",sr.DEPTH="depth",sr.TO_VERTEX="toVertex",sr.prototype=Object.create(it.prototype),sr.prototype.constructor=sr,sr.prototype.nodeType="Camera",sr.prototype.setCamera=function(e){this.camera=e,this.updateFrame=void 0!==e?this.onUpdateFrame:void 0},sr.prototype.setScope=function(e){switch(this.scope){case sr.DEPTH:delete this.near,delete this.far}switch(this.scope=e,e){case sr.DEPTH:var t=this.camera;this.near=new at(t?t.near:1),this.far=new at(t?t.far:1200)}},sr.prototype.getType=function(){switch(this.scope){case sr.DEPTH:return"f"}return this.type},sr.prototype.getUnique=function(){switch(this.scope){case sr.DEPTH:case sr.TO_VERTEX:return!0}return!1},sr.prototype.getShared=function(){switch(this.scope){case sr.POSITION:return!1}return!0},sr.prototype.generate=function(e,t){var r;switch(this.scope){case sr.POSITION:r="cameraPosition";break;case sr.DEPTH:r=e.include(sr.Nodes.depthColor)+"( "+this.near.build(e,"f")+", "+this.far.build(e,"f")+" )";break;case sr.TO_VERTEX:r="normalize( "+new wt(wt.WORLD).build(e,"v3")+" - cameraPosition )"}return e.format(r,this.getType(e),t)},sr.prototype.onUpdateFrame=function(){switch(this.scope){case sr.DEPTH:var e=this.camera;this.near.value=e.near,this.far.value=e.far}},sr.prototype.copy=function(e){switch(it.prototype.copy.call(this,e),this.setScope(e.scope),e.camera&&this.setCamera(e.camera),e.scope){case sr.DEPTH:this.near.number=e.near,this.far.number=e.far}return this},sr.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t)switch((t=this.createJSONNode(e)).scope=this.scope,this.camera&&(t.camera=this.camera.uuid),this.scope){case sr.DEPTH:t.near=this.near.value,t.far=this.far.value}return t},lr.TOTAL="total",lr.prototype=Object.create(it.prototype),lr.prototype.constructor=lr,lr.prototype.nodeType="Light",lr.prototype.generate=function(e,t){return e.isCache("light")?e.format("reflectedLight.directDiffuse",this.type,t):(console.warn('THREE.LightNode is only compatible in "light" channel.'),e.format("vec3( 0.0 )",this.type,t))},lr.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.scope=e.scope,this},lr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},cr.prototype=Object.create(Mt.prototype),cr.prototype.constructor=cr,cr.prototype.nodeType="Resolution",cr.prototype.updateFrame=function(e){if(e.renderer){e.renderer.getSize(this.size);var t=e.renderer.getPixelRatio();this.x=this.size.width*t,this.y=this.size.height*t}else console.warn("ResolutionNode need a renderer in NodeFrame")},cr.prototype.copy=function(e){return Mt.prototype.copy.call(this,e),this.renderer=e.renderer,this},cr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).renderer=this.renderer.uuid),t},ur.prototype=Object.create(it.prototype),ur.prototype.constructor=ur,ur.prototype.nodeType="ScreenUV",ur.prototype.generate=function(e,t){var r;return e.isShader("fragment")?r="( gl_FragCoord.xy / "+this.resolution.build(e,"v2")+")":(console.warn("THREE.ScreenUVNode is not compatible with "+e.shader+" shader."),r="vec2( 0.0 )"),e.format(r,this.getType(e),t)},ur.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.resolution=e.resolution,this},ur.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).resolution=this.resolution.toJSON(e).uuid),t};var hr=["color","color2"],dr=["vColor","vColor2"];function fr(e){it.call(this,"v4",{shared:!1}),this.index=e||0}function pr(e,t){nt.call(this),this.code=e,this.value=t}function mr(e,t){Nt.call(this),this.params={},this.velocity=new a.Vector3,this.setTarget(e),this.setParams(t)}function gr(e){it.call(this),this.slots=e||{}}function Ar(e){ot.call(this,"m3"),this.value=e||new a.Matrix3}function vr(e,t){At.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=e||new It,this.position=t||new Ar}fr.prototype=Object.create(it.prototype),fr.prototype.constructor=fr,fr.prototype.nodeType="Colors",fr.prototype.generate=function(e,t){e.requires.color[this.index]=!0;var r=e.isShader("vertex")?hr[this.index]:dr[this.index];return e.format(r,this.getType(e),t)},fr.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.index=e.index,this},fr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).index=this.index),t},pr.prototype=Object.create(nt.prototype),pr.prototype.constructor=pr,pr.prototype.nodeType="Bypass",pr.prototype.getType=function(e){return this.value?this.value.getType(e):e.isShader("fragment")?"f":"void"},pr.prototype.generate=function(e,t){var r=this.code.build(e,t)+";";return e.addNodeCode(r),e.isShader("vertex")?this.value?this.value.build(e,t):void 0:this.value?this.value.build(e,t):e.format("0.0","f",t)},pr.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.code=e.code,this.value=e.value,this},pr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).code=this.code.toJSON(e).uuid,this.value&&(t.value=this.value.toJSON(e).uuid)),t},mr.prototype=Object.create(Nt.prototype),mr.prototype.constructor=mr,mr.prototype.nodeType="Velocity",mr.prototype.getReadonly=function(){return!1},mr.prototype.setParams=function(e){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=e||{},this.params.type){case"elastic":this.moment=new a.Vector3,this.speed=new a.Vector3,this.springVelocity=new a.Vector3,this.lastVelocity=new a.Vector3}},mr.prototype.setTarget=function(e){this.target&&(delete this.position,delete this.oldPosition),this.target=e,e&&(this.position=e.getWorldPosition(this.position||new a.Vector3),this.oldPosition=this.position.clone())},mr.prototype.updateFrameVelocity=function(){this.target&&(this.position=this.target.getWorldPosition(this.position||new a.Vector3),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},mr.prototype.updateFrame=function(e){switch(this.updateFrameVelocity(e),this.params.type){case"elastic":var t=e.delta*(this.params.fps||60),r=Math.pow(this.params.spring,t),n=Math.pow(this.params.damping,t);this.velocity.multiplyScalar(Math.exp(-this.params.damping*t)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(n).multiplyScalar(1-r)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(r),this.moment.add(this.springVelocity),this.moment.multiplyScalar(n),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},mr.prototype.copy=function(e){return Nt.prototype.copy.call(this,e),e.target&&this.setTarget(e.target),this.setParams(e.params),this},mr.prototype.toJSON=function(e){var t=Nt.prototype.toJSON.call(this,e);return this.target&&(t.target=this.target.uuid),t.params=JSON.parse(JSON.stringify(this.params)),t},gr.prototype=Object.create(it.prototype),gr.prototype.constructor=gr,gr.prototype.nodeType="SubSlot",gr.prototype.getType=function(e,t){return t},gr.prototype.generate=function(e,t){return this.slots[e.slot]?this.slots[e.slot].build(e,t):e.format("0.0","f",t)},gr.prototype.copy=function(e){it.prototype.copy.call(this,e);for(let t in e.slots)this.slots[t]=e.slots[t];return this},gr.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){(t=this.createJSONNode(e)).slots={};for(let n in this.slots){var r=this.slots[n];r&&(t.slots[n]=r.toJSON(e).uuid)}}return t},Ar.prototype=Object.create(ot.prototype),Ar.prototype.constructor=Ar,Ar.prototype.nodeType="Matrix3",Object.defineProperties(Ar.prototype,{elements:{set:function(e){this.value.elements=e},get:function(){return this.value.elements}}}),Ar.prototype.generateReadonly=function(e,t,r,n){return e.format("mat3( "+this.value.elements.join(", ")+" )",n,t)},Ar.prototype.copy=function(e){return ot.prototype.copy.call(this,e),this.value.fromArray(e.elements),this},Ar.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).elements=this.value.elements.concat()),t},vr.prototype=Object.create(At.prototype),vr.prototype.constructor=vr,vr.prototype.nodeType="UVTransform",vr.prototype.generate=function(e,t){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.position,At.prototype.generate.call(this,e,t)},vr.prototype.setUvTransform=function(e,t,r,n,i,o,a){o=void 0!==o?o:.5,a=void 0!==a?a:.5,this.position.value.setUvTransform(e,t,r,n,i,o,a)},vr.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.uv=e.uv,this.position=e.position,this},vr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid,t.position=this.position.toJSON(e).uuid),t};var yr=Tt.elements;function xr(e,t,r,n){it.call(this,"f"),this.x=e,this.y=t,this.z=r,this.w=n}function br(e,t,r){at.call(this),this.scale=void 0!==e?e:1,this.scope=t||br.GLOBAL,this.timeScale=void 0!==r?r:void 0!==e}function wr(e,t,r,n,i){it.call(this),this.a=e,this.b=t,this.op=r,this.ifNode=n,this.elseNode=i}function Cr(e){Ot.call(this,void 0,e)}function Er(e,t){if(void 0===t){var r={minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat},n=e.getDrawingBufferSize(new a.Vector2);t=new a.WebGLRenderTarget(n.width,n.height,r)}this.renderer=e,this.renderTarget=t,this.output=new Cr,this.material=new Wt,this.camera=new a.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new a.Scene,this.quad=new a.Mesh(new a.PlaneGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.needsUpdate=!0}xr.prototype=Object.create(it.prototype),xr.prototype.constructor=xr,xr.prototype.nodeType="Join",xr.prototype.getNumElements=function(){for(var e=yr.length;e--;)if(void 0!==this[yr[e]]){++e;break}return Math.max(e,2)},xr.prototype.getType=function(e){return e.getTypeFromLength(this.getNumElements())},xr.prototype.generate=function(e,t){var r=this.getType(e),n=this.getNumElements(),i=[];for(let s=0;s<n;s++){var o=this[yr[s]];i.push(o?o.build(e,"f"):"0.0")}var a=(n>1?e.getConstructorFromLength(n):"")+"( "+i.join(", ")+" )";return e.format(a,r,t)},xr.prototype.copy=function(e){it.prototype.copy.call(this,e);for(let t in e.inputs)this[t]=e.inputs[t];return this},xr.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){(t=this.createJSONNode(e)).inputs={};var r=this.getNumElements();for(let i=0;i<r;i++){var n=this[yr[i]];n&&(t.inputs[yr[i]]=n.toJSON(e).uuid)}}return t},br.GLOBAL="global",br.LOCAL="local",br.DELTA="delta",br.prototype=Object.create(at.prototype),br.prototype.constructor=br,br.prototype.nodeType="Timer",br.prototype.getReadonly=function(){return!1},br.prototype.getUnique=function(){return this.timeScale&&(this.scope===br.GLOBAL||this.scope===br.DELTA)},br.prototype.updateFrame=function(e){var t=this.timeScale?this.scale:1;switch(this.scope){case br.LOCAL:this.value+=e.delta*t;break;case br.DELTA:this.value=e.delta*t;break;default:this.value=e.time*t}},br.prototype.copy=function(e){return at.prototype.copy.call(this,e),this.scope=e.scope,this.scale=e.scale,this.timeScale=e.timeScale,this},br.prototype.toJSON=function(e){var t=at.prototype.toJSON.call(this,e);return t.scope=this.scope,t.scale=this.scale,t.timeScale=this.timeScale,t},dt.addKeyword("time",(function(){return new br})),wr.EQUAL="==",wr.NOT_EQUAL="!=",wr.GREATER=">",wr.GREATER_EQUAL=">=",wr.LESS="<",wr.LESS_EQUAL="<=",wr.AND="&&",wr.OR="||",wr.prototype=Object.create(it.prototype),wr.prototype.constructor=wr,wr.prototype.nodeType="Cond",wr.prototype.getType=function(e){if(this.ifNode){var t=this.ifNode.getType(e),r=this.elseNode.getType(e);return e.getTypeLength(r)>e.getTypeLength(t)?r:t}return"b"},wr.prototype.getCondType=function(e){return e.getTypeLength(this.b.getType(e))>e.getTypeLength(this.a.getType(e))?this.b.getType(e):this.a.getType(e)},wr.prototype.generate=function(e,t){var r,n=this.getType(e),i=this.getCondType(e),o=this.a.build(e,i),a=this.b.build(e,i);if(this.ifNode){var s=this.ifNode.build(e,n),l=this.elseNode.build(e,n);r="( "+[o,this.op,a,"?",s,":",l].join(" ")+" )"}else r="( "+o+" "+this.op+" "+a+" )";return e.format(r,this.getType(e),t)},wr.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.op=e.op,this.ifNode=e.ifNode,this.elseNode=e.elseNode,this},wr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.op=this.op,t.ifNode&&(t.ifNode=this.ifNode.toJSON(e).uuid),t.elseNode&&(t.elseNode=this.elseNode.toJSON(e).uuid)),t},Cr.prototype=Object.create(Ot.prototype),Cr.prototype.constructor=Cr,Cr.prototype.nodeType="Screen",Cr.prototype.getUnique=function(){return!0},Cr.prototype.getTexture=function(e,t){return ot.prototype.generate.call(this,e,t,this.getUuid(),"t","renderTexture")},Er.prototype={constructor:Er,render:function(e,t,r){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.output,this.material.build(),this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=this.renderTarget.texture),this.needsUpdate=!1),r.setRenderer(this.renderer).setRenderTexture(this.renderTarget.texture),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(e,t),r.updateNode(this.material),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)},setPixelRatio:function(e){this.renderer.setPixelRatio(e);var t=this.renderer.getSize(new a.Vector2);this.setSize(t.width,t.height)},setSize:function(e,t){var r=this.renderer.getPixelRatio();this.renderTarget.setSize(e*r,t*r),this.renderer.setSize(e,t)},copy:function(e){return this.output=e.output,this},toJSON:function(e){if((void 0===e||"string"===typeof e)&&(e={nodes:{}}),e&&!e.post&&(e.post={}),!e.post[this.uuid]){var t={};t.uuid=this.uuid,t.type="NodePostProcessing",e.post[this.uuid]=t,""!==this.name&&(t.name=this.name),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.output=this.output.toJSON(e).uuid}return e.post=this.uuid,e}};var Sr=r(960);function Tr(){Sr.T.call(this),this.name="",this.uuid=a.MathUtils.generateUUID(),this.userData={},this.textureID="renderTexture",this.input=new Cr,this.material=new Wt,this.needsUpdate=!0}function Mr(e){it.call(this,"f"),this.rgb=e}function Ir(e,t,r){it.call(this,"v3"),this.rgb=e,this.adjustment=t,this.method=r||Ir.SATURATION}function Br(e,t,r,n){it.call(this,"v4"),this.value=e,this.uv=t||new It,this.radius=r||new Mt(1,1),this.size=n,this.blurX=!0,this.blurY=!0,this.horizontal=new at(1/64),this.vertical=new at(1/64)}function _r(e){it.call(this,"f"),this.uv=e||new It}function Fr(e){it.call(this,"f"),this.uv=e||new It}function Pr(e){ot.call(this,"m4"),this.value=e||new a.Matrix4}function Rr(e){it.call(this,"v4"),e&&this.setMirror(e)}function Lr(e){ot.call(this,"i"),this.value=Math.floor(e||0)}function Dr(e){ot.call(this,"b"),this.value=Boolean(e)}function Nr(e,t,r,n){n=n||{},this.input=r,this.clear=void 0===n.clear||n.clear,this.renderTarget=new a.WebGLRenderTarget(e,t,n),this.material=new Wt,this.camera=new a.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new a.Scene,this.quad=new a.Mesh(new a.PlaneGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.render=!0,Ot.call(this,this.renderTarget.texture)}Tr.prototype=Object.create(Sr.T.prototype),Tr.prototype.constructor=Tr,Tr.prototype.render=function(){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.input,this.needsUpdate=!1),this.uniforms=this.material.uniforms,Sr.T.prototype.render.apply(this,arguments)},Tr.prototype.copy=function(e){return this.input=e.input,this},Tr.prototype.toJSON=function(e){if((void 0===e||"string"===typeof e)&&(e={nodes:{}}),e&&!e.passes&&(e.passes={}),!e.passes[this.uuid]){var t={};t.uuid=this.uuid,t.type="NodePass",e.passes[this.uuid]=t,""!==this.name&&(t.name=this.name),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.input=this.input.toJSON(e).uuid}return e.pass=this.uuid,e},Mr.Nodes=function(){var e=new lt("vec3 LUMA vec3( 0.2125, 0.7154, 0.0721 )");return{LUMA:e,luminance:new mt(["float luminance( vec3 rgb ) {","\treturn dot( rgb, LUMA );","}"].join("\n"),[e])}}(),Mr.prototype=Object.create(it.prototype),Mr.prototype.constructor=Mr,Mr.prototype.nodeType="Luminance",Mr.prototype.generate=function(e,t){var r=e.include(Mr.Nodes.luminance);return e.format(r+"( "+this.rgb.build(e,"v3")+" )",this.getType(e),t)},Mr.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.rgb=e.rgb,this},Mr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).rgb=this.rgb.toJSON(e).uuid),t},Ir.Nodes={hue:new mt(["vec3 hue(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n")),saturation:new mt(["vec3 saturation(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3( luminance( rgb ) );","\treturn mix( intensity, rgb, adjustment );","}"].join("\n"),[Mr.Nodes.luminance]),vibrance:new mt(["vec3 vibrance(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))},Ir.SATURATION="saturation",Ir.HUE="hue",Ir.VIBRANCE="vibrance",Ir.BRIGHTNESS="brightness",Ir.CONTRAST="contrast",Ir.prototype=Object.create(it.prototype),Ir.prototype.constructor=Ir,Ir.prototype.nodeType="ColorAdjustment",Ir.prototype.hashProperties=["method"],Ir.prototype.generate=function(e,t){var r=this.rgb.build(e,"v3"),n=this.adjustment.build(e,"f");switch(this.method){case Ir.BRIGHTNESS:return e.format("( "+r+" + "+n+" )",this.getType(e),t);case Ir.CONTRAST:return e.format("( "+r+" * "+n+" )",this.getType(e),t)}var i=e.include(Ir.Nodes[this.method]);return e.format(i+"( "+r+", "+n+" )",this.getType(e),t)},Ir.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.rgb=e.rgb,this.adjustment=e.adjustment,this.method=e.method,this},Ir.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).rgb=this.rgb.toJSON(e).uuid,t.adjustment=this.adjustment.toJSON(e).uuid,t.method=this.method),t},Br.Nodes={blurX:new mt(["vec4 blurX( sampler2D tex, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tex, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","\tsum += texture2D( tex, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( tex, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","\treturn sum * .667;","}"].join("\n")),blurY:new mt(["vec4 blurY( sampler2D tex, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tex, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","\treturn sum * .667;","}"].join("\n"))},Br.prototype=Object.create(it.prototype),Br.prototype.constructor=Br,Br.prototype.nodeType="Blur",Br.prototype.hashProperties=["blurX","blurY"],Br.prototype.updateFrame=function(){if(this.size)this.horizontal.value=this.radius.x/this.size.x,this.vertical.value=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){var e=this.value.value.image;this.horizontal.value=this.radius.x/e.width,this.vertical.value=this.radius.y/e.height}},Br.prototype.generate=function(e,t){if(e.isShader("fragment")){var r,n=[],i=e.include(Br.Nodes.blurX),o=e.include(Br.Nodes.blurY);return this.blurX&&n.push(i+"( "+this.value.build(e,"sampler2D")+", "+this.uv.build(e,"v2")+", "+this.horizontal.build(e,"f")+" )"),this.blurY&&n.push(o+"( "+this.value.build(e,"sampler2D")+", "+this.uv.build(e,"v2")+", "+this.vertical.build(e,"f")+" )"),r=2==n.length?"( "+n.join(" + ")+" / 2.0 )":n.length?"( "+n[0]+" )":"vec4( 0.0 )",e.format(r,this.getType(e),t)}return console.warn("THREE.BlurNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)},Br.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.value=e.value,this.uv=e.uv,this.radius=e.radius,void 0!==e.size&&(this.size=new a.Vector2(e.size.x,e.size.y)),this.blurX=e.blurX,this.blurY=e.blurY,this},Br.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.uv=this.uv.toJSON(e).uuid,t.radius=this.radius.toJSON(e).uuid,this.size&&(t.size={x:this.size.x,y:this.size.y}),t.blurX=this.blurX,t.blurY=this.blurY),t},_r.prototype=Object.create(it.prototype),_r.prototype.constructor=_r,_r.prototype.nodeType="Noise",_r.Nodes={snoise:new mt(["float snoise(vec2 co) {","\treturn fract( sin( dot( co.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );","}"].join("\n"))},_r.prototype.generate=function(e,t){var r=e.include(_r.Nodes.snoise);return e.format(r+"( "+this.uv.build(e,"v2")+" )",this.getType(e),t)},_r.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.uv=e.uv,this},_r.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid),t},Fr.prototype=Object.create(it.prototype),Fr.prototype.constructor=Fr,Fr.prototype.nodeType="Noise",Fr.Nodes={checker:new mt(["float checker( vec2 uv ) {","\tfloat cx = floor( uv.x );","\tfloat cy = floor( uv.y ); ","\tfloat result = mod( cx + cy, 2.0 );","\treturn sign( result );","}"].join("\n"))},Fr.prototype.generate=function(e,t){var r=e.include(Fr.Nodes.checker);return e.format(r+"( "+this.uv.build(e,"v2")+" )",this.getType(e),t)},Fr.prototype.copy=function(e){return it.prototype.copy.call(this,e),this.uv=e.uv,this},Fr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid),t},Pr.prototype=Object.create(ot.prototype),Pr.prototype.constructor=Pr,Pr.prototype.nodeType="Matrix4",Object.defineProperties(Pr.prototype,{elements:{set:function(e){this.value.elements=e},get:function(){return this.value.elements}}}),Pr.prototype.generateReadonly=function(e,t,r,n){return e.format("mat4( "+this.value.elements.join(", ")+" )",n,t)},Pr.prototype.copy=function(e){return ot.prototype.copy.call(this,e),this.scope.value.fromArray(e.elements),this},Pr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).elements=this.value.elements.concat()),t},Rr.prototype=Object.create(it.prototype),Rr.prototype.constructor=Rr,Rr.prototype.nodeType="Reflector",Rr.prototype.setMirror=function(e){this.mirror=e,this.textureMatrix=new Pr(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new wt(wt.LOCAL),this.uv=new vt(this.textureMatrix,this.localPosition,vt.MUL),this.uvResult=new vt(null,this.uv,vt.ADD),this.texture=new Ot(this.mirror.material.uniforms.tDiffuse.value,this.uv,null,!0)},Rr.prototype.generate=function(e,t){return e.isShader("fragment")?(this.uvResult.a=this.offset,this.texture.uv=this.offset?this.uvResult:this.uv,"sampler2D"===t?this.texture.build(e,t):e.format(this.texture.build(e,this.type),this.type,t)):(console.warn("THREE.ReflectorNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.type,t))},Rr.prototype.copy=function(e){return ot.prototype.copy.call(this,e),this.scope.mirror=e.mirror,this},Rr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).mirror=this.mirror.uuid,this.offset&&(t.offset=this.offset.toJSON(e).uuid)),t},Lr.prototype=Object.create(ot.prototype),Lr.prototype.constructor=Lr,Lr.prototype.nodeType="Int",Lr.prototype.generateReadonly=function(e,t,r,n){return e.format(this.value,n,t)},Lr.prototype.copy=function(e){return ot.prototype.copy.call(this,e),this.value=e.value,this},Lr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t},Dr.prototype=Object.create(ot.prototype),Dr.prototype.constructor=Dr,Dr.prototype.nodeType="Bool",Dr.prototype.generateReadonly=function(e,t,r,n){return e.format(this.value,n,t)},Dr.prototype.copy=function(e){return ot.prototype.copy.call(this,e),this.value=e.value,this},Dr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t},Nr.prototype=Object.create(Ot.prototype),Nr.prototype.constructor=Nr,Nr.prototype.nodeType="RTT",Nr.prototype.build=function(e,t,r){var n=new jt;return n.nodes=e.nodes,n.updaters=e.updaters,this.material.fragment.value=this.input,this.material.build({builder:n}),Ot.prototype.build.call(this,e,t,r)},Nr.prototype.updateFramesaveTo=function(e){if(this.saveTo.render=!1,this.saveTo!==this.saveToCurrent){this.saveToMaterial&&this.saveToMaterial.dispose();var t=new Wt;t.fragment.value=this,t.build();var r=new a.Scene,n=new a.Mesh(new a.PlaneGeometry(2,2),t);n.frustumCulled=!1,r.add(n),this.saveToScene=r,this.saveToMaterial=t}this.saveToCurrent=this.saveTo,e.renderer.setRenderTarget(this.saveTo.renderTarget),this.saveTo.clear&&e.renderer.clear(),e.renderer.render(this.saveToScene,this.camera)},Nr.prototype.updateFrame=function(e){e.renderer?(this.saveTo&&!1===this.saveTo.render&&this.updateFramesaveTo(e),this.render&&(this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=e.renderTexture),e.renderer.setRenderTarget(this.renderTarget),this.clear&&e.renderer.clear(),e.renderer.render(this.scene,this.camera)),this.saveTo&&!0===this.saveTo.render&&this.updateFramesaveTo(e)):console.warn("RTTNode need a renderer in NodeFrame")},Nr.prototype.copy=function(e){return Ot.prototype.copy.call(this,e),this.saveTo=e.saveTo,this},Nr.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=Ot.prototype.toJSON.call(this,e),this.saveTo&&(t.saveTo=this.saveTo.toJSON(e).uuid)),t};class kr{constructor(){(0,Qe.Z)(this,"pluginCallbacks",void 0),this.pluginCallbacks=[],this.register((function(e){return new ln(e)})),this.register((function(e){return new cn(e)})),this.register((function(e){return new un(e)})),this.register((function(e){return new hn(e)})),this.register((function(e){return new dn(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r){const n=new sn,i=[];for(let o=0,a=this.pluginCallbacks.length;o<a;o++)i.push(this.pluginCallbacks[o](n));n.setPlugins(i),n.write(e,t,r)}}(0,Qe.Z)(kr,"Utils",{insertKeyframe:function(e,t){const r=.001,n=e.getValueSize(),i=new e.TimeBufferType(e.times.length+1),o=new e.ValueBufferType(e.values.length+n),a=e.createInterpolant(new e.ValueBufferType(n));let s;if(0===e.times.length){i[0]=t;for(let e=0;e<n;e++)o[e]=0;s=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<r)return 0;i[0]=t,i.set(e.times,1),o.set(a.evaluate(t),0),o.set(e.values,n),s=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<r)return e.times.length-1;i[i.length-1]=t,i.set(e.times,0),o.set(e.values,0),o.set(a.evaluate(t),e.values.length),s=i.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<r)return l;if(e.times[l]<t&&e.times[l+1]>t){i.set(e.times.slice(0,l+1),0),i[l+1]=t,i.set(e.times.slice(l+1),l+2),o.set(e.values.slice(0,(l+1)*n),0),o.set(a.evaluate(t),(l+1)*n),o.set(e.values.slice((l+1)*n),(l+2)*n),s=l+1;break}}return e.times=i,e.values=o,s},mergeMorphTargetTracks:function(e,t){const r=[],n={},i=e.tracks;for(let o=0;o<i.length;++o){let e=i[o];const s=a.PropertyBinding.parseTrackName(e.name),l=a.PropertyBinding.findNode(t,s.nodeName);if("morphTargetInfluences"!==s.propertyName||void 0===s.propertyIndex){r.push(e);continue}if(e.createInterpolant!==e.InterpolantFactoryMethodDiscrete&&e.createInterpolant!==e.InterpolantFactoryMethodLinear){if(e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),e=e.clone(),e.setInterpolation(a.InterpolateLinear)}const c=l.morphTargetInfluences.length,u=l.morphTargetDictionary[s.propertyIndex];if(void 0===u)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);let h;if(void 0===n[l.uuid]){h=e.clone();const t=new h.ValueBufferType(c*h.times.length);for(let e=0;e<h.times.length;e++)t[e*c+u]=h.values[e];h.name=(s.nodeName||"")+".morphTargetInfluences",h.values=t,n[l.uuid]=h,r.push(h);continue}const d=e.createInterpolant(new e.ValueBufferType(1));h=n[l.uuid];for(let t=0;t<h.times.length;t++)h.values[t*c+u]=d.evaluate(h.times[t]);for(let t=0;t<e.times.length;t++){const r=this.insertKeyframe(h,e.times[t]);h.values[r*c+u]=e.values[t]}}return e.tracks=r,e}});const Or=0,Ur=1,Qr=2,Vr=3,Gr=4,zr=5121,jr=5123,Hr=5126,Wr=5125,Zr=34962,Xr=34963,Yr=9728,Jr=9729,qr=9984,Kr=9985,$r=9986,en=9987,tn=33071,rn=33648,nn=10497,on={};on[a.NearestFilter]=Yr,on[a.NearestMipmapNearestFilter]=qr,on[a.NearestMipmapLinearFilter]=$r,on[a.LinearFilter]=Jr,on[a.LinearMipmapNearestFilter]=Kr,on[a.LinearMipmapLinearFilter]=en,on[a.ClampToEdgeWrapping]=tn,on[a.RepeatWrapping]=nn,on[a.MirroredRepeatWrapping]=rn;const an={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};class sn{constructor(){(0,Qe.Z)(this,"plugins",void 0),(0,Qe.Z)(this,"options",void 0),(0,Qe.Z)(this,"pending",void 0),(0,Qe.Z)(this,"buffers",void 0),(0,Qe.Z)(this,"byteOffset",void 0),(0,Qe.Z)(this,"nodeMap",void 0),(0,Qe.Z)(this,"skins",void 0),(0,Qe.Z)(this,"extensionsUsed",void 0),(0,Qe.Z)(this,"uids",void 0),(0,Qe.Z)(this,"uid",void 0),(0,Qe.Z)(this,"json",void 0),(0,Qe.Z)(this,"cache",void 0),(0,Qe.Z)(this,"cachedCanvas",void 0),this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.cachedCanvas=null}setPlugins(e){this.plugins=e}write(e,t,r){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},r),void 0!==this.options.animations&&this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e);const n=this;Promise.all(this.pending).then((()=>{const e=n.buffers,r=n.json,i=n.options,o=n.extensionsUsed,a=new Blob(e,{type:"application/octet-stream"}),s=Object.keys(o);if(s.length>0&&(r.extensionsUsed=s),r.buffers&&r.buffers.length>0&&(r.buffers[0].byteLength=a.size),i.binary){const e=new window.FileReader;e.readAsArrayBuffer(a),e.onloadend=()=>{if(null!==e.result&&"string"!==typeof e.result){const n=this.getPaddedArrayBuffer(e.result),i=new DataView(new ArrayBuffer(8));i.setUint32(0,n.byteLength,!0),i.setUint32(4,5130562,!0);const o=this.getPaddedArrayBuffer(this.stringToArrayBuffer(JSON.stringify(r)),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,o.byteLength,!0),a.setUint32(4,1313821514,!0);const s=new ArrayBuffer(12),l=new DataView(s);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);const c=12+a.byteLength+o.byteLength+i.byteLength+n.byteLength;l.setUint32(8,c,!0);const u=new Blob([s,a,o,i,n],{type:"application/octet-stream"}),h=new window.FileReader;h.readAsArrayBuffer(u),h.onloadend=function(){null!==h.result&&"string"!==typeof h.result&&t(h.result)}}}}else if(r.buffers&&r.buffers.length>0){const e=new window.FileReader;e.readAsDataURL(a),e.onloadend=function(){const n=e.result;void 0!==r.buffers&&null!==n&&(r.buffers[0].uri=n,t(r))}}else t(r)}))}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const r=this.options,n=this.extensionsUsed;try{const i=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&i.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in i.gltfExtensions)t.extensions[e]=i.gltfExtensions[e],n[e]=!0;delete i.gltfExtensions}Object.keys(i).length>0&&(t.extras=i)}catch(i){i instanceof Error&&console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+i.message)}}getUID(e){return this.uids.has(e)||this.uids.set(e,this.uid++),this.uids.get(e)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new a.Vector3;for(let r=0,n=e.count;r<n;r++)if(Math.abs(t.fromBufferAttribute(e,r).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const r=e.clone(),n=new a.Vector3;for(let i=0,o=r.count;i<o;i++)n.fromBufferAttribute(r,i),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),r.setXYZ(i,n.x,n.y,n.z);return t.attributesNormalized.set(e,r),r}applyTextureTransform(e,t){let r=!1;const n={};0===t.offset.x&&0===t.offset.y||(n.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(n.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(n.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}processBuffer(e){const t=this.json,r=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),r.push(e),0}processBufferView(e,t,r,n,i){const o=this.json;let a;o.bufferViews||(o.bufferViews=[]),a=t===zr?1:t===jr?2:4;const s=this.getPaddedBufferSize(n*e.itemSize*a),l=new DataView(new ArrayBuffer(s));let c=0;for(let h=r;h<r+n;h++)for(let r=0;r<e.itemSize;r++){let n;e.itemSize>4?n=e.array[h*e.itemSize+r]:0===r?n=e.getX(h):1===r?n=e.getY(h):2===r?n=e.getZ(h):3===r&&(n=e.getW(h)),void 0!==n&&(t===Hr?l.setFloat32(c,n,!0):t===Wr?l.setUint32(c,n,!0):t===jr?l.setUint16(c,n,!0):t===zr&&l.setUint8(c,n)),c+=a}const u={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:s};void 0!==i&&(u.target=i),i===Zr&&(u.byteStride=e.itemSize*a),this.byteOffset+=s,o.bufferViews.push(u);return{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,r=t.json;return r.bufferViews||(r.bufferViews=[]),new Promise((n=>{const i=new window.FileReader;i.readAsArrayBuffer(e),i.onloadend=()=>{if(null!==i.result&&"string"!==typeof i.result&&void 0!==r.bufferViews){const e=this.getPaddedArrayBuffer(i.result),o={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,n(r.bufferViews.push(o)-1)}}}))}processAccessor(e,t,r,n){const i=this.options,o=this.json,a={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"};let s;if(e.array.constructor===Float32Array)s=Hr;else if(e.array.constructor===Uint32Array)s=Wr;else if(e.array.constructor===Uint16Array)s=jr;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");s=zr}if(void 0===r&&(r=0),void 0===n&&(n=e.count),i.truncateDrawRange&&void 0!==t&&null===t.index){const i=r+n,o=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;r=Math.max(r,t.drawRange.start),(n=Math.min(i,o)-r)<0&&(n=0)}if(0===n)return null;const l=this.getMinMax(e,r,n);let c;if(void 0!==t&&(c=e===t.index?Xr:Zr),void 0!==c){const t=this.processBufferView(e,s,r,n,c),i={bufferView:t.id,byteOffset:t.byteOffset,componentType:s,count:n,max:l.max,min:l.min,type:a[e.itemSize]};return e.normalized&&(i.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(i)-1}}processImage(e,t,r){const n=this,i=n.cache,o=n.json,s=n.options,l=n.pending;i.images.has(e)||i.images.set(e,{});const c=i.images.get(e),u=t===a.RGBAFormat?"image/png":"image/jpeg",h=u+":flipY/"+r.toString();if(void 0!==c&&void 0!==c[h])return c[h];o.images||(o.images=[]);const d={mimeType:u};if(s.embedImages&&void 0!==s.maxTextureSize){const i=this.cachedCanvas=this.cachedCanvas||document.createElement("canvas");i.width=Math.min(e.width,s.maxTextureSize),i.height=Math.min(e.height,s.maxTextureSize);const o=i.getContext("2d");if(r&&(null===o||void 0===o||o.translate(0,i.height),null===o||void 0===o||o.scale(1,-1)),"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap)null===o||void 0===o||o.drawImage(e,0,0,i.width,i.height);else{t!==a.RGBAFormat&&console.error("GLTFExporter: Only RGBA format is supported."),(e.width>s.maxTextureSize||e.height>s.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const r=new Uint8ClampedArray(e.height*e.width*4);if(e instanceof ImageData)for(let t=0;t<r.length;t+=4)r[t+0]=e.data[t+0],r[t+1]=e.data[t+1],r[t+2]=e.data[t+2],r[t+3]=e.data[t+3];null===o||void 0===o||o.putImageData(new ImageData(r,e.width,e.height),0,0)}s.binary?l.push(new Promise((function(e){i.toBlob((function(t){null!==t&&n.processBufferViewImage(t).then((function(t){d.bufferView=t,e()}))}),u)}))):d.uri=i.toDataURL(u)}else e instanceof Image&&(d.uri=e.src);const f=o.images.push(d)-1;return void 0!==c&&(c[h]=f),f}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const r={magFilter:on[e.magFilter],minFilter:on[e.minFilter],wrapS:on[e.wrapS],wrapT:on[e.wrapT]};return t.samplers.push(r)-1}processTexture(e){const t=this.cache,r=this.json;if(t.textures.has(e))return t.textures.get(e);r.textures||(r.textures=[]);const n={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY)};e.name&&(n.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,n)}));const i=r.textures.push(n)-1;return t.textures.set(e,i),i}processMaterial(e){const t=this.cache,r=this.json;if(t.materials.has(e))return t.materials.get(e);if(e instanceof a.ShaderMaterial&&e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;r.materials||(r.materials=[]);const n={pbrMetallicRoughness:{}};if(e instanceof a.MeshStandardMaterial&&e.isMeshStandardMaterial&&e instanceof a.MeshBasicMaterial&&e.isMeshBasicMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results."),e instanceof a.MeshStandardMaterial||e instanceof a.MeshPhysicalMaterial){const t=e.color.toArray().concat([e.opacity]);this.equalArray(t,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=t)}if(e instanceof a.MeshStandardMaterial&&e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5),e instanceof a.MeshStandardMaterial&&e.metalnessMap||e instanceof a.MeshStandardMaterial&&e.roughnessMap)if(e.metalnessMap===e.roughnessMap&&null!==e.metalnessMap){const t={index:this.processTexture(e.metalnessMap)};this.applyTextureTransform(t,e.metalnessMap),n.pbrMetallicRoughness.metallicRoughnessTexture=t}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if((e instanceof a.MeshStandardMaterial||e instanceof a.MeshPhysicalMaterial)&&e.map){const t={index:this.processTexture(e.map)};this.applyTextureTransform(t,e.map),n.pbrMetallicRoughness.baseColorTexture=t}if((e instanceof a.MeshStandardMaterial||e instanceof a.MeshPhysicalMaterial)&&e.emissive){const t=e.emissive.clone().multiplyScalar(e.emissiveIntensity),r=Math.max(t.r,t.g,t.b);if(r>1&&(t.multiplyScalar(1/r),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),r>0&&(n.emissiveFactor=t.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(t,e.emissiveMap),n.emissiveTexture=t}}if((e instanceof a.MeshMatcapMaterial||e instanceof a.MeshNormalMaterial||e instanceof a.MeshPhongMaterial||e instanceof a.MeshStandardMaterial||e instanceof a.MeshToonMaterial)&&e.normalMap){const t={index:this.processTexture(e.normalMap)};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),n.normalTexture=t}if((e instanceof a.MeshBasicMaterial||e instanceof a.MeshLambertMaterial||e instanceof a.MeshPhongMaterial||e instanceof a.MeshStandardMaterial||e instanceof a.MeshToonMaterial)&&e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),n.occlusionTexture=t}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===a.DoubleSide&&(n.doubleSided=!0),""!==e.name&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,n)}));const i=r.materials.push(n)-1;return t.materials.set(e,i),i}processMesh(e){const t=this.cache,r=this.json,n=[e.geometry.uuid];if(Array.isArray(e.material))for(let a=0,y=e.material.length;a<y;a++)n.push(e.material[a].uuid);else n.push(e.material.uuid);const i=n.join(":");if(t.meshes.has(i))return t.meshes.get(i);const o=e.geometry;let s;if(s=e instanceof a.LineSegments&&e.isLineSegments?Ur:e instanceof a.LineLoop&&e.isLineLoop?Qr:e instanceof a.Line&&e.isLine?Vr:e instanceof a.Points&&e.isPoints?Or:(e.material instanceof a.MeshBasicMaterial||e.material instanceof a.MeshDepthMaterial||e.material instanceof a.MeshLambertMaterial||e.material instanceof a.MeshNormalMaterial||e.material instanceof a.MeshPhongMaterial||e.material instanceof a.MeshStandardMaterial||e.material instanceof a.MeshToonMaterial||e.material instanceof a.ShaderMaterial)&&e.material.wireframe?Ur:Gr,!o.isBufferGeometry)throw new Error("THREE.GLTFExporter: Geometry is not of type THREE.BufferGeometry.");const l={},c={},u=[],h=[],d={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},f=o.getAttribute("normal");void 0===f||f instanceof a.InterleavedBufferAttribute||this.isNormalizedNormalAttribute(f)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(f)));let p=null;for(let y in o.attributes){if("morph"===y.substr(0,5))continue;const e=o.attributes[y];y=d[y]||y.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),t.attributes.has(this.getUID(e))){c[y]=t.attributes.get(this.getUID(e));continue}p=null;const r=e.array;"JOINTS_0"!==y||r instanceof Uint16Array||r instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new a.BufferAttribute(new Uint16Array(r),e.itemSize,e.normalized));const n=null!==p&&this.processAccessor(p||e,o);n&&(c[y]=n,t.attributes.set(this.getUID(e),n))}if(void 0!==f&&o.setAttribute("normal",f),0===Object.keys(c).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const r=[],n=[],i={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)i[e.morphTargetDictionary[t]]=t;for(let a=0;a<e.morphTargetInfluences.length;++a){const s={};let l=!1;for(const e in o.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const r=o.morphAttributes[e][a],n=e.toUpperCase(),i=o.attributes[e];if(t.attributes.has(this.getUID(r))){s[n]=t.attributes.get(this.getUID(r));continue}const c=r.clone();if(!o.morphTargetsRelative)for(let e=0,t=r.count;e<t;e++)c.setXYZ(e,r.getX(e)-i.getX(e),r.getY(e)-i.getY(e),r.getZ(e)-i.getZ(e));const u=this.processAccessor(c,o);void 0!=u&&(s[n]=u),t.attributes.set(this.getUID(i),s[n])}h.push(s),r.push(e.morphTargetInfluences[a]),void 0!==e.morphTargetDictionary&&n.push(i[a])}l.weights=r,n.length>0&&(l.extras={},l.extras.targetNames=n)}const m=Array.isArray(e.material);if(m&&0===o.groups.length)return null;const g=m?e.material:[e.material],A=m?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let y=0,x=A.length;y<x;y++){const e={mode:s,attributes:c};if((o instanceof a.Object3D||o instanceof a.Material)&&this.serializeUserData(o,e),h.length>0&&(e.targets=h),null!==o.index){let r=this.getUID(o.index);void 0===A[y].start&&void 0===A[y].count||(r+=`:${A[y].start}:${A[y].count}`),t.attributes.has(r)?e.indices=t.attributes.get(r):(e.indices=this.processAccessor(o.index,o,A[y].start,A[y].count),t.attributes.set(r,e.indices)),null===e.indices&&delete e.indices}const r=A[y].materialIndex;if(void 0!==r&&Array.isArray(g)){const t=g[r];if(!Array.isArray(t)){const r=this.processMaterial(t);null!==r&&(e.material=r),u.push(e)}}}l.primitives=u,r.meshes||(r.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,l)}));const v=r.meshes.push(l)-1;return t.meshes.set(i,v),v}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const r=e instanceof a.OrthographicCamera&&e.isOrthographicCamera,n={type:r?"orthographic":"perspective"};return e instanceof a.OrthographicCamera&&r?n.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:e instanceof a.PerspectiveCamera&&(n.perspective={aspectRatio:e.aspect,yfov:a.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}),""!==e.name&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){const r=this.json,n=this.nodeMap;r.animations||(r.animations=[]);const i=(e=kr.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,o=[],s=[];for(let l=0;l<i.length;++l){const e=i[l],r=a.PropertyBinding.parseTrackName(e.name);let c=a.PropertyBinding.findNode(t,r.nodeName);const u=an[r.propertyName];if("bones"===r.objectName&&(c=c.isSkinnedMesh?c.skeleton.getBoneByName(r.objectIndex):void 0),!c||!u)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',e.name),null;const h=1;let d,f=e.values.length/e.times.length;u===an.morphTargetInfluences&&(f/=c.morphTargetInfluences.length),e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(d="CUBICSPLINE",f/=3):d=e.getInterpolation()===a.InterpolateDiscrete?"STEP":"LINEAR",s.push({input:this.processAccessor(new a.BufferAttribute(e.times,h)),output:this.processAccessor(new a.BufferAttribute(e.values,f)),interpolation:d}),o.push({sampler:s.length-1,target:{node:n.get(c),path:u}})}return r.animations.push({name:e.name||"clip_"+r.animations.length,samplers:s,channels:o}),r.animations.length-1}processSkin(e){const t=this.json,r=this.nodeMap;if(void 0!==t.nodes&&e instanceof a.SkinnedMesh){const n=t.nodes[r.get(e)],i=e.skeleton;if(void 0===i)return null;const o=e.skeleton.bones[0];if(void 0===o)return null;const s=[],l=new Float32Array(16*i.bones.length),c=new a.Matrix4;for(let t=0;t<i.bones.length;++t)s.push(r.get(i.bones[t])),c.copy(i.boneInverses[t]),c.multiply(e.bindMatrix).toArray(l,16*t);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new a.BufferAttribute(l,16)),joints:s,skeleton:r.get(o)});return n.skin=t.skins.length-1}return null}processNode(e){const t=this.json,r=this.options,n=this.nodeMap;t.nodes||(t.nodes=[]);const i={};if(r.trs){const t=e.quaternion.toArray(),r=e.position.toArray(),n=e.scale.toArray();this.equalArray(t,[0,0,0,1])||(i.rotation=t),this.equalArray(r,[0,0,0])||(i.translation=r),this.equalArray(n,[1,1,1])||(i.scale=n)}else e.matrixAutoUpdate&&e.updateMatrix(),this.isIdentityMatrix(e.matrix)||(i.matrix=e.matrix.elements);if(""!==e.name&&(i.name=String(e.name)),this.serializeUserData(e,i),(e instanceof a.Mesh&&e.isMesh||e instanceof a.Line&&e.isLine||e instanceof a.Points&&e.isPoints)&&e instanceof a.Mesh){const t=this.processMesh(e);null!==t&&(i.mesh=t)}else e instanceof a.Camera&&e.isCamera&&(i.camera=this.processCamera(e));if(e instanceof a.SkinnedMesh&&e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let n=0,i=e.children.length;n<i;n++){const i=e.children[n];if(i.visible||!r.onlyVisible){const e=this.processNode(i);null!==e&&t.push(e)}}t.length>0&&(i.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,i)}));const o=t.nodes.push(i)-1;return n.set(e,o),o}processScene(e){const t=this.json,r=this.options;t.scenes||(t.scenes=[],t.scene=0);const n={};""!==e.name&&(n.name=e.name),t.scenes.push(n);const i=[];for(let o=0,a=e.children.length;o<a;o++){const t=e.children[o];if(t.visible||!r.onlyVisible){const e=this.processNode(t);null!==e&&i.push(e)}}i.length>0&&(n.nodes=i),this.serializeUserData(e,n)}processObjects(e){const t=new a.Scene;t.name="AuxScene";for(let r=0;r<e.length;r++)t.children.push(e[r]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const r=[];for(let n=0;n<e.length;n++){const t=e[n];t instanceof a.Scene?this.processScene(t):r.push(e[n])}r.length>0&&this.processObjects(r);for(let n=0;n<this.skins.length;++n)this.processSkin(this.skins[n]);for(let n=0;void 0!==t.animations&&n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,r=this.plugins.length;t<r;t++)e(this.plugins[t])}equalArray(e,t){return e.length===t.length&&e.every((function(e,r){return e===t[r]}))}stringToArrayBuffer(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;const t=new Uint8Array(new ArrayBuffer(e.length));for(let r=0,n=e.length;r<n;r++){const n=e.charCodeAt(r);t[r]=n>255?32:n}return t.buffer}isIdentityMatrix(e){return this.equalArray(e.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}getMinMax(e,t,r){const n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=t;i<t+r;i++)for(let t=0;t<e.itemSize;t++){let r;e.itemSize>4?r=e.array[i*e.itemSize+t]:0===t?r=e.getX(i):1===t?r=e.getY(i):2===t?r=e.getZ(i):3===t&&(r=e.getW(i)),void 0!==r&&(n.min[t]=Math.min(n.min[t],r),n.max[t]=Math.max(n.max[t],r))}return n}getPaddedBufferSize(e){return 4*Math.ceil(e/4)}getPaddedArrayBuffer(e,t=0){const r=this.getPaddedBufferSize(e.byteLength);if(r!==e.byteLength){const n=new Uint8Array(r);if(n.set(new Uint8Array(e)),0!==t)for(let i=e.byteLength;i<r;i++)n[i]=t;return n.buffer}return e}}class ln{constructor(e){(0,Qe.Z)(this,"writer",void 0),(0,Qe.Z)(this,"name",void 0),this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!(e instanceof a.DirectionalLight&&e.isDirectionalLight)&&!(e instanceof a.PointLight&&e.isPointLight)&&!(e instanceof a.SpotLight&&e.isSpotLight))return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const r=this.writer,n=r.json,i=r.extensionsUsed,o={};if(e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e instanceof a.DirectionalLight&&e.isDirectionalLight?o.type="directional":e instanceof a.PointLight&&e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e instanceof a.SpotLight&&e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,o.spot.outerConeAngle=e.angle),e instanceof a.DirectionalLight||void 0===e.decay||2===e.decay||console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e instanceof a.PointLight||!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),i[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},i[this.name]=!0),void 0!==n.extensions){const e=n.extensions[this.name].lights;e.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:e.length-1}}}}class cn{constructor(e){(0,Qe.Z)(this,"writer",void 0),(0,Qe.Z)(this,"name",void 0),this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!(e instanceof a.MeshBasicMaterial&&e.isMeshBasicMaterial))return;const r=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class un{constructor(e){(0,Qe.Z)(this,"writer",void 0),(0,Qe.Z)(this,"name",void 0),this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const r=this.writer,n=r.extensionsUsed,i={};if(t.pbrMetallicRoughness.baseColorFactor&&(i.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor),e instanceof a.MeshPhongMaterial){const t=[1,1,1];e.specular.toArray(t,0),i.specularFactor=t,i.glossinessFactor=e.glossiness}if(t.pbrMetallicRoughness.baseColorTexture&&(i.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),(e instanceof a.MeshBasicMaterial||e instanceof a.MeshLambertMaterial||e instanceof a.MeshPhongMaterial)&&e.specularMap){const t={index:r.processTexture(e.specularMap)};r.applyTextureTransform(t,e.specularMap),i.specularGlossinessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class hn{constructor(e){(0,Qe.Z)(this,"writer",void 0),(0,Qe.Z)(this,"name",void 0),this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!(e instanceof a.MeshPhysicalMaterial&&e.isMeshPhysicalMaterial)||0===e.transmission)return;const r=this.writer,n=r.extensionsUsed,i={};if(i.transmissionFactor=e.transmission,e.transmissionMap){const t={index:r.processTexture(e.transmissionMap)};r.applyTextureTransform(t,e.transmissionMap),i.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class dn{constructor(e){(0,Qe.Z)(this,"writer",void 0),(0,Qe.Z)(this,"name",void 0),this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!(e instanceof a.MeshPhysicalMaterial&&e.isMeshPhysicalMaterial)||0===e.thickness)return;const r=this.writer,n=r.extensionsUsed,i={};if(i.thickness=e.thickness,e.thicknessMap){const t={index:r.processTexture(e.thicknessMap)};r.applyTextureTransform(t,e.thicknessMap),i.thicknessTexture=t}i.attenuationDistance=e.attenuationDistance,i.attenuationColor=e.attenuationTint.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}var fn=r(6782);class pn{constructor(){(0,Qe.Z)(this,"PRECISION",7),(0,Qe.Z)(this,"materials",void 0),(0,Qe.Z)(this,"textures",void 0),(0,Qe.Z)(this,"files",void 0),this.materials={},this.textures={},this.files={}}async parse(e){this.files["model.usda"]=null;let t=this.buildHeader();e.traverseVisible((e=>{if(e instanceof a.Mesh&&e.isMesh&&e.material.isMeshStandardMaterial){const r=e.geometry,n=e.material,i="geometries/Geometry_"+r.id+".usd";if(!(i in this.files)){const e=this.buildMeshObject(r);this.files[i]=this.buildUSDFileAsString(e)}n.uuid in this.materials||(this.materials[n.uuid]=n),t+=this.buildXform(e,r,n)}})),t+=this.buildMaterials(this.materials),this.files["model.usda"]=(0,fn.TD)(t),t=null;for(const n in this.textures){const e=this.textures[n],t=n.split("_")[1],r=1023===e.format,i=this.imageToCanvas(e.image,t),o=await new Promise((e=>null===i||void 0===i?void 0:i.toBlob(e,r?"image/png":"image/jpeg",1)));o&&(this.files[`textures/Texture_${n}.${r?"png":"jpg"}`]=new Uint8Array(await o.arrayBuffer()))}let r=0;for(const n in this.files){const e=this.files[n];r+=34+n.length;const t=63&r;if(4!==t&&null!==e&&e instanceof Uint8Array){const r=new Uint8Array(64-t);this.files[n]=[e,{extra:{12345:r}}]}e&&"number"===typeof e.length&&(r=e.length)}return(0,fn.Xo)(this.files,{level:0})}imageToCanvas(e,t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const r=1024/Math.max(e.width,e.height),n=document.createElement("canvas");n.width=e.width*Math.min(1,r),n.height=e.height*Math.min(1,r);const i=n.getContext("2d");if(null===i||void 0===i||i.drawImage(e,0,0,n.width,n.height),void 0!==t){const e=parseInt(t,16),r=(e>>16&255)/255,o=(e>>8&255)/255,a=(255&e)/255,s=null===i||void 0===i?void 0:i.getImageData(0,0,n.width,n.height);if(s){const e=null===s||void 0===s?void 0:s.data;for(let t=0;t<e.length;t+=4)e[t+0]=e[t+0]*r,e[t+1]=e[t+1]*o,e[t+2]=e[t+2]*a;null===i||void 0===i||i.putImageData(s,0,0)}}return n}}buildHeader(){return'#usda 1.0\n(\n    customLayerData = {\n        string creator = "Three.js USDZExporter"\n    }\n    metersPerUnit = 1\n    upAxis = "Y"\n)\n'}buildUSDFileAsString(e){let t=this.buildHeader();return t+=e,(0,fn.TD)(t)}buildXform(e,t,r){const n="Object_"+e.id,i=this.buildMatrix(e.matrixWorld);return e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e),`def Xform "${n}" (\n    prepend references = @./geometries/Geometry_${t.id}.usd@</Geometry>\n)\n{\n    matrix4d xformOp:transform = ${i}\n    uniform token[] xformOpOrder = ["xformOp:transform"]\n    rel material:binding = </Materials/Material_${r.id}>\n}\n`}buildMatrix(e){const t=e.elements;return`( ${this.buildMatrixRow(t,0)}, ${this.buildMatrixRow(t,4)}, ${this.buildMatrixRow(t,8)}, ${this.buildMatrixRow(t,12)} )`}buildMatrixRow(e,t){return`(${e[t+0]}, ${e[t+1]}, ${e[t+2]}, ${e[t+3]})`}buildMeshObject(e){return`\ndef "Geometry"\n{\n  ${this.buildMesh(e)}\n}\n`}buildMesh(e){const t=e.attributes,r=t.position.count;return`\n    def Mesh "Geometry"\n    {\n        int[] faceVertexCounts = [${this.buildMeshVertexCount(e)}]\n        int[] faceVertexIndices = [${this.buildMeshVertexIndices(e)}]\n        normal3f[] normals = [${this.buildVector3Array(t.normal,r)}] (\n            interpolation = "vertex"\n        )\n        point3f[] points = [${this.buildVector3Array(t.position,r)}]\n        float2[] primvars:st = [${this.buildVector2Array(t.uv,r)}] (\n            interpolation = "vertex"\n        )\n        uniform token subdivisionScheme = "none"\n    }\n`}buildMeshVertexCount(e){const t=null!==e.index?e.index.array.length:e.attributes.position.count;return Array(t/3).fill(3).join(", ")}buildMeshVertexIndices(e){if(null!==e.index)return e.index.array.join(", ");const t=[],r=e.attributes.position.count;for(let n=0;n<r;n++)t.push(n);return t.join(", ")}buildVector3Array(e,t){if(void 0===e)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");const r=[],n=e.array;for(let i=0;i<n.length;i+=3)r.push(`(${n[i+0].toPrecision(this.PRECISION)}, ${n[i+1].toPrecision(this.PRECISION)}, ${n[i+2].toPrecision(this.PRECISION)})`);return r.join(", ")}buildVector2Array(e,t){if(void 0===e)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");const r=[],n=e.array;for(let i=0;i<n.length;i+=2)r.push(`(${n[i+0].toPrecision(this.PRECISION)}, ${1-n[i+1].toPrecision(this.PRECISION)})`);return r.join(", ")}buildMaterials(e){const t=[];for(const r in e){const n=e[r];t.push(this.buildMaterial(n))}return`def "Materials"\n{\n${t.join("")}\n}\n`}buildMaterial(e){const t="            ",r=[],n=[];return null!==e.map?(r.push(`${t}color3f inputs:diffuseColor.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:rgb>`),n.push(this.buildTexture(e,e.map,"diffuse",e.color))):r.push(`${t}color3f inputs:diffuseColor = ${this.buildColor(e.color)}`),null!==e.emissiveMap?(r.push(`${t}color3f inputs:emissiveColor.connect = </Materials/Material_${e.id}/Texture_${e.emissiveMap.id}_emissive.outputs:rgb>`),n.push(this.buildTexture(e,e.emissiveMap,"emissive"))):e.emissive.getHex()>0&&r.push(`${t}color3f inputs:emissiveColor = ${this.buildColor(e.emissive)}`),null!==e.normalMap&&(r.push(`${t}normal3f inputs:normal.connect = </Materials/Material_${e.id}/Texture_${e.normalMap.id}_normal.outputs:rgb>`),n.push(this.buildTexture(e,e.normalMap,"normal"))),null!==e.aoMap&&(r.push(`${t}float inputs:occlusion.connect = </Materials/Material_${e.id}/Texture_${e.aoMap.id}_occlusion.outputs:r>`),n.push(this.buildTexture(e,e.aoMap,"occlusion"))),null!==e.roughnessMap&&1===e.roughness?(r.push(`${t}float inputs:roughness.connect = </Materials/Material_${e.id}/Texture_${e.roughnessMap.id}_roughness.outputs:g>`),n.push(this.buildTexture(e,e.roughnessMap,"roughness"))):r.push(`${t}float inputs:roughness = ${e.roughness}`),null!==e.metalnessMap&&1===e.metalness?(r.push(`${t}float inputs:metallic.connect = </Materials/Material_${e.id}/Texture_${e.metalnessMap.id}_metallic.outputs:b>`),n.push(this.buildTexture(e,e.metalnessMap,"metallic"))):r.push(`${t}float inputs:metallic = ${e.metalness}`),r.push(`${t}float inputs:opacity = ${e.opacity}`),e instanceof a.MeshPhysicalMaterial&&(r.push(`${t}float inputs:clearcoat = ${e.clearcoat}`),r.push(`${t}float inputs:clearcoatRoughness = ${e.clearcoatRoughness}`),r.push(`${t}float inputs:ior = ${e.ior}`)),`\n    def Material "Material_${e.id}"\n    {\n        def Shader "PreviewSurface"\n        {\n            uniform token info:id = "UsdPreviewSurface"\n${r.join("\n")}\n            int inputs:useSpecularWorkflow = 0\n            token outputs:surface\n        }\n        token outputs:surface.connect = </Materials/Material_${e.id}/PreviewSurface.outputs:surface>\n        token inputs:frame:stPrimvarName = "st"\n        def Shader "uvReader_st"\n        {\n            uniform token info:id = "UsdPrimvarReader_float2"\n            token inputs:varname.connect = </Materials/Material_${e.id}.inputs:frame:stPrimvarName>\n            float2 inputs:fallback = (0.0, 0.0)\n            float2 outputs:result\n        }\n${n.join("\n")}\n    }\n`}buildTexture(e,t,r,n){const i=t.id+(n?"_"+n.getHexString():""),o=1023===t.format;return this.textures[i]=t,`\n      def Shader "Transform2d_${r}" (\n          sdrMetadata = {\n              string role = "math"\n          }\n      )\n      {\n          uniform token info:id = "UsdTransform2d"\n          float2 inputs:in.connect = </Materials/Material_${e.id}/uvReader_st.outputs:result>\n          float2 inputs:scale = ${this.buildVector2(t.repeat)}\n          float2 inputs:translation = ${this.buildVector2(t.offset)}\n          float2 outputs:result\n      }\n      def Shader "Texture_${t.id}_${r}"\n      {\n          uniform token info:id = "UsdUVTexture"\n          asset inputs:file = @textures/Texture_${i}.${o?"png":"jpg"}@\n          float2 inputs:st.connect = </Materials/Material_${e.id}/Transform2d_${r}.outputs:result>\n          token inputs:wrapS = "repeat"\n          token inputs:wrapT = "repeat"\n          float outputs:r\n          float outputs:g\n          float outputs:b\n          float3 outputs:rgb\n      }`}buildColor(e){return`(${e.r}, ${e.g}, ${e.b})`}buildVector2(e){return`(${e.x}, ${e.y})`}}class mn{parse(e,t,r){t&&"object"===typeof t&&(console.warn('THREE.PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),r=t,t=void 0);const n=(r=Object.assign({binary:!1,excludeAttributes:[],littleEndian:!1},r)).excludeAttributes;let i=!1,o=!1,s=!1,l=0,c=0;e.traverse((function(e){if(e instanceof a.Mesh&&e.isMesh){const t=e.geometry;if(!t.isBufferGeometry)throw new Error("THREE.PLYExporter: Geometry is not of type THREE.BufferGeometry.");const r=t.getAttribute("position"),n=t.getAttribute("normal"),a=t.getAttribute("uv"),u=t.getAttribute("color"),h=t.getIndex();if(void 0===r)return;l+=r.count,c+=h?h.count/3:r.count/3,void 0!==n&&(i=!0),void 0!==a&&(s=!0),void 0!==u&&(o=!0)}}));const u=-1===(null===n||void 0===n?void 0:n.indexOf("index"));if(i=i&&-1===(null===n||void 0===n?void 0:n.indexOf("normal")),o=o&&-1===(null===n||void 0===n?void 0:n.indexOf("color")),s=s&&-1===(null===n||void 0===n?void 0:n.indexOf("uv")),u&&c!==Math.floor(c))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;let h=`ply\nformat ${r.binary?r.littleEndian?"binary_little_endian":"binary_big_endian":"ascii"} 1.0\nelement vertex ${l}\nproperty float x\nproperty float y\nproperty float z\n`;i&&(h+="property float nx\nproperty float ny\nproperty float nz\n"),s&&(h+="property float s\nproperty float t\n"),o&&(h+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),u&&(h+=`element face ${c}\nproperty list uchar int vertex_index\n`),h+="end_header\n";const d=new a.Vector3,f=new a.Matrix3;let p=null;if(r.binary){const t=(new TextEncoder).encode(h),n=l*(12+(i?12:0)+(o?3:0)+(s?8:0)),a=u?13*c:0,m=new DataView(new ArrayBuffer(t.length+n+a));new Uint8Array(m.buffer).set(t,0);let g=t.length,A=t.length+n,v=0;this.traverseMeshes(e,(function(e,t){const n=t.getAttribute("position"),a=t.getAttribute("normal"),l=t.getAttribute("uv"),c=t.getAttribute("color"),h=t.getIndex();f.getNormalMatrix(e.matrixWorld);for(let u=0,p=n.count;u<p;u++)d.x=n.getX(u),d.y=n.getY(u),d.z=n.getZ(u),d.applyMatrix4(e.matrixWorld),m.setFloat32(g,d.x,r.littleEndian),g+=4,m.setFloat32(g,d.y,r.littleEndian),g+=4,m.setFloat32(g,d.z,r.littleEndian),g+=4,i&&(null!=a?(d.x=a.getX(u),d.y=a.getY(u),d.z=a.getZ(u),d.applyMatrix3(f).normalize(),m.setFloat32(g,d.x,r.littleEndian),g+=4,m.setFloat32(g,d.y,r.littleEndian),g+=4,m.setFloat32(g,d.z,r.littleEndian),g+=4):(m.setFloat32(g,0,r.littleEndian),g+=4,m.setFloat32(g,0,r.littleEndian),g+=4,m.setFloat32(g,0,r.littleEndian),g+=4)),s&&(null!=l?(m.setFloat32(g,l.getX(u),r.littleEndian),g+=4,m.setFloat32(g,l.getY(u),r.littleEndian),g+=4):s||(m.setFloat32(g,0,r.littleEndian),g+=4,m.setFloat32(g,0,r.littleEndian),g+=4)),o&&(null!=c?(m.setUint8(g,Math.floor(255*c.getX(u))),g+=1,m.setUint8(g,Math.floor(255*c.getY(u))),g+=1,m.setUint8(g,Math.floor(255*c.getZ(u))),g+=1):(m.setUint8(g,255),g+=1,m.setUint8(g,255),g+=1,m.setUint8(g,255),g+=1));if(u)if(null!==h)for(let i=0,o=h.count;i<o;i+=3)m.setUint8(A,3),A+=1,m.setUint32(A,h.getX(i+0)+v,r.littleEndian),A+=4,m.setUint32(A,h.getX(i+1)+v,r.littleEndian),A+=4,m.setUint32(A,h.getX(i+2)+v,r.littleEndian),A+=4;else for(let i=0,o=n.count;i<o;i+=3)m.setUint8(A,3),A+=1,m.setUint32(A,v+i,r.littleEndian),A+=4,m.setUint32(A,v+i+1,r.littleEndian),A+=4,m.setUint32(A,v+i+2,r.littleEndian),A+=4;v+=n.count})),p=m.buffer}else{let t=0,r="",n="";this.traverseMeshes(e,(function(e,a){const l=a.getAttribute("position"),h=a.getAttribute("normal"),p=a.getAttribute("uv"),m=a.getAttribute("color"),g=a.getIndex();f.getNormalMatrix(e.matrixWorld);for(let t=0,n=l.count;t<n;t++){d.x=l.getX(t),d.y=l.getY(t),d.z=l.getZ(t),d.applyMatrix4(e.matrixWorld);let n=d.x+" "+d.y+" "+d.z;i&&(null!=h?(d.x=h.getX(t),d.y=h.getY(t),d.z=h.getZ(t),d.applyMatrix3(f).normalize(),n+=" "+d.x+" "+d.y+" "+d.z):n+=" 0 0 0"),s&&(null!=p?n+=" "+p.getX(t)+" "+p.getY(t):s&&(n+=" 0 0")),o&&(n+=null!=m?" "+Math.floor(255*m.getX(t))+" "+Math.floor(255*m.getY(t))+" "+Math.floor(255*m.getZ(t)):" 255 255 255"),r+=n+"\n"}if(u){if(null!==g)for(let e=0,r=g.count;e<r;e+=3)n+=`3 ${g.getX(e+0)+t}`,n+=` ${g.getX(e+1)+t}`,n+=` ${g.getX(e+2)+t}\n`;else for(let e=0,r=l.count;e<r;e+=3)n+=`3 ${t+e} ${t+e+1} ${t+e+2}\n`;c+=g?g.count/3:l.count/3}t+=l.count})),p=`${h}${r}${u?`${n}\n`:"\n"}`}return"function"===typeof t&&requestAnimationFrame((()=>t&&t("string"===typeof p?p:""))),p}traverseMeshes(e,t){e.traverse((function(e){if(e instanceof a.Mesh&&e.isMesh){const r=e,n=r.geometry;if(!n.isBufferGeometry)throw new Error("THREE.PLYExporter: Geometry is not of type THREE.BufferGeometry.");n.hasAttribute("position")&&t(r,n)}}))}}class gn{parse(e,t={decodeSpeed:5,encodeSpeed:5,encoderMethod:gn.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:!1}){if(e instanceof a.BufferGeometry&&e.isBufferGeometry)throw new Error("DRACOExporter: The first parameter of parse() is now an instance of Mesh or Points.");if(void 0===DracoEncoderModule)throw new Error("THREE.DRACOExporter: required the draco_encoder to work.");const r=e.geometry,n=DracoEncoderModule(),i=new n.Encoder;let o,s;if(!r.isBufferGeometry)throw new Error("THREE.DRACOExporter.parse(geometry, options): geometry is not a THREE.BufferGeometry instance.");if(e instanceof a.Mesh&&e.isMesh){o=new n.MeshBuilder,s=new n.Mesh;const e=r.getAttribute("position");o.AddFloatAttributeToMesh(s,n.POSITION,e.count,e.itemSize,e.array);const i=r.getIndex();if(null!==i)o.AddFacesToMesh(s,i.count/3,i.array);else{const t=new(e.count>65535?Uint32Array:Uint16Array)(e.count);for(let e=0;e<t.length;e++)t[e]=e;o.AddFacesToMesh(s,e.count,t)}if(t.exportNormals){const e=r.getAttribute("normal");void 0!==e&&o.AddFloatAttributeToMesh(s,n.NORMAL,e.count,e.itemSize,e.array)}if(t.exportUvs){const e=r.getAttribute("uv");void 0!==e&&o.AddFloatAttributeToMesh(s,n.TEX_COORD,e.count,e.itemSize,e.array)}if(t.exportColor){const e=r.getAttribute("color");void 0!==e&&o.AddFloatAttributeToMesh(s,n.COLOR,e.count,e.itemSize,e.array)}}else{if(!(e instanceof a.Points&&e.isPoints))throw new Error("DRACOExporter: Unsupported object type.");{o=new n.PointCloudBuilder,s=new n.PointCloud;const e=r.getAttribute("position");if(o.AddFloatAttribute(s,n.POSITION,e.count,e.itemSize,e.array),t.exportColor){const e=r.getAttribute("color");void 0!==e&&o.AddFloatAttribute(s,n.COLOR,e.count,e.itemSize,e.array)}}}const l=new n.DracoInt8Array,c=void 0!==t.encodeSpeed?t.encodeSpeed:5,u=void 0!==t.decodeSpeed?t.decodeSpeed:5;if(i.SetSpeedOptions(c,u),void 0!==t.encoderMethod&&i.SetEncodingMethod(t.encoderMethod),void 0!==t.quantization)for(let a=0;a<5;a++)void 0!==t.quantization[a]&&i.SetAttributeQuantization(a,t.quantization[a]);let h;if(h=e instanceof a.Mesh&&e.isMesh?i.EncodeMeshToDracoBuffer(s,l):i.EncodePointCloudToDracoBuffer(s,!0,l),n.destroy(s),0===h)throw new Error("THREE.DRACOExporter: Draco encoding failed.");const d=new Int8Array(new ArrayBuffer(h));for(let a=0;a<h;a++)d[a]=l.GetValue(a);return n.destroy(l),n.destroy(i),n.destroy(o),d}}(0,Qe.Z)(gn,"MESH_EDGEBREAKER_ENCODING",1),(0,Qe.Z)(gn,"MESH_SEQUENTIAL_ENCODING",0),(0,Qe.Z)(gn,"POINT_CLOUD",0),(0,Qe.Z)(gn,"TRIANGULAR_MESH",1),(0,Qe.Z)(gn,"INVALID",-1),(0,Qe.Z)(gn,"POSITION",0),(0,Qe.Z)(gn,"NORMAL",1),(0,Qe.Z)(gn,"COLOR",2),(0,Qe.Z)(gn,"TEX_COORD",3),(0,Qe.Z)(gn,"GENERIC",4);class An{constructor(){(0,Qe.Z)(this,"options",void 0),(0,Qe.Z)(this,"geometryInfo",void 0),(0,Qe.Z)(this,"materialMap",void 0),(0,Qe.Z)(this,"imageMap",void 0),(0,Qe.Z)(this,"textures",void 0),(0,Qe.Z)(this,"libraryImages",void 0),(0,Qe.Z)(this,"libraryGeometries",void 0),(0,Qe.Z)(this,"libraryEffects",void 0),(0,Qe.Z)(this,"libraryMaterials",void 0),(0,Qe.Z)(this,"canvas",void 0),(0,Qe.Z)(this,"ctx",void 0),(0,Qe.Z)(this,"transMat",void 0),(0,Qe.Z)(this,"getFuncs",["getX","getY","getZ","getW"]),this.options={version:"1.4.1",author:null,textureDirectory:"",upAxis:"Y_UP",unitName:null,unitMeter:null},this.geometryInfo=new WeakMap,this.materialMap=new WeakMap,this.imageMap=new WeakMap,this.textures=[],this.libraryImages=[],this.libraryGeometries=[],this.libraryEffects=[],this.libraryMaterials=[],this.canvas=null,this.ctx=null,this.transMat=null}parse(e,t,r={}){if(this.options={...this.options,...r},null===this.options.upAxis.match(/^[XYZ]_UP$/))return console.error("ColladaExporter: Invalid upAxis: valid values are X_UP, Y_UP or Z_UP."),null;if(null!==this.options.unitName&&null===this.options.unitMeter)return console.error("ColladaExporter: unitMeter needs to be specified if unitName is specified."),null;if(null!==this.options.unitMeter&&null===this.options.unitName)return console.error("ColladaExporter: unitName needs to be specified if unitMeter is specified."),null;if(""!==this.options.textureDirectory&&(this.options.textureDirectory=`${this.options.textureDirectory}/`.replace(/\\/g,"/").replace(/\/+/g,"/")),"1.4.1"!==this.options.version&&"1.5.0"!==this.options.version)return console.warn(`ColladaExporter : Version ${this.options.version} not supported for export. Only 1.4.1 and 1.5.0.`),null;const n=this.processObject(e);let i=`<?xml version="1.0" encoding="UTF-8" standalone="no" ?><COLLADA xmlns="${"1.4.1"===this.options.version?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/"}" version="${this.options.version}"><asset><contributor><authoring_tool>three.js Collada Exporter</authoring_tool>${null!==this.options.author?`<author>${this.options.author}</author>`:""}</contributor><created>${(new Date).toISOString()}</created><modified>${(new Date).toISOString()}</modified><up_axis>Y_UP</up_axis></asset>`;i+=`<library_images>${this.libraryImages.join("")}</library_images>`,i+=`<library_effects>${this.libraryEffects.join("")}</library_effects>`,i+=`<library_materials>${this.libraryMaterials.join("")}</library_materials>`,i+=`<library_geometries>${this.libraryGeometries.join("")}</library_geometries>`,i+=`<library_visual_scenes><visual_scene id="Scene" name="scene">${n}</visual_scene></library_visual_scenes>`,i+='<scene><instance_visual_scene url="#Scene"/></scene>',i+="</COLLADA>";const o={data:this.format(i),textures:this.textures};return"function"===typeof t&&requestAnimationFrame((()=>t(o))),o}format(e){var t,r;const n=/^<\//,i=/(\?>$)|(\/>$)/,o=/<[^>]+>[^<]*<\/[^<]+>/,a=(e,t)=>t>0?e+a(e,t-1):"";let s=0;return null!=(t=null===(r=e.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g))||void 0===r?void 0:r.map((e=>{o.test(e)||i.test(e)||!n.test(e)||s--;const t=`${a("  ",s)}${e}`;return o.test(e)||i.test(e)||n.test(e)||s++,t})).join("\n"))?t:""}base64ToBuffer(e){const t=atob(e),r=new Uint8Array(t.length);for(let n=0,i=r.length;n<i;n++)r[n]=t.charCodeAt(n);return r}imageToData(e,t){var r;this.canvas=this.canvas||document.createElement("canvas"),this.ctx=this.ctx||this.canvas.getContext("2d"),this.canvas.width=e.width instanceof SVGAnimatedLength?0:e.width,this.canvas.height=e.height instanceof SVGAnimatedLength?0:e.height,null===(r=this.ctx)||void 0===r||r.drawImage(e,0,0);const n=this.canvas.toDataURL(`image/${t}`,1).replace(/^data:image\/(png|jpg);base64,/,"");return this.base64ToBuffer(n)}attrBufferToArray(e){if(e instanceof a.InterleavedBufferAttribute&&e.isInterleavedBufferAttribute){const t=new(0,e.array.constructor)(e.count*e.itemSize),r=e.itemSize;for(let n=0,i=e.count;n<i;n++)for(let o=0;o<r;o++)t[n*r+o]=e[this.getFuncs[o]](n);return t}return e.array}subArray(e,t,r){if(Array.isArray(e))return e.slice(t,t+r);return new(0,e.constructor)(e.buffer,t*e.BYTES_PER_ELEMENT,r)}getAttribute(e,t,r,n){const i=this.attrBufferToArray(e);return Array.isArray(i)?`${`<source id="${t}"><float_array id="${t}-array" count="${i.length}">`+i.join(" ")}</float_array><technique_common><accessor source="#${t}-array" count="${Math.floor(i.length/e.itemSize)}" stride="${e.itemSize}">${r.map((e=>`<param name="${e}" type="${n}" />`)).join("")}</accessor></technique_common></source>`:""}getTransform(e){return e.updateMatrix(),this.transMat=this.transMat||new a.Matrix4,this.transMat.copy(e.matrix),this.transMat.transpose(),`<matrix>${this.transMat.toArray().join(" ")}</matrix>`}processGeometry(e){let t=this.geometryInfo.get(e);if(!t){const r=e;if(!r.isBufferGeometry)throw new Error("THREE.ColladaExporter: Geometry is not of type THREE.BufferGeometry.");const n=`Mesh${this.libraryGeometries.length+1}`,i=r.index?r.index.count*r.index.itemSize:r.attributes.position.count,o=null!=r.groups&&0!==r.groups.length?r.groups:[{start:0,count:i,materialIndex:0}];let a=`<geometry id="${n}"${e.name?` name="${e.name}"`:""}><mesh>`;const s=`${n}-position`,l=`${n}-vertices`;a+=this.getAttribute(r.attributes.position,s,["X","Y","Z"],"float"),a+=`<vertices id="${l}"><input semantic="POSITION" source="#${s}" /></vertices>`;let c=`<input semantic="VERTEX" source="#${l}" offset="0" />`;if("normal"in r.attributes){const e=`${n}-normal`;a+=this.getAttribute(r.attributes.normal,e,["X","Y","Z"],"float"),c+=`<input semantic="NORMAL" source="#${e}" offset="0" />`}if("uv"in r.attributes){const e=`${n}-texcoord`;a+=this.getAttribute(r.attributes.uv,e,["S","T"],"float"),c+=`<input semantic="TEXCOORD" source="#${e}" offset="0" set="0" />`}if("uv2"in r.attributes){const e=`${n}-texcoord2`;a+=this.getAttribute(r.attributes.uv2,e,["S","T"],"float"),c+=`<input semantic="TEXCOORD" source="#${e}" offset="0" set="1" />`}if("color"in r.attributes){const e=`${n}-color`;a+=this.getAttribute(r.attributes.color,e,["X","Y","Z"],"uint8"),c+=`<input semantic="COLOR" source="#${e}" offset="0" />`}let u=null;if(r.index)u=this.attrBufferToArray(r.index);else{u=new Array(i);for(let e=0,t=u.length;e<t&&Array.isArray(u);e++)u[e]=e}for(let e=0,t=o.length;e<t;e++){const t=o[e],r=this.subArray(u,t.start,t.count),n=r.length/3;a+=`<triangles material="MESH_MATERIAL_${t.materialIndex}" count="${n}">`,a+=c,a+=`<p>${r.join(" ")}</p>`,a+="</triangles>"}a+="</mesh></geometry>",this.libraryGeometries.push(a),t={meshid:n,bufferGeometry:r},this.geometryInfo.set(e,t)}return t}processTexture(e){let t=this.imageMap.get(e);if(null==t){t=`image-${this.libraryImages.length+1}`;const r="png",n=e.name||t;let i=`<image id="${t}" name="${n}">`;"1.5.0"===this.options.version?i+=`<init_from><ref>${this.options.textureDirectory}${n}.${r}</ref></init_from>`:i+=`<init_from>${this.options.textureDirectory}${n}.${r}</init_from>`,i+="</image>",this.libraryImages.push(i),this.imageMap.set(e,t),this.textures.push({directory:this.options.textureDirectory,name:n,ext:r,data:this.imageToData(e.image,r),original:e})}return t}processMaterial(e){let t=this.materialMap.get(e);if(null==t){t=`Mat${this.libraryEffects.length+1}`;let r="phong";if(e instanceof a.MeshLambertMaterial?r="lambert":e instanceof a.MeshBasicMaterial&&(r="constant",null!==e.map&&console.warn("ColladaExporter: Texture maps not supported with MeshBasicMaterial.")),e instanceof a.MeshPhongMaterial){const n=e.emissive?e.emissive:new a.Color(0,0,0),i=e.color?e.color:new a.Color(0,0,0),o=e.specular?e.specular:new a.Color(1,1,1),s=e.shininess||0,l=e.reflectivity||0;let c="";e.transparent&&(c+=`<transparent>${e.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>"}</transparent>`,e.opacity<1&&(c+=`<transparency><float>${e.opacity}</float></transparency>`));const u=`<technique sid="common"><${r}><emission>${e.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':`<color sid="emission">${n.r} ${n.g} ${n.b} 1</color>`}</emission>${"constant"!==r?`<diffuse>${e.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':`<color sid="diffuse">${i.r} ${i.g} ${i.b} 1</color>`}</diffuse>`:""}${"constant"!==r?`<bump>${e.normalMap?'<texture texture="bump-sampler" texcoord="TEXCOORD" />':""}</bump>`:""}${"phong"===r?`<specular><color sid="specular">${o.r} ${o.g} ${o.b} 1</color></specular><shininess>${e.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':`<float sid="shininess">${s}</float>`}</shininess>`:""}<reflective><color>${i.r} ${i.g} ${i.b} 1</color></reflective><reflectivity><float>${l}</float></reflectivity>${c}</${r}></technique>`,h=`<effect id="${t}-effect"><profile_COMMON>${e.map?`<newparam sid="diffuse-surface"><surface type="2D"><init_from>${this.processTexture(e.map)}</init_from></surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>`:""}${e.specularMap?`<newparam sid="specular-surface"><surface type="2D"><init_from>${this.processTexture(e.specularMap)}</init_from></surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>`:""}${e.emissiveMap?`<newparam sid="emissive-surface"><surface type="2D"><init_from>${this.processTexture(e.emissiveMap)}</init_from></surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>`:""}${e.normalMap?`<newparam sid="bump-surface"><surface type="2D"><init_from>${this.processTexture(e.normalMap)}</init_from></surface></newparam><newparam sid="bump-sampler"><sampler2D><source>bump-surface</source></sampler2D></newparam>`:""}${u}${e.side===a.DoubleSide?'<extra><technique profile="THREEJS"><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':""}</profile_COMMON></effect>`,d=`<material id="${t}"${e.name?` name="${e.name}"`:""}><instance_effect url="#${t}-effect" /></material>`;this.libraryMaterials.push(d),this.libraryEffects.push(h),this.materialMap.set(e,t)}}return t}processObject(e){let t=`<node name="${e.name}">`;if(t+=this.getTransform(e),new a.Mesh,e instanceof a.Mesh&&e.isMesh&&null!==e.geometry){const r=this.processGeometry(e.geometry),n=r.meshid,i=r.bufferGeometry;let o,s=null;const l=e.material||new a.MeshBasicMaterial,c=Array.isArray(l)?l:[l];o=i.groups.length>c.length?new Array(i.groups.length):new Array(c.length),s=o.fill(null).map(((e,t)=>this.processMaterial(c[t%c.length]))),t+=`<instance_geometry url="#${n}">`+(null!=s?`<bind_material><technique_common>${s.map(((e,t)=>`<instance_material symbol="MESH_MATERIAL_${t}" target="#${e}" ><bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>`)).join("")}</technique_common></bind_material>`:"")+"</instance_geometry>"}return e.children.forEach((e=>t+=this.processObject(e))),t+="</node>",t}}var vn=r(2278);class yn{constructor(){(0,Qe.Z)(this,"u2sTable",void 0)}parseVpd(e,t,r){if(!0!==e.isSkinnedMesh)return console.warn("THREE.MMDExporter: parseVpd() requires SkinnedMesh instance."),null;function n(e){Math.abs(e)<1e-6&&(e=0);let t=e.toString();-1===t.indexOf(".")&&(t+="."),t+="000000";const r=t.indexOf(".");return t.slice(0,r)+"."+t.slice(r+1,r+7)}function i(e){const t=[];for(let r=0,i=e.length;r<i;r++)t.push(n(e[r]));return t.join(",")}e.updateMatrixWorld(!0);const o=e.skeleton.bones,s=this.getBindBones(e),l=new a.Vector3,c=new a.Quaternion,u=new a.Quaternion,h=new a.Matrix4,d=[];d.push("Vocaloid Pose Data file"),d.push(""),d.push((""!==e.name?e.name.replace(/\s/g,"_"):"skin")+".osm;"),d.push(o.length+";"),d.push("");for(let a=0,p=o.length;a<p;a++){const e=o[a],t=s[a];!0===r&&void 0!==e.userData.ik&&void 0!==e.userData.ik.originalMatrix?h.fromArray(e.userData.ik.originalMatrix):h.copy(e.matrix),l.setFromMatrixPosition(h),c.setFromRotationMatrix(h);const n=l.sub(t.position).toArray(),f=u.copy(t.quaternion).conjugate().multiply(c).toArray();n[2]=-n[2],f[0]=-f[0],f[1]=-f[1],d.push("Bone"+a+"{"+e.name),d.push("  "+i(n)+";"),d.push("  "+i(f)+";"),d.push("}"),d.push("")}d.push("");const f=d.join("\n");return!0===t?this.unicodeToShiftjis(f):f}unicodeToShiftjis(e){if(void 0===this.u2sTable){const e=(new vn.CharsetEncoder).s2uTable;this.u2sTable={};const t=Object.keys(e);for(let r=0,n=t.length;r<n;r++){let n=t[r];const i=e[n];this.u2sTable[i]=parseInt(n)}}const t=[];for(let r=0,n=e.length;r<n;r++){const n=e.charCodeAt(r),i=this.u2sTable[n];if(void 0===i)throw"cannot convert charcode 0x"+n.toString(16);i>255?(t.push(i>>8&255),t.push(255&i)):t.push(255&i)}return new Uint8Array(t)}getBindBones(e){const t=e.clone();return t.pose(),t.skeleton.bones}}class xn{constructor(){(0,Qe.Z)(this,"binary",void 0),(0,Qe.Z)(this,"output",void 0),(0,Qe.Z)(this,"offset",void 0),(0,Qe.Z)(this,"objects",void 0),(0,Qe.Z)(this,"triangles",void 0),(0,Qe.Z)(this,"vA",void 0),(0,Qe.Z)(this,"vB",void 0),(0,Qe.Z)(this,"vC",void 0),(0,Qe.Z)(this,"cb",void 0),(0,Qe.Z)(this,"ab",void 0),(0,Qe.Z)(this,"normal",void 0),this.binary=!1,this.output="",this.offset=80,this.objects=[],this.triangles=0,this.vA=new a.Vector3,this.vB=new a.Vector3,this.vC=new a.Vector3,this.cb=new a.Vector3,this.ab=new a.Vector3,this.normal=new a.Vector3}parse(e,t){if(this.binary=void 0!==t.binary&&t.binary,e.traverse((function(e){if(e instanceof a.Mesh&&e.isMesh){const t=e.geometry;if(!t.isBufferGeometry)throw new Error("THREE.STLExporter: Geometry is not of type THREE.BufferGeometry.");const r=t.index,n=t.getAttribute("position");this.triangles+=null!==r?r.count/3:n.count/3,this.objects.push({object3d:e,geometry:t})}})),this.binary){const e=2*this.triangles+3*this.triangles*4*4+80+4,t=new ArrayBuffer(e);this.output=new DataView(t),this.output.setUint32(this.offset,this.triangles,!0),this.offset+=4}else this.output="",this.output+="solid exported\n";for(let r=0,n=this.objects.length;r<n;r++){const e=this.objects[r].object3d,t=this.objects[r].geometry,n=t.index,i=t.getAttribute("position");if(e instanceof a.SkinnedMesh)if(null!==n)for(let r=0;r<n.count;r+=3){const t=n.getX(r+0),o=n.getX(r+1),a=n.getX(r+2);this.writeFace(t,o,a,i,e)}else for(let r=0;r<i.count;r+=3){const t=r+0,n=r+1,o=r+2;this.writeFace(t,n,o,i,e)}}return this.binary||(this.output+="endsolid exported\n"),this.output}writeFace(e,t,r,n,i){this.vA.fromBufferAttribute(n,e),this.vB.fromBufferAttribute(n,t),this.vC.fromBufferAttribute(n,r),i.isSkinnedMesh&&(i.boneTransform(e,this.vA),i.boneTransform(t,this.vB),i.boneTransform(r,this.vC)),this.vA.applyMatrix4(i.matrixWorld),this.vB.applyMatrix4(i.matrixWorld),this.vC.applyMatrix4(i.matrixWorld),this.writeNormal(this.vA,this.vB,this.vC),this.writeVertex(this.vA),this.writeVertex(this.vB),this.writeVertex(this.vC),this.binary&&this.output instanceof DataView?(this.output.setUint16(this.offset,0,!0),this.offset+=2):(this.output+="\t\tendloop\n",this.output+="\tendfacet\n")}writeNormal(e,t,r){this.cb.subVectors(r,t),this.ab.subVectors(e,t),this.cb.cross(this.ab).normalize(),this.normal.copy(this.cb).normalize(),this.binary&&this.output instanceof DataView?(this.output.setFloat32(this.offset,this.normal.x,!0),this.offset+=4,this.output.setFloat32(this.offset,this.normal.y,!0),this.offset+=4,this.output.setFloat32(this.offset,this.normal.z,!0),this.offset+=4):(this.output+=`\tfacet normal ${this.normal.x} ${this.normal.y} ${this.normal.z}\n`,this.output+="\t\touter loop\n")}writeVertex(e){this.binary&&this.output instanceof DataView?(this.output.setFloat32(this.offset,e.x,!0),this.offset+=4,this.output.setFloat32(this.offset,e.y,!0),this.offset+=4,this.output.setFloat32(this.offset,e.z,!0),this.offset+=4):this.output+="\t\t\tvertex vertex.x vertex.y vertex.z\n"}}class bn{constructor(){(0,Qe.Z)(this,"output",void 0),(0,Qe.Z)(this,"indexVertex",void 0),(0,Qe.Z)(this,"indexVertexUvs",void 0),(0,Qe.Z)(this,"indexNormals",void 0),(0,Qe.Z)(this,"vertex",void 0),(0,Qe.Z)(this,"color",void 0),(0,Qe.Z)(this,"normal",void 0),(0,Qe.Z)(this,"uv",void 0),(0,Qe.Z)(this,"face",void 0),this.output="",this.indexVertex=0,this.indexVertexUvs=0,this.indexNormals=0,this.vertex=new a.Vector3,this.color=new a.Color,this.normal=new a.Vector3,this.uv=new a.Vector2,this.face=[]}parse(e){return e.traverse((e=>{e instanceof a.Mesh&&e.isMesh&&this.parseMesh(e),e instanceof a.Line&&e.isLine&&this.parseLine(e),e instanceof a.Points&&e.isPoints&&this.parsePoints(e)})),this.output}parseMesh(e){let t=0,r=0,n=0;const i=e.geometry,o=new a.Matrix3;if(!i.isBufferGeometry)throw new Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.");const s=i.getAttribute("position"),l=i.getAttribute("normal"),c=i.getAttribute("uv"),u=i.getIndex();if(this.output+=`o ${e.name}\n`,e.material&&!Array.isArray(e.material)&&e.material.name&&(this.output+=`usemtl ${e.material.name}\n`),void 0!==s)for(let a=0,h=s.count;a<h;a++,t++)this.vertex.x=s.getX(a),this.vertex.y=s.getY(a),this.vertex.z=s.getZ(a),this.vertex.applyMatrix4(e.matrixWorld),this.output+=`v ${this.vertex.x} ${this.vertex.y} ${this.vertex.z}\n`;if(void 0!==c)for(let a=0,h=c.count;a<h;a++,n++)this.uv.x=c.getX(a),this.uv.y=c.getY(a),this.output+=`vt ${this.uv.x} ${this.uv.y}\n`;if(void 0!==l){o.getNormalMatrix(e.matrixWorld);for(let e=0,t=l.count;e<t;e++,r++)this.normal.x=l.getX(e),this.normal.y=l.getY(e),this.normal.z=l.getZ(e),this.normal.applyMatrix3(o).normalize(),this.output+=`vn ${this.normal.x} ${this.normal.y} ${this.normal.z}\n`}if(null!==u)for(let a=0,h=u.count;a<h;a+=3){for(let e=0;e<3;e++){const t=u.getX(a+e)+1;this.face[e]=this.indexVertex+t+(l||c?`/${c?this.indexVertexUvs+t:""}${l?`/${this.indexNormals+t}`:""}`:"")}this.output+=`f ${this.face.join(" ")}\n`}else for(let a=0,h=s.count;a<h;a+=3){for(let e=0;e<3;e++){const t=a+e+1;this.face[e]=this.indexVertex+t+(l||c?`/${c?this.indexVertexUvs+t:""}${l?`/${this.indexNormals+t}`:""}`:"")}this.output+=`f ${this.face.join(" ")}\n`}this.indexVertex+=t,this.indexVertexUvs+=n,this.indexNormals+=r}parseLine(e){let t=0;const r=e.geometry,n=e.type;if(r.isBufferGeometry)throw new Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.");const i=r.getAttribute("position");if(this.output+=`o ${e.name}\n`,void 0!==i)for(let o=0,a=i.count;o<a;o++,t++)this.vertex.x=i.getX(o),this.vertex.y=i.getY(o),this.vertex.z=i.getZ(o),this.vertex.applyMatrix4(e.matrixWorld),this.output+=`v ${this.vertex.x} ${this.vertex.y} ${this.vertex.z}\n`;if("Line"===n){this.output+="l ";for(let e=1,t=i.count;e<=t;e++)this.output+=`${this.indexVertex+e} `;this.output+="\n"}if("LineSegments"===n)for(let o=1,a=o+1,s=i.count;o<s;o+=2,a=o+1)this.output+=`l ${this.indexVertex+o} ${this.indexVertex+a}\n`;this.indexVertex+=t}parsePoints(e){let t=0;const r=e.geometry;if(!r.isBufferGeometry)throw new Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.");const n=r.getAttribute("position"),i=r.getAttribute("color");if(this.output+=`o ${e.name}\n`,void 0!==n)for(let o=0,s=n.count;o<s;o++,t++)this.vertex.fromBufferAttribute(n,o),this.vertex.applyMatrix4(e.matrixWorld),this.output+=`v ${this.vertex.x} ${this.vertex.y} ${this.vertex.z}`,void 0!==i&&i instanceof a.BufferAttribute&&(this.color.fromBufferAttribute(i,o),this.output+=` ${this.color.r} ${this.color.g} ${this.color.b}`),this.output+="\n";this.output+="p ";for(let o=1,a=n.count;o<=a;o++)this.output+=`${this.indexVertex+o} `;this.output+="\n",this.indexVertex+=t}}function wn(){const e=new a.Scene,t=new a.BoxGeometry;t.deleteAttribute("uv");const r=new a.MeshStandardMaterial({side:a.BackSide}),n=new a.MeshStandardMaterial,i=new a.PointLight(16777215,5,28,2);i.position.set(.418,16.199,.3),e.add(i);const o=new a.Mesh(t,r);o.position.set(-.757,13.219,.717),o.scale.set(31.713,28.305,28.591),e.add(o);const s=new a.Mesh(t,n);s.position.set(-10.906,2.009,1.846),s.rotation.set(0,-.195,0),s.scale.set(2.328,7.905,4.651),e.add(s);const l=new a.Mesh(t,n);l.position.set(-5.607,-.754,-.758),l.rotation.set(0,.994,0),l.scale.set(1.97,1.534,3.955),e.add(l);const c=new a.Mesh(t,n);c.position.set(6.167,.857,7.803),c.rotation.set(0,.561,0),c.scale.set(3.927,6.285,3.687),e.add(c);const u=new a.Mesh(t,n);u.position.set(-2.017,.018,6.124),u.rotation.set(0,.333,0),u.scale.set(2.002,4.566,2.064),e.add(u);const h=new a.Mesh(t,n);h.position.set(2.291,-.756,-2.621),h.rotation.set(0,-.286,0),h.scale.set(1.546,1.552,1.496),e.add(h);const d=new a.Mesh(t,n);d.position.set(-2.193,-.369,-5.547),d.rotation.set(0,.516,0),d.scale.set(3.875,3.487,2.986),e.add(d);const f=new a.Mesh(t,y(50));f.position.set(-16.116,14.37,8.208),f.scale.set(.1,2.428,2.739),e.add(f);const p=new a.Mesh(t,y(50));p.position.set(-16.109,18.021,-8.207),p.scale.set(.1,2.425,2.751),e.add(p);const m=new a.Mesh(t,y(17));m.position.set(14.904,12.198,-1.832),m.scale.set(.15,4.265,6.331),e.add(m);const g=new a.Mesh(t,y(43));g.position.set(-.462,8.89,14.52),g.scale.set(4.38,5.441,.088),e.add(g);const A=new a.Mesh(t,y(20));A.position.set(3.235,11.486,-12.541),A.scale.set(2.5,2,.1),e.add(A);const v=new a.Mesh(t,y(100));function y(e){const t=new a.MeshBasicMaterial;return t.color.setScalar(e),t}return v.position.set(0,20,0),v.scale.set(1,.1,1),e.add(v),e}const Cn=()=>{};Cn.CreateRotationAnimation=(e,t)=>{const r=[0,e],n=`.rotation[${t=t||"x"}]`,i=new a.NumberKeyframeTrack(n,r,[0,360]);return new a.AnimationClip(null,e,[i])},Cn.CreateScaleAxisAnimation=(e,t)=>{const r=[0,e],n=`.scale[${t=t||"x"}]`,i=new a.NumberKeyframeTrack(n,r,[0,1]);return new a.AnimationClip(null,e,[i])},Cn.CreateShakeAnimation=(e,t)=>{const r=[],n=[],i=new a.Vector3;for(let a=0;a<10*e;a++)r.push(a/10),i.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiply(t).toArray(n,n.length);const o=new a.VectorKeyframeTrack(".position",r,n);return new a.AnimationClip(null,e,[o])},Cn.CreatePulsationAnimation=(e,t)=>{const r=[],n=[],i=new a.Vector3;for(let a=0;a<10*e;a++){r.push(a/10);const e=Math.random()*t;i.set(e,e,e).toArray(n,n.length)}const o=new a.VectorKeyframeTrack(".scale",r,n);return new a.AnimationClip(null,e,[o])},Cn.CreateVisibilityAnimation=e=>{const t=[0,e/2,e],r=new a.BooleanKeyframeTrack(".visible",t,[!0,!1,!0]);return new a.AnimationClip(null,e,[r])},Cn.CreateMaterialColorAnimation=(e,t)=>{const r=[],n=[],i=e/t.length;for(let a=0;a<=t.length;a++)r.push(a*i),n.push(t[a%t.length]);const o=new a.ColorKeyframeTrack(".material[0].color",r,n);return new a.AnimationClip(null,e,[o])};const En=(()=>{function e(e,t){this.mesh=e,this.iks=t||[],this._valid()}function t(e,t){a.Object3D.call(this),this.root=e,this.iks=t||[],this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.sphereGeometry=new a.SphereGeometry(.25,16,8),this.targetSphereMaterial=new a.MeshBasicMaterial({color:new a.Color(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new a.MeshBasicMaterial({color:new a.Color(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new a.MeshBasicMaterial({color:new a.Color(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new a.LineBasicMaterial({color:new a.Color(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init()}return e.prototype={constructor:e,update:(()=>{const e=new a.Quaternion,t=new a.Vector3,r=new a.Vector3,n=new a.Vector3,i=new a.Vector3,o=new a.Vector3,s=new a.Quaternion,l=new a.Vector3,c=new a.Vector3,u=new a.Vector3;return function(){const a=this.mesh.skeleton.bones,h=this.iks,d=Math;for(let f=0,p=h.length;f<p;f++){const p=h[f],m=a[p.effector],g=a[p.target];t.setFromMatrixPosition(g.matrixWorld);const A=p.links,v=void 0!==p.iteration?p.iteration:1;for(let h=0;h<v;h++){let h=!1;for(let f=0,g=A.length;f<g;f++){const g=a[A[f].index];if(!1===A[f].enabled)break;const v=A[f].limitation,y=A[f].rotationMin,x=A[f].rotationMax;g.matrixWorld.decompose(o,s,l),s.invert(),n.setFromMatrixPosition(m.matrixWorld),i.subVectors(n,o),i.applyQuaternion(s),i.normalize(),r.subVectors(t,o),r.applyQuaternion(s),r.normalize();let b=r.dot(i);if(b>1?b=1:b<-1&&(b=-1),b=d.acos(b),!(b<1e-5)){if(void 0!==p.minAngle&&b<p.minAngle&&(b=p.minAngle),void 0!==p.maxAngle&&b>p.maxAngle&&(b=p.maxAngle),c.crossVectors(i,r),c.normalize(),e.setFromAxisAngle(c,b),g.quaternion.multiply(e),void 0!==v){let e=g.quaternion.w;e>1&&(e=1);const t=d.sqrt(1-e*e);g.quaternion.set(v.x*t,v.y*t,v.z*t,e)}void 0!==y&&g.rotation.setFromVector3(g.rotation.toVector3(u).max(y)),void 0!==x&&g.rotation.setFromVector3(g.rotation.toVector3(u).min(x)),g.updateMatrixWorld(!0),h=!0}}if(!h)break}}return this}})(),createHelper:function(){return new t(this.mesh,this.mesh.geometry.userData.MMD.iks)},_valid:function(){const e=this.iks,t=this.mesh.skeleton.bones;for(let r=0,n=e.length;r<n;r++){const n=e[r],i=t[n.effector],o=n.links;let a,s;a=i;for(let e=0,r=o.length;e<r;e++)s=t[o[e].index],a.parent!==s&&console.warn(`THREE.CCDIKSolver: bone ${a.name} is not the child of bone ${s.name}`),a=s}}},t.prototype=Object.assign(Object.create(a.Object3D.prototype),{constructor:t,updateMatrixWorld:(()=>{const e=new a.Matrix4,t=new a.Vector3;function r(e,r){return t.setFromMatrixPosition(e.matrixWorld).applyMatrix4(r)}function n(e,t,n,i){const o=r(n,i);e[3*t+0]=o.x,e[3*t+1]=o.y,e[3*t+2]=o.z}return function(t){const i=this.root;if(this.visible){let t=0;const a=this.iks,s=i.skeleton.bones;e.copy(i.matrixWorld).invert();for(let i=0,l=a.length;i<l;i++){const l=a[i],c=s[l.target],u=s[l.effector],h=this.children[t++],d=this.children[t++];h.position.copy(r(c,e)),d.position.copy(r(u,e));for(let n=0,i=l.links.length;n<i;n++){var o=s[l.links[n].index];this.children[t++].position.copy(r(o,e))}const f=this.children[t++],p=f.geometry.attributes.position.array;n(p,0,c,e),n(p,1,u,e);for(let t=0,r=l.links.length;t<r;t++){n(p,t+2,o=s[l.links[t].index],e)}f.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(i.matrixWorld),a.Object3D.prototype.updateMatrixWorld.call(this,t)}})(),_init:function(){const e=this,t=this.iks;function r(t){return new a.Line(function(e){const t=new a.BufferGeometry,r=new Float32Array(3*(2+e.links.length));return t.setAttribute("position",new a.BufferAttribute(r,3)),t}(t),e.lineMaterial)}for(let n=0,i=t.length;n<i;n++){const i=t[n];this.add(new a.Mesh(e.sphereGeometry,e.targetSphereMaterial)),this.add(new a.Mesh(e.sphereGeometry,e.effectorSphereMaterial));for(let t=0,r=i.links.length;t<r;t++)this.add(new a.Mesh(e.sphereGeometry,e.linkSphereMaterial));this.add(r(i))}}}),e})(),Sn=(()=>{function e(e,r,n,i){if("undefined"===typeof Ammo)throw new Error("THREE.MMDPhysics: Import ammo.js https://github.com/kripken/ammo.js");n=n||[],i=i||{},this.manager=new t,this.mesh=e,this.unitStep=void 0!==i.unitStep?i.unitStep:1/65,this.maxStepNum=void 0!==i.maxStepNum?i.maxStepNum:3,this.gravity=new a.Vector3(0,-98,0),void 0!==i.gravity&&this.gravity.copy(i.gravity),this.world=void 0!==i.world?i.world:null,this.bodies=[],this.constraints=[],this._init(e,r,n)}function t(){this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[]}function r(e,t,r,n){this.mesh=e,this.world=t,this.params=r,this.manager=n,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this._init()}function n(e,t,r,n,i,o){this.mesh=e,this.world=t,this.bodyA=r,this.bodyB=n,this.params=i,this.manager=o,this.constraint=null,this._init()}function i(e,t){a.Object3D.call(this),this.root=e,this.physics=t,this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new a.MeshBasicMaterial({color:new a.Color(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new a.MeshBasicMaterial({color:new a.Color(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new a.MeshBasicMaterial({color:new a.Color(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this._init()}return e.prototype={constructor:e,update:function(e){const t=this.manager,r=this.mesh;let n=!1;const i=t.allocThreeVector3(),o=t.allocThreeQuaternion(),a=t.allocThreeVector3();let s;return r.matrixWorld.decompose(i,o,a),1===a.x&&1===a.y&&1===a.z||(n=!0),n&&(s=r.parent,null!==s&&(r.parent=null),a.copy(this.mesh.scale),r.scale.set(1,1,1),r.updateMatrixWorld(!0)),this._updateRigidBodies(),this._stepSimulation(e),this._updateBones(),n&&(null!==s&&(r.parent=s),r.scale.copy(a)),t.freeThreeVector3(a),t.freeThreeQuaternion(o),t.freeThreeVector3(i),this},reset:function(){for(let e=0,t=this.bodies.length;e<t;e++)this.bodies[e].reset();return this},warmup:function(e){for(let t=0;t<e;t++)this.update(1/60);return this},setGravity:function(e){return this.world.setGravity(new Ammo.btVector3(e.x,e.y,e.z)),this.gravity.copy(e),this},createHelper:function(){return new i(this.mesh,this)},_init:function(e,t,r){const n=this.manager;let i=e.parent;null!==i&&(i=null);const o=n.allocThreeVector3(),a=n.allocThreeQuaternion(),s=n.allocThreeVector3();o.copy(e.position),a.copy(e.quaternion),s.copy(e.scale),e.position.set(0,0,0),e.quaternion.set(0,0,0,1),e.scale.set(1,1,1),e.updateMatrixWorld(!0),null===this.world&&(this.world=this._createWorld(),this.setGravity(this.gravity)),this._initRigidBodies(t),this._initConstraints(r),null!==i&&(e.parent=i),e.position.copy(o),e.quaternion.copy(a),e.scale.copy(s),e.updateMatrixWorld(!0),this.reset(),n.freeThreeVector3(o),n.freeThreeQuaternion(a),n.freeThreeVector3(s)},_createWorld:function(){const e=new Ammo.btDefaultCollisionConfiguration,t=new Ammo.btCollisionDispatcher(e),r=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver;return new Ammo.btDiscreteDynamicsWorld(t,r,n,e)},_initRigidBodies:function(e){for(let t=0,n=e.length;t<n;t++)this.bodies.push(new r(this.mesh,this.world,e[t],this.manager))},_initConstraints:function(e){for(let t=0,r=e.length;t<r;t++){const r=e[t],i=this.bodies[r.rigidBodyIndex1],o=this.bodies[r.rigidBodyIndex2];this.constraints.push(new n(this.mesh,this.world,i,o,r,this.manager))}},_stepSimulation:function(e){const t=this.unitStep;let r=e,n=1+(e/t|0);r<t&&(r=t,n=1),n>this.maxStepNum&&(n=this.maxStepNum),this.world.stepSimulation(r,n,t)},_updateRigidBodies:function(){for(let e=0,t=this.bodies.length;e<t;e++)this.bodies[e].updateFromBone()},_updateBones:function(){for(let e=0,t=this.bodies.length;e<t;e++)this.bodies[e].updateBone()}},t.prototype={constructor:t,allocThreeVector3:function(){return this.threeVector3s.length>0?this.threeVector3s.pop():new a.Vector3},freeThreeVector3:function(e){this.threeVector3s.push(e)},allocThreeMatrix4:function(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new a.Matrix4},freeThreeMatrix4:function(e){this.threeMatrix4s.push(e)},allocThreeQuaternion:function(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new a.Quaternion},freeThreeQuaternion:function(e){this.threeQuaternions.push(e)},allocThreeEuler:function(){return this.threeEulers.length>0?this.threeEulers.pop():new a.Euler},freeThreeEuler:function(e){this.threeEulers.push(e)},allocTransform:function(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform},freeTransform:function(e){this.transforms.push(e)},allocQuaternion:function(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion},freeQuaternion:function(e){this.quaternions.push(e)},allocVector3:function(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3},freeVector3:function(e){this.vector3s.push(e)},setIdentity:function(e){e.setIdentity()},getBasis:function(e){const t=this.allocQuaternion();return e.getBasis().getRotation(t),t},getBasisAsMatrix3:function(e){const t=this.getBasis(e),r=this.quaternionToMatrix3(t);return this.freeQuaternion(t),r},getOrigin:function(e){return e.getOrigin()},setOrigin:function(e,t){e.getOrigin().setValue(t.x(),t.y(),t.z())},copyOrigin:function(e,t){const r=t.getOrigin();this.setOrigin(e,r)},setBasis:function(e,t){e.setRotation(t)},setBasisFromMatrix3:function(e,t){const r=this.matrix3ToQuaternion(t);this.setBasis(e,r),this.freeQuaternion(r)},setOriginFromArray3:function(e,t){e.getOrigin().setValue(t[0],t[1],t[2])},setOriginFromThreeVector3:function(e,t){e.getOrigin().setValue(t.x,t.y,t.z)},setBasisFromArray3:function(e,t){const r=this.allocThreeQuaternion(),n=this.allocThreeEuler();n.set(t[0],t[1],t[2]),this.setBasisFromThreeQuaternion(e,r.setFromEuler(n)),this.freeThreeEuler(n),this.freeThreeQuaternion(r)},setBasisFromThreeQuaternion:function(e,t){const r=this.allocQuaternion();r.setX(t.x),r.setY(t.y),r.setZ(t.z),r.setW(t.w),this.setBasis(e,r),this.freeQuaternion(r)},multiplyTransforms:function(e,t){const r=this.allocTransform();this.setIdentity(r);const n=this.getBasisAsMatrix3(e),i=this.getBasisAsMatrix3(t),o=this.getOrigin(e),a=this.getOrigin(t),s=this.multiplyMatrix3ByVector3(n,a),l=this.addVector3(s,o);this.setOrigin(r,l);const c=this.multiplyMatrices3(n,i);return this.setBasisFromMatrix3(r,c),this.freeVector3(s),this.freeVector3(l),r},inverseTransform:function(e){const t=this.allocTransform(),r=this.getBasisAsMatrix3(e),n=this.getOrigin(e),i=this.transposeMatrix3(r),o=this.negativeVector3(n),a=this.multiplyMatrix3ByVector3(i,o);return this.setOrigin(t,a),this.setBasisFromMatrix3(t,i),this.freeVector3(o),this.freeVector3(a),t},multiplyMatrices3:function(e,t){const r=[],n=this.rowOfMatrix3(e,0),i=this.rowOfMatrix3(e,1),o=this.rowOfMatrix3(e,2),a=this.columnOfMatrix3(t,0),s=this.columnOfMatrix3(t,1),l=this.columnOfMatrix3(t,2);return r[0]=this.dotVectors3(n,a),r[1]=this.dotVectors3(n,s),r[2]=this.dotVectors3(n,l),r[3]=this.dotVectors3(i,a),r[4]=this.dotVectors3(i,s),r[5]=this.dotVectors3(i,l),r[6]=this.dotVectors3(o,a),r[7]=this.dotVectors3(o,s),r[8]=this.dotVectors3(o,l),this.freeVector3(n),this.freeVector3(i),this.freeVector3(o),this.freeVector3(a),this.freeVector3(s),this.freeVector3(l),r},addVector3:function(e,t){const r=this.allocVector3();return r.setValue(e.x()+t.x(),e.y()+t.y(),e.z()+t.z()),r},dotVectors3:function(e,t){return e.x()*t.x()+e.y()*t.y()+e.z()*t.z()},rowOfMatrix3:function(e,t){const r=this.allocVector3();return r.setValue(e[3*t+0],e[3*t+1],e[3*t+2]),r},columnOfMatrix3:function(e,t){const r=this.allocVector3();return r.setValue(e[t+0],e[t+3],e[t+6]),r},negativeVector3:function(e){const t=this.allocVector3();return t.setValue(-e.x(),-e.y(),-e.z()),t},multiplyMatrix3ByVector3:function(e,t){const r=this.allocVector3(),n=this.rowOfMatrix3(e,0),i=this.rowOfMatrix3(e,1),o=this.rowOfMatrix3(e,2),a=this.dotVectors3(n,t),s=this.dotVectors3(i,t),l=this.dotVectors3(o,t);return r.setValue(a,s,l),this.freeVector3(n),this.freeVector3(i),this.freeVector3(o),r},transposeMatrix3:function(e){const t=[];return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},quaternionToMatrix3:function(e){const t=[],r=e.x(),n=e.y(),i=e.z(),o=e.w(),a=r*r,s=n*n,l=i*i,c=r*n,u=n*i,h=i*r,d=r*o,f=n*o,p=i*o;return t[0]=1-2*(s+l),t[1]=2*(c-p),t[2]=2*(h+f),t[3]=2*(c+p),t[4]=1-2*(l+a),t[5]=2*(u-d),t[6]=2*(h-f),t[7]=2*(u+d),t[8]=1-2*(a+s),t},matrix3ToQuaternion:function(e){const t=e[0]+e[4]+e[8];let r,n,i,o,a;t>0?(r=2*Math.sqrt(t+1),a=.25*r,n=(e[7]-e[5])/r,i=(e[2]-e[6])/r,o=(e[3]-e[1])/r):e[0]>e[4]&&e[0]>e[8]?(r=2*Math.sqrt(1+e[0]-e[4]-e[8]),a=(e[7]-e[5])/r,n=.25*r,i=(e[1]+e[3])/r,o=(e[2]+e[6])/r):e[4]>e[8]?(r=2*Math.sqrt(1+e[4]-e[0]-e[8]),a=(e[2]-e[6])/r,n=(e[1]+e[3])/r,i=.25*r,o=(e[5]+e[7])/r):(r=2*Math.sqrt(1+e[8]-e[0]-e[4]),a=(e[3]-e[1])/r,n=(e[2]+e[6])/r,i=(e[5]+e[7])/r,o=.25*r);const s=this.allocQuaternion();return s.setX(n),s.setY(i),s.setZ(o),s.setW(a),s}},r.prototype={constructor:e.RigidBody,reset:function(){return this._setTransformFromBone(),this},updateFromBone:function(){return-1!==this.params.boneIndex&&0===this.params.type&&this._setTransformFromBone(),this},updateBone:function(){return 0===this.params.type||-1===this.params.boneIndex||(this._updateBoneRotation(),1===this.params.type&&this._updateBonePosition(),this.bone.updateMatrixWorld(!0),2===this.params.type&&this._setPositionFromBone()),this},_init:function(){const e=this.manager,t=this.params,r=this.mesh.skeleton.bones,n=-1===t.boneIndex?new a.Bone:r[t.boneIndex],i=function(e){switch(e.shapeType){case 0:return new Ammo.btSphereShape(e.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(e.width,e.height,e.depth));case 2:return new Ammo.btCapsuleShape(e.width,e.height);default:throw`unknown shape type ${e.shapeType}`}}(t),o=0===t.type?0:t.weight,s=e.allocVector3();s.setValue(0,0,0),0!==o&&i.calculateLocalInertia(o,s);const l=e.allocTransform();e.setIdentity(l),e.setOriginFromArray3(l,t.position),e.setBasisFromArray3(l,t.rotation);const c=e.allocThreeVector3(),u=e.allocTransform();e.setIdentity(u),e.setOriginFromThreeVector3(u,n.getWorldPosition(c));const h=e.multiplyTransforms(u,l),d=new Ammo.btDefaultMotionState(h),f=new Ammo.btRigidBodyConstructionInfo(o,d,i,s);f.set_m_friction(t.friction),f.set_m_restitution(t.restitution);const p=new Ammo.btRigidBody(f);0===t.type&&(p.setCollisionFlags(2|p.getCollisionFlags()),p.setActivationState(4)),p.setDamping(t.positionDamping,t.rotationDamping),p.setSleepingThresholds(0,0),this.world.addRigidBody(p,1<<t.groupIndex,t.groupTarget),this.body=p,this.bone=n,this.boneOffsetForm=l,this.boneOffsetFormInverse=e.inverseTransform(l),e.freeVector3(s),e.freeTransform(h),e.freeTransform(u),e.freeThreeVector3(c)},_getBoneTransform:function(){const e=this.manager,t=e.allocThreeVector3(),r=e.allocThreeQuaternion(),n=e.allocThreeVector3();this.bone.matrixWorld.decompose(t,r,n);const i=e.allocTransform();e.setOriginFromThreeVector3(i,t),e.setBasisFromThreeQuaternion(i,r);const o=e.multiplyTransforms(i,this.boneOffsetForm);return e.freeTransform(i),e.freeThreeVector3(n),e.freeThreeQuaternion(r),e.freeThreeVector3(t),o},_getWorldTransformForBone:function(){const e=this.manager,t=this.body.getCenterOfMassTransform();return e.multiplyTransforms(t,this.boneOffsetFormInverse)},_setTransformFromBone:function(){const e=this.manager,t=this._getBoneTransform();this.body.setCenterOfMassTransform(t),this.body.getMotionState().setWorldTransform(t),e.freeTransform(t)},_setPositionFromBone:function(){const e=this.manager,t=this._getBoneTransform(),r=e.allocTransform();this.body.getMotionState().getWorldTransform(r),e.copyOrigin(r,t),this.body.setCenterOfMassTransform(r),this.body.getMotionState().setWorldTransform(r),e.freeTransform(r),e.freeTransform(t)},_updateBoneRotation:function(){const e=this.manager,t=this._getWorldTransformForBone(),r=e.getBasis(t),n=e.allocThreeQuaternion(),i=e.allocThreeQuaternion(),o=e.allocThreeQuaternion();n.set(r.x(),r.y(),r.z(),r.w()),i.setFromRotationMatrix(this.bone.matrixWorld),i.conjugate(),i.multiply(n),o.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(i.multiply(o).normalize()),e.freeThreeQuaternion(n),e.freeThreeQuaternion(i),e.freeThreeQuaternion(o),e.freeQuaternion(r),e.freeTransform(t)},_updateBonePosition:function(){const e=this.manager,t=this._getWorldTransformForBone(),r=e.allocThreeVector3(),n=e.getOrigin(t);r.set(n.x(),n.y(),n.z()),this.bone.parent&&this.bone.parent.worldToLocal(r),this.bone.position.copy(r),e.freeThreeVector3(r),e.freeTransform(t)}},n.prototype={constructor:n,_init:function(){const e=this.manager,t=this.params,r=this.bodyA,n=this.bodyB,i=e.allocTransform();e.setIdentity(i),e.setOriginFromArray3(i,t.position),e.setBasisFromArray3(i,t.rotation);const o=e.allocTransform(),a=e.allocTransform();r.body.getMotionState().getWorldTransform(o),n.body.getMotionState().getWorldTransform(a);const s=e.inverseTransform(o),l=e.inverseTransform(a),c=e.multiplyTransforms(s,i),u=e.multiplyTransforms(l,i),h=new Ammo.btGeneric6DofSpringConstraint(r.body,n.body,c,u,!0),d=e.allocVector3(),f=e.allocVector3(),p=e.allocVector3(),m=e.allocVector3();d.setValue(t.translationLimitation1[0],t.translationLimitation1[1],t.translationLimitation1[2]),f.setValue(t.translationLimitation2[0],t.translationLimitation2[1],t.translationLimitation2[2]),p.setValue(t.rotationLimitation1[0],t.rotationLimitation1[1],t.rotationLimitation1[2]),m.setValue(t.rotationLimitation2[0],t.rotationLimitation2[1],t.rotationLimitation2[2]),h.setLinearLowerLimit(d),h.setLinearUpperLimit(f),h.setAngularLowerLimit(p),h.setAngularUpperLimit(m);for(let g=0;g<3;g++)0!==t.springPosition[g]&&(h.enableSpring(g,!0),h.setStiffness(g,t.springPosition[g]));for(let g=0;g<3;g++)0!==t.springRotation[g]&&(h.enableSpring(g+3,!0),h.setStiffness(g+3,t.springRotation[g]));if(void 0!==h.setParam)for(let g=0;g<6;g++)h.setParam(2,.475,g);this.world.addConstraint(h,!0),this.constraint=h,e.freeTransform(i),e.freeTransform(o),e.freeTransform(a),e.freeTransform(s),e.freeTransform(l),e.freeTransform(c),e.freeTransform(u),e.freeVector3(d),e.freeVector3(f),e.freeVector3(p),e.freeVector3(m)}},i.prototype=Object.assign(Object.create(a.Object3D.prototype),{constructor:i,updateMatrixWorld:(()=>{const e=new a.Vector3,t=new a.Quaternion,r=new a.Vector3,n=new a.Matrix4;return function(i){const o=this.root;if(this.visible){const i=this.physics.bodies;n.copy(o.matrixWorld).decompose(e,t,r).compose(e,t,r.set(1,1,1)).invert();for(let e=0,r=i.length;e<r;e++){const r=i[e].body,o=this.children[e],a=r.getCenterOfMassTransform(),s=a.getOrigin(),l=a.getRotation();o.position.set(s.x(),s.y(),s.z()).applyMatrix4(n),o.quaternion.setFromRotationMatrix(n).multiply(t.set(l.x(),l.y(),l.z(),l.w()))}}this.matrix.copy(o.matrixWorld).decompose(e,t,r).compose(e,t,r.set(1,1,1)),a.Object3D.prototype.updateMatrixWorld.call(this,i)}})(),_init:function(){const e=this.physics.bodies;function t(e){switch(e.shapeType){case 0:return new a.SphereGeometry(e.width,16,8);case 1:return new a.BoxGeometry(2*e.width,2*e.height,2*e.depth,8,8,8);case 2:return new r(e.width,e.height,16,8);default:return null}}function r(e,t,r,n){const i=new a.CylinderGeometry(e,e,t,r,n,!0),o=new a.Mesh(new a.SphereGeometry(e,r,n,0,2*Math.PI,0,Math.PI/2)),s=new a.Mesh(new a.SphereGeometry(e,r,n,0,2*Math.PI,Math.PI/2,Math.PI/2));return o.position.set(0,t/2,0),s.position.set(0,-t/2,0),o.updateMatrix(),s.updateMatrix(),i.merge(o.geometry,o.matrix),i.merge(s.geometry,s.matrix),i}for(let n=0,i=e.length;n<i;n++){const r=e[n].params;this.add(new a.Mesh(t(r),this.materials[r.type]))}}}),e})(),Tn=(()=>{function e(e){e=e||{},this.meshes=[],this.camera=null,this.cameraTarget=new a.Object3D,this.cameraTarget.name="target",this.audio=null,this.audioManager=null,this.objects=new WeakMap,this.configuration={sync:void 0===e.sync||e.sync,afterglow:void 0!==e.afterglow?e.afterglow:0,resetPhysicsOnLoop:void 0===e.resetPhysicsOnLoop||e.resetPhysicsOnLoop},this.enabled={animation:!0,ik:!0,grant:!0,physics:!0,cameraAnimation:!0},this.onBeforePhysics=()=>{},this.sharedPhysics=!1,this.masterPhysics=null}function t(e,t){t=t||{},this.audio=e,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==t.delayTime?t.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime}function r(e,t){this.mesh=e,this.grants=t||[]}return e.prototype={constructor:e,add:function(e,t){if(t=t||{},e.isSkinnedMesh)this._addMesh(e,t);else if(e.isCamera)this._setupCamera(e,t);else{if("Audio"!==e.type)throw new Error("THREE.MMDAnimationHelper.add: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");this._setupAudio(e,t)}return this.configuration.sync&&this._syncDuration(),this},remove:function(e){if(e.isSkinnedMesh)this._removeMesh(e);else if(e.isCamera)this._clearCamera(e);else{if("Audio"!==e.type)throw new Error("THREE.MMDAnimationHelper.remove: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");this._clearAudio(e)}return this.configuration.sync&&this._syncDuration(),this},update:function(e){null!==this.audioManager&&this.audioManager.control(e);for(let t=0;t<this.meshes.length;t++)this._animateMesh(this.meshes[t],e);return this.sharedPhysics&&this._updateSharedPhysics(e),null!==this.camera&&this._animateCamera(this.camera,e),this},pose:function(e,t,r){!1!==(r=r||{}).resetPose&&e.pose();const n=e.skeleton.bones,i=t.bones,o={};for(let a=0,c=n.length;a<c;a++)o[n[a].name]=a;const s=new a.Vector3,l=new a.Quaternion;for(let a=0,c=i.length;a<c;a++){const e=i[a],t=o[e.name];if(void 0===t)continue;const r=n[t];r.position.add(s.fromArray(e.translation)),r.quaternion.multiply(l.fromArray(e.quaternion))}return e.updateMatrixWorld(!0),!1!==r.ik&&this._createCCDIKSolver(e).update(r.saveOriginalBonesBeforeIK),!1!==r.grant&&this.createGrantSolver(e).update(),this},enable:function(e,t){if(void 0===this.enabled[e])throw new Error(`THREE.MMDAnimationHelper.enable: unknown key ${e}`);if(this.enabled[e]=t,"physics"===e)for(let r=0,n=this.meshes.length;r<n;r++)this._optimizeIK(this.meshes[r],t);return this},createGrantSolver:function(e){return new r(e,e.geometry.userData.MMD.grants)},_addMesh:function(e,t){if(this.meshes.indexOf(e)>=0)throw new Error(`THREE.MMDAnimationHelper._addMesh: SkinnedMesh '${e.name}' has already been added.`);return this.meshes.push(e),this.objects.set(e,{looped:!1}),this._setupMeshAnimation(e,t.animation),!1!==t.physics&&this._setupMeshPhysics(e,t),this},_setupCamera:function(e,t){if(this.camera===e)throw new Error(`THREE.MMDAnimationHelper._setupCamera: Camera '${e.name}' has already been set.`);return this.camera&&this.clearCamera(this.camera),this.camera=e,e.add(this.cameraTarget),this.objects.set(e,{}),void 0!==t.animation&&this._setupCameraAnimation(e,t.animation),this},_setupAudio:function(e,r){if(this.audio===e)throw new Error(`THREE.MMDAnimationHelper._setupAudio: Audio '${e.name}' has already been set.`);return this.audio&&this.clearAudio(this.audio),this.audio=e,this.audioManager=new t(e,r),this.objects.set(this.audioManager,{duration:this.audioManager.duration}),this},_removeMesh:function(e){let t=!1,r=0;for(let n=0,i=this.meshes.length;n<i;n++)this.meshes[n]!==e?this.meshes[r++]=this.meshes[n]:(this.objects.delete(e),t=!0);if(!t)throw new Error(`THREE.MMDAnimationHelper._removeMesh: SkinnedMesh '${e.name}' has not been added yet.`);return this.meshes.length=r,this},_clearCamera:function(e){if(e!==this.camera)throw new Error(`THREE.MMDAnimationHelper._clearCamera: Camera '${e.name}' has not been set yet.`);return this.camera.remove(this.cameraTarget),this.objects.delete(this.camera),this.camera=null,this},_clearAudio:function(e){if(e!==this.audio)throw new Error(`THREE.MMDAnimationHelper._clearAudio: Audio '${e.name}' has not been set yet.`);return this.objects.delete(this.audioManager),this.audio=null,this.audioManager=null,this},_setupMeshAnimation:function(e,t){const r=this.objects.get(e);if(void 0!==t){const n=Array.isArray(t)?t:[t];r.mixer=new a.AnimationMixer(e);for(let e=0,t=n.length;e<t;e++)r.mixer.clipAction(n[e]).play();r.mixer.addEventListener("loop",(e=>{const t=e.action._clip.tracks;t.length>0&&".bones"!==t[0].name.slice(0,6)||(r.looped=!0)}))}return r.ikSolver=this._createCCDIKSolver(e),r.grantSolver=this.createGrantSolver(e),this},_setupCameraAnimation:function(e,t){const r=Array.isArray(t)?t:[t],n=this.objects.get(e);n.mixer=new a.AnimationMixer(e);for(let i=0,o=r.length;i<o;i++)n.mixer.clipAction(r[i]).play()},_setupMeshPhysics:function(e,t){const r=this.objects.get(e);if(void 0===t.world&&this.sharedPhysics){const e=this._getMasterPhysics();null!==e&&(world=e.world)}r.physics=this._createMMDPhysics(e,t),r.mixer&&!1!==t.animationWarmup&&(this._animateMesh(e,0),r.physics.reset()),r.physics.warmup(void 0!==t.warmup?t.warmup:60),this._optimizeIK(e,!0)},_animateMesh:function(e,t){const r=this.objects.get(e),n=r.mixer,i=r.ikSolver,o=r.grantSolver,a=r.physics,s=r.looped;n&&this.enabled.animation&&(this._restoreBones(e),n.update(t),this._saveBones(e),i&&this.enabled.ik&&(e.updateMatrixWorld(!0),i.update()),o&&this.enabled.grant&&o.update()),!0===s&&this.enabled.physics&&(a&&this.configuration.resetPhysicsOnLoop&&a.reset(),r.looped=!1),a&&this.enabled.physics&&!this.sharedPhysics&&(this.onBeforePhysics(e),a.update(t))},_animateCamera:function(e,t){const r=this.objects.get(e).mixer;r&&this.enabled.cameraAnimation&&(r.update(t),e.updateProjectionMatrix(),e.up.set(0,1,0),e.up.applyQuaternion(e.quaternion),e.lookAt(this.cameraTarget.position))},_optimizeIK:function(e,t){const r=e.geometry.userData.MMD.iks,n=e.geometry.userData.MMD.bones;for(let i=0,o=r.length;i<o;i++){const e=r[i].links;for(let r=0,i=e.length;r<i;r++){const i=e[r];i.enabled=!0!==t||!(n[i.index].rigidBodyType>0)}}},_createCCDIKSolver:function(e){if(void 0===En)throw new Error("THREE.MMDAnimationHelper: Import CCDIKSolver.");return new En(e,e.geometry.userData.MMD.iks)},_createMMDPhysics:function(e,t){if(void 0===Sn)throw new Error("THREE.MMDPhysics: Import MMDPhysics.");return new Sn(e,e.geometry.userData.MMD.rigidBodies,e.geometry.userData.MMD.constraints,t)},_syncDuration:function(){let e=0;const t=this.objects,r=this.meshes,n=this.camera,i=this.audioManager;for(let s=0,l=r.length;s<l;s++){if(void 0!==(a=this.objects.get(r[s]).mixer))for(let r=0;r<a._actions.length;r++){var o=a._actions[r]._clip;t.has(o)||t.set(o,{duration:o.duration}),e=Math.max(e,t.get(o).duration)}}if(null!==n&&void 0!==(a=this.objects.get(n).mixer))for(let s=0,l=a._actions.length;s<l;s++){o=a._actions[s]._clip;t.has(o)||t.set(o,{duration:o.duration}),e=Math.max(e,t.get(o).duration)}null!==i&&(e=Math.max(e,t.get(i).duration)),e+=this.configuration.afterglow;for(let s=0,l=this.meshes.length;s<l;s++){var a;if(void 0!==(a=this.objects.get(this.meshes[s]).mixer))for(let t=0,r=a._actions.length;t<r;t++)a._actions[t]._clip.duration=e}if(null!==n&&void 0!==(a=this.objects.get(n).mixer))for(let s=0,l=a._actions.length;s<l;s++)a._actions[s]._clip.duration=e;null!==i&&(i.duration=e)},_updatePropertyMixersBuffer:function(e){const t=this.objects.get(e).mixer,r=t._bindings,n=t._accuIndex;for(let i=0,o=r.length;i<o;i++){const e=r[i],t=e.buffer,o=(n+1)*e.valueSize;e.binding.getValue(t,o)}},_saveBones:function(e){const t=this.objects.get(e),r=e.skeleton.bones;let n=t.backupBones;void 0===n&&(n=new Float32Array(7*r.length),t.backupBones=n);for(let i=0,o=r.length;i<o;i++){const e=r[i];e.position.toArray(n,7*i),e.quaternion.toArray(n,7*i+3)}},_restoreBones:function(e){const t=this.objects.get(e).backupBones;if(void 0===t)return;const r=e.skeleton.bones;for(let n=0,i=r.length;n<i;n++){const e=r[n];e.position.fromArray(t,7*n),e.quaternion.fromArray(t,7*n+3)}},_getMasterPhysics:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(let e=0,t=this.meshes.length;e<t;e++){const t=this.meshes[e].physics;if(void 0!==t&&null!==t)return this.masterPhysics=t,this.masterPhysics}return null},_updateSharedPhysics:function(e){if(0===this.meshes.length||!this.enabled.physics||!this.sharedPhysics)return;const t=this._getMasterPhysics();if(null!==t){for(let e=0,t=this.meshes.length;e<t;e++){null!==(r=this.meshes[e].physics)&&void 0!==r&&r.updateRigidBodies()}t.stepSimulation(e);for(let e=0,t=this.meshes.length;e<t;e++){var r;null!==(r=this.meshes[e].physics)&&void 0!==r&&r.updateBones()}}}},t.prototype={constructor:t,control:function(e){return this.elapsed+=e,this.currentTime+=e,this._shouldStopAudio()&&this.audio.stop(),this._shouldStartAudio()&&this.audio.play(),this},_shouldStartAudio:function(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime)&&!(this.currentTime-this.delayTime>this.audioDuration)},_shouldStopAudio:function(){return this.audio.isPlaying&&this.currentTime>=this.duration}},r.prototype={constructor:r,update:(()=>{const e=new a.Quaternion;return function(){const t=this.mesh.skeleton.bones,r=this.grants;for(let n=0,i=r.length;n<i;n++){const i=r[n],o=t[i.index],a=t[i.parentIndex];i.isLocal?(i.affectPosition,i.affectRotation):(i.affectPosition,i.affectRotation&&(e.set(0,0,0,1),e.slerp(a.quaternion,i.ratio),o.quaternion.multiply(e)))}return this}})()},e})();class Mn extends a.Mesh{constructor(e,t={}){super(e),this.type="Reflector";const r=this,n=void 0!==t.color?new a.Color(t.color):new a.Color(8355711),i=t.textureWidth||512,o=t.textureHeight||512,s=t.clipBias||0,l=t.shader||Mn.ReflectorShader,c=new a.Plane,u=new a.Vector3,h=new a.Vector3,d=new a.Vector3,f=new a.Matrix4,p=new a.Vector3(0,0,-1),m=new a.Vector4,g=new a.Vector3,A=new a.Vector3,v=new a.Vector4,y=new a.Matrix4,x=new a.PerspectiveCamera,b=new a.WebGLRenderTarget(i,o),w=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});w.uniforms.tDiffuse.value=b.texture,w.uniforms.color.value=n,w.uniforms.textureMatrix.value=y,this.material=w,this.onBeforeRender=function(e,t,n){if(h.setFromMatrixPosition(r.matrixWorld),d.setFromMatrixPosition(n.matrixWorld),f.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(f),g.subVectors(h,d),g.dot(u)>0)return;g.reflect(u).negate(),g.add(h),f.extractRotation(n.matrixWorld),p.set(0,0,-1),p.applyMatrix4(f),p.add(d),A.subVectors(h,p),A.reflect(u).negate(),A.add(h),x.position.copy(g),x.up.set(0,1,0),x.up.applyMatrix4(f),x.up.reflect(u),x.lookAt(A),x.far=n.far,x.updateMatrixWorld(),x.projectionMatrix.copy(n.projectionMatrix),y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiply(x.projectionMatrix),y.multiply(x.matrixWorldInverse),y.multiply(r.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(x.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);const i=x.projectionMatrix;v.x=(Math.sign(m.x)+i.elements[8])/i.elements[0],v.y=(Math.sign(m.y)+i.elements[9])/i.elements[5],v.z=-1,v.w=(1+i.elements[10])/i.elements[14],m.multiplyScalar(2/m.dot(v)),i.elements[2]=m.x,i.elements[6]=m.y,i.elements[10]=m.z+1-s,i.elements[14]=m.w,b.texture.encoding=e.outputEncoding,r.visible=!1;const o=e.getRenderTarget(),a=e.xr.enabled,l=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(b),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,x),e.xr.enabled=a,e.shadowMap.autoUpdate=l,e.setRenderTarget(o);const w=n.viewport;void 0!==w&&e.state.viewport(w),r.visible=!0},this.getRenderTarget=function(){return b},this.dispose=function(){b.dispose(),r.material.dispose()}}}Mn.prototype.isReflector=!0,Mn.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t}",fragmentShader:"\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tvarying vec4 vUv;\n\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t}"};class In extends a.Mesh{constructor(e,t={}){super(e),this.type="Refractor";const r=this,n=void 0!==t.color?new a.Color(t.color):new a.Color(8355711),i=t.textureWidth||512,o=t.textureHeight||512,s=t.clipBias||0,l=t.shader||In.RefractorShader,c=new a.PerspectiveCamera;c.matrixAutoUpdate=!1,c.userData.refractor=!0;const u=new a.Plane,h=new a.Matrix4,d=new a.WebGLRenderTarget(i,o);this.material=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,transparent:!0}),this.material.uniforms.color.value=n,this.material.uniforms.tDiffuse.value=d.texture,this.material.uniforms.textureMatrix.value=h;const f=function(){const e=new a.Vector3,t=new a.Vector3,n=new a.Matrix4,i=new a.Vector3,o=new a.Vector3;return function(a){return e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(a.matrixWorld),i.subVectors(e,t),n.extractRotation(r.matrixWorld),o.set(0,0,1),o.applyMatrix4(n),i.dot(o)<0}}(),p=function(){const e=new a.Vector3,t=new a.Vector3,n=new a.Quaternion,i=new a.Vector3;return function(){r.matrixWorld.decompose(t,n,i),e.set(0,0,1).applyQuaternion(n).normalize(),e.negate(),u.setFromNormalAndCoplanarPoint(e,t)}}(),m=function(){const e=new a.Plane,t=new a.Vector4,r=new a.Vector4;return function(n){c.matrixWorld.copy(n.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(n.projectionMatrix),c.far=n.far,e.copy(u),e.applyMatrix4(c.matrixWorldInverse),t.set(e.normal.x,e.normal.y,e.normal.z,e.constant);const i=c.projectionMatrix;r.x=(Math.sign(t.x)+i.elements[8])/i.elements[0],r.y=(Math.sign(t.y)+i.elements[9])/i.elements[5],r.z=-1,r.w=(1+i.elements[10])/i.elements[14],t.multiplyScalar(2/t.dot(r)),i.elements[2]=t.x,i.elements[6]=t.y,i.elements[10]=t.z+1-s,i.elements[14]=t.w}}();this.onBeforeRender=function(e,t,n){d.texture.encoding=e.outputEncoding,!0!==n.userData.refractor&&!0!==!f(n)&&(p(),function(e){h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(e.projectionMatrix),h.multiply(e.matrixWorldInverse),h.multiply(r.matrixWorld)}(n),m(n),function(e,t,n){r.visible=!1;const i=e.getRenderTarget(),o=e.xr.enabled,a=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(d),!1===e.autoClear&&e.clear(),e.render(t,c),e.xr.enabled=o,e.shadowMap.autoUpdate=a,e.setRenderTarget(i);const s=n.viewport;void 0!==s&&e.state.viewport(s),r.visible=!0}(e,t,n))},this.getRenderTarget=function(){return d},this.dispose=function(){d.dispose(),r.material.dispose()}}}In.prototype.isRefractor=!0,In.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec4 vUv;\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t}"};const Bn=new a.Matrix4;class _n extends a.Mesh{constructor(e){const t=new a.MeshBasicMaterial({color:0,transparent:!0,opacity:.6,depthWrite:!1});super(e.geometry,t),this.meshMatrix=e.matrixWorld,this.frustumCulled=!1,this.matrixAutoUpdate=!1}update(e,t){const r=e.normal.x*t.x+e.normal.y*t.y+e.normal.z*t.z+-e.constant*t.w,n=Bn.elements;n[0]=r-t.x*e.normal.x,n[4]=-t.x*e.normal.y,n[8]=-t.x*e.normal.z,n[12]=-t.x*-e.constant,n[1]=-t.y*e.normal.x,n[5]=r-t.y*e.normal.y,n[9]=-t.y*e.normal.z,n[13]=-t.y*-e.constant,n[2]=-t.z*e.normal.x,n[6]=-t.z*e.normal.y,n[10]=r-t.z*e.normal.z,n[14]=-t.z*-e.constant,n[3]=-t.w*e.normal.x,n[7]=-t.w*e.normal.y,n[11]=-t.w*e.normal.z,n[15]=r-t.w*-e.constant,this.matrix.multiplyMatrices(Bn,this.meshMatrix)}}_n.prototype.isShadowMesh=!0;class Fn extends a.Mesh{constructor(){super(Fn.Geometry,new a.MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const e=new a.Vector3,t=new a.Vector3,r=new a.FramebufferTexture(16,16,a.RGBAFormat),n=new a.FramebufferTexture(16,16,a.RGBAFormat),i=Fn.Geometry,o=new a.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n\t\t\t\tprecision highp float;\n\n\t\t\t\tuniform vec3 screenPosition;\n\t\t\t\tuniform vec2 scale;\n\n\t\t\t\tattribute vec3 position;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n\t\t\t\t}",fragmentShader:"\n\n\t\t\t\tprecision highp float;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );\n\n\t\t\t\t}",depthTest:!0,depthWrite:!1,transparent:!1}),s=new a.RawShaderMaterial({uniforms:{map:{value:r},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n\t\t\t\tprecision highp float;\n\n\t\t\t\tuniform vec3 screenPosition;\n\t\t\t\tuniform vec2 scale;\n\n\t\t\t\tattribute vec3 position;\n\t\t\t\tattribute vec2 uv;\n\n\t\t\t\tvarying vec2 vUV;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvUV = uv;\n\n\t\t\t\t\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n\t\t\t\t}",fragmentShader:"\n\n\t\t\t\tprecision highp float;\n\n\t\t\t\tuniform sampler2D map;\n\n\t\t\t\tvarying vec2 vUV;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tgl_FragColor = texture2D( map, vUV );\n\n\t\t\t\t}",depthTest:!1,depthWrite:!1,transparent:!1}),l=new a.Mesh(i,o),c=[],u=Pn.Shader,h=new a.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:n},color:{value:new a.Color(16777215)},scale:{value:new a.Vector2},screenPosition:{value:new a.Vector3}},vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:a.AdditiveBlending,transparent:!0,depthWrite:!1}),d=new a.Mesh(i,h);this.addElement=function(e){c.push(e)};const f=new a.Vector2,p=new a.Vector2,m=new a.Box2,g=new a.Vector4;this.onBeforeRender=function(a,u,A){a.getCurrentViewport(g);const v=g.w/g.z,y=g.z/2,x=g.w/2;let b=16/g.w;if(f.set(b*v,b),m.min.set(g.x,g.y),m.max.set(g.x+(g.z-16),g.y+(g.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(A.matrixWorldInverse),!(t.z>0)&&(e.copy(t).applyMatrix4(A.projectionMatrix),p.x=g.x+e.x*y+y-8,p.y=g.y+e.y*x+x-8,m.containsPoint(p))){a.copyFramebufferToTexture(p,r);let t=o.uniforms;t.scale.value=f,t.screenPosition.value=e,a.renderBufferDirect(A,null,i,o,l,null),a.copyFramebufferToTexture(p,n),t=s.uniforms,t.scale.value=f,t.screenPosition.value=e,a.renderBufferDirect(A,null,i,s,l,null);const u=2*-e.x,m=2*-e.y;for(let r=0,n=c.length;r<n;r++){const t=c[r],n=h.uniforms;n.color.value.copy(t.color),n.map.value=t.texture,n.screenPosition.value.x=e.x+u*t.distance,n.screenPosition.value.y=e.y+m*t.distance,b=t.size/g.w;const o=g.w/g.z;n.scale.value.set(b*o,b),h.uniformsNeedUpdate=!0,a.renderBufferDirect(A,null,i,h,d,null)}}},this.dispose=function(){o.dispose(),s.dispose(),h.dispose(),r.dispose(),n.dispose();for(let e=0,t=c.length;e<t;e++)c[e].texture.dispose()}}}Fn.prototype.isLensflare=!0;class Pn{constructor(e,t=1,r=0,n=new a.Color(16777215)){this.texture=e,this.size=t,this.distance=r,this.color=n}}Pn.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n\t\tprecision highp float;\n\n\t\tuniform vec3 screenPosition;\n\t\tuniform vec2 scale;\n\n\t\tuniform sampler2D occlusionMap;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\n\t\tvarying vec2 vUV;\n\t\tvarying float vVisibility;\n\n\t\tvoid main() {\n\n\t\t\tvUV = uv;\n\n\t\t\tvec2 pos = position.xy;\n\n\t\t\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\n\n\t\t\tvVisibility =        visibility.r / 9.0;\n\t\t\tvVisibility *= 1.0 - visibility.g / 9.0;\n\t\t\tvVisibility *=       visibility.b / 9.0;\n\n\t\t\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D map;\n\t\tuniform vec3 color;\n\n\t\tvarying vec2 vUV;\n\t\tvarying float vVisibility;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texture = texture2D( map, vUV );\n\t\t\ttexture.a *= vVisibility;\n\t\t\tgl_FragColor = texture;\n\t\t\tgl_FragColor.rgb *= color;\n\n\t\t}"},Fn.Geometry=function(){const e=new a.BufferGeometry,t=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),r=new a.InterleavedBuffer(t,5);return e.setIndex([0,1,2,0,2,3]),e.setAttribute("position",new a.InterleavedBufferAttribute(r,3,0,!1)),e.setAttribute("uv",new a.InterleavedBufferAttribute(r,2,3,!1)),e}();class Rn extends a.Mesh{constructor(e,t={}){super(e);const r=this,n=void 0!==t.textureWidth?t.textureWidth:512,i=void 0!==t.textureHeight?t.textureHeight:512,o=void 0!==t.clipBias?t.clipBias:0,s=void 0!==t.alpha?t.alpha:1,l=void 0!==t.time?t.time:0,c=void 0!==t.waterNormals?t.waterNormals:null,u=void 0!==t.sunDirection?t.sunDirection:new a.Vector3(.70707,.70707,0),h=new a.Color(void 0!==t.sunColor?t.sunColor:16777215),d=new a.Color(void 0!==t.waterColor?t.waterColor:8355711),f=void 0!==t.eye?t.eye:new a.Vector3(0,0,0),p=void 0!==t.distortionScale?t.distortionScale:20,m=void 0!==t.side?t.side:a.FrontSide,g=void 0!==t.fog&&t.fog,A=new a.Plane,v=new a.Vector3,y=new a.Vector3,x=new a.Vector3,b=new a.Matrix4,w=new a.Vector3(0,0,-1),C=new a.Vector4,E=new a.Vector3,S=new a.Vector3,T=new a.Vector4,M=new a.Matrix4,I=new a.PerspectiveCamera,B=new a.WebGLRenderTarget(n,i),_={uniforms:a.UniformsUtils.merge([a.UniformsLib.fog,a.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new a.Matrix4},sunColor:{value:new a.Color(8355711)},sunDirection:{value:new a.Vector3(.70707,.70707,0)},eye:{value:new a.Vector3},waterColor:{value:new a.Color(5592405)}}]),vertexShader:"\n\t\t\t\tuniform mat4 textureMatrix;\n\t\t\t\tuniform float time;\n\n\t\t\t\tvarying vec4 mirrorCoord;\n\t\t\t\tvarying vec4 worldPosition;\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tmirrorCoord = modelMatrix * vec4( position, 1.0 );\n\t\t\t\t\tworldPosition = mirrorCoord.xyzw;\n\t\t\t\t\tmirrorCoord = textureMatrix * mirrorCoord;\n\t\t\t\t\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t\t#include <beginnormal_vertex>\n\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t#include <fog_vertex>\n\t\t\t\t#include <shadowmap_vertex>\n\t\t\t}",fragmentShader:"\n\t\t\t\tuniform sampler2D mirrorSampler;\n\t\t\t\tuniform float alpha;\n\t\t\t\tuniform float time;\n\t\t\t\tuniform float size;\n\t\t\t\tuniform float distortionScale;\n\t\t\t\tuniform sampler2D normalSampler;\n\t\t\t\tuniform vec3 sunColor;\n\t\t\t\tuniform vec3 sunDirection;\n\t\t\t\tuniform vec3 eye;\n\t\t\t\tuniform vec3 waterColor;\n\n\t\t\t\tvarying vec4 mirrorCoord;\n\t\t\t\tvarying vec4 worldPosition;\n\n\t\t\t\tvec4 getNoise( vec2 uv ) {\n\t\t\t\t\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);\n\t\t\t\t\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );\n\t\t\t\t\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );\n\t\t\t\t\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );\n\t\t\t\t\tvec4 noise = texture2D( normalSampler, uv0 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv1 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv2 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv3 );\n\t\t\t\t\treturn noise * 0.5 - 1.0;\n\t\t\t\t}\n\n\t\t\t\tvoid sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n\t\t\t\t\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );\n\t\t\t\t\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );\n\t\t\t\t\tspecularColor += pow( direction, shiny ) * sunColor * spec;\n\t\t\t\t\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n\t\t\t\t}\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <packing>\n\t\t\t\t#include <bsdfs>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <lights_pars_begin>\n\t\t\t\t#include <shadowmap_pars_fragment>\n\t\t\t\t#include <shadowmask_pars_fragment>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\t\t\t\t\tvec4 noise = getNoise( worldPosition.xz * size );\n\t\t\t\t\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );\n\n\t\t\t\t\tvec3 diffuseLight = vec3(0.0);\n\t\t\t\t\tvec3 specularLight = vec3(0.0);\n\n\t\t\t\t\tvec3 worldToEye = eye-worldPosition.xyz;\n\t\t\t\t\tvec3 eyeDirection = normalize( worldToEye );\n\t\t\t\t\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\n\n\t\t\t\t\tfloat distance = length(worldToEye);\n\n\t\t\t\t\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;\n\t\t\t\t\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );\n\n\t\t\t\t\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );\n\t\t\t\t\tfloat rf0 = 0.3;\n\t\t\t\t\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );\n\t\t\t\t\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;\n\t\t\t\t\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);\n\t\t\t\t\tvec3 outgoingLight = albedo;\n\t\t\t\t\tgl_FragColor = vec4( outgoingLight, alpha );\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t}"},F=new a.ShaderMaterial({fragmentShader:_.fragmentShader,vertexShader:_.vertexShader,uniforms:a.UniformsUtils.clone(_.uniforms),lights:!0,side:m,fog:g});F.uniforms.mirrorSampler.value=B.texture,F.uniforms.textureMatrix.value=M,F.uniforms.alpha.value=s,F.uniforms.time.value=l,F.uniforms.normalSampler.value=c,F.uniforms.sunColor.value=h,F.uniforms.waterColor.value=d,F.uniforms.sunDirection.value=u,F.uniforms.distortionScale.value=p,F.uniforms.eye.value=f,r.material=F,r.onBeforeRender=function(e,t,n){if(y.setFromMatrixPosition(r.matrixWorld),x.setFromMatrixPosition(n.matrixWorld),b.extractRotation(r.matrixWorld),v.set(0,0,1),v.applyMatrix4(b),E.subVectors(y,x),E.dot(v)>0)return;E.reflect(v).negate(),E.add(y),b.extractRotation(n.matrixWorld),w.set(0,0,-1),w.applyMatrix4(b),w.add(x),S.subVectors(y,w),S.reflect(v).negate(),S.add(y),I.position.copy(E),I.up.set(0,1,0),I.up.applyMatrix4(b),I.up.reflect(v),I.lookAt(S),I.far=n.far,I.updateMatrixWorld(),I.projectionMatrix.copy(n.projectionMatrix),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(I.projectionMatrix),M.multiply(I.matrixWorldInverse),A.setFromNormalAndCoplanarPoint(v,y),A.applyMatrix4(I.matrixWorldInverse),C.set(A.normal.x,A.normal.y,A.normal.z,A.constant);const i=I.projectionMatrix;T.x=(Math.sign(C.x)+i.elements[8])/i.elements[0],T.y=(Math.sign(C.y)+i.elements[9])/i.elements[5],T.z=-1,T.w=(1+i.elements[10])/i.elements[14],C.multiplyScalar(2/C.dot(T)),i.elements[2]=C.x,i.elements[6]=C.y,i.elements[10]=C.z+1-o,i.elements[14]=C.w,f.setFromMatrixPosition(n.matrixWorld);const a=e.getRenderTarget(),s=e.xr.enabled,l=e.shadowMap.autoUpdate;r.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(B),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,I),r.visible=!0,e.xr.enabled=s,e.shadowMap.autoUpdate=l,e.setRenderTarget(a);const c=n.viewport;void 0!==c&&e.state.viewport(c)}}}Rn.prototype.isWater=!0;class Ln extends a.ImmediateRenderObject{constructor(e,t,r,n){super(t);const i=this,o=new Float32Array(36),s=new Float32Array(36),l=new Float32Array(36);function c(e,t,r){return e+(t-e)*r}function u(e,t,r,n,a,u,h,d,f,p){const m=(r-h)/(d-h),g=i.normal_cache;o[t+0]=n+m*i.delta,o[t+1]=a,o[t+2]=u,s[t+0]=c(g[e+0],g[e+3],m),s[t+1]=c(g[e+1],g[e+4],m),s[t+2]=c(g[e+2],g[e+5],m),l[t+0]=c(i.palette[3*f+0],i.palette[3*p+0],m),l[t+1]=c(i.palette[3*f+1],i.palette[3*p+1],m),l[t+2]=c(i.palette[3*f+2],i.palette[3*p+2],m)}function h(e,t,r,n,a,u,h,d,f,p){const m=(r-h)/(d-h),g=i.normal_cache;o[t+0]=n,o[t+1]=a+m*i.delta,o[t+2]=u;const A=e+3*i.yd;s[t+0]=c(g[e+0],g[A+0],m),s[t+1]=c(g[e+1],g[A+1],m),s[t+2]=c(g[e+2],g[A+2],m),l[t+0]=c(i.palette[3*f+0],i.palette[3*p+0],m),l[t+1]=c(i.palette[3*f+1],i.palette[3*p+1],m),l[t+2]=c(i.palette[3*f+2],i.palette[3*p+2],m)}function d(e,t,r,n,a,u,h,d,f,p){const m=(r-h)/(d-h),g=i.normal_cache;o[t+0]=n,o[t+1]=a,o[t+2]=u+m*i.delta;const A=e+3*i.zd;s[t+0]=c(g[e+0],g[A+0],m),s[t+1]=c(g[e+1],g[A+1],m),s[t+2]=c(g[e+2],g[A+2],m),l[t+0]=c(i.palette[3*f+0],i.palette[3*p+0],m),l[t+1]=c(i.palette[3*f+1],i.palette[3*p+1],m),l[t+2]=c(i.palette[3*f+2],i.palette[3*p+2],m)}function f(e){const t=3*e;0===i.normal_cache[t]&&(i.normal_cache[t+0]=i.field[e-1]-i.field[e+1],i.normal_cache[t+1]=i.field[e-i.yd]-i.field[e+i.yd],i.normal_cache[t+2]=i.field[e-i.zd]-i.field[e+i.zd])}function p(e,t,r,n,a,c){const p=n+1,g=n+i.yd,A=n+i.zd,v=p+i.yd,y=p+i.zd,x=n+i.yd+i.zd,b=p+i.yd+i.zd;let w=0;const C=i.field[n],E=i.field[p],S=i.field[g],T=i.field[v],M=i.field[A],I=i.field[y],B=i.field[x],_=i.field[b];C<a&&(w|=1),E<a&&(w|=2),S<a&&(w|=8),T<a&&(w|=4),M<a&&(w|=16),I<a&&(w|=32),B<a&&(w|=128),_<a&&(w|=64);const F=Dn[w];if(0===F)return 0;const P=i.delta,R=e+P,L=t+P,D=r+P;1&F&&(f(n),f(p),u(3*n,0,a,e,t,r,C,E,n,p)),2&F&&(f(p),f(v),h(3*p,3,a,R,t,r,E,T,p,v)),4&F&&(f(g),f(v),u(3*g,6,a,e,L,r,S,T,g,v)),8&F&&(f(n),f(g),h(3*n,9,a,e,t,r,C,S,n,g)),16&F&&(f(A),f(y),u(3*A,12,a,e,t,D,M,I,A,y)),32&F&&(f(y),f(b),h(3*y,15,a,R,t,D,I,_,y,b)),64&F&&(f(x),f(b),u(3*x,18,a,e,L,D,B,_,x,b)),128&F&&(f(A),f(x),h(3*A,21,a,e,t,D,M,B,A,x)),256&F&&(f(n),f(A),d(3*n,24,a,e,t,r,C,M,n,A)),512&F&&(f(p),f(y),d(3*p,27,a,R,t,r,E,I,p,y)),1024&F&&(f(v),f(b),d(3*v,30,a,R,L,r,T,_,v,b)),2048&F&&(f(g),f(x),d(3*g,33,a,e,L,r,S,B,g,x)),w<<=4;let N,k,O,U=0,Q=0;for(;-1!=Nn[w+Q];)N=w+Q,k=N+1,O=N+2,m(o,s,l,3*Nn[N],3*Nn[k],3*Nn[O],c),Q+=3,U++;return U}function m(e,t,r,n,o,a,s){const l=3*i.count;if(i.positionArray[l+0]=e[n],i.positionArray[l+1]=e[n+1],i.positionArray[l+2]=e[n+2],i.positionArray[l+3]=e[o],i.positionArray[l+4]=e[o+1],i.positionArray[l+5]=e[o+2],i.positionArray[l+6]=e[a],i.positionArray[l+7]=e[a+1],i.positionArray[l+8]=e[a+2],!0===i.material.flatShading){const e=(t[n+0]+t[o+0]+t[a+0])/3,r=(t[n+1]+t[o+1]+t[a+1])/3,s=(t[n+2]+t[o+2]+t[a+2])/3;i.normalArray[l+0]=e,i.normalArray[l+1]=r,i.normalArray[l+2]=s,i.normalArray[l+3]=e,i.normalArray[l+4]=r,i.normalArray[l+5]=s,i.normalArray[l+6]=e,i.normalArray[l+7]=r,i.normalArray[l+8]=s}else i.normalArray[l+0]=t[n+0],i.normalArray[l+1]=t[n+1],i.normalArray[l+2]=t[n+2],i.normalArray[l+3]=t[o+0],i.normalArray[l+4]=t[o+1],i.normalArray[l+5]=t[o+2],i.normalArray[l+6]=t[a+0],i.normalArray[l+7]=t[a+1],i.normalArray[l+8]=t[a+2];if(i.enableUvs){const t=2*i.count;i.uvArray[t+0]=e[n+0],i.uvArray[t+1]=e[n+2],i.uvArray[t+2]=e[o+0],i.uvArray[t+3]=e[o+2],i.uvArray[t+4]=e[a+0],i.uvArray[t+5]=e[a+2]}i.enableColors&&(i.colorArray[l+0]=r[n+0],i.colorArray[l+1]=r[n+1],i.colorArray[l+2]=r[n+2],i.colorArray[l+3]=r[o+0],i.colorArray[l+4]=r[o+1],i.colorArray[l+5]=r[o+2],i.colorArray[l+6]=r[a+0],i.colorArray[l+7]=r[a+1],i.colorArray[l+8]=r[a+2]),i.count+=3,i.count>=i.maxCount-3&&(i.hasPositions=!0,i.hasNormals=!0,i.enableUvs&&(i.hasUvs=!0),i.enableColors&&(i.hasColors=!0),s(i))}function g(e,t,r){const n=new Float32Array(e.length+r);return n.set(e,0),n.set(t.slice(0,r),e.length),n}this.enableUvs=void 0!==r&&r,this.enableColors=void 0!==n&&n,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.palette=new Float32Array(3*this.size3),this.maxCount=4096,this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=new Float32Array(3*this.maxCount),this.normalArray=new Float32Array(3*this.maxCount),this.enableUvs&&(this.uvArray=new Float32Array(2*this.maxCount)),this.enableColors&&(this.colorArray=new Float32Array(3*this.maxCount))},this.begin=function(){this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasUvs=!1,this.hasColors=!1},this.end=function(e){if(0!==this.count){for(let e=3*this.count;e<this.positionArray.length;e++)this.positionArray[e]=0;this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&this.material.map&&(this.hasUvs=!0),this.enableColors&&this.material.vertexColors!==a.NoColors&&(this.hasColors=!0),e(this)}},this.addBall=function(e,t,r,n,i,o){const s=Math.sign(n);n=Math.abs(n);const l=!(void 0===o||null===o);let c=new a.Color(e,t,r);if(l)try{c=o instanceof a.Color?o:Array.isArray(o)?new a.Color(Math.min(Math.abs(o[0]),1),Math.min(Math.abs(o[1]),1),Math.min(Math.abs(o[2]),1)):new a.Color(o)}catch(F){c=new a.Color(e,t,r)}const u=this.size*Math.sqrt(n/i),h=r*this.size,d=t*this.size,f=e*this.size;let p=Math.floor(h-u);p<1&&(p=1);let m=Math.floor(h+u);m>this.size-1&&(m=this.size-1);let g=Math.floor(d-u);g<1&&(g=1);let A=Math.floor(d+u);A>this.size-1&&(A=this.size-1);let v=Math.floor(f-u);v<1&&(v=1);let y,x,b,w,C,E,S,T,M,I,B,_=Math.floor(f+u);for(_>this.size-1&&(_=this.size-1),b=p;b<m;b++)for(C=this.size2*b,T=b/this.size-r,M=T*T,x=g;x<A;x++)for(w=C+this.size*x,S=x/this.size-t,I=S*S,y=v;y<_;y++)if(E=y/this.size-e,B=n/(1e-6+E*E+I+M)-i,B>0){this.field[w+y]+=B*s;const e=Math.sqrt((y-f)*(y-f)+(x-d)*(x-d)+(b-h)*(b-h))/u,t=1-e*e*e*(e*(6*e-15)+10);this.palette[3*(w+y)+0]+=c.r*t,this.palette[3*(w+y)+1]+=c.g*t,this.palette[3*(w+y)+2]+=c.b*t}},this.addPlaneX=function(e,t){const r=this.size,n=this.yd,i=this.zd,o=this.field;let a,s,l,c,u,h,d,f=r*Math.sqrt(e/t);for(f>r&&(f=r),a=0;a<f;a++)if(h=a/r,c=h*h,u=e/(1e-4+c)-t,u>0)for(s=0;s<r;s++)for(d=a+s*n,l=0;l<r;l++)o[i*l+d]+=u},this.addPlaneY=function(e,t){const r=this.size,n=this.yd,i=this.zd,o=this.field;let a,s,l,c,u,h,d,f,p=r*Math.sqrt(e/t);for(p>r&&(p=r),s=0;s<p;s++)if(h=s/r,c=h*h,u=e/(1e-4+c)-t,u>0)for(d=s*n,a=0;a<r;a++)for(f=d+a,l=0;l<r;l++)o[i*l+f]+=u},this.addPlaneZ=function(e,t){const r=this.size,n=this.yd,i=this.zd,o=this.field;let a,s,l,c,u,h,d,f,p=r*Math.sqrt(e/t);for(p>r&&(p=r),l=0;l<p;l++)if(h=l/r,c=h*h,u=e/(1e-4+c)-t,u>0)for(d=i*l,s=0;s<r;s++)for(f=d+s*n,a=0;a<r;a++)o[f+a]+=u},this.setCell=function(e,t,r,n){const i=this.size2*r+this.size*t+e;this.field[i]=n},this.getCell=function(e,t,r){const n=this.size2*r+this.size*t+e;return this.field[n]},this.blur=function(e=1){const t=this.field,r=t.slice(),n=this.size,i=this.size2;for(let o=0;o<n;o++)for(let a=0;a<n;a++)for(let s=0;s<n;s++){const l=i*s+n*a+o;let c=r[l],u=1;for(let t=-1;t<=1;t+=2){const l=t+o;if(!(l<0||l>=n))for(let t=-1;t<=1;t+=2){const o=t+a;if(!(o<0||o>=n))for(let t=-1;t<=1;t+=2){const a=t+s;if(a<0||a>=n)continue;const h=r[i*a+n*o+l];u++,c+=e*(h-c)/u}}}t[l]=c}},this.reset=function(){for(let e=0;e<this.size3;e++)this.normal_cache[3*e]=0,this.field[e]=0,this.palette[3*e]=this.palette[3*e+1]=this.palette[3*e+2]=0},this.render=function(e){this.begin();const t=this.size-2;for(let r=1;r<t;r++){const n=this.size2*r,i=(r-this.halfsize)/this.halfsize;for(let r=1;r<t;r++){const o=n+this.size*r,a=(r-this.halfsize)/this.halfsize;for(let r=1;r<t;r++){p((r-this.halfsize)/this.halfsize,a,i,o+r,this.isolation,e)}}}this.end(e)},this.generateGeometry=function(){return console.warn("THREE.MarchingCubes: generateGeometry() now returns BufferGeometry"),this.generateBufferGeometry()},this.generateBufferGeometry=function(){const e=new a.BufferGeometry;let t=new Float32Array,r=new Float32Array,n=new Float32Array,i=new Float32Array;const o=this;return this.render((function(e){o.hasPositions&&(t=g(t,e.positionArray,3*e.count)),o.hasNormals&&(r=g(r,e.normalArray,3*e.count)),o.hasColors&&(n=g(n,e.colorArray,3*e.count)),o.hasUvs&&(i=g(i,e.uvArray,2*e.count)),e.count=0})),this.hasPositions&&e.setAttribute("position",new a.BufferAttribute(t,3)),this.hasNormals&&e.setAttribute("normal",new a.BufferAttribute(r,3)),this.hasColors&&e.setAttribute("color",new a.BufferAttribute(n,3)),this.hasUvs&&e.setAttribute("uv",new a.BufferAttribute(i,2)),e},this.init(e)}}Ln.prototype.isMarchingCubes=!0;const Dn=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),Nn=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);var kn=r(876);class On extends a.BufferGeometry{constructor(e){super(),this.type="LightningStrike",e=e||{},this.init(On.copyParameters(e,e)),this.createMesh()}update(e){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=e&&e<=this.rayParameters.deathTime?(this.updateMesh(e),e<this.subrays[0].endPropagationTime?this.state=On.RAY_PROPAGATING:e>this.subrays[0].beginVanishingTime?this.state=On.RAY_VANISHING:this.state=On.RAY_STEADY,this.visible=!0):(this.visible=!1,e<this.rayParameters.birthTime?this.state=On.RAY_UNBORN:this.state=On.RAY_EXTINGUISHED))}init(e){this.rayParameters=e,this.maxIterations=void 0!==e.maxIterations?Math.floor(e.maxIterations):9,e.maxIterations=this.maxIterations,this.isStatic=void 0!==e.isStatic&&e.isStatic,e.isStatic=this.isStatic,this.ramification=void 0!==e.ramification?Math.floor(e.ramification):5,e.ramification=this.ramification,this.maxSubrayRecursion=void 0!==e.maxSubrayRecursion?Math.floor(e.maxSubrayRecursion):3,e.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=void 0!==e.recursionProbability?e.recursionProbability:.6,e.recursionProbability=this.recursionProbability,this.generateUVs=void 0!==e.generateUVs&&e.generateUVs,e.generateUVs=this.generateUVs,void 0!==e.randomGenerator?(this.randomGenerator=e.randomGenerator,this.seedGenerator=e.randomGenerator,void 0!==e.noiseSeed&&this.seedGenerator.setSeed(e.noiseSeed)):(this.randomGenerator=On.createRandomGenerator(),this.seedGenerator=Math),void 0!==e.onDecideSubrayCreation?this.onDecideSubrayCreation=e.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),void 0!==e.onSubrayCreation&&(this.onSubrayCreation=e.onSubrayCreation)),this.state=On.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),e.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(let t=0;t<this.maxSubrays;t++)this.subrays.push(this.createSubray());this.raySegments=[];for(let t=0;t<this.maxRaySegments;t++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=new kn.L(this.seedGenerator),this.simplexY=new kn.L(this.seedGenerator),this.simplexZ=new kn.L(this.seedGenerator),this.forwards=new a.Vector3,this.forwardsFill=new a.Vector3,this.side=new a.Vector3,this.down=new a.Vector3,this.middlePos=new a.Vector3,this.middleLinPos=new a.Vector3,this.newPos=new a.Vector3,this.vPos=new a.Vector3,this.cross1=new a.Vector3}createMesh(){const e=1<<this.maxIterations,t=3*(e+1)*this.maxSubrays,r=18*e*this.maxSubrays;this.vertices=new Float32Array(3*t),this.indices=new Uint32Array(r),this.generateUVs&&(this.uvs=new Float32Array(2*t)),this.fillMesh(0),this.setIndex(new a.Uint32BufferAttribute(this.indices,1)),this.positionAttribute=new a.Float32BufferAttribute(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new a.Float32BufferAttribute(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),this.isStatic||(this.index.usage=a.DynamicDrawUsage,this.positionAttribute.usage=a.DynamicDrawUsage,this.generateUVs&&(this.uvsAttribute.usage=a.DynamicDrawUsage)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)}updateMesh(e){this.fillMesh(e),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)}fillMesh(e){const t=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(e,(function(r){const n=t.currentSubray;e<n.birthTime||(this.rayParameters.isEternal&&0==t.currentSubray.recursion?(t.createPrism(r),t.onDecideSubrayCreation(r,t)):e<n.endPropagationTime?t.timeFraction>=r.fraction0*n.propagationTimeFactor&&(t.createPrism(r),t.onDecideSubrayCreation(r,t)):e<n.beginVanishingTime?(t.createPrism(r),t.onDecideSubrayCreation(r,t)):(t.timeFraction<=n.vanishingTimeFactor+r.fraction1*(1-n.vanishingTimeFactor)&&t.createPrism(r),t.onDecideSubrayCreation(r,t)))}))}addNewSubray(){return this.subrays[this.numSubrays++]}initSubray(e,t){e.pos0.copy(t.sourceOffset),e.pos1.copy(t.destOffset),e.up0.copy(t.up0),e.up1.copy(t.up1),e.radius0=t.radius0,e.radius1=t.radius1,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.timeScale=t.timeScale,e.roughness=t.roughness,e.straightness=t.straightness,e.propagationTimeFactor=t.propagationTimeFactor,e.vanishingTimeFactor=t.vanishingTimeFactor,e.maxIterations=this.maxIterations,e.seed=void 0!==t.noiseSeed?t.noiseSeed:0,e.recursion=0}fractalRay(e,t){this.time=e,this.currentSegmentCallback=t,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(let r=0;r<this.numSubrays;r++){const t=this.subrays[r];this.currentSubray=t,this.randomGenerator.setSeed(t.seed),t.endPropagationTime=a.MathUtils.lerp(t.birthTime,t.deathTime,t.propagationTimeFactor),t.beginVanishingTime=a.MathUtils.lerp(t.deathTime,t.birthTime,1-t.vanishingTimeFactor);const n=this.randomGenerator.random;t.linPos0.set(n(),n(),n()).multiplyScalar(1e3),t.linPos1.set(n(),n(),n()).multiplyScalar(1e3),this.timeFraction=(e-t.birthTime)/(t.deathTime-t.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0;const i=this.getNewSegment();i.iteration=0,i.pos0.copy(t.pos0),i.pos1.copy(t.pos1),i.linPos0.copy(t.linPos0),i.linPos1.copy(t.linPos1),i.up0.copy(t.up0),i.up1.copy(t.up1),i.radius0=t.radius0,i.radius1=t.radius1,i.fraction0=0,i.fraction1=1,i.positionVariationFactor=1-t.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,t.recursion)/(1<<t.maxIterations),this.fractalRayRecursive(i)}this.currentSegmentCallback=null,this.currentSubray=null}fractalRayRecursive(e){if(e.iteration>=this.currentSubray.maxIterations)return void this.currentSegmentCallback(e);this.forwards.subVectors(e.pos1,e.pos0);let t=this.forwards.length();t<1e-6&&(this.forwards.set(0,0,.01),t=this.forwards.length());const r=.5*(e.radius0+e.radius1),n=.5*(e.fraction0+e.fraction1),i=this.time*this.currentSubray.timeScale*Math.pow(2,e.iteration);this.middlePos.lerpVectors(e.pos0,e.pos1,.5),this.middleLinPos.lerpVectors(e.linPos0,e.linPos1,.5);const o=this.middleLinPos;this.newPos.set(this.simplexX.noise4d(o.x,o.y,o.z,i),this.simplexY.noise4d(o.x,o.y,o.z,i),this.simplexZ.noise4d(o.x,o.y,o.z,i)),this.newPos.multiplyScalar(e.positionVariationFactor*t),this.newPos.add(this.middlePos);const a=this.getNewSegment();a.pos0.copy(e.pos0),a.pos1.copy(this.newPos),a.linPos0.copy(e.linPos0),a.linPos1.copy(this.middleLinPos),a.up0.copy(e.up0),a.up1.copy(e.up1),a.radius0=e.radius0,a.radius1=r,a.fraction0=e.fraction0,a.fraction1=n,a.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,a.iteration=e.iteration+1;const s=this.getNewSegment();s.pos0.copy(this.newPos),s.pos1.copy(e.pos1),s.linPos0.copy(this.middleLinPos),s.linPos1.copy(e.linPos1),this.cross1.crossVectors(e.up0,this.forwards.normalize()),s.up0.crossVectors(this.forwards,this.cross1).normalize(),s.up1.copy(e.up1),s.radius0=r,s.radius1=e.radius1,s.fraction0=n,s.fraction1=e.fraction1,s.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,s.iteration=e.iteration+1,this.fractalRayRecursive(a),this.fractalRayRecursive(s)}createPrism(e){this.forwardsFill.subVectors(e.pos1,e.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(e.pos0,e.up0,this.forwardsFill,e.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(e.pos1,e.up0,this.forwardsFill,e.radius1,e.fraction1),this.createPrismFaces()}createTriangleVerticesWithoutUVs(e,t,r,n){this.side.crossVectors(t,r).multiplyScalar(n*On.COS30DEG),this.down.copy(t).multiplyScalar(-n*On.SIN30DEG);const i=this.vPos,o=this.vertices;i.copy(e).sub(this.side).add(this.down),o[this.currentCoordinate++]=i.x,o[this.currentCoordinate++]=i.y,o[this.currentCoordinate++]=i.z,i.copy(e).add(this.side).add(this.down),o[this.currentCoordinate++]=i.x,o[this.currentCoordinate++]=i.y,o[this.currentCoordinate++]=i.z,i.copy(t).multiplyScalar(n).add(e),o[this.currentCoordinate++]=i.x,o[this.currentCoordinate++]=i.y,o[this.currentCoordinate++]=i.z,this.currentVertex+=3}createTriangleVerticesWithUVs(e,t,r,n,i){this.side.crossVectors(t,r).multiplyScalar(n*On.COS30DEG),this.down.copy(t).multiplyScalar(-n*On.SIN30DEG);const o=this.vPos,a=this.vertices,s=this.uvs;o.copy(e).sub(this.side).add(this.down),a[this.currentCoordinate++]=o.x,a[this.currentCoordinate++]=o.y,a[this.currentCoordinate++]=o.z,s[this.currentUVCoordinate++]=i,s[this.currentUVCoordinate++]=0,o.copy(e).add(this.side).add(this.down),a[this.currentCoordinate++]=o.x,a[this.currentCoordinate++]=o.y,a[this.currentCoordinate++]=o.z,s[this.currentUVCoordinate++]=i,s[this.currentUVCoordinate++]=.5,o.copy(t).multiplyScalar(n).add(e),a[this.currentCoordinate++]=o.x,a[this.currentCoordinate++]=o.y,a[this.currentCoordinate++]=o.z,s[this.currentUVCoordinate++]=i,s[this.currentUVCoordinate++]=1,this.currentVertex+=3}createPrismFaces(e){const t=this.indices;e=this.currentVertex-6;t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+5,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+5,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+5}createDefaultSubrayCreationCallbacks(){const e=this.randomGenerator.random;this.onDecideSubrayCreation=(t,r)=>{const n=r.currentSubray,i=r.rayParameters.subrayPeriod,o=r.rayParameters.subrayDutyCycle,s=r.rayParameters.isEternal&&0==n.recursion?-e()*i:a.MathUtils.lerp(n.birthTime,n.endPropagationTime,t.fraction0)-e()*i,l=r.time-s,c=Math.floor(l/i),u=e()*(c+1);let h=0;if(l%i<=o*i&&(h=r.subrayProbability),n.recursion<r.maxSubrayRecursion&&r.numSubrays<r.maxSubrays&&e()<h){const a=r.addNewSubray(),l=r.randomGenerator.getSeed();a.seed=u,r.randomGenerator.setSeed(u),a.recursion=n.recursion+1,a.maxIterations=Math.max(1,n.maxIterations-1),a.linPos0.set(e(),e(),e()).multiplyScalar(1e3),a.linPos1.set(e(),e(),e()).multiplyScalar(1e3),a.up0.copy(n.up0),a.up1.copy(n.up1),a.radius0=t.radius0*r.rayParameters.radius0Factor,a.radius1=Math.min(r.rayParameters.minRadius,t.radius1*r.rayParameters.radius1Factor),a.birthTime=s+c*i,a.deathTime=a.birthTime+i*o,r.rayParameters.isEternal||0!=n.recursion||(a.birthTime=Math.max(a.birthTime,n.birthTime),a.deathTime=Math.min(a.deathTime,n.deathTime)),a.timeScale=2*n.timeScale,a.roughness=n.roughness,a.straightness=n.straightness,a.propagationTimeFactor=n.propagationTimeFactor,a.vanishingTimeFactor=n.vanishingTimeFactor,r.onSubrayCreation(t,n,a,r),r.randomGenerator.setSeed(l)}};const t=new a.Vector3,r=new a.Vector3,n=new a.Vector3,i=new a.Vector3;this.onSubrayCreation=(e,t,r,n)=>{n.subrayCylinderPosition(e,t,r,.5,.6,.2)},this.subrayConePosition=(o,a,s,l,c,u)=>{s.pos0.copy(o.pos0),t.subVectors(a.pos1,a.pos0),r.copy(t).normalize(),t.multiplyScalar(o.fraction0+(1-o.fraction0)*(e()*l));const h=t.length();n.crossVectors(a.up0,r);const d=2*Math.PI*e();n.multiplyScalar(Math.cos(d)),i.copy(a.up0).multiplyScalar(Math.sin(d)),s.pos1.copy(n).add(i).multiplyScalar(h*c*(u+e()*(1-u))).add(t).add(a.pos0)},this.subrayCylinderPosition=(o,a,s,l,c,u)=>{s.pos0.copy(o.pos0),t.subVectors(a.pos1,a.pos0),r.copy(t).normalize(),t.multiplyScalar(o.fraction0+(1-o.fraction0)*((2*e()-1)*l));const h=t.length();n.crossVectors(a.up0,r);const d=2*Math.PI*e();n.multiplyScalar(Math.cos(d)),i.copy(a.up0).multiplyScalar(Math.sin(d)),s.pos1.copy(n).add(i).multiplyScalar(h*c*(u+e()*(1-u))).add(t).add(a.pos0)}}createSubray(){return{seed:0,maxIterations:0,recursion:0,pos0:new a.Vector3,pos1:new a.Vector3,linPos0:new a.Vector3,linPos1:new a.Vector3,up0:new a.Vector3,up1:new a.Vector3,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}}createSegment(){return{iteration:0,pos0:new a.Vector3,pos1:new a.Vector3,linPos0:new a.Vector3,linPos1:new a.Vector3,up0:new a.Vector3,up1:new a.Vector3,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}}getNewSegment(){return this.raySegments[this.currentSegmentIndex++]}copy(e){return super.copy(e),this.init(On.copyParameters({},e.rayParameters)),this}clone(){return new this.constructor(On.copyParameters({},this.rayParameters))}}On.prototype.isLightningStrike=!0,On.RAY_INITIALIZED=0,On.RAY_UNBORN=1,On.RAY_PROPAGATING=2,On.RAY_STEADY=3,On.RAY_VANISHING=4,On.RAY_EXTINGUISHED=5,On.COS30DEG=Math.cos(30*Math.PI/180),On.SIN30DEG=Math.sin(30*Math.PI/180),On.createRandomGenerator=()=>{const e=2053,t=[];for(let n=0;n<e;n++)t.push(Math.random());const r={currentSeed:0,random:function(){const n=t[r.currentSeed];return r.currentSeed=(r.currentSeed+1)%e,n},getSeed:function(){return r.currentSeed/e},setSeed:function(t){r.currentSeed=Math.floor(t*e)%e}};return r},On.copyParameters=(e,t)=>{t=t||{};const r=r=>t===e?r:r.clone();return(e=e||{}).sourceOffset=void 0!==t.sourceOffset?r(t.sourceOffset):new a.Vector3(0,100,0),e.destOffset=void 0!==t.destOffset?r(t.destOffset):new a.Vector3(0,0,0),e.timeScale=void 0!==t.timeScale?t.timeScale:1,e.roughness=void 0!==t.roughness?t.roughness:.9,e.straightness=void 0!==t.straightness?t.straightness:.7,e.up0=void 0!==t.up0?r(t.up0):new a.Vector3(0,0,1),e.up1=void 0!==t.up1?r(t.up1):new a.Vector3(0,0,1),e.radius0=void 0!==t.radius0?t.radius0:1,e.radius1=void 0!==t.radius1?t.radius1:1,e.radius0Factor=void 0!==t.radius0Factor?t.radius0Factor:.5,e.radius1Factor=void 0!==t.radius1Factor?t.radius1Factor:.2,e.minRadius=void 0!==t.minRadius?t.minRadius:.2,e.isEternal=void 0!==t.isEternal?t.isEternal:void 0===t.birthTime||void 0===t.deathTime,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.propagationTimeFactor=void 0!==t.propagationTimeFactor?t.propagationTimeFactor:.1,e.vanishingTimeFactor=void 0!==t.vanishingTimeFactor?t.vanishingTimeFactor:.9,e.subrayPeriod=void 0!==t.subrayPeriod?t.subrayPeriod:4,e.subrayDutyCycle=void 0!==t.subrayDutyCycle?t.subrayDutyCycle:.6,e.maxIterations=void 0!==t.maxIterations?t.maxIterations:9,e.isStatic=void 0!==t.isStatic&&t.isStatic,e.ramification=void 0!==t.ramification?t.ramification:5,e.maxSubrayRecursion=void 0!==t.maxSubrayRecursion?t.maxSubrayRecursion:3,e.recursionProbability=void 0!==t.recursionProbability?t.recursionProbability:.6,e.generateUVs=void 0!==t.generateUVs&&t.generateUVs,e.randomGenerator=t.randomGenerator,e.noiseSeed=t.noiseSeed,e.onDecideSubrayCreation=t.onDecideSubrayCreation,e.onSubrayCreation=t.onSubrayCreation,e};class Un extends a.Object3D{constructor(e={}){super(),this.stormParams=e,e.size=void 0!==e.size?e.size:1e3,e.minHeight=void 0!==e.minHeight?e.minHeight:80,e.maxHeight=void 0!==e.maxHeight?e.maxHeight:100,e.maxSlope=void 0!==e.maxSlope?e.maxSlope:1.1,e.maxLightnings=void 0!==e.maxLightnings?e.maxLightnings:3,e.lightningMinPeriod=void 0!==e.lightningMinPeriod?e.lightningMinPeriod:3,e.lightningMaxPeriod=void 0!==e.lightningMaxPeriod?e.lightningMaxPeriod:7,e.lightningMinDuration=void 0!==e.lightningMinDuration?e.lightningMinDuration:1,e.lightningMaxDuration=void 0!==e.lightningMaxDuration?e.lightningMaxDuration:2.5,this.lightningParameters=On.copyParameters(e.lightningParameters,e.lightningParameters),this.lightningParameters.isEternal=!1,this.lightningMaterial=void 0!==e.lightningMaterial?e.lightningMaterial:new a.MeshBasicMaterial({color:11599871}),void 0!==e.onRayPosition?this.onRayPosition=e.onRayPosition:this.onRayPosition=function(t,r){r.set((Math.random()-.5)*e.size,0,(Math.random()-.5)*e.size);const n=a.MathUtils.lerp(e.minHeight,e.maxHeight,Math.random());t.set(e.maxSlope*(2*Math.random()-1),1,e.maxSlope*(2*Math.random()-1)).multiplyScalar(n).add(r)},this.onLightningDown=e.onLightningDown,this.inited=!1,this.nextLightningTime=0,this.lightningsMeshes=[],this.deadLightningsMeshes=[];for(let t=0;t<this.stormParams.maxLightnings;t++){const e=new On(On.copyParameters({},this.lightningParameters)),t=new a.Mesh(e,this.lightningMaterial);this.deadLightningsMeshes.push(t)}}update(e){if(this.inited||(this.nextLightningTime=this.getNextLightningTime(e)*Math.random(),this.inited=!0),e>=this.nextLightningTime){const t=this.deadLightningsMeshes.pop();if(t){const r=On.copyParameters(t.geometry.rayParameters,this.lightningParameters);r.birthTime=e,r.deathTime=e+a.MathUtils.lerp(this.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration,Math.random()),this.onRayPosition(r.sourceOffset,r.destOffset),r.noiseSeed=Math.random(),this.add(t),this.lightningsMeshes.push(t)}this.nextLightningTime=this.getNextLightningTime(e)}let t=0,r=this.lightningsMeshes.length;for(;t<r;){const n=this.lightningsMeshes[t],i=n.geometry,o=i.state;i.update(e),o===On.RAY_PROPAGATING&&i.state>o&&this.onLightningDown&&this.onLightningDown(i),i.state===On.RAY_EXTINGUISHED?(this.lightningsMeshes.splice(this.lightningsMeshes.indexOf(n),1),this.deadLightningsMeshes.push(n),this.remove(n),r--):t++}}getNextLightningTime(e){return e+a.MathUtils.lerp(this.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod,Math.random())/(this.stormParams.maxLightnings+1)}copy(e){return super.copy(e),this.stormParams.size=e.stormParams.size,this.stormParams.minHeight=e.stormParams.minHeight,this.stormParams.maxHeight=e.stormParams.maxHeight,this.stormParams.maxSlope=e.stormParams.maxSlope,this.stormParams.maxLightnings=e.stormParams.maxLightnings,this.stormParams.lightningMinPeriod=e.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod=e.stormParams.lightningMaxPeriod,this.stormParams.lightningMinDuration=e.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration=e.stormParams.lightningMaxDuration,this.lightningParameters=On.copyParameters({},e.lightningParameters),this.lightningMaterial=e.stormParams.lightningMaterial,this.onLightningDown=e.onLightningDown,this}clone(){return new this.constructor(this.stormParams).copy(this)}}Un.prototype.isLightningStorm=!0;class Qn extends Mn{constructor(e,t){super(e,t),this.geometry.setDrawRange(0,0)}}class Vn extends a.Mesh{constructor(e,t={}){super(e),this.type="ReflectorForSSRPass";const r=this,n=void 0!==t.color?new a.Color(t.color):new a.Color(8355711),i=t.textureWidth||512,o=t.textureHeight||512,s=t.clipBias||0,l=t.shader||Vn.ReflectorShader,c=!0===t.useDepthTexture,u=new a.Vector3(0,1,0),h=new a.Vector3,d=new a.Vector3;r.needsUpdate=!1,r.maxDistance=Vn.ReflectorShader.uniforms.maxDistance.value,r.opacity=Vn.ReflectorShader.uniforms.opacity.value,r.color=n,r.resolution=t.resolution||new a.Vector2(window.innerWidth,window.innerHeight),r._distanceAttenuation=Vn.ReflectorShader.defines.DISTANCE_ATTENUATION,Object.defineProperty(r,"distanceAttenuation",{get:()=>r._distanceAttenuation,set(e){r._distanceAttenuation!==e&&(r._distanceAttenuation=e,r.material.defines.DISTANCE_ATTENUATION=e,r.material.needsUpdate=!0)}}),r._fresnel=Vn.ReflectorShader.defines.FRESNEL,Object.defineProperty(r,"fresnel",{get:()=>r._fresnel,set(e){r._fresnel!==e&&(r._fresnel=e,r.material.defines.FRESNEL=e,r.material.needsUpdate=!0)}});const f=new a.Vector3,p=new a.Vector3,m=new a.Vector3,g=new a.Matrix4,A=new a.Vector3(0,0,-1),v=new a.Vector3,y=new a.Vector3,x=new a.Matrix4,b=new a.PerspectiveCamera;let w;c&&(w=new a.DepthTexture,w.type=a.UnsignedShortType,w.minFilter=a.NearestFilter,w.magFilter=a.NearestFilter);const C={depthTexture:c?w:null},E=new a.WebGLRenderTarget(i,o,C),S=new a.ShaderMaterial({transparent:c,defines:Object.assign({},Vn.ReflectorShader.defines,{useDepthTexture:c}),uniforms:a.UniformsUtils.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});S.uniforms.tDiffuse.value=E.texture,S.uniforms.color.value=r.color,S.uniforms.textureMatrix.value=x,c&&(S.uniforms.tDepth.value=E.depthTexture),this.material=S;const T=[new a.Plane(new a.Vector3(0,1,0),s)];this.doRender=function(e,t,n){if(S.uniforms.maxDistance.value=r.maxDistance,S.uniforms.color.value=r.color,S.uniforms.opacity.value=r.opacity,h.copy(n.position).normalize(),d.copy(h).reflect(u),S.uniforms.fresnelCoe.value=(h.dot(d)+1)/2,p.setFromMatrixPosition(r.matrixWorld),m.setFromMatrixPosition(n.matrixWorld),g.extractRotation(r.matrixWorld),f.set(0,0,1),f.applyMatrix4(g),v.subVectors(p,m),v.dot(f)>0)return;v.reflect(f).negate(),v.add(p),g.extractRotation(n.matrixWorld),A.set(0,0,-1),A.applyMatrix4(g),A.add(m),y.subVectors(p,A),y.reflect(f).negate(),y.add(p),b.position.copy(v),b.up.set(0,1,0),b.up.applyMatrix4(g),b.up.reflect(f),b.lookAt(y),b.far=n.far,b.updateMatrixWorld(),b.projectionMatrix.copy(n.projectionMatrix),S.uniforms.virtualCameraNear.value=n.near,S.uniforms.virtualCameraFar.value=n.far,S.uniforms.virtualCameraMatrixWorld.value=b.matrixWorld,S.uniforms.virtualCameraProjectionMatrix.value=n.projectionMatrix,S.uniforms.virtualCameraProjectionMatrixInverse.value=n.projectionMatrixInverse,S.uniforms.resolution.value=r.resolution,x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(b.projectionMatrix),x.multiply(b.matrixWorldInverse),x.multiply(r.matrixWorld),E.texture.encoding=e.outputEncoding;const i=e.getRenderTarget(),o=e.xr.enabled,a=e.shadowMap.autoUpdate,s=e.clippingPlanes;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.clippingPlanes=T,e.setRenderTarget(E),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,b),e.xr.enabled=o,e.shadowMap.autoUpdate=a,e.clippingPlanes=s,e.setRenderTarget(i);const l=n.viewport;void 0!==l&&e.state.viewport(l)},this.getRenderTarget=function(){return E}}}Vn.prototype.isReflectorForSSRPass=!0,Vn.ReflectorShader={defines:{DISTANCE_ATTENUATION:!0,FRESNEL:!0},uniforms:{color:{value:null},tDiffuse:{value:null},tDepth:{value:null},textureMatrix:{value:new a.Matrix4},maxDistance:{value:180},opacity:{value:.5},fresnelCoe:{value:null},virtualCameraNear:{value:null},virtualCameraFar:{value:null},virtualCameraProjectionMatrix:{value:new a.Matrix4},virtualCameraMatrixWorld:{value:new a.Matrix4},virtualCameraProjectionMatrixInverse:{value:new a.Matrix4},resolution:{value:new a.Vector2}},vertexShader:"\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDepth;\n\t\tuniform float maxDistance;\n\t\tuniform float opacity;\n\t\tuniform float fresnelCoe;\n\t\tuniform float virtualCameraNear;\n\t\tuniform float virtualCameraFar;\n\t\tuniform mat4 virtualCameraProjectionMatrix;\n\t\tuniform mat4 virtualCameraProjectionMatrixInverse;\n\t\tuniform mat4 virtualCameraMatrixWorld;\n\t\tuniform vec2 resolution;\n\t\tvarying vec4 vUv;\n\t\t#include <packing>\n\t\tfloat blendOverlay( float base, float blend ) {\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\t\t}\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\t\t}\n\t\tfloat getDepth( const in vec2 uv ) {\n\t\t\treturn texture2D( tDepth, uv ).x;\n\t\t}\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\treturn perspectiveDepthToViewZ( depth, virtualCameraNear, virtualCameraFar );\n\t\t}\n\t\tvec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {\n\t\t\tvec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc\n\t\t\tclipPosition *= clipW; //clip\n\t\t\treturn ( virtualCameraProjectionMatrixInverse * clipPosition ).xyz;//view\n\t\t}\n\t\tvoid main() {\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\t#ifdef useDepthTexture\n\t\t\t\tvec2 uv=(gl_FragCoord.xy-.5)/resolution.xy;\n\t\t\t\tuv.x=1.-uv.x;\n\t\t\t\tfloat depth = texture2DProj( tDepth, vUv ).r;\n\t\t\t\tfloat viewZ = getViewZ( depth );\n\t\t\t\tfloat clipW = virtualCameraProjectionMatrix[2][3] * viewZ+virtualCameraProjectionMatrix[3][3];\n\t\t\t\tvec3 viewPosition=getViewPosition( uv, depth, clipW );\n\t\t\t\tvec3 worldPosition=(virtualCameraMatrixWorld*vec4(viewPosition,1)).xyz;\n\t\t\t\tif(worldPosition.y>maxDistance) discard;\n\t\t\t\tfloat op=opacity;\n\t\t\t\t#ifdef DISTANCE_ATTENUATION\n\t\t\t\t\tfloat ratio=1.-(worldPosition.y/maxDistance);\n\t\t\t\t\tfloat attenuation=ratio*ratio;\n\t\t\t\t\top=opacity*attenuation;\n\t\t\t\t#endif\n\t\t\t\t#ifdef FRESNEL\n\t\t\t\t\top*=fresnelCoe;\n\t\t\t\t#endif\n\t\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), op );\n\t\t\t#else\n\t\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\t\t\t#endif\n\t\t}\n\t"};var Gn=r(4921);class zn extends a.Mesh{constructor(e,t={}){super(e),this.type="Water";const r=this,n=void 0!==t.color?new a.Color(t.color):new a.Color(16777215),i=t.textureWidth||512,o=t.textureHeight||512,s=t.clipBias||0,l=t.flowDirection||new a.Vector2(1,0),c=t.flowSpeed||.03,u=t.reflectivity||.02,h=t.scale||1,d=t.shader||Water.WaterShader,f=void 0!==t.encoding?t.encoding:a.LinearEncoding,p=new a.TextureLoader,m=t.flowMap||void 0,g=t.normalMap0||p.load("textures/water/Water_1_M_Normal.jpg"),A=t.normalMap1||p.load("textures/water/Water_2_M_Normal.jpg"),v=.15,y=.075,x=new a.Matrix4,b=new a.Clock;if(void 0===Mn)return void console.error("THREE.Water: Required component Reflector not found.");if(void 0===In)return void console.error("THREE.Water: Required component Refractor not found.");const w=new Mn(e,{textureWidth:i,textureHeight:o,clipBias:s,encoding:f}),C=new In(e,{textureWidth:i,textureHeight:o,clipBias:s,encoding:f});w.matrixAutoUpdate=!1,C.matrixAutoUpdate=!1,this.material=new a.ShaderMaterial({uniforms:a.UniformsUtils.merge([a.UniformsLib.fog,d.uniforms]),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,transparent:!0,fog:!0}),void 0!==m?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:m}):this.material.uniforms.flowDirection={type:"v2",value:l},g.wrapS=g.wrapT=a.RepeatWrapping,A.wrapS=A.wrapT=a.RepeatWrapping,this.material.uniforms.tReflectionMap.value=w.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=C.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=g,this.material.uniforms.tNormalMap1.value=A,this.material.uniforms.color.value=n,this.material.uniforms.reflectivity.value=u,this.material.uniforms.textureMatrix.value=x,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=y,this.material.uniforms.config.value.z=y,this.material.uniforms.config.value.w=h,this.onBeforeRender=function(e,t,n){!function(e){x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(e.projectionMatrix),x.multiply(e.matrixWorldInverse),x.multiply(r.matrixWorld)}(n),function(){const e=b.getDelta(),t=r.material.uniforms.config;t.value.x+=c*e,t.value.y=t.value.x+y,t.value.x>=v?(t.value.x=0,t.value.y=y):t.value.y>=v&&(t.value.y=t.value.y-v)}(),r.visible=!1,w.matrixWorld.copy(r.matrixWorld),C.matrixWorld.copy(r.matrixWorld),w.onBeforeRender(e,t,n),C.onBeforeRender(e,t,n),r.visible=!0}}}zn.prototype.isWater=!0,zn.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new a.Vector4}},vertexShader:"\n\n\t\t#include <common>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tvCoord = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\tvToEye = cameraPosition - worldPosition.xyz;\n\n\t\t\tvec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tuniform sampler2D tReflectionMap;\n\t\tuniform sampler2D tRefractionMap;\n\t\tuniform sampler2D tNormalMap0;\n\t\tuniform sampler2D tNormalMap1;\n\n\t\t#ifdef USE_FLOWMAP\n\t\t\tuniform sampler2D tFlowMap;\n\t\t#else\n\t\t\tuniform vec2 flowDirection;\n\t\t#endif\n\n\t\tuniform vec3 color;\n\t\tuniform float reflectivity;\n\t\tuniform vec4 config;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tfloat flowMapOffset0 = config.x;\n\t\t\tfloat flowMapOffset1 = config.y;\n\t\t\tfloat halfCycle = config.z;\n\t\t\tfloat scale = config.w;\n\n\t\t\tvec3 toEye = normalize( vToEye );\n\n\t\t\t// determine flow direction\n\t\t\tvec2 flow;\n\t\t\t#ifdef USE_FLOWMAP\n\t\t\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\n\t\t\t#else\n\t\t\t\tflow = flowDirection;\n\t\t\t#endif\n\t\t\tflow.x *= - 1.0;\n\n\t\t\t// sample normal maps (distort uvs with flowdata)\n\t\t\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n\t\t\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n\n\t\t\t// linear interpolate to get the final normal color\n\t\t\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n\t\t\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n\t\t\t// calculate normal vector\n\t\t\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n\n\t\t\t// calculate the fresnel term to blend reflection and refraction maps\n\t\t\tfloat theta = max( dot( toEye, normal ), 0.0 );\n\t\t\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n\n\t\t\t// calculate final uv coords\n\t\t\tvec3 coord = vCoord.xyz / vCoord.w;\n\t\t\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;\n\n\t\t\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\n\t\t\tvec4 refractColor = texture2D( tRefractionMap, uv );\n\n\t\t\t// multiply water color with the mix of both textures\n\t\t\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}"};var jn={createMeshesFromInstancedMesh:function(e){var t=new a.Group,r=e.count,n=e.geometry,i=e.material;for(let s=0;s<r;s++){var o=new a.Mesh(n,i);e.getMatrixAt(s,o.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),t.add(o)}return t.copy(e),t.updateMatrixWorld(),t},createMultiMaterialObject:function(e,t){var r=new a.Group;for(let n=0,i=t.length;n<i;n++)r.add(new a.Mesh(e,t[n]));return r},detach:function(e,t,r){console.warn("THREE.SceneUtils: detach() has been deprecated. Use scene.attach( child ) instead."),r.attach(e)},attach:function(e,t,r){console.warn("THREE.SceneUtils: attach() has been deprecated. Use parent.attach( child ) instead."),r.attach(e)}},Hn=function(e,t){var r=new a.Vector2,n=new a.Vector2,i=[new a.Vector2,new a.Vector2,new a.Vector2],o=[],s=document.createElement("canvas"),l=t||1024,c=t||1024;s.width=l,s.height=c;var u=s.getContext("2d");if(u.lineWidth=1,u.strokeStyle="rgb( 63, 63, 63 )",u.textAlign="center",u.fillStyle="rgb( 255, 255, 255 )",u.fillRect(0,0,l,c),!e.isGeometry){var h=e.index,d=e.attributes.uv;if(h)for(let e=0,t=h.count;e<t;e+=3)o[0]=h.getX(e),o[1]=h.getX(e+1),o[2]=h.getX(e+2),i[0].fromBufferAttribute(d,o[0]),i[1].fromBufferAttribute(d,o[1]),i[2].fromBufferAttribute(d,o[2]),f(o,i,e/3);else for(let e=0,t=d.count;e<t;e+=3)o[0]=e,o[1]=e+1,o[2]=e+2,i[0].fromBufferAttribute(d,o[0]),i[1].fromBufferAttribute(d,o[1]),i[2].fromBufferAttribute(d,o[2]),f(o,i,e/3);return s}function f(e,t,i){u.beginPath(),r.set(0,0);for(let n=0,s=t.length;n<s;n++){var o=t[n];r.x+=o.x,r.y+=o.y,0===n?u.moveTo(o.x*(l-2)+.5,(1-o.y)*(c-2)+.5):u.lineTo(o.x*(l-2)+.5,(1-o.y)*(c-2)+.5)}for(u.closePath(),u.stroke(),r.divideScalar(t.length),u.font="18px Arial",u.fillStyle="rgb( 63, 63, 63 )",u.fillText(i,r.x*l,(1-r.y)*c),r.x>.95&&u.fillText(i,r.x%1*l,(1-r.y)*c),u.font="12px Arial",u.fillStyle="rgb( 191, 191, 191 )",j=0,jl=t.length;j<jl;j++){o=t[j];n.addVectors(r,o).divideScalar(2);var a=e[j];u.fillText("abc"[j]+a,n.x*l,(1-n.y)*c),n.x>.95&&u.fillText("abc"[j]+a,n.x%1*l,(1-n.y)*c)}}console.error("THREE.UVsDebug no longer supports Geometry. Use THREE.BufferGeometry instead.")};const Wn=(e,t,r,n,i,o,s)=>{e=void 0!==e?e:new a.Vector3(0,0,0);var l=(t=void 0!==t?t:10)/2,c=(r=void 0!==r?r:1,n=void 0!==n?n:0,i=void 0!==i?i:1,o=void 0!==o?o:2,s=void 0!==s?s:3,[new a.Vector3(e.x-l,e.y,e.z-l),new a.Vector3(e.x-l,e.y,e.z+l),new a.Vector3(e.x+l,e.y,e.z+l),new a.Vector3(e.x+l,e.y,e.z-l)]),u=[c[n],c[i],c[o],c[s]];if(0<=--r){var h=[];return Array.prototype.push.apply(h,Wn(u[0],l,r,n,s,o,i)),Array.prototype.push.apply(h,Wn(u[1],l,r,n,i,o,s)),Array.prototype.push.apply(h,Wn(u[2],l,r,n,i,o,s)),Array.prototype.push.apply(h,Wn(u[3],l,r,o,i,n,s)),h}return u},Zn=(e,t,r,n,i,o,s,l,c,u,h)=>{e=void 0!==e?e:new a.Vector3(0,0,0);var d=(t=void 0!==t?t:10)/2,f=(r=void 0!==r?r:1,n=void 0!==n?n:0,i=void 0!==i?i:1,o=void 0!==o?o:2,s=void 0!==s?s:3,l=void 0!==l?l:4,c=void 0!==c?c:5,u=void 0!==u?u:6,h=void 0!==h?h:7,[new a.Vector3(e.x-d,e.y+d,e.z-d),new a.Vector3(e.x-d,e.y+d,e.z+d),new a.Vector3(e.x-d,e.y-d,e.z+d),new a.Vector3(e.x-d,e.y-d,e.z-d),new a.Vector3(e.x+d,e.y-d,e.z-d),new a.Vector3(e.x+d,e.y-d,e.z+d),new a.Vector3(e.x+d,e.y+d,e.z+d),new a.Vector3(e.x+d,e.y+d,e.z-d)]),p=[f[n],f[i],f[o],f[s],f[l],f[c],f[u],f[h]];if(--r>=0){var m=[];return Array.prototype.push.apply(m,Zn(p[0],d,r,n,s,l,h,u,c,o,i)),Array.prototype.push.apply(m,Zn(p[1],d,r,n,h,u,i,o,c,l,s)),Array.prototype.push.apply(m,Zn(p[2],d,r,n,h,u,i,o,c,l,s)),Array.prototype.push.apply(m,Zn(p[3],d,r,o,s,n,i,u,h,l,c)),Array.prototype.push.apply(m,Zn(p[4],d,r,o,s,n,i,u,h,l,c)),Array.prototype.push.apply(m,Zn(p[5],d,r,l,s,o,c,u,i,n,h)),Array.prototype.push.apply(m,Zn(p[6],d,r,l,s,o,c,u,i,n,h)),Array.prototype.push.apply(m,Zn(p[7],d,r,u,c,o,i,n,s,l,h)),m}return p},Xn=e=>(e=void 0!==e?e:1,function(e){var t=0,r=0,n=0,i=[0,0,0],o=e.fractal;for(let s=0,l=o.length;s<l;s++){var a=o[s];"+"===a?n+=e.angle:"-"===a?n-=e.angle:"F"===a&&(t+=e.size*Math.cos(n),r+=-e.size*Math.sin(n),i.push(t,r,0))}return i}({fractal:function(e){var t,r=e.axiom;for(let i=0,o=e.steps;0<=o?i<o:i>o;0<=o?i++:i--){t="";for(let i=0,o=r.length;i<o;i++){var n=r[i];n in e.rules?t+=e.rules[n]:t+=n}r=t}return t}({axiom:"A",steps:4,rules:{A:"A+BF++BF-FA--FAFA-BF+",B:"-FA+BFBF++BF+FA--FA-B"}}),size:e,angle:Math.PI/3}));var Yn=function(){var e=new a.RawShaderMaterial({uniforms:{roughnessMap:{value:null},normalMap:{value:null},texelSize:{value:new a.Vector2(1,1)}},vertexShader:"\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tattribute vec3 position;\n\t\t\tattribute vec2 uv;\n\n\t\t\tvarying vec2 vUv;\n\n\t\t\tvoid main() {\n\n\t\t\t\tvUv = uv;\n\n\t\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t\t}\n\t\t",fragmentShader:"\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec2 vUv;\n\n\t\t\tuniform sampler2D roughnessMap;\n\t\t\tuniform sampler2D normalMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\n\t\t\tvec4 envMapTexelToLinear( vec4 a ) { return a; }\n\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tfloat roughnessToVariance( float roughness ) {\n\n\t\t\t\tfloat variance = 0.0;\n\n\t\t\t\tif ( roughness >= r1 ) {\n\n\t\t\t\t\tvariance = ( r0 - roughness ) * ( v1 - v0 ) / ( r0 - r1 ) + v0;\n\n\t\t\t\t} else if ( roughness >= r4 ) {\n\n\t\t\t\t\tvariance = ( r1 - roughness ) * ( v4 - v1 ) / ( r1 - r4 ) + v1;\n\n\t\t\t\t} else if ( roughness >= r5 ) {\n\n\t\t\t\t\tvariance = ( r4 - roughness ) * ( v5 - v4 ) / ( r4 - r5 ) + v4;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tfloat roughness2 = roughness * roughness;\n\n\t\t\t\t\tvariance = 1.79 * roughness2 * roughness2;\n\n\t\t\t\t}\n\n\t\t\t\treturn variance;\n\n\t\t\t}\n\n\t\t\tfloat varianceToRoughness( float variance ) {\n\n\t\t\t\tfloat roughness = 0.0;\n\n\t\t\t\tif ( variance >= v1 ) {\n\n\t\t\t\t\troughness = ( v0 - variance ) * ( r1 - r0 ) / ( v0 - v1 ) + r0;\n\n\t\t\t\t} else if ( variance >= v4 ) {\n\n\t\t\t\t\troughness = ( v1 - variance ) * ( r4 - r1 ) / ( v1 - v4 ) + r1;\n\n\t\t\t\t} else if ( variance >= v5 ) {\n\n\t\t\t\t\troughness = ( v4 - variance ) * ( r5 - r4 ) / ( v4 - v5 ) + r4;\n\n\t\t\t\t} else {\n\n\t\t\t\t\troughness = pow( 0.559 * variance, 0.25 ); // 0.559 = 1.0 / 1.79\n\n\t\t\t\t}\n\n\t\t\t\treturn roughness;\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = texture2D( roughnessMap, vUv, - 1.0 );\n\n\t\t\t\tif ( texelSize.x == 0.0 ) return;\n\n\t\t\t\tfloat roughness = gl_FragColor.g;\n\n\t\t\t\tfloat variance = roughnessToVariance( roughness );\n\n\t\t\t\tvec3 avgNormal;\n\n\t\t\t\tfor ( float x = - 1.0; x < 2.0; x += 2.0 ) {\n\n\t\t\t\t\tfor ( float y = - 1.0; y < 2.0; y += 2.0 ) {\n\n\t\t\t\t\t\tvec2 uv = vUv + vec2( x, y ) * 0.25 * texelSize;\n\n\t\t\t\t\t\tavgNormal += normalize( texture2D( normalMap, uv, - 1.0 ).xyz - 0.5 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tvariance += 1.0 - 0.25 * length( avgNormal );\n\n\t\t\t\tgl_FragColor.g = varianceToRoughness( variance );\n\n\t\t\t}\n\t\t",blending:a.NoBlending,depthTest:!1,depthWrite:!1});return e.type="RoughnessMipmapper",e}(),Jn=new a.Mesh(new a.PlaneGeometry(2,2),Yn),qn=new a.OrthographicCamera(0,1,0,1,0,1),Kn=null,$n=null;function ei(e){($n=e).compile(Jn,qn)}ei.prototype={constructor:ei,generateMipmaps:function(e){if("roughnessMap"in e!==!1){var{roughnessMap:t,normalMap:r}=e;if(null!==t&&null!==r&&t.generateMipmaps&&!e.userData.roughnessUpdated){e.userData.roughnessUpdated=!0;var n=Math.max(t.image.width,r.image.width),i=Math.max(t.image.height,r.image.height);if(a.MathUtils.isPowerOfTwo(n)&&a.MathUtils.isPowerOfTwo(i)){var o=$n.getRenderTarget(),s=$n.autoClear;if($n.autoClear=!1,null!==Kn&&Kn.width===n&&Kn.height===i||(null!==Kn&&Kn.dispose(),(Kn=new a.WebGLRenderTarget(n,i,{depthBuffer:!1})).scissorTest=!0),n!==t.image.width||i!==t.image.height){var l={wrapS:t.wrapS,wrapT:t.wrapT,magFilter:t.magFilter,minFilter:t.minFilter,depthBuffer:!1},c=new a.WebGLRenderTarget(n,i,l);c.texture.generateMipmaps=!0,$n.setRenderTarget(c),e.roughnessMap=c.texture,e.metalnessMap==t&&(e.metalnessMap=e.roughnessMap),e.aoMap==t&&(e.aoMap=e.roughnessMap)}Yn.uniforms.roughnessMap.value=t,Yn.uniforms.normalMap.value=r;var u=new a.Vector2(0,0),h=Yn.uniforms.texelSize.value;for(let t=0;n>=1&&i>=1;++t,n/=2,i/=2)h.set(1/n,1/i),0==t&&h.set(0,0),Kn.viewport.set(u.x,u.y,n,i),Kn.scissor.set(u.x,u.y,n,i),$n.setRenderTarget(Kn),$n.render(Jn,qn),$n.copyFramebufferToTexture(u,e.roughnessMap,t),Yn.uniforms.roughnessMap.value=e.roughnessMap;t!==e.roughnessMap&&t.dispose(),$n.setRenderTarget(o),$n.autoClear=s}}}},dispose:function(){Yn.dispose(),Jn.geometry.dispose(),null!=Kn&&Kn.dispose()}};var ti={retarget:function(){var e=new a.Vector3,t=new a.Quaternion,r=new a.Vector3,n=new a.Matrix4,i=new a.Matrix4,o=new a.Matrix4;return function(a,s,l){(l=l||{}).preserveMatrix=void 0===l.preserveMatrix||l.preserveMatrix,l.preservePosition=void 0===l.preservePosition||l.preservePosition,l.preserveHipPosition=void 0!==l.preserveHipPosition&&l.preserveHipPosition,l.useTargetMatrix=void 0!==l.useTargetMatrix&&l.useTargetMatrix,l.hip=void 0!==l.hip?l.hip:"hip",l.names=l.names||{};var c,u,h,d,f,p,m=s.isObject3D?s.skeleton.bones:this.getBones(s),g=a.isObject3D?a.skeleton.bones:this.getBones(a);if(a.isObject3D?a.skeleton.pose():(l.useTargetMatrix=!0,l.preserveMatrix=!1),l.preservePosition)for(f=[],p=0;p<g.length;p++)f.push(g[p].position.clone());if(l.preserveMatrix)for(a.updateMatrixWorld(),a.matrixWorld.identity(),p=0;p<a.children.length;++p)a.children[p].updateMatrixWorld(!0);if(l.offsets)for(c=[],p=0;p<g.length;++p)u=g[p],h=l.names[u.name]||u.name,l.offsets&&l.offsets[h]&&(u.matrix.multiply(l.offsets[h]),u.matrix.decompose(u.position,u.quaternion,u.scale),u.updateMatrixWorld()),c.push(u.matrixWorld.clone());for(p=0;p<g.length;++p){if(u=g[p],h=l.names[u.name]||u.name,d=this.getBoneByName(h,m),o.copy(u.matrixWorld),d){if(d.updateMatrixWorld(),l.useTargetMatrix?i.copy(d.matrixWorld):(i.copy(a.matrixWorld).invert(),i.multiply(d.matrixWorld)),r.setFromMatrixScale(i),i.scale(r.set(1/r.x,1/r.y,1/r.z)),o.makeRotationFromQuaternion(t.setFromRotationMatrix(i)),a.isObject3D){var A=g.indexOf(u),v=c?c[A]:n.copy(a.skeleton.boneInverses[A]).invert();o.multiply(v)}o.copyPosition(i)}u.parent&&u.parent.isBone?(u.matrix.copy(u.parent.matrixWorld).invert(),u.matrix.multiply(o)):u.matrix.copy(o),l.preserveHipPosition&&h===l.hip&&u.matrix.setPosition(e.set(0,u.position.y,0)),u.matrix.decompose(u.position,u.quaternion,u.scale),u.updateMatrixWorld()}if(l.preservePosition)for(p=0;p<g.length;++p)u=g[p],(h=l.names[u.name]||u.name)!==l.hip&&u.position.copy(f[p]);l.preserveMatrix&&a.updateMatrixWorld(!0)}}(),retargetClip:function(e,t,r,n){(n=n||{}).useFirstFramePosition=void 0!==n.useFirstFramePosition&&n.useFirstFramePosition,n.fps=void 0!==n.fps?n.fps:30,n.names=n.names||[],t.isObject3D||(t=this.getHelperFromSkeleton(t));var i,o,s,l,c,u,h=Math.round(r.duration*(n.fps/1e3)*1e3),d=1/n.fps,f=[],p=new a.AnimationMixer(t),m=this.getBones(e.skeleton),g=[];for(p.clipAction(r).play(),p.update(0),t.updateMatrixWorld(),c=0;c<h;++c){var A=c*d;for(this.retarget(e,t,n),u=0;u<m.length;++u)l=n.names[m[u].name]||m[u].name,this.getBoneByName(l,t.skeleton)&&(o=m[u],s=g[u]=g[u]||{bone:o},n.hip===l&&(s.pos||(s.pos={times:new Float32Array(h),values:new Float32Array(3*h)}),n.useFirstFramePosition&&(0===c&&(i=o.position.clone()),o.position.sub(i)),s.pos.times[c]=A,o.position.toArray(s.pos.values,3*c)),s.quat||(s.quat={times:new Float32Array(h),values:new Float32Array(4*h)}),s.quat.times[c]=A,o.quaternion.toArray(s.quat.values,4*c));p.update(d),t.updateMatrixWorld()}for(c=0;c<g.length;++c)(s=g[c])&&(s.pos&&f.push(new a.VectorKeyframeTrack(".bones["+s.bone.name+"].position",s.pos.times,s.pos.values)),f.push(new a.QuaternionKeyframeTrack(".bones["+s.bone.name+"].quaternion",s.quat.times,s.quat.values)));return p.uncacheAction(r),new a.AnimationClip(r.name,-1,f)},getHelperFromSkeleton:function(e){var t=new a.SkeletonHelper(e.bones[0]);return t.skeleton=e,t},getSkeletonOffsets:function(){var e=new a.Vector3,t=new a.Vector3,r=new a.Vector3,n=new a.Vector3,i=new a.Vector2,o=new a.Vector2;return function(s,l,c){(c=c||{}).hip=void 0!==c.hip?c.hip:"hip",c.names=c.names||{},l.isObject3D||(l=this.getHelperFromSkeleton(l));var u,h,d,f,p=Object.keys(c.names),m=Object.values(c.names),g=l.isObject3D?l.skeleton.bones:this.getBones(l),A=s.isObject3D?s.skeleton.bones:this.getBones(s),v=[];for(s.skeleton.pose(),f=0;f<A.length;++f)if(u=A[f],d=c.names[u.name]||u.name,(h=this.getBoneByName(d,g))&&d!==c.hip){var y=this.getNearestBone(u.parent,p),x=this.getNearestBone(h.parent,m);y.updateMatrixWorld(),x.updateMatrixWorld(),e.setFromMatrixPosition(y.matrixWorld),t.setFromMatrixPosition(u.matrixWorld),r.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(h.matrixWorld),i.subVectors(new a.Vector2(t.x,t.y),new a.Vector2(e.x,e.y)).normalize(),o.subVectors(new a.Vector2(n.x,n.y),new a.Vector2(r.x,r.y)).normalize();var b=i.angle()-o.angle(),w=(new a.Matrix4).makeRotationFromEuler(new a.Euler(0,0,b));u.matrix.multiply(w),u.matrix.decompose(u.position,u.quaternion,u.scale),u.updateMatrixWorld(),v[d]=w}return v}}(),renameBones:function(e,t){var r=this.getBones(e);for(let i=0;i<r.length;++i){var n=r[i];t[n.name]&&(n.name=t[n.name])}return this},getBones:function(e){return Array.isArray(e)?e:e.bones},getBoneByName:function(e,t){for(let r=0,n=this.getBones(t);r<n.length;r++)if(e===n[r].name)return n[r]},getNearestBone:function(e,t){for(;e.isBone;){if(-1!==t.indexOf(e.name))return e;e=e.parent}},findBoneTrackData:function(e,t){var r=/\[(.*)\]\.(.*)/,n={name:e};for(let o=0;o<t.length;++o){var i=r.exec(t[o].name);i&&e===i[1]&&(n[i[2]]=o)}return n},getEqualsBonesNames:function(e,t){var r=this.getBones(e),n=this.getBones(t),i=[];e:for(let a=0;a<r.length;a++){var o=r[a].name;for(let e=0;e<n.length;e++)if(o===n[e].name){i.push(o);continue e}}return i},clone:function(e){var t=new Map,r=new Map,n=e.clone();return ri(e,n,(function(e,n){t.set(n,e),r.set(e,n)})),n.traverse((function(e){if(e.isSkinnedMesh){var n=e,i=t.get(e),o=i.skeleton.bones;n.skeleton=i.skeleton.clone(),n.bindMatrix.copy(i.bindMatrix),n.skeleton.bones=o.map((function(e){return r.get(e)})),n.bind(n.skeleton,n.bindMatrix)}})),n}};function ri(e,t,r){r(e,t);for(let n=0;n<e.children.length;n++)ri(e.children[n],t.children[n],r)}var ni={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","\tgl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")},ii=function(e){var t,r=this,n=void 0!==e.name&&""!==e.name,i=10,o=10,s=256,l=256,c=new a.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,10);c.position.set(0,0,2);var u,h,d=new a.Scene,f=ni,p=a.UniformsUtils.clone(f.uniforms),m=new a.ShaderMaterial({uniforms:p,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}),g=new a.PlaneGeometry(s,l),A=new a.Mesh(g,m);if(d.add(A),n){var v=(u=document.createElement("canvas")).getContext("2d");v.font="Bold 20px Arial";var y=v.measureText(e.name).width;u.width=y,u.height=25,v.font="Bold 20px Arial",v.fillStyle="rgba( 255, 0, 0, 1 )",v.fillText(e.name,0,20);var x=new a.Texture(u);x.magFilter=a.LinearFilter,x.minFilter=a.LinearFilter,x.needsUpdate=!0;var b=new a.MeshBasicMaterial({map:x,side:a.DoubleSide});b.transparent=!0;var w=new a.PlaneGeometry(u.width,u.height);h=new a.Mesh(w,b),d.add(h)}this.enabled=!0,this.size={width:s,height:l,set:function(e,t){this.width=e,this.height=t,A.scale.set(this.width/s,this.height/l,1),r.position.set(r.position.x,r.position.y)}},this.position={x:i,y:o,set:function(e,t){this.x=e,this.y=t;var i=r.size.width,o=r.size.height;A.position.set(-window.innerWidth/2+i/2+this.x,window.innerHeight/2-o/2-this.y,0),n&&h.position.set(A.position.x,A.position.y-r.size.height/2+u.height/2,0)}},this.render=function(r){this.enabled&&(p.tDiffuse.value=e.shadow.map.texture,t=r.autoClear,r.autoClear=!1,r.clearDepth(),r.render(d,c),r.autoClear=t)},this.updateForWindowResize=function(){this.enabled&&(c.left=window.innerWidth/-2,c.right=window.innerWidth/2,c.top=window.innerHeight/2,c.bottom=window.innerHeight/-2,c.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()};ii.prototype.constructor=ii;var oi={compressNormals:function(e,t){e.geometry||console.error("Mesh must contain geometry. ");const r=e.geometry.attributes.normal;if(r||console.error("Geometry must contain normal attribute. "),r.isPacked)return;3!=r.itemSize&&console.error("normal.itemSize is not 3, which cannot be encoded. ");const n=r.array,i=r.count;let o;if("DEFAULT"==t){o=new Uint8Array(3*i);for(let e=0;e<n.length;e+=3){const t=this.EncodingFuncs.defaultEncode(n[e],n[e+1],n[e+2],1);o[e+0]=t[0],o[e+1]=t[1],o[e+2]=t[2]}e.geometry.setAttribute("normal",new a.BufferAttribute(o,3,!0)),e.geometry.attributes.normal.bytes=1*o.length}else if("OCT1Byte"==t){o=new Int8Array(2*i);for(let e=0;e<n.length;e+=3){const t=this.EncodingFuncs.octEncodeBest(n[e],n[e+1],n[e+2],1);o[e/3*2+0]=t[0],o[e/3*2+1]=t[1]}e.geometry.setAttribute("normal",new a.BufferAttribute(o,2,!0)),e.geometry.attributes.normal.bytes=1*o.length}else if("OCT2Byte"==t){o=new Int16Array(2*i);for(let e=0;e<n.length;e+=3){const t=this.EncodingFuncs.octEncodeBest(n[e],n[e+1],n[e+2],2);o[e/3*2+0]=t[0],o[e/3*2+1]=t[1]}e.geometry.setAttribute("normal",new a.BufferAttribute(o,2,!0)),e.geometry.attributes.normal.bytes=2*o.length}else if("ANGLES"==t){o=new Uint16Array(2*i);for(let e=0;e<n.length;e+=3){const t=this.EncodingFuncs.anglesEncode(n[e],n[e+1],n[e+2]);o[e/3*2+0]=t[0],o[e/3*2+1]=t[1]}e.geometry.setAttribute("normal",new a.BufferAttribute(o,2,!0)),e.geometry.attributes.normal.bytes=2*o.length}else console.error("Unrecognized encoding method, should be `DEFAULT` or `ANGLES` or `OCT`. ");e.geometry.attributes.normal.needsUpdate=!0,e.geometry.attributes.normal.isPacked=!0,e.geometry.attributes.normal.packingMethod=t,e.material instanceof ai||(e.material=(new ai).copy(e.material)),"ANGLES"==t&&(e.material.defines.USE_PACKED_NORMAL=0),"OCT1Byte"==t&&(e.material.defines.USE_PACKED_NORMAL=1),"OCT2Byte"==t&&(e.material.defines.USE_PACKED_NORMAL=1),"DEFAULT"==t&&(e.material.defines.USE_PACKED_NORMAL=2)},compressPositions:function(e){e.geometry||console.error("Mesh must contain geometry. ");const t=e.geometry.attributes.position;if(t||console.error("Geometry must contain position attribute. "),t.isPacked)return;3!=t.itemSize&&console.error("position.itemSize is not 3, which cannot be packed. ");const r=t.array,n=this.EncodingFuncs.quantizedEncode(r,2),i=n.quantized,o=n.decodeMat;null==e.geometry.boundingBox&&e.geometry.computeBoundingBox(),null==e.geometry.boundingSphere&&e.geometry.computeBoundingSphere(),e.geometry.setAttribute("position",new a.BufferAttribute(i,3)),e.geometry.attributes.position.isPacked=!0,e.geometry.attributes.position.needsUpdate=!0,e.geometry.attributes.position.bytes=2*i.length,e.material instanceof ai||(e.material=(new ai).copy(e.material)),e.material.defines.USE_PACKED_POSITION=0,e.material.uniforms.quantizeMatPos.value=o,e.material.uniforms.quantizeMatPos.needsUpdate=!0},compressUvs:function(e){e.geometry||console.error("Mesh must contain geometry property. ");const t=e.geometry.attributes.uv;if(t||console.error("Geometry must contain uv attribute. "),t.isPacked)return;const r={min:1/0,max:-1/0},n=t.array;for(let o=0;o<n.length;o++)r.min=Math.min(r.min,n[o]),r.max=Math.max(r.max,n[o]);let i;if(r.min>=-1&&r.max<=1){i=new Uint16Array(n.length);for(let e=0;e<n.length;e+=2){const t=this.EncodingFuncs.defaultEncode(n[e],n[e+1],0,2);i[e]=t[0],i[e+1]=t[1]}e.geometry.setAttribute("uv",new a.BufferAttribute(i,2,!0)),e.geometry.attributes.uv.isPacked=!0,e.geometry.attributes.uv.needsUpdate=!0,e.geometry.attributes.uv.bytes=2*i.length,e.material instanceof ai||(e.material=(new ai).copy(e.material)),e.material.defines.USE_PACKED_UV=0}else i=this.EncodingFuncs.quantizedEncodeUV(n,2),e.geometry.setAttribute("uv",new a.BufferAttribute(i.quantized,2)),e.geometry.attributes.uv.isPacked=!0,e.geometry.attributes.uv.needsUpdate=!0,e.geometry.attributes.uv.bytes=2*i.quantized.length,e.material instanceof ai||(e.material=(new ai).copy(e.material)),e.material.defines.USE_PACKED_UV=1,e.material.uniforms.quantizeMatUV.value=i.decodeMat,e.material.uniforms.quantizeMatUV.needsUpdate=!0},EncodingFuncs:{defaultEncode:function(e,t,r,n){if(1==n){const n=Math.round(.5*(e+1)*255),i=Math.round(.5*(t+1)*255),o=Math.round(.5*(r+1)*255);return new Uint8Array([n,i,o])}if(2==n){const n=Math.round(.5*(e+1)*65535),i=Math.round(.5*(t+1)*65535),o=Math.round(.5*(r+1)*65535);return new Uint16Array([n,i,o])}console.error("number of bytes must be 1 or 2")},defaultDecode:function(e,t){return 1==t?[e[0]/255*2-1,e[1]/255*2-1,e[2]/255*2-1]:2==t?[e[0]/65535*2-1,e[1]/65535*2-1,e[2]/65535*2-1]:void console.error("number of bytes must be 1 or 2")},anglesEncode:function(e,t,r){const n=parseInt(.5*(1+Math.atan2(t,e)/Math.PI)*65535),i=parseInt(.5*(1+r)*65535);return new Uint16Array([n,i])},octEncodeBest:function(e,t,r,n){var i,o,a,s,l;return a=i=c(e,t,r,"floor","floor"),o=u(i),l=h(e,t,r,o),o=u(i=c(e,t,r,"ceil","floor")),(s=h(e,t,r,o))>l&&(a=i,l=s),o=u(i=c(e,t,r,"floor","ceil")),(s=h(e,t,r,o))>l&&(a=i,l=s),o=u(i=c(e,t,r,"ceil","ceil")),(s=h(e,t,r,o))>l&&(a=i),a;function c(e,t,i,o,a){var s=e/(Math.abs(e)+Math.abs(t)+Math.abs(i)),l=t/(Math.abs(e)+Math.abs(t)+Math.abs(i));if(r<0){var c=(1-Math.abs(l))*(s>=0?1:-1),u=(1-Math.abs(s))*(l>=0?1:-1);s=c,l=u;var h=1-Math.abs(s)-Math.abs(l);h>0&&(h+=.001,s+=s>0?h/2:-h/2,l+=l>0?h/2:-h/2)}return 1==n?new Int8Array([Math[o](127.5*s+(s<0?1:0)),Math[a](127.5*l+(l<0?1:0))]):2==n?new Int16Array([Math[o](32767.5*s+(s<0?1:0)),Math[a](32767.5*l+(l<0?1:0))]):void 0}function u(e){var t=e[0],r=e[1];1==n?(t/=t<0?127:128,r/=r<0?127:128):2==n&&(t/=t<0?32767:32768,r/=r<0?32767:32768);var i=1-Math.abs(t)-Math.abs(r);if(i<0){var o=t;t=(1-Math.abs(r))*(t>=0?1:-1),r=(1-Math.abs(o))*(r>=0?1:-1)}var a=Math.sqrt(t*t+r*r+i*i);return[t/a,r/a,i/a]}function h(e,t,r,n){return e*n[0]+t*n[1]+r*n[2]}},quantizedEncode:function(e,t){let r,n;1==t?(r=new Uint8Array(e.length),n=255):2==t?(r=new Uint16Array(e.length),n=65535):console.error("number of bytes error! ");const i=new a.Matrix4,o=new Float32Array(3),s=new Float32Array(3);o[0]=o[1]=o[2]=Number.MAX_VALUE,s[0]=s[1]=s[2]=-Number.MAX_VALUE;for(let a=0;a<e.length;a+=3)o[0]=Math.min(o[0],e[a+0]),o[1]=Math.min(o[1],e[a+1]),o[2]=Math.min(o[2],e[a+2]),s[0]=Math.max(s[0],e[a+0]),s[1]=Math.max(s[1],e[a+1]),s[2]=Math.max(s[2],e[a+2]);i.scale(new a.Vector3((s[0]-o[0])/n,(s[1]-o[1])/n,(s[2]-o[2])/n)),i.elements[12]=o[0],i.elements[13]=o[1],i.elements[14]=o[2],i.transpose();const l=new Float32Array([s[0]!==o[0]?n/(s[0]-o[0]):0,s[1]!==o[1]?n/(s[1]-o[1]):0,s[2]!==o[2]?n/(s[2]-o[2]):0]);for(let a=0;a<e.length;a+=3)r[a+0]=Math.floor((e[a+0]-o[0])*l[0]),r[a+1]=Math.floor((e[a+1]-o[1])*l[1]),r[a+2]=Math.floor((e[a+2]-o[2])*l[2]);return{quantized:r,decodeMat:i}},quantizedEncodeUV:function(e,t){let r,n;1==t?(r=new Uint8Array(e.length),n=255):2==t?(r=new Uint16Array(e.length),n=65535):console.error("number of bytes error! ");const i=new a.Matrix3,o=new Float32Array(2),s=new Float32Array(2);o[0]=o[1]=Number.MAX_VALUE,s[0]=s[1]=-Number.MAX_VALUE;for(let a=0;a<e.length;a+=2)o[0]=Math.min(o[0],e[a+0]),o[1]=Math.min(o[1],e[a+1]),s[0]=Math.max(s[0],e[a+0]),s[1]=Math.max(s[1],e[a+1]);i.scale((s[0]-o[0])/n,(s[1]-o[1])/n),i.elements[6]=o[0],i.elements[7]=o[1],i.transpose();const l=new Float32Array([s[0]!==o[0]?n/(s[0]-o[0]):0,s[1]!==o[1]?n/(s[1]-o[1]):0]);for(let a=0;a<e.length;a+=2)r[a+0]=Math.floor((e[a+0]-o[0])*l[0]),r[a+1]=Math.floor((e[a+1]-o[1])*l[1]);return{quantized:r,decodeMat:i}}}};class ai extends a.MeshPhongMaterial{constructor(e){super(),this.defines={},this.type="PackedPhongMaterial",this.uniforms=a.UniformsUtils.merge([a.ShaderLib.phong.uniforms,{quantizeMatPos:{value:null},quantizeMatUV:{value:null}}]),this.vertexShader=["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","varying vec3 vNormal;","#endif",a.ShaderChunk.common,a.ShaderChunk.uv_pars_vertex,a.ShaderChunk.uv2_pars_vertex,a.ShaderChunk.displacementmap_pars_vertex,a.ShaderChunk.envmap_pars_vertex,a.ShaderChunk.color_pars_vertex,a.ShaderChunk.fog_pars_vertex,a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,a.ShaderChunk.logdepthbuf_pars_vertex,a.ShaderChunk.clipping_planes_pars_vertex,"#ifdef USE_PACKED_NORMAL\n\t\t\t\t\t#if USE_PACKED_NORMAL == 0\n\t\t\t\t\t\tvec3 decodeNormal(vec3 packedNormal)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfloat x = packedNormal.x * 2.0 - 1.0;\n\t\t\t\t\t\t\tfloat y = packedNormal.y * 2.0 - 1.0;\n\t\t\t\t\t\t\tvec2 scth = vec2(sin(x * PI), cos(x * PI));\n\t\t\t\t\t\t\tvec2 scphi = vec2(sqrt(1.0 - y * y), y);\n\t\t\t\t\t\t\treturn normalize( vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y) );\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#if USE_PACKED_NORMAL == 1\n\t\t\t\t\t\tvec3 decodeNormal(vec3 packedNormal)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvec3 v = vec3(packedNormal.xy, 1.0 - abs(packedNormal.x) - abs(packedNormal.y));\n\t\t\t\t\t\t\tif (v.z < 0.0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tv.xy = (1.0 - abs(v.yx)) * vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn normalize(v);\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#if USE_PACKED_NORMAL == 2\n\t\t\t\t\t\tvec3 decodeNormal(vec3 packedNormal)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvec3 v = (packedNormal * 2.0) - 1.0;\n\t\t\t\t\t\t\treturn normalize(v);\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t#endif","#ifdef USE_PACKED_POSITION\n\t\t\t\t\t#if USE_PACKED_POSITION == 0\n\t\t\t\t\t\tuniform mat4 quantizeMatPos;\n\t\t\t\t\t#endif\n\t\t\t\t#endif","#ifdef USE_PACKED_UV\n\t\t\t\t\t#if USE_PACKED_UV == 1\n\t\t\t\t\t\tuniform mat3 quantizeMatUV;\n\t\t\t\t\t#endif\n\t\t\t\t#endif","#ifdef USE_PACKED_UV\n\t\t\t\t\t#if USE_PACKED_UV == 0\n\t\t\t\t\t\tvec2 decodeUV(vec2 packedUV)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvec2 uv = (packedUV * 2.0) - 1.0;\n\t\t\t\t\t\t\treturn uv;\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#if USE_PACKED_UV == 1\n\t\t\t\t\t\tvec2 decodeUV(vec2 packedUV)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvec2 uv = ( vec3(packedUV, 1.0) * quantizeMatUV ).xy;\n\t\t\t\t\t\t\treturn uv;\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t#endif","void main() {",a.ShaderChunk.uv_vertex,"#ifdef USE_UV\n\t\t\t\t\t#ifdef USE_PACKED_UV\n\t\t\t\t\t\tvUv = decodeUV(vUv);\n\t\t\t\t\t#endif\n\t\t\t\t#endif",a.ShaderChunk.uv2_vertex,a.ShaderChunk.color_vertex,a.ShaderChunk.beginnormal_vertex,"#ifdef USE_PACKED_NORMAL\n\t\t\t\t\tobjectNormal = decodeNormal(objectNormal);\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_TANGENT\n\t\t\t\t\tvec3 objectTangent = vec3( tangent.xyz );\n\t\t\t\t#endif\n\t\t\t\t",a.ShaderChunk.morphnormal_vertex,a.ShaderChunk.skinbase_vertex,a.ShaderChunk.skinnormal_vertex,a.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",a.ShaderChunk.begin_vertex,"#ifdef USE_PACKED_POSITION\n\t\t\t\t\t#if USE_PACKED_POSITION == 0\n\t\t\t\t\t\ttransformed = ( vec4(transformed, 1.0) * quantizeMatPos ).xyz;\n\t\t\t\t\t#endif\n\t\t\t\t#endif",a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.displacementmap_vertex,a.ShaderChunk.project_vertex,a.ShaderChunk.logdepthbuf_vertex,a.ShaderChunk.clipping_planes_vertex,"vViewPosition = - mvPosition.xyz;",a.ShaderChunk.worldpos_vertex,a.ShaderChunk.envmap_vertex,a.ShaderChunk.shadowmap_vertex,a.ShaderChunk.fog_vertex,"}"].join("\n"),this.fragmentShader=["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",a.ShaderChunk.common,a.ShaderChunk.packing,a.ShaderChunk.dithering_pars_fragment,a.ShaderChunk.color_pars_fragment,a.ShaderChunk.uv_pars_fragment,a.ShaderChunk.uv2_pars_fragment,a.ShaderChunk.map_pars_fragment,a.ShaderChunk.alphamap_pars_fragment,a.ShaderChunk.aomap_pars_fragment,a.ShaderChunk.lightmap_pars_fragment,a.ShaderChunk.emissivemap_pars_fragment,a.ShaderChunk.envmap_common_pars_fragment,a.ShaderChunk.envmap_pars_fragment,a.ShaderChunk.cube_uv_reflection_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.bsdfs,a.ShaderChunk.lights_pars_begin,a.ShaderChunk.lights_phong_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,a.ShaderChunk.bumpmap_pars_fragment,a.ShaderChunk.normalmap_pars_fragment,a.ShaderChunk.specularmap_pars_fragment,a.ShaderChunk.logdepthbuf_pars_fragment,a.ShaderChunk.clipping_planes_pars_fragment,"void main() {",a.ShaderChunk.clipping_planes_fragment,"vec4 diffuseColor = vec4( diffuse, opacity );","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","vec3 totalEmissiveRadiance = emissive;",a.ShaderChunk.logdepthbuf_fragment,a.ShaderChunk.map_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.alphamap_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.specularmap_fragment,a.ShaderChunk.normal_fragment_begin,a.ShaderChunk.normal_fragment_maps,a.ShaderChunk.emissivemap_fragment,a.ShaderChunk.lights_phong_fragment,a.ShaderChunk.lights_fragment_begin,a.ShaderChunk.lights_fragment_maps,a.ShaderChunk.lights_fragment_end,a.ShaderChunk.aomap_fragment,"vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;",a.ShaderChunk.envmap_fragment,"gl_FragColor = vec4( outgoingLight, diffuseColor.a );",a.ShaderChunk.tonemapping_fragment,a.ShaderChunk.encodings_fragment,a.ShaderChunk.fog_fragment,a.ShaderChunk.premultiplied_alpha_fragment,a.ShaderChunk.dithering_fragment,"}"].join("\n"),this.setValues(e)}}var si={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:0},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new a.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","/*","make sure that these two values are the same for your camera, otherwise distances will be wrong.","*/","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","/*","next part is experimental","not looking good with small sample and ring count","looks okay starting from samples = 4, rings = 4","*/","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","\t//pentagonal shape","\tfloat scale = float(rings) - 1.3;","\tvec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","\tvec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","\tvec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","\tvec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","\tvec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","\tvec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","\tvec4  one = vec4( 1.0 );","\tvec4 P = vec4((coords),vec2(scale, scale));","\tvec4 dist = vec4(0.0);","\tfloat inorout = -4.0;","\tdist.x = dot( P, HS0 );","\tdist.y = dot( P, HS1 );","\tdist.z = dot( P, HS2 );","\tdist.w = dot( P, HS3 );","\tdist = smoothstep( -feather, feather, dist );","\tinorout += dot( dist, one );","\tdist.x = dot( P, HS4 );","\tdist.y = HS5.w - abs( P.z );","\tdist = smoothstep( -feather, feather, dist );","\tinorout += dist.x;","\treturn clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","\t// Depth buffer blur","\tfloat d = 0.0;","\tfloat kernel[9];","\tvec2 offset[9];","\tvec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","\toffset[0] = vec2(-wh.x,-wh.y);","\toffset[1] = vec2( 0.0, -wh.y);","\toffset[2] = vec2( wh.x -wh.y);","\toffset[3] = vec2(-wh.x,  0.0);","\toffset[4] = vec2( 0.0,   0.0);","\toffset[5] = vec2( wh.x,  0.0);","\toffset[6] = vec2(-wh.x, wh.y);","\toffset[7] = vec2( 0.0,  wh.y);","\toffset[8] = vec2( wh.x, wh.y);","\tkernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","\tkernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","\tkernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","\tfor( int i=0; i<9; i++ ) {","\t\tfloat tmp = texture2D(tDepth, coords + offset[i]).r;","\t\td += tmp * kernel[i];","\t}","\treturn d;","}","vec3 color(vec2 coords,float blur) {","\t//processing the sample","\tvec3 col = vec3(0.0);","\tvec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","\tcol.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","\tcol.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","\tcol.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","\tvec3 lumcoeff = vec3(0.299,0.587,0.114);","\tfloat lum = dot(col.rgb, lumcoeff);","\tfloat thresh = max((lum-threshold)*gain, 0.0);","\treturn col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","\tfloat edge = 0.002*depth; //distance based edge smoothing","\tfloat m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","\tfloat e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","\tcol = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","\tcol = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","\treturn col;","}","float linearize(float depth) {","\treturn -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","\tfloat dist = distance(vUv.xy, vec2(0.5,0.5));","\tdist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","\treturn clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","\tfloat rings2 = float(rings);","\tfloat step = PI*2.0 / float(ringsamples);","\tfloat pw = cos(j*step)*i;","\tfloat ph = sin(j*step)*i;","\tfloat p = 1.0;","\tif (pentagon) {","\t\tp = penta(vec2(pw,ph));","\t}","\tcol += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","\treturn 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","\t//scene depth calculation","\tfloat depth = linearize(texture2D(tDepth,vUv.xy).x);","\t// Blur depth?","\tif ( depthblur ) {","\t\tdepth = linearize(bdepth(vUv.xy));","\t}","\t//focal plane calculation","\tfloat fDepth = focalDepth;","\tif (shaderFocus) {","\t\tfDepth = linearize(texture2D(tDepth,focusCoords).x);","\t}","\t// dof blur factor calculation","\tfloat blur = 0.0;","\tif (manualdof) {","\t\tfloat a = depth-fDepth; // Focal plane","\t\tfloat b = (a-fdofstart)/fdofdist; // Far DoF","\t\tfloat c = (-a-ndofstart)/ndofdist; // Near Dof","\t\tblur = (a>0.0) ? b : c;","\t} else {","\t\tfloat f = focalLength; // focal length in mm","\t\tfloat d = fDepth*1000.0; // focal plane in mm","\t\tfloat o = depth*1000.0; // depth in mm","\t\tfloat a = (o*f)/(o-f);","\t\tfloat b = (d*f)/(d-f);","\t\tfloat c = (d-f)/(d*fstop*CoC);","\t\tblur = abs(a-b)*c;","\t}","\tblur = clamp(blur,0.0,1.0);","\t// calculation of pattern for dithering","\tvec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","\t// getting blur x and y step factor","\tfloat w = (1.0/textureWidth)*blur*maxblur+noise.x;","\tfloat h = (1.0/textureHeight)*blur*maxblur+noise.y;","\t// calculation of final color","\tvec3 col = vec3(0.0);","\tif(blur < 0.05) {","\t\t//some optimization thingy","\t\tcol = texture2D(tColor, vUv.xy).rgb;","\t} else {","\t\tcol = texture2D(tColor, vUv.xy).rgb;","\t\tfloat s = 1.0;","\t\tint ringsamples;","\t\tfor (int i = 1; i <= rings; i++) {","\t\t\t/*unboxstart*/","\t\t\tringsamples = i * samples;","\t\t\tfor (int j = 0 ; j < maxringsamples ; j++) {","\t\t\t\tif (j >= ringsamples) break;","\t\t\t\ts += gather(float(i), float(j), ringsamples, col, w, h, blur);","\t\t\t}","\t\t\t/*unboxend*/","\t\t}","\t\tcol /= s; //divide by sample count","\t}","\tif (showFocus) {","\t\tcol = debugFocus(col, blur, depth);","\t}","\tif (vignetting) {","\t\tcol *= vignette();","\t}","\tgl_FragColor.rgb = col;","\tgl_FragColor.a = 1.0;","} "].join("\n")},li={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:["varying float vViewZDepth;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\tvViewZDepth = - mvPosition.z;","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","varying float vViewZDepth;","void main() {","\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );","\tgl_FragColor = vec4( vec3( color ), 1.0 );","} "].join("\n")};class ci extends a.PerspectiveCamera{constructor(e,t,r,n){super(e,t,r,n),this.type="CinematicCamera",this.postprocessing={enabled:!0},this.shaderSettings={rings:3,samples:4};const i=li;this.materialDepth=new a.ShaderMaterial({uniforms:i.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),this.materialDepth.uniforms.mNear.value=r,this.materialDepth.uniforms.mFar.value=n,this.setLens(),this.initPostProcessing()}setLens(e,t,r,n){void 0===e&&(e=35),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e),void 0===r&&(r=8),void 0===n&&(n=.019),this.fNumber=r,this.coc=n,this.aperture=e/this.fNumber,this.hyperFocal=e*e/(this.aperture*this.coc)}linearize(e){const t=this.far,r=this.near;return-t*r/(e*(t-r)-t)}smoothstep(e,t,r){const n=this.saturate((r-e)/(t-e));return n*n*(3-2*n)}saturate(e){return Math.max(0,Math.min(1,e))}focusAt(e){void 0===e&&(e=20);const t=this.getFocalLength();this.focus=e,this.nearPoint=this.hyperFocal*this.focus/(this.hyperFocal+(this.focus-t)),this.farPoint=this.hyperFocal*this.focus/(this.hyperFocal-(this.focus-t)),this.depthOfField=this.farPoint-this.nearPoint,this.depthOfField<0&&(this.depthOfField=0),this.sdistance=this.smoothstep(this.near,this.far,this.focus),this.ldistance=this.linearize(1-this.sdistance),this.postprocessing.bokeh_uniforms.focalDepth.value=this.ldistance}initPostProcessing(){if(this.postprocessing.enabled){this.postprocessing.scene=new a.Scene,this.postprocessing.camera=new a.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4),this.postprocessing.scene.add(this.postprocessing.camera),this.postprocessing.rtTextureDepth=new a.WebGLRenderTarget(window.innerWidth,window.innerHeight),this.postprocessing.rtTextureColor=new a.WebGLRenderTarget(window.innerWidth,window.innerHeight);const e=si;this.postprocessing.bokeh_uniforms=a.UniformsUtils.clone(e.uniforms),this.postprocessing.bokeh_uniforms.tColor.value=this.postprocessing.rtTextureColor.texture,this.postprocessing.bokeh_uniforms.tDepth.value=this.postprocessing.rtTextureDepth.texture,this.postprocessing.bokeh_uniforms.manualdof.value=0,this.postprocessing.bokeh_uniforms.shaderFocus.value=0,this.postprocessing.bokeh_uniforms.fstop.value=2.8,this.postprocessing.bokeh_uniforms.showFocus.value=1,this.postprocessing.bokeh_uniforms.focalDepth.value=.1,this.postprocessing.bokeh_uniforms.znear.value=this.near,this.postprocessing.bokeh_uniforms.zfar.value=this.near,this.postprocessing.bokeh_uniforms.textureWidth.value=window.innerWidth,this.postprocessing.bokeh_uniforms.textureHeight.value=window.innerHeight,this.postprocessing.materialBokeh=new a.ShaderMaterial({uniforms:this.postprocessing.bokeh_uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,defines:{RINGS:this.shaderSettings.rings,SAMPLES:this.shaderSettings.samples,DEPTH_PACKING:1}}),this.postprocessing.quad=new a.Mesh(new a.PlaneGeometry(window.innerWidth,window.innerHeight),this.postprocessing.materialBokeh),this.postprocessing.quad.position.z=-500,this.postprocessing.scene.add(this.postprocessing.quad)}}renderCinematic(e,t){if(this.postprocessing.enabled){const r=t.getRenderTarget();t.clear(),e.overrideMaterial=null,t.setRenderTarget(this.postprocessing.rtTextureColor),t.clear(),t.render(e,this),e.overrideMaterial=this.materialDepth,t.setRenderTarget(this.postprocessing.rtTextureDepth),t.clear(),t.render(e,this),t.setRenderTarget(null),t.render(this.postprocessing.scene,this.postprocessing.camera),t.setRenderTarget(r)}}}var ui=function(){var e=new a.Triangle,t=new a.Vector3;function r(e){var t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}return r.prototype={constructor:r,setWeightAttribute:function(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this},build:function(){var t=this.positionAttribute,r=this.weightAttribute,n=new Float32Array(t.count/3);for(let a=0;a<t.count;a+=3){var i=1;r&&(i=r.getX(a)+r.getX(a+1)+r.getX(a+2)),e.a.fromBufferAttribute(t,a),e.b.fromBufferAttribute(t,a+1),e.c.fromBufferAttribute(t,a+2),i*=e.getArea(),n[a/3]=i}this.distribution=new Float32Array(t.count/3);var o=0;for(let e=0;e<n.length;e++)o+=n[e],this.distribution[e]=o;return this},setRandomGenerator:function(e){return this.randomFunction=e,this},sample:function(e,t,r){var n=this.distribution[this.distribution.length-1],i=this.binarySearch(this.randomFunction()*n);return this.sampleFace(i,e,t,r)},binarySearch:function(e){for(var t=this.distribution,r=0,n=t.length-1,i=-1;r<=n;){var o=Math.ceil((r+n)/2);if(0===o||t[o-1]<=e&&t[o]>e){i=o;break}e<t[o]?n=o-1:r=o+1}return i},sampleFace:function(r,n,i,o){var a=this.randomFunction(),s=this.randomFunction();return a+s>1&&(a=1-a,s=1-s),e.a.fromBufferAttribute(this.positionAttribute,3*r),e.b.fromBufferAttribute(this.positionAttribute,3*r+1),e.c.fromBufferAttribute(this.positionAttribute,3*r+2),n.set(0,0,0).addScaledVector(e.a,a).addScaledVector(e.b,s).addScaledVector(e.c,1-(a+s)),void 0!==i&&e.getNormal(i),void 0!==o&&void 0!==this.colorAttribute&&(e.a.fromBufferAttribute(this.colorAttribute,3*r),e.b.fromBufferAttribute(this.colorAttribute,3*r+1),e.c.fromBufferAttribute(this.colorAttribute,3*r+2),t.set(0,0,0).addScaledVector(e.a,a).addScaledVector(e.b,s).addScaledVector(e.c,1-(a+s)),o.r=t.x,o.g=t.y,o.b=t.z),this}},r}(),hi={c:null,u:[new a.Vector3,new a.Vector3,new a.Vector3],e:[]},di={c:null,u:[new a.Vector3,new a.Vector3,new a.Vector3],e:[]},fi=[[],[],[]],pi=[[],[],[]],mi=[],gi=new a.Vector3,Ai=new a.Vector3,vi=new a.Vector3,yi=new a.Vector3,xi=new a.Vector3,bi=new a.Vector3,wi=new a.Matrix3,Ci=new a.Box3,Ei=new a.Matrix4,Si=new a.Matrix4,Ti=new a.Ray;function Mi(e=new a.Vector3,t=new a.Vector3,r=new a.Matrix3){this.center=e,this.halfSize=t,this.rotation=r}Object.assign(Mi.prototype,{set:function(e,t,r){return this.center=e,this.halfSize=t,this.rotation=r,this},copy:function(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this},clone:function(){return(new this.constructor).copy(this)},getSize:function(e){return e.copy(this.halfSize).multiplyScalar(2)},clampPoint:function(e,t){var r=this.halfSize;yi.subVectors(e,this.center),this.rotation.extractBasis(gi,Ai,vi),t.copy(this.center);var n=a.MathUtils.clamp(yi.dot(gi),-r.x,r.x);t.add(gi.multiplyScalar(n));var i=a.MathUtils.clamp(yi.dot(Ai),-r.y,r.y);t.add(Ai.multiplyScalar(i));var o=a.MathUtils.clamp(yi.dot(vi),-r.z,r.z);return t.add(vi.multiplyScalar(o)),t},containsPoint:function(e){return yi.subVectors(e,this.center),this.rotation.extractBasis(gi,Ai,vi),Math.abs(yi.dot(gi))<=this.halfSize.x&&Math.abs(yi.dot(Ai))<=this.halfSize.y&&Math.abs(yi.dot(vi))<=this.halfSize.z},intersectsBox3:function(e){return this.intersectsOBB(Ii.fromBox3(e))},intersectsSphere:function(e){return this.clampPoint(e.center,bi),bi.distanceToSquared(e.center)<=e.radius*e.radius},intersectsOBB:function(e,t=Number.EPSILON){hi.c=this.center,hi.e[0]=this.halfSize.x,hi.e[1]=this.halfSize.y,hi.e[2]=this.halfSize.z,this.rotation.extractBasis(hi.u[0],hi.u[1],hi.u[2]),di.c=e.center,di.e[0]=e.halfSize.x,di.e[1]=e.halfSize.y,di.e[2]=e.halfSize.z,e.rotation.extractBasis(di.u[0],di.u[1],di.u[2]);for(let i=0;i<3;i++)for(let e=0;e<3;e++)fi[i][e]=hi.u[i].dot(di.u[e]);yi.subVectors(di.c,hi.c),mi[0]=yi.dot(hi.u[0]),mi[1]=yi.dot(hi.u[1]),mi[2]=yi.dot(hi.u[2]);for(let i=0;i<3;i++)for(let e=0;e<3;e++)pi[i][e]=Math.abs(fi[i][e])+t;var r,n;for(let i=0;i<3;i++)if(r=hi.e[i],n=di.e[0]*pi[i][0]+di.e[1]*pi[i][1]+di.e[2]*pi[i][2],Math.abs(mi[i])>r+n)return!1;for(let i=0;i<3;i++)if(r=hi.e[0]*pi[0][i]+hi.e[1]*pi[1][i]+hi.e[2]*pi[2][i],n=di.e[i],Math.abs(mi[0]*fi[0][i]+mi[1]*fi[1][i]+mi[2]*fi[2][i])>r+n)return!1;return r=hi.e[1]*pi[2][0]+hi.e[2]*pi[1][0],n=di.e[1]*pi[0][2]+di.e[2]*pi[0][1],!(Math.abs(mi[2]*fi[1][0]-mi[1]*fi[2][0])>r+n)&&(r=hi.e[1]*pi[2][1]+hi.e[2]*pi[1][1],n=di.e[0]*pi[0][2]+di.e[2]*pi[0][0],!(Math.abs(mi[2]*fi[1][1]-mi[1]*fi[2][1])>r+n)&&(r=hi.e[1]*pi[2][2]+hi.e[2]*pi[1][2],n=di.e[0]*pi[0][1]+di.e[1]*pi[0][0],!(Math.abs(mi[2]*fi[1][2]-mi[1]*fi[2][2])>r+n)&&(r=hi.e[0]*pi[2][0]+hi.e[2]*pi[0][0],n=di.e[1]*pi[1][2]+di.e[2]*pi[1][1],!(Math.abs(mi[0]*fi[2][0]-mi[2]*fi[0][0])>r+n)&&(r=hi.e[0]*pi[2][1]+hi.e[2]*pi[0][1],n=di.e[0]*pi[1][2]+di.e[2]*pi[1][0],!(Math.abs(mi[0]*fi[2][1]-mi[2]*fi[0][1])>r+n)&&(r=hi.e[0]*pi[2][2]+hi.e[2]*pi[0][2],n=di.e[0]*pi[1][1]+di.e[1]*pi[1][0],!(Math.abs(mi[0]*fi[2][2]-mi[2]*fi[0][2])>r+n)&&(r=hi.e[0]*pi[1][0]+hi.e[1]*pi[0][0],n=di.e[1]*pi[2][2]+di.e[2]*pi[2][1],!(Math.abs(mi[1]*fi[0][0]-mi[0]*fi[1][0])>r+n)&&(r=hi.e[0]*pi[1][1]+hi.e[1]*pi[0][1],n=di.e[0]*pi[2][2]+di.e[2]*pi[2][0],!(Math.abs(mi[1]*fi[0][1]-mi[0]*fi[1][1])>r+n)&&(r=hi.e[0]*pi[1][2]+hi.e[1]*pi[0][2],n=di.e[0]*pi[2][1]+di.e[1]*pi[2][0],!(Math.abs(mi[1]*fi[0][2]-mi[0]*fi[1][2])>r+n)))))))))},intersectsPlane:function(e){this.rotation.extractBasis(gi,Ai,vi);const t=this.halfSize.x*Math.abs(e.normal.dot(gi))+this.halfSize.y*Math.abs(e.normal.dot(Ai))+this.halfSize.z*Math.abs(e.normal.dot(vi)),r=e.normal.dot(this.center)-e.constant;return Math.abs(r)<=t},intersectRay:function(e,t){return this.getSize(xi),Ci.setFromCenterAndSize(yi.set(0,0,0),xi),function(e,t){var r=e.elements,n=t.elements;r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=n[3],r[5]=n[4],r[6]=n[5],r[7]=0,r[8]=n[6],r[9]=n[7],r[10]=n[8],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1}(Ei,this.rotation),Ei.setPosition(this.center),Si.copy(Ei).invert(),Ti.copy(e).applyMatrix4(Si),Ti.intersectBox(Ci,t)?t.applyMatrix4(Ei):null},intersectsRay:function(e){return null!==this.intersectRay(e,yi)},fromBox3:function(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this},equals:function(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)},applyMatrix4:function(e){var t=e.elements,r=yi.set(t[0],t[1],t[2]).length(),n=yi.set(t[4],t[5],t[6]).length(),i=yi.set(t[8],t[9],t[10]).length();e.determinant()<0&&(r=-r),wi.setFromMatrix4(e);var o=1/r,a=1/n,s=1/i;return wi.elements[0]*=o,wi.elements[1]*=o,wi.elements[2]*=o,wi.elements[3]*=a,wi.elements[4]*=a,wi.elements[5]*=a,wi.elements[6]*=s,wi.elements[7]*=s,wi.elements[8]*=s,this.rotation.multiply(wi),this.halfSize.x*=r,this.halfSize.y*=n,this.halfSize.z*=i,yi.setFromMatrixPosition(e),this.center.add(yi),this}});var Ii=new Mi,Bi=function(){var e=new a.Vector3,t=new a.Vector3,r=new a.Vector3;function n(e,t,r){this.start=void 0==e?new a.Vector3(0,0,0):e,this.end=void 0==t?new a.Vector3(0,1,0):t,this.radius=void 0==r?1:r}return Object.assign(n.prototype,{clone:function(){return new n(this.start.clone(),this.end.clone(),this.radius)},set:function(e,t,r){this.start.copy(e),this.end.copy(t),this.radius=r},copy:function(e){this.start.copy(e.start),this.end.copy(e.end),this.radius=e.radius},getCenter:function(e){return e.copy(this.end).add(this.start).multiplyScalar(.5)},translate:function(e){this.start.add(e),this.end.add(e)},checkAABBAxis:function(e,t,r,n,i,o,a,s,l){return(i-e<l||i-r<l)&&(e-o<l||r-o<l)&&(a-t<l||a-n<l)&&(t-s<l||n-s<l)},intersectsBox:function(e){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,e.min.x,e.max.x,e.min.y,e.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,e.min.x,e.max.x,e.min.z,e.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,e.min.y,e.max.y,e.min.z,e.max.z,this.radius)},lineLineMinimumPoints:function(n,i){var o,a,s=e.copy(n.end).sub(n.start),l=t.copy(i.end).sub(i.start),c=r.copy(i.start).sub(n.start),u=s.dot(l),h=s.dot(s),d=l.dot(l),f=l.dot(c),p=s.dot(c),m=h*d-u*u;if(Math.abs(m)<1e-10){var g=-f/d,A=(u-f)/d;Math.abs(g-.5)<Math.abs(A-.5)?(o=0,a=g):(o=1,a=A)}else a=((o=(f*u+p*d)/m)*u-f)/d;return a=Math.max(0,Math.min(1,a)),o=Math.max(0,Math.min(1,o)),[s.multiplyScalar(o).add(n.start),l.multiplyScalar(a).add(i.start)]}}),n}(),_i={setHSV:function(e,t,r,n){return t=a.MathUtils.euclideanModulo(t,1),r=a.MathUtils.clamp(r,0,1),n=a.MathUtils.clamp(n,0,1),e.setHSL(t,r*n/((t=(2-r)*n)<1?t:2-t),.5*t)},getHSV:function(){var e={};return function(t,r){return void 0===r&&(console.warn("THREE.ColorConverter: .getHSV() target is now required"),r={h:0,s:0,l:0}),t.getHSL(e),e.s*=e.l<.5?e.l:1-e.l,r.h=e.h,r.s=2*e.s/(e.l+e.s),r.v=e.l+e.s,r}}(),setCMYK:function(e,t,r,n,i){var o=(1-t)*(1-i),a=(1-r)*(1-i),s=(1-n)*(1-i);return e.setRGB(o,a,s)},getCMYK:function(e,t){void 0===t&&(console.warn("THREE.ColorConverter: .getCMYK() target is now required"),t={c:0,m:0,y:0,k:0});var r=e.r,n=e.g,i=e.b,o=1-Math.max(r,n,i),a=(1-r-o)/(1-o),s=(1-n-o)/(1-o),l=(1-i-o)/(1-o);return t.c=a,t.m=s,t.y=l,t.k=o,t}},Fi=function(){var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(let i=0;i<256;i++)e[256+i]=e[i];function t(e){return e*e*e*(e*(6*e-15)+10)}function r(e,t,r){return t+e*(r-t)}function n(e,t,r,n){var i=15&e,o=i<8?t:r,a=i<4?r:12==i||14==i?t:n;return(0==(1&i)?o:-o)+(0==(2&i)?a:-a)}return{noise:function(i,o,a){var s=Math.floor(i),l=Math.floor(o),c=Math.floor(a),u=255&s,h=255&l,d=255&c,f=(i-=s)-1,p=(o-=l)-1,m=(a-=c)-1,g=t(i),A=t(o),v=t(a),y=e[u]+h,x=e[y]+d,b=e[y+1]+d,w=e[u+1]+h,C=e[w]+d,E=e[w+1]+d;return r(v,r(A,r(g,n(e[x],i,o,a),n(e[C],f,o,a)),r(g,n(e[b],i,p,a),n(e[E],f,p,a))),r(A,r(g,n(e[x+1],i,o,m),n(e[C+1],f,o,m)),r(g,n(e[b+1],i,p,m),n(e[E+1],f,p,m))))}}},Pi=function(){var e=new a.Vector3,t=new a.Vector3,r=new a.Plane,n=new a.Line3,i=new a.Line3,o=new a.Sphere,s=new Bi;function l(e){this.triangles=[],this.box=e,this.subTrees=[]}return Object.assign(l.prototype,{addTriangle:function(e){return this.bounds||(this.bounds=new a.Box3),this.bounds.min.x=Math.min(this.bounds.min.x,e.a.x,e.b.x,e.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,e.a.y,e.b.y,e.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,e.a.z,e.b.z,e.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,e.a.x,e.b.x,e.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,e.a.y,e.b.y,e.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,e.a.z,e.b.z,e.c.z),this.triangles.push(e),this},calcBox:function(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this},split:function(r){if(this.box){var n,i,o,s=[],c=t.copy(this.box.max).sub(this.box.min).multiplyScalar(.5);for(let t=0;t<2;t++)for(let r=0;r<2;r++)for(let o=0;o<2;o++)n=new a.Box3,i=e.set(t,r,o),n.min.copy(this.box.min).add(i.multiply(c)),n.max.copy(n.min).add(c),s.push(new l(n));for(;o=this.triangles.pop();)for(let e=0;e<s.length;e++)s[e].box.intersectsTriangle(o)&&s[e].triangles.push(o);for(let e=0;e<s.length;e++){var u=s[e].triangles.length;u>8&&r<16&&s[e].split(r+1),0!=u&&this.subTrees.push(s[e])}return this}},build:function(){return this.calcBox(),this.split(0),this},getRayTriangles:function(e,t){for(let n=0;n<this.subTrees.length;n++){var r=this.subTrees[n];if(e.intersectsBox(r.box))if(r.triangles.length>0)for(let e=0;e<r.triangles.length;e++)-1===t.indexOf(r.triangles[e])&&t.push(r.triangles[e]);else r.getRayTriangles(e,t)}return t},triangleCapsuleIntersect:function(t,o){var a,s,l,c;o.getPlane(r);var u=r.distanceToPoint(t.start)-t.radius,h=r.distanceToPoint(t.end)-t.radius;if(u>0&&h>0||u<-t.radius&&h<-t.radius)return!1;var d=Math.abs(u/(Math.abs(u)+Math.abs(h))),f=e.copy(t.start).lerp(t.end,d);if(o.containsPoint(f))return{normal:r.normal.clone(),point:f.clone(),depth:Math.abs(Math.min(u,h))};var p=t.radius*t.radius;l=n.set(t.start,t.end);var m=[[o.a,o.b],[o.b,o.c],[o.c,o.a]];for(let e=0;e<m.length;e++)if(c=i.set(m[e][0],m[e][1]),[a,s]=t.lineLineMinimumPoints(l,c),a.distanceToSquared(s)<p)return{normal:a.clone().sub(s).normalize(),point:s.clone(),depth:t.radius-a.distanceTo(s)};return!1},triangleSphereIntersect:function(i,o){if(o.getPlane(r),!i.intersectsPlane(r))return!1;var a=Math.abs(r.distanceToSphere(i)),s=i.radius*i.radius-a*a,l=r.projectPoint(i.center,e);if(o.containsPoint(i.center))return{normal:r.normal.clone(),point:l.clone(),depth:Math.abs(r.distanceToSphere(i))};var c=[[o.a,o.b],[o.b,o.c],[o.c,o.a]];for(let e=0;e<c.length;e++){n.set(c[e][0],c[e][1]),n.closestPointToPoint(l,!0,t);var u=t.distanceToSquared(i.center);if(u<s)return{normal:i.center.clone().sub(t).normalize(),point:t.clone(),depth:i.radius-Math.sqrt(u)}}return!1},getSphereTriangles:function(e,t){for(let n=0;n<this.subTrees.length;n++){var r=this.subTrees[n];if(e.intersectsBox(r.box))if(r.triangles.length>0)for(let e=0;e<r.triangles.length;e++)-1===t.indexOf(r.triangles[e])&&t.push(r.triangles[e]);else r.getSphereTriangles(e,t)}},getCapsuleTriangles:function(e,t){for(let n=0;n<this.subTrees.length;n++){var r=this.subTrees[n];if(e.intersectsBox(r.box))if(r.triangles.length>0)for(let e=0;e<r.triangles.length;e++)-1===t.indexOf(r.triangles[e])&&t.push(r.triangles[e]);else r.getCapsuleTriangles(e,t)}},sphereIntersect(e){o.copy(e);var t,r=[],n=!1;this.getSphereTriangles(e,r);for(let s=0;s<r.length;s++)(t=this.triangleSphereIntersect(o,r[s]))&&(n=!0,o.center.add(t.normal.multiplyScalar(t.depth)));if(n){var i=o.center.clone().sub(e.center),a=i.length();return{normal:i.normalize(),depth:a}}return!1},capsuleIntersect:function(t){s.copy(t);var r,n=[],i=!1;this.getCapsuleTriangles(s,n);for(let e=0;e<n.length;e++)(r=this.triangleCapsuleIntersect(s,n[e]))&&(i=!0,s.translate(r.normal.multiplyScalar(r.depth)));if(i){var o=s.getCenter(new a.Vector3).sub(t.getCenter(e)),l=o.length();return{normal:o.normalize(),depth:l}}return!1},rayIntersect:function(t){if(0!==t.direction.length()){var r,n,i,o=[],a=1e100;this.getRayTriangles(t,o);for(let l=0;l<o.length;l++)if(i=t.intersectTriangle(o[l].a,o[l].b,o[l].c,!0,e)){var s=i.sub(t.origin).length();a>s&&(n=i.clone().add(t.origin),a=s,r=o[l])}return a<1e100&&{distance:a,triangle:r,position:n}}},fromGraphNode:function(e){return e.traverse((e=>{if("Mesh"===e.type){e.updateMatrix(),e.updateWorldMatrix();var t,r=!1;e.geometry.index?(r=!0,t=e.geometry.clone().toNonIndexed()):t=e.geometry;var n=t.attributes.position.array,i=e.matrixWorld;for(let e=0;e<n.length;e+=9){var o=new a.Vector3(n[e],n[e+1],n[e+2]),s=new a.Vector3(n[e+3],n[e+4],n[e+5]),l=new a.Vector3(n[e+6],n[e+7],n[e+8]);o.applyMatrix4(i),s.applyMatrix4(i),l.applyMatrix4(i),this.addTriangle(new a.Triangle(o,s,l))}r&&t.dispose()}})),this.build(),this}}),l}(),Ri=function(e,t){return this.lut=[],this.setColorMap(e,t),this};Ri.prototype={constructor:Ri,lut:[],map:[],n:256,minV:0,maxV:1,set:function(e){return e instanceof Ri&&this.copy(e),this},setMin:function(e){return this.minV=e,this},setMax:function(e){return this.maxV=e,this},setColorMap:function(e,t){this.map=Li[e]||Li.rainbow,this.n=t||32;var r=1/this.n;this.lut.length=0;for(let c=0;c<=1;c+=r)for(let e=0;e<this.map.length-1;e++)if(c>=this.map[e][0]&&c<this.map[e+1][0]){var n=this.map[e][0],i=this.map[e+1][0],o=new a.Color(this.map[e][1]),s=new a.Color(this.map[e+1][1]),l=o.lerp(s,(c-n)/(i-n));this.lut.push(l)}return this},copy:function(e){return this.lut=e.lut,this.map=e.map,this.n=e.n,this.minV=e.minV,this.maxV=e.maxV,this},getColor:function(e){e<=this.minV?e=this.minV:e>=this.maxV&&(e=this.maxV),e=(e-this.minV)/(this.maxV-this.minV);var t=Math.round(e*this.n);return t==this.n&&(t-=1),this.lut[t]},addColorMap:function(e,t){Li[e]=t},createCanvas:function(){var e=document.createElement("canvas");return e.width=1,e.height=this.n,this.updateCanvas(e),e},updateCanvas:function(e){var t=e.getContext("2d",{alpha:!1}),r=t.getImageData(0,0,1,this.n),n=r.data,i=0,o=1/this.n;for(let d=1;d>=0;d-=o)for(let e=this.map.length-1;e>=0;e--)if(d<this.map[e][0]&&d>=this.map[e-1][0]){var s=this.map[e-1][0],l=this.map[e][0],c=new a.Color(this.map[e-1][1]),u=new a.Color(this.map[e][1]),h=c.lerp(u,(d-s)/(l-s));n[4*i]=Math.round(255*h.r),n[4*i+1]=Math.round(255*h.g),n[4*i+2]=Math.round(255*h.b),n[4*i+3]=255,i+=1}return t.putImageData(r,0,0),e}};var Li={rainbow:[[0,255],[.2,65535],[.5,65280],[.8,16776960],[1,16711680]],cooltowarm:[[0,3952322],[.2,10206463],[.5,14474460],[.8,16163717],[1,11797542]],blackbody:[[0,0],[.2,7864320],[.5,15086080],[.8,16776960],[1,16777215]],grayscale:[[0,0],[.2,4210752],[.5,8355712],[.8,12566463],[1,16777215]]};let Di;!function(e){e[e.NONE=-1]="NONE",e[e.ROTATE=0]="ROTATE",e[e.DOLLY=1]="DOLLY",e[e.PAN=2]="PAN",e[e.TOUCH_ROTATE=3]="TOUCH_ROTATE",e[e.TOUCH_PAN=4]="TOUCH_PAN",e[e.TOUCH_DOLLY_PAN=5]="TOUCH_DOLLY_PAN",e[e.TOUCH_DOLLY_ROTATE=6]="TOUCH_DOLLY_ROTATE"}(Di||(Di={}));class Ni extends a.EventDispatcher{constructor(e,t){super(),(0,Qe.Z)(this,"object",void 0),(0,Qe.Z)(this,"domElement",void 0),(0,Qe.Z)(this,"enabled",!0),(0,Qe.Z)(this,"target",new a.Vector3),(0,Qe.Z)(this,"trackball",!1),(0,Qe.Z)(this,"minDistance",0),(0,Qe.Z)(this,"maxDistance",1/0),(0,Qe.Z)(this,"minZoom",0),(0,Qe.Z)(this,"maxZoom",1/0),(0,Qe.Z)(this,"minPolarAngle",0),(0,Qe.Z)(this,"maxPolarAngle",Math.PI),(0,Qe.Z)(this,"minAzimuthAngle",-1/0),(0,Qe.Z)(this,"maxAzimuthAngle",1/0),(0,Qe.Z)(this,"enableDamping",!1),(0,Qe.Z)(this,"dampingFactor",.05),(0,Qe.Z)(this,"enableZoom",!0),(0,Qe.Z)(this,"zoomSpeed",1),(0,Qe.Z)(this,"enableRotate",!0),(0,Qe.Z)(this,"rotateSpeed",1),(0,Qe.Z)(this,"enablePan",!0),(0,Qe.Z)(this,"panSpeed",1),(0,Qe.Z)(this,"screenSpacePanning",!1),(0,Qe.Z)(this,"keyPanSpeed",7),(0,Qe.Z)(this,"autoRotate",!1),(0,Qe.Z)(this,"autoRotateSpeed",2),(0,Qe.Z)(this,"enableKeys",!0),(0,Qe.Z)(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),(0,Qe.Z)(this,"mouseButtons",void 0),(0,Qe.Z)(this,"touches",{ONE:a.TOUCH.ROTATE,TWO:a.TOUCH.DOLLY_PAN}),(0,Qe.Z)(this,"target0",void 0),(0,Qe.Z)(this,"position0",void 0),(0,Qe.Z)(this,"quaternion0",void 0),(0,Qe.Z)(this,"zoom0",void 0),(0,Qe.Z)(this,"spherical",new a.Spherical),(0,Qe.Z)(this,"sphericalDelta",new a.Spherical),(0,Qe.Z)(this,"changeEvent",{type:"change"}),(0,Qe.Z)(this,"startEvent",{type:"start"}),(0,Qe.Z)(this,"endEvent",{type:"end"}),(0,Qe.Z)(this,"state",Di.NONE),(0,Qe.Z)(this,"EPS",1e-6),(0,Qe.Z)(this,"scale",1),(0,Qe.Z)(this,"panOffset",new a.Vector3),(0,Qe.Z)(this,"zoomChanged",!1),(0,Qe.Z)(this,"rotateStart",new a.Vector2),(0,Qe.Z)(this,"rotateEnd",new a.Vector2),(0,Qe.Z)(this,"rotateDelta",new a.Vector2),(0,Qe.Z)(this,"panStart",new a.Vector2),(0,Qe.Z)(this,"panEnd",new a.Vector2),(0,Qe.Z)(this,"panDelta",new a.Vector2),(0,Qe.Z)(this,"dollyStart",new a.Vector2),(0,Qe.Z)(this,"dollyEnd",new a.Vector2),(0,Qe.Z)(this,"dollyDelta",new a.Vector2),(0,Qe.Z)(this,"offset",new a.Vector3),(0,Qe.Z)(this,"lastPosition",new a.Vector3),(0,Qe.Z)(this,"lastQuaternion",new a.Quaternion),(0,Qe.Z)(this,"q",new a.Quaternion),(0,Qe.Z)(this,"v",new a.Vector3),(0,Qe.Z)(this,"vec",new a.Vector3),(0,Qe.Z)(this,"quat",void 0),(0,Qe.Z)(this,"quatInverse",void 0),(0,Qe.Z)(this,"getPolarAngle",(()=>this.spherical.phi)),(0,Qe.Z)(this,"getAzimuthalAngle",(()=>this.spherical.theta)),(0,Qe.Z)(this,"saveState",(()=>{this.target0.copy(this.target),this.position0.copy(this.object.position),this.quaternion0.copy(this.object.quaternion),this.zoom0=this.object.zoom})),(0,Qe.Z)(this,"reset",(()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.quaternion.copy(this.quaternion0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(this.changeEvent),this.update(),this.state=Di.NONE})),(0,Qe.Z)(this,"dispose",(()=>{this.domElement.removeEventListener("contextmenu",this.onContextMenu,!1),this.domElement.removeEventListener("mousedown",this.onMouseDown,!1),this.domElement.removeEventListener("wheel",this.onMouseWheel,!1),this.domElement.removeEventListener("touchstart",this.onTouchStart,!1),this.domElement.removeEventListener("touchend",this.onTouchEnd,!1),this.domElement.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),this.domElement.removeEventListener("keydown",this.onKeyDown,!1)})),(0,Qe.Z)(this,"update",(()=>{const e=this.object.position;if(this.offset.copy(e).sub(this.target),this.trackball){if(this.sphericalDelta.theta){this.vec.set(0,1,0).applyQuaternion(this.object.quaternion);const e=this.enableDamping?this.dampingFactor:1;this.q.setFromAxisAngle(this.vec,this.sphericalDelta.theta*e),this.object.quaternion.premultiply(this.q),this.offset.applyQuaternion(this.q)}if(this.sphericalDelta.phi){this.vec.set(1,0,0).applyQuaternion(this.object.quaternion);const e=this.enableDamping?this.dampingFactor:1;this.q.setFromAxisAngle(this.vec,this.sphericalDelta.phi*e),this.object.quaternion.premultiply(this.q),this.offset.applyQuaternion(this.q)}this.offset.multiplyScalar(this.scale),this.offset.clampLength(this.minDistance,this.maxDistance)}else this.offset.applyQuaternion(this.quat),this.autoRotate&&this.state===Di.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.setFromVector3(this.offset),this.enableDamping?(this.spherical.theta+=this.sphericalDelta.theta*this.dampingFactor,this.spherical.phi+=this.sphericalDelta.phi*this.dampingFactor):(this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi),this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.offset.setFromSpherical(this.spherical),this.offset.applyQuaternion(this.quatInverse);return!0===this.enableDamping?this.target.addScaledVector(this.panOffset,this.dampingFactor):this.target.add(this.panOffset),e.copy(this.target).add(this.offset),!1===this.trackball&&this.object.lookAt(this.target),!0===this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor,this.panOffset.multiplyScalar(1-this.dampingFactor)):(this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0)),this.scale=1,!!(this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)})),(0,Qe.Z)(this,"getAutoRotationAngle",(()=>2*Math.PI/60/60*this.autoRotateSpeed)),(0,Qe.Z)(this,"getZoomScale",(()=>Math.pow(.95,this.zoomSpeed))),(0,Qe.Z)(this,"rotateLeft",(e=>{this.sphericalDelta.theta-=e})),(0,Qe.Z)(this,"rotateUp",(e=>{this.sphericalDelta.phi-=e})),(0,Qe.Z)(this,"panLeft",((e,t)=>{this.v.setFromMatrixColumn(t,0),this.v.multiplyScalar(-e),this.panOffset.add(this.v)})),(0,Qe.Z)(this,"panUp",((e,t)=>{!0===this.screenSpacePanning?this.v.setFromMatrixColumn(t,1):(this.v.setFromMatrixColumn(t,0),this.v.crossVectors(this.object.up,this.v)),this.v.multiplyScalar(e),this.panOffset.add(this.v)})),(0,Qe.Z)(this,"pan",((e,t)=>{const r=this.domElement;if(this.object instanceof a.PerspectiveCamera){const n=this.object.position;this.offset.copy(n).sub(this.target);let i=this.offset.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*i/r.clientHeight,this.object.matrix),this.panUp(2*t*i/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: CameraControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)})),(0,Qe.Z)(this,"dollyIn",(e=>{this.object instanceof a.PerspectiveCamera?this.scale/=e:this.object instanceof a.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),this.object.updateProjectionMatrix(),this.zoomChanged=!0):(console.warn("WARNING: CameraControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)})),(0,Qe.Z)(this,"dollyOut",(e=>{this.object instanceof a.PerspectiveCamera?this.scale*=e:this.object instanceof a.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),this.object.updateProjectionMatrix(),this.zoomChanged=!0):(console.warn("WARNING: CameraControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)})),(0,Qe.Z)(this,"handleMouseDownRotate",(e=>{this.rotateStart.set(e.clientX,e.clientY)})),(0,Qe.Z)(this,"handleMouseDownDolly",(e=>{this.dollyStart.set(e.clientX,e.clientY)})),(0,Qe.Z)(this,"handleMouseDownPan",(e=>{this.panStart.set(e.clientX,e.clientY)})),(0,Qe.Z)(this,"handleMouseMoveRotate",(e=>{this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight),this.rotateStart.copy(this.rotateEnd),this.update()})),(0,Qe.Z)(this,"handleMouseMoveDolly",(e=>{this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyIn(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyOut(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()})),(0,Qe.Z)(this,"handleMouseMovePan",(e=>{this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.update()})),(0,Qe.Z)(this,"handleMouseWheel",(e=>{e.deltaY<0?this.dollyOut(this.getZoomScale()):e.deltaY>0&&this.dollyIn(this.getZoomScale()),this.update()})),(0,Qe.Z)(this,"handleKeyDown",(e=>{let t=!1;switch(e.code){case this.keys.UP:this.pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:this.pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:this.pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:this.pan(-this.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),this.update())})),(0,Qe.Z)(this,"handleTouchStartRotate",(e=>{if(1==e.touches.length)this.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);this.rotateStart.set(t,r)}})),(0,Qe.Z)(this,"handleTouchStartPan",(e=>{if(1==e.touches.length)this.panStart.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);this.panStart.set(t,r)}})),(0,Qe.Z)(this,"handleTouchStartDolly",(e=>{const t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);this.dollyStart.set(0,n)})),(0,Qe.Z)(this,"handleTouchStartDollyPan",(e=>{this.enableZoom&&this.handleTouchStartDolly(e),this.enablePan&&this.handleTouchStartPan(e)})),(0,Qe.Z)(this,"handleTouchStartDollyRotate",(e=>{this.enableZoom&&this.handleTouchStartDolly(e),this.enableRotate&&this.handleTouchStartRotate(e)})),(0,Qe.Z)(this,"handleTouchMoveRotate",(e=>{if(1==e.touches.length)this.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);this.rotateEnd.set(t,r)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight),this.rotateStart.copy(this.rotateEnd)})),(0,Qe.Z)(this,"handleTouchMovePan",(e=>{if(1==e.touches.length)this.panEnd.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);this.panEnd.set(t,r)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)})),(0,Qe.Z)(this,"handleTouchMoveDolly",(e=>{const t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyIn(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)})),(0,Qe.Z)(this,"handleTouchMoveDollyPan",(e=>{this.enableZoom&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)})),(0,Qe.Z)(this,"handleTouchMoveDollyRotate",(e=>{this.enableZoom&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)})),(0,Qe.Z)(this,"onMouseDown",(e=>{if(!1===this.enabled)return;let t;switch(e.preventDefault(),this.domElement.focus?this.domElement.focus():window.focus(),e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case a.MOUSE.DOLLY:if(!1===this.enableZoom)return;this.handleMouseDownDolly(e),this.state=Di.DOLLY;break;case a.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=Di.PAN}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=Di.ROTATE}break;case a.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=Di.ROTATE}else{if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=Di.PAN}break;default:this.state=Di.NONE}this.state!==Di.NONE&&(document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mouseup",this.onMouseUp,!1),this.dispatchEvent(this.startEvent))})),(0,Qe.Z)(this,"onMouseMove",(e=>{if(!1!==this.enabled)switch(e.preventDefault(),this.state){case Di.ROTATE:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(e);break;case Di.DOLLY:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(e);break;case Di.PAN:if(!1===this.enablePan)return;this.handleMouseMovePan(e)}})),(0,Qe.Z)(this,"onMouseUp",(()=>{!1!==this.enabled&&(document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),this.dispatchEvent(this.endEvent),this.state=Di.NONE)})),(0,Qe.Z)(this,"onMouseWheel",(e=>{!1===this.enabled||!1===this.enableZoom||this.state!==Di.NONE&&this.state!==Di.ROTATE||(e.preventDefault(),this.dispatchEvent(this.startEvent),this.handleMouseWheel(e),this.dispatchEvent(this.endEvent))})),(0,Qe.Z)(this,"onKeyDown",(e=>{!1!==this.enabled&&!1!==this.enableKeys&&!1!==this.enablePan&&this.handleKeyDown(e)})),(0,Qe.Z)(this,"onTouchStart",(e=>{if(!1!==this.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(this.touches.ONE){case a.TOUCH.ROTATE:if(!1===this.enableRotate)return;this.handleTouchStartRotate(e),this.state=Di.TOUCH_ROTATE;break;case a.TOUCH.PAN:if(!1===this.enablePan)return;this.handleTouchStartPan(e),this.state=Di.TOUCH_PAN;break;default:this.state=Di.NONE}break;case 2:switch(this.touches.TWO){case a.TOUCH.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchStartDollyPan(e),this.state=Di.TOUCH_DOLLY_PAN;break;case a.TOUCH.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchStartDollyRotate(e),this.state=Di.TOUCH_DOLLY_ROTATE;break;default:this.state=Di.NONE}break;default:this.state=Di.NONE}this.state!==Di.NONE&&this.dispatchEvent(this.startEvent)}})),(0,Qe.Z)(this,"onTouchMove",(e=>{if(!1!==this.enabled)switch(e.preventDefault(),this.state){case Di.TOUCH_ROTATE:if(!1===this.enableRotate)return;this.handleTouchMoveRotate(e),this.update();break;case Di.TOUCH_PAN:if(!1===this.enablePan)return;this.handleTouchMovePan(e),this.update();break;case Di.TOUCH_DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchMoveDollyPan(e),this.update();break;case Di.TOUCH_DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchMoveDollyRotate(e),this.update();break;default:this.state=Di.NONE}})),(0,Qe.Z)(this,"onTouchEnd",(()=>{!1!==this.enabled&&(this.dispatchEvent(this.endEvent),this.state=Di.NONE)})),(0,Qe.Z)(this,"onContextMenu",(e=>{!1!==this.enabled&&e.preventDefault()})),void 0===t&&console.warn('THREE.CameraControls: The second parameter "domElement" is now mandatory.'),t instanceof Document&&console.error('THREE.CameraControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.mouseButtons={LEFT:a.MOUSE.ROTATE,MIDDLE:a.MOUSE.DOLLY,RIGHT:a.MOUSE.PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.quaternion0=this.object.quaternion.clone(),this.zoom0=this.object.zoom,this.quat=(new a.Quaternion).setFromUnitVectors(this.object.up,new a.Vector3(0,1,0)),this.quatInverse=this.quat.clone().invert(),this.lastPosition=new a.Vector3,this.lastQuaternion=new a.Quaternion,this.domElement.addEventListener("contextmenu",this.onContextMenu,!1),this.domElement.addEventListener("mousedown",this.onMouseDown,!1),this.domElement.addEventListener("wheel",this.onMouseWheel,!1),this.domElement.addEventListener("touchstart",this.onTouchStart,!1),this.domElement.addEventListener("touchend",this.onTouchEnd,!1),this.domElement.addEventListener("touchmove",this.onTouchMove,!1),this.domElement.addEventListener("keydown",this.onKeyDown,!1),-1===this.domElement.tabIndex&&(this.domElement.tabIndex=0),this.object.lookAt(this.target),this.update(),this.saveState()}handleMouseUp(){}handleTouchEnd(){}}class ki extends Ni{constructor(e,t){super(e,t),(0,Qe.Z)(this,"mouseButtons",void 0),(0,Qe.Z)(this,"touches",void 0),this.mouseButtons={LEFT:a.MOUSE.ROTATE,RIGHT:a.MOUSE.PAN},this.touches={ONE:a.TOUCH.ROTATE,TWO:a.TOUCH.DOLLY_PAN}}}class Oi extends Ni{constructor(e,t){super(e,t),(0,Qe.Z)(this,"mouseButtons",void 0),(0,Qe.Z)(this,"touches",void 0),this.mouseButtons={LEFT:a.MOUSE.PAN,RIGHT:a.MOUSE.ROTATE},this.touches={ONE:a.TOUCH.PAN,TWO:a.TOUCH.DOLLY_ROTATE}}}class Ui extends Ni{constructor(e,t){super(e,t),(0,Qe.Z)(this,"trackball",void 0),(0,Qe.Z)(this,"screenSpacePanning",void 0),(0,Qe.Z)(this,"autoRotate",void 0),(0,Qe.Z)(this,"mouseButtons",void 0),(0,Qe.Z)(this,"touches",void 0),this.trackball=!0,this.screenSpacePanning=!0,this.autoRotate=!1,this.mouseButtons={LEFT:a.MOUSE.ROTATE,RIGHT:a.MOUSE.PAN},this.touches={ONE:a.TOUCH.ROTATE,TWO:a.TOUCH.DOLLY_PAN}}}var Qi=r(4466),Vi=r(7642);class Gi extends a.EventDispatcher{constructor(e,t,r){super(),(0,Qe.Z)(this,"enabled",!0),(0,Qe.Z)(this,"transformGroup",!1),(0,Qe.Z)(this,"_objects",void 0),(0,Qe.Z)(this,"_camera",void 0),(0,Qe.Z)(this,"_domElement",void 0),(0,Qe.Z)(this,"_plane",new a.Plane),(0,Qe.Z)(this,"_raycaster",new a.Raycaster),(0,Qe.Z)(this,"_mouse",new a.Vector2),(0,Qe.Z)(this,"_offset",new a.Vector3),(0,Qe.Z)(this,"_intersection",new a.Vector3),(0,Qe.Z)(this,"_worldPosition",new a.Vector3),(0,Qe.Z)(this,"_inverseMatrix",new a.Matrix4),(0,Qe.Z)(this,"_intersections",[]),(0,Qe.Z)(this,"_selected",null),(0,Qe.Z)(this,"_hovered",null),(0,Qe.Z)(this,"activate",(()=>{this._domElement.addEventListener("pointermove",this.onPointerMove),this._domElement.addEventListener("pointerdown",this.onPointerDown),this._domElement.addEventListener("pointerup",this.onPointerCancel),this._domElement.addEventListener("pointerleave",this.onPointerCancel),this._domElement.addEventListener("touchmove",this.onTouchMove),this._domElement.addEventListener("touchstart",this.onTouchStart),this._domElement.addEventListener("touchend",this.onTouchEnd)})),(0,Qe.Z)(this,"deactivate",(()=>{this._domElement.removeEventListener("pointermove",this.onPointerMove),this._domElement.removeEventListener("pointerdown",this.onPointerDown),this._domElement.removeEventListener("pointerup",this.onPointerCancel),this._domElement.removeEventListener("pointerleave",this.onPointerCancel),this._domElement.removeEventListener("touchmove",this.onTouchMove),this._domElement.removeEventListener("touchstart",this.onTouchStart),this._domElement.removeEventListener("touchend",this.onTouchEnd),this._domElement.style.cursor=""})),(0,Qe.Z)(this,"dispose",(()=>this.deactivate())),(0,Qe.Z)(this,"getObjects",(()=>this._objects)),(0,Qe.Z)(this,"onMouseMove",(e=>{const t=this._domElement.getBoundingClientRect();if(this._mouse.x=(e.clientX-t.left)/t.width*2-1,this._mouse.y=-(e.clientY-t.top)/t.height*2+1,this._raycaster.setFromCamera(this._mouse,this._camera),this._selected&&this.enabled)return this._raycaster.ray.intersectPlane(this._plane,this._intersection)&&this._selected.position.copy(this._intersection.sub(this._offset).applyMatrix4(this._inverseMatrix)),void this.dispatchEvent({type:"drag",object:this._selected});if(this._intersections.length=0,this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.intersectObjects(this._objects,!0,this._intersections),this._intersections.length>0){const e=this._intersections[0].object;this._plane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._plane.normal),this._worldPosition.setFromMatrixPosition(e.matrixWorld)),this._hovered!==e&&(this.dispatchEvent({type:"hoveron",object:e}),this._domElement.style.cursor="pointer",this._hovered=e)}else null!==this._hovered&&(this.dispatchEvent({type:"hoveroff",object:this._hovered}),this._domElement.style.cursor="auto",this._hovered=null)})),(0,Qe.Z)(this,"onMouseDown",(()=>{this._intersections.length=0,this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.intersectObjects(this._objects,!0,this._intersections),this._intersections.length>0&&(this._selected=!0===this.transformGroup?this._objects[0]:this._intersections[0].object,this._raycaster.ray.intersectPlane(this._plane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._offset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))),this._domElement.style.cursor="move",this.dispatchEvent({type:"dragstart",object:this._selected}))})),(0,Qe.Z)(this,"onMouseCancel",(()=>{this._selected&&(this.dispatchEvent({type:"dragend",object:this._selected}),this._selected=null),this._domElement.style.cursor=this._hovered?"pointer":"auto"})),(0,Qe.Z)(this,"onPointerMove",(e=>{switch(e.pointerType){case"mouse":case"pen":this.onMouseMove(e)}})),(0,Qe.Z)(this,"onPointerDown",(e=>{switch(e.pointerType){case"mouse":case"pen":this.onMouseDown()}})),(0,Qe.Z)(this,"onPointerCancel",(e=>{switch(e.pointerType){case"mouse":case"pen":this.onMouseCancel()}})),(0,Qe.Z)(this,"onTouchMove",(e=>{e.preventDefault();const t=e.changedTouches[0],r=this._domElement.getBoundingClientRect();if(this._mouse.x=(t.clientX-r.left)/r.width*2-1,this._mouse.y=-(t.clientY-r.top)/r.height*2+1,this._raycaster.setFromCamera(this._mouse,this._camera),this._selected&&this.enabled)return this._raycaster.ray.intersectPlane(this._plane,this._intersection)&&this._selected.position.copy(this._intersection.sub(this._offset).applyMatrix4(this._inverseMatrix)),void this.dispatchEvent({type:"drag",object:this._selected})})),(0,Qe.Z)(this,"onTouchStart",(e=>{e.preventDefault();const t=e.changedTouches[0],r=this._domElement.getBoundingClientRect();this._mouse.x=(t.clientX-r.left)/r.width*2-1,this._mouse.y=-(t.clientY-r.top)/r.height*2+1,this._intersections.length=0,this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.intersectObjects(this._objects,!0,this._intersections),this._intersections.length>0&&(this._selected=!0===this.transformGroup?this._objects[0]:this._intersections[0].object,this._plane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._plane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._plane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._offset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))),this._domElement.style.cursor="move",this.dispatchEvent({type:"dragstart",object:this._selected}))})),(0,Qe.Z)(this,"onTouchEnd",(e=>{e.preventDefault(),this._selected&&(this.dispatchEvent({type:"dragend",object:this._selected}),this._selected=null),this._domElement.style.cursor="auto"})),this._objects=e,this._camera=t,this._domElement=r,this.activate()}}var zi=r(7827),ji=r(8096),Hi=r(9097),Wi=r(9649),Zi=r(394),Xi=r(142);const Yi={defines:{USE_3DTEXTURE:1},uniforms:{lut3d:{value:null},lut:{value:null},lutSize:{value:0},tDiffuse:{value:null},intensity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}\n\n\t",fragmentShader:"\n\t\tprecision highp sampler3D;\n\n\t\tuniform float lutSize;\n\t\t#if USE_3DTEXTURE\n\t\tuniform sampler3D lut3d;\n\t\t#else\n\t\tuniform sampler2D lut;\n\n\t\tvec3 lutLookup( sampler2D tex, float size, vec3 rgb ) {\n\n\t\t\tfloat sliceHeight = 1.0 / size;\n\t\t\tfloat yPixelHeight = 1.0 / ( size * size );\n\n\t\t\t// Get the slices on either side of the sample\n\t\t\tfloat slice = rgb.b * size;\n\t\t\tfloat interp = fract( slice );\n\t\t\tfloat slice0 = slice - interp;\n\t\t\tfloat centeredInterp = interp - 0.5;\n\n\t\t\tfloat slice1 = slice0 + sign( centeredInterp );\n\n\t\t\t// Pull y sample in by half a pixel in each direction to avoid color\n\t\t\t// bleeding from adjacent slices.\n\t\t\tfloat greenOffset = clamp( rgb.g * sliceHeight, yPixelHeight * 0.5, sliceHeight - yPixelHeight * 0.5 );\n\n\t\t\tvec2 uv0 = vec2(\n\t\t\t\trgb.r,\n\t\t\t\tslice0 * sliceHeight + greenOffset\n\t\t\t);\n\t\t\tvec2 uv1 = vec2(\n\t\t\t\trgb.r,\n\t\t\t\tslice1 * sliceHeight + greenOffset\n\t\t\t);\n\n\t\t\tvec3 sample0 = texture2D( tex, uv0 ).rgb;\n\t\t\tvec3 sample1 = texture2D( tex, uv1 ).rgb;\n\n\t\t\treturn mix( sample0, sample1, abs( centeredInterp ) );\n\n\t\t}\n\t\t#endif\n\n\t\tvarying vec2 vUv;\n\t\tuniform float intensity;\n\t\tuniform sampler2D tDiffuse;\n\t\tvoid main() {\n\n\t\t\tvec4 val = texture2D( tDiffuse, vUv );\n\t\t\tvec4 lutVal;\n\n\t\t\t// pull the sample in by half a pixel so the sample begins\n\t\t\t// at the center of the edge pixels.\n\t\t\tfloat pixelWidth = 1.0 / lutSize;\n\t\t\tfloat halfPixelWidth = 0.5 / lutSize;\n\t\t\tvec3 uvw = vec3( halfPixelWidth ) + val.rgb * ( 1.0 - pixelWidth );\n\n\t\t\t#if USE_3DTEXTURE\n\n\t\t\tlutVal = vec4( texture( lut3d, uvw ).rgb, val.a );\n\n\t\t\t#else\n\n\t\t\tlutVal = vec4( lutLookup( lut, lutSize, uvw ), val.a );\n\n\t\t\t#endif\n\n\t\t\tgl_FragColor = vec4( mix( val, lutVal, intensity ) );\n\n\t\t}\n\n\t"};class Ji extends Sr.T{set lut(e){const t=this.material;if(e!==this.lut&&(t.uniforms.lut3d.value=null,t.uniforms.lut.value=null,e)){const r=e.isDataTexture3D?1:0;r!==t.defines.USE_3DTEXTURE&&(t.defines.USE_3DTEXTURE=r,t.needsUpdate=!0),t.uniforms.lutSize.value=e.image.width,e.isDataTexture3D?t.uniforms.lut3d.value=e:t.uniforms.lut.value=e}}get lut(){return this.material.uniforms.lut.value||this.material.uniforms.lut3d.value}set intensity(e){this.material.uniforms.intensity.value=e}get intensity(){return this.material.uniforms.intensity.value}constructor(e={}){super(Yi),this.lut=e.lut||null,this.intensity="intensity"in e?e.intensity:1}}var qi=r(1901),Ki=function(e,t){this.needsSwap=!1,this.clearColor=void 0!==e?e:0,this.clearAlpha=void 0!==t?t:0,this._oldClearColor=new a.Color};Ki.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:Ki,render:function(e,t,r){var n;this.clearColor&&(e.getClearColor(this._oldClearColor),n=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.setRenderTarget(this.renderToScreen?null:r),e.clear(),this.clearColor&&e.setClearColor(this._oldClearColor,n)}});var $i={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","\tif(byp<1) {","\t\tvec2 p = vUv;","\t\tfloat xs = floor(gl_FragCoord.x / 0.5);","\t\tfloat ys = floor(gl_FragCoord.y / 0.5);","\t\tvec4 normal = texture2D (tDisp, p*seed*seed);","\t\tif(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","\t\t\tif(seed_x>0.){","\t\t\t\tp.y = 1. - (p.y + distortion_y);","\t\t\t}","\t\t\telse {","\t\t\t\tp.y = distortion_y;","\t\t\t}","\t\t}","\t\tif(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","\t\t\tif(seed_y>0.){","\t\t\t\tp.x=distortion_x;","\t\t\t}","\t\t\telse {","\t\t\t\tp.x = 1. - (p.x + distortion_x);","\t\t\t}","\t\t}","\t\tp.x+=normal.x*seed_x*(seed/5.);","\t\tp.y+=normal.y*seed_y*(seed/5.);","\t\tvec2 offset = amount * vec2( cos(angle), sin(angle));","\t\tvec4 cr = texture2D(tDiffuse, p + offset);","\t\tvec4 cga = texture2D(tDiffuse, p);","\t\tvec4 cb = texture2D(tDiffuse, p - offset);","\t\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","\t\tvec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","\t\tgl_FragColor = gl_FragColor+ snow;","\t}","\telse {","\t\tgl_FragColor=texture2D (tDiffuse, vUv);","\t}","}"].join("\n")};class eo extends qi.w{constructor(e=64){super(),void 0===$i&&console.error("THREE.GlitchPass relies on DigitalGlitch");const t=$i;this.uniforms=a.UniformsUtils.clone(t.uniforms),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new a.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new qi.T(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()}render(e,t,r){!1===e.capabilities.isWebGL2&&(this.uniforms.tDisp.value.format=a.LuminanceFormat),this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=a.MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=a.MathUtils.randFloat(-1,1),this.uniforms.seed_y.value=a.MathUtils.randFloat(-1,1),this.uniforms.distortion_x.value=a.MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=a.MathUtils.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=a.MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=a.MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=a.MathUtils.randFloat(0,1),this.uniforms.seed_x.value=a.MathUtils.randFloat(-.3,.3),this.uniforms.seed_y.value=a.MathUtils.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}generateTrigger(){this.randX=a.MathUtils.randInt(120,240)}generateHeightmap(e){const t=new Float32Array(e*e),r=e*e;for(let i=0;i<r;i++){const e=a.MathUtils.randFloat(0,1);t[i]=e}const n=new a.DataTexture(t,e,e,a.RedFormat,a.FloatType);return n.needsUpdate=!0,n}}var to={uniforms:{tDiffuse:{value:null},shape:{value:1},radius:{value:4},rotateR:{value:Math.PI/12*1},rotateG:{value:Math.PI/12*2},rotateB:{value:Math.PI/12*3},scatter:{value:0},width:{value:1},height:{value:1},blending:{value:1},blendingMode:{value:1},greyscale:{value:!1},disable:{value:!1}},vertexShader:["varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["#define SQRT2_MINUS_ONE 0.41421356","#define SQRT2_HALF_MINUS_ONE 0.20710678","#define PI2 6.28318531","#define SHAPE_DOT 1","#define SHAPE_ELLIPSE 2","#define SHAPE_LINE 3","#define SHAPE_SQUARE 4","#define BLENDING_LINEAR 1","#define BLENDING_MULTIPLY 2","#define BLENDING_ADD 3","#define BLENDING_LIGHTER 4","#define BLENDING_DARKER 5","uniform sampler2D tDiffuse;","uniform float radius;","uniform float rotateR;","uniform float rotateG;","uniform float rotateB;","uniform float scatter;","uniform float width;","uniform float height;","uniform int shape;","uniform bool disable;","uniform float blending;","uniform int blendingMode;","varying vec2 vUV;","uniform bool greyscale;","const int samples = 8;","float blend( float a, float b, float t ) {","\treturn a * ( 1.0 - t ) + b * t;","}","float hypot( float x, float y ) {","\treturn sqrt( x * x + y * y );","}","float rand( vec2 seed ){","return fract( sin( dot( seed.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );","}","float distanceToDotRadius( float channel, vec2 coord, vec2 normal, vec2 p, float angle, float rad_max ) {","\tfloat dist = hypot( coord.x - p.x, coord.y - p.y );","\tfloat rad = channel;","\tif ( shape == SHAPE_DOT ) {","\t\trad = pow( abs( rad ), 1.125 ) * rad_max;","\t} else if ( shape == SHAPE_ELLIPSE ) {","\t\trad = pow( abs( rad ), 1.125 ) * rad_max;","\t\tif ( dist != 0.0 ) {","\t\t\tfloat dot_p = abs( ( p.x - coord.x ) / dist * normal.x + ( p.y - coord.y ) / dist * normal.y );","\t\t\tdist = ( dist * ( 1.0 - SQRT2_HALF_MINUS_ONE ) ) + dot_p * dist * SQRT2_MINUS_ONE;","\t\t}","\t} else if ( shape == SHAPE_LINE ) {","\t\trad = pow( abs( rad ), 1.5) * rad_max;","\t\tfloat dot_p = ( p.x - coord.x ) * normal.x + ( p.y - coord.y ) * normal.y;","\t\tdist = hypot( normal.x * dot_p, normal.y * dot_p );","\t} else if ( shape == SHAPE_SQUARE ) {","\t\tfloat theta = atan( p.y - coord.y, p.x - coord.x ) - angle;","\t\tfloat sin_t = abs( sin( theta ) );","\t\tfloat cos_t = abs( cos( theta ) );","\t\trad = pow( abs( rad ), 1.4 );","\t\trad = rad_max * ( rad + ( ( sin_t > cos_t ) ? rad - sin_t * rad : rad - cos_t * rad ) );","\t}","\treturn rad - dist;","}","struct Cell {","\tvec2 normal;","\tvec2 p1;","\tvec2 p2;","\tvec2 p3;","\tvec2 p4;","\tfloat samp2;","\tfloat samp1;","\tfloat samp3;","\tfloat samp4;","};","vec4 getSample( vec2 point ) {","\tvec4 tex = texture2D( tDiffuse, vec2( point.x / width, point.y / height ) );","\tfloat base = rand( vec2( floor( point.x ), floor( point.y ) ) ) * PI2;","\tfloat step = PI2 / float( samples );","\tfloat dist = radius * 0.66;","\tfor ( int i = 0; i < samples; ++i ) {","\t\tfloat r = base + step * float( i );","\t\tvec2 coord = point + vec2( cos( r ) * dist, sin( r ) * dist );","\t\ttex += texture2D( tDiffuse, vec2( coord.x / width, coord.y / height ) );","\t}","\ttex /= float( samples ) + 1.0;","\treturn tex;","}","float getDotColour( Cell c, vec2 p, int channel, float angle, float aa ) {","\tfloat dist_c_1, dist_c_2, dist_c_3, dist_c_4, res;","\tif ( channel == 0 ) {","\t\tc.samp1 = getSample( c.p1 ).r;","\t\tc.samp2 = getSample( c.p2 ).r;","\t\tc.samp3 = getSample( c.p3 ).r;","\t\tc.samp4 = getSample( c.p4 ).r;","\t} else if (channel == 1) {","\t\tc.samp1 = getSample( c.p1 ).g;","\t\tc.samp2 = getSample( c.p2 ).g;","\t\tc.samp3 = getSample( c.p3 ).g;","\t\tc.samp4 = getSample( c.p4 ).g;","\t} else {","\t\tc.samp1 = getSample( c.p1 ).b;","\t\tc.samp3 = getSample( c.p3 ).b;","\t\tc.samp2 = getSample( c.p2 ).b;","\t\tc.samp4 = getSample( c.p4 ).b;","\t}","\tdist_c_1 = distanceToDotRadius( c.samp1, c.p1, c.normal, p, angle, radius );","\tdist_c_2 = distanceToDotRadius( c.samp2, c.p2, c.normal, p, angle, radius );","\tdist_c_3 = distanceToDotRadius( c.samp3, c.p3, c.normal, p, angle, radius );","\tdist_c_4 = distanceToDotRadius( c.samp4, c.p4, c.normal, p, angle, radius );","\tres = ( dist_c_1 > 0.0 ) ? clamp( dist_c_1 / aa, 0.0, 1.0 ) : 0.0;","\tres += ( dist_c_2 > 0.0 ) ? clamp( dist_c_2 / aa, 0.0, 1.0 ) : 0.0;","\tres += ( dist_c_3 > 0.0 ) ? clamp( dist_c_3 / aa, 0.0, 1.0 ) : 0.0;","\tres += ( dist_c_4 > 0.0 ) ? clamp( dist_c_4 / aa, 0.0, 1.0 ) : 0.0;","\tres = clamp( res, 0.0, 1.0 );","\treturn res;","}","Cell getReferenceCell( vec2 p, vec2 origin, float grid_angle, float step ) {","\tCell c;","\tvec2 n = vec2( cos( grid_angle ), sin( grid_angle ) );","\tfloat threshold = step * 0.5;","\tfloat dot_normal = n.x * ( p.x - origin.x ) + n.y * ( p.y - origin.y );","\tfloat dot_line = -n.y * ( p.x - origin.x ) + n.x * ( p.y - origin.y );","\tvec2 offset = vec2( n.x * dot_normal, n.y * dot_normal );","\tfloat offset_normal = mod( hypot( offset.x, offset.y ), step );","\tfloat normal_dir = ( dot_normal < 0.0 ) ? 1.0 : -1.0;","\tfloat normal_scale = ( ( offset_normal < threshold ) ? -offset_normal : step - offset_normal ) * normal_dir;","\tfloat offset_line = mod( hypot( ( p.x - offset.x ) - origin.x, ( p.y - offset.y ) - origin.y ), step );","\tfloat line_dir = ( dot_line < 0.0 ) ? 1.0 : -1.0;","\tfloat line_scale = ( ( offset_line < threshold ) ? -offset_line : step - offset_line ) * line_dir;","\tc.normal = n;","\tc.p1.x = p.x - n.x * normal_scale + n.y * line_scale;","\tc.p1.y = p.y - n.y * normal_scale - n.x * line_scale;","\tif ( scatter != 0.0 ) {","\t\tfloat off_mag = scatter * threshold * 0.5;","\t\tfloat off_angle = rand( vec2( floor( c.p1.x ), floor( c.p1.y ) ) ) * PI2;","\t\tc.p1.x += cos( off_angle ) * off_mag;","\t\tc.p1.y += sin( off_angle ) * off_mag;","\t}","\tfloat normal_step = normal_dir * ( ( offset_normal < threshold ) ? step : -step );","\tfloat line_step = line_dir * ( ( offset_line < threshold ) ? step : -step );","\tc.p2.x = c.p1.x - n.x * normal_step;","\tc.p2.y = c.p1.y - n.y * normal_step;","\tc.p3.x = c.p1.x + n.y * line_step;","\tc.p3.y = c.p1.y - n.x * line_step;","\tc.p4.x = c.p1.x - n.x * normal_step + n.y * line_step;","\tc.p4.y = c.p1.y - n.y * normal_step - n.x * line_step;","\treturn c;","}","float blendColour( float a, float b, float t ) {","\tif ( blendingMode == BLENDING_LINEAR ) {","\t\treturn blend( a, b, 1.0 - t );","\t} else if ( blendingMode == BLENDING_ADD ) {","\t\treturn blend( a, min( 1.0, a + b ), t );","\t} else if ( blendingMode == BLENDING_MULTIPLY ) {","\t\treturn blend( a, max( 0.0, a * b ), t );","\t} else if ( blendingMode == BLENDING_LIGHTER ) {","\t\treturn blend( a, max( a, b ), t );","\t} else if ( blendingMode == BLENDING_DARKER ) {","\t\treturn blend( a, min( a, b ), t );","\t} else {","\t\treturn blend( a, b, 1.0 - t );","\t}","}","void main() {","\tif ( ! disable ) {","\t\tvec2 p = vec2( vUV.x * width, vUV.y * height );","\t\tvec2 origin = vec2( 0, 0 );","\t\tfloat aa = ( radius < 2.5 ) ? radius * 0.5 : 1.25;","\t\tCell cell_r = getReferenceCell( p, origin, rotateR, radius );","\t\tCell cell_g = getReferenceCell( p, origin, rotateG, radius );","\t\tCell cell_b = getReferenceCell( p, origin, rotateB, radius );","\t\tfloat r = getDotColour( cell_r, p, 0, rotateR, aa );","\t\tfloat g = getDotColour( cell_g, p, 1, rotateG, aa );","\t\tfloat b = getDotColour( cell_b, p, 2, rotateB, aa );","\t\tvec4 colour = texture2D( tDiffuse, vUV );","\t\tr = blendColour( r, colour.r, blending );","\t\tg = blendColour( g, colour.g, blending );","\t\tb = blendColour( b, colour.b, blending );","\t\tif ( greyscale ) {","\t\t\tr = g = b = (r + b + g) / 3.0;","\t\t}","\t\tgl_FragColor = vec4( r, g, b, 1.0 );","\t} else {","\t\tgl_FragColor = texture2D( tDiffuse, vUV );","\t}","}"].join("\n")},ro=function(e,t,r){void 0===to&&console.error("THREE.HalftonePass requires HalftoneShader"),this.uniforms=a.UniformsUtils.clone(to.uniforms),this.material=new a.ShaderMaterial({uniforms:this.uniforms,fragmentShader:to.fragmentShader,vertexShader:to.vertexShader}),this.uniforms.width.value=e,this.uniforms.height.value=t;for(let n in r)r.hasOwnProperty(n)&&this.uniforms.hasOwnProperty(n)&&(this.uniforms[n].value=r[n]);this.fsQuad=new qi.T(this.material)};ro.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:ro,render:function(e,t,r){this.material.uniforms.tDiffuse.value=r.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))},setSize:function(e,t){this.uniforms.width.value=e,this.uniforms.height.value=t}});var no={defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new a.Vector2(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","void SMAAEdgeDetectionVS( vec2 texcoord ) {","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );","\tvOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );","}","void main() {","\tvUv = uv;","\tSMAAEdgeDetectionVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {","\tvec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );","\tvec4 delta;","\tvec3 C = texture2D( colorTex, texcoord ).rgb;","\tvec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;","\tvec3 t = abs( C - Cleft );","\tdelta.x = max( max( t.r, t.g ), t.b );","\tvec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;","\tt = abs( C - Ctop );","\tdelta.y = max( max( t.r, t.g ), t.b );","\tvec2 edges = step( threshold, delta.xy );","\tif ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )","\t\tdiscard;","\tvec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;","\tt = abs( C - Cright );","\tdelta.z = max( max( t.r, t.g ), t.b );","\tvec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;","\tt = abs( C - Cbottom );","\tdelta.w = max( max( t.r, t.g ), t.b );","\tfloat maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );","\tvec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;","\tt = abs( C - Cleftleft );","\tdelta.z = max( max( t.r, t.g ), t.b );","\tvec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;","\tt = abs( C - Ctoptop );","\tdelta.w = max( max( t.r, t.g ), t.b );","\tmaxDelta = max( max( maxDelta, delta.z ), delta.w );","\tedges.xy *= step( 0.5 * maxDelta, delta.xy );","\treturn vec4( edges, 0.0, 0.0 );","}","void main() {","\tgl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );","}"].join("\n")},io={defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new a.Vector2(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","varying vec2 vPixcoord;","void SMAABlendingWeightCalculationVS( vec2 texcoord ) {","\tvPixcoord = texcoord / resolution;","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );","\tvOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );","}","void main() {","\tvUv = uv;","\tSMAABlendingWeightCalculationVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )","uniform sampler2D tDiffuse;","uniform sampler2D tArea;","uniform sampler2D tSearch;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[3];","varying vec2 vPixcoord;","#if __VERSION__ == 100","vec2 round( vec2 x ) {","\treturn sign( x ) * floor( abs( x ) + 0.5 );","}","#endif","float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {","\te.r = bias + e.r * scale;","\treturn 255.0 * texture2D( searchTex, e, 0.0 ).r;","}","float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 0.0, 1.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord -= vec2( 2.0, 0.0 ) * resolution;","\t\tif ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;","\t}","\ttexcoord.x += 0.25 * resolution.x;","\ttexcoord.x += resolution.x;","\ttexcoord.x += 2.0 * resolution.x;","\ttexcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);","\treturn texcoord.x;","}","float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 0.0, 1.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord += vec2( 2.0, 0.0 ) * resolution;","\t\tif ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;","\t}","\ttexcoord.x -= 0.25 * resolution.x;","\ttexcoord.x -= resolution.x;","\ttexcoord.x -= 2.0 * resolution.x;","\ttexcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );","\treturn texcoord.x;","}","float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 1.0, 0.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord += vec2( 0.0, 2.0 ) * resolution;","\t\tif ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;","\t}","\ttexcoord.y -= 0.25 * resolution.y;","\ttexcoord.y -= resolution.y;","\ttexcoord.y -= 2.0 * resolution.y;","\ttexcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );","\treturn texcoord.y;","}","float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 1.0, 0.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord -= vec2( 0.0, 2.0 ) * resolution;","\t\tif ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;","\t}","\ttexcoord.y += 0.25 * resolution.y;","\ttexcoord.y += resolution.y;","\ttexcoord.y += 2.0 * resolution.y;","\ttexcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );","\treturn texcoord.y;","}","vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {","\tvec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;","\ttexcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );","\ttexcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;","\treturn texture2D( areaTex, texcoord, 0.0 ).rg;","}","vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {","\tvec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );","\tvec2 e = texture2D( edgesTex, texcoord ).rg;","\tif ( e.g > 0.0 ) {","\t\tvec2 d;","\t\tvec2 coords;","\t\tcoords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );","\t\tcoords.y = offset[ 1 ].y;","\t\td.x = coords.x;","\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).r;","\t\tcoords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );","\t\td.y = coords.x;","\t\td = d / resolution.x - pixcoord.x;","\t\tvec2 sqrt_d = sqrt( abs( d ) );","\t\tcoords.y -= 1.0 * resolution.y;","\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;","\t\tweights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );","\t}","\tif ( e.r > 0.0 ) {","\t\tvec2 d;","\t\tvec2 coords;","\t\tcoords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );","\t\tcoords.x = offset[ 0 ].x;","\t\td.x = coords.y;","\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).g;","\t\tcoords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );","\t\td.y = coords.y;","\t\td = d / resolution.y - pixcoord.y;","\t\tvec2 sqrt_d = sqrt( abs( d ) );","\t\tcoords.y -= 1.0 * resolution.y;","\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;","\t\tweights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );","\t}","\treturn weights;","}","void main() {","\tgl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );","}"].join("\n")},oo={uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new a.Vector2(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","void SMAANeighborhoodBlendingVS( vec2 texcoord ) {","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );","}","void main() {","\tvUv = uv;","\tSMAANeighborhoodBlendingVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tColor;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {","\tvec4 a;","\ta.xz = texture2D( blendTex, texcoord ).xz;","\ta.y = texture2D( blendTex, offset[ 1 ].zw ).g;","\ta.w = texture2D( blendTex, offset[ 1 ].xy ).a;","\tif ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {","\t\treturn texture2D( colorTex, texcoord, 0.0 );","\t} else {","\t\tvec2 offset;","\t\toffset.x = a.a > a.b ? a.a : -a.b;","\t\toffset.y = a.g > a.r ? -a.g : a.r;","\t\tif ( abs( offset.x ) > abs( offset.y )) {","\t\t\toffset.y = 0.0;","\t\t} else {","\t\t\toffset.x = 0.0;","\t\t}","\t\tvec4 C = texture2D( colorTex, texcoord, 0.0 );","\t\ttexcoord += sign( offset ) * resolution;","\t\tvec4 Cop = texture2D( colorTex, texcoord, 0.0 );","\t\tfloat s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );","\t\tC.xyz = pow(C.xyz, vec3(2.2));","\t\tCop.xyz = pow(Cop.xyz, vec3(2.2));","\t\tvec4 mixed = mix(C, Cop, s);","\t\tmixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));","\t\treturn mixed;","\t}","}","void main() {","\tgl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );","}"].join("\n")};class ao extends qi.w{constructor(e,t){super(),this.edgesRT=new a.WebGLRenderTarget(e,t,{depthBuffer:!1}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new a.WebGLRenderTarget(e,t,{depthBuffer:!1}),this.weightsRT.texture.name="SMAAPass.weights";const r=this,n=new Image;n.src=this.getAreaTexture(),n.onload=function(){r.areaTexture.needsUpdate=!0},this.areaTexture=new a.Texture,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=n,this.areaTexture.minFilter=a.LinearFilter,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1;const i=new Image;i.src=this.getSearchTexture(),i.onload=function(){r.searchTexture.needsUpdate=!0},this.searchTexture=new a.Texture,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=i,this.searchTexture.magFilter=a.NearestFilter,this.searchTexture.minFilter=a.NearestFilter,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,void 0===no&&console.error("THREE.SMAAPass relies on SMAAShader"),this.uniformsEdges=a.UniformsUtils.clone(no.uniforms),this.uniformsEdges.resolution.value.set(1/e,1/t),this.materialEdges=new a.ShaderMaterial({defines:Object.assign({},no.defines),uniforms:this.uniformsEdges,vertexShader:no.vertexShader,fragmentShader:no.fragmentShader}),this.uniformsWeights=a.UniformsUtils.clone(io.uniforms),this.uniformsWeights.resolution.value.set(1/e,1/t),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new a.ShaderMaterial({defines:Object.assign({},io.defines),uniforms:this.uniformsWeights,vertexShader:io.vertexShader,fragmentShader:io.fragmentShader}),this.uniformsBlend=a.UniformsUtils.clone(oo.uniforms),this.uniformsBlend.resolution.value.set(1/e,1/t),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new a.ShaderMaterial({uniforms:this.uniformsBlend,vertexShader:oo.vertexShader,fragmentShader:oo.fragmentShader}),this.needsSwap=!1,this.fsQuad=new qi.T(null)}render(e,t,r){this.uniformsEdges.tDiffuse.value=r.texture,this.fsQuad.material=this.materialEdges,e.setRenderTarget(this.edgesRT),this.clear&&e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialWeights,e.setRenderTarget(this.weightsRT),this.clear&&e.clear(),this.fsQuad.render(e),this.uniformsBlend.tColor.value=r.texture,this.fsQuad.material=this.materialBlend,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}setSize(e,t){this.edgesRT.setSize(e,t),this.weightsRT.setSize(e,t),this.materialEdges.uniforms.resolution.value.set(1/e,1/t),this.materialWeights.uniforms.resolution.value.set(1/e,1/t),this.materialBlend.uniforms.resolution.value.set(1/e,1/t)}getAreaTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}getSearchTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}}var so={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 cTextureScreen = texture2D( tDiffuse, vUv );","\tfloat dx = rand( vUv + time );","\tvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","\tvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","\tcResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","\tcResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","\tif( grayscale ) {","\t\tcResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","\t}","\tgl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},lo=function(e,t,r,n){void 0===so&&console.error("THREE.FilmPass relies on FilmShader");var i=so;this.uniforms=a.UniformsUtils.clone(i.uniforms),this.material=new a.ShaderMaterial({uniforms:this.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),void 0!==n&&(this.uniforms.grayscale.value=n),void 0!==e&&(this.uniforms.nIntensity.value=e),void 0!==t&&(this.uniforms.sIntensity.value=t),void 0!==r&&(this.uniforms.sCount.value=r),this.fsQuad=new qi.T(this.material)};lo.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:lo,render:function(e,t,r,n){this.uniforms.tDiffuse.value=r.texture,this.uniforms.time.value+=n,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}});var co=r(7166),uo=function(e,t,r,n){this.renderScene=t,this.renderCamera=r,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new a.Color(1,1,1),this.hiddenEdgeColor=new a.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=void 0!==e?new a.Vector2(e.x,e.y):new a.Vector2(256,256);var i={minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat},o=Math.round(this.resolution.x/this.downSampleRatio),s=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new a.MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=a.DoubleSide,this.renderTargetMaskBuffer=new a.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new a.MeshDepthMaterial,this.depthMaterial.side=a.DoubleSide,this.depthMaterial.depthPacking=a.RGBADepthPacking,this.depthMaterial.blending=a.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=a.DoubleSide,this.prepareMaskMaterial.fragmentShader=function(e,t){var r=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,r+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new a.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new a.WebGLRenderTarget(o,s,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new a.WebGLRenderTarget(o,s,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new a.WebGLRenderTarget(Math.round(o/2),Math.round(s/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new a.WebGLRenderTarget(o,s,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new a.WebGLRenderTarget(Math.round(o/2),Math.round(s/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(o,s),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(o/2),Math.round(s/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===co.C&&console.error("THREE.OutlinePass relies on CopyShader");var l=co.C;this.copyUniforms=a.UniformsUtils.clone(l.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new a.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,blending:a.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new a.Color,this.oldClearAlpha=1,this.fsQuad=new qi.T(null),this.tempPulseColor1=new a.Color,this.tempPulseColor2=new a.Color,this.textureMatrix=new a.Matrix4};uo.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:uo,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var r=Math.round(e/this.downSampleRatio),n=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,n),this.renderTargetBlurBuffer1.setSize(r,n),this.renderTargetEdgeBuffer1.setSize(r,n),this.separableBlurMaterial1.uniforms.texSize.value.set(r,n),r=Math.round(r/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(r,n),this.renderTargetEdgeBuffer2.setSize(r,n),this.separableBlurMaterial2.uniforms.texSize.value.set(r,n)},changeVisibilityOfSelectedObjects:function(e){var t=this._visibilityCache;function r(r){r.isMesh&&(!0===e?r.visible=t.get(r):(t.set(r,r.visible),r.visible=e))}for(let n=0;n<this.selectedObjects.length;n++){this.selectedObjects[n].traverse(r)}},changeVisibilityOfNonSelectedObjects:function(e){var t=this._visibilityCache,r=[];function n(e){e.isMesh&&r.push(e)}for(let i=0;i<this.selectedObjects.length;i++){this.selectedObjects[i].traverse(n)}this.renderScene.traverse((function(n){if(n.isMesh||n.isSprite){var i=!1;for(let e=0;e<r.length;e++){if(r[e].id===n.id){i=!0;break}}if(!1===i){var o=n.visible;!1!==e&&!0!==t.get(n)||(n.visible=e),t.set(n,o)}}else(n.isPoints||n.isLine)&&(!0===e?n.visible=t.get(n):(t.set(n,n.visible),n.visible=e))}))},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,r,n,i){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,i&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var a=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=a,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=uo.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=uo.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=uo.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=uo.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,e.setRenderTarget(null),this.fsQuad.render(e))},getPrepareMaskMaterial:function(){return new a.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new a.Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:["#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\t#include <skinbase_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\tvPosition = mvPosition;","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new a.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new a.Vector2(.5,.5)},visibleEdgeColor:{value:new a.Vector3(1,1,1)},hiddenEdgeColor:{value:new a.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new a.ShaderMaterial({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new a.Vector2(.5,.5)},direction:{value:new a.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new a.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:a.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),uo.BlurDirectionX=new a.Vector2(1,0),uo.BlurDirectionY=new a.Vector2(0,1);var ho={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new a.Vector2},cameraProjectionMatrix:{value:new a.Matrix4},cameraInverseProjectionMatrix:{value:new a.Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\treturn texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","\tfloat depth = getDepth( vUv );","\tfloat viewZ = getViewZ( depth );","\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );","\tvec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","\tvec3 bitangent = cross( viewNormal, tangent );","\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","\t\tvec3 sampleVector = kernelMatrix * kernel[ i ];","\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","\t\tsamplePointNDC /= samplePointNDC.w;","\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","\t\tfloat realDepth = getLinearDepth( samplePointUv );","\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","\t\tfloat delta = sampleDepth - realDepth;","\t\tif ( delta > minDistance && delta < maxDistance ) {","\t\t\tocclusion += 1.0;","\t\t}","\t}","\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join("\n")},fo={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","void main() {","\tfloat depth = getLinearDepth( vUv );","\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join("\n")},po={uniforms:{tDiffuse:{value:null},resolution:{value:new a.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texelSize = ( 1.0 / resolution );","\tfloat result = 0.0;","\tfor ( int i = - 2; i <= 2; i ++ ) {","\t\tfor ( int j = - 2; j <= 2; j ++ ) {","\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;","\t\t}","\t}","\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join("\n")};class mo extends qi.w{constructor(e,t,r,n){super(),this.width=void 0!==r?r:512,this.height=void 0!==n?n:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(),this.generateRandomKernelRotations();const i=new a.DepthTexture;i.format=a.DepthStencilFormat,i.type=a.UnsignedInt248Type,this.beautyRenderTarget=new a.WebGLRenderTarget(this.width,this.height),this.normalRenderTarget=new a.WebGLRenderTarget(this.width,this.height,{minFilter:a.NearestFilter,magFilter:a.NearestFilter,depthTexture:i}),this.ssaoRenderTarget=new a.WebGLRenderTarget(this.width,this.height),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===ho&&console.error("THREE.SSAOPass: The pass relies on SSAOShader."),this.ssaoMaterial=new a.ShaderMaterial({defines:Object.assign({},ho.defines),uniforms:a.UniformsUtils.clone(ho.uniforms),vertexShader:ho.vertexShader,fragmentShader:ho.fragmentShader,blending:a.NoBlending}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new a.MeshNormalMaterial,this.normalMaterial.blending=a.NoBlending,this.blurMaterial=new a.ShaderMaterial({defines:Object.assign({},po.defines),uniforms:a.UniformsUtils.clone(po.uniforms),vertexShader:po.vertexShader,fragmentShader:po.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new a.ShaderMaterial({defines:Object.assign({},fo.defines),uniforms:a.UniformsUtils.clone(fo.uniforms),vertexShader:fo.vertexShader,fragmentShader:fo.fragmentShader,blending:a.NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(co.C.uniforms),vertexShader:co.C.vertexShader,fragmentShader:co.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:a.DstColorFactor,blendDst:a.ZeroFactor,blendEquation:a.AddEquation,blendSrcAlpha:a.DstAlphaFactor,blendDstAlpha:a.ZeroFactor,blendEquationAlpha:a.AddEquation}),this.fsQuad=new qi.T(null),this.originalClearColor=new a.Color}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t){switch(!1===e.capabilities.isWebGL2&&(this.noiseTexture.format=a.LuminanceFormat),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case mo.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case mo.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case mo.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case mo.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case mo.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case mo.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=a.CustomBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(e,t,r,n,i){e.getClearColor(this.originalClearColor);const o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,void 0!==n&&null!==n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)}renderOverride(e,t,r,n,i){e.getClearColor(this.originalClearColor);const o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,i=t.clearAlpha||i,void 0!==n&&null!==n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)}setSize(e,t){this.width=e,this.height=t,this.beautyRenderTarget.setSize(e,t),this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t)}generateSampleKernel(){const e=this.kernelSize,t=this.kernel;for(let r=0;r<e;r++){const n=new a.Vector3;n.x=2*Math.random()-1,n.y=2*Math.random()-1,n.z=Math.random(),n.normalize();let i=r/e;i=a.MathUtils.lerp(.1,1,i*i),n.multiplyScalar(i),t.push(n)}}generateRandomKernelRotations(){void 0===kn.L&&console.error("THREE.SSAOPass: The pass relies on SimplexNoise.");const e=new kn.L,t=new Float32Array(16);for(let r=0;r<16;r++){const n=2*Math.random()-1,i=2*Math.random()-1,o=0;t[r]=e.noise3d(n,i,o)}this.noiseTexture=new a.DataTexture(t,4,4,a.RedFormat,a.FloatType),this.noiseTexture.wrapS=a.RepeatWrapping,this.noiseTexture.wrapT=a.RepeatWrapping,this.noiseTexture.needsUpdate=!0}overrideVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse((function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)}))}restoreVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse((function(e){const r=t.get(e);e.visible=r})),t.clear()}}mo.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5};class go extends qi.w{constructor(e){super(),void 0===co.C&&console.error("THREE.SavePass relies on CopyShader");const t=co.C;this.textureID="tDiffuse",this.uniforms=a.UniformsUtils.clone(t.uniforms),this.material=new a.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new a.WebGLRenderTarget(window.innerWidth,window.innerHeight),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.fsQuad=new qi.T(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),e.setRenderTarget(this.renderTarget),this.clear&&e.clear(),this.fsQuad.render(e)}}var Ao={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float nearClip;","uniform float farClip;","uniform float focus;","uniform float aspect;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );","\t#else","\treturn orthographicDepthToViewZ( depth, nearClip, farClip );","\t#endif","}","void main() {","\tvec2 aspectcorrect = vec2( 1.0, aspect );","\tfloat viewZ = getViewZ( getDepth( vUv ) );","\tfloat factor = ( focus + viewZ );","\tvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","\tvec2 dofblur9 = dofblur * 0.9;","\tvec2 dofblur7 = dofblur * 0.7;","\tvec2 dofblur4 = dofblur * 0.4;","\tvec4 col = vec4( 0.0 );","\tcol += texture2D( tColor, vUv.xy );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","\tgl_FragColor = col / 41.0;","\tgl_FragColor.a = 1.0;","}"].join("\n")},vo=function(e,t,r){this.scene=e,this.camera=t;var n=void 0!==r.focus?r.focus:1,i=void 0!==r.aspect?r.aspect:t.aspect,o=void 0!==r.aperture?r.aperture:.025,s=void 0!==r.maxblur?r.maxblur:1,l=r.width||window.innerWidth||1,c=r.height||window.innerHeight||1;this.renderTargetDepth=new a.WebGLRenderTarget(l,c,{minFilter:a.NearestFilter,magFilter:a.NearestFilter}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new a.MeshDepthMaterial,this.materialDepth.depthPacking=a.RGBADepthPacking,this.materialDepth.blending=a.NoBlending,void 0===Ao&&console.error("THREE.BokehPass relies on BokehShader");var u=Ao,h=a.UniformsUtils.clone(u.uniforms);h.tDepth.value=this.renderTargetDepth.texture,h.focus.value=n,h.aspect.value=i,h.aperture.value=o,h.maxblur.value=s,h.nearClip.value=t.near,h.farClip.value=t.far,this.materialBokeh=new a.ShaderMaterial({defines:Object.assign({},u.defines),uniforms:h,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}),this.uniforms=h,this.needsSwap=!1,this.fsQuad=new qi.T(this.materialBokeh),this._oldClearColor=new a.Color};vo.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:vo,render:function(e,t,r){this.scene.overrideMaterial=this.materialDepth,e.getClearColor(this._oldClearColor);var n=e.getClearAlpha(),i=e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms.tColor.value=r.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),e.clear(),this.fsQuad.render(e)),this.scene.overrideMaterial=null,e.setClearColor(this._oldClearColor),e.setClearAlpha(n),e.autoClear=i}});var yo=function(e,t){void 0===co.C&&console.error("THREE.TexturePass relies on CopyShader");var r=co.C;this.map=e,this.opacity=void 0!==t?t:1,this.uniforms=a.UniformsUtils.clone(r.uniforms),this.material=new a.ShaderMaterial({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,depthTest:!1,depthWrite:!1}),this.needsSwap=!1,this.fsQuad=new qi.T(null)};yo.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:yo,render:function(e,t,r){var n=e.autoClear;e.autoClear=!1,this.fsQuad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(),this.fsQuad.render(e),e.autoClear=n}});var xo={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tfloat l = linearToRelativeLuminance( texel.rgb );","\tgl_FragColor = vec4( l, l, l, texel.w );","}"].join("\n")},bo={uniforms:{tDiffuse:{value:null},averageLuminance:{value:1},luminanceMap:{value:null},maxLuminance:{value:16},minLuminance:{value:.01},middleGrey:{value:.6}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float middleGrey;","uniform float minLuminance;","uniform float maxLuminance;","#ifdef ADAPTED_LUMINANCE","\tuniform sampler2D luminanceMap;","#else","\tuniform float averageLuminance;","#endif","vec3 ToneMap( vec3 vColor ) {","\t#ifdef ADAPTED_LUMINANCE","\t\tfloat fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;","\t#else","\t\tfloat fLumAvg = averageLuminance;","\t#endif","\tfloat fLumPixel = linearToRelativeLuminance( vColor );","\tfloat fLumScaled = (fLumPixel * middleGrey) / max( minLuminance, fLumAvg );","\tfloat fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);","\treturn fLumCompressed * vColor;","}","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );","}"].join("\n")},wo=function(e,t){this.resolution=void 0!==t?t:256,this.needsInit=!0,this.adaptive=void 0===e||!!e,this.luminanceRT=null,this.previousLuminanceRT=null,this.currentLuminanceRT=null,void 0===co.C&&console.error("THREE.AdaptiveToneMappingPass relies on CopyShader");var r=co.C;this.copyUniforms=a.UniformsUtils.clone(r.uniforms),this.materialCopy=new a.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,blending:a.NoBlending,depthTest:!1}),void 0===xo&&console.error("THREE.AdaptiveToneMappingPass relies on LuminosityShader"),this.materialLuminance=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(xo.uniforms),vertexShader:xo.vertexShader,fragmentShader:xo.fragmentShader,blending:a.NoBlending}),this.adaptLuminanceShader={defines:{MIP_LEVEL_1X1:(Math.log(this.resolution)/Math.log(2)).toFixed(1)},uniforms:{lastLum:{value:null},currentLum:{value:null},minLuminance:{value:.01},delta:{value:.016},tau:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D lastLum;","uniform sampler2D currentLum;","uniform float minLuminance;","uniform float delta;","uniform float tau;","void main() {","\tvec4 lastLum = texture2D( lastLum, vUv, MIP_LEVEL_1X1 );","\tvec4 currentLum = texture2D( currentLum, vUv, MIP_LEVEL_1X1 );","\tfloat fLastLum = max( minLuminance, lastLum.r );","\tfloat fCurrentLum = max( minLuminance, currentLum.r );","\tfCurrentLum *= fCurrentLum;","\tfloat fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));","\tgl_FragColor.r = fAdaptedLum;","}"].join("\n")},this.materialAdaptiveLum=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(this.adaptLuminanceShader.uniforms),vertexShader:this.adaptLuminanceShader.vertexShader,fragmentShader:this.adaptLuminanceShader.fragmentShader,defines:Object.assign({},this.adaptLuminanceShader.defines),blending:a.NoBlending}),void 0===bo&&console.error("THREE.AdaptiveToneMappingPass relies on ToneMapShader"),this.materialToneMap=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(bo.uniforms),vertexShader:bo.vertexShader,fragmentShader:bo.fragmentShader,blending:a.NoBlending}),this.fsQuad=new qi.T(null)};wo.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:wo,render:function(e,t,r,n){this.needsInit&&(this.reset(e),this.luminanceRT.texture.type=r.texture.type,this.previousLuminanceRT.texture.type=r.texture.type,this.currentLuminanceRT.texture.type=r.texture.type,this.needsInit=!1),this.adaptive&&(this.fsQuad.material=this.materialLuminance,this.materialLuminance.uniforms.tDiffuse.value=r.texture,e.setRenderTarget(this.currentLuminanceRT),this.fsQuad.render(e),this.fsQuad.material=this.materialAdaptiveLum,this.materialAdaptiveLum.uniforms.delta.value=n,this.materialAdaptiveLum.uniforms.lastLum.value=this.previousLuminanceRT.texture,this.materialAdaptiveLum.uniforms.currentLum.value=this.currentLuminanceRT.texture,e.setRenderTarget(this.luminanceRT),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.luminanceRT.texture,e.setRenderTarget(this.previousLuminanceRT),this.fsQuad.render(e)),this.fsQuad.material=this.materialToneMap,this.materialToneMap.uniforms.tDiffuse.value=r.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))},reset:function(){this.luminanceRT&&this.luminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose();var e={minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat};this.luminanceRT=new a.WebGLRenderTarget(this.resolution,this.resolution,e),this.luminanceRT.texture.name="AdaptiveToneMappingPass.l",this.luminanceRT.texture.generateMipmaps=!1,this.previousLuminanceRT=new a.WebGLRenderTarget(this.resolution,this.resolution,e),this.previousLuminanceRT.texture.name="AdaptiveToneMappingPass.pl",this.previousLuminanceRT.texture.generateMipmaps=!1,e.minFilter=a.LinearMipmapLinearFilter,e.generateMipmaps=!0,this.currentLuminanceRT=new a.WebGLRenderTarget(this.resolution,this.resolution,e),this.currentLuminanceRT.texture.name="AdaptiveToneMappingPass.cl",this.adaptive&&(this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture),this.fsQuad.material=new a.MeshBasicMaterial({color:7829367}),this.materialLuminance.needsUpdate=!0,this.materialAdaptiveLum.needsUpdate=!0,this.materialToneMap.needsUpdate=!0},setAdaptive:function(e){e?(this.adaptive=!0,this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture):(this.adaptive=!1,delete this.materialToneMap.defines.ADAPTED_LUMINANCE,this.materialToneMap.uniforms.luminanceMap.value=null),this.materialToneMap.needsUpdate=!0},setAdaptionRate:function(e){e&&(this.materialAdaptiveLum.uniforms.tau.value=Math.abs(e))},setMinLuminance:function(e){e&&(this.materialToneMap.uniforms.minLuminance.value=e,this.materialAdaptiveLum.uniforms.minLuminance.value=e)},setMaxLuminance:function(e){e&&(this.materialToneMap.uniforms.maxLuminance.value=e)},setAverageLuminance:function(e){e&&(this.materialToneMap.uniforms.averageLuminance.value=e)},setMiddleGrey:function(e){e&&(this.materialToneMap.uniforms.middleGrey.value=e)},dispose:function(){this.luminanceRT&&this.luminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.materialLuminance&&this.materialLuminance.dispose(),this.materialAdaptiveLum&&this.materialAdaptiveLum.dispose(),this.materialCopy&&this.materialCopy.dispose(),this.materialToneMap&&this.materialToneMap.dispose()}});var Co={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new a.Color(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},Eo=function(e,t,r,n){this.strength=void 0!==t?t:1,this.radius=r,this.threshold=n,this.resolution=void 0!==e?new a.Vector2(e.x,e.y):new a.Vector2(256,256),this.clearColor=new a.Color(0,0,0);var i={minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new a.WebGLRenderTarget(o,s,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let f=0;f<this.nMips;f++){var l=new a.WebGLRenderTarget(o,s,i);l.texture.name="UnrealBloomPass.h"+f,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var c=new a.WebGLRenderTarget(o,s,i);c.texture.name="UnrealBloomPass.v"+f,c.texture.generateMipmaps=!1,this.renderTargetsVertical.push(c),o=Math.round(o/2),s=Math.round(s/2)}void 0===Co&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");var u=Co;this.highPassUniforms=a.UniformsUtils.clone(u.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new a.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var h=[3,5,7,9,11];o=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);for(let f=0;f<this.nMips;f++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[f])),this.separableBlurMaterials[f].uniforms.texSize.value=new a.Vector2(o,s),o=Math.round(o/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new a.Vector3(1,1,1),new a.Vector3(1,1,1),new a.Vector3(1,1,1),new a.Vector3(1,1,1),new a.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===co.C&&console.error("THREE.UnrealBloomPass relies on CopyShader");var d=co.C;this.copyUniforms=a.UniformsUtils.clone(d.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new a.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,blending:a.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new a.Color,this.oldClearAlpha=1,this.basic=new a.MeshBasicMaterial,this.fsQuad=new qi.T(null)};Eo.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:Eo,dispose:function(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var r=Math.round(e/2),n=Math.round(t/2);this.renderTargetBright.setSize(r,n);for(let i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,n),this.renderTargetsVertical[i].setSize(r,n),this.separableBlurMaterials[i].uniforms.texSize.value=new a.Vector2(r,n),r=Math.round(r/2),n=Math.round(n/2)},render:function(e,t,r,n,i){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);var a=this.renderTargetBright;for(let s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=Eo.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=Eo.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),this.fsQuad.render(e),a=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o},getSeperableBlurMaterial:function(e){return new a.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new a.Vector2(.5,.5)},direction:{value:new a.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new a.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),Eo.BlurDirectionX=new a.Vector2(1,0),Eo.BlurDirectionY=new a.Vector2(0,1);var So=function(e,t,r){this.camera=e,this.needsSwap=!1,this.cubeShader=a.ShaderLib.cube,this.cubeMesh=new a.Mesh(new a.BoxGeometry(10,10,10),new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(this.cubeShader.uniforms),vertexShader:this.cubeShader.vertexShader,fragmentShader:this.cubeShader.fragmentShader,depthTest:!1,depthWrite:!1,side:a.BackSide})),Object.defineProperty(this.cubeMesh.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),this.envMap=t,this.opacity=void 0!==r?r:1,this.cubeScene=new a.Scene,this.cubeCamera=new a.PerspectiveCamera,this.cubeScene.add(this.cubeMesh)};So.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:So,render:function(e,t,r){var n=e.autoClear;e.autoClear=!1,this.cubeCamera.projectionMatrix.copy(this.camera.projectionMatrix),this.cubeCamera.quaternion.setFromRotationMatrix(this.camera.matrixWorld),this.cubeMesh.material.uniforms.envMap.value=this.envMap,this.cubeMesh.material.uniforms.flipEnvMap.value=this.envMap.isCubeTexture&&this.envMap._needsFlipEnvMap?-1:1,this.cubeMesh.material.uniforms.opacity.value=this.opacity,this.cubeMesh.material.transparent=this.opacity<1,e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(),e.render(this.cubeScene,this.cubeCamera),e.autoClear=n}});var To={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new a.Vector2(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new a.Matrix4},cameraInverseProjectionMatrix:{value:new a.Matrix4},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","\t#if DIFFUSE_TEXTURE == 1","\treturn texture2D( tDiffuse, vUv );","\t#else","\treturn vec4( 1.0 );","\t#endif","}","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","\t#if NORMAL_TEXTURE == 1","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","\t#else","\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","\t#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","\tvec3 viewDelta = sampleViewPosition - centerViewPosition;","\tfloat viewDistance = length( viewDelta );","\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","\t// precompute some variables require in getOcclusion.","\tscaleDividedByCameraFar = scale / cameraFar;","\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;","\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","\tfloat angle = rand( vUv + randomSeed ) * PI2;","\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","\tvec2 radiusStep = radius;","\tfloat occlusionSum = 0.0;","\tfloat weightSum = 0.0;","\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {","\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","\t\tradius += radiusStep;","\t\tangle += ANGLE_STEP;","\t\tfloat sampleDepth = getDepth( sampleUv );","\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {","\t\t\tcontinue;","\t\t}","\t\tfloat sampleViewZ = getViewZ( sampleDepth );","\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","\t\tweightSum += 1.0;","\t}","\tif( weightSum == 0.0 ) discard;","\treturn occlusionSum * ( intensity / weightSum );","}","void main() {","\tfloat centerDepth = getDepth( vUv );","\tif( centerDepth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = getViewZ( centerDepth );","\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );","\tgl_FragColor = getDefaultColor( vUv );","\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join("\n")},Mo={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new a.Vector2(512,512)},sampleUvOffsets:{value:[new a.Vector2(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","\tvUv = uv;","\tvInvSize = 1.0 / size;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","void main() {","\tfloat depth = getDepth( vUv );","\tif( depth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = -getViewZ( depth );","\tbool rBreak = false, lBreak = false;","\tfloat weightSum = sampleWeights[0];","\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","\t\tfloat sampleWeight = sampleWeights[i];","\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","\t\tvec2 sampleUv = vUv + sampleUvOffset;","\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","\t\tif( ! rBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t\tsampleUv = vUv - sampleUvOffset;","\t\tviewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","\t\tif( ! lBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t}","\tgl_FragColor = diffuseSum / weightSum;","}"].join("\n")},Io={createSampleWeights:function(e,t){var r=function(e,t){return Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t)},n=[];for(let i=0;i<=e;i++)n.push(r(i,t));return n},createSampleOffsets:function(e,t){var r=[];for(let n=0;n<=e;n++)r.push(t.clone().multiplyScalar(n));return r},configure:function(e,t,r,n){e.defines.KERNEL_RADIUS=t,e.uniforms.sampleUvOffsets.value=Io.createSampleOffsets(t,n),e.uniforms.sampleWeights.value=Io.createSampleWeights(t,r),e.needsUpdate=!0}},Bo=function(e,t,r,n,i){(this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=void 0!==r&&r,this.supportsNormalTexture=void 0!==n&&n,this.originalClearColor=new a.Color,this._oldClearColor=new a.Color,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=void 0!==i?new a.Vector2(i.x,i.y):new a.Vector2(256,256),this.saoRenderTarget=new a.WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new a.WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:a.NearestFilter,magFilter:a.NearestFilter,format:a.RGBAFormat}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension)&&((r=new a.DepthTexture).type=a.UnsignedShortType,this.beautyRenderTarget.depthTexture=r,this.beautyRenderTarget.depthBuffer=!0);this.depthMaterial=new a.MeshDepthMaterial,this.depthMaterial.depthPacking=a.RGBADepthPacking,this.depthMaterial.blending=a.NoBlending,this.normalMaterial=new a.MeshNormalMaterial,this.normalMaterial.blending=a.NoBlending,void 0===To&&console.error("THREE.SAOPass relies on SAOShader"),this.saoMaterial=new a.ShaderMaterial({defines:Object.assign({},To.defines),fragmentShader:To.fragmentShader,vertexShader:To.vertexShader,uniforms:a.UniformsUtils.clone(To.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=a.NoBlending,void 0===Mo&&console.error("THREE.SAOPass relies on DepthLimitedBlurShader"),this.vBlurMaterial=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(Mo.uniforms),defines:Object.assign({},Mo.defines),vertexShader:Mo.vertexShader,fragmentShader:Mo.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=a.NoBlending,this.hBlurMaterial=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(Mo.uniforms),defines:Object.assign({},Mo.defines),vertexShader:Mo.vertexShader,fragmentShader:Mo.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?r:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=a.NoBlending,void 0===co.C&&console.error("THREE.SAOPass relies on CopyShader"),this.materialCopy=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(co.C.uniforms),vertexShader:co.C.vertexShader,fragmentShader:co.C.fragmentShader,blending:a.NoBlending}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=a.CustomBlending,this.materialCopy.blendSrc=a.DstColorFactor,this.materialCopy.blendDst=a.ZeroFactor,this.materialCopy.blendEquation=a.AddEquation,this.materialCopy.blendSrcAlpha=a.DstAlphaFactor,this.materialCopy.blendDstAlpha=a.ZeroFactor,this.materialCopy.blendEquationAlpha=a.AddEquation,void 0===ni&&console.error("THREE.SAOPass relies on UnpackDepthRGBAShader"),this.depthCopy=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(ni.uniforms),vertexShader:ni.vertexShader,fragmentShader:ni.fragmentShader,blending:a.NoBlending}),this.fsQuad=new qi.T(null)};Bo.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4},Bo.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:Bo,render:function(e,t,r){if(this.renderToScreen&&(this.materialCopy.blending=a.NoBlending,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),1!==this.params.output){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();var n=e.autoClear;e.autoClear=!1,e.setRenderTarget(this.depthRenderTarget),e.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;var i=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=i,this.hBlurMaterial.uniforms.depthCutoff.value=i,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(Io.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new a.Vector2(0,1)),Io.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new a.Vector2(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),e.setClearColor(0),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(e,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));var o=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,o=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?o.blending=a.CustomBlending:o.blending=a.NoBlending,this.renderPass(e,o,this.renderToScreen?null:r),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=n}},renderPass:function(e,t,r,n,i){e.getClearColor(this.originalClearColor);var o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,void 0!==n&&null!==n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)},renderOverride:function(e,t,r,n,i){e.getClearColor(this.originalClearColor);var o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,i=t.clearAlpha||i,void 0!==n&&null!==n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)},setSize:function(e,t){this.beautyRenderTarget.setSize(e,t),this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.depthRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}});const _o={uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float damp;","uniform sampler2D tOld;","uniform sampler2D tNew;","varying vec2 vUv;","vec4 when_gt( vec4 x, float y ) {","\treturn max( sign( x - y ), 0.0 );","}","void main() {","\tvec4 texelOld = texture2D( tOld, vUv );","\tvec4 texelNew = texture2D( tNew, vUv );","\ttexelOld *= damp * when_gt( texelOld, 0.1 );","\tgl_FragColor = max(texelNew, texelOld);","}"].join("\n")};class Fo extends qi.w{constructor(e=.96,t=_o){super(),(0,Qe.Z)(this,"shader",void 0),(0,Qe.Z)(this,"uniforms",void 0),(0,Qe.Z)(this,"textureComp",void 0),(0,Qe.Z)(this,"textureOld",void 0),(0,Qe.Z)(this,"shaderMaterial",void 0),(0,Qe.Z)(this,"compFsQuad",void 0),(0,Qe.Z)(this,"copyFsQuad",void 0),this.shader=t,this.uniforms=a.UniformsUtils.clone(t.uniforms),this.uniforms.damp.value=e,this.textureComp=new a.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat}),this.textureOld=new a.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat}),this.shaderMaterial=new a.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader}),this.compFsQuad=new qi.T(this.shaderMaterial);let r=new a.MeshBasicMaterial;this.copyFsQuad=new qi.T(r)}render(e,t,r){this.uniforms.tOld.value=this.textureOld.texture,this.uniforms.tNew.value=r.texture,e.setRenderTarget(this.textureComp),this.compFsQuad.render(e),this.copyFsQuad.material.map=this.textureComp.texture,this.renderToScreen?(e.setRenderTarget(null),this.copyFsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.copyFsQuad.render(e));let n=this.textureOld;this.textureOld=this.textureComp,this.textureComp=n}setSize(e,t){this.textureComp.setSize(e,t),this.textureOld.setSize(e,t)}}var Po=r(5354),Ro=r(1291),Lo={uniforms:{tDiffuse:{value:null},tSize:{value:new a.Vector2(256,256)},center:{value:new a.Vector2(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","\tfloat s = sin( angle ), c = cos( angle );","\tvec2 tex = vUv * tSize - center;","\tvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","\treturn ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","\tvec4 color = texture2D( tDiffuse, vUv );","\tfloat average = ( color.r + color.g + color.b ) / 3.0;","\tgl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},Do=function(e,t,r){void 0===Lo&&console.error("THREE.DotScreenPass relies on DotScreenShader");var n=Lo;this.uniforms=a.UniformsUtils.clone(n.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==r&&(this.uniforms.scale.value=r),this.material=new a.ShaderMaterial({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.fsQuad=new qi.T(this.material)};Do.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:Do,render:function(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.tSize.value.set(r.width,r.height),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}});var No={defines:{MAX_STEP:0,isPerspectiveCamera:!0,isDistanceAttenuation:!0,isFresnel:!0,isInfiniteThick:!1,isSelective:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new a.Vector2},cameraProjectionMatrix:{value:new a.Matrix4},cameraInverseProjectionMatrix:{value:new a.Matrix4},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},surfDist:{value:.007},thickTolerance:{value:.03}},vertexShader:"\n\n    varying vec2 vUv;\n\n    void main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n\n  ",fragmentShader:"\n\t\t// precision highp float;\n\t\tprecision highp sampler2D;\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D tDepth;\n\t\tuniform sampler2D tNormal;\n\t\tuniform sampler2D tMetalness;\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float cameraRange;\n\t\tuniform vec2 resolution;\n\t\tuniform float opacity;\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform float maxDistance;\n\t\tuniform float surfDist;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\t\tuniform float thickTolerance;\n\t\t#include <packing>\n\t\tfloat pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {\n\t\t\t//x0: point, x1: linePointA, x2: linePointB\n\t\t\t//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html\n\t\t\treturn length(cross(x0-x1,x0-x2))/length(x2-x1);\n\t\t}\n\t\tfloat pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){\n\t\t\t// https://mathworld.wolfram.com/Point-PlaneDistance.html\n\t\t\t//// https://en.wikipedia.org/wiki/Plane_(geometry)\n\t\t\t//// http://paulbourke.net/geometry/pointlineplane/\n\t\t\tfloat a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;\n\t\t\tfloat x0=point.x,y0=point.y,z0=point.z;\n\t\t\tfloat x=planePoint.x,y=planePoint.y,z=planePoint.z;\n\t\t\tfloat d=-(a*x+b*y+c*z);\n\t\t\tfloat distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);\n\t\t\treturn distance;\n\t\t}\n\t\tfloat getDepth( const in vec2 uv ) {\n\t\t\treturn texture2D( tDepth, uv ).x;\n\t\t}\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#ifdef isPerspectiveCamera\n\t\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\t\tvec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {\n\t\t\tvec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc\n\t\t\tclipPosition *= clipW; //clip\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view\n\t\t}\n\t\tvec3 getViewNormal( const in vec2 uv ) {\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, uv ).xyz );\n\t\t}\n\t\tvec2 viewPositionToXY(vec3 viewPosition){\n\t\t\tvec2 xy;\n\t\t\tvec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);\n\t\t\txy=clip.xy;//clip\n\t\t\tfloat clipW=clip.w;\n\t\t\txy/=clipW;//NDC\n\t\t\txy=(xy+1.)/2.;//uv\n\t\t\txy*=resolution;//screen\n\t\t\treturn xy;\n\t\t}\n\t\tvoid main(){\n\t\t\t#ifdef isSelective\n\t\t\t\tfloat metalness=texture2D(tMetalness,vUv).r;\n\t\t\t\tif(metalness==0.) return;\n\t\t\t#endif\n\n\t\t\tfloat depth = getDepth( vUv );\n\t\t\tfloat viewZ = getViewZ( depth );\n\t\t\tif(-viewZ>=cameraFar) return;\n\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];\n\t\t\tvec3 viewPosition=getViewPosition( vUv, depth, clipW );\n\n\t\t\tvec2 d0=gl_FragCoord.xy;\n\t\t\tvec2 d1;\n\n\t\t\tvec3 viewNormal=getViewNormal( vUv );\n\n\t\t\t#ifdef isPerspectiveCamera\n\t\t\t\tvec3 viewIncidenceDir=normalize(viewPosition);\n\t\t\t\tvec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);\n\t\t\t#else\n\t\t\t\tvec3 viewIncidenceDir=vec3(0,0,-1);\n\t\t\t\tvec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);\n\t\t\t#endif\n\n\t\t\tfloat maxReflectRayLen=maxDistance/dot(-viewIncidenceDir,viewNormal);\n\t\t\t// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html\n\t\t\t// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)\n\t\t\t// maxDistance/maxReflectRayLen=cos(theta)\n\t\t\t// maxDistance/maxReflectRayLen==dot(a,b)\n\t\t\t// maxReflectRayLen==maxDistance/dot(a,b)\n\n\t\t\tvec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;\n\t\t\t#ifdef isPerspectiveCamera\n\t\t\t\tif(d1viewPosition.z>-cameraNear){\n\t\t\t\t\t//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx\n\t\t\t\t\tfloat t=(-cameraNear-viewPosition.z)/viewReflectDir.z;\n\t\t\t\t\td1viewPosition=viewPosition+viewReflectDir*t;\n\t\t\t\t}\n\t\t\t#endif\n\t\t\td1=viewPositionToXY(d1viewPosition);\n\n\t\t\tfloat totalLen=length(d1-d0);\n\t\t\tfloat xLen=d1.x-d0.x;\n\t\t\tfloat yLen=d1.y-d0.y;\n\t\t\tfloat totalStep=max(abs(xLen),abs(yLen));\n\t\t\tfloat xSpan=xLen/totalStep;\n\t\t\tfloat ySpan=yLen/totalStep;\n\t\t\tfor(float i=0.;i<MAX_STEP;i++){\n\t\t\t\tif(i>=totalStep) break;\n\t\t\t\tvec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);\n\t\t\t\tif(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;\n\t\t\t\tfloat s=length(xy-d0)/totalLen;\n\t\t\t\tvec2 uv=xy/resolution;\n\n\t\t\t\tfloat d = getDepth(uv);\n\t\t\t\tfloat vZ = getViewZ( d );\n\t\t\t\tif(-vZ>=cameraFar) continue;\n\t\t\t\tfloat cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];\n\t\t\t\tvec3 vP=getViewPosition( uv, d, cW );\n\n\t\t\t\t#ifdef isPerspectiveCamera\n\t\t\t\t\t// https://www.comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf\n\t\t\t\t\tfloat recipVPZ=1./viewPosition.z;\n\t\t\t\t\tfloat viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));\n\t\t\t\t\tfloat sD=surfDist*cW;\n\t\t\t\t#else\n\t\t\t\t\tfloat viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);\n\t\t\t\t\tfloat sD=surfDist;\n\t\t\t\t#endif\n\t\t\t\tif(viewReflectRayZ-sD>vZ) continue;\n\n\t\t\t\t#ifdef isInfiniteThick\n\t\t\t\t\tif(viewReflectRayZ+thickTolerance*clipW<vP.z) break;\n\t\t\t\t#endif\n\t\t\t\tfloat away=pointToLineDistance(vP,viewPosition,d1viewPosition);\n\n\t\t\t\tfloat op=opacity;\n\n\t\t\t\tif(away<sD){\n\t\t\t\t\tvec3 vN=getViewNormal( uv );\n\t\t\t\t\tif(dot(viewReflectDir,vN)>=0.) continue;\n\t\t\t\t\tfloat distance=pointPlaneDistance(vP,viewPosition,viewNormal);\n\t\t\t\t\tif(distance>maxDistance) break;\n\t\t\t\t\t#ifdef isDistanceAttenuation\n\t\t\t\t\t\tfloat ratio=1.-(distance/maxDistance);\n\t\t\t\t\t\tfloat attenuation=ratio*ratio;\n\t\t\t\t\t\top=opacity*attenuation;\n\t\t\t\t\t#endif\n\t\t\t\t\t#ifdef isFresnel\n\t\t\t\t\t\tfloat fresnel=(dot(viewIncidenceDir,viewReflectDir)+1.)/2.;\n\t\t\t\t\t\top*=fresnel;\n\t\t\t\t\t#endif\n\t\t\t\t\tvec4 reflectColor=texture2D(tDiffuse,uv);\n\t\t\t\t\tgl_FragColor.xyz=reflectColor.xyz;\n\t\t\t\t\tgl_FragColor.a=op;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t"},ko={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvUv = uv;\n    \tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n\n  ",fragmentShader:"\n\n    uniform sampler2D tDepth;\n\n    uniform float cameraNear;\n    uniform float cameraFar;\n\n    varying vec2 vUv;\n\n    #include <packing>\n\n\t\tfloat getLinearDepth( const in vec2 uv ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, uv ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, uv ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n    void main() {\n\n    \tfloat depth = getLinearDepth( vUv );\n\t\t\tfloat d = 1.0 - depth;\n\t\t\t// d=(d-.999)*1000.;\n    \tgl_FragColor = vec4( vec3( d ), 1.0 );\n\n    }\n\n  "},Oo={uniforms:{tDiffuse:{value:null},resolution:{value:new a.Vector2},opacity:{value:.5}},vertexShader:"\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvUv = uv;\n    \tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n\n  ",fragmentShader:"\n\n    uniform sampler2D tDiffuse;\n    uniform vec2 resolution;\n    varying vec2 vUv;\n    void main() {\n\t\t\t//reverse engineering from PhotoShop blur filter, then change coefficient\n\n    \tvec2 texelSize = ( 1.0 / resolution );\n\n\t\t\tvec4 c=texture2D(tDiffuse,vUv);\n\n\t\t\tvec2 offset;\n\n\t\t\toffset=(vec2(-1,0))*texelSize;\n\t\t\tvec4 cl=texture2D(tDiffuse,vUv+offset);\n\n\t\t\toffset=(vec2(1,0))*texelSize;\n\t\t\tvec4 cr=texture2D(tDiffuse,vUv+offset);\n\n\t\t\toffset=(vec2(0,-1))*texelSize;\n\t\t\tvec4 cb=texture2D(tDiffuse,vUv+offset);\n\n\t\t\toffset=(vec2(0,1))*texelSize;\n\t\t\tvec4 ct=texture2D(tDiffuse,vUv+offset);\n\n\t\t\t// float coeCenter=.5;\n\t\t\t// float coeSide=.125;\n\t\t\tfloat coeCenter=.2;\n\t\t\tfloat coeSide=.2;\n\t\t\tfloat a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;\n\t\t\tvec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;\n\t\t\tgl_FragColor=vec4(rgb,a);\n\n\t\t}\n\t"},Uo=function({renderer:e,scene:t,camera:r,width:n,height:i,selects:o,encoding:s,isPerspectiveCamera:l=!0,isBouncing:c=!1,morphTargets:u=!1,groundReflector:h}){this.width=void 0!==n?n:512,this.height=void 0!==i?i:512,this.clear=!0,this.renderer=e,this.scene=t,this.camera=r,this.groundReflector=h,this.opacity=No.uniforms.opacity.value,this.output=0,this.maxDistance=No.uniforms.maxDistance.value,this.surfDist=No.uniforms.surfDist.value,this.encoding=s,this.tempColor=new a.Color,this._selects=o,this.isSelective=Array.isArray(this._selects),Object.defineProperty(this,"selects",{get(){return this._selects},set(e){this._selects!==e&&(this._selects=e,Array.isArray(e)?(this.isSelective=!0,this.ssrMaterial.defines.isSelective=!0,this.ssrMaterial.needsUpdate=!0):(this.isSelective=!1,this.ssrMaterial.defines.isSelective=!1,this.ssrMaterial.needsUpdate=!0))}}),this._isBouncing=c,Object.defineProperty(this,"isBouncing",{get(){return this._isBouncing},set(e){this._isBouncing!==e&&(this._isBouncing=e,this.ssrMaterial.uniforms.tDiffuse.value=e?this.prevRenderTarget.texture:this.beautyRenderTarget.texture)}}),this.isBlur=!0,this._isDistanceAttenuation=No.defines.isDistanceAttenuation,Object.defineProperty(this,"isDistanceAttenuation",{get(){return this._isDistanceAttenuation},set(e){this._isDistanceAttenuation!==e&&(this._isDistanceAttenuation=e,this.ssrMaterial.defines.isDistanceAttenuation=e,this.ssrMaterial.needsUpdate=!0)}}),this._isFresnel=No.defines.isFresnel,Object.defineProperty(this,"isFresnel",{get(){return this._isFresnel},set(e){this._isFresnel!==e&&(this._isFresnel=e,this.ssrMaterial.defines.isFresnel=e,this.ssrMaterial.needsUpdate=!0)}}),this._isInfiniteThick=No.defines.isInfiniteThick,Object.defineProperty(this,"isInfiniteThick",{get(){return this._isInfiniteThick},set(e){this._isInfiniteThick!==e&&(this._isInfiniteThick=e,this.ssrMaterial.defines.isInfiniteThick=e,this.ssrMaterial.needsUpdate=!0)}}),this.thickTolerance=No.uniforms.thickTolerance.value;var d=new a.DepthTexture;d.type=a.UnsignedShortType,d.minFilter=a.NearestFilter,d.maxFilter=a.NearestFilter,this.beautyRenderTarget=new a.WebGLRenderTarget(this.width,this.height,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat,depthTexture:d,depthBuffer:!0}),this.prevRenderTarget=new a.WebGLRenderTarget(this.width,this.height,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat}),this.normalRenderTarget=new a.WebGLRenderTarget(this.width,this.height,{minFilter:a.NearestFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,type:a.HalfFloatType}),this.metalnessRenderTarget=new a.WebGLRenderTarget(this.width,this.height,{minFilter:a.NearestFilter,magFilter:a.NearestFilter,format:a.RGBAFormat}),this.ssrRenderTarget=new a.WebGLRenderTarget(this.width,this.height,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat}),this.blurRenderTarget=this.ssrRenderTarget.clone(),this.blurRenderTarget2=this.ssrRenderTarget.clone(),void 0===No&&console.error("THREE.SSRPass: The pass relies on SSRShader."),this.ssrMaterial=new a.ShaderMaterial({defines:Object.assign({MAX_STEP:Math.sqrt(window.innerWidth*window.innerWidth+window.innerHeight*window.innerHeight)},No.defines),uniforms:a.UniformsUtils.clone(No.uniforms),vertexShader:No.vertexShader,fragmentShader:No.fragmentShader,blending:a.NoBlending}),l||(this.ssrMaterial.defines.isPerspectiveCamera=l,this.ssrMaterial.needsUpdate=!0),this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssrMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssrMaterial.defines.isSelective=this.isSelective,this.ssrMaterial.needsUpdate=!0,this.ssrMaterial.uniforms.tMetalness.value=this.metalnessRenderTarget.texture,this.ssrMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssrMaterial.uniforms.cameraNear.value=this.camera.near,this.ssrMaterial.uniforms.cameraFar.value=this.camera.far,this.ssrMaterial.uniforms.surfDist.value=this.surfDist,this.ssrMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new a.MeshNormalMaterial({morphTargets:u}),this.normalMaterial.blending=a.NoBlending,this.metalnessOnMaterial=new a.MeshBasicMaterial({color:"white"}),this.metalnessOffMaterial=new a.MeshBasicMaterial({color:"black"}),this.blurMaterial=new a.ShaderMaterial({defines:Object.assign({},Oo.defines),uniforms:a.UniformsUtils.clone(Oo.uniforms),vertexShader:Oo.vertexShader,fragmentShader:Oo.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.blurMaterial2=new a.ShaderMaterial({defines:Object.assign({},Oo.defines),uniforms:a.UniformsUtils.clone(Oo.uniforms),vertexShader:Oo.vertexShader,fragmentShader:Oo.fragmentShader}),this.blurMaterial2.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.blurMaterial2.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new a.ShaderMaterial({defines:Object.assign({},ko.defines),uniforms:a.UniformsUtils.clone(ko.uniforms),vertexShader:ko.vertexShader,fragmentShader:ko.fragmentShader,blending:a.NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(co.C.uniforms),vertexShader:co.C.vertexShader,fragmentShader:co.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:a.SrcAlphaFactor,blendDst:a.OneMinusSrcAlphaFactor,blendEquation:a.AddEquation,blendSrcAlpha:a.SrcAlphaFactor,blendDstAlpha:a.OneMinusSrcAlphaFactor,blendEquationAlpha:a.AddEquation}),this.fsQuad=new qi.T(null),this.originalClearColor=new a.Color};Uo.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:Uo,dispose:function(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()},render:function(e,t){switch(this.encoding&&(this.beautyRenderTarget.texture.encoding=this.encoding),e.setRenderTarget(this.beautyRenderTarget),e.clear(),this.groundReflector&&(this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),e.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,0,0),this.isSelective&&this.renderMetalness(e,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.surfDist.value=this.surfDist,this.ssrMaterial.uniforms.thickTolerance.value=this.thickTolerance,this.renderPass(e,this.ssrMaterial,this.ssrRenderTarget),this.isBlur&&(this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.renderPass(e,this.blurMaterial2,this.blurRenderTarget2)),this.output){case Uo.OUTPUT.Default:this.isBouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.isBlur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=a.NormalBlending,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t)):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.isBlur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=a.NormalBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t));break;case Uo.OUTPUT.SSR:this.isBlur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.isBouncing&&(this.isBlur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=a.NormalBlending,this.renderPass(e,this.copyMaterial,this.prevRenderTarget));break;case Uo.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case Uo.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case Uo.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case Uo.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=a.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.SSRPass: Unknown output type.")}},renderPass:function(e,t,r,n,i){this.originalClearColor.copy(e.getClearColor(this.tempColor));var o=e.getClearAlpha(this.tempColor),a=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,void 0!==n&&null!==n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)},renderOverride:function(e,t,r,n,i){this.originalClearColor.copy(e.getClearColor(this.tempColor));var o=e.getClearAlpha(this.tempColor),a=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,i=t.clearAlpha||i,void 0!==n&&null!==n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)},renderMetalness:function(e,t,r,n,i){this.originalClearColor.copy(e.getClearColor(this.tempColor));var o=e.getClearAlpha(this.tempColor),a=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,i=t.clearAlpha||i,void 0!==n&&null!==n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.scene.traverseVisible((e=>{e._SSRPassMaterialBack=e.material,this._selects.includes(e)?e.material=this.metalnessOnMaterial:e.material=this.metalnessOffMaterial})),e.render(this.scene,this.camera),this.scene.traverseVisible((e=>{e.material=e._SSRPassMaterialBack})),e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)},setSize:function(e,t){this.width=e,this.height=t,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(e*e+t*t),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(e,t),this.prevRenderTarget.setSize(e,t),this.ssrRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.metalnessRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.blurRenderTarget2.setSize(e,t),this.ssrMaterial.uniforms.resolution.value.set(e,t),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t),this.blurMaterial2.uniforms.resolution.value.set(e,t)}}),Uo.OUTPUT={Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7};var Qo=function(e,t,r,n){this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==r?r:0,this.clearAlpha=void 0!==n?n:0,this._oldClearColor=new a.Color,void 0===co.C&&console.error("THREE.SSAARenderPass relies on CopyShader");var i=co.C;this.copyUniforms=a.UniformsUtils.clone(i.uniforms),this.copyMaterial=new a.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:a.AdditiveBlending,depthTest:!1,depthWrite:!1}),this.fsQuad=new qi.T(this.copyMaterial)};Qo.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:Qo,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)},render:function(e,t,r){this.sampleRenderTarget||(this.sampleRenderTarget=new a.WebGLRenderTarget(r.width,r.height,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var n=Qo.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],i=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);var o=e.getClearAlpha(),s=1/n.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;var l=r.width,c=r.height;for(let a=0;a<n.length;a++){var u=n[a];this.camera.setViewOffset&&this.camera.setViewOffset(l,c,.0625*u[0],.0625*u[1],l,c);var h=s;if(this.unbiased)h+=.03125*((a+.5)/n.length-.5);this.copyUniforms.opacity.value=h,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),0===a&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=i,e.setClearColor(this._oldClearColor,o)}}),Qo.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var Vo=function(e,t,r,n){void 0===Qo&&console.error("THREE.TAARenderPass relies on SSAARenderPass"),Qo.call(this,e,t,r,n),this.sampleLevel=0,this.accumulate=!1};Vo.JitterVectors=Qo.JitterVectors,Vo.prototype=Object.assign(Object.create(Qo.prototype),{constructor:Vo,render:function(e,t,r,n){if(!this.accumulate)return Qo.prototype.render.call(this,e,t,r,n),void(this.accumulateIndex=-1);var i=Vo.JitterVectors[5];this.sampleRenderTarget||(this.sampleRenderTarget=new a.WebGLRenderTarget(r.width,r.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new a.WebGLRenderTarget(r.width,r.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(Qo.prototype.render.call(this,e,this.holdRenderTarget,r,n),this.accumulateIndex=0);var o=e.autoClear;e.autoClear=!1;var s=1/i.length;if(this.accumulateIndex>=0&&this.accumulateIndex<i.length){this.copyUniforms.opacity.value=s,this.copyUniforms.tDiffuse.value=t.texture;var l=Math.pow(2,this.sampleLevel);for(let n=0;n<l;n++){var c=i[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(r.width,r.height,.0625*c[0],.0625*c[1],r.width,r.height),e.setRenderTarget(t),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.sampleRenderTarget),0===this.accumulateIndex&&e.clear(),this.fsQuad.render(e),this.accumulateIndex++,this.accumulateIndex>=i.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}var u=this.accumulateIndex*s;u>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,e.setRenderTarget(t),e.clear(),this.fsQuad.render(e)),u<1&&(this.copyUniforms.opacity.value=1-u,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,e.setRenderTarget(t),0===u&&e.clear(),this.fsQuad.render(e)),e.autoClear=o}});var Go=r(5869),zo={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new a.Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvec2 imageCoord = vUv;","\tvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","\t\timageCoord += uImageIncrement;","\t}","\tgl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-e*e/(2*t*t))}var r,n,i,o,a=2*Math.ceil(3*e)+1;for(a>25&&(a=25),o=.5*(a-1),n=new Array(a),i=0,r=0;r<a;++r)n[r]=t(r-o,e),i+=n[r];for(r=0;r<a;++r)n[r]/=i;return n}},jo=function(e,t,r,n){e=void 0!==e?e:1,t=void 0!==t?t:25,r=void 0!==r?r:4,n=void 0!==n?n:256;var i={minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat};this.renderTargetX=new a.WebGLRenderTarget(n,n,i),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new a.WebGLRenderTarget(n,n,i),this.renderTargetY.texture.name="BloomPass.y",void 0===co.C&&console.error("THREE.BloomPass relies on CopyShader");var o=co.C;this.copyUniforms=a.UniformsUtils.clone(o.uniforms),this.copyUniforms.opacity.value=e,this.materialCopy=new a.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:a.AdditiveBlending,transparent:!0}),void 0===zo&&console.error("THREE.BloomPass relies on ConvolutionShader");var s=zo;this.convolutionUniforms=a.UniformsUtils.clone(s.uniforms),this.convolutionUniforms.uImageIncrement.value=jo.blurX,this.convolutionUniforms.cKernel.value=zo.buildKernel(r),this.materialConvolution=new a.ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,defines:{KERNEL_SIZE_FLOAT:t.toFixed(1),KERNEL_SIZE_INT:t.toFixed(0)}}),this.needsSwap=!1,this.fsQuad=new qi.T(null)};jo.prototype=Object.assign(Object.create(qi.w.prototype),{constructor:jo,render:function(e,t,r,n,i){i&&e.state.buffers.stencil.setTest(!1),this.fsQuad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=r.texture,this.convolutionUniforms.uImageIncrement.value=jo.blurX,e.setRenderTarget(this.renderTargetX),e.clear(),this.fsQuad.render(e),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=jo.blurY,e.setRenderTarget(this.renderTargetY),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY.texture,i&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.clear&&e.clear(),this.fsQuad.render(e)}}),jo.blurX=new a.Vector2(.001953125,0),jo.blurY=new a.Vector2(0,.001953125);class Ho{constructor(e,t,r,n,i){if(this.controller=t,this.handModel=e,this.envMap=null,this.handMesh=new a.Group,this.handModel.add(this.handMesh),window.XRHand){let e;i&&i.primitive&&"sphere"!==i.primitive?"box"===i.primitive&&(e=new a.BoxGeometry(1,1,1)):e=new a.SphereGeometry(1,10,10);const t=new a.MeshStandardMaterial({color:16777215,roughness:1,metalness:0}),r=new a.MeshStandardMaterial({color:10066329,roughness:1,metalness:0}),n=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"];for(let i of n){var o=new a.Mesh(e,-1!==i.indexOf("tip")?r:t);o.castShadow=!0,o.receiveShadow=!0,o.jointName=i,this.handMesh.add(o)}}}updateMesh(){const e=this.handMesh.children,t=this.controller.joints;for(let r=0;r<e.length;r++){const n=e[r],i=t[n.jointName];i.visible&&(n.position.copy(i.position),n.quaternion.copy(i.quaternion),n.scale.setScalar(i.jointRadius||.008)),n.visible=i.visible}}}var Wo=r(5139);class Zo{constructor(e,t,r,n,i){this.controller=t,this.handModel=e,this.bones=[];const o=new Wo.y,a=i&&"lowpoly"===i.model?"_low":"";o.setPath(r),o.load(`OculusHand_${"right"===n?"R":"L"}${a}.fbx`,(e=>{this.handModel.add(e),e.scale.setScalar(.01);const t=e.getObjectByProperty("type","SkinnedMesh");t.frustumCulled=!1,t.castShadow=!0,t.receiveShadow=!0;const r=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"];let i=0;["b_%_wrist","b_%_thumb1","b_%_thumb2","b_%_thumb3","b_%_thumb_null",null,"b_%_index1","b_%_index2","b_%_index3","b_%_index_null",null,"b_%_middle1","b_%_middle2","b_%_middle3","b_%_middlenull",null,"b_%_ring1","b_%_ring2","b_%_ring3","b_%_ring_inull","b_%_pinky0","b_%_pinky1","b_%_pinky2","b_%_pinky3","b_%_pinkynull"].forEach((t=>{if(t){const o=e.getObjectByName(t.replace(/%/g,"right"===n?"r":"l"));void 0!==o&&(o.jointName=r[i]),this.bones.push(o)}else this.bones.push(null);i++}))}))}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const r=this.bones[t];if(r){const t=e[r.jointName];if(t.visible){const e=t.position;r&&(r.position.copy(e.clone().multiplyScalar(100)),r.quaternion.copy(t.quaternion))}}}}}function Xo(e){a.Object3D.call(this),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null}Xo.prototype=Object.assign(Object.create(a.Object3D.prototype),{constructor:Xo,updateMatrixWorld:function(e){a.Object3D.prototype.updateMatrixWorld.call(this,e),this.motionController&&this.motionController.updateMesh()}});const Yo=function(){function e(){this.path=""}return e.prototype={constructor:e,setPath:function(e){return this.path=e,this},createHandModel:function(e,t,r){const n=new Xo(e);return e.addEventListener("connected",(i=>{const o=i.data;o.hand&&!n.motionController&&(n.visible=!0,n.xrInputSource=o,void 0===t||"spheres"===t?n.motionController=new Ho(n,e,this.path,o.handedness,{primitive:"sphere"}):"boxes"===t?n.motionController=new Ho(n,e,this.path,o.handedness,{primitive:"box"}):"oculus"===t&&(n.motionController=new Zo(n,e,this.path,o.handedness,r)))})),e.addEventListener("disconnected",(()=>{})),n}},e}();class Jo{constructor(e,t,r,n,i){this.xrLight=e,this.renderer=t,this.lightProbe=r,this.xrWebGLBinding=null,this.estimationStartCallback=i,this.frameCallback=this.onXRFrame.bind(this);const o=t.xr.getSession();if(n&&"XRWebGLBinding"in window){const r=new a.WebGLCubeRenderTarget(16);e.environment=r.texture;const n=t.getContext();switch(o.preferredReflectionFormat){case"srgba8":n.getExtension("EXT_sRGB");break;case"rgba16f":n.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(o,n),this.lightProbe.addEventListener("reflectionchange",(()=>{this.updateReflection()}))}o.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const r=t.getLightEstimate(this.lightProbe);if(r){this.xrLight.lightProbe.sh.fromArray(r.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const e=Math.max(1,Math.max(r.primaryLightIntensity.x,Math.max(r.primaryLightIntensity.y,r.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(r.primaryLightIntensity.x/e,r.primaryLightIntensity.y/e,r.primaryLightIntensity.z/e),this.xrLight.directionalLight.intensity=e,this.xrLight.directionalLight.position.copy(r.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class qo extends a.Group{constructor(e,t=!0){super(),this.lightProbe=new a.LightProbe,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new a.DirectionalLight,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let r=null,n=!1;e.xr.addEventListener("sessionstart",(()=>{const i=e.xr.getSession();"requestLightProbe"in i&&i.requestLightProbe({reflectionFormat:i.preferredReflectionFormat}).then((i=>{r=new Jo(this,e,i,t,(()=>{n=!0,this.dispatchEvent({type:"estimationstart"})}))}))})),e.xr.addEventListener("sessionend",(()=>{r&&(r.dispose(),r=null),n&&this.dispatchEvent({type:"estimationend"})})),this.dispose=()=>{r&&(r.dispose(),r=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}class Ko{static createButton(e,t){t&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');const r=document.createElement("button");function n(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,r.textContent="VR NOT SUPPORTED"}function i(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return r.id="VRButton",r.style.display="none",i(r),navigator.xr.isSessionSupported("immersive-vr").then((function(t){t?function(){let t=null;async function n(n){n.addEventListener("end",i),await e.xr.setSession(n),r.textContent="EXIT VR",t=n}function i(){t.removeEventListener("end",i),r.textContent="ENTER VR",t=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR",r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){if(null===t){const e={optionalFeatures:["local-floor","bounded-floor","hand-tracking"]};navigator.xr.requestSession("immersive-vr",e).then(n)}else t.end()}}():n()})),r;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",i(e),e}}}class $o{static createButton(e,t={}){const r=document.createElement("button");function n(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,r.textContent="AR NOT SUPPORTED"}function i(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return r.id="ARButton",r.style.display="none",i(r),navigator.xr.isSessionSupported("immersive-ar").then((function(i){i?function(){if(void 0===t.domOverlay){var n=document.createElement("div");n.style.display="none",document.body.appendChild(n);var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width",38),i.setAttribute("height",38),i.style.position="absolute",i.style.right="20px",i.style.top="20px",i.addEventListener("click",(function(){a.end()})),n.appendChild(i);var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),o.setAttribute("stroke","#fff"),o.setAttribute("stroke-width",2),i.appendChild(o),void 0===t.optionalFeatures&&(t.optionalFeatures=[]),t.optionalFeatures.push("dom-overlay"),t.domOverlay={root:n}}let a=null;async function s(n){n.addEventListener("end",l),e.xr.setReferenceSpaceType("local"),await e.xr.setSession(n),r.textContent="STOP AR",t.domOverlay.root.style.display="",a=n}function l(){a.removeEventListener("end",l),r.textContent="START AR",t.domOverlay.root.style.display="none",a=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="START AR",r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){null===a?navigator.xr.requestSession("immersive-ar",t).then(s):a.end()}}():n()})).catch(n),r;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",i(e),e}}}const ea={klein:function(e,t,r){let n,i,o;t*=Math.PI,e*=2*Math.PI,(t*=2)<Math.PI?(n=3*Math.cos(t)*(1+Math.sin(t))+2*(1-Math.cos(t)/2)*Math.cos(t)*Math.cos(e),o=-8*Math.sin(t)-2*(1-Math.cos(t)/2)*Math.sin(t)*Math.cos(e)):(n=3*Math.cos(t)*(1+Math.sin(t))+2*(1-Math.cos(t)/2)*Math.cos(e+Math.PI),o=-8*Math.sin(t)),i=-2*(1-Math.cos(t)/2)*Math.sin(e),r.set(n,i,o)},plane:function(e,t){return(r,n,i)=>{const o=r*e,a=n*t;i.set(o,0,a)}},mobius:function(e,t,r){e-=.5;const n=2*Math.PI*t;let i,o,a;i=Math.cos(n)*(2+e*Math.cos(n/2)),o=Math.sin(n)*(2+e*Math.cos(n/2)),a=e*Math.sin(n/2),r.set(i,o,a)},mobius3d:function(e,t,r){e*=Math.PI,t*=2*Math.PI;const n=(e*=2)/2;let i,o,a;i=.125*Math.cos(t)*Math.cos(n)-.65*Math.sin(t)*Math.sin(n),a=.125*Math.cos(t)*Math.sin(n)+.65*Math.sin(t)*Math.cos(n),o=(2.25+i)*Math.sin(e),i=(2.25+i)*Math.cos(e),r.set(i,o,a)},TubeGeometry:function(e,t,r,n,i){this.path=e,this.segments=t||64,this.radius=r||1,this.segmentsRadius=n||8,this.closed=i||!1;const o=this,s=this.segments+1,l=e.computeFrenetFrames(t,i),c=l.tangents,u=l.normals,h=l.binormals;this.tangents=c,this.normals=u,this.binormals=h;const d=new a.Vector3;a.ParametricGeometry.call(this,((t,r,n)=>{r*=2*Math.PI;let i=t*(s-1);i=Math.floor(i),e.getPointAt(t,d);const a=u[i],l=h[i],c=-o.radius*Math.cos(r),f=o.radius*Math.sin(r);d.x+=c*a.x+f*l.x,d.y+=c*a.y+f*l.y,d.z+=c*a.z+f*l.z,n.copy(d)}),t,n)}};ea.TubeGeometry.prototype=Object.create(a.BufferGeometry.prototype),ea.TubeGeometry.prototype.constructor=ea.TubeGeometry,ea.TorusKnotGeometry=function(e,t,r,n,i,o){this.radius=e||200,this.tube=t||40,this.segmentsT=r||64,this.segmentsR=n||8,this.p=i||2,this.q=o||3;class s extends a.Curve{constructor(){super()}getPoint(t,r){const n=r||new a.Vector3;t*=2*Math.PI;const s=(1+.5*Math.cos(o*t))*Math.cos(i*t),l=(1+.5*Math.cos(o*t))*Math.sin(i*t),c=.5*Math.sin(o*t);return n.set(s,l,c).multiplyScalar(e)}}const l=r,c=n,u=new s;ea.TubeGeometry.call(this,u,l,t,c,!0,!1)},ea.TorusKnotGeometry.prototype=Object.create(a.BufferGeometry.prototype),ea.TorusKnotGeometry.prototype.constructor=ea.TorusKnotGeometry,ea.SphereGeometry=function(e,t,r){a.ParametricGeometry.call(this,(function(t,r,n){t*=Math.PI,r*=2*Math.PI;const i=e*Math.sin(t)*Math.cos(r),o=e*Math.sin(t)*Math.sin(r),a=e*Math.cos(t);n.set(i,o,a)}),t,r)},ea.SphereGeometry.prototype=Object.create(a.BufferGeometry.prototype),ea.SphereGeometry.prototype.constructor=ea.SphereGeometry,ea.PlaneGeometry=function(e,t,r,n){a.ParametricGeometry.call(this,(function(r,n,i){const o=r*e,a=n*t;i.set(o,0,a)}),r,n)},ea.PlaneGeometry.prototype=Object.create(a.BufferGeometry.prototype),ea.PlaneGeometry.prototype.constructor=ea.PlaneGeometry;const ta=new a.Vector3;function ra(e,t,r,n,i,o){const a=2*Math.PI*i/4,s=Math.max(o-2*i,0),l=Math.PI/4;ta.copy(t),ta[n]=0,ta.normalize();const c=.5*a/(a+s),u=1-ta.angleTo(e)/l;if(1===Math.sign(ta[r]))return u*c;return s/(a+s)+c+c*(1-u)}class na extends a.BoxGeometry{constructor(e=1,t=1,r=1,n=2,i=.1){if(n=2*n+1,i=Math.min(e/2,t/2,r/2,i),super(1,1,1,n,n,n),1===n)return;const o=this.toNonIndexed();this.index=null,this.attributes.position=o.attributes.position,this.attributes.normal=o.attributes.normal,this.attributes.uv=o.attributes.uv;const s=new a.Vector3,l=new a.Vector3,c=new a.Vector3(e,t,r).divideScalar(2).subScalar(i),u=this.attributes.position.array,h=this.attributes.normal.array,d=this.attributes.uv.array,f=u.length/6,p=new a.Vector3,m=.5/n;for(let a=0,g=0;a<u.length;a+=3,g+=2){s.fromArray(u,a),l.copy(s),l.x-=Math.sign(l.x)*m,l.y-=Math.sign(l.y)*m,l.z-=Math.sign(l.z)*m,l.normalize(),u[a+0]=c.x*Math.sign(s.x)+l.x*i,u[a+1]=c.y*Math.sign(s.y)+l.y*i,u[a+2]=c.z*Math.sign(s.z)+l.z*i,h[a+0]=l.x,h[a+1]=l.y,h[a+2]=l.z;switch(Math.floor(a/f)){case 0:p.set(1,0,0),d[g+0]=ra(p,l,"z","y",i,r),d[g+1]=1-ra(p,l,"y","z",i,t);break;case 1:p.set(-1,0,0),d[g+0]=1-ra(p,l,"z","y",i,r),d[g+1]=1-ra(p,l,"y","z",i,t);break;case 2:p.set(0,1,0),d[g+0]=1-ra(p,l,"x","z",i,e),d[g+1]=ra(p,l,"z","x",i,r);break;case 3:p.set(0,-1,0),d[g+0]=1-ra(p,l,"x","z",i,e),d[g+1]=1-ra(p,l,"z","x",i,r);break;case 4:p.set(0,0,1),d[g+0]=1-ra(p,l,"x","y",i,e),d[g+1]=1-ra(p,l,"y","x",i,t);break;case 5:p.set(0,0,-1),d[g+0]=ra(p,l,"x","y",i,e),d[g+1]=1-ra(p,l,"y","x",i,t)}}}}class ia extends a.BufferGeometry{constructor(e,t,r,n,i,o){super();const s=(e=e||1)/2,l=(t=t||1)/2,c=(r=r||1)/2,u=e/(n=Math.floor(n)||1),h=t/(i=Math.floor(i)||1),d=r/(o=Math.floor(o)||1),f=[];let p=-s,m=-l,g=-c;for(let a=0;a<=n;a++)f.push(p,-l,-c,p,l,-c),f.push(p,l,-c,p,l,c),f.push(p,l,c,p,-l,c),f.push(p,-l,c,p,-l,-c),p+=u;for(let a=0;a<=i;a++)f.push(-s,m,-c,s,m,-c),f.push(s,m,-c,s,m,c),f.push(s,m,c,-s,m,c),f.push(-s,m,c,-s,m,-c),m+=h;for(let a=0;a<=o;a++)f.push(-s,-l,g,-s,l,g),f.push(-s,l,g,s,l,g),f.push(s,l,g,s,-l,g),f.push(s,-l,g,-s,-l,g),g+=d;this.setAttribute("position",new a.Float32BufferAttribute(f,3))}}class oa extends a.BufferGeometry{constructor(e,t,r,n){super();const i=[],o=[],s=[],l=new a.Vector3,c=new a.Matrix4;c.makeRotationFromEuler(r),c.setPosition(t);const u=new a.Matrix4;function h(t,r,n){r.applyMatrix4(e.matrixWorld),r.applyMatrix4(u),n.transformDirection(e.matrixWorld),t.push(new aa(r.clone(),n.clone()))}function d(e,t){const r=[],i=.5*Math.abs(n.dot(t));for(let n=0;n<e.length;n+=3){let o,a,s,l,c,u,h,d=0;const p=e[n+0].position.dot(t)-i,m=e[n+1].position.dot(t)-i,g=e[n+2].position.dot(t)-i;switch(o=p>0,a=m>0,s=g>0,d=(o?1:0)+(a?1:0)+(s?1:0),d){case 0:r.push(e[n]),r.push(e[n+1]),r.push(e[n+2]);break;case 1:if(o&&(l=e[n+1],c=e[n+2],u=f(e[n],l,t,i),h=f(e[n],c,t,i)),a){l=e[n],c=e[n+2],u=f(e[n+1],l,t,i),h=f(e[n+1],c,t,i),r.push(u),r.push(c.clone()),r.push(l.clone()),r.push(c.clone()),r.push(u.clone()),r.push(h);break}s&&(l=e[n],c=e[n+1],u=f(e[n+2],l,t,i),h=f(e[n+2],c,t,i)),r.push(l.clone()),r.push(c.clone()),r.push(u),r.push(h),r.push(u.clone()),r.push(c.clone());break;case 2:o||(l=e[n].clone(),c=f(l,e[n+1],t,i),u=f(l,e[n+2],t,i),r.push(l),r.push(c),r.push(u)),a||(l=e[n+1].clone(),c=f(l,e[n+2],t,i),u=f(l,e[n],t,i),r.push(l),r.push(c),r.push(u)),s||(l=e[n+2].clone(),c=f(l,e[n],t,i),u=f(l,e[n+1],t,i),r.push(l),r.push(c),r.push(u))}}return r}function f(e,t,r,n){const i=e.position.dot(r)-n,o=i/(i-(t.position.dot(r)-n));return new aa(new a.Vector3(e.position.x+o*(t.position.x-e.position.x),e.position.y+o*(t.position.y-e.position.y),e.position.z+o*(t.position.z-e.position.z)),new a.Vector3(e.normal.x+o*(t.normal.x-e.normal.x),e.normal.y+o*(t.normal.y-e.normal.y),e.normal.z+o*(t.normal.z-e.normal.z)))}u.copy(c).invert(),function(){let t,r=[];const u=new a.Vector3,f=new a.Vector3;if(!0===e.geometry.isGeometry)return void console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");const p=e.geometry,m=p.attributes.position,g=p.attributes.normal;if(null!==p.index){const e=p.index;for(t=0;t<e.count;t++)u.fromBufferAttribute(m,e.getX(t)),f.fromBufferAttribute(g,e.getX(t)),h(r,u,f)}else for(t=0;t<m.count;t++)u.fromBufferAttribute(m,t),f.fromBufferAttribute(g,t),h(r,u,f);for(r=d(r,l.set(1,0,0)),r=d(r,l.set(-1,0,0)),r=d(r,l.set(0,1,0)),r=d(r,l.set(0,-1,0)),r=d(r,l.set(0,0,1)),r=d(r,l.set(0,0,-1)),t=0;t<r.length;t++){const e=r[t];s.push(.5+e.position.x/n.x,.5+e.position.y/n.y),e.position.applyMatrix4(c),i.push(e.position.x,e.position.y,e.position.z),o.push(e.normal.x,e.normal.y,e.normal.z)}}(),this.setAttribute("position",new a.Float32BufferAttribute(i,3)),this.setAttribute("normal",new a.Float32BufferAttribute(o,3)),this.setAttribute("uv",new a.Float32BufferAttribute(s,2))}}class aa{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}class sa extends a.BufferGeometry{constructor(e,t,r,n,i,o,s){const l=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],c=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];super(),e=e||50,t=void 0!==t?Math.max(2,Math.floor(t)||10):10,o=void 0===o||o;const u=3.15*((s=void 0===s||s)?1:1.3)/2,h=e/u;let d=(r=void 0===r||r)?(8*t-4)*t:0;d+=(n=void 0===n||n)?(16*t-4)*t:0,d+=(i=void 0===i||i)?40*t*t:0;const f=new Uint32Array(3*d);let p=r?4:0;p+=n?8:0,p+=i?20:0,p*=(t+1)*(t+1);const m=new Float32Array(3*p),g=new Float32Array(3*p),A=new Float32Array(2*p),v=new a.Matrix4;v.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);const y=[];let x,b,w;const C=[],E=[],S=[],T=[],M=[],I=[],B=[],_=[],F=new a.Vector3;let P,R,L,D,N,k,O,U,Q,V=0,G=0;const z=new a.Vector3;let j,H,W,Z;const X=new a.Matrix4,Y=new a.Matrix4,J=new a.Vector4,q=new a.Vector4,K=new a.Vector4,$=new a.Vector4,ee=new a.Vector3,te=new a.Vector3,re=v.clone();re.transpose();const ne=(e,t,r)=>!(m[3*e]===m[3*t]&&m[3*e+1]===m[3*t+1]&&m[3*e+2]===m[3*t+2]||m[3*e]===m[3*r]&&m[3*e+1]===m[3*r+1]&&m[3*e+2]===m[3*r+2]||m[3*t]===m[3*r]&&m[3*t+1]===m[3*r+1]&&m[3*t+2]===m[3*r+2]);for(x=0;x<3;x++)M[x]=new a.Matrix4;const ie=r?32:28;D=t+1;let oe=0,ae=0,se=0,le=0,ce=0;for(let a=i?0:20;a<ie;a++)if(n||a<20||a>=28){for(x=0;x<3;x++){for(b=0;b<4;b++)for(w=0;w<4;w++)y[4*w+b]=c[3*l[16*a+4*b+w]+x],o&&a>=20&&a<28&&2!==x&&(y[4*w+b]*=1.077),s||2!==x||(y[4*w+b]*=1.3);X.set(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15]),Y.multiplyMatrices(X,v),M[x].multiplyMatrices(re,Y)}for(R=0;R<=t;R++)for(N=R/t,L=0;L<=t;L++){for(k=L/t,Q=4,O=U=1;Q--;)C[Q]=O,E[Q]=U,O*=N,U*=k,3===Q?(S[Q]=T[Q]=0,V=G=1):(S[Q]=V*(3-Q),T[Q]=G*(3-Q),V*=N,G*=k);for(J.fromArray(C),q.fromArray(E),K.fromArray(S),$.fromArray(T),x=0;x<3;x++)P=J.clone(),P.applyMatrix4(M[x]),I[x]=P.dot(q),P=K.clone(),P.applyMatrix4(M[x]),B[x]=P.dot(q),P=J.clone(),P.applyMatrix4(M[x]),_[x]=P.dot($);ee.fromArray(B),te.fromArray(_),F.crossVectors(te,ee),F.normalize(),0===I[0]&&0===I[1]?z.set(0,I[2]>u?1:-1,0):z.set(F.x,F.z,-F.y),m[ae++]=h*I[0],m[ae++]=h*(I[2]-u),m[ae++]=-h*I[1],g[se++]=z.x,g[se++]=z.y,g[se++]=z.z,A[le++]=1-k,A[le++]=1-N}for(R=0;R<t;R++)for(L=0;L<t;L++)j=oe*D*D+R*D+L,H=j+1,W=H+D,Z=j+D,ne(j,H,W)&&(f[ce++]=j,f[ce++]=H,f[ce++]=W),ne(j,W,Z)&&(f[ce++]=j,f[ce++]=W,f[ce++]=Z);oe++}this.setIndex(new a.BufferAttribute(f,1)),this.setAttribute("position",new a.BufferAttribute(m,3)),this.setAttribute("normal",new a.BufferAttribute(g,3)),this.setAttribute("uv",new a.BufferAttribute(A,2)),this.computeBoundingSphere()}}class la extends a.ExtrudeGeometry{constructor(e,t){const{bevelEnabled:r=!1,bevelSize:n=8,bevelThickness:i=10,font:o,height:a=50,size:s=100,...l}=t;super(o.generateShapes(e,s),{...l,bevelEnabled:r,bevelSize:n,bevelThickness:i,depth:a}),this.type="TextGeometry"}}const ca=new a.Matrix4;class ua{constructor(e){e=e||{},this.vertices={near:[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3],far:[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3]},void 0!==e.projectionMatrix&&this.setFromProjectionMatrix(e.projectionMatrix,e.maxFar||1e4)}setFromProjectionMatrix(e,t){const r=0===e.elements[11];return ca.copy(e).invert(),this.vertices.near[0].set(1,1,-1),this.vertices.near[1].set(1,-1,-1),this.vertices.near[2].set(-1,-1,-1),this.vertices.near[3].set(-1,1,-1),this.vertices.near.forEach((e=>{e.applyMatrix4(ca)})),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach((e=>{e.applyMatrix4(ca);const n=Math.abs(e.z);r?e.z*=Math.min(t/n,1):e.multiplyScalar(Math.min(t/n,1))})),this.vertices}split(e,t){for(;e.length>t.length;)t.push(new ua);t.length=e.length;for(let r=0;r<e.length;r++){const n=t[r];if(0===r)for(let e=0;e<4;e++)n.vertices.near[e].copy(this.vertices.near[e]);else for(let t=0;t<4;t++)n.vertices.near[t].lerpVectors(this.vertices.near[t],this.vertices.far[t],e[r-1]);if(r===e-1)for(let e=0;e<4;e++)n.vertices.far[e].copy(this.vertices.far[e]);else for(let t=0;t<4;t++)n.vertices.far[t].lerpVectors(this.vertices.near[t],this.vertices.far[t],e[r])}}toSpace(e,t){for(let r=0;r<4;r++)t.vertices.near[r].copy(this.vertices.near[r]).applyMatrix4(e),t.vertices.far[r].copy(this.vertices.far[r]).applyMatrix4(e)}}var ha=ua,da={lights_fragment_begin:"\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0) && defined( RE_Direct ) && defined( USE_CSM ) && defined( CSM_CASCADES )\n\n\tDirectionalLight directionalLight;\n\tfloat linearDepth = (vViewPosition.z) / (shadowFar - cameraNear);\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#if defined( USE_SHADOWMAP ) && defined( CSM_FADE )\n\tvec2 cascade;\n\tfloat cascadeCenter;\n\tfloat closestEdge;\n\tfloat margin;\n\tfloat csmx;\n\tfloat csmy;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\n\t\t// NOTE: Depth gets larger away from the camera.\n\t\t// cascade.x is closer, cascade.y is further\n\t\tcascade = CSM_cascades[ i ];\n\t\tcascadeCenter = ( cascade.x + cascade.y ) / 2.0;\n\t\tclosestEdge = linearDepth < cascadeCenter ? cascade.x : cascade.y;\n\t\tmargin = 0.25 * pow( closestEdge, 2.0 );\n\t\tcsmx = cascade.x - margin / 2.0;\n\t\tcsmy = cascade.y + margin / 2.0;\n\t\tif( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS && linearDepth >= csmx && ( linearDepth < csmy || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 ) ) {\n\n\t\t\tfloat dist = min( linearDepth - csmx, csmy - linearDepth );\n\t\t\tfloat ratio = clamp( dist / margin, 0.0, 1.0 );\n\t\t\tif( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS ) {\n\n\t\t\t\tvec3 prevColor = directLight.color;\n\t\t\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\t\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t\t\t\tbool shouldFadeLastCascade = UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth > cascadeCenter;\n\t\t\t\tdirectLight.color = mix( prevColor, directLight.color, shouldFadeLastCascade ? ratio : 1.0 );\n\n\t\t\t}\n\n\t\t\tReflectedLight prevLight = reflectedLight;\n\t\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t\t\tbool shouldBlend = UNROLLED_LOOP_INDEX != CSM_CASCADES - 1 || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth < cascadeCenter;\n\t\t\tfloat blendRatio = shouldBlend ? ratio : 1.0;\n\n\t\t\treflectedLight.directDiffuse = mix( prevLight.directDiffuse, reflectedLight.directDiffuse, blendRatio );\n\t\t\treflectedLight.directSpecular = mix( prevLight.directSpecular, reflectedLight.directSpecular, blendRatio );\n\t\t\treflectedLight.indirectDiffuse = mix( prevLight.indirectDiffuse, reflectedLight.indirectDiffuse, blendRatio );\n\t\t\treflectedLight.indirectSpecular = mix( prevLight.indirectSpecular, reflectedLight.indirectSpecular, blendRatio );\n\n\t\t}\n\n\t}\n\t#pragma unroll_loop_end\n\t#else\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tif(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y) directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t\t#endif\n\n\t\tif(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && (linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1)) RE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && !defined( USE_CSM ) && !defined( CSM_CASCADES )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_pars_begin:"\n#if defined( USE_CSM ) && defined( CSM_CASCADES )\nuniform vec2 CSM_cascades[CSM_CASCADES];\nuniform float cameraNear;\nuniform float shadowFar;\n#endif\n\t"+a.ShaderChunk.lights_pars_begin};const fa=new a.Matrix4,pa=new ha,ma=new a.Vector3,ga=new a.Box3,Aa=[],va=[];class ya{constructor(e){e=e||{},this.camera=e.camera,this.parent=e.parent,this.cascades=e.cascades||3,this.maxFar=e.maxFar||1e5,this.mode=e.mode||"practical",this.shadowMapSize=e.shadowMapSize||2048,this.shadowBias=e.shadowBias||1e-6,this.lightDirection=e.lightDirection||new a.Vector3(1,-1,1).normalize(),this.lightIntensity=e.lightIntensity||1,this.lightNear=e.lightNear||1,this.lightFar=e.lightFar||2e3,this.lightMargin=e.lightMargin||200,this.customSplitsCallback=e.customSplitsCallback,this.fade=!1,this.mainFrustum=new ha,this.frustums=[],this.breaks=[],this.lights=[],this.shaders=new Map,this.createLights(),this.updateFrustums(),this.injectInclude()}createLights(){for(let e=0;e<this.cascades;e++){const e=new a.DirectionalLight(16777215,this.lightIntensity);e.castShadow=!0,e.shadow.mapSize.width=this.shadowMapSize,e.shadow.mapSize.height=this.shadowMapSize,e.shadow.camera.near=this.lightNear,e.shadow.camera.far=this.lightFar,e.shadow.bias=this.shadowBias,this.parent.add(e),this.parent.add(e.target),this.lights.push(e)}}initCascades(){const e=this.camera;e.updateProjectionMatrix(),this.mainFrustum.setFromProjectionMatrix(e.projectionMatrix,this.maxFar),this.mainFrustum.split(this.breaks,this.frustums)}updateShadowBounds(){const e=this.frustums;for(let t=0;t<e.length;t++){const e=this.lights[t].shadow.camera,r=this.frustums[t],n=r.vertices.near,i=r.vertices.far,o=i[0];let a;a=o.distanceTo(i[2])>o.distanceTo(n[2])?i[2]:n[2];let s=o.distanceTo(a);if(this.fade){const e=this.camera,t=Math.max(e.far,this.maxFar),n=r.vertices.far[0].z/(t-e.near);s+=.25*Math.pow(n,2)*(t-e.near)}e.left=-s/2,e.right=s/2,e.top=s/2,e.bottom=-s/2,e.updateProjectionMatrix()}}getBreaks(){const e=this.camera,t=Math.min(e.far,this.maxFar);switch(this.breaks.length=0,this.mode){case"uniform":r(this.cascades,e.near,t,this.breaks);break;case"logarithmic":n(this.cascades,e.near,t,this.breaks);break;case"practical":!function(e,t,i,o,s){Aa.length=0,va.length=0,n(e,t,i,va),r(e,t,i,Aa);for(let r=1;r<e;r++)s.push(a.MathUtils.lerp(Aa[r-1],va[r-1],o));s.push(1)}(this.cascades,e.near,t,.5,this.breaks);break;case"custom":void 0===this.customSplitsCallback&&console.error("CSM: Custom split scheme callback not defined."),this.customSplitsCallback(this.cascades,e.near,t,this.breaks)}function r(e,t,r,n){for(let i=1;i<e;i++)n.push((t+(r-t)*i/e)/r);n.push(1)}function n(e,t,r,n){for(let i=1;i<e;i++)n.push(t*(r/t)**(i/e)/r);n.push(1)}}update(){const e=this.camera,t=this.frustums;for(let r=0;r<t.length;r++){const n=this.lights[r],i=n.shadow.camera,o=(i.right-i.left)/this.shadowMapSize,a=(i.top-i.bottom)/this.shadowMapSize;n.shadow.camera.updateMatrixWorld(!0),fa.multiplyMatrices(n.shadow.camera.matrixWorldInverse,e.matrixWorld),t[r].toSpace(fa,pa);const s=pa.vertices.near,l=pa.vertices.far;ga.makeEmpty();for(let e=0;e<4;e++)ga.expandByPoint(s[e]),ga.expandByPoint(l[e]);ga.getCenter(ma),ma.z=ga.max.z+this.lightMargin,ma.x=Math.floor(ma.x/o)*o,ma.y=Math.floor(ma.y/a)*a,ma.applyMatrix4(n.shadow.camera.matrixWorld),n.position.copy(ma),n.target.position.copy(ma),n.target.position.x+=this.lightDirection.x,n.target.position.y+=this.lightDirection.y,n.target.position.z+=this.lightDirection.z}}injectInclude(){a.ShaderChunk.lights_fragment_begin=da.lights_fragment_begin,a.ShaderChunk.lights_pars_begin=da.lights_pars_begin}setupMaterial(e){e.defines=e.defines||{},e.defines.USE_CSM=1,e.defines.CSM_CASCADES=this.cascades,this.fade&&(e.defines.CSM_FADE="");const t=[],r=this,n=this.shaders;e.onBeforeCompile=i=>{const o=Math.min(r.camera.far,r.maxFar);r.getExtendedBreaks(t),i.uniforms.CSM_cascades={value:t},i.uniforms.cameraNear={value:r.camera.near},i.uniforms.shadowFar={value:o},n.set(e,i)},n.set(e,null)}updateUniforms(){const e=Math.min(this.camera.far,this.maxFar);this.shaders.forEach((function(t,r){if(null!==t){const r=t.uniforms;this.getExtendedBreaks(r.CSM_cascades.value),r.cameraNear.value=this.camera.near,r.shadowFar.value=e}!this.fade&&"CSM_FADE"in r.defines?(delete r.defines.CSM_FADE,r.needsUpdate=!0):this.fade&&!("CSM_FADE"in r.defines)&&(r.defines.CSM_FADE="",r.needsUpdate=!0)}),this)}getExtendedBreaks(e){for(;e.length<this.breaks.length;)e.push(new a.Vector2);e.length=this.breaks.length;for(let t=0;t<this.cascades;t++){const r=this.breaks[t],n=this.breaks[t-1]||0;e[t].x=n,e[t].y=r}}updateFrustums(){this.getBreaks(),this.initCascades(),this.updateShadowBounds(),this.updateUniforms()}remove(){for(let e=0;e<this.lights.length;e++)this.parent.remove(this.lights[e])}dispose(){const e=this.shaders;e.forEach(((e,t)=>{delete t.onBeforeCompile,delete t.defines.USE_CSM,delete t.defines.CSM_CASCADES,delete t.defines.CSM_FADE,null!==e&&(delete e.uniforms.CSM_cascades,delete e.uniforms.cameraNear,delete e.uniforms.shadowFar),t.needsUpdate=!0})),e.clear()}}class xa extends a.Group{constructor(e){super(),this.csm=e,this.displayFrustum=!0,this.displayPlanes=!0,this.displayShadowBounds=!0;const t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new a.BufferGeometry;n.setIndex(new a.BufferAttribute(t,1)),n.setAttribute("position",new a.BufferAttribute(r,3,!1));const i=new a.LineSegments(n,new a.LineBasicMaterial);this.add(i),this.frustumLines=i,this.cascadeLines=[],this.cascadePlanes=[],this.shadowLines=[]}updateVisibility(){const e=this.displayFrustum,t=this.displayPlanes,r=this.displayShadowBounds,n=this.frustumLines,i=this.cascadeLines,o=this.cascadePlanes,a=this.shadowLines;for(let s=0,l=i.length;s<l;s++){const n=i[s],l=o[s],c=a[s];n.visible=e,l.visible=e&&t,c.visible=r}n.visible=e}update(){const e=this.csm,t=e.camera,r=e.cascades,n=e.mainFrustum,i=e.frustums,o=e.lights,s=this.frustumLines.geometry.getAttribute("position"),l=this.cascadeLines,c=this.cascadePlanes,u=this.shadowLines;for(this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.updateMatrixWorld(!0);l.length>r;)this.remove(l.pop()),this.remove(c.pop()),this.remove(u.pop());for(;l.length<r;){const e=new a.Box3Helper(new a.Box3,16777215),t=new a.MeshBasicMaterial({transparent:!0,opacity:.1,depthWrite:!1,side:a.DoubleSide}),r=new a.Mesh(new a.PlaneGeometry,t),n=new a.Group,i=new a.Box3Helper(new a.Box3,16776960);n.add(i),this.add(e),this.add(r),this.add(n),l.push(e),c.push(r),u.push(n)}for(let a=0;a<r;a++){const e=i[a],t=o[a].shadow.camera,r=e.vertices.far,n=l[a],s=c[a],h=u[a],d=h.children[0];n.box.min.copy(r[2]),n.box.max.copy(r[0]),n.box.max.z+=1e-4,s.position.addVectors(r[0],r[2]),s.position.multiplyScalar(.5),s.scale.subVectors(r[0],r[2]),s.scale.z=1e-4,this.remove(h),h.position.copy(t.position),h.quaternion.copy(t.quaternion),h.scale.copy(t.scale),h.updateMatrixWorld(!0),this.attach(h),d.box.min.set(t.bottom,t.left,-t.far),d.box.max.set(t.top,t.right,-t.near)}const h=n.vertices.near,d=n.vertices.far;s.setXYZ(0,d[0].x,d[0].y,d[0].z),s.setXYZ(1,d[3].x,d[3].y,d[3].z),s.setXYZ(2,d[2].x,d[2].y,d[2].z),s.setXYZ(3,d[1].x,d[1].y,d[1].z),s.setXYZ(4,h[0].x,h[0].y,h[0].z),s.setXYZ(5,h[3].x,h[3].y,h[3].z),s.setXYZ(6,h[2].x,h[2].y,h[2].z),s.setXYZ(7,h[1].x,h[1].y,h[1].z),s.needsUpdate=!0}}var ba={uniforms:{tInput:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tInput;","void main() {","\tgl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );","}"].join("\n")},wa={uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new a.Vector3}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec3 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","\tvec2 delta = vSunPositionScreenSpace.xy - vUv;","\tfloat dist = length( delta );","\tvec2 stepv = fStepSize * delta / dist;","\tfloat iters = dist/fStepSize;","\tvec2 uv = vUv.xy;","\tfloat col = 0.0;","\tfloat f = min( 1.0, max( vSunPositionScreenSpace.z / 1000.0, 0.0 ) );","\tif ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tif ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tif ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tif ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tif ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tif ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tgl_FragColor = vec4( col/TAPS_PER_PASS );","\tgl_FragColor.a = 1.0;","}"].join("\n")},Ca={uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform float fGodRayIntensity;","void main() {","\tgl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","\tgl_FragColor.a = 1.0;","}"].join("\n")},Ea={uniforms:{vSunPositionScreenSpace:{value:new a.Vector3},fAspect:{value:1},sunColor:{value:new a.Color(16772608)},bgColor:{value:new a.Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec3 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","\tvec2 diff = vUv - vSunPositionScreenSpace.xy;","\tdiff.x *= fAspect;","\tfloat prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","\tprop = 0.35 * pow( 1.0 - prop, 3.0 );","\tgl_FragColor.xyz = ( vSunPositionScreenSpace.z > 0.0 ) ? mix( sunColor, bgColor, 1.0 - prop ) : bgColor;","\tgl_FragColor.w = 1.0;","}"].join("\n")},Sa={uniforms:{tDiffuse:{value:null},side:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform int side;","varying vec2 vUv;","void main() {","\tvec2 p = vUv;","\tif (side == 0){","\t\tif (p.x > 0.5) p.x = 1.0 - p.x;","\t}else if (side == 1){","\t\tif (p.x < 0.5) p.x = 1.0 - p.x;","\t}else if (side == 2){","\t\tif (p.y < 0.5) p.y = 1.0 - p.y;","\t}else if (side == 3){","\t\tif (p.y > 0.5) p.y = 1.0 - p.y;","\t} ","\tvec4 color = texture2D(tDiffuse, p);","\tgl_FragColor = color;","}"].join("\n")},Ta={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 base = texture2D( tDiffuse, vUv );","\tvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","\tfloat lum = dot( lumCoeff, base.rgb );","\tvec3 blend = vec3( lum );","\tfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","\tvec3 result1 = 2.0 * base.rgb * blend;","\tvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","\tvec3 newColor = mix( result1, result2, L );","\tfloat A2 = opacity * base.a;","\tvec3 mixRGB = A2 * newColor.rgb;","\tmixRGB += ( ( 1.0 - A2 ) * base.rgb );","\tgl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")},Ma={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","\tvec4 texel1 = texture2D( tDiffuse1, vUv );","\tvec4 texel2 = texture2D( tDiffuse2, vUv );","\tgl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},Ia={uniforms:{tDiffuse:{value:null},sides:{value:6},angle:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float sides;","uniform float angle;","varying vec2 vUv;","void main() {","\tvec2 p = vUv - 0.5;","\tfloat r = length(p);","\tfloat a = atan(p.y, p.x) + angle;","\tfloat tau = 2. * 3.1416 ;","\ta = mod(a, tau/sides);","\ta = abs(a - tau/sides/2.) ;","\tp = r * vec2(cos(a), sin(a));","\tvec4 color = texture2D(tDiffuse, p + 0.5);","\tgl_FragColor = color;","}"].join("\n")},Ba={uniforms:{tDiffuse:{value:null},exposure:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define saturate(a) clamp( a, 0.0, 1.0 )","uniform sampler2D tDiffuse;","uniform float exposure;","varying vec2 vUv;","vec3 RRTAndODTFit( vec3 v ) {","\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;","\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;","\treturn a / b;","}","vec3 ACESFilmicToneMapping( vec3 color ) {","\tconst mat3 ACESInputMat = mat3(","\t\tvec3( 0.59719, 0.07600, 0.02840 ),","\t\tvec3( 0.35458, 0.90834, 0.13383 ),","\t\tvec3( 0.04823, 0.01566, 0.83777 )","\t);","\tconst mat3 ACESOutputMat = mat3(","\t\tvec3(  1.60475, -0.10208, -0.00327 ),","\t\tvec3( -0.53108,  1.10813, -0.07276 ),","\t\tvec3( -0.07367, -0.00605,  1.07602 )","\t);","\tcolor = ACESInputMat * color;","\tcolor = RRTAndODTFit( color );","\tcolor = ACESOutputMat * color;","\treturn saturate( color );","}","void main() {","\tvec4 tex = texture2D( tDiffuse, vUv );","\ttex.rgb *= exposure / 0.6;","\tgl_FragColor = vec4( ACESFilmicToneMapping( tex.rgb ), tex.a );","}"].join("\n")},_a={modes:{none:"NO_PARALLAX",basic:"USE_BASIC_PARALLAX",steep:"USE_STEEP_PARALLAX",occlusion:"USE_OCLUSION_PARALLAX",relief:"USE_RELIEF_PARALLAX"},uniforms:{bumpMap:{value:null},map:{value:null},parallaxScale:{value:null},parallaxMinLayers:{value:null},parallaxMaxLayers:{value:null}},vertexShader:["varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","void main() {","\tvUv = uv;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvViewPosition = -mvPosition.xyz;","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D bumpMap;","uniform sampler2D map;","uniform float parallaxScale;","uniform float parallaxMinLayers;","uniform float parallaxMaxLayers;","varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","#ifdef USE_BASIC_PARALLAX","\tvec2 parallaxMap( in vec3 V ) {","\t\tfloat initialHeight = texture2D( bumpMap, vUv ).r;","\t\tvec2 texCoordOffset = parallaxScale * V.xy * initialHeight;","\t\treturn vUv - texCoordOffset;","\t}","#else","\tvec2 parallaxMap( in vec3 V ) {","\t\tfloat numLayers = mix( parallaxMaxLayers, parallaxMinLayers, abs( dot( vec3( 0.0, 0.0, 1.0 ), V ) ) );","\t\tfloat layerHeight = 1.0 / numLayers;","\t\tfloat currentLayerHeight = 0.0;","\t\tvec2 dtex = parallaxScale * V.xy / V.z / numLayers;","\t\tvec2 currentTextureCoords = vUv;","\t\tfloat heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","\t\tfor ( int i = 0; i < 30; i += 1 ) {","\t\t\tif ( heightFromTexture <= currentLayerHeight ) {","\t\t\t\tbreak;","\t\t\t}","\t\t\tcurrentLayerHeight += layerHeight;","\t\t\tcurrentTextureCoords -= dtex;","\t\t\theightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","\t\t}","\t\t#ifdef USE_STEEP_PARALLAX","\t\t\treturn currentTextureCoords;","\t\t#elif defined( USE_RELIEF_PARALLAX )","\t\t\tvec2 deltaTexCoord = dtex / 2.0;","\t\t\tfloat deltaHeight = layerHeight / 2.0;","\t\t\tcurrentTextureCoords += deltaTexCoord;","\t\t\tcurrentLayerHeight -= deltaHeight;","\t\t\tconst int numSearches = 5;","\t\t\tfor ( int i = 0; i < numSearches; i += 1 ) {","\t\t\t\tdeltaTexCoord /= 2.0;","\t\t\t\tdeltaHeight /= 2.0;","\t\t\t\theightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","\t\t\t\tif( heightFromTexture > currentLayerHeight ) {","\t\t\t\t\tcurrentTextureCoords -= deltaTexCoord;","\t\t\t\t\tcurrentLayerHeight += deltaHeight;","\t\t\t\t} else {","\t\t\t\t\tcurrentTextureCoords += deltaTexCoord;","\t\t\t\t\tcurrentLayerHeight -= deltaHeight;","\t\t\t\t}","\t\t\t}","\t\t\treturn currentTextureCoords;","\t\t#elif defined( USE_OCLUSION_PARALLAX )","\t\t\tvec2 prevTCoords = currentTextureCoords + dtex;","\t\t\tfloat nextH = heightFromTexture - currentLayerHeight;","\t\t\tfloat prevH = texture2D( bumpMap, prevTCoords ).r - currentLayerHeight + layerHeight;","\t\t\tfloat weight = nextH / ( nextH - prevH );","\t\t\treturn prevTCoords * weight + currentTextureCoords * ( 1.0 - weight );","\t\t#else","\t\t\treturn vUv;","\t\t#endif","\t}","#endif","vec2 perturbUv( vec3 surfPosition, vec3 surfNormal, vec3 viewPosition ) {","\tvec2 texDx = dFdx( vUv );","\tvec2 texDy = dFdy( vUv );","\tvec3 vSigmaX = dFdx( surfPosition );","\tvec3 vSigmaY = dFdy( surfPosition );","\tvec3 vR1 = cross( vSigmaY, surfNormal );","\tvec3 vR2 = cross( surfNormal, vSigmaX );","\tfloat fDet = dot( vSigmaX, vR1 );","\tvec2 vProjVscr = ( 1.0 / fDet ) * vec2( dot( vR1, viewPosition ), dot( vR2, viewPosition ) );","\tvec3 vProjVtex;","\tvProjVtex.xy = texDx * vProjVscr.x + texDy * vProjVscr.y;","\tvProjVtex.z = dot( surfNormal, viewPosition );","\treturn parallaxMap( vProjVtex );","}","void main() {","\tvec2 mapUv = perturbUv( -vViewPosition, normalize( vNormal ), normalize( vViewPosition ) );","\tgl_FragColor = texture2D( map, mapUv );","}"].join("\n")},Fa=r(5396),Pa={uniforms:{tDiffuse:{value:null},powRGB:{value:new a.Vector3(2,2,2)},mulRGB:{value:new a.Vector3(1,1,1)},addRGB:{value:new a.Vector3(0,0,0)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","uniform vec3 addRGB;","varying vec2 vUv;","void main() {","\tgl_FragColor = texture2D( tDiffuse, vUv );","\tgl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );","}"].join("\n")},Ra={uniforms:{tDiffuse:{value:null},resolution:{value:null},pixelSize:{value:1}},vertexShader:["varying highp vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float pixelSize;","uniform vec2 resolution;","varying highp vec2 vUv;","void main(){","vec2 dxy = pixelSize / resolution;","vec2 coord = dxy * floor( vUv / dxy );","gl_FragColor = texture2D(tDiffuse, coord);","}"].join("\n")},La={uniforms:{tDiffuse:{value:null},screenWidth:{value:1024},screenHeight:{value:1024},sampleDistance:{value:.94},waveFactor:{value:.00125}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 color, org, tmp, add;","\tfloat sample_dist, f;","\tvec2 vin;","\tvec2 uv = vUv;","\tadd = color = org = texture2D( tDiffuse, uv );","\tvin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","\tsample_dist = dot( vin, vin ) * 2.0;","\tf = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","\tvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","\tadd += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tadd += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","\tif( tmp.b < color.b ) color = tmp;","\tcolor = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","\tcolor = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","\tgl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n")},Da={uniforms:{color:{value:null},time:{value:0},tDiffuse:{value:null},tDudv:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec2 vUv;","varying vec4 vUvRefraction;","void main() {","\tvUv = uv;","\tvUvRefraction = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform float time;","uniform sampler2D tDiffuse;","uniform sampler2D tDudv;","varying vec2 vUv;","varying vec4 vUvRefraction;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );","}","void main() {"," float waveStrength = 0.1;"," float waveSpeed = 0.03;","\tvec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;","\tdistortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );","\tvec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;"," vec4 uv = vec4( vUvRefraction );"," uv.xy += distortion;","\tvec4 base = texture2DProj( tDiffuse, uv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},Na={uniforms:{tDiffuse:{value:null},amount:{value:.005},angle:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","\tvec2 offset = amount * vec2( cos(angle), sin(angle));","\tvec4 cr = texture2D(tDiffuse, vUv + offset);","\tvec4 cga = texture2D(tDiffuse, vUv);","\tvec4 cb = texture2D(tDiffuse, vUv - offset);","\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n")},ka={uniforms:{texture:{value:null},delta:{value:new a.Vector2(1,1)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","void main() {","\tvec4 color = vec4( 0.0 );","\tfloat total = 0.0;","\tfloat offset = rand( vUv );","\tfor ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","\t\tfloat percent = ( t + offset - 0.5 ) / ITERATIONS;","\t\tfloat weight = 1.0 - abs( percent );","\t\tcolor += texture2D( texture, vUv + delta * percent ) * weight;","\t\ttotal += weight;","\t}","\tgl_FragColor = color / total;","}"].join("\n")},Oa={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 color = texture2D( tDiffuse, vUv );","\tvec3 c = color.rgb;","\tcolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","\tcolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","\tcolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","\tgl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")},Ua={uniforms:{tDiffuse:{value:null},resolution:{value:new a.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")};var Qa,Va,Ga,za=a.ShaderChunk.meshphong_frag.slice(0,a.ShaderChunk.meshphong_frag.indexOf("void main() {")),ja=a.ShaderChunk.meshphong_frag.slice(a.ShaderChunk.meshphong_frag.indexOf("void main() {")),Ha={uniforms:a.UniformsUtils.merge([a.ShaderLib.phong.uniforms,{thicknessMap:{value:null},thicknessColor:{value:new a.Color(16777215)},thicknessDistortion:{value:.1},thicknessAmbient:{value:0},thicknessAttenuation:{value:.1},thicknessPower:{value:2},thicknessScale:{value:10}}]),vertexShader:["#define USE_UV",a.ShaderChunk.meshphong_vert].join("\n"),fragmentShader:["#define USE_UV","#define SUBSURFACE",za,"uniform sampler2D thicknessMap;","uniform float thicknessPower;","uniform float thicknessScale;","uniform float thicknessDistortion;","uniform float thicknessAmbient;","uniform float thicknessAttenuation;","uniform vec3 thicknessColor;","void RE_Direct_Scattering(const in IncidentLight directLight, const in vec2 uv, const in GeometricContext geometry, inout ReflectedLight reflectedLight) {","\tvec3 thickness = thicknessColor * texture2D(thicknessMap, uv).r;","\tvec3 scatteringHalf = normalize(directLight.direction + (geometry.normal * thicknessDistortion));","\tfloat scatteringDot = pow(saturate(dot(geometry.viewDir, -scatteringHalf)), thicknessPower) * thicknessScale;","\tvec3 scatteringIllu = (scatteringDot + thicknessAmbient) * thickness;","\treflectedLight.directDiffuse += scatteringIllu * thicknessAttenuation * directLight.color;","}",ja.replace("#include <lights_fragment_begin>",(Qa=a.ShaderChunk.lights_fragment_begin,Va="RE_Direct( directLight, geometry, material, reflectedLight );",Ga=["RE_Direct( directLight, geometry, material, reflectedLight );","#if defined( SUBSURFACE ) && defined( USE_UV )"," RE_Direct_Scattering(directLight, vUv, geometry, reflectedLight);","#endif"].join("\n"),Qa.split(Va).join(Ga)))].join("\n")},Wa={uniforms:{uDirLightPos:{value:new a.Vector3},uDirLightColor:{value:new a.Color(15658734)},uAmbientLightColor:{value:new a.Color(328965)},uBaseColor:{value:new a.Color(16777215)}},vertexShader:["varying vec3 vNormal;","varying vec3 vRefract;","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","\tvNormal = normalize( normalMatrix * normal );","\tvec3 I = worldPosition.xyz - cameraPosition;","\tvRefract = refract( normalize( I ), worldNormal, 1.02 );","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","varying vec3 vRefract;","void main() {","\tfloat directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","\tvec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","\tfloat intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );","\tintensity += length(lightWeighting) * 0.2;","\tfloat cameraWeighting = dot( normalize( vNormal ), vRefract );","\tintensity += pow( 1.0 - length( cameraWeighting ), 6.0 );","\tintensity = intensity * 0.2 + 0.3;","\tif ( intensity < 0.50 ) {","\t\tgl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );","\t} else {","\t\tgl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );","}","}"].join("\n")},Za={uniforms:{uDirLightPos:{value:new a.Vector3},uDirLightColor:{value:new a.Color(15658734)},uAmbientLightColor:{value:new a.Color(328965)},uBaseColor:{value:new a.Color(15658734)},uLineColor1:{value:new a.Color(8421504)},uLineColor2:{value:new a.Color(0)},uLineColor3:{value:new a.Color(0)},uLineColor4:{value:new a.Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","\tfloat camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);","\tfloat light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","\tgl_FragColor = vec4( uBaseColor, 1.0 );","\tif ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {","\t\tgl_FragColor *= vec4( uLineColor1, 1.0 );","\t}","\tif ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {","\t\tgl_FragColor *= vec4( uLineColor2, 1.0 );","\t}","}"].join("\n")},Xa={uniforms:{uDirLightPos:{value:new a.Vector3},uDirLightColor:{value:new a.Color(15658734)},uAmbientLightColor:{value:new a.Color(328965)},uBaseColor:{value:new a.Color(16777215)},uLineColor1:{value:new a.Color(0)},uLineColor2:{value:new a.Color(0)},uLineColor3:{value:new a.Color(0)},uLineColor4:{value:new a.Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","\tfloat directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","\tvec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","\tgl_FragColor = vec4( uBaseColor, 1.0 );","\tif ( length(lightWeighting) < 1.00 ) {","\t\tif ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","\t\t\tgl_FragColor = vec4( uLineColor1, 1.0 );","\t\t}","\t}","\tif ( length(lightWeighting) < 0.75 ) {","\t\tif (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","\t\t\tgl_FragColor = vec4( uLineColor2, 1.0 );","\t\t}","\t}","\tif ( length(lightWeighting) < 0.50 ) {","\t\tif (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","\t\t\tgl_FragColor = vec4( uLineColor3, 1.0 );","\t\t}","\t}","\tif ( length(lightWeighting) < 0.3465 ) {","\t\tif (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","\t\t\tgl_FragColor = vec4( uLineColor4, 1.0 );","\t}","\t}","}"].join("\n")},Ya={uniforms:{uDirLightPos:{value:new a.Vector3},uDirLightColor:{value:new a.Color(15658734)},uAmbientLightColor:{value:new a.Color(328965)},uBaseColor:{value:new a.Color(16777215)},uLineColor1:{value:new a.Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","\t\tif ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {","\t\t\tgl_FragColor = vec4( uLineColor1, 1.0 );","\t\t}","\t}","\tif ( length(lightWeighting) < 0.50 ) {","\t\tif ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {","\t\t\tgl_FragColor = vec4( uLineColor1, 1.0 );","\t\t}","\t}","}"].join("\n")},Ja={uniforms:{heightMap:{value:null},resolution:{value:new a.Vector2(512,512)},scale:{value:new a.Vector2(1,1)},height:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","\tfloat val = texture2D( heightMap, vUv ).x;","\tfloat valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","\tfloat valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","\tgl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},qa={uniforms:{tDiffuse:{value:null},aspect:{value:new a.Vector2(512,512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 aspect;","vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","\tG[0] = g0,","\tG[1] = g1,","\tG[2] = g2,","\tG[3] = g3,","\tG[4] = g4,","\tG[5] = g5,","\tG[6] = g6,","\tG[7] = g7,","\tG[8] = g8;","\tmat3 I;","\tfloat cnv[9];","\tvec3 sample;","\tfor (float i=0.0; i<3.0; i++) {","\t\tfor (float j=0.0; j<3.0; j++) {","\t\t\tsample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;","\t\t\tI[int(i)][int(j)] = length(sample);","\t\t}","\t}","\tfor (int i=0; i<9; i++) {","\t\tfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","\t\tcnv[i] = dp3 * dp3;","\t}","\tfloat M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","\tfloat S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","\tgl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n")},Ka={uniforms:{u_size:{value:new a.Vector3(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new a.Vector2(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:["\t\tvarying vec4 v_nearpos;","\t\tvarying vec4 v_farpos;","\t\tvarying vec3 v_position;","\t\tvoid main() {","\t\t\t\tmat4 viewtransformf = modelViewMatrix;","\t\t\t\tmat4 viewtransformi = inverse(modelViewMatrix);","\t\t\t\tvec4 position4 = vec4(position, 1.0);","\t\t\t\tvec4 pos_in_cam = viewtransformf * position4;","\t\t\t\tpos_in_cam.z = -pos_in_cam.w;","\t\t\t\tv_nearpos = viewtransformi * pos_in_cam;","\t\t\t\tpos_in_cam.z = pos_in_cam.w;","\t\t\t\tv_farpos = viewtransformi * pos_in_cam;","\t\t\t\tv_position = position;","\t\t\t\tgl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;","\t\t}"].join("\n"),fragmentShader:["\t\tprecision highp float;","\t\tprecision mediump sampler3D;","\t\tuniform vec3 u_size;","\t\tuniform int u_renderstyle;","\t\tuniform float u_renderthreshold;","\t\tuniform vec2 u_clim;","\t\tuniform sampler3D u_data;","\t\tuniform sampler2D u_cmdata;","\t\tvarying vec3 v_position;","\t\tvarying vec4 v_nearpos;","\t\tvarying vec4 v_farpos;","\t\tconst int MAX_STEPS = 887;\t// 887 for 512^3, 1774 for 1024^3","\t\tconst int REFINEMENT_STEPS = 4;","\t\tconst float relative_step_size = 1.0;","\t\tconst vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);","\t\tconst vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);","\t\tconst vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);","\t\tconst float shininess = 40.0;","\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","\t\tfloat sample1(vec3 texcoords);","\t\tvec4 apply_colormap(float val);","\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);","\t\tvoid main() {","\t\t\t\tvec3 farpos = v_farpos.xyz / v_farpos.w;","\t\t\t\tvec3 nearpos = v_nearpos.xyz / v_nearpos.w;","\t\t\t\tvec3 view_ray = normalize(nearpos.xyz - farpos.xyz);","\t\t\t\tfloat distance = dot(nearpos - v_position, view_ray);","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.x) / view_ray.x,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.x - 0.5 - v_position.x) / view_ray.x));","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.y) / view_ray.y,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.y - 0.5 - v_position.y) / view_ray.y));","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.z) / view_ray.z,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.z - 0.5 - v_position.z) / view_ray.z));","\t\t\t\tvec3 front = v_position + view_ray * distance;","\t\t\t\tint nsteps = int(-distance / relative_step_size + 0.5);","\t\t\t\tif ( nsteps < 1 )","\t\t\t\t\t\tdiscard;","\t\t\t\tvec3 step = ((v_position - front) / u_size) / float(nsteps);","\t\t\t\tvec3 start_loc = front / u_size;","\t\t\t\tif (u_renderstyle == 0)","\t\t\t\t\t\tcast_mip(start_loc, step, nsteps, view_ray);","\t\t\t\telse if (u_renderstyle == 1)","\t\t\t\t\t\tcast_iso(start_loc, step, nsteps, view_ray);","\t\t\t\tif (gl_FragColor.a < 0.05)","\t\t\t\t\t\tdiscard;","\t\t}","\t\tfloat sample1(vec3 texcoords) {","\t\t\t\t/* Sample float value from a 3D texture. Assumes intensity data. */","\t\t\t\treturn texture(u_data, texcoords.xyz).r;","\t\t}","\t\tvec4 apply_colormap(float val) {","\t\t\t\tval = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);","\t\t\t\treturn texture2D(u_cmdata, vec2(val, 0.5));","\t\t}","\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","\t\t\t\tfloat max_val = -1e6;","\t\t\t\tint max_i = 100;","\t\t\t\tvec3 loc = start_loc;","\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {","\t\t\t\t\t\tif (iter >= nsteps)","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tfloat val = sample1(loc);","\t\t\t\t\t\tif (val > max_val) {","\t\t\t\t\t\t\t\tmax_val = val;","\t\t\t\t\t\t\t\tmax_i = iter;","\t\t\t\t\t\t}","\t\t\t\t\t\tloc += step;","\t\t\t\t}","\t\t\t\tvec3 iloc = start_loc + step * (float(max_i) - 0.5);","\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);","\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {","\t\t\t\t\t\tmax_val = max(max_val, sample1(iloc));","\t\t\t\t\t\tiloc += istep;","\t\t\t\t}","\t\t\t\tgl_FragColor = apply_colormap(max_val);","\t\t}","\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","\t\t\t\tgl_FragColor = vec4(0.0);\t// init transparent","\t\t\t\tvec4 color3 = vec4(0.0);\t// final color","\t\t\t\tvec3 dstep = 1.5 / u_size;\t// step to sample derivative","\t\t\t\tvec3 loc = start_loc;","\t\t\t\tfloat low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);","\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {","\t\t\t\t\t\tif (iter >= nsteps)","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tfloat val = sample1(loc);","\t\t\t\t\t\tif (val > low_threshold) {","\t\t\t\t\t\t\t\tvec3 iloc = loc - 0.5 * step;","\t\t\t\t\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);","\t\t\t\t\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {","\t\t\t\t\t\t\t\t\t\tval = sample1(iloc);","\t\t\t\t\t\t\t\t\t\tif (val > u_renderthreshold) {","\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor = add_lighting(val, iloc, dstep, view_ray);","\t\t\t\t\t\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\t\t\tiloc += istep;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tloc += step;","\t\t\t\t}","\t\t}","\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)","\t\t{","\t\t\t\tvec3 V = normalize(view_ray);","\t\t\t\tvec3 N;","\t\t\t\tfloat val1, val2;","\t\t\t\tval1 = sample1(loc + vec3(-step[0], 0.0, 0.0));","\t\t\t\tval2 = sample1(loc + vec3(+step[0], 0.0, 0.0));","\t\t\t\tN[0] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tval1 = sample1(loc + vec3(0.0, -step[1], 0.0));","\t\t\t\tval2 = sample1(loc + vec3(0.0, +step[1], 0.0));","\t\t\t\tN[1] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tval1 = sample1(loc + vec3(0.0, 0.0, -step[2]));","\t\t\t\tval2 = sample1(loc + vec3(0.0, 0.0, +step[2]));","\t\t\t\tN[2] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tfloat gm = length(N); // gradient magnitude","\t\t\t\tN = normalize(N);","\t\t\t\tfloat Nselect = float(dot(N, V) > 0.0);","\t\t\t\tN = (2.0 * Nselect - 1.0) * N;\t// ==\tNselect * N - (1.0-Nselect)*N;","\t\t\t\tvec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tvec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tvec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tfor (int i=0; i<1; i++)","\t\t\t\t{","\t\t\t\t\t\tvec3 L = normalize(view_ray);\t//lightDirs[i];","\t\t\t\t\t\tfloat lightEnabled = float( length(L) > 0.0 );","\t\t\t\t\t\tL = normalize(L + (1.0 - lightEnabled));","\t\t\t\t\t\tfloat lambertTerm = clamp(dot(N, L), 0.0, 1.0);","\t\t\t\t\t\tvec3 H = normalize(L+V); // Halfway vector","\t\t\t\t\t\tfloat specularTerm = pow(max(dot(H, N), 0.0), shininess);","\t\t\t\t\t\tfloat mask1 = lightEnabled;","\t\t\t\t\t\tambient_color +=\tmask1 * ambient_color;\t// * gl_LightSource[i].ambient;","\t\t\t\t\t\tdiffuse_color +=\tmask1 * lambertTerm;","\t\t\t\t\t\tspecular_color += mask1 * specularTerm * specular_color;","\t\t\t\t}","\t\t\t\tvec4 final_color;","\t\t\t\tvec4 color = apply_colormap(val);","\t\t\t\tfinal_color = color * (ambient_color + diffuse_color) + specular_color;","\t\t\t\tfinal_color.a = color.a;","\t\t\t\treturn final_color;","\t\t}"].join("\n")},$a={uniforms:{tDiffuse:{value:null},h:{value:1/512},r:{value:.35}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","\tvec4 sum = vec4( 0.0 );","\tfloat hh = h * abs( r - vUv.y );","\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","\tgl_FragColor = sum;","}"].join("\n")},es={uniforms:{tDiffuse:{value:null},v:{value:1/512},r:{value:.35}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","\tvec4 sum = vec4( 0.0 );","\tfloat vv = v * abs( r - vUv.y );","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","\tgl_FragColor = sum;","}"].join("\n")},ts={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","varying vec2 vUv;","void main() {","\tgl_FragColor = texture2D( tDiffuse, vUv );","\tgl_FragColor.rgb += brightness;","\tif (contrast > 0.0) {","\t\tgl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","\t} else {","\t\tgl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","\t}","}"].join("\n")},rs={uniforms:{tDiffuse:{value:null},resolution:{value:new a.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );","\tconst mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 );","\tconst mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 );","\tfloat tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;","\tfloat tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;","\tfloat tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;","\tfloat tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;","\tfloat tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;","\tfloat tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;","\tfloat tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;","\tfloat tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;","\tfloat tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;","\tfloat valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 + ","\t\tGx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 + ","\t\tGx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2; ","\tfloat valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 + ","\t\tGy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 + ","\t\tGy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2; ","\tfloat G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );","\tgl_FragColor = vec4( vec3( G ), 1 );","}"].join("\n")},ns=r(6015),is={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","\tgl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},os=r(9215),as={uniforms:{mRefractionRatio:{value:1.02},mFresnelBias:{value:.1},mFresnelPower:{value:2},mFresnelScale:{value:1},tCube:{value:null}},vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","\tvec3 I = worldPosition.xyz - cameraPosition;","\tvReflect = reflect( I, worldNormal );","\tvRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","\tvRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","\tvRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","\tvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","\tvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","\tvec4 refractedColor = vec4( 1.0 );","\trefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","\trefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","\trefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","\tgl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n")},ss={uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","varying vec2 vUv;","void main() {","\tgl_FragColor = texture2D( tDiffuse, vUv );","\tfloat angle = hue * 3.14159265;","\tfloat s = sin(angle), c = cos(angle);","\tvec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","\tfloat len = length(gl_FragColor.rgb);","\tgl_FragColor.rgb = vec3(","\t\tdot(gl_FragColor.rgb, weights.xyz),","\t\tdot(gl_FragColor.rgb, weights.zxy),","\t\tdot(gl_FragColor.rgb, weights.yzx)","\t);","\tfloat average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","\tif (saturation > 0.0) {","\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));","\t} else {","\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);","\t}","}"].join("\n")},ls={uniforms:{},vertexShader:["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n")},cs={uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},maxblur:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","\tvec4 depth = texture2D( tDepth, vUv );","\tfloat factor = depth.x - focus;","\tvec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","\tgl_FragColor = col;","\tgl_FragColor.a = 1.0;","}"].join("\n")},us={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","\tvec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);","\tgl_FragColor = newTex;","}"].join("\n")},hs={uniforms:{tDiffuse:{value:null},color:{value:new a.Color(16777215)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tgl_FragColor = vec4( v * color, texel.w );","}"].join("\n")};const ds=class{constructor(e,t,r){this.element=document.createElement("div"),this.element.classList.add(r),this.element.style.pointerEvents="none",this.renderer=t,this.startPoint=new a.Vector2,this.pointTopLeft=new a.Vector2,this.pointBottomRight=new a.Vector2,this.isDown=!1,this.renderer.domElement.addEventListener("pointerdown",(e=>{this.isDown=!0,this.onSelectStart(e)})),this.renderer.domElement.addEventListener("pointermove",(e=>{this.isDown&&this.onSelectMove(e)})),this.renderer.domElement.addEventListener("pointerup",(e=>{this.isDown=!1,this.onSelectOver(e)}))}onSelectStart(e){this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=`${e.clientX}px`,this.element.style.top=`${e.clientY}px`,this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=e.clientX,this.startPoint.y=e.clientY}onSelectMove(e){this.pointBottomRight.x=Math.max(this.startPoint.x,e.clientX),this.pointBottomRight.y=Math.max(this.startPoint.y,e.clientY),this.pointTopLeft.x=Math.min(this.startPoint.x,e.clientX),this.pointTopLeft.y=Math.min(this.startPoint.y,e.clientY),this.element.style.left=`${this.pointTopLeft.x}px`,this.element.style.top=`${this.pointTopLeft.y}px`,this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px"}onSelectOver(){this.element.parentElement.removeChild(this.element)}};var fs=r(6723);async function ps(){if("Ammo"in window===!1)return void console.error("AmmoPhysics: Couldn't find Ammo.js");const e=await Ammo(),t=new e.btDefaultCollisionConfiguration,r=new e.btCollisionDispatcher(t),n=new e.btDbvtBroadphase,i=new e.btSequentialImpulseConstraintSolver,o=new e.btDiscreteDynamicsWorld(r,n,i,t);o.setGravity(new e.btVector3(0,-9.8,0));const a=new e.btTransform;const s=[],l=new WeakMap;let c=0;return setInterval((function(){const e=performance.now();if(c>0){const t=(e-c)/1e3;o.stepSimulation(t,10)}c=e;for(let t=0,r=s.length;t<r;t++){const e=s[t];if(e.isInstancedMesh){const t=e.instanceMatrix.array,r=l.get(e);for(let e=0;e<r.length;e++){r[e].getMotionState().getWorldTransform(a);ms(a.getOrigin(),a.getRotation(),t,16*e)}e.instanceMatrix.needsUpdate=!0}else if(e.isMesh){l.get(e).getMotionState().getWorldTransform(a);const t=a.getOrigin(),r=a.getRotation();e.position.set(t.x(),t.y(),t.z()),e.quaternion.set(r.x(),r.y(),r.z(),r.w())}}}),1e3/60),{addMesh:function(t,r=0){const n=function(t){const r=t.parameters;if("BoxGeometry"===t.type){const t=void 0!==r.width?r.width/2:.5,n=void 0!==r.height?r.height/2:.5,i=void 0!==r.depth?r.depth/2:.5,o=new e.btBoxShape(new e.btVector3(t,n,i));return o.setMargin(.05),o}if("SphereGeometry"===t.type||"IcosahedronGeometry"===t.type){const t=void 0!==r.radius?r.radius:1,n=new e.btSphereShape(t);return n.setMargin(.05),n}return null}(t.geometry);null!==n&&(t.isInstancedMesh?function(t,r,n){const i=t.instanceMatrix.array,a=[];for(let s=0;s<t.count;s++){const t=16*s,l=new e.btTransform;l.setFromOpenGLMatrix(i.slice(t,t+16));const c=new e.btDefaultMotionState(l),u=new e.btVector3(0,0,0);n.calculateLocalInertia(r,u);const h=new e.btRigidBodyConstructionInfo(r,c,n,u),d=new e.btRigidBody(h);o.addRigidBody(d),a.push(d)}r>0&&(t.instanceMatrix.setUsage(35048),s.push(t),l.set(t,a))}(t,r,n):t.isMesh&&function(t,r,n){const i=t.position,a=t.quaternion,c=new e.btTransform;c.setIdentity(),c.setOrigin(new e.btVector3(i.x,i.y,i.z)),c.setRotation(new e.btQuaternion(a.x,a.y,a.z,a.w));const u=new e.btDefaultMotionState(c),h=new e.btVector3(0,0,0);n.calculateLocalInertia(r,h);const d=new e.btRigidBodyConstructionInfo(r,u,n,h),f=new e.btRigidBody(d);o.addRigidBody(f),r>0&&(s.push(t),l.set(t,f))}(t,r,n))},setMeshPosition:function(t,r,n=0){if(t.isInstancedMesh){const i=l.get(t)[n];i.setAngularVelocity(new e.btVector3(0,0,0)),i.setLinearVelocity(new e.btVector3(0,0,0)),a.setIdentity(),a.setOrigin(new e.btVector3(r.x,r.y,r.z)),i.setWorldTransform(a)}else if(t.isMesh){const n=l.get(t);n.setAngularVelocity(new e.btVector3(0,0,0)),n.setLinearVelocity(new e.btVector3(0,0,0)),a.setIdentity(),a.setOrigin(new e.btVector3(r.x,r.y,r.z)),n.setWorldTransform(a)}}}}function ms(e,t,r,n){const i=t.x(),o=t.y(),a=t.z(),s=t.w(),l=i+i,c=o+o,u=a+a,h=i*l,d=i*c,f=i*u,p=o*c,m=o*u,g=a*u,A=s*l,v=s*c,y=s*u;r[n+0]=1-(p+g),r[n+1]=d+y,r[n+2]=f-v,r[n+3]=0,r[n+4]=d-y,r[n+5]=1-(h+g),r[n+6]=m+A,r[n+7]=0,r[n+8]=f+v,r[n+9]=m-A,r[n+10]=1-(h+p),r[n+11]=0,r[n+12]=e.x(),r[n+13]=e.y(),r[n+14]=e.z(),r[n+15]=1}const gs=function(e){const t=new a.OrthographicCamera(-1,1,1,-1,0,1),r=new a.Scene,n=new a.StereoCamera,i={minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat},o=new a.WebGLRenderTarget(512,512,i),s=new a.WebGLRenderTarget(512,512,i),l=new a.ShaderMaterial({uniforms:{mapLeft:{value:o.texture},mapRight:{value:s.texture}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","\tvec2 uv = vUv;","\tif ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {","\t\tgl_FragColor = texture2D( mapLeft, uv );","\t} else {","\t\tgl_FragColor = texture2D( mapRight, uv );","\t}","}"].join("\n")}),c=new a.Mesh(new a.PlaneGeometry(2,2),l);r.add(c),this.setSize=(t,r)=>{e.setSize(t,r);const n=e.getPixelRatio();o.setSize(t*n,r*n),s.setSize(t*n,r*n)},this.render=(i,a)=>{i.updateMatrixWorld(),null===a.parent&&a.updateMatrixWorld(),n.update(a),e.setRenderTarget(o),e.clear(),e.render(i,n.cameraL),e.setRenderTarget(s),e.clear(),e.render(i,n.cameraR),e.setRenderTarget(null),e.render(r,t)}},As=function(e){const t=this;let r,n,i;t.cameraDistance=15,t.reflectFromAbove=!1;const o=new a.PerspectiveCamera,s=new a.PerspectiveCamera,l=new a.PerspectiveCamera,c=new a.PerspectiveCamera,u=new a.Vector3,h=new a.Quaternion,d=new a.Vector3;e.autoClear=!1,this.setSize=(t,o)=>{r=t/2,t<o?(n=t/3,i=t/3):(n=o/3,i=o/3),e.setSize(t,o)},this.render=(a,f)=>{a.updateMatrixWorld(),null===f.parent&&f.updateMatrixWorld(),f.matrixWorld.decompose(u,h,d),o.position.copy(u),o.quaternion.copy(h),o.translateZ(t.cameraDistance),o.lookAt(a.position),s.position.copy(u),s.quaternion.copy(h),s.translateZ(-t.cameraDistance),s.lookAt(a.position),s.rotation.z+=Math.PI/180*180,l.position.copy(u),l.quaternion.copy(h),l.translateX(-t.cameraDistance),l.lookAt(a.position),l.rotation.x+=Math.PI/180*90,c.position.copy(u),c.quaternion.copy(h),c.translateX(t.cameraDistance),c.lookAt(a.position),c.rotation.x+=Math.PI/180*90,e.clear(),e.setScissorTest(!0),e.setScissor(r-n/2,2*i,n,i),e.setViewport(r-n/2,2*i,n,i),t.reflectFromAbove?e.render(a,s):e.render(a,o),e.setScissor(r-n/2,0,n,i),e.setViewport(r-n/2,0,n,i),t.reflectFromAbove?e.render(a,o):e.render(a,s),e.setScissor(r-n/2-n,i,n,i),e.setViewport(r-n/2-n,i,n,i),t.reflectFromAbove?e.render(a,c):e.render(a,l),e.setScissor(r+n/2,i,n,i),e.setViewport(r+n/2,i,n,i),t.reflectFromAbove?e.render(a,l):e.render(a,c),e.setScissorTest(!1)}},vs=function(e,t){t=t||{},this.enabled=!0;const r=void 0!==t.defaultThickness?t.defaultThickness:.003,n=(new a.Color).fromArray(void 0!==t.defaultColor?t.defaultColor:[0,0,0]),i=void 0!==t.defaultAlpha?t.defaultAlpha:1,o=void 0!==t.defaultKeepAlive&&t.defaultKeepAlive,s={},l={},c={},u={outlineThickness:{value:r},outlineColor:{value:n},outlineAlpha:{value:i}},h=["#include <common>","#include <uv_pars_vertex>","#include <displacementmap_pars_vertex>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 normal, vec4 skinned ) {","\tfloat thickness = outlineThickness;","\tconst float ratio = 1.0;","\tvec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + normal, 1.0 );","\tvec4 norm = normalize( pos - pos2 );","\treturn pos + norm * thickness * pos.w * ratio;","}","void main() {","\t#include <uv_vertex>","\t#include <beginnormal_vertex>","\t#include <morphnormal_vertex>","\t#include <skinbase_vertex>","\t#include <skinnormal_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <displacementmap_vertex>","\t#include <project_vertex>","\tvec3 outlineNormal = - objectNormal;","\tgl_Position = calculateOutline( gl_Position, outlineNormal, vec4( transformed, 1.0 ) );","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\t#include <fog_vertex>","}"].join("\n"),d=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","\t#include <clipping_planes_fragment>","\t#include <logdepthbuf_fragment>","\tgl_FragColor = vec4( outlineColor, outlineAlpha );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","\t#include <premultiplied_alpha_fragment>","}"].join("\n");function f(e){const t=function(e){let t=s[e.uuid];return void 0===t&&(t={material:new a.ShaderMaterial({type:"OutlineEffect",uniforms:a.UniformsUtils.merge([a.UniformsLib.fog,a.UniformsLib.displacementmap,u]),vertexShader:h,fragmentShader:d,side:a.BackSide}),used:!0,keepAlive:o,count:0},s[e.uuid]=t),t.used=!0,t.material}(e);return l[t.uuid]=e,function(e,t){if("invisible"===e.name)return;const r=t.userData.outlineParameters;e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.fog=t.fog,e.toneMapped=t.toneMapped,e.premultipliedAlpha=t.premultipliedAlpha,e.displacementMap=t.displacementMap,void 0!==r?(!1===t.visible?e.visible=!1:e.visible=void 0===r.visible||r.visible,e.transparent=void 0!==r.alpha&&r.alpha<1||t.transparent,void 0!==r.keepAlive&&(s[t.uuid].keepAlive=r.keepAlive)):(e.transparent=t.transparent,e.visible=t.visible);!0!==t.wireframe&&!1!==t.depthTest||(e.visible=!1);t.clippingPlanes&&(e.clipping=!0,e.clippingPlanes=t.clippingPlanes,e.clipIntersection=t.clipIntersection,e.clipShadows=t.clipShadows);e.version=t.version}(t,e),t}function p(e){const t=e.geometry;let r=!1;return void 0!==e.geometry&&(r=!t.isBufferGeometry||void 0!==t.attributes.normal),!0===e.isMesh&&void 0!==e.material&&!0===r}function m(e){if(!1!==p(e)){if(Array.isArray(e.material))for(let t=0,r=e.material.length;t<r;t++)e.material[t]=f(e.material[t]);else e.material=f(e.material);c[e.uuid]=e.onBeforeRender,e.onBeforeRender=A}}function g(e){if(!1!==p(e)){if(Array.isArray(e.material))for(let t=0,r=e.material.length;t<r;t++)e.material[t]=l[e.material[t].uuid];else e.material=l[e.material.uuid];e.onBeforeRender=c[e.uuid]}}function A(e,t,r,n,i){const o=l[i.uuid];void 0!==o&&function(e,t){const r=t.userData.outlineParameters;e.uniforms.outlineAlpha.value=t.opacity,void 0!==r&&(void 0!==r.thickness&&(e.uniforms.outlineThickness.value=r.thickness),void 0!==r.color&&e.uniforms.outlineColor.value.fromArray(r.color),void 0!==r.alpha&&(e.uniforms.outlineAlpha.value=r.alpha));t.displacementMap&&(e.uniforms.displacementMap.value=t.displacementMap,e.uniforms.displacementScale.value=t.displacementScale,e.uniforms.displacementBias.value=t.displacementBias)}(i,o)}this.render=function(t,r){let n,i=!1;if(void 0!==arguments[2]&&(console.warn("THREE.OutlineEffect.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.OutlineEffect.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),void 0!==n&&e.setRenderTarget(n),i&&e.clear(),!1===this.enabled)return void e.render(t,r);const o=e.autoClear;e.autoClear=this.autoClear,e.render(t,r),e.autoClear=o,this.renderOutline(t,r)},this.renderOutline=(t,r)=>{const n=e.autoClear,i=t.autoUpdate,o=t.background,a=e.shadowMap.enabled;t.autoUpdate=!1,t.background=null,e.autoClear=!1,e.shadowMap.enabled=!1,t.traverse(m),e.render(t,r),t.traverse(g),function(){let e;e=Object.keys(l);for(let t=0,r=e.length;t<r;t++)l[e[t]]=void 0;e=Object.keys(c);for(let t=0,r=e.length;t<r;t++)c[e[t]]=void 0;e=Object.keys(s);for(let t=0,r=e.length;t<r;t++){const r=e[t];!1===s[r].used?(s[r].count++,!1===s[r].keepAlive&&s[r].count>60&&delete s[r]):(s[r].used=!1,s[r].count=0)}}(),t.autoUpdate=i,t.background=o,e.autoClear=n,e.shadowMap.enabled=a},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap,this.clear=(t,r,n)=>{e.clear(t,r,n)},this.getPixelRatio=()=>e.getPixelRatio(),this.setPixelRatio=t=>{e.setPixelRatio(t)},this.getSize=t=>e.getSize(t),this.setSize=(t,r,n)=>{e.setSize(t,r,n)},this.setViewport=(t,r,n,i)=>{e.setViewport(t,r,n,i)},this.setScissor=(t,r,n,i)=>{e.setScissor(t,r,n,i)},this.setScissorTest=t=>{e.setScissorTest(t)},this.setRenderTarget=t=>{e.setRenderTarget(t)}},ys=function(e,t,r){this.colorMatrixLeft=(new a.Matrix3).fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856]),this.colorMatrixRight=(new a.Matrix3).fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]);const n=new a.OrthographicCamera(-1,1,1,-1,0,1),i=new a.Scene,o=new a.StereoCamera,s={minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat};void 0===t&&(t=512),void 0===r&&(r=512);const l=new a.WebGLRenderTarget(t,r,s),c=new a.WebGLRenderTarget(t,r,s),u=new a.ShaderMaterial({uniforms:{mapLeft:{value:l.texture},mapRight:{value:c.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","\treturn c <= 0.04045 ? c * 0.0773993808 :","\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","\treturn c <= 0.0031308 ? c * 12.92","\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","\tvec2 uv = vUv;","\tvec4 colorL = lin( texture2D( mapLeft, uv ) );","\tvec4 colorR = lin( texture2D( mapRight, uv ) );","\tvec3 color = clamp(","\t\t\tcolorMatrixLeft * colorL.rgb +","\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );","\tgl_FragColor = vec4(","\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),","\t\t\tmax( colorL.a, colorR.a ) );","}"].join("\n")}),h=new a.Mesh(new a.PlaneGeometry(2,2),u);i.add(h),this.setSize=(t,r)=>{e.setSize(t,r);const n=e.getPixelRatio();l.setSize(t*n,r*n),c.setSize(t*n,r*n)},this.render=(t,r)=>{const a=e.getRenderTarget();t.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),o.update(r),e.setRenderTarget(l),e.clear(),e.render(t,o.cameraL),e.setRenderTarget(c),e.clear(),e.render(t,o.cameraR),e.setRenderTarget(null),e.render(i,n),e.setRenderTarget(a)},this.dispose=()=>{l&&l.dispose(),c&&c.dispose(),h&&h.geometry.dispose(),u&&u.dispose()}},xs=function(e,t,r){t=void 0===t?" .:-=+*#%@":t,r||(r={});const n=r.resolution?r.resolution:.15,i=r.scale?r.scale:1,o=!!r.color&&r.color,a=!!r.alpha&&r.alpha,s=!!r.block&&r.block,l=!!r.invert&&r.invert;let c,u;const h=document.createElement("div");h.style.cursor="default";const d=document.createElement("table");let f,p,m;h.appendChild(d),this.setSize=(t,r)=>{c=t,u=r,e.setSize(t,r),function(){f=Math.round(c*C),p=Math.round(u*C),x.width=f,x.height=p,m=e.domElement,m.style.backgroundColor&&(d.rows[0].cells[0].style.backgroundColor=m.style.backgroundColor,d.rows[0].cells[0].style.color=m.style.color);d.cellSpacing=0,d.cellPadding=0;const t=d.style;t.display="inline",t.width=`${Math.round(f/C*i)}px`,t.height=`${Math.round(p/C*i)}px`,t.whiteSpace="pre",t.margin="0px",t.padding="0px",t.letterSpacing=`${T}px`,t.fontFamily=v,t.fontSize=`${E}px`,t.lineHeight=`${S}px`,t.textAlign="left",t.textDecoration="none"}()},this.render=(t,r)=>{e.render(t,r),function(e,t){b.clearRect(0,0,f,p),b.drawImage(y,0,0,f,p);const r=b.getImageData(0,0,f,p).data;let n="";for(let i=0;i<p;i+=2){for(let e=0;e<f;e++){const t=4*(i*f+e),c=r[t],u=r[t+1],h=r[t+2],d=r[t+3];let p,m;m=(.3*c+.59*u+.11*h)/255,0==d&&(m=1),p=Math.floor((1-m)*(w.length-1)),l&&(p=w.length-p-1);let g=w[p];void 0!==g&&" "!=g||(g="&nbsp;"),n+=o?`<span style='color:rgb(${c},${u},${h});${s?`background-color:rgb(${c},${u},${h});`:""}${a?`opacity:${d/255};`:""}'>${g}</span>`:g}n+="<br/>"}t.innerHTML=`<tr><td>${n}</td></tr>`}(0,d)},this.domElement=h;const g=" .,:;i1tfLCG08@".split(""),A=" CGO08@".split("");var v="courier new, monospace";const y=e.domElement;var x=document.createElement("canvas");if(!x.getContext)return;const b=x.getContext("2d");if(!b.getImageData)return;let w=o?A:g;t&&(w=t);var C=.5;C=.25,n&&(C=n);var E=2/C*i,S=2/C*i,T=0;switch(i){case 1:T=-1;break;case 2:case 3:T=-2.1;break;case 4:T=-3.1;break;case 5:T=-4.15}},bs=function(e){const t=new a.StereoCamera;t.aspect=.5;const r=new a.Vector2;this.setEyeSeparation=e=>{t.eyeSep=e},this.setSize=(t,r)=>{e.setSize(t,r)},this.render=(n,i)=>{n.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),t.update(i),e.getSize(r),e.autoClear&&e.clear(),e.setScissorTest(!0),e.setScissor(0,0,r.width/2,r.height),e.setViewport(0,0,r.width/2,r.height),e.render(n,t.cameraL),e.setScissor(r.width/2,0,r.width/2,r.height),e.setViewport(r.width/2,0,r.width/2,r.height),e.render(n,t.cameraR),e.setScissorTest(!1)}};class ws extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=new a.FileLoader(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(e=>{if("string"!==typeof e)throw new Error("unsupported data type");const r=JSON.parse(e),n=this.parse(r);t&&t(n)}),r,n)}parse(e){return new Cs(e)}}class Cs{constructor(e){(0,Qe.Z)(this,"data",void 0),this.data=e}generateShapes(e,t=100){const r=[],n=function(e,t,r){const n=Array.from(e),i=t/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,a=[];let s=0,l=0;for(let c=0;c<n.length;c++){const e=n[c];if("\n"===e)s=0,l-=o;else{const t=Es(e,i,s,l,r);t&&(s+=t.offsetX,a.push(t.path))}}return a}(e,t,this.data);for(let i=0,o=n.length;i<o;i++)Array.prototype.push.apply(r,n[i].toShapes(!1));return r}}function Es(e,t,r,n,i){const o=i.glyphs[e]||i.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");const s=new a.ShapePath;let l,c,u,h,d,f,p,m;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let i=0,o=e.length;i<o;){switch(e[i++]){case"m":l=parseInt(e[i++])*t+r,c=parseInt(e[i++])*t+n,s.moveTo(l,c);break;case"l":l=parseInt(e[i++])*t+r,c=parseInt(e[i++])*t+n,s.lineTo(l,c);break;case"q":u=parseInt(e[i++])*t+r,h=parseInt(e[i++])*t+n,d=parseInt(e[i++])*t+r,f=parseInt(e[i++])*t+n,s.quadraticCurveTo(d,f,u,h);break;case"b":u=parseInt(e[i++])*t+r,h=parseInt(e[i++])*t+n,d=parseInt(e[i++])*t+r,f=parseInt(e[i++])*t+n,p=parseInt(e[i++])*t+r,m=parseInt(e[i++])*t+n,s.bezierCurveTo(d,f,p,m,u,h)}}}return{offsetX:o.ha*t,path:s}}(0,Qe.Z)(Cs,"isFont",void 0),(0,Qe.Z)(Cs,"type",void 0);class Ss extends a.DataTextureLoader{constructor(e){super(e)}parse(e){const t=0,r=1,n=2,i=3,o=9,s=10,l=11,c=48,u=4,h=0,d=1,f=2,p=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");let m=0;const g=new Uint8Array(e),A={id_length:g[m++],colormap_type:g[m++],image_type:g[m++],colormap_index:g[m++]|g[m++]<<8,colormap_length:g[m++]|g[m++]<<8,colormap_size:g[m++],origin:[g[m++]|g[m++]<<8,g[m++]|g[m++]<<8],width:g[m++]|g[m++]<<8,height:g[m++]|g[m++]<<8,pixel_size:g[m++],flags:g[m++]};!function(e){switch(e.image_type){case r:case o:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case n:case i:case s:case l:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(A),A.id_length+m>e.length&&console.error("THREE.TGALoader: No data."),m+=A.id_length;let v=!1,y=!1,x=!1;switch(A.image_type){case o:v=!0,y=!0;break;case r:y=!0;break;case s:v=!0;break;case n:break;case l:v=!0,x=!0;break;case i:x=!0}const b=new Uint8Array(A.width*A.height*4),w=function(e,t,r,n,i){let o,a;const s=r.pixel_size>>3,l=r.width*r.height*s;if(t&&(a=i.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),e){let e,t,r;o=new Uint8Array(l);let a=0;const c=new Uint8Array(s);for(;a<l;)if(e=i[n++],t=1+(127&e),128&e){for(r=0;r<s;++r)c[r]=i[n++];for(r=0;r<t;++r)o.set(c,a+r*s);a+=s*t}else{for(t*=s,r=0;r<t;++r)o[a+r]=i[n++];a+=t}}else o=i.subarray(n,n+=t?r.width*r.height:l);return{pixel_data:o,palettes:a}}(v,y,A,m,g);return function(e,t,r,n,i){let o,a,s,l,m,g;switch((A.flags&c)>>u){default:case f:o=0,s=1,m=t,a=0,l=1,g=r;break;case h:o=0,s=1,m=t,a=r-1,l=-1,g=-1;break;case p:o=t-1,s=-1,m=-1,a=0,l=1,g=r;break;case d:o=t-1,s=-1,m=-1,a=r-1,l=-1,g=-1}if(x)switch(A.pixel_size){case 8:!function(e,t,r,n,i,o,a,s){let l,c,u,h=0;const d=A.width;for(u=t;u!==n;u+=r)for(c=i;c!==a;c+=o,h++)l=s[h],e[4*(c+d*u)+0]=l,e[4*(c+d*u)+1]=l,e[4*(c+d*u)+2]=l,e[4*(c+d*u)+3]=255}(e,a,l,g,o,s,m,n);break;case 16:!function(e,t,r,n,i,o,a,s){let l,c,u=0;const h=A.width;for(c=t;c!==n;c+=r)for(l=i;l!==a;l+=o,u+=2)e[4*(l+h*c)+0]=s[u+0],e[4*(l+h*c)+1]=s[u+0],e[4*(l+h*c)+2]=s[u+0],e[4*(l+h*c)+3]=s[u+1]}(e,a,l,g,o,s,m,n);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(A.pixel_size){case 8:!function(e,t,r,n,i,o,a,s,l){const c=l;let u,h,d,f=0;const p=A.width;for(d=t;d!==n;d+=r)for(h=i;h!==a;h+=o,f++)u=s[f],e[4*(h+p*d)+3]=255,e[4*(h+p*d)+2]=c[3*u+0],e[4*(h+p*d)+1]=c[3*u+1],e[4*(h+p*d)+0]=c[3*u+2]}(e,a,l,g,o,s,m,n,i);break;case 16:!function(e,t,r,n,i,o,a,s){let l,c,u,h=0;const d=A.width;for(u=t;u!==n;u+=r)for(c=i;c!==a;c+=o,h+=2)l=s[h+0]+(s[h+1]<<8),e[4*(c+d*u)+0]=(31744&l)>>7,e[4*(c+d*u)+1]=(992&l)>>2,e[4*(c+d*u)+2]=(31&l)>>3,e[4*(c+d*u)+3]=32768&l?0:255}(e,a,l,g,o,s,m,n);break;case 24:!function(e,t,r,n,i,o,a,s){let l,c,u=0;const h=A.width;for(c=t;c!==n;c+=r)for(l=i;l!==a;l+=o,u+=3)e[4*(l+h*c)+3]=255,e[4*(l+h*c)+2]=s[u+0],e[4*(l+h*c)+1]=s[u+1],e[4*(l+h*c)+0]=s[u+2]}(e,a,l,g,o,s,m,n);break;case 32:!function(e,t,r,n,i,o,a,s){let l,c,u=0;const h=A.width;for(c=t;c!==n;c+=r)for(l=i;l!==a;l+=o,u+=4)e[4*(l+h*c)+2]=s[u+0],e[4*(l+h*c)+1]=s[u+1],e[4*(l+h*c)+0]=s[u+2],e[4*(l+h*c)+3]=s[u+3]}(e,a,l,g,o,s,m,n);break;default:console.error("THREE.TGALoader: Format not supported.")}}(b,A.width,A.height,w.pixel_data,w.palettes),{data:b,width:A.width,height:A.height,flipY:!0,generateMipmaps:!0,minFilter:a.LinearMipmapLinearFilter}}}class Ts extends a.Loader{load(e,t,r,n){const i=new a.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("text"),i.load(e,(r=>{try{t(this.parse(r))}catch(i){n?n(i):console.error(i),this.manager.itemError(e)}}),r,n)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,r=null;const n=new a.Vector3(0,0,0),i=new a.Vector3(1,1,1),o=e.split(/[\n\r]+/g);let s=null,l=0;for(let a=0,h=o.length;a<h;a++){const e=o[a].trim(),c=e.split(/\s/g);switch(c[0]){case"TITLE":t=e.substring(7,e.length-1);break;case"LUT_3D_SIZE":const o=c[1];r=parseFloat(o),s=new Uint8Array(r*r*r*4);break;case"DOMAIN_MIN":n.x=parseFloat(c[1]),n.y=parseFloat(c[2]),n.z=parseFloat(c[3]);break;case"DOMAIN_MAX":i.x=parseFloat(c[1]),i.y=parseFloat(c[2]),i.z=parseFloat(c[3]);break;default:const a=parseFloat(c[0]),u=parseFloat(c[1]),h=parseFloat(c[2]);if(a>1||a<0||u>1||u<0||h>1||h<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");s[l+0]=255*a,s[l+1]=255*u,s[l+2]=255*h,s[l+3]=255,l+=4}}const c=new a.DataTexture;c.image.data=s,c.image.width=r,c.image.height=r*r,c.type=a.UnsignedByteType,c.magFilter=a.LinearFilter,c.minFilter=a.LinearFilter,c.wrapS=a.ClampToEdgeWrapping,c.wrapT=a.ClampToEdgeWrapping,c.generateMipmaps=!1;const u=new a.DataTexture3D;return u.image.data=s,u.image.width=r,u.image.height=r,u.image.depth=r,u.type=a.UnsignedByteType,u.magFilter=a.LinearFilter,u.minFilter=a.LinearFilter,u.wrapS=a.ClampToEdgeWrapping,u.wrapT=a.ClampToEdgeWrapping,u.wrapR=a.ClampToEdgeWrapping,u.generateMipmaps=!1,{title:t,size:r,domainMin:n,domainMax:i,texture:c,texture3D:u}}}class Ms extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){let t=e,r=0;const n=new Int8Array(new Int16Array([1]).buffer)[0]>0,i={};const o=function(e,i){void 0!==i&&null!==i||(i=1);let o=1,a=Uint8Array;switch(e){case"uchar":break;case"schar":a=Int8Array;break;case"ushort":a=Uint16Array,o=2;break;case"sshort":a=Int16Array,o=2;break;case"uint":a=Uint32Array,o=4;break;case"sint":a=Int32Array,o=4;break;case"float":a=Float32Array,o=4;break;case"complex":case"double":a=Float64Array,o=8}let s=new a(t.slice(r,r+=i*o));return true!=n&&(s=function(e,t){const r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(let n=0;n<e.byteLength;n+=t)for(let e=n+t-1,i=n;e>i;e--,i++){const t=r[i];r[i]=r[e],r[e]=t}return e}(s,o)),1==i?s[0]:s}("uchar",e.byteLength),s=o.length;let l,c=null,u=0;for(l=1;l<s;l++)if(10==o[l-1]&&10==o[l]){c=this.parseChars(o,0,l-2),u=l+1;break}if(function(e){let t,r,n,o,s,l,c,u;const h=e.split(/\r?\n/);for(c=0,u=h.length;c<u;c++)s=h[c],s.match(/NRRD\d+/)?i.isNrrd=!0:s.match(/^#/)||(l=s.match(/(.*):(.*)/))&&(r=l[1].trim(),t=l[2].trim(),n=Is[r],n?n.call(i,t):i[r]=t);if(!i.isNrrd)throw new Error("Not an NRRD file");if("bz2"===i.encoding||"bzip2"===i.encoding)throw new Error("Bzip is not supported");if(!i.vectors&&(i.vectors=[new a.Vector3(1,0,0),new a.Vector3(0,1,0),new a.Vector3(0,0,1)],i.spacings))for(o=0;o<=2;o++)isNaN(i.spacings[o])||i.vectors[o].multiplyScalar(i.spacings[o])}(c),t=o.subarray(u),"gz"===i.encoding.substring(0,2))t=(0,fn._Z)(new Uint8Array(t));else if("ascii"===i.encoding||"text"===i.encoding||"txt"===i.encoding||"hex"===i.encoding)t=function(e,t,r){let n,o="";t=t||0,r=r||e.length;const a=i.sizes.reduce((function(e,t){return e*t}),1);let s=10;"hex"===i.encoding&&(s=16);const l=new i.__array(a);let c=0,u=parseInt;i.__array!==Float32Array&&i.__array!==Float64Array||(u=parseFloat);for(let i=t;i<r;i++)n=e[i],(n<9||n>13)&&32!==n?o+=String.fromCharCode(n):(""!==o&&(l[c]=u(o,s),c++),o="");return""!==o&&(l[c]=u(o,s),c++),l}(t);else if("raw"===i.encoding){const e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];t=e}t=t.buffer;const h=new P;h.header=i,h.data=new i.__array(t);const d=h.computeMinMax(),f=d[0],p=d[1];h.windowLow=f,h.windowHigh=p,h.dimensions=[i.sizes[0],i.sizes[1],i.sizes[2]],h.xLength=h.dimensions[0],h.yLength=h.dimensions[1],h.zLength=h.dimensions[2];const m=new a.Vector3(i.vectors[0][0],i.vectors[0][1],i.vectors[0][2]).length(),g=new a.Vector3(i.vectors[1][0],i.vectors[1][1],i.vectors[1][2]).length(),A=new a.Vector3(i.vectors[2][0],i.vectors[2][1],i.vectors[2][2]).length();h.spacing=[m,g,A],h.matrix=new a.Matrix4;let v=1,y=1;if("left-posterior-superior"==i.space?(v=-1,y=-1):"left-anterior-superior"===i.space&&(v=-1),i.vectors){const e=i.vectors;h.matrix.set(v*e[0][0],v*e[1][0],v*e[2][0],0,y*e[0][1],y*e[1][1],y*e[2][1],0,1*e[0][2],1*e[1][2],1*e[2][2],0,0,0,0,1)}else h.matrix.set(v,0,0,0,0,y,0,0,0,0,1,0,0,0,0,1);return h.inverseMatrix=new a.Matrix4,h.inverseMatrix.copy(h.matrix).invert(),h.RASDimensions=new a.Vector3(h.xLength,h.yLength,h.zLength).applyMatrix4(h.matrix).round().toArray().map(Math.abs),h.lowerThreshold===-1/0&&(h.lowerThreshold=f),h.upperThreshold===1/0&&(h.upperThreshold=p),h}parseChars(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);let n="",i=0;for(i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}}const Is={type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){let t;return this.sizes=function(){const r=e.split(/\s+/),n=[];for(let e=0,i=r.length;e<i;e++)t=r[e],n.push(parseInt(t,10));return n}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){let t,r;const n=e.match(/\(.*?\)/g);return this.vectors=function(){const e=[];for(let i=0,o=n.length;i<o;i++)r=n[i],e.push(function(){const e=r.slice(1,-1).split(/,/),n=[];for(let r=0,i=e.length;r<i;r++)t=e[r],n.push(parseFloat(t));return n}());return e}()},spacings:function(e){let t;const r=e.split(/\s+/);return this.spacings=function(){const e=[];for(let n=0,i=r.length;n<i;n++)t=r[n],e.push(parseFloat(t));return e}()}};class Bs extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new a.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){function t(e,t,r){for(let n=0,i=e.length;n<i;n++)if(e[n]!==t.getUint8(r+n,!1))return!1;return!0}const r=function(e){if("string"===typeof e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){const r=new DataView(e);if(84+50*r.getUint32(80,!0)===r.byteLength)return!0;const n=[115,111,108,105,100];for(let i=0;i<5;i++)if(t(n,r,i))return!1;return!0}(r)?function(e){const t=new DataView(e),r=t.getUint32(80,!0);let n,i,o,s,l,c,u,h,d=!1;for(let a=0;a<70;a++)1129270351==t.getUint32(a,!1)&&82==t.getUint8(a+4)&&61==t.getUint8(a+5)&&(d=!0,s=new Float32Array(3*r*3),l=t.getUint8(a+6)/255,c=t.getUint8(a+7)/255,u=t.getUint8(a+8)/255,h=t.getUint8(a+9)/255);const f=new a.BufferGeometry,p=new Float32Array(3*r*3),m=new Float32Array(3*r*3);for(let a=0;a<r;a++){const e=84+50*a,r=t.getFloat32(e,!0),h=t.getFloat32(e+4,!0),f=t.getFloat32(e+8,!0);if(d){const r=t.getUint16(e+48,!0);0===(32768&r)?(n=(31&r)/31,i=(r>>5&31)/31,o=(r>>10&31)/31):(n=l,i=c,o=u)}for(let l=1;l<=3;l++){const c=e+12*l,u=3*a*3+3*(l-1);p[u]=t.getFloat32(c,!0),p[u+1]=t.getFloat32(c+4,!0),p[u+2]=t.getFloat32(c+8,!0),m[u]=r,m[u+1]=h,m[u+2]=f,d&&(s[u]=n,s[u+1]=i,s[u+2]=o)}}return f.setAttribute("position",new a.BufferAttribute(p,3)),f.setAttribute("normal",new a.BufferAttribute(m,3)),d&&(f.setAttribute("color",new a.BufferAttribute(s,3)),f.hasColors=!0,f.alpha=h),f}(r):function(e){const t=new a.BufferGeometry,r=/solid([\s\S]*?)endsolid/g,n=/facet([\s\S]*?)endfacet/g;let i=0;const o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,s=new RegExp("vertex"+o+o+o,"g"),l=new RegExp("normal"+o+o+o,"g"),c=[],u=[],h=new a.Vector3;let d,f=0,p=0,m=0;for(;null!==(d=r.exec(e));){p=m;const e=d[0];for(;null!==(d=n.exec(e));){let e=0,t=0;const r=d[0];for(;null!==(d=l.exec(r));)h.x=parseFloat(d[1]),h.y=parseFloat(d[2]),h.z=parseFloat(d[3]),t++;for(;null!==(d=s.exec(r));)c.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),u.push(h.x,h.y,h.z),e++,m++;1!==t&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+i),3!==e&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+i),i++}const r=p,o=m-p;t.addGroup(r,o,f),f++}return t.setAttribute("position",new a.Float32BufferAttribute(c,3)),t.setAttribute("normal",new a.Float32BufferAttribute(u,3)),t}("string"!==typeof(n=e)?a.LoaderUtils.decodeText(new Uint8Array(n)):n);var n}}class _s extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=""===this.path?a.LoaderUtils.extractUrlBase(e):this.path,s=new a.FileLoader(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(r){try{t(i.parse(r,o))}catch(a){n?n(a):console.error(a),i.manager.itemError(e)}}),r,n)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const r=e.split("\n");let n={};const i=/\s+/,o={};for(let s=0;s<r.length;s++){let e=r[s];if(e=e.trim(),0===e.length||"#"===e.charAt(0))continue;const t=e.indexOf(" ");let a=t>=0?e.substring(0,t):e;a=a.toLowerCase();let l=t>=0?e.substring(t+1):"";if(l=l.trim(),"newmtl"===a)n={name:l},o[l]=n;else if("ka"===a||"kd"===a||"ks"===a||"ke"===a){const e=l.split(i,3);n[a]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else n[a]=l}const a=new Fs(this.resourcePath||t,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(o),a}}class Fs{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:a.FrontSide,this.wrap=void 0!==this.options.wrap?this.options.wrap:a.RepeatWrapping}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const r in e){const n=e[r],i={};t[r]=i;for(const e in n){let t=!0,r=n[e];const o=e.toLowerCase();switch(o){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(r=[r[0]/255,r[1]/255,r[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===r[0]&&0===r[1]&&0===r[2]&&(t=!1)}t&&(i[o]=r)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,r=this.materialsInfo[e],n={name:e,side:this.side};function i(e,r){if(n[e])return;const i=t.getTextureParams(r,n),o=t.loadTexture((a=t.baseUrl,"string"!==typeof(s=i.url)||""===s?"":/^https?:\/\//i.test(s)?s:a+s));var a,s;o.repeat.copy(i.scale),o.offset.copy(i.offset),o.wrapS=t.wrap,o.wrapT=t.wrap,n[e]=o}for(const o in r){const e=r[o];let t;if(""!==e)switch(o.toLowerCase()){case"kd":n.color=(new a.Color).fromArray(e);break;case"ks":n.specular=(new a.Color).fromArray(e);break;case"ke":n.emissive=(new a.Color).fromArray(e);break;case"map_kd":i("map",e);break;case"map_ks":i("specularMap",e);break;case"map_ke":i("emissiveMap",e);break;case"norm":i("normalMap",e);break;case"map_bump":case"bump":i("bumpMap",e);break;case"map_d":i("alphaMap",e),n.transparent=!0;break;case"ns":n.shininess=parseFloat(e);break;case"d":t=parseFloat(e),t<1&&(n.opacity=t,n.transparent=!0);break;case"tr":t=parseFloat(e),this.options&&this.options.invertTrProperty&&(t=1-t),t>0&&(n.opacity=1-t,n.transparent=!0)}}return this.materials[e]=new a.MeshPhongMaterial(n),this.materials[e]}getTextureParams(e,t){const r={scale:new a.Vector2(1,1),offset:new a.Vector2(0,0)},n=e.split(/\s+/);let i;return i=n.indexOf("-bm"),i>=0&&(t.bumpScale=parseFloat(n[i+1]),n.splice(i,2)),i=n.indexOf("-s"),i>=0&&(r.scale.set(parseFloat(n[i+1]),parseFloat(n[i+2])),n.splice(i,4)),i=n.indexOf("-o"),i>=0&&(r.offset.set(parseFloat(n[i+1]),parseFloat(n[i+2])),n.splice(i,4)),r.url=n.join(" ").trim(),r}loadTexture(e,t,r,n,i){const o=void 0!==this.manager?this.manager:a.DefaultLoadingManager;let s=o.getHandler(e);null===s&&(s=new a.TextureLoader(o)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin);const l=s.load(e,r,n,i);return void 0!==t&&(l.mapping=t),l}}var Ps=function(){var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(let n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),r=function t(){e(this,t),this.boneName="",this.BoneIndex=0,this.Indeces=[],this.Weights=[],this.initMatrix=null,this.OffsetMatrix=null},n=function t(){e(this,t),this.animeName="",this.boneName="",this.targetBone=null,this.keyType=4,this.frameStartLv=0,this.keyFrames=[],this.InverseMx=null},o=function(){function r(t){e(this,r),this.fps=30,this.name="xanimation",this.length=0,this.hierarchy=[],this.putFlags=t,void 0===this.putFlags.putPos&&(this.putFlags.putPos=!0),void 0===this.putFlags.putRot&&(this.putFlags.putRot=!0),void 0===this.putFlags.putScl&&(this.putFlags.putScl=!0)}return t(r,[{key:"make",value:function(e){for(let t=0;t<e.length;t++)this.hierarchy.push(this.makeBonekeys(e[t]));this.length=this.hierarchy[0].keys[this.hierarchy[0].keys.length-1].time}},{key:"clone",value:function(){return Object.assign({},this)}},{key:"makeBonekeys",value:function(e){var t={};return t.name=e.boneName,t.parent="",t.keys=this.keyFrameRefactor(e),t.copy=function(){return Object.assign({},this)},t}},{key:"keyFrameRefactor",value:function(e){var t=[];for(let n=0;n<e.keyFrames.length;n++){var r={};r.time=e.keyFrames[n].time*this.fps,e.keyFrames[n].pos&&this.putFlags.putPos&&(r.pos=e.keyFrames[n].pos),e.keyFrames[n].rot&&this.putFlags.putRot&&(r.rot=e.keyFrames[n].rot),e.keyFrames[n].scl&&this.putFlags.putScl&&(r.scl=e.keyFrames[n].scl),e.keyFrames[n].matrix&&(r.matrix=e.keyFrames[n].matrix,this.putFlags.putPos&&(r.pos=(new a.Vector3).setFromMatrixPosition(r.matrix)),this.putFlags.putRot&&(r.rot=(new a.Quaternion).setFromRotationMatrix(r.matrix)),this.putFlags.putScl&&(r.scl=(new a.Vector3).setFromMatrixScale(r.matrix))),t.push(r)}return t}}]),r}(),s=function t(){e(this,t),this.index=0,this.Frame=0,this.time=0,this.matrix=null};return function(){function l(t){a.Loader.call(this,t),e(this,l),this.debug=!1,this.texloader=new a.TextureLoader(this.manager),this.url="",this._putMatLength=0,this._nowMat=null,this._nowFrameName="",this.frameHierarchie=[],this.Hierarchies={},this.HieStack=[],this._currentObject={},this._currentFrame={},this._data=null,this.onLoad=null,this.IsUvYReverse=!0,this.Meshes=[],this.animations=[],this.animTicksPerSecond=30,this._currentGeo=null,this._currentAnime=null,this._currentAnimeFrames=null}return t(l,[{key:"_setArgOption",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e){for(let r=t;r<e.length;r++)switch(r){case 0:this.url=e[r];break;case 1:this.options=e[r]}void 0===this.options&&(this.options={})}}},{key:"load",value:function(e,t,r,n){var i=this;this._setArgOption(e);var o=new a.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(this.url,(function(e){try{i.parse(e,t)}catch(r){n?n(r):console.error(r),i.manager.itemError(i.url)}}),r,n)}},{key:"_readLine",value:function(e){for(var t=0;;){var r=-1;if(-1===(r=e.indexOf("//",t))&&(r=e.indexOf("#",t)),!(r>-1&&r<2))break;var n=-1;t=(n=e.indexOf("\r\n",t))>0?n+2:(n=e.indexOf("\r",t))>0?n+1:e.indexOf("\n",t)+1}return e.substr(t)}},{key:"_readLine",value:function(e){for(var t=0;;){var r=-1;if(-1===(r=e.indexOf("//",t))&&(r=e.indexOf("#",t)),!(r>-1&&r<2))break;var n=-1;t=(n=e.indexOf("\r\n",t))>0?n+2:(n=e.indexOf("\r",t))>0?n+1:e.indexOf("\n",t)+1}return e.substr(t)}},{key:"_isBinary",value:function(e){var t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;var r=t.byteLength;for(let n=0;n<r;n++)if(t.getUint8(n,!1)>127)return!0;return!1}},{key:"_ensureBinary",value:function(e){if("string"===typeof e){var t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}},{key:"_ensureString",value:function(e){return"string"!==typeof e?a.LoaderUtils.decodeText(new Uint8Array(e)):e}},{key:"parse",value:function(e,t){var r=this._ensureBinary(e);return this._data=this._ensureString(e),this.onLoad=t,this._isBinary(r)?this._parseBinary(r):this._parseASCII()}},{key:"_parseBinary",value:function(e){return this._parseASCII(a.LoaderUtils.decodeText(new Uint8Array(e)))}},{key:"_parseASCII",value:function(){var e;e=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:a.LoaderUtils.extractUrlBase(this.url),this.texloader.setPath(e).setCrossOrigin(this.crossOrigin);this.Hierarchies.children=[],this._hierarchieParse(this.Hierarchies,16),this._changeRoot(),this._currentObject=this.Hierarchies.children.shift(),this._mainloop()}},{key:"_hierarchieParse",value:function(e,t){for(var r=t;;){var n=this._data.indexOf("{",r)+1,i=this._data.indexOf("}",r),o=this._data.indexOf("{",n)+1;if(!(n>0&&i>n)){r=-1===n?this._data.length:i+1;break}var a={children:[]},s=this._readLine(this._data.substr(r,n-r-1)).trim(),l=s.split(/ /g);if(l.length>0?(a.type=l[0],l.length>=2?a.name=l[1]:a.name=l[0]+this.Hierarchies.children.length):(a.name=s,a.type=""),"Animation"===a.type){a.data=this._data.substr(o,i-o).trim();var c=this._hierarchieParse(a,i+1);r=c.end,a.children=c.parent.children}else{var u=this._data.lastIndexOf(";",o>0?Math.min(o,i):i);if(a.data=this._data.substr(n,u-n).trim(),o<=0||i<o)r=i+1;else{var h=Math.max(u+1,n),d=this._hierarchieParse(a,h);r=d.end,a.children=d.parent.children}}a.parent=e,"template"!=a.type&&e.children.push(a)}return{parent:e,end:r}}},{key:"_mainloop",value:function(){var e=this;this._mainProc(),this._currentObject.parent||this._currentObject.children.length>0||!this._currentObject.worked?setTimeout((function(){e._mainloop()}),1):setTimeout((function(){e.onLoad({models:e.Meshes,animations:e.animations})}),1)}},{key:"_mainProc",value:function(){for(var e=!1;;){if(!this._currentObject.worked){switch(this._currentObject.type){case"template":break;case"AnimTicksPerSecond":this.animTicksPerSecond=parseInt(this._currentObject.data);break;case"Frame":this._setFrame();break;case"FrameTransformMatrix":this._setFrameTransformMatrix();break;case"Mesh":this._changeRoot(),this._currentGeo={},this._currentGeo.name=this._currentObject.name.trim(),this._currentGeo.parentName=this._getParentName(this._currentObject).trim(),this._currentGeo.VertexSetedBoneCount=[],this._currentGeo.GeometryData={vertices:[],normals:[],uvs:[],skinIndices:[],skinWeights:[],indices:[],materialIndices:[]},this._currentGeo.Materials=[],this._currentGeo.normalVectors=[],this._currentGeo.BoneInfs=[],this._currentGeo.baseFrame=this._currentFrame,this._makeBoneFrom_CurrentFrame(),this._readVertexDatas(),e=!0;break;case"MeshNormals":this._readVertexDatas();break;case"MeshTextureCoords":this._setMeshTextureCoords();break;case"VertexDuplicationIndices":break;case"MeshMaterialList":this._setMeshMaterialList();break;case"Material":this._setMaterial();break;case"SkinWeights":this._setSkinWeights();break;case"AnimationSet":this._changeRoot(),this._currentAnime={},this._currentAnime.name=this._currentObject.name.trim(),this._currentAnime.AnimeFrames=[];break;case"Animation":this._currentAnimeFrames&&this._currentAnime.AnimeFrames.push(this._currentAnimeFrames),this._currentAnimeFrames=new n,this._currentAnimeFrames.boneName=this._currentObject.data.trim();break;case"AnimationKey":this._readAnimationKey(),e=!0}this._currentObject.worked=!0}if(this._currentObject.children.length>0){if(this._currentObject=this._currentObject.children.shift(),this.debug&&console.log("processing "+this._currentObject.name),e)break}else if(this._currentObject.worked&&this._currentObject.parent&&!this._currentObject.parent.parent&&this._changeRoot(),this._currentObject.parent?this._currentObject=this._currentObject.parent:e=!0,e)break}}},{key:"_changeRoot",value:function(){null!=this._currentGeo&&this._currentGeo.name&&this._makeOutputGeometry(),this._currentGeo={},null!=this._currentAnime&&this._currentAnime.name&&(this._currentAnimeFrames&&(this._currentAnime.AnimeFrames.push(this._currentAnimeFrames),this._currentAnimeFrames=null),this._makeOutputAnimation()),this._currentAnime={}}},{key:"_getParentName",value:function(e){return e.parent?e.parent.name?e.parent.name:this._getParentName(e.parent):""}},{key:"_setFrame",value:function(){this._nowFrameName=this._currentObject.name.trim(),this._currentFrame={},this._currentFrame.name=this._nowFrameName,this._currentFrame.children=[],this._currentObject.parent&&this._currentObject.parent.name&&(this._currentFrame.parentName=this._currentObject.parent.name),this.frameHierarchie.push(this._nowFrameName),this.HieStack[this._nowFrameName]=this._currentFrame}},{key:"_setFrameTransformMatrix",value:function(){this._currentFrame.FrameTransformMatrix=new a.Matrix4;var e=this._currentObject.data.split(",");this._ParseMatrixData(this._currentFrame.FrameTransformMatrix,e),this._makeBoneFrom_CurrentFrame()}},{key:"_makeBoneFrom_CurrentFrame",value:function(){if(this._currentFrame.FrameTransformMatrix){var e=new a.Bone;if(e.name=this._currentFrame.name,e.applyMatrix4(this._currentFrame.FrameTransformMatrix),e.matrixWorld=e.matrix,e.FrameTransformMatrix=this._currentFrame.FrameTransformMatrix,this._currentFrame.putBone=e,this._currentFrame.parentName)for(let e in this.HieStack)this.HieStack[e].name===this._currentFrame.parentName&&this.HieStack[e].putBone.add(this._currentFrame.putBone)}}},{key:"_readVertexDatas",value:function(){for(var e=0,t=0,r=0,n=0;;){var i=!1;if(0===r){e=this._readInt1(e).endRead,r=1,(n=this._currentObject.data.indexOf(";;",e)+1)<=0&&(n=this._currentObject.data.length)}else{var o=0;switch(t){case 0:o=this._currentObject.data.indexOf(",",e)+1;break;case 1:o=this._currentObject.data.indexOf(";,",e)+1}switch((0===o||o>n)&&(o=n,r=0,i=!0),this._currentObject.type){case"Mesh":switch(t){case 0:this._readVertex1(this._currentObject.data.substr(e,o-e));break;case 1:this._readFace1(this._currentObject.data.substr(e,o-e))}break;case"MeshNormals":switch(t){case 0:this._readNormalVector1(this._currentObject.data.substr(e,o-e))}}e=o+1,i&&t++}if(e>=this._currentObject.data.length)break}}},{key:"_readInt1",value:function(e){var t=this._currentObject.data.indexOf(";",e);return{refI:parseInt(this._currentObject.data.substr(e,t-e)),endRead:t+1}}},{key:"_readVertex1",value:function(e){var t=this._readLine(e.trim()).substr(0,e.length-2).split(";");this._currentGeo.GeometryData.vertices.push(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])),this._currentGeo.GeometryData.skinIndices.push(0,0,0,0),this._currentGeo.GeometryData.skinWeights.push(1,0,0,0),this._currentGeo.VertexSetedBoneCount.push(0)}},{key:"_readFace1",value:function(e){var t=this._readLine(e.trim()).substr(2,e.length-4).split(",");this._currentGeo.GeometryData.indices.push(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10))}},{key:"_readNormalVector1",value:function(e){var t=this._readLine(e.trim()).substr(0,e.length-2).split(";");this._currentGeo.GeometryData.normals.push(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))}},{key:"_buildGeometry",value:function(){var e=new a.BufferGeometry,t=[],r=[],n=[],i=[],o=[],s=this._currentGeo.GeometryData;for(let a=0,h=s.indices.length;a<h;a++){var l=2*s.indices[a],c=3*s.indices[a],u=4*s.indices[a];t.push(s.vertices[c],s.vertices[c+1],s.vertices[c+2]),r.push(s.normals[c],s.normals[c+1],s.normals[c+2]),i.push(s.skinIndices[u],s.skinIndices[u+1],s.skinIndices[u+2],s.skinIndices[u+3]),o.push(s.skinWeights[u],s.skinWeights[u+1],s.skinWeights[u+2],s.skinWeights[u+3]),n.push(s.uvs[l],s.uvs[l+1])}return e.setAttribute("position",new a.Float32BufferAttribute(t,3)),e.setAttribute("normal",new a.Float32BufferAttribute(r,3)),e.setAttribute("uv",new a.Float32BufferAttribute(n,2)),e.setAttribute("skinIndex",new a.Uint16BufferAttribute(i,4)),e.setAttribute("skinWeight",new a.Float32BufferAttribute(o,4)),this._computeGroups(e,s.materialIndices),e}},{key:"_computeGroups",value:function(e,t){var r,n=[],o=void 0;for(let i=0;i<t.length;i++){var a=t[i];a!==o&&(o=a,void 0!==r&&(r.count=3*i-r.start,n.push(r)),r={start:3*i,materialIndex:o})}void 0!==r&&(r.count=3*i-r.start,n.push(r)),e.groups=n}},{key:"_setMeshTextureCoords",value:function(){for(var e=0,t=0,r=0;;){switch(t){case 0:if(0===r){e=this._readInt1(0).endRead,r=1}else{var n=this._currentObject.data.indexOf(",",e)+1;0===n&&(n=this._currentObject.data.length,t=2,r=0);var i=this._currentObject.data.substr(e,n-e),o=this._readLine(i.trim()).split(";");this.IsUvYReverse?this._currentGeo.GeometryData.uvs.push(parseFloat(o[0]),1-parseFloat(o[1])):this._currentGeo.GeometryData.uvs.push(parseFloat(o[0]),parseFloat(o[1])),e=n+1}}if(e>=this._currentObject.data.length)break}}},{key:"_setMeshMaterialList",value:function(){for(var e=0,t=0,r=0;;){if(r<2){e=this._readInt1(e).endRead,r++}else{var n=this._currentObject.data.indexOf(";",e);-1===n&&(n=this._currentObject.data.length,t=3,r=0);var i=this._currentObject.data.substr(e,n-e),o=this._readLine(i.trim()).split(",");for(let e=0;e<o.length;e++)this._currentGeo.GeometryData.materialIndices[e]=parseInt(o[e]);e=this._currentObject.data.length}if(e>=this._currentObject.data.length||t>=3)break}}},{key:"_setMaterial",value:function(){var e=new a.MeshPhongMaterial({color:16777215*Math.random()});e.side=a.FrontSide,e.name=this._currentObject.name;var t=0,r=this._currentObject.data.indexOf(";;",t),n=this._currentObject.data.substr(t,r-t),i=this._readLine(n.trim()).split(";");e.color.r=parseFloat(i[0]),e.color.g=parseFloat(i[1]),e.color.b=parseFloat(i[2]),t=r+2,r=this._currentObject.data.indexOf(";",t),n=this._currentObject.data.substr(t,r-t),e.shininess=parseFloat(this._readLine(n)),t=r+1,r=this._currentObject.data.indexOf(";;",t),n=this._currentObject.data.substr(t,r-t);var o=this._readLine(n.trim()).split(";");e.specular.r=parseFloat(o[0]),e.specular.g=parseFloat(o[1]),e.specular.b=parseFloat(o[2]),t=r+2,-1===(r=this._currentObject.data.indexOf(";;",t))&&(r=this._currentObject.data.length),n=this._currentObject.data.substr(t,r-t);var s=this._readLine(n.trim()).split(";");e.emissive.r=parseFloat(s[0]),e.emissive.g=parseFloat(s[1]),e.emissive.b=parseFloat(s[2]);for(var l=null;this._currentObject.children.length>0;){l=this._currentObject.children.shift(),this.debug&&console.log("processing "+l.name);var c=l.data.substr(1,l.data.length-2);switch(l.type){case"TextureFilename":e.map=this.texloader.load(c);break;case"BumpMapFilename":e.bumpMap=this.texloader.load(c),e.bumpScale=.05;break;case"NormalMapFilename":e.normalMap=this.texloader.load(c),e.normalScale=new a.Vector2(2,2);break;case"EmissiveMapFilename":e.emissiveMap=this.texloader.load(c);break;case"LightMapFilename":e.lightMap=this.texloader.load(c)}}this._currentGeo.Materials.push(e)}},{key:"_setSkinWeights",value:function(){var e=new r,t=0,n=this._currentObject.data.indexOf(";",t),i=this._currentObject.data.substr(t,n-t);t=n+1,e.boneName=i.substr(1,i.length-2),e.BoneIndex=this._currentGeo.BoneInfs.length,t=(n=this._currentObject.data.indexOf(";",t))+1,n=this._currentObject.data.indexOf(";",t),i=this._currentObject.data.substr(t,n-t);var o=this._readLine(i.trim()).split(",");for(let r=0;r<o.length;r++)e.Indeces.push(parseInt(o[r]));t=n+1,n=this._currentObject.data.indexOf(";",t),i=this._currentObject.data.substr(t,n-t);var s=this._readLine(i.trim()).split(",");for(let r=0;r<s.length;r++)e.Weights.push(parseFloat(s[r]));t=n+1,(n=this._currentObject.data.indexOf(";",t))<=0&&(n=this._currentObject.data.length),i=this._currentObject.data.substr(t,n-t);var l=this._readLine(i.trim()).split(",");e.OffsetMatrix=new a.Matrix4,this._ParseMatrixData(e.OffsetMatrix,l),this._currentGeo.BoneInfs.push(e)}},{key:"_makePutBoneList",value:function(e,t){var r=!1;for(let i in this.HieStack)if(this.HieStack[i].name===e||r){r=!0;var n=new a.Bone;if(n.name=this.HieStack[i].name,n.applyMatrix4(this.HieStack[i].FrameTransformMatrix),n.matrixWorld=n.matrix,n.FrameTransformMatrix=this.HieStack[i].FrameTransformMatrix,n.pos=(new a.Vector3).setFromMatrixPosition(n.FrameTransformMatrix).toArray(),n.rotq=(new a.Quaternion).setFromRotationMatrix(n.FrameTransformMatrix).toArray(),n.scl=(new a.Vector3).setFromMatrixScale(n.FrameTransformMatrix).toArray(),this.HieStack[i].parentName&&this.HieStack[i].parentName.length>0)for(let e=0;e<t.length;e++)if(this.HieStack[i].parentName===t[e].name){t[e].add(n),n.parent=e;break}t.push(n)}}},{key:"_makeOutputGeometry",value:function(){var e=null;if(this._currentGeo.BoneInfs.length>0){var t=[];this._makePutBoneList(this._currentGeo.baseFrame.parentName,t);for(let e=0;e<this._currentGeo.BoneInfs.length;e++){var r=0;for(let n=0;n<t.length;n++)if(t[n].name===this._currentGeo.BoneInfs[e].boneName){r=n,t[n].OffsetMatrix=new a.Matrix4,t[n].OffsetMatrix.copy(this._currentGeo.BoneInfs[e].OffsetMatrix);break}for(let t=0;t<this._currentGeo.BoneInfs[e].Indeces.length;t++){var n=this._currentGeo.BoneInfs[e].Indeces[t],i=this._currentGeo.BoneInfs[e].Weights[t],o=4*n;switch(this._currentGeo.VertexSetedBoneCount[n]){case 0:this._currentGeo.GeometryData.skinIndices[o]=r,this._currentGeo.GeometryData.skinWeights[o]=i;break;case 1:this._currentGeo.GeometryData.skinIndices[o+1]=r,this._currentGeo.GeometryData.skinWeights[o+1]=i;break;case 2:this._currentGeo.GeometryData.skinIndices[o+2]=r,this._currentGeo.GeometryData.skinWeights[o+2]=i;break;case 3:this._currentGeo.GeometryData.skinIndices[o+3]=r,this._currentGeo.GeometryData.skinWeights[o+3]=i}this._currentGeo.VertexSetedBoneCount[n]++,this._currentGeo.VertexSetedBoneCount[n]>4&&console.log("warn! over 4 bone weight! :"+n)}}for(let e=0;e<this._currentGeo.Materials.length;e++)this._currentGeo.Materials[e].skinning=!0;var s=[];for(let e=0;e<t.length;e++)t[e].OffsetMatrix?s.push(t[e].OffsetMatrix):s.push(new a.Matrix4);var l=this._buildGeometry();e=new a.SkinnedMesh(l,1===this._currentGeo.Materials.length?this._currentGeo.Materials[0]:this._currentGeo.Materials),this._initSkeleton(e,t,s)}else{var c=this._buildGeometry();e=new a.Mesh(c,1===this._currentGeo.Materials.length?this._currentGeo.Materials[0]:this._currentGeo.Materials)}e.name=this._currentGeo.name;var u=new a.Matrix4,h=this._currentGeo.baseFrame.putBone;if(h&&h.parent){for(;h=h.parent;)u.multiply(h.FrameTransformMatrix);e.applyMatrix4(u)}this.Meshes.push(e)}},{key:"_initSkeleton",value:function(e,t,r){var n,i,o,s,l=[];for(o=0,s=t.length;o<s;o++)i=t[o],n=new a.Bone,l.push(n),n.name=i.name,n.position.fromArray(i.pos),n.quaternion.fromArray(i.rotq),void 0!==i.scl&&n.scale.fromArray(i.scl);for(o=0,s=t.length;o<s;o++)-1!==(i=t[o]).parent&&null!==i.parent&&void 0!==l[i.parent]?l[i.parent].add(l[o]):e.add(l[o]);e.updateMatrixWorld(!0);var c=new a.Skeleton(l,r);e.bind(c,e.matrixWorld)}},{key:"_readAnimationKey",value:function(){var e=0,t=this._currentObject.data.indexOf(";",e),r=this._currentObject.data.substr(e,t-e);e=t+1;var n=parseInt(this._readLine(r));e=(t=this._currentObject.data.indexOf(";",e))+1,r=this._currentObject.data.substr(e);var i=this._readLine(r.trim()).split(";;,");for(let h=0;h<i.length;h++){var o=i[h].split(";"),l=new s;if(l.type=n,l.Frame=parseInt(o[0]),l.index=this._currentAnimeFrames.keyFrames.length,l.time=l.Frame,4!=n){var c=!1;for(let e=0;e<this._currentAnimeFrames.keyFrames.length;e++)if(this._currentAnimeFrames.keyFrames[e].Frame===l.Frame){l=this._currentAnimeFrames.keyFrames[e],c=!0;break}var u=o[2].split(",");switch(n){case 0:l.rot=new a.Quaternion(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]),-1*parseFloat(u[0]));break;case 1:l.scl=new a.Vector3(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2]));break;case 2:l.pos=new a.Vector3(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2]))}c||this._currentAnimeFrames.keyFrames.push(l)}else l.matrix=new a.Matrix4,this._ParseMatrixData(l.matrix,o[2].split(",")),this._currentAnimeFrames.keyFrames.push(l)}}},{key:"_makeOutputAnimation",value:function(){var e=new o(this.options);e.fps=this.animTicksPerSecond,e.name=this._currentAnime.name,e.make(this._currentAnime.AnimeFrames),this.animations.push(e)}},{key:"assignAnimation",value:function(e,t){var r=e,n=t;if(r||(r=this.Meshes[0]),n||(n=this.animations[0]),!r||!n)return null;var i={};i.fps=n.fps,i.name=n.name,i.length=n.length,i.hierarchy=[];for(let a=0;a<r.skeleton.bones.length;a++){var o=!1;for(let e=0;e<n.hierarchy.length;e++)if(r.skeleton.bones[a].name===n.hierarchy[e].name){o=!0;var s=n.hierarchy[e].copy();if(s.parent=-1,r.skeleton.bones[a].parent&&"Bone"===r.skeleton.bones[a].parent.type)for(let e=0;e<i.hierarchy.length;e++)i.hierarchy[e].name===r.skeleton.bones[a].parent.name&&(s.parent=e,s.parentName=r.skeleton.bones[a].parent.name);i.hierarchy.push(s);break}if(!o){var l=n.hierarchy[0].copy();l.name=r.skeleton.bones[a].name,l.parent=-1;for(let e=0;e<l.keys.length;e++)l.keys[e].pos&&l.keys[e].pos.set(0,0,0),l.keys[e].scl&&l.keys[e].scl.set(1,1,1),l.keys[e].rot&&l.keys[e].rot.set(0,0,0,1);i.hierarchy.push(l)}}return r.geometry.animations||(r.geometry.animations=[]),r.geometry.animations.push(a.AnimationClip.parseAnimation(i,r.skeleton.bones)),r.animationMixer||(r.animationMixer=new a.AnimationMixer(r)),i}},{key:"_ParseMatrixData",value:function(e,t){e.set(parseFloat(t[0]),parseFloat(t[4]),parseFloat(t[8]),parseFloat(t[12]),parseFloat(t[1]),parseFloat(t[5]),parseFloat(t[9]),parseFloat(t[13]),parseFloat(t[2]),parseFloat(t[6]),parseFloat(t[10]),parseFloat(t[14]),parseFloat(t[3]),parseFloat(t[7]),parseFloat(t[11]),parseFloat(t[15]))}}]),l}()}();class Rs extends a.Loader{constructor(e){super(e),this.animateBonePositions=!0,this.animateBoneRotations=!0}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){function t(e,r,n){if("ENDSITE"===n.type)return;const i={time:r,position:new a.Vector3,rotation:new a.Quaternion};n.frames.push(i);const o=new a.Quaternion,s=new a.Vector3(1,0,0),l=new a.Vector3(0,1,0),c=new a.Vector3(0,0,1);for(let t=0;t<n.channels.length;t++)switch(n.channels[t]){case"Xposition":i.position.x=parseFloat(e.shift().trim());break;case"Yposition":i.position.y=parseFloat(e.shift().trim());break;case"Zposition":i.position.z=parseFloat(e.shift().trim());break;case"Xrotation":o.setFromAxisAngle(s,parseFloat(e.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Yrotation":o.setFromAxisAngle(l,parseFloat(e.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Zrotation":o.setFromAxisAngle(c,parseFloat(e.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(let a=0;a<n.children.length;a++)t(e,r,n.children[a])}function r(e,t,i){const o={name:"",type:"",frames:[]};i.push(o);let s=t.split(/[\s]+/);"END"===s[0].toUpperCase()&&"SITE"===s[1].toUpperCase()?(o.type="ENDSITE",o.name="ENDSITE"):(o.name=s[1],o.type=s[0].toUpperCase()),"{"!==n(e)&&console.error("THREE.BVHLoader: Expected opening { after type & name"),s=n(e).split(/[\s]+/),"OFFSET"!==s[0]&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+s[0]),4!==s.length&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");const l=new a.Vector3(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));if((isNaN(l.x)||isNaN(l.y)||isNaN(l.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),o.offset=l,"ENDSITE"!==o.type){s=n(e).split(/[\s]+/),"CHANNELS"!==s[0]&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");const t=parseInt(s[1]);o.channels=s.splice(2,t),o.children=[]}for(;;){const t=n(e);if("}"===t)return o;o.children.push(r(e,t,i))}}function n(e){let t;for(;0===(t=e.shift().trim()).length;);return t}const i=this,o=function(e){"HIERARCHY"!==n(e)&&console.error("THREE.BVHLoader: HIERARCHY expected.");const i=[],o=r(e,n(e),i);"MOTION"!==n(e)&&console.error("THREE.BVHLoader: MOTION expected.");let a=n(e).split(/[\s]+/);const s=parseInt(a[1]);isNaN(s)&&console.error("THREE.BVHLoader: Failed to read number of frames."),a=n(e).split(/[\s]+/);const l=parseFloat(a[2]);isNaN(l)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(let r=0;r<s;r++)a=n(e).split(/[\s]+/),t(a,r*l,o);return i}(e.split(/[\r\n]+/g)),s=[];!function e(t,r){const n=new a.Bone;if(r.push(n),n.position.add(t.offset),n.name=t.name,"ENDSITE"!==t.type)for(let i=0;i<t.children.length;i++)n.add(e(t.children[i],r));return n}(o[0],s);const l=function(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if("ENDSITE"===n.type)continue;const o=[],s=[],l=[];for(let e=0;e<n.frames.length;e++){const t=n.frames[e];o.push(t.time),s.push(t.position.x+n.offset.x),s.push(t.position.y+n.offset.y),s.push(t.position.z+n.offset.z),l.push(t.rotation.x),l.push(t.rotation.y),l.push(t.rotation.z),l.push(t.rotation.w)}i.animateBonePositions&&t.push(new a.VectorKeyframeTrack(".bones["+n.name+"].position",o,s)),i.animateBoneRotations&&t.push(new a.QuaternionKeyframeTrack(".bones["+n.name+"].quaternion",o,l))}return new a.AnimationClip("animation",-1,t)}(o);return{skeleton:new a.Skeleton(s),clip:l}}}class Ls extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=""===i.path?a.LoaderUtils.extractUrlBase(e):i.path,s=new a.FileLoader(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,(function(r){try{t(i.parse(r,o))}catch(a){n?n(a):console.error(a),i.manager.itemError(e)}}),r,n)}parse(e,t){function r(e,t){const r=[],n=e.childNodes;for(let i=0,o=n.length;i<o;i++){const e=n[i];e.nodeName===t&&r.push(e)}return r}function n(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),r=new Array(t.length);for(let n=0,i=t.length;n<i;n++)r[n]=t[n];return r}function i(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),r=new Array(t.length);for(let n=0,i=t.length;n<i;n++)r[n]=parseFloat(t[n]);return r}function o(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),r=new Array(t.length);for(let n=0,i=t.length;n<i;n++)r[n]=parseInt(t[n]);return r}function s(e){return e.substring(1)}function l(e){return 0===Object.keys(e).length}function c(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function h(e,t,n,i){const o=r(e,t)[0];if(void 0!==o){const e=r(o,n);for(let t=0;t<e.length;t++)i(e[t])}}function d(e,t){for(const r in e){e[r].build=t(e[r])}}function f(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){const t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":const e=s(n.getAttribute("source")),r=n.getAttribute("semantic");t.inputs[r]=e}}return t}function m(e){const t={};let r=e.getAttribute("target").split("/");const n=r.shift();let i=r.shift();const o=-1!==i.indexOf("("),a=-1!==i.indexOf(".");if(a)r=i.split("."),i=r.shift(),t.member=r.shift();else if(o){const e=i.split("(");i=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=n,t.sid=i,t.arraySyntax=o,t.memberSyntax=a,t.sampler=s(e.getAttribute("source")),t}function g(e){const t=[],r=e.channels,n=e.samplers,i=e.sources;for(const o in r)if(r.hasOwnProperty(o)){const e=r[o],a=n[e.sampler],s=a.inputs.INPUT,l=a.inputs.OUTPUT;w(v(e,i[s],i[l]),t)}return t}function A(e){return f(Je.animations[e],g)}function v(e,t,r){const n=Je.nodes[e.id],i=ke(n.id),o=n.transforms[e.sid],a=n.matrix.clone().transpose();let s,l,c,u,h,d;const f={};switch(o){case"matrix":for(c=0,u=t.array.length;c<u;c++)if(s=t.array[c],l=c*r.stride,void 0===f[s]&&(f[s]={}),!0===e.arraySyntax){const t=r.array[l],n=e.indices[0]+4*e.indices[1];f[s][n]=t}else for(h=0,d=r.stride;h<d;h++)f[s][h]=r.array[l+h];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',o)}const p=function(e,t){const r=[];for(const i in e)r.push({time:parseFloat(i),value:e[i]});r.sort(n);for(let i=0;i<16;i++)C(r,i,t.elements[i]);return r;function n(e,t){return e.time-t.time}}(f,a);return{name:i.uuid,keyframes:p}}const y=new a.Vector3,x=new a.Vector3,b=new a.Quaternion;function w(e,t){const r=e.keyframes,n=e.name,i=[],o=[],s=[],l=[];for(let a=0,c=r.length;a<c;a++){const e=r[a],t=e.time,n=e.value;Te.fromArray(n).transpose(),Te.decompose(y,b,x),i.push(t),o.push(y.x,y.y,y.z),s.push(b.x,b.y,b.z,b.w),l.push(x.x,x.y,x.z)}return o.length>0&&t.push(new a.VectorKeyframeTrack(n+".position",i,o)),s.length>0&&t.push(new a.QuaternionKeyframeTrack(n+".quaternion",i,s)),l.length>0&&t.push(new a.VectorKeyframeTrack(n+".scale",i,l)),t}function C(e,t,r){let n,i,o,a=!0;for(i=0,o=e.length;i<o;i++)n=e[i],void 0===n.value[t]?n.value[t]=null:a=!1;if(!0===a)for(i=0,o=e.length;i<o;i++)n=e[i],n.value[t]=r;else!function(e,t){let r,n;for(let i=0,o=e.length;i<o;i++){const o=e[i];if(null===o.value[t]){if(r=E(e,i,t),n=S(e,i,t),null===r){o.value[t]=n.value[t];continue}if(null===n){o.value[t]=r.value[t];continue}T(o,r,n,t)}}}(e,t)}function E(e,t,r){for(;t>=0;){const n=e[t];if(null!==n.value[r])return n;t--}return null}function S(e,t,r){for(;t<e.length;){const n=e[t];if(null!==n.value[r])return n;t++}return null}function T(e,t,r,n){r.time-t.time!==0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function M(e){const t=[],r=e.name,n=e.end-e.start||-1,i=e.animations;for(let o=0,a=i.length;o<a;o++){const e=A(i[o]);for(let r=0,n=e.length;r<n;r++)t.push(e[r])}return new a.AnimationClip(r,n,t)}function I(e){return f(Je.clips[e],M)}function B(e){const t={sources:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(n.textContent);break;case"source":const e=n.getAttribute("id");t.sources[e]=ae(n);break;case"joints":t.joints=_(n);break;case"vertex_weights":t.vertexWeights=F(n)}}return t}function _(e){const t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":const e=n.getAttribute("semantic"),r=s(n.getAttribute("source"));t.inputs[e]=r}}return t}function F(e){const t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":const e=n.getAttribute("semantic"),r=s(n.getAttribute("source")),i=parseInt(n.getAttribute("offset"));t.inputs[e]={id:r,offset:i};break;case"vcount":t.vcount=o(n.textContent);break;case"v":t.v=o(n.textContent)}}return t}function P(e){const t={id:e.id},r=Je.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){const t=4,r={joints:[],indices:{array:[],stride:t},weights:{array:[],stride:t}},n=e.sources,i=e.vertexWeights,o=i.vcount,s=i.v,l=i.inputs.JOINT.offset,c=i.inputs.WEIGHT.offset,u=e.sources[e.joints.inputs.JOINT],h=e.sources[e.joints.inputs.INV_BIND_MATRIX],d=n[i.inputs.WEIGHT.id].array;let f,p,m,g=0;for(f=0,m=o.length;f<m;f++){const e=o[f],n=[];for(p=0;p<e;p++){const e=s[g+l],t=d[s[g+c]];n.push({index:e,weight:t}),g+=2}for(n.sort(A),p=0;p<t;p++){const e=n[p];void 0!==e?(r.indices.array.push(e.index),r.weights.array.push(e.weight)):(r.indices.array.push(0),r.weights.array.push(0))}}e.bindShapeMatrix?r.bindMatrix=(new a.Matrix4).fromArray(e.bindShapeMatrix).transpose():r.bindMatrix=(new a.Matrix4).identity();for(f=0,m=u.array.length;f<m;f++){const e=u.array[f],t=(new a.Matrix4).fromArray(h.array,f*h.stride).transpose();r.joints.push({name:e,boneInverse:t})}return r;function A(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function R(e){return void 0!==e.build?e.build:e.init_from}function L(e){const t=Je.images[e];return void 0!==t?f(t,R):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function D(e){const t={surfaces:{},samplers:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"newparam":N(n,t);break;case"technique":t.technique=U(n);break;case"extra":t.extra=H(n)}}return t}function N(e,t){const r=e.getAttribute("sid");for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"surface":t.surfaces[r]=k(i);break;case"sampler2D":t.samplers[r]=O(i)}}}function k(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"init_from":t.init_from=n.textContent}}return t}function O(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"source":t.source=n.textContent}}return t}function U(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=Q(n);break;case"extra":t.extra=H(n)}}return t}function Q(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[n.nodeName]=V(n);break;case"transparent":t[n.nodeName]={opaque:n.hasAttribute("opaque")?n.getAttribute("opaque"):"A_ONE",data:V(n)}}}return t}function V(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"color":t[n.nodeName]=i(n.textContent);break;case"float":t[n.nodeName]=parseFloat(n.textContent);break;case"texture":t[n.nodeName]={id:n.getAttribute("texture"),extra:G(n)}}}return t}function G(e){const t={technique:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"extra":z(n,t)}}return t}function z(e,t){for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":j(n,t)}}}function j(e,t){for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent);break;case"bump":t[n.nodeName]=Z(n)}}}function H(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":t.technique=W(n)}}return t}function W(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"double_sided":t[n.nodeName]=parseInt(n.textContent);break;case"bump":t[n.nodeName]=Z(n)}}return t}function Z(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"texture":t[i.nodeName]={id:i.getAttribute("texture"),texcoord:i.getAttribute("texcoord"),extra:G(i)}}}return t}function X(e){return e}function Y(e){const t=(r=e.url,f(Je.effects[r],X));var r;const n=t.profile.technique;let i;switch(n.type){case"phong":case"blinn":i=new a.MeshPhongMaterial;break;case"lambert":i=new a.MeshLambertMaterial;break;default:i=new a.MeshBasicMaterial}function o(e){const r=t.profile.samplers[e.id];let n=null;if(void 0!==r){n=L(t.profile.surfaces[r.source].init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),n=L(e.id);if(null!==n){const t=function(e){let t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase(),r){case"tga":t=We;break;default:t=He}return t}(n);if(void 0!==t){const r=t.load(n),i=e.extra;if(void 0!==i&&void 0!==i.technique&&!1===l(i.technique)){const e=i.technique;r.wrapS=e.wrapU?a.RepeatWrapping:a.ClampToEdgeWrapping,r.wrapT=e.wrapV?a.RepeatWrapping:a.ClampToEdgeWrapping,r.offset.set(e.offsetU||0,e.offsetV||0),r.repeat.set(e.repeatU||1,e.repeatV||1)}else r.wrapS=a.RepeatWrapping,r.wrapT=a.RepeatWrapping;return r}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",n),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}i.name=e.name||"";const s=n.parameters;for(const a in s){const e=s[a];switch(a){case"diffuse":e.color&&i.color.fromArray(e.color),e.texture&&(i.map=o(e.texture));break;case"specular":e.color&&i.specular&&i.specular.fromArray(e.color),e.texture&&(i.specularMap=o(e.texture));break;case"bump":e.texture&&(i.normalMap=o(e.texture));break;case"ambient":e.texture&&(i.lightMap=o(e.texture));break;case"shininess":e.float&&i.shininess&&(i.shininess=e.float);break;case"emission":e.color&&i.emissive&&i.emissive.fromArray(e.color),e.texture&&(i.emissiveMap=o(e.texture))}}let c=s.transparent,u=s.transparency;if(void 0===u&&c&&(u={float:1}),void 0===c&&u&&(c={opaque:"A_ONE",data:{color:[1,1,1,1]}}),c&&u)if(c.data.texture)i.transparent=!0;else{const e=c.data.color;switch(c.opaque){case"A_ONE":i.opacity=e[3]*u.float;break;case"RGB_ZERO":i.opacity=1-e[0]*u.float;break;case"A_ZERO":i.opacity=1-e[3]*u.float;break;case"RGB_ONE":i.opacity=e[0]*u.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',c.opaque)}i.opacity<1&&(i.transparent=!0)}if(void 0!==n.extra&&void 0!==n.extra.technique){const e=n.extra.technique;for(const t in e){const r=e[t];switch(t){case"double_sided":i.side=1===r?a.DoubleSide:a.FrontSide;break;case"bump":i.normalMap=o(r.texture),i.normalScale=new a.Vector2(1,1)}}}return i}function J(e){return f(Je.materials[e],Y)}function q(e){for(let t=0;t<e.childNodes.length;t++){const r=e.childNodes[t];switch(r.nodeName){case"technique_common":return K(r)}}return{}}function K(e){const t={};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=$(n)}}return t}function $(e){const t={};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function ee(e){let t;switch(e.optics.technique){case"perspective":t=new a.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let r=e.optics.parameters.ymag,n=e.optics.parameters.xmag;const i=e.optics.parameters.aspect_ratio;n=void 0===n?r*i:n,r=void 0===r?n/i:r,n*=.5,r*=.5,t=new a.OrthographicCamera(-n,n,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new a.PerspectiveCamera}return t.name=e.name||"",t}function te(e){const t=Je.cameras[e];return void 0!==t?f(t,ee):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function re(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=ne(n)}}return t}function ne(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"color":const e=i(n.textContent);t.color=(new a.Color).fromArray(e);break;case"falloff_angle":t.falloffAngle=parseFloat(n.textContent);break;case"quadratic_attenuation":const r=parseFloat(n.textContent);t.distance=r?Math.sqrt(1/r):0}}return t}function ie(e){let t;switch(e.technique){case"directional":t=new a.DirectionalLight;break;case"point":t=new a.PointLight;break;case"spot":t=new a.SpotLight;break;case"ambient":t=new a.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function oe(e){const t=Je.lights[e];return void 0!==t?f(t,ie):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ae(e){const t={array:[],stride:3};for(let o=0;o<e.childNodes.length;o++){const a=e.childNodes[o];if(1===a.nodeType)switch(a.nodeName){case"float_array":t.array=i(a.textContent);break;case"Name_array":t.array=n(a.textContent);break;case"technique_common":const e=r(a,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function se(e){const t={};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=s(n.getAttribute("source")))}return t}function le(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":const e=s(n.getAttribute("source")),r=n.getAttribute("semantic"),i=parseInt(n.getAttribute("offset")),a=parseInt(n.getAttribute("set")),l=a>0?r+a:r;t.inputs[l]={id:e,offset:i},t.stride=Math.max(t.stride,i+1),"TEXCOORD"===r&&(t.hasUV=!0);break;case"vcount":t.vcount=o(n.textContent);break;case"p":t.p=o(n.textContent)}}return t}function ce(e){let t=0;for(let r=0,n=e.length;r<n;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ue(e){const t={},r=e.sources,n=e.vertices,i=e.primitives;if(0===i.length)return{};const o=function(e){const t={};for(let r=0;r<e.length;r++){const n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(i);for(const a in o){const e=o[a];ce(e),t[a]=he(e,r,n)}return t}function he(e,t,r){const n={},i={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c={array:[],stride:0},u=[],h=4,d=[],f=4,p=new a.BufferGeometry,m=[];let g=0;for(let a=0;a<e.length;a++){const n=e[a],h=n.inputs;let f=0;switch(n.type){case"lines":case"linestrips":f=2*n.count;break;case"triangles":f=3*n.count;break;case"polylist":for(let e=0;e<n.count;e++){const t=n.vcount[e];switch(t){case 3:f+=3;break;case 4:f+=6;break;default:f+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",n.type)}p.addGroup(g,f,a),g+=f,n.material&&m.push(n.material);for(const a in h){const f=h[a];switch(a){case"VERTEX":for(const a in r){const h=r[a];switch(a){case"POSITION":const r=i.array.length;if(de(n,t[h],f.offset,i.array),i.stride=t[h].stride,t.skinWeights&&t.skinIndices&&(de(n,t.skinIndices,f.offset,u),de(n,t.skinWeights,f.offset,d)),!1===n.hasUV&&!0===e.uvsNeedsFix){const e=(i.array.length-r)/i.stride;for(let t=0;t<e;t++)s.array.push(0,0)}break;case"NORMAL":de(n,t[h],f.offset,o.array),o.stride=t[h].stride;break;case"COLOR":de(n,t[h],f.offset,c.array),c.stride=t[h].stride;break;case"TEXCOORD":de(n,t[h],f.offset,s.array),s.stride=t[h].stride;break;case"TEXCOORD1":de(n,t[h],f.offset,l.array),s.stride=t[h].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',a)}}break;case"NORMAL":de(n,t[f.id],f.offset,o.array),o.stride=t[f.id].stride;break;case"COLOR":de(n,t[f.id],f.offset,c.array),c.stride=t[f.id].stride;break;case"TEXCOORD":de(n,t[f.id],f.offset,s.array),s.stride=t[f.id].stride;break;case"TEXCOORD1":de(n,t[f.id],f.offset,l.array),l.stride=t[f.id].stride}}}return i.array.length>0&&p.setAttribute("position",new a.Float32BufferAttribute(i.array,i.stride)),o.array.length>0&&p.setAttribute("normal",new a.Float32BufferAttribute(o.array,o.stride)),c.array.length>0&&p.setAttribute("color",new a.Float32BufferAttribute(c.array,c.stride)),s.array.length>0&&p.setAttribute("uv",new a.Float32BufferAttribute(s.array,s.stride)),l.array.length>0&&p.setAttribute("uv2",new a.Float32BufferAttribute(l.array,l.stride)),u.length>0&&p.setAttribute("skinIndex",new a.Float32BufferAttribute(u,h)),d.length>0&&p.setAttribute("skinWeight",new a.Float32BufferAttribute(d,f)),n.data=p,n.type=e[0].type,n.materialKeys=m,n}function de(e,t,r,n){const i=e.p,o=e.stride,a=e.vcount;function s(e){let t=i[e+r]*c;const o=t+c;for(;t<o;t++)n.push(l[t])}const l=t.array,c=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,r=a.length;t<r;t++){const r=a[t];if(4===r){const t=e+1*o,r=e+2*o,n=e+3*o;s(e+0*o),s(t),s(n),s(t),s(r),s(n)}else if(3===r){const t=e+1*o,r=e+2*o;s(e+0*o),s(t),s(r)}else if(r>4)for(let t=1,n=r-2;t<=n;t++){const r=e+o*t,n=e+o*(t+1);s(e+0*o),s(r),s(n)}e+=o*r}}else for(let u=0,h=i.length;u<h;u+=o)s(u)}function fe(e){return f(Je.geometries[e],ue)}function pe(e){return void 0!==e.build?e.build:e}function me(e,t){for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=ge(n);break;case"link":t.links.push(ve(n))}}}function ge(e){let t;for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=Ae(n)}}return t}function Ae(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new a.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":const e=i(n.textContent);t.axis.fromArray(e);break;case"limits":const r=n.getElementsByTagName("max")[0],o=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(r.textContent),t.limits.min=parseFloat(o.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ve(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ye(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(xe(n))}}return t}function ye(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(xe(n))}}return t}function xe(e){const t={type:e.nodeName},r=i(e.textContent);switch(t.type){case"matrix":t.obj=new a.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new a.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new a.Vector3,t.obj.fromArray(r),t.angle=a.MathUtils.degToRad(r[3])}return t}function be(e,t){for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":we(n,t)}}}function we(e,t){for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=i(n.textContent);break;case"mass":t.mass=i(n.textContent)[0]}}}function Ce(e){const t={target:e.getAttribute("target").split("/").pop()};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":const e=n.getElementsByTagName("param")[0];t.axis=e.textContent;const r=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=r.substr(0,r.length-1)}}return t}function Ee(e){return void 0!==e.build?e.build:e}function Se(e){const t=[],r=Ve.querySelector('[id="'+e.id+'"]');for(let n=0;n<r.childNodes.length;n++){const e=r.childNodes[n];if(1!==e.nodeType)continue;let o,s;switch(e.nodeName){case"matrix":o=i(e.textContent);const r=(new a.Matrix4).fromArray(o).transpose();t.push({sid:e.getAttribute("sid"),type:e.nodeName,obj:r});break;case"translate":case"scale":o=i(e.textContent),s=(new a.Vector3).fromArray(o),t.push({sid:e.getAttribute("sid"),type:e.nodeName,obj:s});break;case"rotate":o=i(e.textContent),s=(new a.Vector3).fromArray(o);const n=a.MathUtils.degToRad(o[3]);t.push({sid:e.getAttribute("sid"),type:e.nodeName,obj:s,angle:n})}}return t}const Te=new a.Matrix4,Me=new a.Vector3;function Ie(e){const t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new a.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1!==n.nodeType)continue;let o;switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),Ie(n);break;case"instance_camera":t.instanceCameras.push(s(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Be(n));break;case"instance_light":t.instanceLights.push(s(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Be(n));break;case"instance_node":t.instanceNodes.push(s(n.getAttribute("url")));break;case"matrix":o=i(n.textContent),t.matrix.multiply(Te.fromArray(o).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":o=i(n.textContent),Me.fromArray(o),t.matrix.multiply(Te.makeTranslation(Me.x,Me.y,Me.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":o=i(n.textContent);const e=a.MathUtils.degToRad(o[3]);t.matrix.multiply(Te.makeRotationAxis(Me.fromArray(o),e)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":o=i(n.textContent),t.matrix.scale(Me.fromArray(o)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return Ne(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Je.nodes[t.id]=t,t}function Be(e){const t={id:s(e.getAttribute("url")),materials:{},skeletons:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];switch(n.nodeName){case"bind_material":const e=n.getElementsByTagName("instance_material");for(let r=0;r<e.length;r++){const n=e[r],i=n.getAttribute("symbol"),o=n.getAttribute("target");t.materials[i]=s(o)}break;case"skeleton":t.skeletons.push(s(n.textContent))}}return t}function _e(e,t){const r=[],n=[];let i,o,s;for(i=0;i<e.length;i++){const n=e[i];let o;if(Ne(n))o=ke(n),Fe(o,t,r);else if(l=n,void 0!==Je.visualScenes[l]){const e=Je.visualScenes[n].children;for(let n=0;n<e.length;n++){const i=e[n];if("JOINT"===i.type){Fe(ke(i.id),t,r)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",n)}var l;for(i=0;i<t.length;i++)for(o=0;o<r.length;o++)if(s=r[o],s.bone.name===t[i].name){n[i]=s,s.processed=!0;break}for(i=0;i<r.length;i++)s=r[i],!1===s.processed&&(n.push(s),s.processed=!0);const c=[],u=[];for(i=0;i<n.length;i++)s=n[i],c.push(s.bone),u.push(s.boneInverse);return new a.Skeleton(c,u)}function Fe(e,t,r){e.traverse((function(e){if(!0===e.isBone){let n;for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e.name){n=i.boneInverse;break}}void 0===n&&(n=new a.Matrix4),r.push({bone:e,boneInverse:n,processed:!1})}}))}function Pe(e){const t=[],r=e.matrix,n=e.nodes,i=e.type,o=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,c=e.instanceGeometries,u=e.instanceNodes;for(let a=0,f=n.length;a<f;a++)t.push(ke(n[a]));for(let a=0,f=o.length;a<f;a++){const e=te(o[a]);null!==e&&t.push(e.clone())}for(let a=0,p=s.length;a<p;a++){const e=s[a],r=(h=e.id,f(Je.controllers[h],P)),n=De(fe(r.id),e.materials),i=_e(e.skeletons,r.skin.joints);for(let o=0,a=n.length;o<a;o++){const e=n[o];e.isSkinnedMesh&&(e.bind(i,r.skin.bindMatrix),e.normalizeSkinWeights()),t.push(e)}}var h;for(let a=0,f=l.length;a<f;a++){const e=oe(l[a]);null!==e&&t.push(e.clone())}for(let a=0,f=c.length;a<f;a++){const e=c[a],r=De(fe(e.id),e.materials);for(let n=0,i=r.length;n<i;n++)t.push(r[n])}for(let a=0,f=u.length;a<f;a++)t.push(ke(u[a]).clone());let d;if(0===n.length&&1===t.length)d=t[0];else{d="JOINT"===i?new a.Bone:new a.Group;for(let e=0;e<t.length;e++)d.add(t[e])}return d.name="JOINT"===i?e.sid:e.name,d.matrix.copy(r),d.matrix.decompose(d.position,d.quaternion,d.scale),d}const Re=new a.MeshBasicMaterial({color:16711935});function Le(e,t){const r=[];for(let n=0,i=e.length;n<i;n++){const i=t[e[n]];void 0===i?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(Re)):r.push(J(i))}return r}function De(e,t){const r=[];for(const n in e){const i=e[n],o=Le(i.materialKeys,t);0===o.length&&("lines"===n||"linestrips"===n?o.push(new a.LineBasicMaterial):o.push(new a.MeshPhongMaterial));const s=void 0!==i.data.attributes.skinIndex,l=1===o.length?o[0]:o;let c;switch(n){case"lines":c=new a.LineSegments(i.data,l);break;case"linestrips":c=new a.Line(i.data,l);break;case"triangles":case"polylist":c=s?new a.SkinnedMesh(i.data,l):new a.Mesh(i.data,l)}r.push(c)}return r}function Ne(e){return void 0!==Je.nodes[e]}function ke(e){return f(Je.nodes[e],Pe)}function Oe(e){const t=new a.Group;t.name=e.name;const r=e.children;for(let n=0;n<r.length;n++){const e=r[n];t.add(ke(e.id))}return t}function Ue(e){return f(Je.visualScenes[e],Oe)}if(0===e.length)return{scene:new a.Scene};const Qe=(new DOMParser).parseFromString(e,"application/xml"),Ve=r(Qe,"COLLADA")[0],Ge=Qe.getElementsByTagName("parsererror")[0];if(void 0!==Ge){const e=r(Ge,"div")[0];let t;return t=e?e.textContent:function(e){let t="";const r=[e];for(;r.length;){const e=r.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",r.push.apply(r,e.childNodes))}return t.trim()}(Ge),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const ze=Ve.getAttribute("version");console.log("THREE.ColladaLoader: File version",ze);const je=function(e){return{unit:c(r(e,"unit")[0]),upAxis:u(r(e,"up_axis")[0])}}(r(Ve,"asset")[0]),He=new a.TextureLoader(this.manager);let We;He.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),Ss&&(We=new Ss(this.manager),We.setPath(this.resourcePath||t));const Ze=[];let Xe={},Ye=0;const Je={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h(Ve,"library_animations","animation",(function e(t){const r={sources:{},samplers:{},channels:{}};let n=!1;for(let i=0,o=t.childNodes.length;i<o;i++){const o=t.childNodes[i];if(1!==o.nodeType)continue;let a;switch(o.nodeName){case"source":a=o.getAttribute("id"),r.sources[a]=ae(o);break;case"sampler":a=o.getAttribute("id"),r.samplers[a]=p(o);break;case"channel":a=o.getAttribute("target"),r.channels[a]=m(o);break;case"animation":e(o),n=!0;break;default:console.log(o)}}!1===n&&(Je.animations[t.getAttribute("id")||a.MathUtils.generateUUID()]=r)})),h(Ve,"library_animation_clips","animation_clip",(function(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_animation":t.animations.push(s(n.getAttribute("url")))}}Je.clips[e.getAttribute("id")]=t})),h(Ve,"library_controllers","controller",(function(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=s(n.getAttribute("source")),t.skin=B(n);break;case"morph":t.id=s(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Je.controllers[e.getAttribute("id")]=t})),h(Ve,"library_images","image",(function(e){const t={init_from:r(e,"init_from")[0].textContent};Je.images[e.getAttribute("id")]=t})),h(Ve,"library_effects","effect",(function(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"profile_COMMON":t.profile=D(n)}}Je.effects[e.getAttribute("id")]=t})),h(Ve,"library_materials","material",(function(e){const t={name:e.getAttribute("name")};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_effect":t.url=s(n.getAttribute("url"))}}Je.materials[e.getAttribute("id")]=t})),h(Ve,"library_cameras","camera",(function(e){const t={name:e.getAttribute("name")};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"optics":t.optics=q(n)}}Je.cameras[e.getAttribute("id")]=t})),h(Ve,"library_lights","light",(function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":t=re(n)}}Je.lights[e.getAttribute("id")]=t})),h(Ve,"library_geometries","geometry",(function(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(e,"mesh")[0];if(void 0!==n){for(let e=0;e<n.childNodes.length;e++){const r=n.childNodes[e];if(1!==r.nodeType)continue;const i=r.getAttribute("id");switch(r.nodeName){case"source":t.sources[i]=ae(r);break;case"vertices":t.vertices=se(r);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",r.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(le(r));break;default:console.log(r)}}Je.geometries[e.getAttribute("id")]=t}})),h(Ve,"library_nodes","node",Ie),h(Ve,"library_visual_scenes","visual_scene",(function(e){const t={name:e.getAttribute("name"),children:[]};!function(e){const t=e.getElementsByTagName("node");for(let r=0;r<t.length;r++){const e=t[r];!1===e.hasAttribute("id")&&e.setAttribute("id","three_default_"+Ye++)}}(e);const n=r(e,"node");for(let r=0;r<n.length;r++)t.children.push(Ie(n[r]));Je.visualScenes[e.getAttribute("id")]=t})),h(Ve,"library_kinematics_models","kinematics_model",(function(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":me(n,t)}}Je.kinematicsModels[e.getAttribute("id")]=t})),h(Ve,"library_physics_models","physics_model",(function(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"rigid_body":t.rigidBodies[n.getAttribute("name")]={},be(n,t.rigidBodies[n.getAttribute("name")])}}Je.physicsModels[e.getAttribute("id")]=t})),h(Ve,"scene","instance_kinematics_scene",(function(e){const t={bindJointAxis:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Ce(n))}}Je.kinematicsScenes[s(e.getAttribute("url"))]=t})),d(Je.animations,g),d(Je.clips,M),d(Je.controllers,P),d(Je.images,R),d(Je.effects,X),d(Je.materials,Y),d(Je.cameras,ee),d(Je.lights,ie),d(Je.geometries,ue),d(Je.visualScenes,Oe),function(){const e=Je.clips;if(!0===l(e)){if(!1===l(Je.animations)){const e=[];for(const t in Je.animations){const r=A(t);for(let t=0,n=r.length;t<n;t++)e.push(r[t])}Ze.push(new a.AnimationClip("default",-1,e))}}else for(const t in e)Ze.push(I(t))}(),function(){const e=Object.keys(Je.kinematicsModels)[0],t=Object.keys(Je.kinematicsScenes)[0],r=Object.keys(Je.visualScenes)[0];if(void 0===e||void 0===t)return;const n=(i=e,f(Je.kinematicsModels[i],pe));var i;const o=function(e){return f(Je.kinematicsScenes[e],Ee)}(t),s=Ue(r),l=o.bindJointAxis,c={};for(let a=0,d=l.length;a<d;a++){const e=l[a],t=Ve.querySelector('[sid="'+e.target+'"]');if(t){const r=t.parentElement;u(e.jointIndex,r)}}function u(e,t){const r=t.getAttribute("name"),i=n.joints[e];s.traverse((function(n){n.name===r&&(c[e]={object:n,transforms:Se(t),joint:i,position:i.zeroPosition})}))}const h=new a.Matrix4;Xe={joints:n&&n.joints,getJointValue:function(e){const t=c[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){const r=c[e];if(r){const n=r.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{const i=r.object,o=n.axis,s=r.transforms;Te.identity();for(let r=0;r<s.length;r++){const i=s[r];if(i.sid&&-1!==i.sid.indexOf(e))switch(n.type){case"revolute":Te.multiply(h.makeRotationAxis(o,a.MathUtils.degToRad(t)));break;case"prismatic":Te.multiply(h.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(i.type){case"matrix":Te.multiply(i.obj);break;case"translate":Te.multiply(h.makeTranslation(i.obj.x,i.obj.y,i.obj.z));break;case"scale":Te.scale(i.obj);break;case"rotate":Te.multiply(h.makeRotationAxis(i.obj,i.angle))}}i.matrix.copy(Te),i.matrix.decompose(i.position,i.quaternion,i.scale),c[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}();const qe=function(e){return Ue(s(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(Ve,"scene")[0]);return qe.animations=Ze,"Z_UP"===je.upAxis&&qe.quaternion.setFromEuler(new a.Euler(-Math.PI/2,0,0)),qe.scale.multiplyScalar(je.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Ze},kinematics:Xe,library:Je,scene:qe}}}class Ds extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){const t=new a.LoadingManager;t.setURLModifier((function(e){const t=function(e){for(const t in r)if(t.substr(-e.length)===e)return r[t]}(e);if(t){console.log("Loading",e);const r=new Blob([t.buffer],{type:"application/octet-stream"});return URL.createObjectURL(r)}return e}));const r=(0,fn.GZ)(new Uint8Array(e));if(r["doc.kml"]){const e=(new DOMParser).parseFromString(fflate.strFromU8(r["doc.kml"]),"application/xml").querySelector("Placemark Model Link href");if(e){return new Ls(t).parse(fflate.strFromU8(r[e.textContent]))}}else{console.warn("KMZLoader: Missing doc.kml file.");for(const e in r){if("dae"===e.split(".").pop().toLowerCase()){return new Ls(t).parse(fflate.strFromU8(r[e]))}}}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new a.Group}}}var Ns=r(8569);class ks extends a.Loader{constructor(e){super(e),this.gltfLoader=new Ns.E(e)}load(e,t,r,n){const i=this;this.gltfLoader.load(e,(function(r){try{i.parse(r,t)}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}setDRACOLoader(e){return this.gltfLoader.setDRACOLoader(e),this}parse(e,t){t(e)}}var Os=r(2018);Os.ue,Os.r3;const Us=Os.wd,Qs=(Os._o,Os.sd,Os.N7,Os.nu,Os.Mf,Os.hW),Vs=(Os.Bw,Os.P7,Os.z5,Os.Sj,Os.Oq,Os.Wx,Os._b,Os.b4,Os.hI,Os.ej,Os.fK,Os.pT,Os.$9,Os.oI,Os.q4,Os.LK,Os.H7,Os.V3);Os.dK,Os.ZW,Os.Hs,Os.bS,Os.N$,Os.SE,Os.l$,Os.ol,Os.vA;class Gs extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=""===i.path?a.LoaderUtils.extractUrlBase(e):i.path,s=new a.FileLoader(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,(function(r){try{t(i.parse(r,o))}catch(a){n?n(a):console.error(a),i.manager.itemError(e)}}),r,n)}parse(e,t){const r={};function n(e){e.DEF&&(r[e.DEF]=e);const t=e.fields;for(let r=0,i=t.length;r<i;r++){const e=t[r];if("node"===e.type){const t=e.values;for(let e=0,r=t.length;e<r;e++)n(t[e])}}}function i(e){return e.USE?function(e){const t=i(r[e]);return t.isObject3D||t.isMaterial?t.clone():t}(e.USE):(void 0!==e.build||(e.build=function(e){const t=e.name;let r;switch(t){case"Group":case"Transform":case"Collision":r=function(e){const t=new a.Group,r=e.fields;for(let n=0,i=r.length;n<i;n++){const e=r[n],i=e.name,o=e.values;switch(i){case"bboxCenter":case"bboxSize":case"center":break;case"children":l(o,t);break;case"collide":break;case"rotation":const e=new a.Vector3(o[0],o[1],o[2]),r=o[3];t.quaternion.setFromAxisAngle(e,r);break;case"scale":t.scale.set(o[0],o[1],o[2]);break;case"scaleOrientation":break;case"translation":t.position.set(o[0],o[1],o[2]);break;case"proxy":break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return t}(e);break;case"Background":r=function(e){const t=new a.Group;let r,n,i,o;const s=e.fields;for(let a=0,c=s.length;a<c;a++){const e=s[a],t=e.name,l=e.values;switch(t){case"groundAngle":r=l;break;case"groundColor":n=l;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":i=l;break;case"skyColor":o=l;break;default:console.warn("THREE.VRMLLoader: Unknown field:",t)}}const l=1e4;if(o){const e=new a.SphereGeometry(l,32,16),r=new a.MeshBasicMaterial({fog:!1,side:a.BackSide,depthWrite:!1,depthTest:!1});o.length>3?(B(e,l,i,I(o),!0),r.vertexColors=!0):r.color.setRGB(o[0],o[1],o[2]);const n=new a.Mesh(e,r);t.add(n)}if(n&&n.length>0){const e=new a.SphereGeometry(l,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),i=new a.MeshBasicMaterial({fog:!1,side:a.BackSide,vertexColors:!0,depthWrite:!1,depthTest:!1});B(e,l,r,I(n),!1);const o=new a.Mesh(e,i);t.add(o)}return t.renderOrder=-1/0,t}(e);break;case"Shape":r=function(e){const t=e.fields;let r,n,o=new a.MeshBasicMaterial({color:0});for(let a=0,s=t.length;a<s;a++){const e=t[a],n=e.name,s=e.values;switch(n){case"appearance":null!==s[0]&&(o=i(s[0]));break;case"geometry":null!==s[0]&&(r=i(s[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",n)}}if(r&&r.attributes.position){const e=r._type;if("points"===e){const e=new a.PointsMaterial({color:16777215});void 0!==r.attributes.color?e.vertexColors=!0:o.isMeshPhongMaterial&&e.color.copy(o.emissive),n=new a.Points(r,e)}else if("line"===e){const e=new a.LineBasicMaterial({color:16777215});void 0!==r.attributes.color?e.vertexColors=!0:o.isMeshPhongMaterial&&e.color.copy(o.emissive),n=new a.LineSegments(r,e)}else void 0!==r._solid&&(o.side=r._solid?a.FrontSide:a.DoubleSide),void 0!==r.attributes.color&&(o.vertexColors=!0),n=new a.Mesh(r,o)}else n=new a.Object3D,n.visible=!1;return n}(e);break;case"Appearance":r=function(e){let t,r=new a.MeshPhongMaterial;const n=e.fields;for(let o=0,s=n.length;o<s;o++){const e=n[o],s=e.name,l=e.values;switch(s){case"material":if(null!==l[0]){const e=i(l[0]);e.diffuseColor&&r.color.copy(e.diffuseColor),e.emissiveColor&&r.emissive.copy(e.emissiveColor),e.shininess&&(r.shininess=e.shininess),e.specularColor&&r.specular.copy(e.specularColor),e.transparency&&(r.opacity=1-e.transparency),e.transparency>0&&(r.transparent=!0)}else r=new a.MeshBasicMaterial({color:0});break;case"texture":const e=l[0];null!==e&&("ImageTexture"!==e.name&&"PixelTexture"!==e.name||(r.map=i(e)));break;case"textureTransform":null!==l[0]&&(t=i(l[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}if(r.map){if(r.map.__type){switch(r.map.__type){case Ws.INTENSITY_ALPHA:r.opacity=1;break;case Ws.RGB:r.color.set(16777215);break;case Ws.RGBA:r.color.set(16777215),r.opacity=1}delete r.map.__type}t&&(r.map.center.copy(t.center),r.map.rotation=t.rotation,r.map.repeat.copy(t.scale),r.map.offset.copy(t.translation))}return r}(e);break;case"Material":r=function(e){const t={},r=e.fields;for(let n=0,i=r.length;n<i;n++){const e=r[n],i=e.name,o=e.values;switch(i){case"ambientIntensity":break;case"diffuseColor":t.diffuseColor=new a.Color(o[0],o[1],o[2]);break;case"emissiveColor":t.emissiveColor=new a.Color(o[0],o[1],o[2]);break;case"shininess":t.shininess=o[0];break;case"specularColor":t.emissiveColor=new a.Color(o[0],o[1],o[2]);break;case"transparency":t.transparency=o[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return t}(e);break;case"ImageTexture":r=function(e){let t,r=a.RepeatWrapping,n=a.RepeatWrapping;const i=e.fields;for(let o=0,s=i.length;o<s;o++){const e=i[o],s=e.name,l=e.values;switch(s){case"url":const e=l[0];e&&(t=_.load(e));break;case"repeatS":!1===l[0]&&(r=a.ClampToEdgeWrapping);break;case"repeatT":!1===l[0]&&(n=a.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}t&&(t.wrapS=r,t.wrapT=n);return t}(e);break;case"PixelTexture":r=function(e){let t,r=a.RepeatWrapping,n=a.RepeatWrapping;const i=e.fields;for(let l=0,c=i.length;l<c;l++){const e=i[l],c=e.name,u=e.values;switch(c){case"image":const e=u[0],i=u[1],l=s(u[2]),h=new Uint8Array(4*e*i),d={r:0,g:0,b:0,a:0};for(let t=3,r=0,n=u.length;t<n;t++,r++){o(u[t],l,d);const e=4*r;h[e+0]=d.r,h[e+1]=d.g,h[e+2]=d.b,h[e+3]=d.a}t=new a.DataTexture(h,e,i),t.needsUpdate=!0,t.__type=l;break;case"repeatS":!1===u[0]&&(r=a.ClampToEdgeWrapping);break;case"repeatT":!1===u[0]&&(n=a.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}t&&(t.wrapS=r,t.wrapT=n);return t}(e);break;case"TextureTransform":r=function(e){const t={center:new a.Vector2,rotation:new a.Vector2,scale:new a.Vector2,translation:new a.Vector2},r=e.fields;for(let n=0,i=r.length;n<i;n++){const e=r[n],i=e.name,o=e.values;switch(i){case"center":t.center.set(o[0],o[1]);break;case"rotation":t.rotation=o[0];break;case"scale":t.scale.set(o[0],o[1]);break;case"translation":t.translation.set(o[0],o[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return t}(e);break;case"IndexedFaceSet":r=function(e){let t,r,n,o,s,l,d,f,p=!0,m=!0,g=0,A=!0,v=!0;const y=e.fields;for(let a=0,c=y.length;a<c;a++){const e=y[a],c=e.name,u=e.values;switch(c){case"color":const e=u[0];null!==e&&(t=i(e));break;case"coord":const a=u[0];null!==a&&(r=i(a));break;case"normal":const h=u[0];null!==h&&(n=i(h));break;case"texCoord":const y=u[0];null!==y&&(o=i(y));break;case"ccw":p=u[0];break;case"colorIndex":s=u;break;case"colorPerVertex":A=u[0];break;case"convex":break;case"coordIndex":l=u;break;case"creaseAngle":g=u[0];break;case"normalIndex":d=u;break;case"normalPerVertex":v=u[0];break;case"solid":m=u[0];break;case"texCoordIndex":f=u;break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}if(void 0===l)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new a.BufferGeometry;const w=c(l,p);let E,S,M;if(t)if(!0===A)if(s&&s.length>0){E=x(w,c(s,p),t,3)}else E=C(w,new a.Float32BufferAttribute(t,3));else if(s&&s.length>0){E=b(w,u(h(t,s),l))}else{E=b(w,u(t,l))}if(n)if(!0===v)if(d&&d.length>0){S=x(w,c(d,p),n,3)}else S=C(w,new a.Float32BufferAttribute(n,3));else if(d&&d.length>0){S=b(w,u(h(n,d),l))}else{S=b(w,u(n,l))}else S=T(w,r,g);if(o)if(f&&f.length>0){M=x(w,c(f,p),o,2)}else M=C(w,new a.Float32BufferAttribute(o,2));const I=new a.BufferGeometry,B=C(w,new a.Float32BufferAttribute(r,3));I.setAttribute("position",B),I.setAttribute("normal",S),E&&I.setAttribute("color",E);M&&I.setAttribute("uv",M);return I._solid=m,I._type="mesh",I}(e);break;case"IndexedLineSet":r=function(e){let t,r,n,o,s=!0;const l=e.fields;for(let a=0,h=l.length;a<h;a++){const e=l[a],c=e.name,u=e.values;switch(c){case"color":const e=u[0];null!==e&&(t=i(e));break;case"coord":const a=u[0];null!==a&&(r=i(a));break;case"colorIndex":n=u;break;case"colorPerVertex":s=u[0];break;case"coordIndex":o=u;break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}let c;const u=d(o);if(t)if(!0===s)if(n.length>0){c=x(u,d(n),t,3)}else c=C(u,new a.Float32BufferAttribute(t,3));else if(n.length>0){c=w(u,f(h(t,n),o))}else{c=w(u,f(t,o))}const p=new a.BufferGeometry,m=C(u,new a.Float32BufferAttribute(r,3));p.setAttribute("position",m),c&&p.setAttribute("color",c);return p._type="line",p}(e);break;case"PointSet":r=function(e){let t,r;const n=e.fields;for(let a=0,s=n.length;a<s;a++){const e=n[a],o=e.name,s=e.values;switch(o){case"color":const e=s[0];null!==e&&(t=i(e));break;case"coord":const n=s[0];null!==n&&(r=i(n));break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}const o=new a.BufferGeometry;o.setAttribute("position",new a.Float32BufferAttribute(r,3)),t&&o.setAttribute("color",new a.Float32BufferAttribute(t,3));return o._type="points",o}(e);break;case"Box":r=function(e){const t=new a.Vector3(2,2,2),r=e.fields;for(let n=0,i=r.length;n<i;n++){const e=r[n],i=e.name,o=e.values;switch(i){case"size":t.x=o[0],t.y=o[1],t.z=o[2];break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return new a.BoxGeometry(t.x,t.y,t.z)}(e);break;case"Cone":r=function(e){let t=1,r=2,n=!1;const i=e.fields;for(let o=0,a=i.length;o<a;o++){const e=i[o],a=e.name,s=e.values;switch(a){case"bottom":n=!s[0];break;case"bottomRadius":t=s[0];break;case"height":r=s[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",a)}}return new a.ConeGeometry(t,r,16,1,n)}(e);break;case"Cylinder":r=function(e){let t=1,r=2;const n=e.fields;for(let i=0,o=n.length;i<o;i++){const e=n[i],o=e.name,a=e.values;switch(o){case"bottom":break;case"radius":t=a[0];break;case"height":r=a[0];break;case"side":case"top":break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return new a.CylinderGeometry(t,t,r,16,1)}(e);break;case"Sphere":r=function(e){let t=1;const r=e.fields;for(let n=0,i=r.length;n<i;n++){const e=r[n],i=e.name,o=e.values;switch(i){case"radius":t=o[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return new a.SphereGeometry(t,16,16)}(e);break;case"ElevationGrid":r=function(e){let t,r,n,o,s=!0,l=!0,c=!0,u=!0,h=0,d=2,f=2,p=1,m=1;const g=e.fields;for(let a=0,C=g.length;a<C;a++){const e=g[a],A=e.name,v=e.values;switch(A){case"color":const e=v[0];null!==e&&(t=i(e));break;case"normal":const a=v[0];null!==a&&(r=i(a));break;case"texCoord":const g=v[0];null!==g&&(n=i(g));break;case"height":o=v;break;case"ccw":u=v[0];break;case"colorPerVertex":s=v[0];break;case"creaseAngle":h=v[0];break;case"normalPerVertex":l=v[0];break;case"solid":c=v[0];break;case"xDimension":d=v[0];break;case"xSpacing":p=v[0];break;case"zDimension":f=v[0];break;case"zSpacing":m=v[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",A)}}const A=[],v=[],y=[],x=[];for(let i=0;i<f;i++)for(let e=0;e<d;e++){const a=i*d+e,c=p*i,u=o[a],h=m*e;if(A.push(c,u,h),t&&!0===s){const e=t[3*a+0],r=t[3*a+1],n=t[3*a+2];y.push(e,r,n)}if(r&&!0===l){const e=r[3*a+0],t=r[3*a+1],n=r[3*a+2];v.push(e,t,n)}if(n){const e=n[2*a+0],t=n[2*a+1];x.push(e,t)}else x.push(i/(d-1),e/(f-1))}const b=[];for(let i=0;i<d-1;i++)for(let e=0;e<f-1;e++){const t=i+e*d,r=i+(e+1)*d,n=i+1+(e+1)*d,o=i+1+e*d;!0===u?(b.push(t,n,r),b.push(n,t,o)):(b.push(t,r,n),b.push(n,o,t))}const w=C(b,new a.Float32BufferAttribute(A,3)),E=C(b,new a.Float32BufferAttribute(x,2));let S,M;if(t)if(!1===s){for(let e=0;e<d-1;e++)for(let r=0;r<f-1;r++){const n=e+r*(d-1),i=t[3*n+0],o=t[3*n+1],a=t[3*n+2];y.push(i,o,a),y.push(i,o,a),y.push(i,o,a),y.push(i,o,a),y.push(i,o,a),y.push(i,o,a)}S=new a.Float32BufferAttribute(y,3)}else S=C(b,new a.Float32BufferAttribute(y,3));if(r)if(!1===l){for(let e=0;e<d-1;e++)for(let t=0;t<f-1;t++){const n=e+t*(d-1),i=r[3*n+0],o=r[3*n+1],a=r[3*n+2];v.push(i,o,a),v.push(i,o,a),v.push(i,o,a),v.push(i,o,a),v.push(i,o,a),v.push(i,o,a)}M=new a.Float32BufferAttribute(v,3)}else M=C(b,new a.Float32BufferAttribute(v,3));else M=T(b,A,h);const I=new a.BufferGeometry;I.setAttribute("position",w),I.setAttribute("normal",M),I.setAttribute("uv",E),S&&I.setAttribute("color",S);return I._solid=c,I._type="mesh",I}(e);break;case"Extrusion":r=function(e){let t,r,n=[1,1,1,-1,-1,-1,-1,1,1,1],i=[0,0,0,0,1,0],o=!0,s=!0,l=0,c=!0,u=!0;const h=e.fields;for(let a=0,C=h.length;a<C;a++){const e=h[a],d=e.name,f=e.values;switch(d){case"beginCap":o=f[0];break;case"ccw":s=f[0];break;case"convex":break;case"creaseAngle":l=f[0];break;case"crossSection":n=f;break;case"endCap":c=f[0];break;case"orientation":r=f;break;case"scale":t=f;break;case"solid":u=f[0];break;case"spine":i=f;break;default:console.warn("THREE.VRMLLoader: Unknown field:",d)}}const d=n[0]===n[n.length-2]&&n[1]===n[n.length-1],f=[],p=new a.Vector3,m=new a.Vector3,g=new a.Vector3,A=new a.Vector3,v=new a.Quaternion;for(let a=0,C=0,T=0,M=i.length;a<M;a+=3,C+=2,T+=4){p.fromArray(i,a),m.x=t?t[C+0]:1,m.y=1,m.z=t?t[C+1]:1,g.x=r?r[T+0]:0,g.y=r?r[T+1]:0,g.z=r?r[T+2]:1;const e=r?r[T+3]:0;for(let t=0,r=n.length;t<r;t+=2)A.x=n[t+0],A.y=0,A.z=n[t+1],A.multiply(m),v.setFromAxisAngle(g,e),A.applyQuaternion(v),A.add(p),f.push(A.x,A.y,A.z)}const y=[],x=i.length/3,b=n.length/2;for(let a=0;a<x-1;a++)for(let e=0;e<b-1;e++){const t=e+a*b;let r=e+1+a*b;const n=e+(a+1)*b;let i=e+1+(a+1)*b;e===b-2&&!0===d&&(r=a*b,i=(a+1)*b),!0===s?(y.push(t,r,n),y.push(n,r,i)):(y.push(t,n,r),y.push(n,i,r))}if(!0===o||!0===c){const e=[];for(let i=0,o=n.length;i<o;i+=2)e.push(new a.Vector2(n[i],n[i+1]));const t=a.ShapeUtils.triangulateShape(e,[]),r=[];for(let n=0,i=t.length;n<i;n++){const e=t[n];r.push(e[0],e[1],e[2])}if(!0===o)for(let n=0,i=r.length;n<i;n+=3)!0===s?y.push(r[n+0],r[n+1],r[n+2]):y.push(r[n+0],r[n+2],r[n+1]);if(!0===c){const e=b*(x-1);for(let t=0,n=r.length;t<n;t+=3)!0===s?y.push(e+r[t+0],e+r[t+2],e+r[t+1]):y.push(e+r[t+0],e+r[t+1],e+r[t+2])}}const w=C(y,new a.Float32BufferAttribute(f,3)),E=T(y,f,l),S=new a.BufferGeometry;return S.setAttribute("position",w),S.setAttribute("normal",E),S._solid=u,S._type="mesh",S}(e);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":r=function(e){return e.fields[0].values}(e);break;case"WorldInfo":r=function(e){const t={},r=e.fields;for(let n=0,i=r.length;n<i;n++){const e=r[n],i=e.name,o=e.values;switch(i){case"title":t.title=o[0];break;case"info":t.info=o;break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return t}(e);break;case"Anchor":case"Billboard":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"Text":case"FontStyle":case"MovieTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",t)}void 0!==r&&void 0!==e.DEF&&!0===r.hasOwnProperty("name")&&(r.name=e.DEF);return r}(e)),e.build)}function o(e,t,r){let n;switch(t){case Ws.INTENSITY:n=parseInt(e),r.r=n,r.g=n,r.b=n,r.a=1;break;case Ws.INTENSITY_ALPHA:n=parseInt("0x"+e.substring(2,4)),r.r=n,r.g=n,r.b=n,r.a=parseInt("0x"+e.substring(4,6));break;case Ws.RGB:r.r=parseInt("0x"+e.substring(2,4)),r.g=parseInt("0x"+e.substring(4,6)),r.b=parseInt("0x"+e.substring(6,8)),r.a=1;break;case Ws.RGBA:r.r=parseInt("0x"+e.substring(2,4)),r.g=parseInt("0x"+e.substring(4,6)),r.b=parseInt("0x"+e.substring(6,8)),r.a=parseInt("0x"+e.substring(8,10))}}function s(e){let t;switch(e){case 1:t=Ws.INTENSITY;break;case 2:t=Ws.INTENSITY_ALPHA;break;case 3:t=Ws.RGB;break;case 4:t=Ws.RGBA}return t}function l(e,t){for(let r=0,n=e.length;r<n;r++){const n=i(e[r]);n instanceof a.Object3D&&t.add(n)}}function c(e,t){const r=[];let n=0;for(let i=0,o=e.length;i<o;i++){const a=e[n],s=e[i+(t?1:2)],l=e[i+(t?2:1)];r.push(a,s,l),(-1===e[i+3]||i+3>=o)&&(i+=3,n=i+1)}return r}function u(e,t){const r=[];let n=0;for(let i=0,o=t.length;i<o;i++){const a=3*n,s=e[a],l=e[a+1],c=e[a+2];r.push(s,l,c),(-1===t[i+3]||i+3>=o)&&(i+=3,n++)}return r}function h(e,t){const r=[];for(let n=0,i=t.length;n<i;n++){const i=3*t[n],o=e[i],a=e[i+1],s=e[i+2];r.push(o,a,s)}return r}function d(e){const t=[];for(let r=0,n=e.length;r<n;r++){const i=e[r],o=e[r+1];t.push(i,o),(-1===e[r+2]||r+2>=n)&&(r+=2)}return t}function f(e,t){const r=[];let n=0;for(let i=0,o=t.length;i<o;i++){const a=3*n,s=e[a],l=e[a+1],c=e[a+2];r.push(s,l,c),(-1===t[i+2]||i+2>=o)&&(i+=2,n++)}return r}const p=new a.Vector3,m=new a.Vector3,g=new a.Vector3,A=new a.Vector2,v=new a.Vector2,y=new a.Vector2;function x(e,t,r,n){const i=[];for(let o=0,a=e.length;o<a;o+=3){const e=t[o],a=t[o+1],s=t[o+2];2===n?(A.fromArray(r,e*n),v.fromArray(r,a*n),y.fromArray(r,s*n),i.push(A.x,A.y),i.push(v.x,v.y),i.push(y.x,y.y)):(p.fromArray(r,e*n),m.fromArray(r,a*n),g.fromArray(r,s*n),i.push(p.x,p.y,p.z),i.push(m.x,m.y,m.z),i.push(g.x,g.y,g.z))}return new a.Float32BufferAttribute(i,n)}function b(e,t){const r=[];for(let n=0,i=0,o=e.length;n<o;n+=3,i++)p.fromArray(t,3*i),r.push(p.x,p.y,p.z),r.push(p.x,p.y,p.z),r.push(p.x,p.y,p.z);return new a.Float32BufferAttribute(r,3)}function w(e,t){const r=[];for(let n=0,i=0,o=e.length;n<o;n+=2,i++)p.fromArray(t,3*i),r.push(p.x,p.y,p.z),r.push(p.x,p.y,p.z);return new a.Float32BufferAttribute(r,3)}function C(e,t){const r=t.array,n=t.itemSize,i=new r.constructor(e.length*n);let o=0,s=0;for(let a=0,l=e.length;a<l;a++){o=e[a]*n;for(let e=0;e<n;e++)i[s++]=r[o++]}return new a.Float32BufferAttribute(i,n)}const E=new a.Vector3,S=new a.Vector3;function T(e,t,r){const n=[],i={};for(let a=0,s=e.length;a<s;a+=3){const r=e[a],o=e[a+1],s=e[a+2],l=new Hs(r,o,s);p.fromArray(t,3*r),m.fromArray(t,3*o),g.fromArray(t,3*s),S.subVectors(g,m),E.subVectors(p,m),S.cross(E),S.normalize(),l.normal.copy(S),void 0===i[r]&&(i[r]=[]),void 0===i[o]&&(i[o]=[]),void 0===i[s]&&(i[s]=[]),i[r].push(l.normal),i[o].push(l.normal),i[s].push(l.normal),n.push(l)}const o=[];for(let a=0,s=n.length;a<s;a++){const e=n[a],s=M(i[e.a],e.normal,r),l=M(i[e.b],e.normal,r),c=M(i[e.c],e.normal,r);p.fromArray(t,3*e.a),m.fromArray(t,3*e.b),g.fromArray(t,3*e.c),o.push(s.x,s.y,s.z),o.push(l.x,l.y,l.z),o.push(c.x,c.y,c.z)}return new a.Float32BufferAttribute(o,3)}function M(e,t,r){const n=new a.Vector3;if(0===r)n.copy(t);else for(let i=0,o=e.length;i<o;i++)e[i].angleTo(t)<r&&n.add(e[i]);return n.normalize()}function I(e){const t=[];for(let r=0,n=e.length;r<n;r+=3)t.push(new a.Color(e[r],e[r+1],e[r+2]));return t}function B(e,t,r,n,i){const o=[],s=!0===i?0:Math.PI;for(let f=0,p=n.length;f<p;f++){let e=0===f?0:r[f-1];e=!0===i?e:s-e;const n=new a.Vector3;n.setFromSphericalCoords(t,e,0),o.push(n)}const l=e.index,c=e.attributes.position,u=new a.BufferAttribute(new Float32Array(3*e.attributes.position.count),3),h=new a.Vector3,d=new a.Color;for(let a=0;a<l.count;a++){const e=l.getX(a);let t,r;h.fromBufferAttribute(c,e);let s=1;for(let n=1;n<o.length;n++){t=n-1,r=n;const e=o[t],a=o[r];if(!0===i){if(h.y<=e.y&&h.y>a.y){s=Math.abs(e.y-h.y)/Math.abs(e.y-a.y);break}}else if(h.y>=e.y&&h.y<a.y){s=Math.abs(e.y-h.y)/Math.abs(e.y-a.y);break}}const f=n[t],p=n[r];d.copy(f).lerp(p,s),u.setXYZ(e,d.r,d.g,d.b)}e.setAttribute("color",u)}const _=new a.TextureLoader(this.manager);if(_.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),-1===e.indexOf("#VRML V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");return function(e){const t=e.nodes,r=new a.Scene;for(let i=0,o=t.length;i<o;i++){n(t[i])}for(let n=0,o=t.length;n<o;n++){const e=t[n],o=i(e);o instanceof a.Object3D&&r.add(o),"WorldInfo"===e.name&&(r.userData.worldInfo=o)}return r}(function(e){const t=function(){const e=Vs({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),t=Vs({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:e}),r=["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"],n=Vs({name:"Version",pattern:/#VRML.*/,longer_alt:t}),i=Vs({name:"NodeName",pattern:new RegExp(r.join("|")),longer_alt:t}),o=Vs({name:"DEF",pattern:/DEF/,longer_alt:t}),a=Vs({name:"USE",pattern:/USE/,longer_alt:t}),s=Vs({name:"ROUTE",pattern:/ROUTE/,longer_alt:t}),l=Vs({name:"TO",pattern:/TO/,longer_alt:t}),c=Vs({name:"StringLiteral",pattern:/"(?:[^\\"\n\r]|\\[bfnrtv"\\/]|\\u[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F])*"/}),u=Vs({name:"HexLiteral",pattern:/0[xX][0-9a-fA-F]+/}),h=Vs({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),d=Vs({name:"TrueLiteral",pattern:/TRUE/}),f=Vs({name:"FalseLiteral",pattern:/FALSE/}),p=Vs({name:"NullLiteral",pattern:/NULL/}),m=Vs({name:"LSquare",pattern:/\[/}),g=Vs({name:"RSquare",pattern:/]/}),A=Vs({name:"LCurly",pattern:/{/}),v=Vs({name:"RCurly",pattern:/}/}),y=Vs({name:"Comment",pattern:/#.*/,group:Qs.SKIPPED}),x=[Vs({name:"WhiteSpace",pattern:/[ ,\s]/,group:Qs.SKIPPED}),i,o,a,s,l,d,f,p,n,t,e,c,u,h,m,g,A,v,y],b={};for(let w=0,C=x.length;w<C;w++){const e=x[w];b[e.name]=e}return{tokens:x,tokenVocabulary:b}}(),r=new zs(t.tokens),n=new js(t.tokenVocabulary),i=function(e){function t(){e.call(this),this.validateVisitor()}function r(e,t){const r={type:null,values:[]};if(t.node){r.type="node";for(let n=0,i=t.node.length;n<i;n++){const i=t.node[n];r.values.push(e.visit(i))}}if(t.use){r.type="use";for(let n=0,i=t.use.length;n<i;n++){const i=t.use[n];r.values.push(e.visit(i))}}if(t.StringLiteral){r.type="string";for(let e=0,n=t.StringLiteral.length;e<n;e++){const n=t.StringLiteral[e];r.values.push(n.image.replace(/'|"/g,""))}}if(t.NumberLiteral){r.type="number";for(let e=0,n=t.NumberLiteral.length;e<n;e++){const n=t.NumberLiteral[e];r.values.push(parseFloat(n.image))}}if(t.HexLiteral){r.type="hex";for(let e=0,n=t.HexLiteral.length;e<n;e++){const n=t.HexLiteral[e];r.values.push(n.image)}}if(t.TrueLiteral){r.type="boolean";for(let e=0,n=t.TrueLiteral.length;e<n;e++){"TRUE"===t.TrueLiteral[e].image&&r.values.push(!0)}}if(t.FalseLiteral){r.type="boolean";for(let e=0,n=t.FalseLiteral.length;e<n;e++){"FALSE"===t.FalseLiteral[e].image&&r.values.push(!1)}}return t.NullLiteral&&(r.type="null",t.NullLiteral.forEach((function(){r.values.push(null)}))),r}return t.prototype=Object.assign(Object.create(e.prototype),{constructor:t,vrml:function(e){const t={version:this.visit(e.version),nodes:[],routes:[]};for(let r=0,n=e.node.length;r<n;r++){const n=e.node[r];t.nodes.push(this.visit(n))}if(e.route)for(let r=0,n=e.route.length;r<n;r++){const n=e.route[r];t.routes.push(this.visit(n))}return t},version:function(e){return e.Version[0].image},node:function(e){const t={name:e.NodeName[0].image,fields:[]};if(e.field)for(let r=0,n=e.field.length;r<n;r++){const n=e.field[r];t.fields.push(this.visit(n))}return e.def&&(t.DEF=this.visit(e.def[0])),t},field:function(e){const t={name:e.Identifier[0].image,type:null,values:null};let r;return e.singleFieldValue&&(r=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(r=this.visit(e.multiFieldValue[0])),t.type=r.type,t.values=r.values,t},def:function(e){return(e.Identifier||e.NodeName)[0].image},use:function(e){return{USE:(e.Identifier||e.NodeName)[0].image}},singleFieldValue:function(e){return r(this,e)},multiFieldValue:function(e){return r(this,e)},route:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}),new t}(n.getBaseCstVisitorConstructor()),o=r.lex(e);n.input=o.tokens;const a=n.vrml();if(n.errors.length>0)throw console.error(n.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return i.visit(a)}(e))}}class zs{constructor(e){this.lexer=new Qs(e)}lex(e){const t=this.lexer.tokenize(e);if(t.errors.length>0)throw console.error(t.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return t}}class js extends Us{constructor(e){super(e);const t=this,r=e.Version,n=e.LCurly,i=e.RCurly,o=e.LSquare,a=e.RSquare,s=e.Identifier,l=e.RouteIdentifier,c=e.StringLiteral,u=e.HexLiteral,h=e.NumberLiteral,d=e.TrueLiteral,f=e.FalseLiteral,p=e.NullLiteral,m=e.DEF,g=e.USE,A=e.ROUTE,v=e.TO,y=e.NodeName;t.RULE("vrml",(function(){t.SUBRULE(t.version),t.AT_LEAST_ONE((function(){t.SUBRULE(t.node)})),t.MANY((function(){t.SUBRULE(t.route)}))})),t.RULE("version",(function(){t.CONSUME(r)})),t.RULE("node",(function(){t.OPTION((function(){t.SUBRULE(t.def)})),t.CONSUME(y),t.CONSUME(n),t.MANY((function(){t.SUBRULE(t.field)})),t.CONSUME(i)})),t.RULE("field",(function(){t.CONSUME(s),t.OR2([{ALT:function(){t.SUBRULE(t.singleFieldValue)}},{ALT:function(){t.SUBRULE(t.multiFieldValue)}}])})),t.RULE("def",(function(){t.CONSUME(m),t.OR([{ALT:function(){t.CONSUME(s)}},{ALT:function(){t.CONSUME(y)}}])})),t.RULE("use",(function(){t.CONSUME(g),t.OR([{ALT:function(){t.CONSUME(s)}},{ALT:function(){t.CONSUME(y)}}])})),t.RULE("singleFieldValue",(function(){t.AT_LEAST_ONE((function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(c)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(d)}},{ALT:function(){t.CONSUME(f)}},{ALT:function(){t.CONSUME(p)}}])}))})),t.RULE("multiFieldValue",(function(){t.CONSUME(o),t.MANY((function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(c)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(p)}}])})),t.CONSUME(a)})),t.RULE("route",(function(){t.CONSUME(A),t.CONSUME(l),t.CONSUME(v),t.CONSUME2(l)})),this.performSelfAnalysis()}}class Hs{constructor(e,t,r){this.a=e,this.b=t,this.c=r,this.normal=new a.Vector3}}const Ws={INTENSITY:1,INTENSITY_ALPHA:2,RGB:3,RGBA:4};var Zs=r(3994);class Xs extends a.Loader{setQuality(e){this._quality=e}load(e,t,r,n){const i=this._quality||1,o=new a.CanvasTexture;o.minFilter=a.NearestFilter;const s=new a.FileLoader(this.manager);return s.setPath(this.path),s.setWithCredentials(this.withCredentials),s.load(e,(function(e){const r=JSON.parse(e),n=document.createElement("div");n.style.width=r.w+"px",n.style.height=r.h+"px",document.body.appendChild(n);const a=bodymovin.loadAnimation({container:n,animType:"canvas",loop:!0,autoplay:!0,animationData:r,rendererSettings:{dpr:i}});o.animation=a,o.image=a.container,a.addEventListener("enterFrame",(function(){o.needsUpdate=!0})),n.style.display="none",void 0!==t&&t(o)}),r,n),o}}var Ys=r(8266);class Js extends a.Loader{constructor(e){super(e),this.reversed=!1}load(e,t,r,n){const i=this,o=new a.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){try{t((0,Ys.Qc)(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){function t(e){const t=[];let r;e.forEach((function(e){"m"===e.type.toLowerCase()?(r=[e],t.push(r)):"z"!==e.type.toLowerCase()&&r.push(e)}));const n=[];return t.forEach((function(e){const t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};n.push(t);for(let r=e.length-1;r>0;r--){const t=e[r],i={type:t.type};void 0!==t.x2&&void 0!==t.y2?(i.x1=t.x2,i.y1=t.y2,i.x2=t.x1,i.y2=t.y1):void 0!==t.x1&&void 0!==t.y1&&(i.x1=t.x1,i.y1=t.y1),i.x=e[r-1].x,i.y=e[r-1].y,n.push(i)}})),n}return function(e,r){const n=Math.round,i={},o=1e5/(72*(e.unitsPerEm||2048)),a=e.encoding.cmap.glyphIndexMap,s=Object.keys(a);for(let l=0;l<s.length;l++){const c=s[l],u=e.glyphs.glyphs[a[c]];if(void 0!==c){const e={ha:n(u.advanceWidth*o),x_min:n(u.xMin*o),x_max:n(u.xMax*o),o:""};r&&(u.path.commands=t(u.path.commands)),u.path.commands.forEach((function(t){"c"===t.type.toLowerCase()&&(t.type="b"),e.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(e.o+=n(t.x*o)+" "+n(t.y*o)+" "),void 0!==t.x1&&void 0!==t.y1&&(e.o+=n(t.x1*o)+" "+n(t.y1*o)+" "),void 0!==t.x2&&void 0!==t.y2&&(e.o+=n(t.x2*o)+" "+n(t.y2*o)+" ")})),i[String.fromCodePoint(u.unicode)]=e}}return{glyphs:i,familyName:e.getEnglishName("fullName"),ascender:n(e.ascender*o),descender:n(e.descender*o),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}((0,Ys.Qc)(e),this.reversed)}}var qs=r(5990),Ks=function(e){a.Loader.call(this,e)};Ks.prototype=Object.assign(Object.create(a.Loader.prototype),{constructor:Ks,load:function(e,t,r,n){var i=this,o=""===i.path?a.LoaderUtils.extractUrlBase(e):i.path,s=new a.FileLoader(i.manager);s.setPath(i.path),s.setResponseType("arraybuffer"),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,(function(r){try{t(i.parse(r,o))}catch(a){n?n(a):console.error(a),i.manager.itemError(e)}}),r,n)},parse:function(e,t){var r=new a.TextureLoader(this.manager);r.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);var n={KeyFrame:function(e,t){this.time=e,this.matrix=t.clone(),this.position=new a.Vector3,this.quaternion=new a.Quaternion,this.scale=new a.Vector3(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new n.KeyFrame(this.time,this.matrix)},this.lerp=function(e,t){var r=(t-=this.time)/(e.time-this.time),i=1-r,o=this.position,a=this.quaternion,s=e.position,l=e.quaternion;return n.KeyFrame.tempAniPos.x=o.x*i+s.x*r,n.KeyFrame.tempAniPos.y=o.y*i+s.y*r,n.KeyFrame.tempAniPos.z=o.z*i+s.z*r,n.KeyFrame.tempAniQuat.set(a.x,a.y,a.z,a.w),n.KeyFrame.tempAniQuat.slerp(l,r),n.KeyFrame.tempAniMatrix.compose(n.KeyFrame.tempAniPos,n.KeyFrame.tempAniQuat,n.KeyFrame.tempAniScale)}}};n.KeyFrame.tempAniPos=new a.Vector3,n.KeyFrame.tempAniQuat=new a.Quaternion,n.KeyFrame.tempAniScale=new a.Vector3(1,1,1),n.KeyFrame.tempAniMatrix=new a.Matrix4,n.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(e){this.keys.push(e)},this.init=function(){if(this.sortKeys(),this.keys.length>0?this.length=this.keys[this.keys.length-1].time:this.length=0,this.fps)for(let e=0;e<this.length*this.fps;e++)for(let t=0;t<this.keys.length;t++){if(this.keys[t].time==e){this._accelTable[e]=t;break}if(this.keys[t].time<e/this.fps&&this.keys[t+1]&&this.keys[t+1].time>=e/this.fps){this._accelTable[e]=t;break}}},this.parseFromThree=function(e){var t=e.fps;this.target=e.node;var r=e.hierarchy[0].keys;for(let i=0;i<r.length;i++)this.addKey(new n.KeyFrame(i/t||r[i].time,r[i].targets[0].data));this.init()},this.parseFromCollada=function(e){var t=e.keys,r=this.fps;for(let i=0;i<t.length;i++)this.addKey(new n.KeyFrame(i/r||t[i].time,t[i].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(e,t){return e.time-t.time},this.clone=function(){var e=new n.KeyFrameTrack;e.target=this.target,e.time=this.time,e.length=this.length;for(let t=0;t<this.keys.length;t++)e.addKey(this.keys[t].clone());return e.init(),e},this.reTarget=function(e,t){t||(t=n.TrackTargetNodeNameCompare),this.target=t(e,this.target)},this.keySearchAccel=function(e){return e*=this.fps,e=Math.floor(e),this._accelTable[e]||0},this.setTime=function(e){e=Math.abs(e),this.length&&(e=e%this.length+.05);var t=null,r=null;for(let n=this.keySearchAccel(e);n<this.keys.length;n++){if(this.keys[n].time==e){t=this.keys[n],r=this.keys[n];break}if(this.keys[n].time<e&&this.keys[n+1]&&this.keys[n+1].time>e){t=this.keys[n],r=this.keys[n+1];break}if(this.keys[n].time<e&&n==this.keys.length-1){t=this.keys[n],(r=this.keys[0].clone()).time+=this.length+.05;break}}return t&&r&&t!==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.lerp(r,e)),void(this.target.matrixWorldNeedsUpdate=!0)):t&&r&&t==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.matrix),void(this.target.matrixWorldNeedsUpdate=!0)):void 0}},n.TrackTargetNodeNameCompare=function(e,t){return function e(t,r){if(t.name==r)return t;for(let i=0;i<t.children.length;i++){var n=e(t.children[i],r);if(n)return n}return null}(e,t.name)},n.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(e){this.tracks.push(e),this.length=Math.max(e.length,this.length)},this.setTime=function(e){this.time=e;for(let t=0;t<this.tracks.length;t++)this.tracks[t].setTime(e)},this.clone=function(e,t){t||(t=n.TrackTargetNodeNameCompare);var r=new n.Animation;r.target=e;for(let n=0;n<this.tracks.length;n++){var i=this.tracks[n].clone();i.reTarget(e,t),r.addTrack(i)}return r}};function i(e){return 256<<e}function o(e){return 65536<<e}function s(e,t){var r=new a.Bone;r.matrix.copy(e.matrix),r.matrixWorld.copy(e.matrixWorld),r.position.copy(e.position),r.quaternion.copy(e.quaternion),r.scale.copy(e.scale),t.nodeCount++,r.name="bone_"+e.name+t.nodeCount.toString(),t.nodeToBoneMap[e.name]||(t.nodeToBoneMap[e.name]=[]),t.nodeToBoneMap[e.name].push(r);for(let i in e.children){var n=s(e.children[i],t);r.add(n)}return r}function l(e,t){var r=[];for(let i=0;i<e.length;i++)r.push({i:e[i],w:t[i]});for(r.sort((function(e,t){return t.w-e.w}));r.length<4;)r.push({i:0,w:0});r.length>4&&(r.length=4);var n=0;for(let i=0;i<4;i++)n+=r[i].w*r[i].w;n=Math.sqrt(n);for(let i=0;i<4;i++)r[i].w=r[i].w/n,e[i]=r[i].i,t[i]=r[i].w}function c(e,t){if(0==e.name.indexOf("bone_"+t))return e;for(let n in e.children){var r=c(e.children[n],t);if(r)return r}}function u(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(e){if(0!=this.mBones.length){for(var t=[],r=[],n=e.findNode(this.mBones[0].mName);n.mParent&&n.mParent.isBone;)n=n.mParent;var i=s(n.toTHREE(e),e);this.threeNode.add(i);for(let a=0;a<this.mBones.length;a++){if(l=c(i,this.mBones[a].mName)){var o=l;t.push(o),r.push(this.mBones[a].mOffsetMatrix.toTHREE())}else{if(!(n=e.findNode(this.mBones[a].mName)))return;i=s(n.toTHREE(e),e);this.threeNode.add(i);var l;o=l=c(i,this.mBones[a].mName);t.push(o),r.push(this.mBones[a].mOffsetMatrix.toTHREE())}}var u=new a.Skeleton(t,r);this.threeNode.bind(u,new a.Matrix4),this.threeNode.material.skinning=!0}},this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t,r,n=new a.BufferGeometry;if(t=e.mMaterials[this.mMaterialIndex]?e.mMaterials[this.mMaterialIndex].toTHREE(e):new a.MeshLambertMaterial,n.setIndex(new a.BufferAttribute(new Uint32Array(this.mIndexArray),1)),n.setAttribute("position",new a.BufferAttribute(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&n.setAttribute("normal",new a.BufferAttribute(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&n.setAttribute("color",new a.BufferAttribute(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&n.setAttribute("uv",new a.BufferAttribute(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&n.setAttribute("uv1",new a.BufferAttribute(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&n.setAttribute("tangents",new a.BufferAttribute(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&n.setAttribute("bitangents",new a.BufferAttribute(this.mBitangentBuffer,3)),this.mBones.length>0){var i=[],o=[];for(let e=0;e<this.mBones.length;e++)for(let t=0;t<this.mBones[e].mWeights.length;t++){var s=this.mBones[e].mWeights[t];s&&(i[s.mVertexId]||(i[s.mVertexId]=[]),o[s.mVertexId]||(o[s.mVertexId]=[]),i[s.mVertexId].push(s.mWeight),o[s.mVertexId].push(parseInt(e)))}for(let e in o)l(o[e],i[e]);var c=[],u=[];for(let e=0;e<i.length;e++)for(let t=0;t<4;t++)i[e]&&o[e]?(c.push(i[e][t]),u.push(o[e][t])):(c.push(0),u.push(0));n.setAttribute("skinWeight",new a.BufferAttribute(new Float32Array(c),4)),n.setAttribute("skinIndex",new a.BufferAttribute(new Float32Array(u),4))}return 0==this.mBones.length&&(r=new a.Mesh(n,t)),this.mBones.length>0&&(r=new a.SkinnedMesh(n,t)).normalizeSkinWeights(),this.threeNode=r,r}}function h(){this.mNumIndices=0,this.mIndices=[]}function d(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new a.Vector3(this.x,this.y,this.z)}}function f(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new a.Color(this.r,this.g,this.b)}}function p(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new a.Quaternion(this.x,this.y,this.z,this.w)}}function m(){this.mVertexId=0,this.mWeight=0}function g(){this.data=[],this.toString=function(){var e="";return this.data.forEach((function(t){e+=String.fromCharCode(t)})),e.replace(/[^\x20-\x7E]+/g,"")}}function A(){this.mTime=0,this.mValue=null}function v(){this.mTime=0,this.mValue=null}function y(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t=new a.Object3D;t.name=this.mName,t.matrix=this.mTransformation.toTHREE();for(let r=0;r<this.mChildren.length;r++)t.add(this.mChildren[r].toTHREE(e));for(let r=0;r<this.mMeshes.length;r++)t.add(e.mMeshes[this.mMeshes[r]].toTHREE(e));return this.threeNode=t,t.matrix.decompose(t.position,t.quaternion,t.scale),t}}function x(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}function b(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var e=new Uint8Array(this.mData).buffer,t=new DataView(e),r=t.getFloat32(0,!0),n=t.getFloat32(4,!0),i=t.getFloat32(8,!0);return new a.Color(r,n,i)},this.dataAsFloat=function(){var e=new Uint8Array(this.mData).buffer;return new DataView(e).getFloat32(0,!0)},this.dataAsBool=function(){var e=new Uint8Array(this.mData).buffer;return!!new DataView(e).getFloat32(0,!0)},this.dataAsString=function(){var e=new g;return e.data=this.mData,e.toString()},this.dataAsMap=function(){var e=new g;e.data=this.mData;var t=e.toString();return-1!=(t=t.replace(/\\/g,"/")).indexOf("/")&&(t=t.substr(t.lastIndexOf("/")+1)),r.load(t)}}var w={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},C={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"};function E(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(){var e=new a.MeshPhongMaterial;for(let r=0;r<this.mProperties.length;r++)if("float"==C[this.mProperties[r].mKey]&&(e[w[this.mProperties[r].mKey]]=this.mProperties[r].dataAsFloat()),"color"==C[this.mProperties[r].mKey]&&(e[w[this.mProperties[r].mKey]]=this.mProperties[r].dataAsColor()),"bool"==C[this.mProperties[r].mKey]&&(e[w[this.mProperties[r].mKey]]=this.mProperties[r].dataAsBool()),"string"==C[this.mProperties[r].mKey]&&(e[w[this.mProperties[r].mKey]]=this.mProperties[r].dataAsString()),"map"==C[this.mProperties[r].mKey]){var t=this.mProperties[r];1==t.mSemantic&&(e.map=this.mProperties[r].dataAsMap()),6==t.mSemantic&&(e.normalMap=this.mProperties[r].dataAsMap()),10==t.mSemantic&&(e.lightMap=this.mProperties[r].dataAsMap()),8==t.mSemantic&&(e.alphaMap=this.mProperties[r].dataAsMap())}return e.ambient.r=.53,e.ambient.g=.53,e.ambient.b=.53,e.color.r=1,e.color.g=1,e.color.b=1,e}}function S(e,t,r){var n=new a.Vector3,i=1-r;return n.x=e.x*r+t.x*i,n.y=e.y*r+t.y*i,n.z=e.z*r+t.z*i,n}function T(e,t,r){return e.clone().slerp(t,1-r)}function M(e,t,r,n){if(1==e.length)return e[0].mValue.toTHREE();var i=1/0,o=null,a=null;for(let u=0;u<e.length;u++){var s=Math.abs(e[u].mTime-t);s<i&&e[u].mTime<=t&&(i=s,o=e[u],a=e[u+1])}if(o){if(a){var l=a.mTime-o.mTime,c=(o.mTime-t)/l;return n(o.mValue.toTHREE(),a.mValue.toTHREE(),c)}(a=e[0].clone()).mTime+=r;l=a.mTime-o.mTime,c=(o.mTime-t)/l;return n(o.mValue.toTHREE(),a.mValue.toTHREE(),c)}return null}function I(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(e){function t(t){t.mTime/=e}e||(e=1),this.mPositionKeys.forEach(t),this.mRotationKeys.forEach(t),this.mScalingKeys.forEach(t)},this.sortKeys=function(){function e(e,t){return e.mTime-t.mTime}this.mPositionKeys.sort(e),this.mRotationKeys.sort(e),this.mScalingKeys.sort(e)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map((function(e){return e.mTime}))),Math.max.apply(null,this.mRotationKeys.map((function(e){return e.mTime}))),Math.max.apply(null,this.mScalingKeys.map((function(e){return e.mTime}))))},this.toTHREE=function(e){this.sortKeys();var t=this.getLength(),r=new n.KeyFrameTrack;for(let f=0;f<t;f+=.05){var i=new a.Matrix4,o=f,s=M(this.mPositionKeys,o,t,S),l=M(this.mScalingKeys,o,t,S),c=M(this.mRotationKeys,o,t,T);i.compose(s,c,l);var u=new n.KeyFrame(o,i);r.addKey(u)}r.target=e.findNode(this.mNodeName).toTHREE();var h=[r];if(e.nodeToBoneMap[this.mNodeName])for(let n=0;n<e.nodeToBoneMap[this.mNodeName].length;n++){var d=r.clone();d.target=e.nodeToBoneMap[this.mNodeName][n],h.push(d)}return h}}function B(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(e){var t=new n.Animation;for(let n in this.mChannels){this.mChannels[n].init(this.mTicksPerSecond);var r=this.mChannels[n].toTHREE(e);for(let e in r)r[e].init(),t.addTrack(r[e])}return t.length=Math.max.apply(null,t.tracks.map((function(e){return e.length}))),t}}function _(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}function F(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}function P(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}function R(){this.versionMajor=0,this.versionMinor=0,this.versionRevision=0,this.compileFlags=0,this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(e,t){if(t||(t=this.mRootNode),t.mName==e)return t;for(let n=0;n<t.mChildren.length;n++){var r=this.findNode(e,t.mChildren[n]);if(r)return r}return null},this.toTHREE=function(){this.nodeCount=0,function(e){for(let n in e.mMeshes){var t=e.mMeshes[n];for(let n in t.mBones){var r=e.findNode(t.mBones[n].mName);r&&(r.isBone=!0)}}}(this);var e=this.mRootNode.toTHREE(this);for(let r in this.mMeshes)this.mMeshes[r].hookupSkeletons(this);if(this.mAnimations.length>0)var t=this.mAnimations[0].toTHREE(this);return{object:e,animation:t}}}function L(){this.elements=[[],[],[],[]],this.toTHREE=function(){var e=new a.Matrix4;for(let t=0;t<4;++t)for(let r=0;r<4;++r)e.elements[4*t+r]=this.elements[r][t];return e}}var D=!0;function N(e){var t=e.getFloat32(e.readOffset,D);return e.readOffset+=4,t}function k(e){var t=e.getFloat64(e.readOffset,D);return e.readOffset+=8,t}function O(e){var t=e.getUint8(e.readOffset);return e.readOffset+=1,t}function U(e){var t=e.getUint16(e.readOffset,D);return e.readOffset+=2,t}function Q(e){var t=e.getUint32(e.readOffset,D);return e.readOffset+=4,t}function V(e){var t=e.getUint32(e.readOffset,D);return e.readOffset+=4,t}function G(e){var t=new d;return t.x=N(e),t.y=N(e),t.z=N(e),t}function z(e){var t=new f;return t.r=N(e),t.g=N(e),t.b=N(e),t}function j(e){var t=new g,r=Q(e);return e.ReadBytes(t.data,1,r),t.toString()}function H(e){var t=new m;return t.mVertexId=Q(e),t.mWeight=N(e),t}function W(e){var t=new L;for(let r=0;r<4;++r)for(let n=0;n<4;++n)t.elements[r][n]=N(e);return t}function Z(e){var t=new A;return t.mTime=k(e),t.mValue=G(e),t}function X(e){var t=new v;return t.mTime=k(e),t.mValue=function(e){var t=new p;return t.w=N(e),t.x=N(e),t.y=N(e),t.z=N(e),t}(e),t}function Y(e,t,r){for(let n=0;n<r;n++)t[n]=Z(e)}function J(e,t,r){return e.Seek(sizeof(t)*r,he)}function q(e){if(!e)throw"asset failed"}function K(e,t,r){q(4668==V(e)),V(e);var n=new y;if(n.mParent=t,n.mDepth=r,n.mName=j(e),n.mTransformation=W(e),n.mNumChildren=Q(e),n.mNumMeshes=Q(e),n.mNumMeshes){n.mMeshes=[];for(let t=0;t<n.mNumMeshes;++t)n.mMeshes[t]=Q(e)}if(n.mNumChildren){n.mChildren=[];for(let t=0;t<n.mNumChildren;++t){var i=K(e,n,r++);n.mChildren[t]=i}}return n}function $(e,t){return q(4666==V(e)),V(e),t.mName=j(e),t.mNumWeights=Q(e),t.mOffsetMatrix=W(e),ce?J(e,t.mWeights,t.mNumWeights):(t.mWeights=[],function(e,t,r){for(let n=0;n<r;n++)t[n]=H(e)}(e,t.mWeights,t.mNumWeights)),t}function ee(e,t){q(4663==V(e)),V(e),t.mPrimitiveTypes=Q(e),t.mNumVertices=Q(e),t.mNumFaces=Q(e),t.mNumBones=Q(e),t.mMaterialIndex=Q(e),t.mNumUVComponents=[];var r=Q(e);1&r&&(ce?J(e,t.mVertices,t.mNumVertices):(t.mVertices=[],t.mVertexBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,he))),2&r&&(ce?J(e,t.mNormals,t.mNumVertices):(t.mNormals=[],t.mNormalBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,he))),4&r&&(ce?(J(e,t.mTangents,t.mNumVertices),J(e,t.mBitangents,t.mNumVertices)):(t.mTangents=[],t.mTangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,he),t.mBitangents=[],t.mBitangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,he)));for(let i=0;i<1&&r&o(i);++i)ce?J(e,t.mColors[i],t.mNumVertices):(t.mColors[i]=[],t.mColorBuffer=e.subArray32(e.readOffset,e.readOffset+4*t.mNumVertices*4),e.Seek(4*t.mNumVertices*4,he));t.mTexCoordsBuffers=[];for(let o=0;o<4&&r&i(o);++o)if(t.mNumUVComponents[o]=Q(e),ce)J(e,t.mTextureCoords[o],t.mNumVertices);else{t.mTextureCoords[o]=[],t.mTexCoordsBuffers[o]=[];for(let r=0;r<t.mNumVertices;r++)t.mTexCoordsBuffers[o].push(N(e)),t.mTexCoordsBuffers[o].push(N(e)),N(e)}if(ce)Q(e);else{t.mFaces=[],t.mIndexArray=[];for(let r=0;r<t.mNumFaces;++r){var n=t.mFaces[r]=new h;n.mNumIndices=U(e),n.mIndices=[];for(let r=0;r<n.mNumIndices;++r)t.mNumVertices<65536?n.mIndices[r]=U(e):n.mIndices[r]=Q(e);if(3===n.mNumIndices)t.mIndexArray.push(n.mIndices[0]),t.mIndexArray.push(n.mIndices[1]),t.mIndexArray.push(n.mIndices[2]);else{if(4!==n.mNumIndices)throw new Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.");t.mIndexArray.push(n.mIndices[0]),t.mIndexArray.push(n.mIndices[1]),t.mIndexArray.push(n.mIndices[2]),t.mIndexArray.push(n.mIndices[2]),t.mIndexArray.push(n.mIndices[3]),t.mIndexArray.push(n.mIndices[0])}}}if(t.mNumBones){t.mBones=[];for(let r=0;r<t.mNumBones;++r)t.mBones[r]=new x,$(e,t.mBones[r])}}function te(e,t){q(4670==V(e)),V(e),t.mKey=j(e),t.mSemantic=Q(e),t.mIndex=Q(e),t.mDataLength=Q(e),t.mType=Q(e),t.mData=[],e.ReadBytes(t.mData,1,t.mDataLength)}function re(e,t){if(q(4669==V(e)),V(e),t.mNumAllocated=t.mNumProperties=Q(e),t.mNumProperties){t.mProperties&&delete t.mProperties,t.mProperties=[];for(let r=0;r<t.mNumProperties;++r)t.mProperties[r]=new b,te(e,t.mProperties[r])}}function ne(e,t){q(4664==V(e)),V(e),t.mNodeName=j(e),t.mNumPositionKeys=Q(e),t.mNumRotationKeys=Q(e),t.mNumScalingKeys=Q(e),t.mPreState=Q(e),t.mPostState=Q(e),t.mNumPositionKeys&&(ce?J(e,t.mPositionKeys,t.mNumPositionKeys):(t.mPositionKeys=[],Y(e,t.mPositionKeys,t.mNumPositionKeys))),t.mNumRotationKeys&&(ce?J(e,t.mRotationKeys,t.mNumRotationKeys):(t.mRotationKeys=[],function(e,t,r){for(let n=0;n<r;n++)t[n]=X(e)}(e,t.mRotationKeys,t.mNumRotationKeys))),t.mNumScalingKeys&&(ce?J(e,t.mScalingKeys,t.mNumScalingKeys):(t.mScalingKeys=[],Y(e,t.mScalingKeys,t.mNumScalingKeys)))}function ie(e,t){if(q(4667==V(e)),V(e),t.mName=j(e),t.mDuration=k(e),t.mTicksPerSecond=k(e),t.mNumChannels=Q(e),t.mNumChannels){t.mChannels=[];for(let r=0;r<t.mNumChannels;++r)t.mChannels[r]=new I,ne(e,t.mChannels[r])}}function oe(e,t){q(4662==V(e)),V(e),t.mWidth=Q(e),t.mHeight=Q(e),e.ReadBytes(t.achFormatHint,1,4),ce||(t.mHeight?(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth*t.mHeight*4)):(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth)))}function ae(e,t){q(4661==V(e)),V(e),t.mName=j(e),t.mType=Q(e),1!=t.mType&&(t.mAttenuationConstant=N(e),t.mAttenuationLinear=N(e),t.mAttenuationQuadratic=N(e)),t.mColorDiffuse=z(e),t.mColorSpecular=z(e),t.mColorAmbient=z(e),3==t.mType&&(t.mAngleInnerCone=N(e),t.mAngleOuterCone=N(e))}function se(e,t){q(4660==V(e)),V(e),t.mName=j(e),t.mPosition=G(e),t.mLookAt=G(e),t.mUp=G(e),t.mHorizontalFOV=N(e),t.mClipPlaneNear=N(e),t.mClipPlaneFar=N(e),t.mAspect=N(e)}function le(e,t){if(q(4665==V(e)),V(e),t.mFlags=Q(e),t.mNumMeshes=Q(e),t.mNumMaterials=Q(e),t.mNumAnimations=Q(e),t.mNumTextures=Q(e),t.mNumLights=Q(e),t.mNumCameras=Q(e),t.mRootNode=new y,t.mRootNode=K(e,null,0),t.mNumMeshes){t.mMeshes=[];for(let r=0;r<t.mNumMeshes;++r)t.mMeshes[r]=new u,ee(e,t.mMeshes[r])}if(t.mNumMaterials){t.mMaterials=[];for(let r=0;r<t.mNumMaterials;++r)t.mMaterials[r]=new E,re(e,t.mMaterials[r])}if(t.mNumAnimations){t.mAnimations=[];for(let r=0;r<t.mNumAnimations;++r)t.mAnimations[r]=new B,ie(e,t.mAnimations[r])}if(t.mNumTextures){t.mTextures=[];for(let r=0;r<t.mNumTextures;++r)t.mTextures[r]=new _,oe(e,t.mTextures[r])}if(t.mNumLights){t.mLights=[];for(let r=0;r<t.mNumLights;++r)t.mLights[r]=new F,ae(e,t.mLights[r])}if(t.mNumCameras){t.mCameras=[];for(let r=0;r<t.mNumCameras;++r)t.mCameras[r]=new P,se(e,t.mCameras[r])}}var ce,ue,he=0;return function(e){var t=new R,r=new DataView(e);if(function(e){e.readOffset=0,e.Seek=function(t,r){r==he&&(e.readOffset+=t),1==r&&(e.readOffset=t)},e.ReadBytes=function(e,t,r){var n=t*r;for(let i=0;i<n;i++)e[i]=O(this)},e.subArray32=function(e,t){var r=this.buffer.slice(e,t);return new Float32Array(r)},e.subArrayUint16=function(e,t){var r=this.buffer.slice(e,t);return new Uint16Array(r)},e.subArrayUint8=function(e,t){var r=this.buffer.slice(e,t);return new Uint8Array(r)},e.subArrayUint32=function(e,t){var r=this.buffer.slice(e,t);return new Uint32Array(r)}}(r),r.Seek(44,he),t.versionMajor=Q(r),t.versionMinor=Q(r),t.versionRevision=Q(r),t.compileFlags=Q(r),ce=U(r)>0,ue=U(r)>0,ce)throw"Shortened binaries are not supported!";if(r.Seek(256,he),r.Seek(128,he),r.Seek(64,he),ue){var n=V(r),i=r.FileSize()-r.Tell(),o=[];r.Read(o,1,i);var a=[];uncompress(a,n,o,i),le(new ArrayBuffer(a),t)}else le(r,t);return t.toTHREE()}(e)}});class $s extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new a.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(e,(function(e){t(i.parse(e))}),r,n)}parse(e){const t=new DataView(e),r=t.getUint32(0),n=t.getUint32(4);let i=8;const o=new Float32Array(r),s=new Float32Array(r*r).fill(0);for(let a=0;a<r;a++)o[a]=t.getFloat32(i),i+=4,s[r*a+a]=1;const l=new a.NumberKeyframeTrack(".morphTargetInfluences",o,s),c=new a.AnimationClip("default",o[o.length-1],[l]),u=[];for(let h=0;h<r;h++){const e=new Float32Array(3*n);for(let o=0;o<n;o++){const r=3*o;e[r+0]=t.getFloat32(i),i+=4,e[r+1]=t.getFloat32(i),i+=4,e[r+2]=t.getFloat32(i),i+=4}const r=new a.BufferAttribute(e,3);r.name="morph_"+h,u.push(r)}return{morphTargets:u,clip:c}}}class el extends a.DataTextureLoader{constructor(e){super(e),this.type=a.HalfFloatType}parse(e){const t=65536,r=14,n=65537,i=16384,o=Math.pow(2.7182818,2.2);const s={l:0,c:0,lc:0};function l(e,t,r,n,i){for(;r<e;)t=t<<8|G(n,i),r+=8;r-=e,s.l=t>>r&(1<<e)-1,s.c=t,s.lc=r}const c=new Array(59);function u(e,t,r,i,o,a,u){for(var h=r,d=0,f=0;o<=a;o++){if(h.value-r.value>i)return!1;l(6,d,f,e,h);var p=s.l;if(d=s.c,f=s.lc,u[o]=p,63==p){if(h.value-r.value>i)throw"Something wrong with hufUnpackEncTable";l(8,d,f,e,h);var m=s.l+6;if(d=s.c,f=s.lc,o+m>a+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)u[o++]=0;o--}else if(p>=59){if(o+(m=p-59+2)>a+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)u[o++]=0;o--}}!function(e){for(var t=0;t<=58;++t)c[t]=0;for(t=0;t<n;++t)c[e[t]]+=1;var r=0;for(t=58;t>0;--t){var i=r+c[t]>>1;c[t]=r,r=i}for(t=0;t<n;++t){var o=e[t];o>0&&(e[t]=o|c[o]++<<6)}}(u)}function h(e){return 63&e}function d(e){return e>>6}const f={c:0,lc:0};function p(e,t,r,n){e=e<<8|G(r,n),t+=8,f.c=e,f.lc=t}const m={c:0,lc:0};function g(e,t,r,n,i,o,a,s,l,c){if(e==t){n<8&&(p(r,n,i,a),r=f.c,n=f.lc);var u=r>>(n-=8);u=new Uint8Array([u])[0];if(l.value+u>c)return!1;for(var h=s[l.value-1];u-- >0;)s[l.value++]=h}else{if(!(l.value<c))return!1;s[l.value++]=e}m.c=r,m.lc=n}function A(e){return 65535&e}function v(e){var t=A(e);return t>32767?t-65536:t}const y={a:0,b:0};function x(e,t){var r=v(e),n=v(t),i=r+(1&n)+(n>>1),o=i,a=i-n;y.a=o,y.b=a}function b(e,t){var r=A(e),n=A(t),i=r-(n>>1)&65535,o=n+i-32768&65535;y.a=o,y.b=i}function w(e,t,r,n,i,o,a){for(var s,l=a<16384,c=r>i?i:r,u=1;u<=c;)u<<=1;for(s=u>>=1,u>>=1;u>=1;){for(var h,d,f,p,m=0,g=m+o*(i-s),A=o*u,v=o*s,w=n*u,C=n*s;m<=g;m+=v){for(var E=m,S=m+n*(r-s);E<=S;E+=C){var T=E+w,M=(I=E+A)+w;l?(x(e[E+t],e[I+t]),h=y.a,f=y.b,x(e[T+t],e[M+t]),d=y.a,p=y.b,x(h,d),e[E+t]=y.a,e[T+t]=y.b,x(f,p),e[I+t]=y.a,e[M+t]=y.b):(b(e[E+t],e[I+t]),h=y.a,f=y.b,b(e[T+t],e[M+t]),d=y.a,p=y.b,b(h,d),e[E+t]=y.a,e[T+t]=y.b,b(f,p),e[I+t]=y.a,e[M+t]=y.b)}if(r&u){var I=E+A;l?x(e[E+t],e[I+t]):b(e[E+t],e[I+t]),h=y.a,e[I+t]=y.b,e[E+t]=h}}if(i&u)for(E=m,S=m+n*(r-s);E<=S;E+=C){T=E+w;l?x(e[E+t],e[T+t]):b(e[E+t],e[T+t]),h=y.a,e[T+t]=y.b,e[E+t]=h}s=u,u>>=1}return m}function C(e,t,o,a,s,l){var c=o.value,A=V(t,o),v=V(t,o);o.value+=4;var y=V(t,o);if(o.value+=4,A<0||A>=n||v<0||v>=n)throw"Something wrong with HUF_ENCSIZE";var x=new Array(n),b=new Array(i);if(function(e){for(var t=0;t<i;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(b),u(e,0,o,a-(o.value-c),A,v,x),y>8*(a-(o.value-c)))throw"Something wrong with hufUncompress";!function(e,t,n,i){for(;t<=n;t++){var o=d(e[t]),a=h(e[t]);if(o>>a)throw"Invalid table entry";if(a>r){if((u=i[o>>a-r]).len)throw"Invalid table entry";if(u.lit++,u.p){var s=u.p;u.p=new Array(u.lit);for(var l=0;l<u.lit-1;++l)u.p[l]=s[l]}else u.p=new Array(1);u.p[u.lit-1]=t}else if(a){var c=0;for(l=1<<r-a;l>0;l--){var u;if((u=i[(o<<r-a)+c]).len||u.p)throw"Invalid table entry";u.len=a,u.lit=t,c++}}}}(x,A,v,b),function(e,t,n,i,o,a,s,l,c,u){for(var A=0,v=0,y=l,x=Math.trunc(o.value+(a+7)/8);o.value<x;)for(p(A,v,n,o),A=f.c,v=f.lc;v>=r;)if((E=t[A>>v-r&16383]).len)v-=E.len,g(E.lit,s,A,v,n,0,o,c,u,y),A=m.c,v=m.lc;else{if(!E.p)throw"hufDecode issues";var b;for(b=0;b<E.lit;b++){for(var w=h(e[E.p[b]]);v<w&&o.value<x;)p(A,v,n,o),A=f.c,v=f.lc;if(v>=w&&d(e[E.p[b]])==(A>>v-w&(1<<w)-1)){v-=w,g(E.p[b],s,A,v,n,0,o,c,u,y),A=m.c,v=m.lc;break}}if(b==E.lit)throw"hufDecode issues"}var C=8-a&7;for(A>>=C,v-=C;v>0;){var E;if(!(E=t[A<<r-v&16383]).len)throw"hufDecode issues";v-=E.len,g(E.lit,s,A,v,n,0,o,c,u,y),A=m.c,v=m.lc}}(x,b,e,0,o,y,v,l,s,{value:0})}function E(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function S(e,t){for(var r=0,n=Math.floor((e.length+1)/2),i=0,o=e.length-1;!(i>o)&&(t[i++]=e[r++],!(i>o));)t[i++]=e[n++]}function T(e){for(var t=e.byteLength,r=new Array,n=0,i=new DataView(e);t>0;){var o=i.getInt8(n++);if(o<0){t-=(s=-o)+1;for(var a=0;a<s;a++)r.push(i.getUint8(n++))}else{var s=o;t-=2;var l=i.getUint8(n++);for(a=0;a<s+1;a++)r.push(l)}}return r}function M(e,t,r){for(var n,i=1;i<64;)65280==(n=t[e.value])?i=64:n>>8==255?i+=255&n:(r[i]=n,i++),e.value++}function I(e,t){t[0]=Z(e[0]),t[1]=Z(e[1]),t[2]=Z(e[5]),t[3]=Z(e[6]),t[4]=Z(e[14]),t[5]=Z(e[15]),t[6]=Z(e[27]),t[7]=Z(e[28]),t[8]=Z(e[2]),t[9]=Z(e[4]),t[10]=Z(e[7]),t[11]=Z(e[13]),t[12]=Z(e[16]),t[13]=Z(e[26]),t[14]=Z(e[29]),t[15]=Z(e[42]),t[16]=Z(e[3]),t[17]=Z(e[8]),t[18]=Z(e[12]),t[19]=Z(e[17]),t[20]=Z(e[25]),t[21]=Z(e[30]),t[22]=Z(e[41]),t[23]=Z(e[43]),t[24]=Z(e[9]),t[25]=Z(e[11]),t[26]=Z(e[18]),t[27]=Z(e[24]),t[28]=Z(e[31]),t[29]=Z(e[40]),t[30]=Z(e[44]),t[31]=Z(e[53]),t[32]=Z(e[10]),t[33]=Z(e[19]),t[34]=Z(e[23]),t[35]=Z(e[32]),t[36]=Z(e[39]),t[37]=Z(e[45]),t[38]=Z(e[52]),t[39]=Z(e[54]),t[40]=Z(e[20]),t[41]=Z(e[22]),t[42]=Z(e[33]),t[43]=Z(e[38]),t[44]=Z(e[46]),t[45]=Z(e[51]),t[46]=Z(e[55]),t[47]=Z(e[60]),t[48]=Z(e[21]),t[49]=Z(e[34]),t[50]=Z(e[37]),t[51]=Z(e[47]),t[52]=Z(e[50]),t[53]=Z(e[56]),t[54]=Z(e[59]),t[55]=Z(e[61]),t[56]=Z(e[35]),t[57]=Z(e[36]),t[58]=Z(e[48]),t[59]=Z(e[49]),t[60]=Z(e[57]),t[61]=Z(e[58]),t[62]=Z(e[62]),t[63]=Z(e[63])}function B(e){const t=.5*Math.cos(.7853975),r=.5*Math.cos(3.14159/16),n=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),o=.5*Math.cos(.981746875),a=.5*Math.cos(3*3.14159/8),s=.5*Math.cos(1.374445625);for(var l=new Array(4),c=new Array(4),u=new Array(4),h=new Array(4),d=0;d<8;++d){var f=8*d;l[0]=n*e[f+2],l[1]=a*e[f+2],l[2]=n*e[f+6],l[3]=a*e[f+6],c[0]=r*e[f+1]+i*e[f+3]+o*e[f+5]+s*e[f+7],c[1]=i*e[f+1]-s*e[f+3]-r*e[f+5]-o*e[f+7],c[2]=o*e[f+1]-r*e[f+3]+s*e[f+5]+i*e[f+7],c[3]=s*e[f+1]-o*e[f+3]+i*e[f+5]-r*e[f+7],u[0]=t*(e[f+0]+e[f+4]),u[3]=t*(e[f+0]-e[f+4]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[f+0]=h[0]+c[0],e[f+1]=h[1]+c[1],e[f+2]=h[2]+c[2],e[f+3]=h[3]+c[3],e[f+4]=h[3]-c[3],e[f+5]=h[2]-c[2],e[f+6]=h[1]-c[1],e[f+7]=h[0]-c[0]}for(var p=0;p<8;++p)l[0]=n*e[16+p],l[1]=a*e[16+p],l[2]=n*e[48+p],l[3]=a*e[48+p],c[0]=r*e[8+p]+i*e[24+p]+o*e[40+p]+s*e[56+p],c[1]=i*e[8+p]-s*e[24+p]-r*e[40+p]-o*e[56+p],c[2]=o*e[8+p]-r*e[24+p]+s*e[40+p]+i*e[56+p],c[3]=s*e[8+p]-o*e[24+p]+i*e[40+p]-r*e[56+p],u[0]=t*(e[p]+e[32+p]),u[3]=t*(e[p]-e[32+p]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[0+p]=h[0]+c[0],e[8+p]=h[1]+c[1],e[16+p]=h[2]+c[2],e[24+p]=h[3]+c[3],e[32+p]=h[3]-c[3],e[40+p]=h[2]-c[2],e[48+p]=h[1]-c[1],e[56+p]=h[0]-c[0]}function _(e){for(var t=0;t<64;++t){var r=e[0][t],n=e[1][t],i=e[2][t];e[0][t]=r+1.5747*i,e[1][t]=r-.1873*n-.4682*i,e[2][t]=r+1.8556*n}}function F(e,t,r){for(var n=0;n<64;++n)t[r+n]=a.DataUtils.toHalfFloat(P(e[n]))}function P(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(o,Math.abs(e)-1)}function R(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function L(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(T(t)),n=new Uint8Array(r.length);return E(r),S(r,n),new DataView(n.buffer)}function D(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),r=(0,fn.HT)(t),n=new Uint8Array(r.length);return E(r),S(r,n),new DataView(n.buffer)}function N(e){for(var r=e.viewer,n={value:e.offset.value},i=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),o=new Uint8Array(8192),a=0,s=new Array(e.channels),l=0;l<e.channels;l++)s[l]={},s[l].start=a,s[l].end=s[l].start,s[l].nx=e.width,s[l].ny=e.lines,s[l].size=e.type,a+=s[l].nx*s[l].ny*s[l].size;var c=X(r,n),u=X(r,n);if(u>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(c<=u)for(l=0;l<u-c+1;l++)o[l+c]=z(r,n);var h=new Uint16Array(t),d=function(e,r){for(var n=0,i=0;i<t;++i)(0==i||e[i>>3]&1<<(7&i))&&(r[n++]=i);for(var o=n-1;n<t;)r[n++]=0;return o}(o,h),f=V(r,n);C(e.array,r,n,f,i,a);for(l=0;l<e.channels;++l)for(var p=s[l],m=0;m<s[l].size;++m)w(i,p.start+m,p.nx,p.size,p.ny,p.nx*p.size,d);!function(e,t,r){for(var n=0;n<r;++n)t[n]=e[t[n]]}(h,i,a);for(var g=0,A=new Uint8Array(i.buffer.byteLength),v=0;v<e.lines;v++)for(var y=0;y<e.channels;y++){var x=(p=s[y]).nx*p.size,b=new Uint8Array(i.buffer,2*p.end,2*x);A.set(b,g),g+=2*x,p.end+=x}return new DataView(A.buffer)}function k(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),r=(0,fn.HT)(t);const n=e.lines*e.channels*e.width,i=1==e.type?new Uint16Array(n):new Uint32Array(n);let o=0,a=0;const s=new Array(4);for(let l=0;l<e.lines;l++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:s[0]=o,s[1]=s[0]+e.width,o=s[1]+e.width;for(let n=0;n<e.width;++n){t+=r[s[0]++]<<8|r[s[1]++],i[a]=t,a++}break;case 2:s[0]=o,s[1]=s[0]+e.width,s[2]=s[1]+e.width,o=s[2]+e.width;for(let n=0;n<e.width;++n){t+=r[s[0]++]<<24|r[s[1]++]<<16|r[s[2]++]<<8,i[a]=t,a++}}}return new DataView(i.buffer)}function O(e){var t=e.viewer,r={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),i={version:j(t,r),unknownUncompressedSize:j(t,r),unknownCompressedSize:j(t,r),acCompressedSize:j(t,r),dcCompressedSize:j(t,r),rleCompressedSize:j(t,r),rleUncompressedSize:j(t,r),rleRawSize:j(t,r),totalAcUncompressedCount:j(t,r),totalDcUncompressedCount:j(t,r),acCompression:j(t,r)};if(i.version<2)throw"EXRLoader.parse: "+ee.compression+" version "+i.version+" is unsupported";for(var o=new Array,a=X(t,r)-2;a>0;){var s=U(t.buffer,r),l=z(t,r),c=l>>2&3,u=new Int8Array([(l>>4)-1])[0],h=z(t,r);o.push({name:s,index:u,type:h,compression:c}),a-=s.length+3}for(var d=ee.channels,f=new Array(e.channels),p=0;p<e.channels;++p){var m=f[p]={},g=d[p];m.name=g.name,m.compression=0,m.decoded=!1,m.type=g.pixelType,m.pLinear=g.pLinear,m.width=e.width,m.height=e.lines}for(var A={idx:new Array(3)},v=0;v<e.channels;++v)for(m=f[v],p=0;p<o.length;++p){var y=o[p];m.name==y.name&&(m.compression=y.compression,y.index>=0&&(A.idx[y.index]=v),m.offset=v)}if(i.acCompressedSize>0)switch(i.acCompression){case 0:var x=new Uint16Array(i.totalAcUncompressedCount);C(e.array,t,r,i.acCompressedSize,x,i.totalAcUncompressedCount);break;case 1:var b=e.array.slice(r.value,r.value+i.totalAcUncompressedCount),w=(0,fn.HT)(b);x=new Uint16Array(w.buffer);r.value+=i.totalAcUncompressedCount}if(i.dcCompressedSize>0){var E={array:e.array,offset:r,size:i.dcCompressedSize},S=new Uint16Array(D(E).buffer);r.value+=i.dcCompressedSize}if(i.rleRawSize>0){b=e.array.slice(r.value,r.value+i.rleCompressedSize);var P=T((w=(0,fn.HT)(b)).buffer);r.value+=i.rleCompressedSize}var R=0,L=new Array(f.length);for(p=0;p<L.length;++p)L[p]=new Array;for(var N=0;N<e.lines;++N)for(var k=0;k<f.length;++k)L[k].push(R),R+=f[k].width*e.type*2;!function(e,t,r,n,i,o){var a=new DataView(o.buffer),s=r[e.idx[0]].width,l=r[e.idx[0]].height,c=Math.floor(s/8),u=Math.ceil(s/8),h=Math.ceil(l/8),d=s-8*(u-1),f=l-8*(h-1),p={value:0},m=new Array(3),g=new Array(3),A=new Array(3),v=new Array(3),y=new Array(3);for(let M=0;M<3;++M)y[M]=t[e.idx[M]],m[M]=M<1?0:m[M-1]+u*h,g[M]=new Float32Array(64),A[M]=new Uint16Array(64),v[M]=new Uint16Array(64*u);for(let P=0;P<h;++P){var x=8;P==h-1&&(x=f);var b=8;for(let e=0;e<u;++e){e==u-1&&(b=d);for(let e=0;e<3;++e)A[e].fill(0),A[e][0]=i[m[e]++],M(p,n,A[e]),I(A[e],g[e]),B(g[e]);_(g);for(let t=0;t<3;++t)F(g[t],v[t],64*e)}let t=0;for(let n=0;n<3;++n){const i=r[e.idx[n]].type;for(let e=8*P;e<8*P+x;++e){t=y[n][e];for(let r=0;r<c;++r){const o=64*r+8*(7&e);a.setUint16(t+0*i,v[n][o+0],!0),a.setUint16(t+2*i,v[n][o+1],!0),a.setUint16(t+4*i,v[n][o+2],!0),a.setUint16(t+6*i,v[n][o+3],!0),a.setUint16(t+8*i,v[n][o+4],!0),a.setUint16(t+10*i,v[n][o+5],!0),a.setUint16(t+12*i,v[n][o+6],!0),a.setUint16(t+14*i,v[n][o+7],!0),t+=16*i}}if(c!=u)for(let e=8*P;e<8*P+x;++e){const t=y[n][e]+8*c*2*i,r=64*c+8*(7&e);for(let e=0;e<b;++e)a.setUint16(t+2*e*i,v[n][r+e],!0)}}}for(var w=new Uint16Array(s),C=(a=new DataView(o.buffer),0);C<3;++C){r[e.idx[C]].decoded=!0;var E=r[e.idx[C]].type;if(2==r[C].type)for(var S=0;S<l;++S){const e=y[C][S];for(var T=0;T<s;++T)w[T]=a.getUint16(e+2*T*E,!0);for(T=0;T<s;++T)a.setFloat32(e+2*T*E,Z(w[T]),!0)}}}(A,L,f,x,S,n);for(p=0;p<f.length;++p){if(!(m=f[p]).decoded)switch(m.compression){case 2:var O=0,Q=0;for(N=0;N<e.lines;++N){for(var V=L[p][O],G=0;G<m.width;++G){for(var H=0;H<2*m.type;++H)n[V++]=P[Q+H*m.width*m.height];Q++}O++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(n.buffer)}function U(e,t){for(var r=new Uint8Array(e),n=0;0!=r[t.value+n];)n+=1;var i=(new TextDecoder).decode(r.slice(t.value,t.value+n));return t.value=t.value+n+1,i}function Q(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function V(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function G(e,t){var r=e[t.value];return t.value=t.value+1,r}function z(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}const j=function(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function H(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function W(e,t){return a.DataUtils.toHalfFloat(H(e,t))}function Z(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function X(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function Y(e,t){return Z(X(e,t))}function J(e,t,r,n,i){return"string"===n||"stringvector"===n||"iccProfile"===n?function(e,t,r){var n=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+r));return t.value=t.value+r,n}(t,r,i):"chlist"===n?function(e,t,r,n){for(var i=r.value,o=[];r.value<i+n-1;){var a=U(t,r),s=Q(e,r),l=z(e,r);r.value+=3;var c=Q(e,r),u=Q(e,r);o.push({name:a,pixelType:s,pLinear:l,xSampling:c,ySampling:u})}return r.value+=1,o}(e,t,r,i):"chromaticities"===n?function(e,t){return{redX:H(e,t),redY:H(e,t),greenX:H(e,t),greenY:H(e,t),blueX:H(e,t),blueY:H(e,t),whiteX:H(e,t),whiteY:H(e,t)}}(e,r):"compression"===n?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][z(e,t)]}(e,r):"box2i"===n?function(e,t){return{xMin:V(e,t),yMin:V(e,t),xMax:V(e,t),yMax:V(e,t)}}(e,r):"lineOrder"===n?function(e,t){return["INCREASING_Y"][z(e,t)]}(e,r):"float"===n?H(e,r):"v2f"===n?function(e,t){return[H(e,t),H(e,t)]}(e,r):"v3f"===n?function(e,t){return[H(e,t),H(e,t),H(e,t)]}(e,r):"int"===n?Q(e,r):"rational"===n?function(e,t){return[Q(e,t),V(e,t)]}(e,r):"timecode"===n?function(e,t){return[V(e,t),V(e,t)]}(e,r):"preview"===n?(r.value+=i,"skipped"):void(r.value+=i)}const q=new DataView(e),K=new Uint8Array(e),$={value:0},ee=function(e,t,r){const n={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";n.version=e.getUint8(4);const i=e.getUint8(5);n.spec={singleTile:!!(2&i),longName:!!(4&i),deepFormat:!!(8&i),multiPart:!!(16&i)},r.value=8;for(var o=!0;o;){var a=U(t,r);if(0==a)o=!1;else{var s=U(t,r),l=J(e,t,r,s,V(e,r));void 0===l?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${s}'.`):n[a]=l}}if(0!=i)throw console.error("EXRHeader:",n),"THREE.EXRLoader: provided file is currently unsupported.";return n}(q,e,$),te=function(e,t,r,n,i){const o={size:0,viewer:t,array:r,offset:n,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(e.compression){case"NO_COMPRESSION":o.lines=1,o.uncompress=R;break;case"RLE_COMPRESSION":o.lines=1,o.uncompress=L;break;case"ZIPS_COMPRESSION":o.lines=1,o.uncompress=D;break;case"ZIP_COMPRESSION":o.lines=16,o.uncompress=D;break;case"PIZ_COMPRESSION":o.lines=32,o.uncompress=N;break;case"PXR24_COMPRESSION":o.lines=16,o.uncompress=k;break;case"DWAA_COMPRESSION":o.lines=32,o.uncompress=O;break;case"DWAB_COMPRESSION":o.lines=256,o.uncompress=O;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(o.scanlineBlockSize=o.lines,1==o.type)switch(i){case a.FloatType:o.getter=Y,o.inputSize=2;break;case a.HalfFloatType:o.getter=X,o.inputSize=2}else{if(2!=o.type)throw"EXRLoader.parse: unsupported pixelType "+o.type+" for "+e.compression+".";switch(i){case a.FloatType:o.getter=H,o.inputSize=4;break;case a.HalfFloatType:o.getter=W,o.inputSize=4}}o.blockCount=(e.dataWindow.yMax+1)/o.scanlineBlockSize;for(var s=0;s<o.blockCount;s++)j(t,n);o.outputChannels=3==o.channels?4:o.channels;const l=o.width*o.height*o.outputChannels;switch(i){case a.FloatType:o.byteArray=new Float32Array(l),o.channels<o.outputChannels&&o.byteArray.fill(1,0,l);break;case a.HalfFloatType:o.byteArray=new Uint16Array(l),o.channels<o.outputChannels&&o.byteArray.fill(15360,0,l);break;default:console.error("THREE.EXRLoader: unsupported type: ",i)}return o.bytesPerLine=o.width*o.inputSize*o.channels,4==o.outputChannels?(o.format=a.RGBAFormat,o.encoding=a.LinearEncoding):(o.format=a.RedFormat,o.encoding=a.LinearEncoding),o}(ee,q,K,$,this.type),re={value:0},ne={R:0,G:1,B:2,A:3,Y:0};for(let a=0;a<te.height/te.scanlineBlockSize;a++){const e=V(q,$);te.size=V(q,$),te.lines=e+te.scanlineBlockSize>te.height?te.height-e:te.scanlineBlockSize;const t=te.size<te.lines*te.bytesPerLine?te.uncompress(te):R(te);$.value+=te.size;for(let r=0;r<te.scanlineBlockSize;r++){const e=r+a*te.scanlineBlockSize;if(e>=te.height)break;for(let n=0;n<te.channels;n++){const i=ne[ee.channels[n].name];for(let o=0;o<te.width;o++){re.value=(r*(te.channels*te.width)+n*te.width+o)*te.inputSize;const a=(te.height-1-e)*(te.width*te.outputChannels)+o*te.outputChannels+i;te.byteArray[a]=te.getter(t,re)}}}}return{header:ee,width:te.width,height:te.height,data:te.byteArray,format:te.format,encoding:te.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,(function(e,r){e.encoding=r.encoding,e.minFilter=a.LinearFilter,e.magFilter=a.LinearFilter,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)}),r,n)}}class tl extends a.Loader{constructor(e){super(e),this.availableExtensions=[]}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){const t=this,r=new a.TextureLoader(this.manager);function n(e){const t=[],r=(new DOMParser).parseFromString(e,"application/xml").querySelectorAll("Relationship");for(let n=0;n<r.length;n++){const e=r[n],i={target:e.getAttribute("Target"),id:e.getAttribute("Id"),type:e.getAttribute("Type")};t.push(i)}return t}function i(e){const t={id:e.getAttribute("id"),basematerials:[]},r=e.querySelectorAll("base");for(let n=0;n<r.length;n++){const e=c(r[n]);e.index=n,t.basematerials.push(e)}return t}function o(e){const t={id:e.getAttribute("id"),texid:e.getAttribute("texid"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("tex2coord"),n=[];for(let i=0;i<r.length;i++){const e=r[i],t=e.getAttribute("u"),o=e.getAttribute("v");n.push(parseFloat(t),parseFloat(o))}return t.uvs=new Float32Array(n),t}function s(e){const t={id:e.getAttribute("id"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("color"),n=[],i=new a.Color;for(let o=0;o<r.length;o++){const e=r[o].getAttribute("color");i.setStyle(e.substring(0,7)),i.convertSRGBToLinear(),n.push(i.r,i.g,i.b)}return t.colors=new Float32Array(n),t}function l(e){const t={id:e.getAttribute("id")},r=e.querySelectorAll("pbmetallic"),n=[];for(let i=0;i<r.length;i++){const e=r[i];n.push({name:e.getAttribute("name"),metallicness:parseFloat(e.getAttribute("metallicness")),roughness:parseFloat(e.getAttribute("roughness"))})}return t.data=n,t}function c(e){const t={};return t.name=e.getAttribute("name"),t.displaycolor=e.getAttribute("displaycolor"),t.displaypropertiesid=e.getAttribute("displaypropertiesid"),t}function u(e){const t={};t.objectId=e.getAttribute("objectid");const r=e.getAttribute("transform");return r&&(t.transform=h(r)),t}function h(e){const t=[];e.split(" ").forEach((function(e){t.push(parseFloat(e))}));const r=new a.Matrix4;return r.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1),r}function d(e){const t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);const n=e.getAttribute("pid");n&&(t.pid=n);const i=e.getAttribute("pindex");i&&(t.pindex=i);const o=e.getAttribute("thumbnail");o&&(t.thumbnail=o);const a=e.getAttribute("partnumber");a&&(t.partnumber=a);const s=e.getAttribute("name");s&&(t.name=s);const l=e.querySelector("mesh");l&&(t.mesh=function(e){const t={},r=[],n=e.querySelectorAll("vertices vertex");for(let s=0;s<n.length;s++){const e=n[s],t=e.getAttribute("x"),i=e.getAttribute("y"),o=e.getAttribute("z");r.push(parseFloat(t),parseFloat(i),parseFloat(o))}t.vertices=new Float32Array(r);const i=[],o=[],a=e.querySelectorAll("triangles triangle");for(let s=0;s<a.length;s++){const e=a[s],t=e.getAttribute("v1"),r=e.getAttribute("v2"),n=e.getAttribute("v3"),l=e.getAttribute("p1"),c=e.getAttribute("p2"),u=e.getAttribute("p3"),h=e.getAttribute("pid"),d={};d.v1=parseInt(t,10),d.v2=parseInt(r,10),d.v3=parseInt(n,10),o.push(d.v1,d.v2,d.v3),l&&(d.p1=parseInt(l,10)),c&&(d.p2=parseInt(c,10)),u&&(d.p3=parseInt(u,10)),h&&(d.pid=h),0<Object.keys(d).length&&i.push(d)}return t.triangleProperties=i,t.triangles=new Uint32Array(o),t}(l));const c=e.querySelector("components");return c&&(t.components=function(e){const t=[],r=e.querySelectorAll("component");for(let n=0;n<r.length;n++){const e=u(r[n]);t.push(e)}return t}(c)),t}function f(e){const t={unit:e.getAttribute("unit")||"millimeter"},r=e.querySelectorAll("metadata");r&&(t.metadata=function(e){const t={};for(let r=0;r<e.length;r++){const n=e[r],i=n.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(t[i]=n.textContent)}return t}(r));const n=e.querySelector("resources");n&&(t.resources=function(e){const t={basematerials:{}},r=e.querySelectorAll("basematerials");for(let o=0;o<r.length;o++){const e=i(r[o]);t.basematerials[e.id]=e}t.texture2d={};const n=e.querySelectorAll("texture2d");for(let i=0;i<n.length;i++){const e={id:(a=n[i]).getAttribute("id"),path:a.getAttribute("path"),contenttype:a.getAttribute("contenttype"),tilestyleu:a.getAttribute("tilestyleu"),tilestylev:a.getAttribute("tilestylev"),filter:a.getAttribute("filter")};t.texture2d[e.id]=e}var a;t.colorgroup={};const c=e.querySelectorAll("colorgroup");for(let i=0;i<c.length;i++){const e=s(c[i]);t.colorgroup[e.id]=e}t.pbmetallicdisplayproperties={};const u=e.querySelectorAll("pbmetallicdisplayproperties");for(let i=0;i<u.length;i++){const e=l(u[i]);t.pbmetallicdisplayproperties[e.id]=e}t.texture2dgroup={};const h=e.querySelectorAll("texture2dgroup");for(let i=0;i<h.length;i++){const e=o(h[i]);t.texture2dgroup[e.id]=e}t.object={};const f=e.querySelectorAll("object");for(let i=0;i<f.length;i++){const e=d(f[i]);t.object[e.id]=e}return t}(n));const a=e.querySelector("build");return a&&(t.build=function(e){const t=[],r=e.querySelectorAll("item");for(let n=0;n<r.length;n++){const e=r[n],i={objectId:e.getAttribute("objectid")},o=e.getAttribute("transform");o&&(i.transform=h(o)),t.push(i)}return t}(a)),t}function p(e,t,n,i){const o=e.texid,s=n.resources.texture2d[o];if(s){const e=i[s.path],t=s.contenttype,n=new Blob([e],{type:t}),o=URL.createObjectURL(n),l=r.load(o,(function(){URL.revokeObjectURL(o)}));switch(l.encoding=a.sRGBEncoding,s.tilestyleu){case"wrap":l.wrapS=a.RepeatWrapping;break;case"mirror":l.wrapS=a.MirroredRepeatWrapping;break;case"none":case"clamp":l.wrapS=a.ClampToEdgeWrapping;break;default:l.wrapS=a.RepeatWrapping}switch(s.tilestylev){case"wrap":l.wrapT=a.RepeatWrapping;break;case"mirror":l.wrapT=a.MirroredRepeatWrapping;break;case"none":case"clamp":l.wrapT=a.ClampToEdgeWrapping;break;default:l.wrapT=a.RepeatWrapping}switch(s.filter){case"auto":l.magFilter=a.LinearFilter,l.minFilter=a.LinearMipmapLinearFilter;break;case"linear":l.magFilter=a.LinearFilter,l.minFilter=a.LinearFilter;break;case"nearest":l.magFilter=a.NearestFilter,l.minFilter=a.NearestFilter;break;default:l.magFilter=a.LinearFilter,l.minFilter=a.LinearMipmapLinearFilter}return l}return null}function m(e,t,r,n,i,o,s){const l=s.pindex,c={};for(let a=0,d=t.length;a<d;a++){const e=t[a],r=void 0!==e.p1?e.p1:l;void 0===c[r]&&(c[r]=[]),c[r].push(e)}const u=Object.keys(c),h=[];for(let d=0,f=u.length;d<f;d++){const t=u[d],l=c[t],f=b(e.basematerials[t],n,i,o,s,w),p=new a.BufferGeometry,m=[],g=r.vertices;for(let e=0,r=l.length;e<r;e++){const t=l[e];m.push(g[3*t.v1+0]),m.push(g[3*t.v1+1]),m.push(g[3*t.v1+2]),m.push(g[3*t.v2+0]),m.push(g[3*t.v2+1]),m.push(g[3*t.v2+2]),m.push(g[3*t.v3+0]),m.push(g[3*t.v3+1]),m.push(g[3*t.v3+2])}p.setAttribute("position",new a.Float32BufferAttribute(m,3));const A=new a.Mesh(p,f);h.push(A)}return h}function g(e,t,r,n,i,o,s){const l=new a.BufferGeometry,c=[],u=[],h=r.vertices,d=e.uvs;for(let a=0,p=t.length;a<p;a++){const e=t[a];c.push(h[3*e.v1+0]),c.push(h[3*e.v1+1]),c.push(h[3*e.v1+2]),c.push(h[3*e.v2+0]),c.push(h[3*e.v2+1]),c.push(h[3*e.v2+2]),c.push(h[3*e.v3+0]),c.push(h[3*e.v3+1]),c.push(h[3*e.v3+2]),u.push(d[2*e.p1+0]),u.push(d[2*e.p1+1]),u.push(d[2*e.p2+0]),u.push(d[2*e.p2+1]),u.push(d[2*e.p3+0]),u.push(d[2*e.p3+1])}l.setAttribute("position",new a.Float32BufferAttribute(c,3)),l.setAttribute("uv",new a.Float32BufferAttribute(u,2));const f=b(e,n,i,o,s,p),m=new a.MeshPhongMaterial({map:f,flatShading:!0});return new a.Mesh(l,m)}function A(e,t,r,n,i,o){const s=new a.BufferGeometry,l=[],c=[],u=r.vertices,h=e.colors;for(let a=0,f=t.length;a<f;a++){const e=t[a],r=e.v1,n=e.v2,i=e.v3;l.push(u[3*r+0]),l.push(u[3*r+1]),l.push(u[3*r+2]),l.push(u[3*n+0]),l.push(u[3*n+1]),l.push(u[3*n+2]),l.push(u[3*i+0]),l.push(u[3*i+1]),l.push(u[3*i+2]);const s=void 0!==e.p1?e.p1:o.pindex,d=void 0!==e.p2?e.p2:s,f=void 0!==e.p3?e.p3:s;c.push(h[3*s+0]),c.push(h[3*s+1]),c.push(h[3*s+2]),c.push(h[3*d+0]),c.push(h[3*d+1]),c.push(h[3*d+2]),c.push(h[3*f+0]),c.push(h[3*f+1]),c.push(h[3*f+2])}s.setAttribute("position",new a.Float32BufferAttribute(l,3)),s.setAttribute("color",new a.Float32BufferAttribute(c,3));const d=new a.MeshPhongMaterial({vertexColors:!0,flatShading:!0});return new a.Mesh(s,d)}function v(e){const t=new a.BufferGeometry;t.setIndex(new a.BufferAttribute(e.triangles,1)),t.setAttribute("position",new a.BufferAttribute(e.vertices,3));const r=new a.MeshPhongMaterial({color:11184895,flatShading:!0});return new a.Mesh(t,r)}function y(e,t){return void 0!==t.resources.texture2dgroup[e]?"texture":void 0!==t.resources.basematerials[e]?"material":void 0!==t.resources.colorgroup[e]?"vertexColors":"default"===e?"default":void 0}function x(e,t,r,n,i){const o=new a.Group,s=function(e,t,r,n,i,o){const a=Object.keys(e),s=[];for(let l=0,c=a.length;l<c;l++){const c=a[l],u=e[c];switch(y(c,n)){case"material":const e=m(n.resources.basematerials[c],u,t,r,n,i,o);for(let t=0,r=e.length;t<r;t++)s.push(e[t]);break;case"texture":const a=n.resources.texture2dgroup[c];s.push(g(a,u,t,r,n,i,o));break;case"vertexColors":const l=n.resources.colorgroup[c];s.push(A(l,u,t,0,0,o));break;case"default":s.push(v(t));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}return s}(function(e,t,r){const n={},i=t.triangleProperties,o=r.pid;for(let a=0,s=i.length;a<s;a++){const e=i[a];let t=void 0!==e.pid?e.pid:o;void 0===t&&(t="default"),void 0===n[t]&&(n[t]=[]),n[t].push(e)}return n}(0,e,i),e,t,r,n,i);for(let a=0,l=s.length;a<l;a++)o.add(s[a]);return o}function b(e,t,r,n,i,o){return void 0!==e.build||(e.build=o(e,t,r,n,i)),e.build}function w(e,t,r){let n;const i=e.displaypropertiesid,o=r.resources.pbmetallicdisplayproperties;if(null!==i&&void 0!==o[i]){const t=o[i].data[e.index];n=new a.MeshStandardMaterial({flatShading:!0,roughness:t.roughness,metalness:t.metallicness})}else n=new a.MeshPhongMaterial({flatShading:!0});n.name=e.name;const s=e.displaycolor,l=s.substring(0,7);return n.color.setStyle(l),n.color.convertSRGBToLinear(),9===s.length&&(n.opacity=parseInt(s.charAt(7)+s.charAt(8),16)/255),n}function C(e,t,r,n){const i=new a.Group;for(let o=0;o<e.length;o++){const a=e[o];let s=t[a.objectId];void 0===s&&(E(a.objectId,t,r,n),s=t[a.objectId]);const l=s.clone(),c=a.transform;c&&l.applyMatrix4(c),i.add(l)}return i}function E(e,r,n,i){const o=n.resources.object[e];if(o.mesh){const e=o.mesh;!function(e,r,n){if(!e)return;const i=[],o=Object.keys(e);for(let a=0;a<o.length;a++){const e=o[a];for(let r=0;r<t.availableExtensions.length;r++){const n=t.availableExtensions[r];n.ns===e&&i.push(n)}}for(let t=0;t<i.length;t++){const o=i[t];o.apply(n,e[o.ns],r)}}(n.extensions,e,n.xml),r[o.id]=b(e,r,n,i,o,x)}else{const e=o.components;r[o.id]=b(e,r,n,i,o,C)}}const S=function(e){let t,r,i=null,o=null;const s=[],l=[];let c;const u={},h={};try{i=(0,fn.GZ)(new Uint8Array(e))}catch(m){if(m instanceof ReferenceError)return console.error("THREE.3MFLoader: fflate missing and file is compressed."),null}for(o in i)o.match(/\_rels\/.rels$/)?t=o:o.match(/3D\/_rels\/.*\.model\.rels$/)?r=o:o.match(/^3D\/.*\.model$/)?s.push(o):o.match(/^3D\/Metadata\/.*\.xml$/)||(o.match(/^3D\/Textures?\/.*/)?l.push(o):o.match(/^3D\/Other\/.*/));const d=i[t],p=n(a.LoaderUtils.decodeText(d));if(r){const e=i[r];c=n(a.LoaderUtils.decodeText(e))}for(let n=0;n<s.length;n++){const e=s[n],t=i[e],r=a.LoaderUtils.decodeText(t),o=(new DOMParser).parseFromString(r,"application/xml");"model"!==o.documentElement.nodeName.toLowerCase()&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",e);const l=o.querySelector("model"),c={};for(let n=0;n<l.attributes.length;n++){const e=l.attributes[n];e.name.match(/^xmlns:(.+)$/)&&(c[e.value]=RegExp.$1)}const h=f(l);h.xml=l,0<Object.keys(c).length&&(h.extensions=c),u[e]=h}for(let n=0;n<l.length;n++){const e=l[n];h[e]=i[e].buffer}return{rels:p,modelRels:c,model:u,printTicket:{},texture:h,other:{}}}(e);return function(e,t){const r=new a.Group,n=function(e){for(let t=0;t<e.length;t++){const r=e[t];if("model"===r.target.split(".").pop().toLowerCase())return r}}(t.rels),i=t.model[n.target.substring(1)].build;for(let o=0;o<i.length;o++){const t=i[o],n=e[t.objectId],a=t.transform;a&&n.applyMatrix4(a),r.add(n)}return r}(function(e){const t=e.model,r=e.modelRels,n={},i=Object.keys(t),o={};if(r)for(let a=0,s=r.length;a<s;a++){const t=r[a],n=t.target.substring(1);e.texture[n]&&(o[t.target]=e.texture[n])}for(let a=0;a<i.length;a++){const e=t[i[a]],r=Object.keys(e.resources.object);for(let t=0;t<r.length;t++){E(r[t],n,e,o)}}return n}(S),S)}addExtension(e){this.availableExtensions.push(e)}}class rl extends a.Loader{load(e,t,r,n){const i=this,o=new a.FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){const t=e.split("\n"),r=[],n=[];for(let o of t){if(o=o.trim(),"#"===o.charAt(0))continue;const e=o.split(/\s+/);3===e.length&&(r.push(parseFloat(e[0])),r.push(parseFloat(e[1])),r.push(parseFloat(e[2]))),6===e.length&&(r.push(parseFloat(e[0])),r.push(parseFloat(e[1])),r.push(parseFloat(e[2])),n.push(parseFloat(e[3])/255),n.push(parseFloat(e[4])/255),n.push(parseFloat(e[5])/255))}const i=new a.BufferGeometry;return i.setAttribute("position",new a.Float32BufferAttribute(r,3)),n.length>0&&i.setAttribute("color",new a.Float32BufferAttribute(n,3)),i}}class nl extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){function t(e,t){const r=e.length,n=new Float32Array(r+t.length);return n.set(e),n.set(t,r),n}function r(e,t){var r=e.length,n=new Int32Array(r+t.length);return n.set(e),n.set(t,r),n}var n=a.LoaderUtils.decodeText(new Uint8Array(e,0,250)).split("\n");return-1!==n[0].indexOf("xml")?function(e){function n(e){var t,r,n,i,o,a,s="undefined"!==typeof Uint8Array?Uint8Array:Array,l=[],c=[],u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=u.length;for(t=0;t<h;t++)l[t]=u[t];for(t=0;t<h;++t)c[u.charCodeAt(t)]=t;if(c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63,(h=e.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");a=new s(3*h/4-(o="="===e[h-2]?2:"="===e[h-1]?1:0)),n=o>0?h-4:h;var d=0;for(t=0,r=0;t<n;t+=4,r+=3)i=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],a[d++]=(16711680&i)>>16,a[d++]=(65280&i)>>8,a[d++]=255&i;return 2===o?(i=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,a[d++]=255&i):1===o&&(i=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,a[d++]=i>>8&255,a[d++]=255&i),a}function i(e,i){var o=0;if("UInt64"===s.attributes.header_type?o=8:"UInt32"===s.attributes.header_type&&(o=4),"binary"===e.attributes.format&&i){var a,l,c,u,h,d;if("Float32"===e.attributes.type)var f=new Float32Array;else"Int64"===e.attributes.type&&(f=new Int32Array);l=(a=n(e["#text"]))[0];for(var p=1;p<o-1;p++)l|=a[p]<<p*o;for(u=(l+3)*o,d=u+=u%3>0?3-u%3:0,(h=[]).push(d),c=3*o,p=0;p<l;p++){for(var m=a[p*o+c],g=1;g<o-1;g++)m|=a[p*o+c+g]<<8*g;d+=m,h.push(d)}for(p=0;p<h.length-1;p++)A=(0,fn.HT)(a.slice(h[p],h[p+1])).buffer,"Float32"===e.attributes.type?f=t(f,A=new Float32Array(A)):"Int64"===e.attributes.type&&(f=r(f,A=new Int32Array(A)));delete e["#text"],"Int64"===e.attributes.type&&"binary"===e.attributes.format&&(f=f.filter((function(e,t){if(t%2!==1)return!0})))}else{if("binary"!==e.attributes.format||i)if(e["#text"])var A=e["#text"].split(/\s+/).filter((function(e){if(""!==e)return e}));else A=new Int32Array(0).buffer;else A=(A=n(e["#text"])).slice(o).buffer;delete e["#text"],"Float32"===e.attributes.type?f=new Float32Array(A):"Int32"===e.attributes.type?f=new Int32Array(A):"Int64"===e.attributes.type&&(f=new Int32Array(A),"binary"===e.attributes.format&&(f=f.filter((function(e,t){if(t%2!==1)return!0}))))}return f}var o=null;if(window.DOMParser)try{o=(new DOMParser).parseFromString(e,"text/xml")}catch(U){o=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((o=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!o.loadXML())throw new Error(o.parseError.reason+o.parseError.srcText)}catch(U){o=null}}var s=function e(t){var r={};if(1===t.nodeType){if(t.attributes&&t.attributes.length>0){r.attributes={};for(var n=0;n<t.attributes.length;n++){var i=t.attributes.item(n);r.attributes[i.nodeName]=i.nodeValue.trim()}}}else 3===t.nodeType&&(r=t.nodeValue.trim());if(t.hasChildNodes())for(var o=0;o<t.childNodes.length;o++){var a=t.childNodes.item(o),s=a.nodeName;if("undefined"===typeof r[s])""!==(c=e(a))&&(r[s]=c);else{if("undefined"===typeof r[s].push){var l=r[s];r[s]=[l]}var c;""!==(c=e(a))&&r[s].push(c)}}return r}(o.documentElement),l=[],c=[],u=[];if(s.PolyData){for(var h=s.PolyData.Piece,d=s.attributes.hasOwnProperty("compressor"),f=["PointData","Points","Strips","Polys"],p=0,m=f.length;p<m;){var g=h[f[p]];if(g&&g.DataArray){if("[object Array]"===Object.prototype.toString.call(g.DataArray))var A=g.DataArray;else A=[g.DataArray];for(var v=0,y=A.length;v<y;)"#text"in A[v]&&A[v]["#text"].length>0&&(A[v].text=i(A[v],d)),v++;switch(f[p]){case"PointData":var x=parseInt(h.attributes.NumberOfPoints),b=g.attributes.Normals;if(x>0)for(var w=0,C=A.length;w<C;w++)if(b===A[w].attributes.Name){var E=A[w].attributes.NumberOfComponents;(c=new Float32Array(x*E)).set(A[w].text,0)}break;case"Points":(x=parseInt(h.attributes.NumberOfPoints))>0&&(E=g.DataArray.attributes.NumberOfComponents,(l=new Float32Array(x*E)).set(g.DataArray.text,0));break;case"Strips":var S=parseInt(h.attributes.NumberOfStrips);if(S>0){var T=new Int32Array(g.DataArray[0].text.length),M=new Int32Array(g.DataArray[1].text.length);T.set(g.DataArray[0].text,0),M.set(g.DataArray[1].text,0);var I=S+T.length;u=new Uint32Array(3*I-9*S);var B=0;for(w=0,C=S;w<C;w++){for(var _=[],F=0,P=M[w],R=0;F<P-R;F++)_.push(T[F]),w>0&&(R=M[w-1]);var L=0;for(P=M[w],R=0;L<P-R-2;L++)L%2?(u[B++]=_[L],u[B++]=_[L+2],u[B++]=_[L+1]):(u[B++]=_[L],u[B++]=_[L+1],u[B++]=_[L+2]),w>0&&(R=M[w-1])}}break;case"Polys":var D=parseInt(h.attributes.NumberOfPolys);if(D>0){T=new Int32Array(g.DataArray[0].text.length),M=new Int32Array(g.DataArray[1].text.length),T.set(g.DataArray[0].text,0),M.set(g.DataArray[1].text,0),I=D+T.length,u=new Uint32Array(3*I-9*D),B=0;var N=0;for(w=0,C=D,R=0;w<C;){var k=[];for(F=0,P=M[w];F<P-R;)k.push(T[N++]),F++;for(L=1;L<P-R-1;)u[B++]=k[0],u[B++]=k[L],u[B++]=k[L+1],L++;R=M[++w-1]}}}}p++}var O=new a.BufferGeometry;return O.setIndex(new a.BufferAttribute(u,1)),O.setAttribute("position",new a.BufferAttribute(l,3)),c.length===l.length&&O.setAttribute("normal",new a.BufferAttribute(c,3)),O}throw new Error("Unsupported DATASET type")}(a.LoaderUtils.decodeText(e)):n[2].includes("ASCII")?function(e){var t,r=[],n=[],i=[],o=[],s=/^[^\d.\s-]+/,l=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,c=/^(\d+)\s+([\s\d]*)/,u=/^POINTS /,h=/^POLYGONS /,d=/^TRIANGLE_STRIPS /,f=/^POINT_DATA[ ]+(\d+)/,p=/^CELL_DATA[ ]+(\d+)/,m=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,g=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,A=!1,v=!1,y=!1,x=!1,b=!1,w=!1,C=!1,E=e.split("\n");for(var S in E){var T=E[S].trim();if(0===T.indexOf("DATASET")){var M=T.split(" ")[1];if("POLYDATA"!==M)throw new Error("Unsupported DATASET type: "+M)}else if(A)for(;null!==(t=l.exec(T))&&null===s.exec(T);){var I=parseFloat(t[1]),B=parseFloat(t[2]),_=parseFloat(t[3]);n.push(I,B,_)}else if(v){if(null!==(t=c.exec(T))){var F=parseInt(t[1]),P=t[2].split(/\s+/);if(F>=3)for(var R=parseInt(P[0]),L=1,D=0;D<F-2;++D)N=parseInt(P[L]),k=parseInt(P[L+1]),r.push(R,N,k),L++}}else if(y){if(null!==(t=c.exec(T))){var N,k;if(F=parseInt(t[1]),P=t[2].split(/\s+/),F>=3)for(D=0;D<F-2;D++)D%2===1?(R=parseInt(P[D]),N=parseInt(P[D+2]),k=parseInt(P[D+1]),r.push(R,N,k)):(R=parseInt(P[D]),N=parseInt(P[D+1]),k=parseInt(P[D+2]),r.push(R,N,k))}}else if(x||b)if(w)for(;null!==(t=l.exec(T))&&null===s.exec(T);){var O=parseFloat(t[1]),U=parseFloat(t[2]),Q=parseFloat(t[3]);i.push(O,U,Q)}else if(C)for(;null!==(t=l.exec(T))&&null===s.exec(T);){var V=parseFloat(t[1]),G=parseFloat(t[2]),z=parseFloat(t[3]);o.push(V,G,z)}null!==h.exec(T)?(v=!0,A=!1,y=!1):null!==u.exec(T)?(v=!1,A=!0,y=!1):null!==d.exec(T)?(v=!1,A=!1,y=!0):null!==f.exec(T)?(x=!0,A=!1,v=!1,y=!1):null!==p.exec(T)?(b=!0,A=!1,v=!1,y=!1):null!==m.exec(T)?(w=!0,C=!1,A=!1,v=!1,y=!1):null!==g.exec(T)&&(C=!0,w=!1,A=!1,v=!1,y=!1)}var j=new a.BufferGeometry;if(j.setIndex(r),j.setAttribute("position",new a.Float32BufferAttribute(n,3)),o.length===n.length&&j.setAttribute("normal",new a.Float32BufferAttribute(o,3)),i.length!==r.length)i.length===n.length&&j.setAttribute("color",new a.Float32BufferAttribute(i,3));else{var H=(j=j.toNonIndexed()).attributes.position.count/3;if(i.length===3*H){var W=[];for(S=0;S<H;S++)O=i[3*S+0],U=i[3*S+1],Q=i[3*S+2],W.push(O,U,Q),W.push(O,U,Q),W.push(O,U,Q);j.setAttribute("color",new a.Float32BufferAttribute(W,3))}}return j}(a.LoaderUtils.decodeText(e)):function(e){var t,r,n,i,o,s,l,c=new Uint8Array(e),u=new DataView(e),h=[],d=[],f=[],p=0;function m(e,t){for(var r=t,n=e[r],i=[];10!==n;)i.push(String.fromCharCode(n)),n=e[++r];return{start:t,end:r,next:r+1,parsedString:i.join("")}}for(;;){if(0===(l=(s=m(c,p)).parsedString).indexOf("DATASET")){var g=l.split(" ")[1];if("POLYDATA"!==g)throw new Error("Unsupported DATASET type: "+g)}else if(0===l.indexOf("POINTS")){for(t=4*(i=parseInt(l.split(" ")[1],10))*3,h=new Float32Array(3*i),r=s.next,n=0;n<i;n++)h[3*n]=u.getFloat32(r,!1),h[3*n+1]=u.getFloat32(r+4,!1),h[3*n+2]=u.getFloat32(r+8,!1),r+=12;s.next=s.next+t+1}else if(0===l.indexOf("TRIANGLE_STRIPS")){var A=parseInt(l.split(" ")[1],10);t=4*(w=parseInt(l.split(" ")[2],10)),f=new Uint32Array(3*w-9*A);var v=0;for(r=s.next,n=0;n<A;n++){var y=u.getInt32(r,!1),x=[];for(r+=4,o=0;o<y;o++)x.push(u.getInt32(r,!1)),r+=4;for(var b=0;b<y-2;b++)b%2?(f[v++]=x[b],f[v++]=x[b+2],f[v++]=x[b+1]):(f[v++]=x[b],f[v++]=x[b+1],f[v++]=x[b+2])}s.next=s.next+t+1}else if(0===l.indexOf("POLYGONS")){var w;for(A=parseInt(l.split(" ")[1],10),t=4*(w=parseInt(l.split(" ")[2],10)),f=new Uint32Array(3*w-9*A),v=0,r=s.next,n=0;n<A;n++){for(y=u.getInt32(r,!1),x=[],r+=4,o=0;o<y;o++)x.push(u.getInt32(r,!1)),r+=4;for(b=1;b<y-1;b++)f[v++]=x[0],f[v++]=x[b],f[v++]=x[b+1]}s.next=s.next+t+1}else if(0===l.indexOf("POINT_DATA")){for(i=parseInt(l.split(" ")[1],10),s=m(c,s.next),t=4*i*3,d=new Float32Array(3*i),r=s.next,n=0;n<i;n++)d[3*n]=u.getFloat32(r,!1),d[3*n+1]=u.getFloat32(r+4,!1),d[3*n+2]=u.getFloat32(r+8,!1),r+=12;s.next=s.next+t}if((p=s.next)>=c.byteLength)break}var C=new a.BufferGeometry;return C.setIndex(new a.BufferAttribute(f,1)),C.setAttribute("position",new a.BufferAttribute(h,3)),d.length===h.length&&C.setAttribute("normal",new a.BufferAttribute(d,3)),C}(e)}}class il extends a.Loader{load(e,t,r,n){const i=new a.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("text"),i.load(e,(r=>{try{t(this.parse(r))}catch(i){n?n(i):console.error(i),this.manager.itemError(e)}}),r,n)}parse(e){const t=(e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim()).split(/[\n\r]+/g),r=t[0].trim().split(/\s+/g).map((e=>parseFloat(e))),n=r[1]-r[0],i=r.length;for(let a=1,p=r.length;a<p;a++)if(n!==r[a]-r[a-1])throw new Error("LUT3dlLoader: Inconsistent grid size not supported.");const o=new Array(i*i*i*4);let s=0,l=0;for(let a=1,p=t.length;a<p;a++){const e=t[a].trim().split(/\s/g),r=parseFloat(e[0]),n=parseFloat(e[1]),c=parseFloat(e[2]);l=Math.max(l,r,n,c);const u=s%i*i*i+Math.floor(s/i)%i*i+Math.floor(s/(i*i))%i;o[4*u+0]=r,o[4*u+1]=n,o[4*u+2]=c,o[4*u+3]=1,s+=1}const c=Math.ceil(Math.log2(l)),u=Math.pow(2,c);for(let a=0,p=o.length;a<p;a+=4){const e=o[a+0],t=o[a+1],r=o[a+2];o[a+0]=255*e/u,o[a+1]=255*t/u,o[a+2]=255*r/u}const h=new Uint8Array(o),d=new a.DataTexture;d.image.data=h,d.image.width=i,d.image.height=i*i,d.format=a.RGBAFormat,d.type=a.UnsignedByteType,d.magFilter=a.LinearFilter,d.minFilter=a.LinearFilter,d.wrapS=a.ClampToEdgeWrapping,d.wrapT=a.ClampToEdgeWrapping,d.generateMipmaps=!1;const f=new a.DataTexture3D;return f.image.data=h,f.image.width=i,f.image.height=i,f.image.depth=i,f.format=a.RGBAFormat,f.type=a.UnsignedByteType,f.magFilter=a.LinearFilter,f.minFilter=a.LinearFilter,f.wrapS=a.ClampToEdgeWrapping,f.wrapT=a.ClampToEdgeWrapping,f.wrapR=a.ClampToEdgeWrapping,f.generateMipmaps=!1,{size:i,texture:d,texture3D:f}}}class ol extends a.CompressedTextureLoader{constructor(e){super(e)}parse(e,t){const r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e,t,r,n){const i=r*n*4,o=new Uint8Array(e,t,i),a=new Uint8Array(i);let s=0,l=0;for(let c=0;c<n;c++)for(let e=0;e<r;e++){const e=o[l];l++;const t=o[l];l++;const r=o[l];l++;const n=o[l];l++,a[s]=r,s++,a[s]=t,s++,a[s]=e,s++,a[s]=n,s++}return a}const o=n("DXT1"),s=n("DXT3"),l=n("DXT5"),c=n("ETC1"),u=new Int32Array(e,0,31);if(542327876!==u[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),r;if(4&!u[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;let h;const d=u[21];let f=!1;switch(d){case o:h=8,r.format=a.RGB_S3TC_DXT1_Format;break;case s:h=16,r.format=a.RGBA_S3TC_DXT3_Format;break;case l:h=16,r.format=a.RGBA_S3TC_DXT5_Format;break;case c:h=8,r.format=a.RGB_ETC1_Format;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(p=d,String.fromCharCode(255&p,p>>8&255,p>>16&255,p>>24&255))),r;f=!0,h=64,r.format=a.RGBAFormat}var p;r.mipmapCount=1,131072&u[2]&&!1!==t&&(r.mipmapCount=Math.max(1,u[7]));const m=u[28];if(r.isCubemap=!!(512&m),r.isCubemap&&(!(1024&m)||!(2048&m)||!(4096&m)||!(8192&m)||!(16384&m)||!(32768&m)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),r;r.width=u[4],r.height=u[3];let g=u[1]+4;const A=r.isCubemap?6:1;for(let a=0;a<A;a++){let t=r.width,n=r.height;for(let o=0;o<r.mipmapCount;o++){let o,a;f?(o=i(e,g,t,n),a=o.length):(a=Math.max(4,t)/4*Math.max(4,n)/4*h,o=new Uint8Array(e,g,a));const s={data:o,width:t,height:n};r.mipmaps.push(s),g+=a,t=Math.max(t>>1,1),n=Math.max(n>>1,1)}}return r}}class al extends a.CompressedTextureLoader{constructor(e){super(e)}parse(e,t){const r=new Uint32Array(e,0,13),n={buffer:e,header:r,loadMipmaps:t};return 55727696===r[0]?function(e){const t=e.header;let r,n;const i=t[12],o=t[2],s=t[6],l=t[7],c=t[10],u=t[11];switch(o){case 0:r=2,n=a.RGB_PVRTC_2BPPV1_Format;break;case 1:r=2,n=a.RGBA_PVRTC_2BPPV1_Format;break;case 2:r=4,n=a.RGB_PVRTC_4BPPV1_Format;break;case 3:r=4,n=a.RGBA_PVRTC_4BPPV1_Format;break;default:console.error("THREE.PVRLoader: Unsupported PVR format:",o)}return e.dataPtr=52+i,e.bpp=r,e.format=n,e.width=l,e.height=s,e.numSurfaces=c,e.numMipmaps=u,e.isCubemap=6===c,sl(e)}(n):559044176===r[11]?function(e){const t=e.header,r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],l=t[10],c=t[12],u=24,h=255&s;let d,f;const p=l>0;25===h?(f=p?a.RGBA_PVRTC_4BPPV1_Format:a.RGB_PVRTC_4BPPV1_Format,d=4):h===u?(f=p?a.RGBA_PVRTC_2BPPV1_Format:a.RGB_PVRTC_2BPPV1_Format,d=2):console.error("THREE.PVRLoader: Unknown PVR format:",h);return e.dataPtr=r,e.bpp=d,e.format=f,e.width=i,e.height=n,e.numSurfaces=c,e.numMipmaps=o+1,e.isCubemap=6===c,sl(e)}(n):void console.error("THREE.PVRLoader: Unknown PVR format.")}}function sl(e){const t={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},r=e.buffer;let n=e.dataPtr,i=0,o=0,a=0,s=0,l=0,c=0;const u=e.bpp,h=e.numSurfaces;2===u?(a=8,s=4):(a=4,s=4),o=a*s*u/8,t.mipmaps.length=e.numMipmaps*h;let d=0;for(;d<e.numMipmaps;){const u=e.width>>d,f=e.height>>d;l=u/a,c=f/s,l<2&&(l=2),c<2&&(c=2),i=l*c*o;for(let o=0;o<h;o++){const a={data:new Uint8Array(r,n,i),width:u,height:f};t.mipmaps[o*e.numMipmaps+d]=a,n+=i}d++}return t}class ll extends a.Loader{constructor(e){super(e),this.splitLayer=!1}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){let t,r={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},n=[];const i=new a.LineBasicMaterial({color:16711680});i.name="path";const o=new a.LineBasicMaterial({color:65280});function s(e){t={vertex:[],pathVertex:[],z:e.z},n.push(t)}function l(e,t){return r.relative?t:t-e}function c(e,t){return r.relative?e+t:t}o.name="extruded";let u=e.replace(/;.+/g,"").split("\n");for(let a=0;a<u.length;a++){let e=u[a].split(" "),n=e[0].toUpperCase(),i={};if(e.splice(1).forEach((function(e){if(void 0!==e[0]){let t=e[0].toLowerCase(),r=parseFloat(e.substring(1));i[t]=r}})),"G0"===n||"G1"===n){let e={x:void 0!==i.x?c(r.x,i.x):r.x,y:void 0!==i.y?c(r.y,i.y):r.y,z:void 0!==i.z?c(r.z,i.z):r.z,e:void 0!==i.e?c(r.e,i.e):r.e,f:void 0!==i.f?c(r.f,i.f):r.f};l(r.e,e.e)>0&&(e.extruding=l(r.e,e.e)>0,void 0!=t&&e.z==t.z||s(e)),h=r,d=e,void 0===t&&s(h),r.extruding?(t.vertex.push(h.x,h.y,h.z),t.vertex.push(d.x,d.y,d.z)):(t.pathVertex.push(h.x,h.y,h.z),t.pathVertex.push(d.x,d.y,d.z)),r=e}else if("G2"===n||"G3"===n);else if("G90"===n)r.relative=!1;else if("G91"===n)r.relative=!0;else if("G92"===n){let e=r;e.x=void 0!==i.x?i.x:e.x,e.y=void 0!==i.y?i.y:e.y,e.z=void 0!==i.z?i.z:e.z,e.e=void 0!==i.e?i.e:e.e,r=e}}var h,d;function f(e,t,r){let n=new a.BufferGeometry;n.setAttribute("position",new a.Float32BufferAttribute(e,3));let s=new a.LineSegments(n,t?o:i);s.name="layer"+r,p.add(s)}const p=new a.Group;if(p.name="gcode",this.splitLayer)for(let a=0;a<n.length;a++){let e=n[a];f(e.vertex,!0,a),f(e.pathVertex,!1,a)}else{const e=[],t=[];for(let r=0;r<n.length;r++){let i=n[r],o=i.vertex,a=i.pathVertex;for(let t=0;t<o.length;t++)e.push(o[t]);for(let e=0;e<a.length;e++)t.push(a[e])}f(e,!0,n.length),f(t,!1,n.length)}return p.quaternion.setFromEuler(new a.Euler(-Math.PI/2,0,0)),p}}var cl=r(7074);class ul extends a.Loader{constructor(e){super(e),this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]}load(e,t,r,n){const i=this,o=""===this.path?a.LoaderUtils.extractUrlBase(e):this.path,s=new a.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(r){try{t(i.parse(r,o))}catch(a){n?n(a):console.error(a),i.manager.itemError(e)}}),r,n)}parse(e,t){this.group=new a.Group,this.position=0,this.materials=[],this.meshes=[],this.readFile(e,t);for(let r=0;r<this.meshes.length;r++)this.group.add(this.meshes[r]);return this.group}readFile(e,t){const r=new DataView(e),n=this.readChunk(r);if(n.id===dl||n.id===fl||n.id===hl){let e=this.nextChunk(r,n);for(;0!==e;){if(e===pl){const e=this.readDWord(r);this.debugMessage("3DS file version: "+e)}else e===bl?(this.resetPosition(r),this.readMeshData(r,t)):this.debugMessage("Unknown main chunk: "+e.toString(16));e=this.nextChunk(r,n)}}this.debugMessage("Parsed "+this.meshes.length+" meshes")}readMeshData(e,t){const r=this.readChunk(e);let n=this.nextChunk(e,r);for(;0!==n;){if(n===wl){const t=+this.readDWord(e);this.debugMessage("Mesh Version: "+t)}else if(n===Cl){const t=this.readFloat(e);this.debugMessage("Master scale: "+t),this.group.scale.set(t,t,t)}else n===Hl?(this.debugMessage("Named Object"),this.resetPosition(e),this.readNamedObject(e)):n===El?(this.debugMessage("Material"),this.resetPosition(e),this.readMaterialEntry(e,t)):this.debugMessage("Unknown MDATA chunk: "+n.toString(16));n=this.nextChunk(e,r)}}readNamedObject(e){const t=this.readChunk(e),r=this.readString(e,64);t.cur=this.position;let n=this.nextChunk(e,t);for(;0!==n;){if(n===Wl){this.resetPosition(e);const t=this.readMesh(e);t.name=r,this.meshes.push(t)}else this.debugMessage("Unknown named object chunk: "+n.toString(16));n=this.nextChunk(e,t)}this.endChunk(t)}readMaterialEntry(e,t){const r=this.readChunk(e);let n=this.nextChunk(e,r);const i=new a.MeshPhongMaterial;for(;0!==n;){if(n===Sl)i.name=this.readString(e,64),this.debugMessage("   Name: "+i.name);else if(n===Rl)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(n===Ll){const t=this.readByte(e);i.wireframeLinewidth=t,this.debugMessage("   Wireframe Thickness: "+t)}else if(n===Fl)i.side=a.DoubleSide,this.debugMessage("   DoubleSided");else if(n===Pl)this.debugMessage("   Additive Blending"),i.blending=a.AdditiveBlending;else if(n===Ml)this.debugMessage("   Diffuse Color"),i.color=this.readColor(e);else if(n===Il)this.debugMessage("   Specular Color"),i.specular=this.readColor(e);else if(n===Tl)this.debugMessage("   Ambient color"),i.color=this.readColor(e);else if(n===Bl){const t=this.readPercentage(e);i.shininess=100*t,this.debugMessage("   Shininess : "+t)}else if(n===_l){const t=this.readPercentage(e);i.opacity=1-t,this.debugMessage("  Transparency : "+t),i.transparent=i.opacity<1}else n===Dl?(this.debugMessage("   ColorMap"),this.resetPosition(e),i.map=this.readMap(e,t)):n===kl?(this.debugMessage("   BumpMap"),this.resetPosition(e),i.bumpMap=this.readMap(e,t)):n===Nl?(this.debugMessage("   OpacityMap"),this.resetPosition(e),i.alphaMap=this.readMap(e,t)):n===Ol?(this.debugMessage("   SpecularMap"),this.resetPosition(e),i.specularMap=this.readMap(e,t)):this.debugMessage("   Unknown material chunk: "+n.toString(16));n=this.nextChunk(e,r)}this.endChunk(r),this.materials[i.name]=i}readMesh(e){const t=this.readChunk(e);let r=this.nextChunk(e,t);const n=new a.BufferGeometry,i=new a.MeshPhongMaterial,o=new a.Mesh(n,i);for(o.name="mesh";0!==r;){if(r===Zl){const t=this.readWord(e);this.debugMessage("   Vertex: "+t);const r=[];for(let n=0;n<t;n++)r.push(this.readFloat(e)),r.push(this.readFloat(e)),r.push(this.readFloat(e));n.setAttribute("position",new a.Float32BufferAttribute(r,3))}else if(r===Xl)this.resetPosition(e),this.readFaceArray(e,o);else if(r===Jl){const t=this.readWord(e);this.debugMessage("   UV: "+t);const r=[];for(let n=0;n<t;n++)r.push(this.readFloat(e)),r.push(this.readFloat(e));n.setAttribute("uv",new a.Float32BufferAttribute(r,2))}else if(r===ql){this.debugMessage("   Tranformation Matrix (TODO)");const t=[];for(let n=0;n<12;n++)t[n]=this.readFloat(e);const r=new a.Matrix4;r.elements[0]=t[0],r.elements[1]=t[6],r.elements[2]=t[3],r.elements[3]=t[9],r.elements[4]=t[2],r.elements[5]=t[8],r.elements[6]=t[5],r.elements[7]=t[11],r.elements[8]=t[1],r.elements[9]=t[7],r.elements[10]=t[4],r.elements[11]=t[10],r.elements[12]=0,r.elements[13]=0,r.elements[14]=0,r.elements[15]=1,r.transpose();const i=new a.Matrix4;i.copy(r).invert(),n.applyMatrix4(i),r.decompose(o.position,o.quaternion,o.scale)}else this.debugMessage("   Unknown mesh chunk: "+r.toString(16));r=this.nextChunk(e,t)}return this.endChunk(t),n.computeVertexNormals(),o}readFaceArray(e,t){const r=this.readChunk(e),n=this.readWord(e);this.debugMessage("   Faces: "+n);const i=[];for(let s=0;s<n;++s)i.push(this.readWord(e),this.readWord(e),this.readWord(e)),this.readWord(e);t.geometry.setIndex(i);let o=0,a=0;for(;this.position<r.end;){const r=this.readChunk(e);if(r.id===Yl){this.debugMessage("      Material Group"),this.resetPosition(e);const r=this.readMaterialGroup(e),n=3*r.index.length;t.geometry.addGroup(a,n,o),a+=n,o++;const i=this.materials[r.name];!1===Array.isArray(t.material)&&(t.material=[]),void 0!==i&&t.material.push(i)}else this.debugMessage("      Unknown face array chunk: "+r.toString(16));this.endChunk(r)}1===t.material.length&&(t.material=t.material[0]),this.endChunk(r)}readMap(e,t){const r=this.readChunk(e);let n=this.nextChunk(e,r),i={};const o=new a.TextureLoader(this.manager);for(o.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);0!==n;){if(n===Ul){const r=this.readString(e,128);i=o.load(r),this.debugMessage("      File: "+t+r)}else n===Gl?(i.offset.x=this.readFloat(e),this.debugMessage("      OffsetX: "+i.offset.x)):n===zl?(i.offset.y=this.readFloat(e),this.debugMessage("      OffsetY: "+i.offset.y)):n===Ql?(i.repeat.x=this.readFloat(e),this.debugMessage("      RepeatX: "+i.repeat.x)):n===Vl?(i.repeat.y=this.readFloat(e),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+n.toString(16));n=this.nextChunk(e,r)}return this.endChunk(r),i}readMaterialGroup(e){this.readChunk(e);const t=this.readString(e,64),r=this.readWord(e);this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+r);const n=[];for(let i=0;i<r;++i)n.push(this.readWord(e));return{name:t,index:n}}readColor(e){const t=this.readChunk(e),r=new a.Color;if(t.id===gl||t.id===Al){const t=this.readByte(e),n=this.readByte(e),i=this.readByte(e);r.setRGB(t/255,n/255,i/255),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else if(t.id===ml||t.id===vl){const t=this.readFloat(e),n=this.readFloat(e),i=this.readFloat(e);r.setRGB(t,n,i),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else this.debugMessage("      Unknown color chunk: "+t.toString(16));return this.endChunk(t),r}readChunk(e){const t={};return t.cur=this.position,t.id=this.readWord(e),t.size=this.readDWord(e),t.end=t.cur+t.size,t.cur+=6,t}endChunk(e){this.position=e.end}nextChunk(e,t){if(t.cur>=t.end)return 0;this.position=t.cur;try{const r=this.readChunk(e);return t.cur+=r.size,r.id}catch(r){return this.debugMessage("Unable to read chunk at "+this.position),0}}resetPosition(){this.position-=6}readByte(e){const t=e.getUint8(this.position,!0);return this.position+=1,t}readFloat(e){try{const t=e.getFloat32(this.position,!0);return this.position+=4,t}catch(t){this.debugMessage(t+" "+this.position+" "+e.byteLength)}}readInt(e){const t=e.getInt32(this.position,!0);return this.position+=4,t}readShort(e){const t=e.getInt16(this.position,!0);return this.position+=2,t}readDWord(e){const t=e.getUint32(this.position,!0);return this.position+=4,t}readWord(e){const t=e.getUint16(this.position,!0);return this.position+=2,t}readString(e,t){let r="";for(let n=0;n<t;n++){const t=this.readByte(e);if(!t)break;r+=String.fromCharCode(t)}return r}readPercentage(e){const t=this.readChunk(e);let r;switch(t.id){case yl:r=this.readShort(e)/100;break;case xl:r=this.readFloat(e);break;default:this.debugMessage("      Unknown percentage chunk: "+t.toString(16))}return this.endChunk(t),r}debugMessage(e){this.debug&&console.log(e)}}const hl=19789,dl=15786,fl=49725,pl=2,ml=16,gl=17,Al=18,vl=19,yl=48,xl=49,bl=15677,wl=15678,Cl=256,El=45055,Sl=40960,Tl=40976,Ml=40992,Il=41008,Bl=41024,_l=41040,Fl=41089,Pl=41091,Rl=41093,Ll=41095,Dl=41472,Nl=41488,kl=41520,Ol=41476,Ul=41728,Ql=41812,Vl=41814,Gl=41816,zl=41818,Hl=16384,Wl=16640,Zl=16656,Xl=16672,Yl=16688,Jl=16704,ql=16736,Kl="16",$l="24",ec=new a.Vector3,tc=new a.Vector3;class rc extends a.ShaderMaterial{constructor(e){super({uniforms:a.UniformsUtils.merge([a.UniformsLib.fog,{diffuse:{value:new a.Color},opacity:{value:1}}]),vertexShader:"\n        attribute vec3 control0;\n        attribute vec3 control1;\n        attribute vec3 direction;\n        varying float discardFlag;\n\n        #include <common>\n        #include <color_pars_vertex>\n        #include <fog_pars_vertex>\n        #include <logdepthbuf_pars_vertex>\n        #include <clipping_planes_pars_vertex>\n\n        void main() {\n          #include <color_vertex>\n\n          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n          gl_Position = projectionMatrix * mvPosition;\n\n          // Transform the line segment ends and control points into camera clip space\n          vec4 c0 = projectionMatrix * modelViewMatrix * vec4(control0, 1.0);\n          vec4 c1 = projectionMatrix * modelViewMatrix * vec4(control1, 1.0);\n          vec4 p0 = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          vec4 p1 = projectionMatrix * modelViewMatrix * vec4(position + direction, 1.0);\n\n          c0.xy /= c0.w;\n          c1.xy /= c1.w;\n          p0.xy /= p0.w;\n          p1.xy /= p1.w;\n\n          // Get the direction of the segment and an orthogonal vector\n          vec2 dir = p1.xy - p0.xy;\n          vec2 norm = vec2(-dir.y, dir.x);\n\n          // Get control point directions from the line\n          vec2 c0dir = c0.xy - p1.xy;\n          vec2 c1dir = c1.xy - p1.xy;\n\n          // If the vectors to the controls points are pointed in different directions away\n          // from the line segment then the line should not be drawn.\n          float d0 = dot(normalize(norm), normalize(c0dir));\n          float d1 = dot(normalize(norm), normalize(c1dir));\n          discardFlag = float(sign(d0) != sign(d1));\n\n          #include <logdepthbuf_vertex>\n          #include <clipping_planes_vertex>\n          #include <fog_vertex>\n        }\n      ",fragmentShader:"\n        uniform vec3 diffuse;\n        uniform float opacity;\n        varying float discardFlag;\n\n        #include <common>\n        #include <color_pars_fragment>\n        #include <fog_pars_fragment>\n        #include <logdepthbuf_pars_fragment>\n        #include <clipping_planes_pars_fragment>\n\n        void main() {\n          if (discardFlag > 0.5) discard;\n\n          #include <clipping_planes_fragment>\n          vec3 outgoingLight = vec3(0.0);\n          vec4 diffuseColor = vec4(diffuse, opacity);\n          #include <logdepthbuf_fragment>\n          #include <color_fragment>\n          outgoingLight = diffuseColor.rgb; // simple shader\n          gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n          #include <tonemapping_fragment>\n          #include <encodings_fragment>\n          #include <fog_fragment>\n          #include <premultiplied_alpha_fragment>\n        }\n      "}),Object.defineProperties(this,{opacity:{get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},color:{get:function(){return this.uniforms.diffuse.value}}}),this.setValues(e),this.isLDrawConditionalLineMaterial=!0}}class nc extends a.LineSegments{constructor(e,t){super(e,t),this.isConditionalLine=!0}}const ic=new a.Ray;function oc(e){return"Part"===e||"Unofficial_Part"===e}class ac{constructor(e,t){this.line=e,this.lineLength=e.length,this.currentCharIndex=0,this.currentChar=" ",this.lineNumber=t}seekNonSpace(){for(;this.currentCharIndex<this.lineLength;){if(this.currentChar=this.line.charAt(this.currentCharIndex)," "!==this.currentChar&&"\t"!==this.currentChar)return;this.currentCharIndex++}}getToken(){const e=this.currentCharIndex++;for(;this.currentCharIndex<this.lineLength&&(this.currentChar=this.line.charAt(this.currentCharIndex)," "!==this.currentChar&&"\t"!==this.currentChar);)this.currentCharIndex++;const t=this.currentCharIndex;return this.seekNonSpace(),this.line.substring(e,t)}getVector(){return new a.Vector3(parseFloat(this.getToken()),parseFloat(this.getToken()),parseFloat(this.getToken()))}getRemainingString(){return this.line.substring(this.currentCharIndex,this.lineLength)}isAtTheEnd(){return this.currentCharIndex>=this.lineLength}setToEnd(){this.currentCharIndex=this.lineLength}getLineNumberString(){return this.lineNumber>=0?" at line "+this.lineNumber:""}}class sc{constructor(e){this.loader=e,this._cache={}}cloneResult(e){const t={};return t.faces=e.faces.map((e=>({colorCode:e.colorCode,material:e.material,vertices:e.vertices.map((e=>e.clone())),normals:e.normals.map((()=>null)),faceNormal:null}))),t.conditionalSegments=e.conditionalSegments.map((e=>({colorCode:e.colorCode,material:e.material,vertices:e.vertices.map((e=>e.clone())),controlPoints:e.controlPoints.map((e=>e.clone()))}))),t.lineSegments=e.lineSegments.map((e=>({colorCode:e.colorCode,material:e.material,vertices:e.vertices.map((e=>e.clone()))}))),t.type=e.type,t.category=e.category,t.keywords=e.keywords,t.subobjects=e.subobjects,t.totalFaces=e.totalFaces,t.startingConstructionStep=e.startingConstructionStep,t.materials=e.materials,t.group=null,t}async fetchData(e){let t=!1,r=0;for(;6!==r;){let n=e;switch(r){case 0:r+=1;break;case 1:n="parts/"+n,r+=1;break;case 2:n="p/"+n,r+=1;break;case 3:n="models/"+n,r+=1;break;case 4:n=e.substring(0,e.lastIndexOf("/")+1)+n,r+=1;break;case 5:t?r=6:(n=e=e.toLowerCase(),t=!0,r=0)}const i=this.loader,o=new a.FileLoader(i.manager);o.setPath(i.partsLibraryPath),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials);try{return await o.loadAsync(n)}catch{continue}}throw new Error('LDrawLoader: Subobject "'+e+'" could not be loaded.')}parse(e,t=null){const r=this.loader,n=[],i=[],o=[],s=[],l={},c=e=>l[e]||null;let u="Model",h=null,d=null,f=0;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n"));const p=e.split("\n"),m=p.length;let g=!1,A=null,v=null,y=!1,x=!0,b=!1,w=!0,C=!1;for(let E=0;E<m;E++){const e=p[E];if(0===e.length)continue;if(g){e.startsWith("0 FILE ")?(this.setData(A,v),A=e.substring(7),v=""):v+=e+"\n";continue}const t=new ac(e,E+1);if(t.seekNonSpace(),t.isAtTheEnd())continue;const m=t.getToken();let S,T,M,I,B,_,F,P,R,L,D;switch(m){case"0":const e=t.getToken();if(e)switch(e){case"!LDRAW_ORG":u=t.getToken();break;case"!COLOUR":S=r.parseColorMetaDirective(t),S?l[S.userData.code]=S:console.warn("LDrawLoader: Error parsing material"+t.getLineNumberString());break;case"!CATEGORY":h=t.getToken();break;case"!KEYWORDS":const e=t.getRemainingString().split(",");e.length>0&&(d||(d=[]),e.forEach((function(e){d.push(e.trim())})));break;case"FILE":E>0&&(g=!0,A=t.getRemainingString(),v="",y=!1,x=!0);break;case"BFC":for(;!t.isAtTheEnd();){const e=t.getToken();switch(e){case"CERTIFY":case"NOCERTIFY":y="CERTIFY"===e,x=!0;break;case"CW":case"CCW":x="CCW"===e;break;case"INVERTNEXT":b=!0;break;case"CLIP":case"NOCLIP":w="CLIP"===e;break;default:console.warn('THREE.LDrawLoader: BFC directive "'+e+'" is unknown.')}}break;case"STEP":C=!0}break;case"1":T=t.getToken(),S=c(T);const p=parseFloat(t.getToken()),N=parseFloat(t.getToken()),k=parseFloat(t.getToken()),O=parseFloat(t.getToken()),U=parseFloat(t.getToken()),Q=parseFloat(t.getToken()),V=parseFloat(t.getToken()),G=parseFloat(t.getToken()),z=parseFloat(t.getToken()),j=parseFloat(t.getToken()),H=parseFloat(t.getToken()),W=parseFloat(t.getToken()),Z=(new a.Matrix4).set(O,U,Q,p,V,G,z,N,j,H,W,k,0,0,0,1);let X=t.getRemainingString().trim().replace(/\\/g,"/");r.fileMap[X]?X=r.fileMap[X]:X.startsWith("s/")?X="parts/"+X:X.startsWith("48/")&&(X="p/"+X),s.push({material:S,colorCode:T,matrix:Z,fileName:X,inverted:b,startingConstructionStep:C}),b=!1;break;case"2":T=t.getToken(),S=c(T),_=t.getVector(),F=t.getVector(),M={material:S,colorCode:T,vertices:[_,F]},i.push(M);break;case"5":T=t.getToken(),S=c(T),_=t.getVector(),F=t.getVector(),L=t.getVector(),D=t.getVector(),M={material:S,colorCode:T,vertices:[_,F],controlPoints:[L,D]},o.push(M);break;case"3":T=t.getToken(),S=c(T),I=x,B=!y||!w,!0===I?(_=t.getVector(),F=t.getVector(),P=t.getVector()):(P=t.getVector(),F=t.getVector(),_=t.getVector()),n.push({material:S,colorCode:T,faceNormal:null,vertices:[_,F,P],normals:[null,null,null]}),f++,!0===B&&(n.push({material:S,colorCode:T,faceNormal:null,vertices:[P,F,_],normals:[null,null,null]}),f++);break;case"4":T=t.getToken(),S=c(T),I=x,B=!y||!w,!0===I?(_=t.getVector(),F=t.getVector(),P=t.getVector(),R=t.getVector()):(R=t.getVector(),P=t.getVector(),F=t.getVector(),_=t.getVector()),n.push({material:S,colorCode:T,faceNormal:null,vertices:[_,F,P,R],normals:[null,null,null,null]}),f+=2,!0===B&&(n.push({material:S,colorCode:T,faceNormal:null,vertices:[R,P,F,_],normals:[null,null,null,null]}),f+=2);break;default:throw new Error('LDrawLoader: Unknown line type "'+m+'"'+t.getLineNumberString()+".")}}return g&&this.setData(A,v),{faces:n,conditionalSegments:o,lineSegments:i,type:u,category:h,keywords:d,subobjects:s,totalFaces:f,startingConstructionStep:C,materials:l,fileName:t,group:null}}getData(e,t=!0){const r=e.toLowerCase(),n=this._cache[r];return null===n||n instanceof Promise?null:t?this.cloneResult(n):n}async ensureDataLoaded(e){const t=e.toLowerCase();t in this._cache||(this._cache[t]=this.fetchData(e).then((r=>{const n=this.parse(r,e);return this._cache[t]=n,n}))),await this._cache[t]}setData(e,t){const r=e.toLowerCase();this._cache[r]=this.parse(t,e)}}function lc(e,t,r,n){return(!n&&e===Kl||n&&e===$l)&&(e=t),r[e]||null}class cc{constructor(e){this.loader=e,this.parseCache=new sc(e),this._cache={}}async processIntoMesh(e){const t=this.loader,r=this.parseCache,n=new Set,i=async(e,o=null)=>{const s=e.subobjects,l=[];for(let t=0,n=s.length;t<n;t++){const e=s[t],n=r.ensureDataLoaded(e.fileName).then((()=>{const t=r.getData(e.fileName,!1);return n=t.type,/primitive/i.test(n)||"Subpart"===n?i(r.getData(e.fileName),e):this.loadModel(e.fileName).catch((e=>(console.warn(e),null)));var n}));l.push(n)}const c=new a.Group;c.userData.category=e.category,c.userData.keywords=e.keywords,e.group=c;const u=await Promise.all(l);for(let r=0,i=u.length;r<i;r++){const i=e.subobjects[r],o=u[r];if(null===o)continue;if(o.isGroup){const r=o;i.matrix.decompose(r.position,r.quaternion,r.scale),r.userData.startingConstructionStep=i.startingConstructionStep,r.name=i.fileName,t.applyMaterialsToMesh(r,i.colorCode,e.materials),c.add(r);continue}o.group.children.length&&c.add(o.group);const a=e.lineSegments,s=e.conditionalSegments,l=e.faces,h=o.lineSegments,d=o.conditionalSegments,f=o.faces,p=i.matrix,m=i.inverted,g=p.determinant()<0,A=i.colorCode,v=A===Kl?$l:A;for(let t=0,r=h.length;t<r;t++){const r=h[t],n=r.vertices;n[0].applyMatrix4(p),n[1].applyMatrix4(p),r.colorCode=r.colorCode===$l?v:r.colorCode,r.material=r.material||lc(r.colorCode,r.colorCode,e.materials,!0),a.push(r)}for(let t=0,r=d.length;t<r;t++){const r=d[t],n=r.vertices,i=r.controlPoints;n[0].applyMatrix4(p),n[1].applyMatrix4(p),i[0].applyMatrix4(p),i[1].applyMatrix4(p),r.colorCode=r.colorCode===$l?v:r.colorCode,r.material=r.material||lc(r.colorCode,r.colorCode,e.materials,!0),s.push(r)}for(let t=0,r=f.length;t<r;t++){const r=f[t],i=r.vertices;for(let e=0,t=i.length;e<t;e++)i[e].applyMatrix4(p);r.colorCode=r.colorCode===Kl?A:r.colorCode,r.material=r.material||lc(r.colorCode,A,e.materials,!1),n.add(r.colorCode),g!==m&&i.reverse(),l.push(r)}e.totalFaces+=o.totalFaces}return o&&t.applyMaterialsToMesh(c,o.colorCode,e.materials),e};for(let a=0,s=e.faces;a<s;a++)n.add(e.faces[a].colorCode);if(await i(e),t.smoothNormals){const t=n.size>1;!function(e){for(let t=0,r=e.length;t<r;t++){const r=e[t],n=r.vertices,i=n[0],o=n[1],s=n[2];ec.subVectors(o,i),tc.subVectors(s,o),r.faceNormal=(new a.Vector3).crossVectors(ec,tc).normalize()}}(e.faces),function(e,t,r=!1){const n=100*(1+1e-10);function i(e){return`${~~(e.x*n)},${~~(e.y*n)},${~~(e.z*n)}`}function o(e,t){return`${i(e)}_${i(t)}`}function s(e,t,r){r.direction.subVectors(t,e).normalize();const n=e.dot(r.direction);return r.origin.copy(e).addScaledVector(r.direction,-n),r}function l(e){return o(e.origin,e.direction)}const c=new Set,u=new Map,h={},d=[];for(let f=0,p=t.length;f<p;f++){const e=t[f].vertices,n=e[0],i=e[1];if(c.add(o(n,i)),c.add(o(i,n)),r){const e=s(n,i,new a.Ray),t=l(e);if(!u.has(t)){s(i,n,e);const r=l(e),o={ray:e,distances:[]};u.set(t,o),u.set(r,o)}const r=u.get(t);let o=r.ray.direction.dot(n),c=r.ray.direction.dot(i);o>c&&([o,c]=[c,o]),r.distances.push(o,c)}}for(let a=0,f=e.length;a<f;a++){const t=e[a],n=t.vertices,i=n.length;for(let e=0;e<i;e++){const a=e,d=(e+1)%i,f=n[a],p=n[d],m=o(f,p);if(c.has(m))continue;if(r){s(f,p,ic);const e=l(ic);if(u.has(e)){const t=u.get(e),{ray:r,distances:n}=t;let i=r.direction.dot(f),o=r.direction.dot(p);i>o&&([i,o]=[o,i]);let a=!1;for(let e=0,s=n.length;e<s;e+=2)if(i>=n[e]&&o<=n[e+1]){a=!0;break}if(a)continue}}const g={index:a,tri:t};h[m]=g}}for(;;){let e=null;for(const r in h){e=h[r];break}if(null===e)break;const t=[e];for(;t.length>0;){const e=t.pop().tri,r=e.vertices,n=e.normals,i=e.faceNormal,s=r.length;for(let l=0;l<s;l++){const c=l,u=(l+1)%s,f=r[c],p=r[u];delete h[o(f,p)];const m=o(p,f),g=h[m];if(g){const r=g.tri,o=g.index,s=r.normals,l=s.length,f=r.faceNormal;if(Math.abs(r.faceNormal.dot(e.faceNormal))<.25)continue;m in h&&(t.push(g),delete h[m]);const p=(o+1)%l;n[c]&&s[p]&&n[c]!==s[p]&&(s[p].norm.add(n[c].norm),n[c].norm=s[p].norm);let A=n[c]||s[p];null===A&&(A={norm:new a.Vector3},d.push(A.norm)),null===n[c]&&(n[c]=A,A.norm.add(i)),null===s[p]&&(s[p]=A,A.norm.add(f)),n[u]&&s[o]&&n[u]!==s[o]&&(s[o].norm.add(n[u].norm),n[u].norm=s[o].norm);let v=n[u]||s[o];null===v&&(v={norm:new a.Vector3},d.push(v.norm)),null===n[u]&&(n[u]=v,v.norm.add(i)),null===s[o]&&(s[o]=v,v.norm.add(f))}}}}for(let a=0,f=d.length;a<f;a++)d[a].normalize()}(e.faces,e.lineSegments,t)}const o=e.group;return e.faces.length>0&&o.add(hc(e.faces,3,!1,e.totalFaces)),e.lineSegments.length>0&&o.add(hc(e.lineSegments,2)),e.conditionalSegments.length>0&&o.add(hc(e.conditionalSegments,2,!0)),o}hasCachedModel(e){return null!==e&&e.toLowerCase()in this._cache}async getCachedModel(e){if(null!==e&&this.hasCachedModel(e)){const t=e.toLowerCase();return(await this._cache[t]).clone()}return null}async loadModel(e){const t=this.parseCache,r=e.toLowerCase();if(this.hasCachedModel(e))return this.getCachedModel(e);{await t.ensureDataLoaded(e);const n=t.getData(e),i=this.processIntoMesh(n);if(this.hasCachedModel(e))return this.getCachedModel(e);oc(n.type)&&(this._cache[r]=i);return(await i).clone()}}async parseModel(e){const t=this.parseCache.parse(e);return oc(t.type)&&this.hasCachedModel(t.fileName)?this.getCachedModel(t.fileName):this.processIntoMesh(t)}}function uc(e,t){return e.colorCode===t.colorCode?0:e.colorCode<t.colorCode?-1:1}function hc(e,t,r=!1,n=null){e.sort(uc),null===n&&(n=e.length);const i=new Float32Array(t*n*3),o=3===t?new Float32Array(t*n*3):null,s=[],l=new Array(6),c=new a.BufferGeometry;let u=null,h=0,d=0,f=0;for(let m=0,g=e.length;m<g;m++){const n=e[m];let p=n.vertices;4===p.length&&(l[0]=p[0],l[1]=p[1],l[2]=p[2],l[3]=p[0],l[4]=p[2],l[5]=p[3],p=l);for(let e=0,t=p.length;e<t;e++){const t=p[e],r=f+3*e;i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.z}if(3===t){if(!n.faceNormal){const e=p[0],t=p[1],r=p[2];ec.subVectors(t,e),tc.subVectors(r,t),n.faceNormal=(new a.Vector3).crossVectors(ec,tc).normalize()}let e=n.normals;4===e.length&&(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[0],l[4]=e[2],l[5]=e[3],e=l);for(let t=0,r=e.length;t<r;t++){let r=n.faceNormal;e[t]&&(r=e[t].norm);const i=f+3*t;o[i+0]=r.x,o[i+1]=r.y,o[i+2]=r.z}}if(u!==n.colorCode){null!==u&&c.addGroup(h,d,s.length-1);const e=n.material;null!==e?3===t?s.push(e):2===t&&(null!==e?r?s.push(e.userData.edgeMaterial.userData.conditionalEdgeMaterial):s.push(e.userData.edgeMaterial):s.push(null)):s.push(n.colorCode),u=n.colorCode,h=f/3,d=p.length}else d+=p.length;f+=3*p.length}d>0&&c.addGroup(h,1/0,s.length-1),c.setAttribute("position",new a.BufferAttribute(i,3)),null!==o&&c.setAttribute("normal",new a.BufferAttribute(o,3));let p=null;if(2===t?p=r?new nc(c,1===s.length?s[0]:s):new a.LineSegments(c,1===s.length?s[0]:s):3===t&&(p=new a.Mesh(c,1===s.length?s[0]:s)),r){p.isConditionalLine=!0;const t=new Float32Array(3*e.length*2),r=new Float32Array(3*e.length*2),n=new Float32Array(3*e.length*2);for(let i=0,o=e.length;i<o;i++){const o=e[i],a=o.vertices,s=o.controlPoints,l=s[0],c=s[1],u=a[0],h=a[1],d=3*i*2;t[d+0]=l.x,t[d+1]=l.y,t[d+2]=l.z,t[d+3]=l.x,t[d+4]=l.y,t[d+5]=l.z,r[d+0]=c.x,r[d+1]=c.y,r[d+2]=c.z,r[d+3]=c.x,r[d+4]=c.y,r[d+5]=c.z,n[d+0]=h.x-u.x,n[d+1]=h.y-u.y,n[d+2]=h.z-u.z,n[d+3]=h.x-u.x,n[d+4]=h.y-u.y,n[d+5]=h.z-u.z}c.setAttribute("control0",new a.BufferAttribute(t,3,!1)),c.setAttribute("control1",new a.BufferAttribute(r,3,!1)),c.setAttribute("direction",new a.BufferAttribute(n,3,!1))}return p}class dc extends a.Loader{constructor(e){super(e),this.materials=[],this.materialLibrary={},this.partsCache=new cc(this),this.fileMap={},this.setMaterials([]),this.smoothNormals=!0,this.partsLibraryPath=""}setPartsLibraryPath(e){return this.partsLibraryPath=e,this}async preloadMaterials(e){const t=new a.FileLoader(this.manager);t.setPath(this.path),t.setRequestHeader(this.requestHeader),t.setWithCredentials(this.withCredentials);const r=/^0 !COLOUR/,n=(await t.loadAsync(e)).split(/[\n\r]/g),i=[];for(let o=0,a=n.length;o<a;o++){const e=n[o];if(r.test(e)){const t=e.replace(r,""),n=this.parseColorMetaDirective(new ac(t));i.push(n)}}this.setMaterials(i)}load(e,t,r,n){const i=new a.FileLoader(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(e=>{this.partsCache.parseModel(e,this.materialLibrary).then((e=>{this.applyMaterialsToMesh(e,Kl,this.materialLibrary,!0),this.computeConstructionSteps(e),t(e)})).catch(n)}),r,n)}parse(e,t){this.partsCache.parseModel(e,this.materialLibrary).then((e=>{this.computeConstructionSteps(e),t(e)}))}setMaterials(e){this.materialLibrary={},this.materials=[];for(let t=0,r=e.length;t<r;t++)this.addMaterial(e[t]);return this.addMaterial(this.parseColorMetaDirective(new ac("Main_Colour CODE 16 VALUE #FF8080 EDGE #333333"))),this.addMaterial(this.parseColorMetaDirective(new ac("Edge_Colour CODE 24 VALUE #A0A0A0 EDGE #333333"))),this}setFileMap(e){return this.fileMap=e,this}addMaterial(e){const t=this.materialLibrary;return t[e.userData.code]||(this.materials.push(e),t[e.userData.code]=e),this}getMaterial(e){if(e.startsWith("0x2")){const t=e.substring(3);return this.parseColorMetaDirective(new ac("Direct_Color_"+t+" CODE -1 VALUE #"+t+" EDGE #"+t))}return this.materialLibrary[e]||null}applyMaterialsToMesh(e,t,r,n=!1){const i=this,o=t===Kl;function a(e,a){if(o&&!(a in r)&&!n)return a;const s=e.isLineSegments||e.isConditionalLine;(!s&&a===Kl||s&&a===$l)&&(a=t);let l=null;if(a in r)l=r[a];else{if(!n)return a;if(l=i.getMaterial(a),null===l)throw new Error(`LDrawLoader: Material properties for code ${a} not available.`)}return e.isLineSegments&&(l=l.userData.edgeMaterial,e.isConditionalLine&&(l=l.userData.conditionalEdgeMaterial)),l}e.traverse((e=>{if(e.isMesh||e.isLineSegments)if(Array.isArray(e.material))for(let t=0,r=e.material.length;t<r;t++)e.material[t].isMaterial||(e.material[t]=a(e,e.material[t]));else e.material.isMaterial||(e.material=a(e,e.material))}))}getMainMaterial(){return this.getMaterial(Kl)}getMainEdgeMaterial(){return this.getMaterial($l)}parseColorMetaDirective(e){let t=null,r=16711935,n=16711935,i=1,o=!1,s=0,l=0,c=null;const u=e.getToken();if(!u)throw new Error('LDrawLoader: Material name was expected after "!COLOUR tag'+e.getLineNumberString()+".");let h=null;for(;h=e.getToken(),h;)switch(h.toUpperCase()){case"CODE":t=e.getToken();break;case"VALUE":if(r=e.getToken(),r.startsWith("0x"))r="#"+r.substring(2);else if(!r.startsWith("#"))throw new Error("LDrawLoader: Invalid color while parsing material"+e.getLineNumberString()+".");break;case"EDGE":if(n=e.getToken(),n.startsWith("0x"))n="#"+n.substring(2);else if(!n.startsWith("#")){if(c=this.getMaterial(n),!c)throw new Error("LDrawLoader: Invalid edge color while parsing material"+e.getLineNumberString()+".");c=c.userData.edgeMaterial}break;case"ALPHA":if(i=parseInt(e.getToken()),isNaN(i))throw new Error("LDrawLoader: Invalid alpha value in material definition"+e.getLineNumberString()+".");i=Math.max(0,Math.min(1,i/255)),i<1&&(o=!0);break;case"LUMINANCE":if(s=parseInt(e.getToken()),isNaN(s))throw new Error("LDrawLoader: Invalid luminance value in material definition"+ac.getLineNumberString()+".");s=Math.max(0,Math.min(1,s/255));break;case"CHROME":l=1;break;case"PEARLESCENT":l=2;break;case"RUBBER":l=3;break;case"MATTE_METALLIC":l=4;break;case"METAL":l=5;break;case"MATERIAL":e.setToEnd();break;default:throw new Error('LDrawLoader: Unknown token "'+h+'" while parsing material'+e.getLineNumberString()+".")}let d=null;switch(l){case 0:d=new a.MeshStandardMaterial({color:r,roughness:.3,metalness:0});break;case 2:d=new a.MeshStandardMaterial({color:r,roughness:.3,metalness:.25});break;case 1:d=new a.MeshStandardMaterial({color:r,roughness:0,metalness:1});break;case 3:d=new a.MeshStandardMaterial({color:r,roughness:.9,metalness:0});break;case 4:d=new a.MeshStandardMaterial({color:r,roughness:.8,metalness:.4});break;case 5:d=new a.MeshStandardMaterial({color:r,roughness:.2,metalness:.85})}return d.transparent=o,d.premultipliedAlpha=!0,d.opacity=i,d.depthWrite=!o,d.polygonOffset=!0,d.polygonOffsetFactor=1,0!==s&&d.emissive.set(d.color).multiplyScalar(s),c||(c=new a.LineBasicMaterial({color:n,transparent:o,opacity:i,depthWrite:!o}),c.userData.code=t,c.name=u+" - Edge",c.userData.conditionalEdgeMaterial=new rc({fog:!0,transparent:o,depthWrite:!o,color:n,opacity:i})),d.userData.code=t,d.name=u,d.userData.edgeMaterial=c,this.addMaterial(d),d}computeConstructionSteps(e){let t=0;e.traverse((e=>{e.isGroup&&(e.userData.startingConstructionStep&&t++,e.userData.constructionStep=t)})),e.userData.numConstructionSteps=t+1}}function fc(e){this.IFF=e}function pc(e){this.IFF=e}function mc(){this.debugger=new Ac}function gc(e){this.dv=new DataView(e),this.offset=0}function Ac(){this.active=!1,this.depth=0,this.formList=[]}function vc(e){return e%2}function yc(e){return e.length+1+(vc(e.length+1)?1:0)}fc.prototype={constructor:fc,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"STCK":case"VALU":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NCRD":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"VERS":case"ENUM":case"TAG ":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"GLOW":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var n=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(n<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.currentSurface.attributes.imageMapIndex=this.IFF.reader.getUint32();break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},pc.prototype={constructor:pc,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(t>this.IFF.reader.dv.byteLength-this.IFF.reader.offset&&(this.IFF.reader.offset-=4,t=this.IFF.reader.getUint16()),this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"AUVO":case"STCK":case"PROC":case"VALU":case"FUNC":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NVSK":case"NCRD":case"WRPW":case"WRPH":case"NMOD":case"NPRW":case"NPLA":case"NODS":case"VERS":case"ENUM":case"TAG ":case"OPAC":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"GLOW":case"GVAL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"SURF":this.IFF.parseSurfaceLwo2(t);break;case"CLIP":this.IFF.parseClipLwo2(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"AUVU":case"AUVN":this.IFF.reader.skip(t-1),this.IFF.reader.getVariableLengthIndex();break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var n=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(n<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.reader.skip(2);break;case"TMAP":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;case"BLOK":break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},mc.prototype={constructor:mc,parse:function(e){if(this.reader=new gc(e),this.tree={materials:{},layers:[],tags:[],textures:[]},this.currentLayer=this.tree,this.currentForm=this.tree,this.parseTopForm(),void 0!==this.tree.format){if("LWO2"===this.tree.format)for(this.parser=new pc(this);!this.reader.endOfFile();)this.parser.parseBlock();else if("LWO3"===this.tree.format)for(this.parser=new fc(this);!this.reader.endOfFile();)this.parser.parseBlock();return this.debugger.offset=this.reader.offset,this.debugger.closeForms(),this.tree}},parseTopForm(){if(this.debugger.offset=this.reader.offset,"FORM"===this.reader.getIDTag()){var e=this.reader.getUint32();this.debugger.dataOffset=this.reader.offset,this.debugger.length=e;var t=this.reader.getIDTag();("LWO2"===t||"LWO3"===t)&&(this.tree.format=t),this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()}else console.warn("LWOLoader: Top-level FORM missing.")},parseForm(e){var t=this.reader.getIDTag();switch(t){case"ISEQ":case"ANIM":case"STCC":case"VPVL":case"VPRM":case"NROT":case"WRPW":case"WRPH":case"FUNC":case"FALL":case"OPAC":case"GRAD":case"ENVS":case"VMOP":case"VMBG":case"OMAX":case"STEX":case"CKBG":case"CKEY":case"VMLA":case"VMLB":this.debugger.skipped=!0,this.skipForm(e);break;case"META":case"NNDS":case"NODS":case"NDTA":case"ADAT":case"AOVS":case"BLOK":case"IBGC":case"IOPC":case"IIMG":case"TXTR":this.debugger.length=4,this.debugger.skipped=!0;break;case"IFAL":case"ISCL":case"IPOS":case"IROT":case"IBMP":case"IUTD":case"IVTD":this.parseTextureNodeAttribute(t);break;case"ENVL":this.parseEnvelope(e);break;case"CLIP":"LWO2"===this.tree.format?this.parseForm(e):this.parseClip(e);break;case"STIL":this.parseImage();break;case"XREF":this.reader.skip(8),this.currentForm.referenceTexture={index:this.reader.getUint32(),refName:this.reader.getString()};break;case"IMST":this.parseImageStateForm(e);break;case"SURF":this.parseSurfaceForm(e);break;case"VALU":this.parseValueForm(e);break;case"NTAG":this.parseSubNode(e);break;case"ATTR":case"SATR":this.setupForm("attributes",e);break;case"NCON":this.parseConnections(e);break;case"SSHA":this.parentForm=this.currentForm,this.currentForm=this.currentSurface,this.setupForm("surfaceShader",e);break;case"SSHD":this.setupForm("surfaceShaderData",e);break;case"ENTR":this.parseEntryForm(e);break;case"IMAP":this.parseImageMap(e);break;case"TAMP":this.parseXVAL("amplitude",e);break;case"TMAP":this.setupForm("textureMap",e);break;case"CNTR":this.parseXVAL3("center",e);break;case"SIZE":this.parseXVAL3("scale",e);break;case"ROTA":this.parseXVAL3("rotation",e);break;default:this.parseUnknownForm(t,e)}this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()},setupForm(e,t){this.currentForm||(this.currentForm=this.currentNode),this.currentFormEnd=this.reader.offset+t,this.parentForm=this.currentForm,this.currentForm[e]?(console.warn("LWOLoader: form already exists on parent: ",e,this.currentForm),this.currentForm=this.currentForm[e]):(this.currentForm[e]={},this.currentForm=this.currentForm[e])},skipForm(e){this.reader.skip(e-4)},parseUnknownForm(e,t){var r,n,i;console.warn("LWOLoader: unknown FORM encountered: "+e,t),r=this.reader.dv.buffer,n=this.reader.offset,i=t-4,console.log(a.LoaderUtils.decodeText(new Uint8Array(r,n,i))),this.reader.skip(t-4)},parseSurfaceForm(e){this.reader.skip(8);var t=this.reader.getString(),r={attributes:{},connections:{},name:t,inputName:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSurfaceLwo2(e){var t=this.reader.getString(),r={attributes:{},connections:{},name:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSubNode(e){this.reader.skip(8);var t={name:this.reader.getString()};this.currentForm=t,this.currentNode=t,this.currentFormEnd=this.reader.offset+e},parseConnections(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm=this.currentSurface.connections},parseEntryForm(e){this.reader.skip(8);var t=this.reader.getString();this.currentForm=this.currentNode.attributes,this.setupForm(t,e)},parseValueForm(){this.reader.skip(8);var e=this.reader.getString();"double"===e?this.currentForm.value=this.reader.getUint64():"int"===e?this.currentForm.value=this.reader.getUint32():"vparam"===e?(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64()):"vparam3"===e&&(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64Array(3))},parseImageStateForm(){this.reader.skip(8),this.currentForm.mipMapLevel=this.reader.getFloat32()},parseImageMap(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm.maps||(this.currentForm.maps=[]);var t={};this.currentForm.maps.push(t),this.currentForm=t,this.reader.skip(10)},parseTextureNodeAttribute(e){switch(this.reader.skip(28),this.reader.skip(20),e){case"ISCL":this.currentNode.scale=this.reader.getFloat32Array(3);break;case"IPOS":this.currentNode.position=this.reader.getFloat32Array(3);break;case"IROT":this.currentNode.rotation=this.reader.getFloat32Array(3);break;case"IFAL":this.currentNode.falloff=this.reader.getFloat32Array(3);break;case"IBMP":this.currentNode.amplitude=this.reader.getFloat32();break;case"IUTD":this.currentNode.uTiles=this.reader.getFloat32();break;case"IVTD":this.currentNode.vTiles=this.reader.getFloat32()}this.reader.skip(2)},parseEnvelope(e){this.reader.skip(e-4)},parseClip(e){if("FORM"===this.reader.getIDTag())return this.reader.skip(16),void(this.currentNode.fileName=this.reader.getString());this.reader.setOffset(this.reader.offset-4),this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.reader.skip(8);var t={index:this.reader.getUint32()};this.tree.textures.push(t),this.currentForm=t},parseClipLwo2(e){for(var t={index:this.reader.getUint32(),fileName:""};;){var r=this.reader.getIDTag(),n=this.reader.getUint16();if("STIL"===r){t.fileName=this.reader.getString();break}if(n>=e)break}this.tree.textures.push(t),this.currentForm=t},parseImage(){this.reader.skip(8),this.currentForm.fileName=this.reader.getString()},parseXVAL(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]=this.reader.getFloat32(),this.reader.setOffset(r)},parseXVAL3(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]={x:this.reader.getFloat32(),y:this.reader.getFloat32(),z:this.reader.getFloat32()},this.reader.setOffset(r)},parseObjectTag(){this.tree.objectTags||(this.tree.objectTags={}),this.tree.objectTags[this.reader.getIDTag()]={tagString:this.reader.getString()}},parseLayer(e){var t={number:this.reader.getUint16(),flags:this.reader.getUint16(),pivot:this.reader.getFloat32Array(3),name:this.reader.getString()};this.tree.layers.push(t),this.currentLayer=t;var r=16+yc(this.currentLayer.name);this.currentLayer.parent=r<e?this.reader.getUint16():-1},parsePoints(e){this.currentPoints=[];for(let t=0;t<e/4;t+=3)this.currentPoints.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32())},parseVertexMapping(e,t){var r=this.reader.offset+e,n=this.reader.getString();if(this.reader.offset!==r){this.reader.setOffset(this.reader.offset-yc(n));var i=this.reader.getIDTag();this.reader.getUint16();var o=this.reader.getString(),a=e-6-yc(o);switch(i){case"TXUV":this.parseUVMapping(o,r,t);break;case"MORF":case"SPOT":this.parseMorphTargets(o,r,i);break;case"APSL":case"NORM":case"WGHT":case"MNVW":case"PICK":case"RGB ":case"RGBA":this.reader.skip(a);break;default:console.warn("LWOLoader: unknown vertex map type: "+i),this.reader.skip(a)}}else this.currentForm.UVChannel=n},parseUVMapping(e,t,r){for(var n=[],i=[],o=[];this.reader.offset<t;)n.push(this.reader.getVariableLengthIndex()),r&&i.push(this.reader.getVariableLengthIndex()),o.push(this.reader.getFloat32(),this.reader.getFloat32());r?(this.currentLayer.discontinuousUVs||(this.currentLayer.discontinuousUVs={}),this.currentLayer.discontinuousUVs[e]={uvIndices:n,polyIndices:i,uvs:o}):(this.currentLayer.uvs||(this.currentLayer.uvs={}),this.currentLayer.uvs[e]={uvIndices:n,uvs:o})},parseMorphTargets(e,t,r){var n=[],i=[];for(r="MORF"===r?"relative":"absolute";this.reader.offset<t;)n.push(this.reader.getVariableLengthIndex()),i.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32());this.currentLayer.morphTargets||(this.currentLayer.morphTargets={}),this.currentLayer.morphTargets[e]={indices:n,points:i,type:r}},parsePolygonList(e){for(var t=this.reader.offset+e,r=this.reader.getIDTag(),n=[],i=[];this.reader.offset<t;){var o=this.reader.getUint16();o&=1023,i.push(o);for(let e=0;e<o;e++)n.push(this.reader.getVariableLengthIndex())}var a={type:r,vertexIndices:n,polygonDimensions:i,points:this.currentPoints};1===i[0]?a.type="points":2===i[0]&&(a.type="lines"),this.currentLayer.geometry=a},parseTagStrings(e){this.tree.tags=this.reader.getStringArray(e)},parsePolygonTagMapping(e){var t=this.reader.offset+e;"SURF"===this.reader.getIDTag()?this.parseMaterialIndices(t):this.reader.skip(e-4)},parseMaterialIndices(e){for(this.currentLayer.geometry.materialIndices=[];this.reader.offset<e;){var t=this.reader.getVariableLengthIndex(),r=this.reader.getUint16();this.currentLayer.geometry.materialIndices.push(t,r)}},parseUnknownCHUNK(e,t){console.warn("LWOLoader: unknown chunk type: "+e+" length: "+t);var r=this.reader.getString(t);this.currentForm[e]=r}},gc.prototype={constructor:gc,size:function(){return this.dv.buffer.byteLength},setOffset(e){e>0&&e<this.dv.buffer.byteLength?this.offset=e:console.error("LWOLoader: invalid buffer offset")},endOfFile:function(){return this.offset>=this.size()},skip:function(e){this.offset+=e},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint16:function(){var e=this.dv.getUint16(this.offset);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,!1);return this.offset+=4,e},getUint32:function(){var e=this.dv.getUint32(this.offset,!1);return this.offset+=4,e},getUint64:function(){return 4294967296*this.getUint32()+this.getUint32()},getFloat32:function(){var e=this.dv.getFloat32(this.offset,!1);return this.offset+=4,e},getFloat32Array:function(e){var t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){var t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t},getVariableLengthIndex(){var e=this.getUint8();return 255===e?65536*this.getUint8()+256*this.getUint8()+this.getUint8():256*e+this.getUint8()},getIDTag(){return this.getString(4)},getString:function(e){if(0!==e){var t=[];if(e)for(let r=0;r<e;r++)t[r]=this.getUint8();else{for(var r,n=0;0!==r;)0!==(r=this.getUint8())&&t.push(r),n++;vc(n+1)||this.getUint8()}return a.LoaderUtils.decodeText(new Uint8Array(t))}},getStringArray:function(e){var t=this.getString(e);return(t=t.split("\0")).filter(Boolean)}},Ac.prototype={constructor:Ac,enable:function(){this.active=!0},log:function(){if(this.active){var e;switch(this.node){case 0:e="FORM";break;case 1:e="CHK";break;case 2:e="S-CHK"}console.log("| ".repeat(this.depth)+e,this.nodeID,`( ${this.offset} ) -> ( ${this.dataOffset+this.length} )`,0==this.node?" {":"",this.skipped?"SKIPPED":"",0==this.node&&this.skipped?"}":""),0!=this.node||this.skipped||(this.depth+=1,this.formList.push(this.dataOffset+this.length)),this.skipped=!1}},closeForms:function(){if(this.active)for(let e=this.formList.length-1;e>=0;e--)this.offset>=this.formList[e]&&(this.depth-=1,console.log("| ".repeat(this.depth)+"}"),this.formList.splice(-1,1))}};class xc extends a.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){const t=this;function r(e,t,r,i,o,a,s,l){if(0==t||0==r)return void e.lineTo(l.x,l.y);i=i*Math.PI/180,t=Math.abs(t),r=Math.abs(r);const c=(s.x-l.x)/2,u=(s.y-l.y)/2,h=Math.cos(i)*c+Math.sin(i)*u,d=-Math.sin(i)*c+Math.cos(i)*u;let f=t*t,p=r*r;const m=h*h,g=d*d,A=m/f+g/p;if(A>1){const e=Math.sqrt(A);f=(t*=e)*t,p=(r*=e)*r}const v=f*g+p*m,y=(f*p-v)/v;let x=Math.sqrt(Math.max(0,y));o===a&&(x=-x);const b=x*t*d/r,w=-x*r*h/t,C=Math.cos(i)*b-Math.sin(i)*w+(s.x+l.x)/2,E=Math.sin(i)*b+Math.cos(i)*w+(s.y+l.y)/2,S=n(1,0,(h-b)/t,(d-w)/r),T=n((h-b)/t,(d-w)/r,(-h-b)/t,(-d-w)/r)%(2*Math.PI);e.currentPath.absellipse(C,E,t,r,S,S+T,0===a,i)}function n(e,t,r,n){const i=e*r+t*n,o=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+n*n);let a=Math.acos(Math.max(-1,Math.min(1,i/o)));return e*n-t*r<0&&(a=-a),a}function i(e,t){t=Object.assign({},t);let r={};if(e.hasAttribute("class")){const t=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim()));for(let e=0;e<t.length;e++)r=Object.assign(r,p["."+t[e]])}function n(n,i,o){void 0===o&&(o=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(n)&&(t[i]=o(e.getAttribute(n))),r[n]&&(t[i]=o(r[n])),e.style&&""!==e.style[n]&&(t[i]=o(e.style[n]))}function i(e){return Math.max(0,Math.min(1,u(e)))}function o(e){return Math.max(0,u(e))}return e.hasAttribute("id")&&(r=Object.assign(r,p["#"+e.getAttribute("id")])),n("fill","fill"),n("fill-opacity","fillOpacity",i),n("fill-rule","fillRule"),n("opacity","opacity",i),n("stroke","stroke"),n("stroke-opacity","strokeOpacity",i),n("stroke-width","strokeWidth",o),n("stroke-linejoin","strokeLineJoin"),n("stroke-linecap","strokeLineCap"),n("stroke-miterlimit","strokeMiterLimit",o),n("visibility","visibility"),t}function o(e,t){return e-(t-e)}function s(e,t,r){if("string"!==typeof e)throw new TypeError("Invalid input: "+typeof e);const n={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let i=0,o=!0,a="",s="";const l=[];function c(e,t,r){const n=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw n.partial=r,n}function u(){""!==a&&(""===s?l.push(Number(a)):l.push(Number(a)*Math.pow(10,Number(s)))),a="",s=""}let h;const d=e.length;for(let f=0;f<d;f++)if(h=e[f],Array.isArray(t)&&t.includes(l.length%r)&&n.FLAGS.test(h))i=1,a=h,u();else{if(0===i){if(n.WHITESPACE.test(h))continue;if(n.DIGIT.test(h)||n.SIGN.test(h)){i=1,a=h;continue}if(n.POINT.test(h)){i=2,a=h;continue}n.COMMA.test(h)&&(o&&c(h,f,l),o=!0)}if(1===i){if(n.DIGIT.test(h)){a+=h;continue}if(n.POINT.test(h)){a+=h,i=2;continue}if(n.EXP.test(h)){i=3;continue}n.SIGN.test(h)&&1===a.length&&n.SIGN.test(a[0])&&c(h,f,l)}if(2===i){if(n.DIGIT.test(h)){a+=h;continue}if(n.EXP.test(h)){i=3;continue}n.POINT.test(h)&&"."===a[a.length-1]&&c(h,f,l)}if(3===i){if(n.DIGIT.test(h)){s+=h;continue}if(n.SIGN.test(h)){if(""===s){s+=h;continue}1===s.length&&n.SIGN.test(s)&&c(h,f,l)}}n.WHITESPACE.test(h)?(u(),i=0,o=!1):n.COMMA.test(h)?(u(),i=0,o=!0):n.SIGN.test(h)?(u(),i=1,a=h):n.POINT.test(h)?(u(),i=2,a=h):c(h,f,l)}return u(),l}const l=["mm","cm","in","pt","pc","px"],c={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function u(e){let r,n="px";if("string"===typeof e||e instanceof String)for(let t=0,i=l.length;t<i;t++){const r=l[t];if(e.endsWith(r)){n=r,e=e.substring(0,e.length-r.length);break}}return"px"===n&&"px"!==t.defaultUnit?r=c.in[t.defaultUnit]/t.defaultDPI:(r=c[n][t.defaultUnit],r<0&&(r=c[n].in*t.defaultDPI)),r*parseFloat(e)}function h(e){const t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function d(e){const t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}const f=[],p={},m=[],g=new a.Matrix3,A=new a.Matrix3,v=new a.Matrix3,y=new a.Matrix3,x=new a.Vector2,b=new a.Vector3,w=new a.Matrix3,C=(new DOMParser).parseFromString(e,"image/svg+xml");!function e(t,n){if(1!==t.nodeType)return;const l=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;const t=function(e){const t=new a.Matrix3,r=g;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){const r=u(e.getAttribute("x")),n=u(e.getAttribute("y"));t.translate(r,n)}if(e.hasAttribute("transform")){const n=e.getAttribute("transform").split(")");for(let e=n.length-1;e>=0;e--){const i=n[e].trim();if(""===i)continue;const o=i.indexOf("("),a=i.length;if(o>0&&o<a){const e=i.substr(0,o),t=s(i.substr(o+1,a-o-1));switch(r.identity(),e){case"translate":if(t.length>=1){const e=t[0];let n=e;t.length>=2&&(n=t[1]),r.translate(e,n)}break;case"rotate":if(t.length>=1){let e=0,n=0,i=0;e=-t[0]*Math.PI/180,t.length>=3&&(n=t[1],i=t[2]),A.identity().translate(-n,-i),v.identity().rotate(e),y.multiplyMatrices(v,A),A.identity().translate(n,i),r.multiplyMatrices(A,y)}break;case"scale":if(t.length>=1){const e=t[0];let n=e;t.length>=2&&(n=t[1]),r.scale(e,n)}break;case"skewX":1===t.length&&r.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&r.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&r.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(r)}}return t}(e);m.length>0&&t.premultiply(m[m.length-1]);return w.copy(t),m.push(t),t}(t);let c=!0,C=null;switch(t.nodeName){case"svg":break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(let t=0;t<e.sheet.cssRules.length;t++){const r=e.sheet.cssRules[t];if(1!==r.type)continue;const n=r.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim()));for(let e=0;e<n.length;e++)p[n[e]]=Object.assign(p[n[e]]||{},r.style)}}(t);break;case"g":n=i(t,n);break;case"path":n=i(t,n),t.hasAttribute("d")&&(C=function(e){const t=new a.ShapePath,n=new a.Vector2,i=new a.Vector2,l=new a.Vector2;let c=!0,u=!1;const h=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi);for(let a=0,d=h.length;a<d;a++){const e=h[a],d=e.charAt(0),f=e.substr(1).trim();let p;switch(!0===c&&(u=!0,c=!1),d){case"M":p=s(f);for(let e=0,r=p.length;e<r;e+=2)n.x=p[e+0],n.y=p[e+1],i.x=n.x,i.y=n.y,0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===e&&l.copy(n);break;case"H":p=s(f);for(let e=0,r=p.length;e<r;e++)n.x=p[e],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===u&&l.copy(n);break;case"V":p=s(f);for(let e=0,r=p.length;e<r;e++)n.y=p[e],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===u&&l.copy(n);break;case"L":p=s(f);for(let e=0,r=p.length;e<r;e+=2)n.x=p[e+0],n.y=p[e+1],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===u&&l.copy(n);break;case"C":p=s(f);for(let e=0,r=p.length;e<r;e+=6)t.bezierCurveTo(p[e+0],p[e+1],p[e+2],p[e+3],p[e+4],p[e+5]),i.x=p[e+2],i.y=p[e+3],n.x=p[e+4],n.y=p[e+5],0===e&&!0===u&&l.copy(n);break;case"S":p=s(f);for(let e=0,r=p.length;e<r;e+=4)t.bezierCurveTo(o(n.x,i.x),o(n.y,i.y),p[e+0],p[e+1],p[e+2],p[e+3]),i.x=p[e+0],i.y=p[e+1],n.x=p[e+2],n.y=p[e+3],0===e&&!0===u&&l.copy(n);break;case"Q":p=s(f);for(let e=0,r=p.length;e<r;e+=4)t.quadraticCurveTo(p[e+0],p[e+1],p[e+2],p[e+3]),i.x=p[e+0],i.y=p[e+1],n.x=p[e+2],n.y=p[e+3],0===e&&!0===u&&l.copy(n);break;case"T":p=s(f);for(let e=0,r=p.length;e<r;e+=2){const r=o(n.x,i.x),a=o(n.y,i.y);t.quadraticCurveTo(r,a,p[e+0],p[e+1]),i.x=r,i.y=a,n.x=p[e+0],n.y=p[e+1],0===e&&!0===u&&l.copy(n)}break;case"A":p=s(f,[3,4],7);for(let e=0,o=p.length;e<o;e+=7){if(p[e+5]==n.x&&p[e+6]==n.y)continue;const o=n.clone();n.x=p[e+5],n.y=p[e+6],i.x=n.x,i.y=n.y,r(t,p[e],p[e+1],p[e+2],p[e+3],p[e+4],o,n),0===e&&!0===u&&l.copy(n)}break;case"m":p=s(f);for(let e=0,r=p.length;e<r;e+=2)n.x+=p[e+0],n.y+=p[e+1],i.x=n.x,i.y=n.y,0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===e&&l.copy(n);break;case"h":p=s(f);for(let e=0,r=p.length;e<r;e++)n.x+=p[e],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===u&&l.copy(n);break;case"v":p=s(f);for(let e=0,r=p.length;e<r;e++)n.y+=p[e],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===u&&l.copy(n);break;case"l":p=s(f);for(let e=0,r=p.length;e<r;e+=2)n.x+=p[e+0],n.y+=p[e+1],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===u&&l.copy(n);break;case"c":p=s(f);for(let e=0,r=p.length;e<r;e+=6)t.bezierCurveTo(n.x+p[e+0],n.y+p[e+1],n.x+p[e+2],n.y+p[e+3],n.x+p[e+4],n.y+p[e+5]),i.x=n.x+p[e+2],i.y=n.y+p[e+3],n.x+=p[e+4],n.y+=p[e+5],0===e&&!0===u&&l.copy(n);break;case"s":p=s(f);for(let e=0,r=p.length;e<r;e+=4)t.bezierCurveTo(o(n.x,i.x),o(n.y,i.y),n.x+p[e+0],n.y+p[e+1],n.x+p[e+2],n.y+p[e+3]),i.x=n.x+p[e+0],i.y=n.y+p[e+1],n.x+=p[e+2],n.y+=p[e+3],0===e&&!0===u&&l.copy(n);break;case"q":p=s(f);for(let e=0,r=p.length;e<r;e+=4)t.quadraticCurveTo(n.x+p[e+0],n.y+p[e+1],n.x+p[e+2],n.y+p[e+3]),i.x=n.x+p[e+0],i.y=n.y+p[e+1],n.x+=p[e+2],n.y+=p[e+3],0===e&&!0===u&&l.copy(n);break;case"t":p=s(f);for(let e=0,r=p.length;e<r;e+=2){const r=o(n.x,i.x),a=o(n.y,i.y);t.quadraticCurveTo(r,a,n.x+p[e+0],n.y+p[e+1]),i.x=r,i.y=a,n.x=n.x+p[e+0],n.y=n.y+p[e+1],0===e&&!0===u&&l.copy(n)}break;case"a":p=s(f,[3,4],7);for(let e=0,o=p.length;e<o;e+=7){if(0==p[e+5]&&0==p[e+6])continue;const o=n.clone();n.x+=p[e+5],n.y+=p[e+6],i.x=n.x,i.y=n.y,r(t,p[e],p[e+1],p[e+2],p[e+3],p[e+4],o,n),0===e&&!0===u&&l.copy(n)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(n.copy(l),t.currentPath.currentPoint.copy(n),c=!0);break;default:console.warn(e)}u=!1}return t}(t));break;case"rect":n=i(t,n),C=function(e){const t=u(e.getAttribute("x")||0),r=u(e.getAttribute("y")||0),n=u(e.getAttribute("rx")||e.getAttribute("ry")||0),i=u(e.getAttribute("ry")||e.getAttribute("rx")||0),o=u(e.getAttribute("width")),s=u(e.getAttribute("height")),l=.448084975506,c=new a.ShapePath;c.moveTo(t+n,r),c.lineTo(t+o-n,r),(0!==n||0!==i)&&c.bezierCurveTo(t+o-n*l,r,t+o,r+i*l,t+o,r+i);c.lineTo(t+o,r+s-i),(0!==n||0!==i)&&c.bezierCurveTo(t+o,r+s-i*l,t+o-n*l,r+s,t+o-n,r+s);c.lineTo(t+n,r+s),(0!==n||0!==i)&&c.bezierCurveTo(t+n*l,r+s,t,r+s-i*l,t,r+s-i);c.lineTo(t,r+i),(0!==n||0!==i)&&c.bezierCurveTo(t,r+i*l,t+n*l,r,t+n,r);return c}(t);break;case"polygon":n=i(t,n),C=function(e){function t(e,t,r){const o=u(t),a=u(r);0===i?n.moveTo(o,a):n.lineTo(o,a),i++}const r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,n=new a.ShapePath;let i=0;return e.getAttribute("points").replace(r,t),n.currentPath.autoClose=!0,n}(t);break;case"polyline":n=i(t,n),C=function(e){function t(e,t,r){const o=u(t),a=u(r);0===i?n.moveTo(o,a):n.lineTo(o,a),i++}const r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,n=new a.ShapePath;let i=0;return e.getAttribute("points").replace(r,t),n.currentPath.autoClose=!1,n}(t);break;case"circle":n=i(t,n),C=function(e){const t=u(e.getAttribute("cx")||0),r=u(e.getAttribute("cy")||0),n=u(e.getAttribute("r")||0),i=new a.Path;i.absarc(t,r,n,0,2*Math.PI);const o=new a.ShapePath;return o.subPaths.push(i),o}(t);break;case"ellipse":n=i(t,n),C=function(e){const t=u(e.getAttribute("cx")||0),r=u(e.getAttribute("cy")||0),n=u(e.getAttribute("rx")||0),i=u(e.getAttribute("ry")||0),o=new a.Path;o.absellipse(t,r,n,i,0,2*Math.PI);const s=new a.ShapePath;return s.subPaths.push(o),s}(t);break;case"line":n=i(t,n),C=function(e){const t=u(e.getAttribute("x1")||0),r=u(e.getAttribute("y1")||0),n=u(e.getAttribute("x2")||0),i=u(e.getAttribute("y2")||0),o=new a.ShapePath;return o.moveTo(t,r),o.lineTo(n,i),o.currentPath.autoClose=!1,o}(t);break;case"defs":c=!1;break;case"use":n=i(t,n);const l=t.href.baseVal.substring(1),h=t.viewportElement.getElementById(l);h?e(h,n):console.warn("SVGLoader: 'use node' references non-existent node id: "+l)}if(C&&(void 0!==n.fill&&"none"!==n.fill&&C.color.setStyle(n.fill),function(e,t){function r(e){b.set(e.x,e.y,1).applyMatrix3(t),e.set(b.x,b.y)}const n=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),i=e.subPaths;for(let o=0,a=i.length;o<a;o++){const e=i[o].curves;for(let i=0;i<e.length;i++){const o=e[i];o.isLineCurve?(r(o.v1),r(o.v2)):o.isCubicBezierCurve?(r(o.v0),r(o.v1),r(o.v2),r(o.v3)):o.isQuadraticBezierCurve?(r(o.v0),r(o.v1),r(o.v2)):o.isEllipseCurve&&(n&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),x.set(o.aX,o.aY),r(x),o.aX=x.x,o.aY=x.y,o.xRadius*=h(t),o.yRadius*=d(t))}}}(C,w),f.push(C),C.userData={node:t,style:n}),c){const r=t.childNodes;for(let t=0;t<r.length;t++)e(r[t],n)}l&&(m.pop(),m.length>0?w.copy(m[m.length-1]):w.identity())}(C.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});return{paths:f,xml:C.documentElement}}static createShapes(e){const t=999999999,r=0,n=1,i=2,o=3,s=4,l=5,c=6,u={loc:r,t:0};function h(e,t,n,o){const a=e.x,s=t.x,l=n.x,c=o.x,h=e.y,f=t.y,p=n.y,m=o.y,g=(c-l)*(h-p)-(m-p)*(a-l),A=(m-p)*(s-a)-(c-l)*(f-h),v=g/A,y=((s-a)*(h-p)-(f-h)*(a-l))/A;if(0===A&&0!==g||v<=0||v>=1||y<0||y>1)return null;if(0===g&&0===A){for(let l=0;l<2;l++){if(d(0===l?n:o,e,t),u.loc==r){const e=0===l?n:o;return{x:e.x,y:e.y,t:u.t}}if(u.loc==i){return{x:+(a+u.t*(s-a)).toPrecision(10),y:+(h+u.t*(f-h)).toPrecision(10),t:u.t}}}return null}for(let i=0;i<2;i++)if(d(0===i?n:o,e,t),u.loc==r){const e=0===i?n:o;return{x:e.x,y:e.y,t:u.t}}return{x:+(a+v*(s-a)).toPrecision(10),y:+(h+v*(f-h)).toPrecision(10),t:v}}function d(e,t,a){const h=a.x-t.x,d=a.y-t.y,f=e.x-t.x,p=e.y-t.y,m=h*p-f*d;if(e.x===t.x&&e.y===t.y)return u.loc=r,void(u.t=0);if(e.x===a.x&&e.y===a.y)return u.loc=n,void(u.t=1);if(m<-Number.EPSILON)return void(u.loc=o);if(m>Number.EPSILON)return void(u.loc=s);if(h*f<0||d*p<0)return void(u.loc=l);if(Math.sqrt(h*h+d*d)<Math.sqrt(f*f+p*p))return void(u.loc=c);let g;g=0!==h?f/h:p/d,u.loc=i,u.t=g}function f(e,t,r){const n=new a.Vector2;t.getCenter(n);const i=[];return r.forEach((t=>{if(t.boundingBox.containsPoint(n)){(function(e,t){const r=[],n=[];for(let i=1;i<e.length;i++){const o=e[i-1],s=e[i];for(let e=1;e<t.length;e++){const i=h(o,s,t[e-1],t[e]);null!==i&&void 0===r.find((e=>e.t<=i.t+Number.EPSILON&&e.t>=i.t-Number.EPSILON))&&(r.push(i),n.push(new a.Vector2(i.x,i.y)))}}return n})(e,t.points).forEach((e=>{i.push({identifier:t.identifier,isCW:t.isCW,point:e})}))}})),i.sort(((e,t)=>e.point.x-t.point.x)),i}let p=0,m=t,g=-999999999,A=e.subPaths.map((e=>{const r=e.getPoints();let n=-999999999,i=t,o=-999999999,s=t;for(let t=0;t<r.length;t++){const e=r[t];e.y>n&&(n=e.y),e.y<i&&(i=e.y),e.x>o&&(o=e.x),e.x<s&&(s=e.x)}return g<=o&&(g=o+1),m>=s&&(m=s-1),{curves:e.curves,points:r,isCW:a.ShapeUtils.isClockWise(r),identifier:p++,boundingBox:new a.Box2(new a.Vector2(s,i),new a.Vector2(o,n))}}));A=A.filter((e=>e.points.length>1));const v=A.map((t=>function(e,t,r,n,i){null!==i&&void 0!==i&&""!==i||(i="nonzero");const o=new a.Vector2;e.boundingBox.getCenter(o);const s=f([new a.Vector2(r,o.y),new a.Vector2(n,o.y)],e.boundingBox,t);s.sort(((e,t)=>e.point.x-t.point.x));const l=[],c=[];s.forEach((t=>{t.identifier===e.identifier?l.push(t):c.push(t)}));const u=l[0].point.x,h=[];let d=0;for(;d<c.length&&c[d].point.x<u;)h.length>0&&h[h.length-1]===c[d].identifier?h.pop():h.push(c[d].identifier),d++;if(h.push(e.identifier),"evenodd"===i){const t=h.length%2===0,r=h[h.length-2];return{identifier:e.identifier,isHole:t,for:r}}if("nonzero"===i){let r=!0,n=null,i=null;for(let e=0;e<h.length;e++){const o=h[e];r?(i=t[o].isCW,r=!1,n=o):i!==t[o].isCW&&(i=t[o].isCW,r=!0)}return{identifier:e.identifier,isHole:r,for:n}}console.warn('fill-rule: "'+i+'" is currently not implemented.')}(t,A,m,g,e.userData.style.fillRule))),y=[];return A.forEach((e=>{if(!v[e.identifier].isHole){const t=new a.Shape;t.curves=e.curves;v.filter((t=>t.isHole&&t.for===e.identifier)).forEach((e=>{const r=A[e.identifier],n=new a.Path;n.curves=r.curves,t.holes.push(n)})),y.push(t)}})),y}static getStrokeStyle(e,t,r,n,i){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:i=void 0!==i?i:4}}static pointsToStroke(e,t,r,n){const i=[],o=[],s=[];if(0===xc.pointsToStrokeWithBuffers(e,t,r,n,i,o,s))return null;const l=new a.BufferGeometry;return l.setAttribute("position",new a.Float32BufferAttribute(i,3)),l.setAttribute("normal",new a.Float32BufferAttribute(o,3)),l.setAttribute("uv",new a.Float32BufferAttribute(s,2)),l}static pointsToStrokeWithBuffers(e,t,r,n,i,o,s,l){const c=new a.Vector2,u=new a.Vector2,h=new a.Vector2,d=new a.Vector2,f=new a.Vector2,p=new a.Vector2,m=new a.Vector2,g=new a.Vector2,A=new a.Vector2,v=new a.Vector2,y=new a.Vector2,x=new a.Vector2,b=new a.Vector2,w=new a.Vector2,C=new a.Vector2,E=new a.Vector2,S=new a.Vector2;r=void 0!==r?r:12,n=void 0!==n?n:.001,l=void 0!==l?l:0;const T=(e=function(e){let t=!1;for(let i=1,o=e.length-1;i<o;i++)if(e[i].distanceTo(e[i+1])<n){t=!0;break}if(!t)return e;const r=[];r.push(e[0]);for(let i=1,o=e.length-1;i<o;i++)e[i].distanceTo(e[i+1])>=n&&r.push(e[i]);return r.push(e[e.length-1]),r}(e)).length;if(T<2)return 0;const M=e[0].equals(e[T-1]);let I,B,_=e[0];const F=t.strokeWidth/2,P=1/(T-1);let R,L,D,N,k=0,O=!1,U=0,Q=3*l,V=2*l;G(e[0],e[1],c).multiplyScalar(F),g.copy(e[0]).sub(c),A.copy(e[0]).add(c),v.copy(g),y.copy(A);for(let a=1;a<T;a++){I=e[a],B=a===T-1?M?e[1]:void 0:e[a+1];const r=c;if(G(_,I,r),h.copy(r).multiplyScalar(F),x.copy(I).sub(h),b.copy(I).add(h),R=k+P,L=!1,void 0!==B){G(I,B,u),h.copy(u).multiplyScalar(F),w.copy(I).sub(h),C.copy(I).add(h),D=!0,h.subVectors(B,_),r.dot(h)<0&&(D=!1),1===a&&(O=D),h.subVectors(B,I),h.normalize();const e=Math.abs(r.dot(h));if(0!==e){const r=F/e;h.multiplyScalar(-r),d.subVectors(I,_),f.copy(d).setLength(r).add(h),E.copy(f).negate();const n=f.length(),i=d.length();d.divideScalar(i),p.subVectors(B,I);const o=p.length();switch(p.divideScalar(o),d.dot(E)<i&&p.dot(E)<o&&(L=!0),S.copy(f).add(I),E.add(I),N=!1,L?D?(C.copy(E),b.copy(E)):(w.copy(E),x.copy(E)):H(),t.strokeLineJoin){case"bevel":W(D,L,R);break;case"round":Z(D,L),D?j(I,x,w,R,0):j(I,C,b,R,1);break;case"miter":case"miter-clip":default:const e=F*t.strokeMiterLimit/n;if(e<1){if("miter-clip"!==t.strokeLineJoin){W(D,L,R);break}Z(D,L),D?(p.subVectors(S,x).multiplyScalar(e).add(x),m.subVectors(S,w).multiplyScalar(e).add(w),z(x,R,0),z(p,R,0),z(I,R,.5),z(I,R,.5),z(p,R,0),z(m,R,0),z(I,R,.5),z(m,R,0),z(w,R,0)):(p.subVectors(S,b).multiplyScalar(e).add(b),m.subVectors(S,C).multiplyScalar(e).add(C),z(b,R,1),z(p,R,1),z(I,R,.5),z(I,R,.5),z(p,R,1),z(m,R,1),z(I,R,.5),z(m,R,1),z(C,R,1))}else L?(D?(z(A,k,1),z(g,k,0),z(S,R,0),z(A,k,1),z(S,R,0),z(E,R,1)):(z(A,k,1),z(g,k,0),z(S,R,1),z(g,k,0),z(E,R,0),z(S,R,1)),D?w.copy(S):C.copy(S)):D?(z(x,R,0),z(S,R,0),z(I,R,.5),z(I,R,.5),z(S,R,0),z(w,R,0)):(z(b,R,1),z(S,R,1),z(I,R,.5),z(I,R,.5),z(S,R,1),z(C,R,1)),N=!0}}else H()}else H();M||a!==T-1||X(e[0],v,y,D,!0,k),k=R,_=I,g.copy(w),A.copy(C)}if(M){if(L&&i){let e=S,t=E;O!==D&&(e=E,t=S),D?(N||O)&&(t.toArray(i,0),t.toArray(i,9),N&&e.toArray(i,3)):!N&&O||(t.toArray(i,3),t.toArray(i,9),N&&e.toArray(i,0))}}else X(I,x,b,D,!1,R);return U;function G(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function z(e,t,r){i&&(i[Q]=e.x,i[Q+1]=e.y,i[Q+2]=0,o&&(o[Q]=0,o[Q+1]=0,o[Q+2]=1),Q+=3,s&&(s[V]=t,s[V+1]=r,V+=2)),U+=3}function j(e,t,n,i,o){c.copy(t).sub(e).normalize(),u.copy(n).sub(e).normalize();let a=Math.PI;const s=c.dot(u);Math.abs(s)<1&&(a=Math.abs(Math.acos(s))),a/=r,h.copy(t);for(let l=0,c=r-1;l<c;l++)d.copy(h).rotateAround(e,a),z(h,i,o),z(d,i,o),z(e,i,.5),h.copy(d);z(d,i,o),z(n,i,o),z(e,i,.5)}function H(){z(A,k,1),z(g,k,0),z(x,R,0),z(A,k,1),z(x,R,1),z(b,R,0)}function W(e,t,r){t?e?(z(A,k,1),z(g,k,0),z(x,R,0),z(A,k,1),z(x,R,0),z(E,R,1),z(x,r,0),z(w,r,0),z(E,r,.5)):(z(A,k,1),z(g,k,0),z(b,R,1),z(g,k,0),z(E,R,0),z(b,R,1),z(b,r,1),z(C,r,0),z(E,r,.5)):e?(z(x,r,0),z(w,r,0),z(I,r,.5)):(z(b,r,1),z(C,r,0),z(I,r,.5))}function Z(e,t){t&&(e?(z(A,k,1),z(g,k,0),z(x,R,0),z(A,k,1),z(x,R,0),z(E,R,1),z(x,k,0),z(I,R,.5),z(E,R,1),z(I,R,.5),z(w,k,0),z(E,R,1)):(z(A,k,1),z(g,k,0),z(b,R,1),z(g,k,0),z(E,R,0),z(b,R,1),z(b,k,1),z(E,R,0),z(I,R,.5),z(I,R,.5),z(E,R,0),z(C,k,1)))}function X(e,r,n,o,a,s){switch(t.strokeLineCap){case"round":a?j(e,n,r,s,.5):j(e,r,n,s,.5);break;case"square":if(a)c.subVectors(r,e),u.set(c.y,-c.x),h.addVectors(c,u).add(e),d.subVectors(u,c).add(e),o?(h.toArray(i,3),d.toArray(i,0),d.toArray(i,9)):(h.toArray(i,3),h.toArray(i,9),d.toArray(i,0));else{c.subVectors(n,e),u.set(c.y,-c.x),h.addVectors(c,u).add(e),d.subVectors(u,c).add(e);const t=i.length;o?(h.toArray(i,t-3),d.toArray(i,t-6),d.toArray(i,t-12)):(h.toArray(i,t-6),d.toArray(i,t-3),d.toArray(i,t-12))}}}}}const bc=new WeakMap;class wc extends a.Loader{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,n){const i=new a.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),this.url=e,i.load(e,(r=>{if(bc.has(r)){return bc.get(r).promise.then(t).catch(n)}this.decodeObjects(r,e).then(t).catch(n)}),r,n)}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}decodeObjects(e,t){let r,n;const i=e.byteLength,o=this._getWorker(i).then((t=>(r=t,n=this.workerNextTaskID++,new Promise(((t,i)=>{r._callbacks[n]={resolve:t,reject:i},r.postMessage({type:"decode",id:n,buffer:e},[e])}))))).then((e=>this._createGeometry(e.data)));return o.catch((()=>!0)).then((()=>{r&&n&&this._releaseTask(r,n)})),bc.set(e,{url:t,promise:o}),o}parse(e,t,r){this.decodeObjects(e,"").then(t).catch(r)}_compareMaterials(e){const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;for(let r=0;r<this.materials.length;r++){const e=this.materials[r],n={};if(n.name=e.name,n.color={},n.color.r=e.color.r,n.color.g=e.color.g,n.color.b=e.color.b,n.type=e.type,JSON.stringify(t)===JSON.stringify(n))return e}return this.materials.push(e),e}_createMaterial(e){if(void 0===e)return new a.MeshStandardMaterial({color:new a.Color(1,1,1),metalness:.8,name:"default",side:2});const t=e.diffuseColor,r=new a.Color(t.r/255,t.g/255,t.b/255);0===t.r&&0===t.g&&0===t.b&&(r.r=1,r.g=1,r.b=1);const n=new a.MeshStandardMaterial({color:r,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),i=new a.TextureLoader;for(let o=0;o<e.textures.length;o++){const t=e.textures[o];if(null!==t.image){const e=i.load(t.image);switch(t.type){case"Diffuse":n.map=e;break;case"Bump":n.bumpMap=e;break;case"Transparency":n.alphaMap=e,n.transparent=!0;break;case"Emap":n.envMap=e}}}return n}_createGeometry(e){const t=new a.Object3D,r=[],n=[],i=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let o=e.objects;const s=e.materials;for(let a=0;a<o.length;a++){const l=o[a],c=l.attributes;switch(l.objectType){case"InstanceDefinition":n.push(l);break;case"InstanceReference":i.push(l);break;default:let o;if(c.materialIndex>=0){const e=s[c.materialIndex];let t=this._createMaterial(e);t=this._compareMaterials(t),o=this._createObject(l,t)}else{const e=this._createMaterial();o=this._createObject(l,e)}if(void 0===o)continue;const a=e.layers[c.layerIndex];o.visible=!a||e.layers[c.layerIndex].visible,c.isInstanceDefinitionObject?r.push(o):t.add(o)}}for(let l=0;l<n.length;l++){const e=n[l];o=[];for(let t=0;t<e.attributes.objectIds.length;t++){const n=e.attributes.objectIds[t];for(let e=0;e<r.length;e++){n===r[e].userData.attributes.id&&o.push(r[e])}}for(let r=0;r<i.length;r++){const n=i[r];if(n.geometry.parentIdefId===e.attributes.id){const e=new a.Object3D,r=n.geometry.xform.array,i=new a.Matrix4;i.set(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15]),e.applyMatrix4(i);for(let t=0;t<o.length;t++)e.add(o[t].clone(!0));t.add(e)}}}return t.userData.materials=this.materials,t}_createObject(e,t){const r=new a.BufferGeometryLoader,n=e.attributes;let i,o,s,l;switch(e.objectType){case"Point":case"PointSet":i=r.parse(e.geometry),i.attributes.hasOwnProperty("color")?o=new a.PointsMaterial({vertexColors:!0,sizeAttenuation:!1,size:2}):(s=n.drawColor,l=new a.Color(s.r/255,s.g/255,s.b/255),o=new a.PointsMaterial({color:l,sizeAttenuation:!1,size:2})),o=this._compareMaterials(o);const c=new a.Points(i,o);return c.userData.attributes=n,c.userData.objectType=e.objectType,n.name&&(c.name=n.name),c;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(null===e.geometry)return;i=r.parse(e.geometry),i.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),null===t&&(t=this._createMaterial(),t=this._compareMaterials(t));const u=new a.Mesh(i,t);return u.castShadow=n.castsShadows,u.receiveShadow=n.receivesShadows,u.userData.attributes=n,u.userData.objectType=e.objectType,n.name&&(u.name=n.name),u;case"Curve":i=r.parse(e.geometry),s=n.drawColor,l=new a.Color(s.r/255,s.g/255,s.b/255),o=new a.LineBasicMaterial({color:l}),o=this._compareMaterials(o);const h=new a.Line(i,o);return h.userData.attributes=n,h.userData.objectType=e.objectType,n.name&&(h.name=n.name),h;case"TextDot":i=e.geometry;const d=document.createElement("canvas").getContext("2d"),f=`${i.fontHeight}px ${i.fontFace}`;d.font=f;const p=d.measureText(i.text).width+10,m=i.fontHeight+10,g=window.devicePixelRatio;d.canvas.width=p*g,d.canvas.height=m*g,d.canvas.style.width=p+"px",d.canvas.style.height=m+"px",d.setTransform(g,0,0,g,0,0),d.font=f,d.textBaseline="middle",d.textAlign="center",l=n.drawColor,d.fillStyle=`rgba(${l.r},${l.g},${l.b},${l.a})`,d.fillRect(0,0,p,m),d.fillStyle="white",d.fillText(i.text,p/2,m/2);const A=new a.CanvasTexture(d.canvas);A.minFilter=a.LinearFilter,A.wrapS=a.ClampToEdgeWrapping,A.wrapT=a.ClampToEdgeWrapping,o=new a.SpriteMaterial({map:A,depthTest:!1});const v=new a.Sprite(o);return v.position.set(i.point[0],i.point[1],i.point[2]),v.scale.set(p/10,m/10,1),v.userData.attributes=n,v.userData.objectType=e.objectType,n.name&&(v.name=n.name),v;case"Light":let y;if(i=e.geometry,i.isDirectionalLight)y=new a.DirectionalLight,y.castShadow=n.castsShadows,y.position.set(i.location[0],i.location[1],i.location[2]),y.target.position.set(i.direction[0],i.direction[1],i.direction[2]),y.shadow.normalBias=.1;else if(i.isPointLight)y=new a.PointLight,y.castShadow=n.castsShadows,y.position.set(i.location[0],i.location[1],i.location[2]),y.shadow.normalBias=.1;else if(i.isRectangularLight){y=new a.RectAreaLight;const e=Math.abs(i.width[2]),t=Math.abs(i.length[0]);y.position.set(i.location[0]-t/2,i.location[1],i.location[2]-e/2),y.height=t,y.width=e,y.lookAt(new a.Vector3(i.direction[0],i.direction[1],i.direction[2]))}else if(i.isSpotLight)y=new a.SpotLight,y.castShadow=n.castsShadows,y.position.set(i.location[0],i.location[1],i.location[2]),y.target.position.set(i.direction[0],i.direction[1],i.direction[2]),y.angle=i.spotAngleRadians,y.shadow.normalBias=.1;else if(i.isLinearLight)return void console.warn("THREE.3DMLoader:  No conversion exists for linear lights.");return y&&(y.intensity=i.intensity,s=i.diffuse,l=new a.Color(s.r/255,s.g/255,s.b/255),y.color=l,y.userData.attributes=n,y.userData.objectType=e.objectType),y}}_initLibrary(){if(!this.libraryPending){const e=new a.FileLoader(this.manager);e.setPath(this.libraryPath);const t=new Promise(((t,r)=>{e.load("rhino3dm.js",t,void 0,r)})),r=new a.FileLoader(this.manager);r.setPath(this.libraryPath),r.setResponseType("arraybuffer");const n=new Promise(((e,t)=>{r.load("rhino3dm.wasm",e,void 0,t)}));this.libraryPending=Promise.all([t,n]).then((([e,t])=>{this.libraryConfig.wasmBinary=t;const r=Cc.toString(),n=["/* rhino3dm.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))}))}return this.libraryPending}_getWorker(e){return this._initLibrary().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",libraryConfig:this.libraryConfig}),e.onmessage=function(t){const r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function Cc(){let e,t,r;function n(e,t){const n=e.geometry(),a=e.attributes();let s,l,c,u,h,d=n.objectType;switch(d){case r.ObjectType.Curve:const e=o(n,100);c={},l={},u={},c.itemSize=3,c.type="Float32Array",c.array=[];for(let t=0;t<e.length;t++)c.array.push(e[t][0]),c.array.push(e[t][1]),c.array.push(e[t][2]);l.position=c,u.attributes=l,s={data:u};break;case r.ObjectType.Point:const f=n.location;c={};const p={};l={},u={},c.itemSize=3,c.type="Float32Array",c.array=[f[0],f[1],f[2]];const m=a.drawColor(t);p.itemSize=3,p.type="Float32Array",p.array=[m.r/255,m.g/255,m.b/255],l.position=c,l.color=p,u.attributes=l,s={data:u};break;case r.ObjectType.PointSet:case r.ObjectType.Mesh:s=n.toThreejsJSON();break;case r.ObjectType.Brep:const g=n.faces();h=new r.Mesh;for(let t=0;t<g.count;t++){const e=g.get(t),n=e.getMesh(r.MeshType.Any);n&&(h.append(n),n.delete()),e.delete()}h.faces().count>0&&(h.compact(),s=h.toThreejsJSON(),g.delete()),h.delete();break;case r.ObjectType.Extrusion:h=n.getMesh(r.MeshType.Any),h&&(s=h.toThreejsJSON(),h.delete());break;case r.ObjectType.TextDot:case r.ObjectType.Light:s=i(n);break;case r.ObjectType.InstanceReference:s=i(n),s.xform=i(n.xform),s.xform.array=n.xform.toFloatArray(!0);break;case r.ObjectType.SubD:n.subdivide(3),h=r.Mesh.createFromSubDControlNet(n),h&&(s=h.toThreejsJSON(),h.delete());break;default:console.warn(`THREE.3DMLoader: TODO: Implement ${d.constructor.name}`)}if(s)return l=i(a),l.geometry=i(n),a.groupCount>0&&(l.groupIds=a.getGroupList()),a.userStringCount>0&&(l.userStrings=a.getUserStrings()),n.userStringCount>0&&(l.geometry.userStrings=n.getUserStrings()),l.drawColor=a.drawColor(t),d=d.constructor.name,d=d.substring(11,d.length),{geometry:s,attributes:l,objectType:d};console.warn(`THREE.3DMLoader: ${d.constructor.name} has no associated mesh geometry.`)}function i(e){const t={};for(const r in e){const n=e[r];"function"!==typeof n&&("object"===typeof n&&null!==n&&n.hasOwnProperty("constructor")?t[r]={name:n.constructor.name,value:n.value}:t[r]=n)}return t}function o(e,t){let n=t,i=[];const a=[];if(e instanceof r.LineCurve)return[e.pointAtStart,e.pointAtEnd];if(e instanceof r.PolylineCurve){n=e.pointCount;for(let t=0;t<n;t++)i.push(e.point(t));return i}if(e instanceof r.PolyCurve){const t=e.segmentCount;for(let r=0;r<t;r++){const t=e.segmentCurve(r),a=o(t,n);i=i.concat(a),t.delete()}return i}if(e instanceof r.ArcCurve&&(n=Math.floor(e.angleDegrees/5),n=n<2?2:n),e instanceof r.NurbsCurve&&1===e.degree){const t=e.tryGetPolyline();for(let e=0;e<t.count;e++)i.push(t.get(e));return t.delete(),i}const s=e.domain,l=n-1;for(let r=0;r<n;r++){const t=s[0]+r/l*(s[1]-s[0]);if(t===s[0]||t===s[1]){a.push(t);continue}const n=e.tangentAt(t),i=e.tangentAt(a.slice(-1)[0]),o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],c=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],u=Math.sqrt(o*c);let h;if(0===u)h=Math.PI/2;else{const e=(n.x*i.x+n.y*i.y+n.z*i.z)/u;h=Math.acos(Math.max(-1,Math.min(1,e)))}h<.1||a.push(t)}return i=a.map((t=>e.pointAt(t))),i}onmessage=function(o){const a=o.data;switch(a.type){case"init":t=a.libraryConfig;const o=t.wasmBinary;let s;e=new Promise((function(e){s={wasmBinary:o,onRuntimeInitialized:e},rhino3dm(s)})).then((()=>{r=s}));break;case"decode":const l=a.buffer;e.then((()=>{const e=function(e,t){const r=new Uint8Array(t),o=e.File3dm.fromByteArray(r),a=[],s=[],l=[],c=[],u=[],h=[],d=o.objects(),f=d.count;for(let i=0;i<f;i++){const e=d.get(i),t=n(e,o);e.delete(),t&&a.push(t)}for(let n=0;n<o.instanceDefinitions().count();n++){const e=o.instanceDefinitions().get(n),t=i(e);t.objectIds=e.getObjectIds(),a.push({geometry:null,attributes:t,objectType:"InstanceDefinition"})}const p=[e.TextureType.Diffuse,e.TextureType.Bump,e.TextureType.Transparency,e.TextureType.Opacity,e.TextureType.Emap],m=[e.TextureType.PBR_BaseColor,e.TextureType.PBR_Subsurface,e.TextureType.PBR_SubsurfaceScattering,e.TextureType.PBR_SubsurfaceScatteringRadius,e.TextureType.PBR_Metallic,e.TextureType.PBR_Specular,e.TextureType.PBR_SpecularTint,e.TextureType.PBR_Roughness,e.TextureType.PBR_Anisotropic,e.TextureType.PBR_Anisotropic_Rotation,e.TextureType.PBR_Sheen,e.TextureType.PBR_SheenTint,e.TextureType.PBR_Clearcoat,e.TextureType.PBR_ClearcoatBump,e.TextureType.PBR_ClearcoatRoughness,e.TextureType.PBR_OpacityIor,e.TextureType.PBR_OpacityRoughness,e.TextureType.PBR_Emission,e.TextureType.PBR_AmbientOcclusion,e.TextureType.PBR_Displacement];for(let n=0;n<o.materials().count();n++){const e=o.materials().get(n),t=e.physicallyBased();let r=i(e);const a=[];for(let n=0;n<p.length;n++){const t=e.getTexture(p[n]);if(t){let e=p[n].constructor.name;e=e.substring(12,e.length);const r={type:e},i=o.getEmbeddedFileAsBase64(t.fileName);i?r.image="data:image/png;base64,"+i:(console.warn(`THREE.3DMLoader: Image for ${e} texture not embedded in file.`),r.image=null),a.push(r),t.delete()}}if(r.textures=a,t.supported){console.log("pbr true");for(let r=0;r<m.length;r++){const t=e.getTexture(p[r]);if(t){const e=o.getEmbeddedFileAsBase64(t.fileName);let n=p[r].constructor.name;n=n.substring(12,n.length);const i={type:n,image:"data:image/png;base64,"+e};a.push(i),t.delete()}}const t=i(e.physicallyBased());r=Object.assign(t,r)}s.push(r),e.delete(),t.delete()}for(let n=0;n<o.layers().count();n++){const e=o.layers().get(n),t=i(e);l.push(t),e.delete()}for(let n=0;n<o.views().count();n++){const e=o.views().get(n),t=i(e);c.push(t),e.delete()}for(let n=0;n<o.namedViews().count();n++){const e=o.namedViews().get(n),t=i(e);u.push(t),e.delete()}for(let n=0;n<o.groups().count();n++){const e=o.groups().get(n),t=i(e);h.push(t),e.delete()}const g=i(o.settings());return o.delete(),{objects:a,materials:s,layers:l,views:c,namedViews:u,groups:h,settings:g}}(r,l);self.postMessage({type:"decode",id:a.id,data:e})}))}}}const Ec=/^[og]\s*(.+)?/,Sc=/^mtllib /,Tc=/^usemtl /,Mc=/^usemap /,Ic=new a.Vector3,Bc=new a.Vector3,_c=new a.Vector3,Fc=new a.Vector3,Pc=new a.Vector3;function Rc(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const r=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);const n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"===typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"===typeof r.clone){const e=r.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){const r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){const n=this.vertices,i=this.object.geometry.vertices;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){const n=this.normals,i=this.object.geometry.normals;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addFaceNormal:function(e,t,r){const n=this.vertices,i=this.object.geometry.normals;Ic.fromArray(n,e),Bc.fromArray(n,t),_c.fromArray(n,r),Pc.subVectors(_c,Bc),Fc.subVectors(Ic,Bc),Pc.cross(Fc),Pc.normalize(),i.push(Pc.x,Pc.y,Pc.z),i.push(Pc.x,Pc.y,Pc.z),i.push(Pc.x,Pc.y,Pc.z)},addColor:function(e,t,r){const n=this.colors,i=this.object.geometry.colors;void 0!==n[e]&&i.push(n[e+0],n[e+1],n[e+2]),void 0!==n[t]&&i.push(n[t+0],n[t+1],n[t+2]),void 0!==n[r]&&i.push(n[r+0],n[r+1],n[r+2])},addUV:function(e,t,r){const n=this.uvs,i=this.object.geometry.uvs;i.push(n[e+0],n[e+1]),i.push(n[t+0],n[t+1]),i.push(n[r+0],n[r+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,n,i,o,a,s,l){const c=this.vertices.length;let u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(r,c);if(this.addVertex(u,h,d),this.addColor(u,h,d),void 0!==a&&""!==a){const e=this.normals.length;u=this.parseNormalIndex(a,e),h=this.parseNormalIndex(s,e),d=this.parseNormalIndex(l,e),this.addNormal(u,h,d)}else this.addFaceNormal(u,h,d);if(void 0!==n&&""!==n){const e=this.uvs.length;u=this.parseUVIndex(n,e),h=this.parseUVIndex(i,e),d=this.parseUVIndex(o,e),this.addUV(u,h,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let r=0,n=e.length;r<n;r++){const n=this.parseVertexIndex(e[r],t);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const r=this.vertices.length,n=this.uvs.length;for(let i=0,o=e.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));for(let i=0,o=t.length;i<o;i++)this.addUVLine(this.parseUVIndex(t[i],n))}};return e.startObject("",!1),e}class Lc extends a.Loader{constructor(e){super(e),this.materials=null}load(e,t,r,n){const i=this,o=new a.FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}setMaterials(e){return this.materials=e,this}parse(e){const t=new Rc;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));const r=e.split("\n");let n="",i="",o=0,s=[];const l="function"===typeof"".trimLeft;for(let a=0,u=r.length;a<u;a++)if(n=r[a],n=l?n.trimLeft():n.trim(),o=n.length,0!==o&&(i=n.charAt(0),"#"!==i))if("v"===i){const e=n.split(/\s+/);switch(e[0]){case"v":t.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?t.colors.push(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":t.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===i){const e=n.substr(1).trim().split(/\s+/),r=[];for(let t=0,n=e.length;t<n;t++){const n=e[t];if(n.length>0){const e=n.split("/");r.push(e)}}const i=r[0];for(let n=1,o=r.length-1;n<o;n++){const e=r[n],o=r[n+1];t.addFace(i[0],e[0],o[0],i[1],e[1],o[1],i[2],e[2],o[2])}}else if("l"===i){const e=n.substring(1).trim().split(" ");let r=[];const i=[];if(-1===n.indexOf("/"))r=e;else for(let t=0,n=e.length;t<n;t++){const n=e[t].split("/");""!==n[0]&&r.push(n[0]),""!==n[1]&&i.push(n[1])}t.addLineGeometry(r,i)}else if("p"===i){const e=n.substr(1).trim().split(" ");t.addPointGeometry(e)}else if(null!==(s=Ec.exec(n))){const e=(" "+s[0].substr(1).trim()).substr(1);t.startObject(e)}else if(Tc.test(n))t.object.startMaterial(n.substring(7).trim(),t.materialLibraries);else if(Sc.test(n))t.materialLibraries.push(n.substring(7).trim());else if(Mc.test(n))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===i){if(s=n.split(" "),s.length>1){const e=s[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;const e=t.object.currentMaterial();e&&(e.smooth=t.object.smooth)}else{if("\0"===n)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+n+'"')}t.finalize();const c=new a.Group;c.materialLibraries=[].concat(t.materialLibraries);if(!0===!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length))for(let u=0,h=t.objects.length;u<h;u++){const e=t.objects[u],r=e.geometry,n=e.materials,i="Line"===r.type,o="Points"===r.type;let s=!1;if(0===r.vertices.length)continue;const l=new a.BufferGeometry;l.setAttribute("position",new a.Float32BufferAttribute(r.vertices,3)),r.normals.length>0&&l.setAttribute("normal",new a.Float32BufferAttribute(r.normals,3)),r.colors.length>0&&(s=!0,l.setAttribute("color",new a.Float32BufferAttribute(r.colors,3))),!0===r.hasUVIndices&&l.setAttribute("uv",new a.Float32BufferAttribute(r.uvs,2));const h=[];for(let c=0,u=n.length;c<u;c++){const e=n[c],r=e.name+"_"+e.smooth+"_"+s;let l=t.materials[r];if(null!==this.materials)if(l=this.materials.create(e.name),!i||!l||l instanceof a.LineBasicMaterial){if(o&&l&&!(l instanceof a.PointsMaterial)){const e=new a.PointsMaterial({size:10,sizeAttenuation:!1});a.Material.prototype.copy.call(e,l),e.color.copy(l.color),e.map=l.map,l=e}}else{const e=new a.LineBasicMaterial;a.Material.prototype.copy.call(e,l),e.color.copy(l.color),l=e}void 0===l&&(l=i?new a.LineBasicMaterial:o?new a.PointsMaterial({size:1,sizeAttenuation:!1}):new a.MeshPhongMaterial,l.name=e.name,l.flatShading=!e.smooth,l.vertexColors=s,t.materials[r]=l),h.push(l)}let d;if(h.length>1){for(let e=0,t=n.length;e<t;e++){const t=n[e];l.addGroup(t.groupStart,t.groupCount,e)}d=i?new a.LineSegments(l,h):o?new a.Points(l,h):new a.Mesh(l,h)}else d=i?new a.LineSegments(l,h[0]):o?new a.Points(l,h[0]):new a.Mesh(l,h[0]);d.name=e.name,c.add(d)}else if(t.vertices.length>0){const e=new a.PointsMaterial({size:1,sizeAttenuation:!1}),r=new a.BufferGeometry;r.setAttribute("position",new a.Float32BufferAttribute(t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(r.setAttribute("color",new a.Float32BufferAttribute(t.colors,3)),e.vertexColors=!0);const n=new a.Points(r,e);c.add(n)}return c}}class Dc extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){function t(e){let t="AMF Material";const n=e.attributes.id.textContent;let i={r:1,g:1,b:1,a:1},o=null;for(let a=0;a<e.childNodes.length;a++){const n=e.childNodes[a];"metadata"===n.nodeName&&void 0!==n.attributes.type?"name"===n.attributes.type.value&&(t=n.textContent):"color"===n.nodeName&&(i=r(n))}return o=new a.MeshPhongMaterial({flatShading:!0,color:new a.Color(i.r,i.g,i.b),name:t}),1!==i.a&&(o.transparent=!0,o.opacity=i.a),{id:n,material:o}}function r(e){const t={r:1,g:1,b:1,a:1};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];"r"===n.nodeName?t.r=n.textContent:"g"===n.nodeName?t.g=n.textContent:"b"===n.nodeName?t.b=n.textContent:"a"===n.nodeName&&(t.a=n.textContent)}return t}function n(e){const t={name:"",triangles:[],materialid:null};let r=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(t.name=r.textContent);else if("triangle"===r.nodeName){const e=r.getElementsByTagName("v1")[0].textContent,n=r.getElementsByTagName("v2")[0].textContent,i=r.getElementsByTagName("v3")[0].textContent;t.triangles.push(e,n,i)}r=r.nextElementSibling}return t}function i(e){const t=[],r=[];let n=e.firstElementChild;for(;n;){if("vertex"===n.nodeName){let e=n.firstElementChild;for(;e;){if("coordinates"===e.nodeName){const r=e.getElementsByTagName("x")[0].textContent,n=e.getElementsByTagName("y")[0].textContent,i=e.getElementsByTagName("z")[0].textContent;t.push(r,n,i)}else if("normal"===e.nodeName){const t=e.getElementsByTagName("nx")[0].textContent,n=e.getElementsByTagName("ny")[0].textContent,i=e.getElementsByTagName("nz")[0].textContent;r.push(t,n,i)}e=e.nextElementSibling}}n=n.nextElementSibling}return{vertices:t,normals:r}}function o(e){const t=e.attributes.id.textContent,o={name:"amfobject",meshes:[]};let a=null,s=e.firstElementChild;for(;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(o.name=s.textContent);else if("color"===s.nodeName)a=r(s);else if("mesh"===s.nodeName){let e=s.firstElementChild;const t={vertices:[],normals:[],volumes:[],color:a};for(;e;){if("vertices"===e.nodeName){const r=i(e);t.normals=t.normals.concat(r.normals),t.vertices=t.vertices.concat(r.vertices)}else"volume"===e.nodeName&&t.volumes.push(n(e));e=e.nextElementSibling}o.meshes.push(t)}s=s.nextElementSibling}return{id:t,obj:o}}const s=function(e){let t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){let r=null,n=null;console.log("THREE.AMFLoader: Loading Zip");try{r=(0,fn.GZ)(new Uint8Array(e))}catch(i){if(i instanceof ReferenceError)return console.log("THREE.AMFLoader: fflate missing and file is compressed."),null}for(n in r)if(".amf"===n.toLowerCase().substr(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+n),t=new DataView(r[n].buffer)}const r=a.LoaderUtils.decodeText(t),n=(new DOMParser).parseFromString(r,"application/xml");return"amf"!==n.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):n}(e);let l="",c="";const u=function(e){let t=1,r="millimeter";void 0!==e.documentElement.attributes.unit&&(r=e.documentElement.attributes.unit.value.toLowerCase());const n={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==n[r]&&(t=n[r]),console.log("THREE.AMFLoader: Unit scale: "+t),t}(s),h={},d={},f=s.documentElement.childNodes;let p,m;for(p=0;p<f.length;p++){const e=f[p];if("metadata"===e.nodeName)void 0!==e.attributes.type&&("name"===e.attributes.type.value?l=e.textContent:"author"===e.attributes.type.value&&(c=e.textContent));else if("material"===e.nodeName){const r=t(e);h[r.id]=r.material}else if("object"===e.nodeName){const t=o(e);d[t.id]=t.obj}}const g=new a.Group,A=new a.MeshPhongMaterial({color:11184895,flatShading:!0});g.name=l,g.userData.author=c,g.userData.loader="AMF";for(const v in d){const e=d[v],t=e.meshes,r=new a.Group;for(r.name=e.name||"",p=0;p<t.length;p++){let e=A;const n=t[p],i=new a.Float32BufferAttribute(n.vertices,3);let o=null;if(n.normals.length&&(o=new a.Float32BufferAttribute(n.normals,3)),n.color){const t=n.color;e=A.clone(),e.color=new a.Color(t.r,t.g,t.b),1!==t.a&&(e.transparent=!0,e.opacity=t.a)}const s=n.volumes;for(m=0;m<s.length;m++){const t=s[m],n=new a.BufferGeometry;let l=e;n.setIndex(t.triangles),n.setAttribute("position",i.clone()),o&&n.setAttribute("normal",o.clone()),void 0!==h[t.materialId]&&(l=h[t.materialId]),n.scale(u,u,u),r.add(new a.Mesh(n,l.clone()))}}g.add(r)}return g}}class Nc extends a.Loader{constructor(e){super(e),this.loader=new a.FileLoader(this.manager),this.parser=null,this.meshBuilder=new Oc(this.manager),this.animationBuilder=new Vc}setAnimationPath(e){return this.animationPath=e,this}load(e,t,r,n){const i=this.meshBuilder.setCrossOrigin(this.crossOrigin);let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:a.LoaderUtils.extractUrlBase(e);const s=this._extractExtension(e).toLowerCase();"pmd"===s||"pmx"===s?this["pmd"===s?"loadPMD":"loadPMX"](e,(function(e){t(i.build(e,o,r,n))}),r,n):n&&n(new Error("THREE.MMDLoader: Unknown model file extension ."+s+"."))}loadAnimation(e,t,r,n,i){const o=this.animationBuilder;this.loadVMD(e,(function(e){r(t.isCamera?o.buildCameraAnimation(e):o.build(e,t))}),n,i)}loadWithAnimation(e,t,r,n,i){const o=this;this.load(e,(function(e){o.loadAnimation(t,e,(function(t){r({mesh:e,animation:t})}),n,i)}),n,i)}loadPMD(e,t,r,n){const i=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,(function(e){t(i.parsePmd(e,!0))}),r,n)}loadPMX(e,t,r,n){const i=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,(function(e){t(i.parsePmx(e,!0))}),r,n)}loadVMD(e,t,r,n){const i=Array.isArray(e)?e:[e],o=[],a=i.length,s=this._getParser();this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials);for(let l=0,c=i.length;l<c;l++)this.loader.load(i[l],(function(e){o.push(s.parseVmd(e,!0)),o.length===a&&t(s.mergeVmds(o))}),r,n)}loadVPD(e,t,r,n,i){const o=this._getParser();this.loader.setMimeType(t?void 0:"text/plain; charset=shift_jis").setPath(this.animationPath).setResponseType("text").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,(function(e){r(o.parseVpd(e,!0))}),n,i)}_extractExtension(e){const t=e.lastIndexOf(".");return t<0?"":e.slice(t+1)}_getParser(){return null===this.parser&&(this.parser=new vn.Parser),this.parser}}const kc=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="];class Oc{constructor(e){this.crossOrigin="anonymous",this.geometryBuilder=new Uc,this.materialBuilder=new Qc(e)}setCrossOrigin(e){return this.crossOrigin=e,this}build(e,t,r,n){const i=this.geometryBuilder.build(e),o=this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(t).build(e,i,r,n),s=new a.SkinnedMesh(i,o),l=new a.Skeleton(function(e){const t=e.geometry,r=[];if(t&&void 0!==t.bones){for(let e=0,n=t.bones.length;e<n;e++){const n=t.bones[e],i=new a.Bone;r.push(i),i.name=n.name,i.position.fromArray(n.pos),i.quaternion.fromArray(n.rotq),void 0!==n.scl&&i.scale.fromArray(n.scl)}for(let n=0,i=t.bones.length;n<i;n++){const i=t.bones[n];-1!==i.parent&&null!==i.parent&&void 0!==r[i.parent]?r[i.parent].add(r[n]):e.add(r[n])}}return e.updateMatrixWorld(!0),r}(s));return s.bind(l),s}}class Uc{build(e){const t=[],r=[],n=[],i=[],o=[],s=[],l=[],c=[],u=[],h=[],d=[],f=[],p=[],m=[];let g=0;const A={};for(let a=0;a<e.metadata.vertexCount;a++){const i=e.vertices[a];for(let e=0,r=i.position.length;e<r;e++)t.push(i.position[e]);for(let e=0,t=i.normal.length;e<t;e++)n.push(i.normal[e]);for(let e=0,t=i.uv.length;e<t;e++)r.push(i.uv[e]);for(let e=0;e<4;e++)l.push(i.skinIndices.length-1>=e?i.skinIndices[e]:0);for(let e=0;e<4;e++)c.push(i.skinWeights.length-1>=e?i.skinWeights[e]:0)}for(let a=0;a<e.metadata.faceCount;a++){const t=e.faces[a];for(let e=0,r=t.indices.length;e<r;e++)i.push(t.indices[e])}for(let a=0;a<e.metadata.materialCount;a++){const t=e.materials[a];o.push({offset:3*g,count:3*t.faceCount}),g+=t.faceCount}for(let a=0;a<e.metadata.rigidBodyCount;a++){const t=e.rigidBodies[a];let r=A[t.boneIndex];r=void 0===r?t.type:Math.max(t.type,r),A[t.boneIndex]=r}for(let a=0;a<e.metadata.boneCount;a++){const t=e.bones[a],r={index:a,transformationClass:t.transformationClass,parent:t.parentIndex,name:t.name,pos:t.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:void 0!==A[a]?A[a]:-1};-1!==r.parent&&(r.pos[0]-=e.bones[r.parent].position[0],r.pos[1]-=e.bones[r.parent].position[1],r.pos[2]-=e.bones[r.parent].position[2]),s.push(r)}if("pmd"===e.metadata.format)for(let x=0;x<e.metadata.ikCount;x++){const t=e.iks[x],r={target:t.target,effector:t.effector,iteration:t.iteration,maxAngle:4*t.maxAngle,links:[]};for(let n=0,i=t.links.length;n<i;n++){const i={};i.index=t.links[n].index,i.enabled=!0,e.bones[i.index].name.indexOf("\u3072\u3056")>=0&&(i.limitation=new a.Vector3(1,0,0)),r.links.push(i)}d.push(r)}else for(let x=0;x<e.metadata.boneCount;x++){const t=e.bones[x].ik;if(void 0===t)continue;const r={target:x,effector:t.effector,iteration:t.iteration,maxAngle:t.maxAngle,links:[]};for(let e=0,n=t.links.length;e<n;e++){const n={};if(n.index=t.links[e].index,n.enabled=!0,1===t.links[e].angleLimitation){const r=t.links[e].lowerLimitationAngle,i=t.links[e].upperLimitationAngle,o=-i[0],s=-i[1];i[0]=-r[0],i[1]=-r[1],r[0]=o,r[1]=s,n.rotationMin=(new a.Vector3).fromArray(r),n.rotationMax=(new a.Vector3).fromArray(i)}r.links.push(n)}d.push(r),s[x].ik=r}if("pmx"===e.metadata.format){const t={};for(let i=0;i<e.metadata.boneCount;i++){const r=e.bones[i],n=r.grant;if(void 0===n)continue;const o={index:i,parentIndex:n.parentIndex,ratio:n.ratio,isLocal:n.isLocal,affectRotation:n.affectRotation,affectPosition:n.affectPosition,transformationClass:r.transformationClass};t[i]={parent:null,children:[],param:o,visited:!1}}const r={parent:null,children:[],param:null,visited:!1};for(const e in t){const n=t[e],i=t[n.parentIndex]||r;n.parent=i,i.children.push(n)}function n(e){e.param&&(f.push(e.param),s[e.param.index].grant=e.param),e.visited=!0;for(let t=0,r=e.children.length;t<r;t++){const r=e.children[t];r.visited||n(r)}}n(r)}function v(t,r,n){for(let i=0;i<r.elementCount;i++){const o=r.elements[i];let a;a="pmd"===e.metadata.format?e.morphs[0].elements[o.index].index:o.index,t.array[3*a+0]+=o.position[0]*n,t.array[3*a+1]+=o.position[1]*n,t.array[3*a+2]+=o.position[2]*n}}for(let x=0;x<e.metadata.morphCount;x++){const r=e.morphs[x],n={name:r.name},i=new a.Float32BufferAttribute(3*e.metadata.vertexCount,3);i.name=r.name;for(let o=0;o<3*e.metadata.vertexCount;o++)i.array[o]=t[o];if("pmd"===e.metadata.format)0!==x&&v(i,r,1);else if(0===r.type)for(let t=0;t<r.elementCount;t++){const n=e.morphs[r.elements[t].index],o=r.elements[t].ratio;1===n.type&&v(i,n,o)}else 1===r.type?v(i,r,1):2===r.type||3===r.type||4===r.type||5===r.type||6===r.type||7===r.type||r.type;u.push(n),h.push(i)}for(let a=0;a<e.metadata.rigidBodyCount;a++){const t=e.rigidBodies[a],r={};for(const e in t)r[e]=t[e];if("pmx"===e.metadata.format&&-1!==r.boneIndex){const t=e.bones[r.boneIndex];r.position[0]-=t.position[0],r.position[1]-=t.position[1],r.position[2]-=t.position[2]}p.push(r)}for(let a=0;a<e.metadata.constraintCount;a++){const t=e.constraints[a],r={};for(const e in t)r[e]=t[e];const n=p[r.rigidBodyIndex1],i=p[r.rigidBodyIndex2];0!==n.type&&2===i.type&&-1!==n.boneIndex&&-1!==i.boneIndex&&e.bones[i.boneIndex].parentIndex===n.boneIndex&&(i.type=1),m.push(r)}const y=new a.BufferGeometry;y.setAttribute("position",new a.Float32BufferAttribute(t,3)),y.setAttribute("normal",new a.Float32BufferAttribute(n,3)),y.setAttribute("uv",new a.Float32BufferAttribute(r,2)),y.setAttribute("skinIndex",new a.Uint16BufferAttribute(l,4)),y.setAttribute("skinWeight",new a.Float32BufferAttribute(c,4)),y.setIndex(i);for(let a=0,x=o.length;a<x;a++)y.addGroup(o[a].offset,o[a].count,a);return y.bones=s,y.morphTargets=u,y.morphAttributes.position=h,y.morphTargetsRelative=!1,y.userData.MMD={bones:s,iks:d,grants:f,rigidBodies:p,constraints:m,format:e.metadata.format},y.computeBoundingSphere(),y}}class Qc{constructor(e){this.manager=e,this.textureLoader=new a.TextureLoader(this.manager),this.tgaLoader=null,this.crossOrigin="anonymous",this.resourcePath=void 0}setCrossOrigin(e){return this.crossOrigin=e,this}setResourcePath(e){return this.resourcePath=e,this}build(e,t){const r=[],n={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(let i=0;i<e.metadata.materialCount;i++){const o=e.materials[i],s={userData:{}};if(void 0!==o.name&&(s.name=o.name),s.color=(new a.Color).fromArray(o.diffuse),s.opacity=o.diffuse[3],s.emissive=(new a.Color).fromArray(o.ambient),s.transparent=1!==s.opacity,s.skinning=t.bones.length>0,s.morphTargets=t.morphTargets.length>0,s.fog=!0,s.blending=a.CustomBlending,s.blendSrc=a.SrcAlphaFactor,s.blendDst=a.OneMinusSrcAlphaFactor,s.blendSrcAlpha=a.SrcAlphaFactor,s.blendDstAlpha=a.DstAlphaFactor,"pmx"===e.metadata.format&&1===(1&o.flag)?s.side=a.DoubleSide:s.side=1===s.opacity?a.FrontSide:a.DoubleSide,"pmd"===e.metadata.format){if(o.fileName){const e=o.fileName.split("*");if(s.map=this._loadTexture(e[0],n),e.length>1){const t=e[1].slice(-4).toLowerCase();s.envMap=this._loadTexture(e[1],n),s.combine=".sph"===t?a.MultiplyOperation:a.AddOperation}}const t=-1===o.toonIndex?"toon00.bmp":e.toonTextures[o.toonIndex].fileName;s.gradientMap=this._loadTexture(t,n,{isToonTexture:!0,isDefaultToonTexture:this._isDefaultToonTexture(t)}),s.userData.outlineParameters={thickness:1===o.edgeFlag?.003:0,color:[0,0,0],alpha:1,visible:1===o.edgeFlag}}else{let t,r;-1!==o.textureIndex&&(s.map=this._loadTexture(e.textures[o.textureIndex],n)),-1===o.envTextureIndex||1!==o.envFlag&&2!=o.envFlag||(s.envMap=this._loadTexture(e.textures[o.envTextureIndex],n),s.combine=1===o.envFlag?a.MultiplyOperation:a.AddOperation),-1===o.toonIndex||0!==o.toonFlag?(t="toon"+("0"+(o.toonIndex+1)).slice(-2)+".bmp",r=!0):(t=e.textures[o.toonIndex],r=!1),s.gradientMap=this._loadTexture(t,n,{isToonTexture:!0,isDefaultToonTexture:r}),s.userData.outlineParameters={thickness:o.edgeSize/300,color:o.edgeColor.slice(0,3),alpha:o.edgeColor[3],visible:0!==(16&o.flag)&&o.edgeSize>0}}void 0!==s.map&&(s.transparent||this._checkImageTransparency(s.map,t,i),s.emissive.multiplyScalar(.2)),r.push(new a.MeshToonMaterial(s))}if("pmx"===e.metadata.format){function t(e,t){for(let r=0,n=e.length;r<n;r++){const n=e[r];if(-1===n.index)continue;const i=t[n.index];i.opacity!==n.diffuse[3]&&(i.transparent=!0)}}for(let n=0,i=e.morphs.length;n<i;n++){const i=e.morphs[n],o=i.elements;if(0===i.type)for(let n=0,a=o.length;n<a;n++){const i=e.morphs[o[n].index];8===i.type&&t(i.elements,r)}else 8===i.type&&t(o,r)}}return r}_getTGALoader(){if(null===this.tgaLoader){if(void 0===Ss)throw new Error("THREE.MMDLoader: Import TGALoader");this.tgaLoader=new Ss(this.manager)}return this.tgaLoader}_isDefaultToonTexture(e){return 10===e.length&&/toon(10|0[0-9])\.bmp/.test(e)}_loadTexture(e,t,r,n,i){const o=this;let s;if(!0===(r=r||{}).isDefaultToonTexture){let t;try{t=parseInt(e.match(/toon([0-9]{2})\.bmp$/)[1])}catch(u){console.warn("THREE.MMDLoader: "+e+" seems like a not right default texture path. Using toon00.bmp instead."),t=0}s=kc[t]}else s=this.resourcePath+e;if(void 0!==t[s])return t[s];let l=this.manager.getHandler(s);null===l&&(l=".tga"===e.slice(-4).toLowerCase()?this._getTGALoader():this.textureLoader);const c=l.load(s,(function(e){!0===r.isToonTexture&&(e.image=o._getRotatedImage(e.image),e.magFilter=a.NearestFilter,e.minFilter=a.NearestFilter),e.flipY=!1,e.wrapS=a.RepeatWrapping,e.wrapT=a.RepeatWrapping;for(let t=0;t<c.readyCallbacks.length;t++)c.readyCallbacks[t](c);delete c.readyCallbacks}),n,i);return c.readyCallbacks=[],t[s]=c,c}_getRotatedImage(e){const t=document.createElement("canvas"),r=t.getContext("2d"),n=e.width,i=e.height;return t.width=n,t.height=i,r.clearRect(0,0,n,i),r.translate(n/2,i/2),r.rotate(.5*Math.PI),r.translate(-n/2,-i/2),r.drawImage(e,0,0),r.getImageData(0,0,n,i)}_checkImageTransparency(e,t,r){e.readyCallbacks.push((function(n){function i(e,t){const r=e.width,n=e.height;let i=Math.round(t.x*r)%r,o=Math.round(t.y*n)%n;i<0&&(i+=r),o<0&&(o+=n);const a=o*r+i;return e.data[4*a+3]}const o=void 0!==n.image.data?n.image:function(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,t.width,t.height)}(n.image),a=t.groups[r];(function(e,t,r){const n=e.width,o=e.height;if(e.data.length/(n*o)!==4)return!1;for(let a=0;a<r.length;a+=3){const n={x:0,y:0};for(let o=0;o<3;o++){const s=r[3*a+o],l={x:t[2*s+0],y:t[2*s+1]};if(i(e,l)<253)return!0;n.x+=l.x,n.y+=l.y}if(n.x/=3,n.y/=3,i(e,n)<253)return!0}return!1})(o,t.attributes.uv.array,t.index.array.slice(a.start,a.start+a.count))&&(e.transparent=!0)}))}}class Vc{build(e,t){const r=this.buildSkeletalAnimation(e,t).tracks,n=this.buildMorphAnimation(e,t).tracks;for(let i=0,o=n.length;i<o;i++)r.push(n[i]);return new a.AnimationClip("",-1,r)}buildSkeletalAnimation(e,t){function r(e,t,r){e.push(t[r+0]/127),e.push(t[r+8]/127),e.push(t[r+4]/127),e.push(t[r+12]/127)}const n=[],i={},o=t.skeleton.bones,s={};for(let a=0,l=o.length;a<l;a++)s[o[a].name]=!0;for(let a=0;a<e.metadata.motionCount;a++){const t=e.motions[a],r=t.boneName;void 0!==s[r]&&(i[r]=i[r]||[],i[r].push(t))}for(const l in i){const e=i[l];e.sort((function(e,t){return e.frameNum-t.frameNum}));const o=[],s=[],c=[],u=[],h=[],d=t.skeleton.getBoneByName(l).position.toArray();for(let t=0,n=e.length;t<n;t++){const n=e[t].frameNum/30,i=e[t].position,a=e[t].rotation,l=e[t].interpolation;o.push(n);for(let e=0;e<3;e++)s.push(d[e]+i[e]);for(let e=0;e<4;e++)c.push(a[e]);for(let e=0;e<3;e++)r(u,l,e);r(h,l,3)}const f=".bones["+l+"]";n.push(this._createTrack(f+".position",a.VectorKeyframeTrack,o,s,u)),n.push(this._createTrack(f+".quaternion",a.QuaternionKeyframeTrack,o,c,h))}return new a.AnimationClip("",-1,n)}buildMorphAnimation(e,t){const r=[],n={},i=t.morphTargetDictionary;for(let o=0;o<e.metadata.morphCount;o++){const t=e.morphs[o],r=t.morphName;void 0!==i[r]&&(n[r]=n[r]||[],n[r].push(t))}for(const o in n){const e=n[o];e.sort((function(e,t){return e.frameNum-t.frameNum}));const t=[],s=[];for(let r=0,n=e.length;r<n;r++)t.push(e[r].frameNum/30),s.push(e[r].weight);r.push(new a.NumberKeyframeTrack(".morphTargetInfluences["+i[o]+"]",t,s))}return new a.AnimationClip("",-1,r)}buildCameraAnimation(e){function t(e,t){e.push(t.x),e.push(t.y),e.push(t.z)}function r(e,t,r){e.push(t[4*r+0]/127),e.push(t[4*r+1]/127),e.push(t[4*r+2]/127),e.push(t[4*r+3]/127)}const n=void 0===e.cameras?[]:e.cameras.slice();n.sort((function(e,t){return e.frameNum-t.frameNum}));const i=[],o=[],s=[],l=[],c=[],u=[],h=[],d=[],f=[],p=new a.Quaternion,m=new a.Euler,g=new a.Vector3,A=new a.Vector3;for(let a=0,b=n.length;a<b;a++){const e=n[a],x=e.frameNum/30,b=e.position,w=e.rotation,C=e.distance,E=e.fov,S=e.interpolation;i.push(x),g.set(0,0,-C),A.set(b[0],b[1],b[2]),m.set(-w[0],-w[1],-w[2]),p.setFromEuler(m),g.add(A),g.applyQuaternion(p),t(o,A),(v=s).push((y=p).x),v.push(y.y),v.push(y.z),v.push(y.w),t(l,g),c.push(E);for(let t=0;t<3;t++)r(u,S,t);r(h,S,3);for(let t=0;t<3;t++)r(d,S,4);r(f,S,5)}var v,y;const x=[];return x.push(this._createTrack("target.position",a.VectorKeyframeTrack,i,o,u)),x.push(this._createTrack(".quaternion",a.QuaternionKeyframeTrack,i,s,h)),x.push(this._createTrack(".position",a.VectorKeyframeTrack,i,l,d)),x.push(this._createTrack(".fov",a.NumberKeyframeTrack,i,c,f)),new a.AnimationClip("",-1,x)}_createTrack(e,t,r,n,i){if(r.length>2){r=r.slice(),n=n.slice(),i=i.slice();const e=n.length/r.length,t=i.length/r.length;let o=1;for(let a=2,s=r.length;a<s;a++){for(let t=0;t<e;t++)if(n[o*e+t]!==n[(o-1)*e+t]||n[o*e+t]!==n[a*e+t]){o++;break}if(a>o){r[o]=r[a];for(let t=0;t<e;t++)n[o*e+t]=n[a*e+t];for(let e=0;e<t;e++)i[o*t+e]=i[a*t+e]}}r.length=o+1,n.length=(o+1)*e,i.length=(o+1)*t}const o=new t(e,r,n);return o.createInterpolant=function(e){return new Gc(this.times,this.values,this.getValueSize(),e,new Float32Array(i))},o}}class Gc extends a.Interpolant{constructor(e,t,r,n,i){super(e,t,r,n),this.interpolationParams=i}interpolate_(e,t,r,n){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,l=this.interpolationParams,c=e*s,u=c-s,h=n-t<.05?0:(r-t)/(n-t);if(4===s){const t=l[4*e+0],r=l[4*e+1],n=l[4*e+2],s=l[4*e+3],d=this._calculate(t,r,n,s,h);a.Quaternion.slerpFlat(i,0,o,u,o,c,d)}else if(3===s)for(let a=0;a!==s;++a){const t=l[12*e+4*a+0],r=l[12*e+4*a+1],n=l[12*e+4*a+2],s=l[12*e+4*a+3],d=this._calculate(t,r,n,s,h);i[a]=o[u+a]*(1-d)+o[c+a]*d}else{const t=l[4*e+0],r=l[4*e+1],n=l[4*e+2],a=l[4*e+3],s=this._calculate(t,r,n,a,h);i[0]=o[u]*(1-s)+o[c]*s}return i}_calculate(e,t,r,n,i){let o=.5,a=o,s=1-a;const l=Math;let c,u,h;for(let d=0;d<15;d++){c=3*s*s*a,u=3*s*a*a,h=a*a*a;const r=c*e+u*t+h-i;if(l.abs(r)<1e-5)break;o/=2,a+=r<0?o:-o,s=1-a}return c*r+u*n+h}}class zc extends a.CompressedTextureLoader{constructor(e){super(e)}parse(e,t){const r=new jc(e,1);return{mipmaps:r.mipmaps(t),width:r.pixelWidth,height:r.pixelHeight,format:r.glInternalFormat,isCubemap:6===r.numberOfFaces,mipmapCount:r.numberOfMipmapLevels}}}class jc{constructor(e,t){this.arrayBuffer=e;const r=new Uint8Array(this.arrayBuffer,0,12);if(171!==r[0]||75!==r[1]||84!==r[2]||88!==r[3]||32!==r[4]||49!==r[5]||49!==r[6]||187!==r[7]||13!==r[8]||10!==r[9]||26!==r[10]||10!==r[11])return void console.error("texture missing KTX identifier");const n=Uint32Array.BYTES_PER_ELEMENT,i=new DataView(this.arrayBuffer,12,13*n),o=67305985===i.getUint32(0,!0);this.glType=i.getUint32(1*n,o),this.glTypeSize=i.getUint32(2*n,o),this.glFormat=i.getUint32(3*n,o),this.glInternalFormat=i.getUint32(4*n,o),this.glBaseInternalFormat=i.getUint32(5*n,o),this.pixelWidth=i.getUint32(6*n,o),this.pixelHeight=i.getUint32(7*n,o),this.pixelDepth=i.getUint32(8*n,o),this.numberOfArrayElements=i.getUint32(9*n,o),this.numberOfFaces=i.getUint32(10*n,o),this.numberOfMipmapLevels=i.getUint32(11*n,o),this.bytesOfKeyValueData=i.getUint32(12*n,o),0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===t?this.loadType=0:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const t=[];let r=64+this.bytesOfKeyValueData,n=this.pixelWidth,i=this.pixelHeight;const o=e?this.numberOfMipmapLevels:1;for(let a=0;a<o;a++){const e=new Int32Array(this.arrayBuffer,r,1)[0];r+=4;for(let o=0;o<this.numberOfFaces;o++){const o=new Uint8Array(this.arrayBuffer,r,e);t.push({data:o,width:n,height:i}),r+=e,r+=3-(e+3)%4}n=Math.max(1,.5*n),i=Math.max(1,.5*i)}return t}}class Hc extends a.Loader{load(e,t,r,n){const i=this,o=new a.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){const t=new a.Group,r=(0,fn.GZ)(new Uint8Array(e.slice(16))),n=JSON.parse((0,fn.T8)(r["metadata.json"])),i=new DataView(r["data.sketch"].buffer),o=i.getInt32(16,!0),s={};let l=20;for(let a=0;a<o;a++){const e=i.getInt32(l,!0),t=[i.getFloat32(l+4,!0),i.getFloat32(l+8,!0),i.getFloat32(l+12,!0),i.getFloat32(l+16,!0)],r=i.getFloat32(l+20,!0),n=i.getUint32(l+24,!0),o=i.getUint32(l+28,!0);let a=0,c=0;for(let i=0;i<4;i++){const e=1<<i;(n&e)>0&&(a+=4),(o&e)>0&&(c+=4)}l=l+28+a+4;const u=i.getInt32(l,!0),h=new Float32Array(3*u),d=new Float32Array(4*u);l+=4;for(let s=0,f=0;s<h.length;s+=3,f+=4)h[s+0]=i.getFloat32(l+0,!0),h[s+1]=i.getFloat32(l+4,!0),h[s+2]=i.getFloat32(l+8,!0),d[f+0]=i.getFloat32(l+12,!0),d[f+1]=i.getFloat32(l+16,!0),d[f+2]=i.getFloat32(l+20,!0),d[f+3]=i.getFloat32(l+24,!0),l=l+28+c;e in s===!1&&(s[e]=[]),s[e].push([h,d,r,t])}for(const c in s){const e=new Wc(s[c]),r=Yc(n.BrushIndex[c]);t.add(new a.Mesh(e,r))}return t}}class Wc extends a.BufferGeometry{constructor(e){super();const t=[],r=[],n=[],i=new a.Vector3,o=new a.Vector3,s=new a.Quaternion,l=new a.Quaternion,c=new a.Vector3,u=new a.Vector3,h=new a.Vector3,d=new a.Vector3;for(const a in e){const f=e[a],p=f[0],m=f[1],g=f[2],A=f[3];o.fromArray(p,0),l.fromArray(m,0);for(let e=3,a=4,v=p.length;e<v;e+=3,a+=4){i.fromArray(p,e),s.fromArray(m,a),c.set(-g,0,0),c.applyQuaternion(s),c.add(i),u.set(g,0,0),u.applyQuaternion(s),u.add(i),h.set(g,0,0),h.applyQuaternion(l),h.add(o),d.set(-g,0,0),d.applyQuaternion(l),d.add(o),t.push(c.x,c.y,-c.z),t.push(u.x,u.y,-u.z),t.push(d.x,d.y,-d.z),t.push(u.x,u.y,-u.z),t.push(h.x,h.y,-h.z),t.push(d.x,d.y,-d.z),o.copy(i),l.copy(s),r.push(...A),r.push(...A),r.push(...A),r.push(...A),r.push(...A),r.push(...A);const f=e/v,y=(e-3)/v;n.push(f,0),n.push(f,1),n.push(y,0),n.push(f,1),n.push(y,1),n.push(y,0)}}this.setAttribute("position",new a.BufferAttribute(new Float32Array(t),3)),this.setAttribute("color",new a.BufferAttribute(new Float32Array(r),4)),this.setAttribute("uv",new a.BufferAttribute(new Float32Array(n),2))}}const Zc={"89d104cd-d012-426b-b5b3-bbaee63ac43c":"Bubbles","700f3aa8-9a7c-2384-8b8a-ea028905dd8c":"CelVinyl","0f0ff7b2-a677-45eb-a7d6-0cd7206f4816":"ChromaticWave","1161af82-50cf-47db-9706-0c3576d43c43":"CoarseBristles","79168f10-6961-464a-8be1-57ed364c5600":"CoarseBristlesSingleSided","1caa6d7d-f015-3f54-3a4b-8b5354d39f81":"Comet","c8313697-2563-47fc-832e-290f4c04b901":"DiamondHull","4391aaaa-df73-4396-9e33-31e4e4930b27":"Disco","d1d991f2-e7a0-4cf1-b328-f57e915e6260":"DotMarker","6a1cf9f9-032c-45ec-9b1d-a6680bee30f7":"Dots","0d3889f3-3ede-470c-8af4-f44813306126":"DoubleTaperedFlat","0d3889f3-3ede-470c-8af4-de4813306126":"DoubleTaperedMarker","d0262945-853c-4481-9cbd-88586bed93cb":"DuctTape","3ca16e2f-bdcd-4da2-8631-dcef342f40f1":"DuctTapeSingleSided","f6e85de3-6dcc-4e7f-87fd-cee8c3d25d51":"Electricity","02ffb866-7fb2-4d15-b761-1012cefb1360":"Embers","cb92b597-94ca-4255-b017-0e3f42f12f9e":"Fire","2d35bcf0-e4d8-452c-97b1-3311be063130":"Flat","55303bc4-c749-4a72-98d9-d23e68e76e18":"FlatDeprecated","280c0a7a-aad8-416c-a7d2-df63d129ca70":"FlatSingleSided","cf019139-d41c-4eb0-a1d0-5cf54b0a42f3":"Highlighter","6a1cf9f9-032c-45ec-9b6e-a6680bee32e9":"HyperGrid","dce872c2-7b49-4684-b59b-c45387949c5c":"Hypercolor","e8ef32b1-baa8-460a-9c2c-9cf8506794f5":"HypercolorSingleSided","2f212815-f4d3-c1a4-681a-feeaf9c6dc37":"Icing","f5c336cf-5108-4b40-ade9-c687504385ab":"Ink","c0012095-3ffd-4040-8ee1-fc180d346eaa":"InkSingleSided","4a76a27a-44d8-4bfe-9a8c-713749a499b0":"Leaves","ea19de07-d0c0-4484-9198-18489a3c1487":"LeavesSingleSided","2241cd32-8ba2-48a5-9ee7-2caef7e9ed62":"Light","4391aaaa-df81-4396-9e33-31e4e4930b27":"LightWire","d381e0f5-3def-4a0d-8853-31e9200bcbda":"Lofted","429ed64a-4e97-4466-84d3-145a861ef684":"Marker","79348357-432d-4746-8e29-0e25c112e3aa":"MatteHull","b2ffef01-eaaa-4ab5-aa64-95a2c4f5dbc6":"NeonPulse","f72ec0e7-a844-4e38-82e3-140c44772699":"OilPaint","c515dad7-4393-4681-81ad-162ef052241b":"OilPaintSingleSided","f1114e2e-eb8d-4fde-915a-6e653b54e9f5":"Paper","759f1ebd-20cd-4720-8d41-234e0da63716":"PaperSingleSided","e0abbc80-0f80-e854-4970-8924a0863dcc":"Petal","c33714d1-b2f9-412e-bd50-1884c9d46336":"Plasma","ad1ad437-76e2-450d-a23a-e17f8310b960":"Rainbow","faaa4d44-fcfb-4177-96be-753ac0421ba3":"ShinyHull","70d79cca-b159-4f35-990c-f02193947fe8":"Smoke","d902ed8b-d0d1-476c-a8de-878a79e3a34c":"Snow","accb32f5-4509-454f-93f8-1df3fd31df1b":"SoftHighlighter","cf7f0059-7aeb-53a4-2b67-c83d863a9ffa":"Spikes","8dc4a70c-d558-4efd-a5ed-d4e860f40dc3":"Splatter","7a1c8107-50c5-4b70-9a39-421576d6617e":"SplatterSingleSided","0eb4db27-3f82-408d-b5a1-19ebd7d5b711":"Stars","44bb800a-fbc3-4592-8426-94ecb05ddec3":"Streamers","0077f88c-d93a-42f3-b59b-b31c50cdb414":"Taffy","b468c1fb-f254-41ed-8ec9-57030bc5660c":"TaperedFlat","c8ccb53d-ae13-45ef-8afb-b730d81394eb":"TaperedFlatSingleSided","d90c6ad8-af0f-4b54-b422-e0f92abe1b3c":"TaperedMarker","1a26b8c0-8a07-4f8a-9fac-d2ef36e0cad0":"TaperedMarker_Flat","75b32cf0-fdd6-4d89-a64b-e2a00b247b0f":"ThickPaint","fdf0326a-c0d1-4fed-b101-9db0ff6d071f":"ThickPaintSingleSided","4391385a-df73-4396-9e33-31e4e4930b27":"Toon","a8fea537-da7c-4d4b-817f-24f074725d6d":"UnlitHull","d229d335-c334-495a-a801-660ac8a87360":"VelvetInk","10201aa3-ebc2-42d8-84b7-2e63f6eeb8ab":"Waveform","b67c0e81-ce6d-40a8-aeb0-ef036b081aa3":"WetPaint","dea67637-cd1a-27e4-c9b1-52f4bbcb84e5":"WetPaintSingleSided","5347acf0-a8e2-47b6-8346-30c70719d763":"WigglyGraphite","e814fef1-97fd-7194-4a2f-50c2bb918be2":"WigglyGraphiteSingleSided","4391385a-cf83-4396-9e33-31e4e4930b27":"Wire"},Xc={BloomColor:"\n\t\t\tvec3 BloomColor(vec3 color, float gain) {\n\t\t\t\t// Guarantee that there's at least a little bit of all 3 channels.\n\t\t\t\t// This makes fully-saturated strokes (which only have 2 non-zero\n\t\t\t\t// color channels) eventually clip to white rather than to a secondary.\n\t\t\t\tfloat cmin = length(color.rgb) * .05;\n\t\t\t\tcolor.rgb = max(color.rgb, vec3(cmin, cmin, cmin));\n\t\t\t\t// If we try to remove this pow() from .a, it brightens up\n\t\t\t\t// pressure-sensitive strokes; looks better as-is.\n\t\t\t\tcolor = pow(color, vec3(2.2));\n\t\t\t\tcolor.rgb *= 2. * exp(gain * 10.);\n\t\t\t\treturn color;\n\t\t\t}\n\t\t",LinearToSrgb:"\n\t\t\tvec3 LinearToSrgb(vec3 color) {\n\t\t\t\t// Approximation http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html\n\t\t\t\tvec3 linearColor = color.rgb;\n\t\t\t\tvec3 S1 = sqrt(linearColor);\n\t\t\t\tvec3 S2 = sqrt(S1);\n\t\t\t\tvec3 S3 = sqrt(S2);\n\t\t\t\tcolor.rgb = 0.662002687 * S1 + 0.684122060 * S2 - 0.323583601 * S3 - 0.0225411470 * linearColor;\n\t\t\t\treturn color;\n\t\t\t}\n\t\t",hsv:"\n\t\t\t// uniform sampler2D lookupTex;\n\t\t\tvec4 lookup(vec4 textureColor) {\n\t\t\t\treturn textureColor;\n\t\t\t}\n\n\t\t\tvec3 lookup(vec3 textureColor) {\n\t\t\t\treturn textureColor;\n\t\t\t}\n\n\t\t\tvec3 hsv2rgb( vec3 hsv ) {\n\t\t\t\tvec3 rgb = clamp( abs(mod(hsv.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0, 0.0, 1.0 );\n\t\t\t\treturn hsv.z * mix( vec3(1.0), rgb, hsv.y);\n\t\t\t}\n\n\t\t\tvec3 rgb2hsv( vec3 rgb ) {\n\t\t\t\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\t\t\t\tvec4 p = mix(vec4(rgb.bg, K.wz), vec4(rgb.gb, K.xy), step(rgb.b, rgb.g));\n\t\t\t\tvec4 q = mix(vec4(p.xyw, rgb.r), vec4(rgb.r, p.yzx), step(p.x, rgb.r));\n\n\t\t\t\tfloat d = q.x - min(q.w, q.y);\n\t\t\t\tfloat e = 1.0e-10;\n\n\t\t\t\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n\t\t\t}\n\t\t",SrgbToLinear:"\n\t\t\tvec3 SrgbToLinear(vec3 color) {\n\t\t\t\t// Approximation http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html\n\t\t\t\tvec3 sRGB = color.rgb;\n\t\t\t\tcolor.rgb = sRGB * (sRGB * (sRGB * 0.305306011 + 0.682171111) + 0.012522878);\n\t\t\t\treturn color;\n\t\t\t}\n\t\t"};function Yc(e){switch(Zc[e]){case"Light":return new a.RawShaderMaterial({uniforms:{mainTex:{value:(new a.TextureLoader).setPath("./textures/tiltbrush/").loader.load("Light.webp")},alphaTest:{value:.067},emission_gain:{value:.45},alpha:{value:1}},vertexShader:`\n\t\t\tprecision highp float;\n\t\t\tprecision highp int;\n\n\t\t\tattribute vec2 uv;\n\t\t\tattribute vec4 color;\n\t\t\tattribute vec3 position;\n\n\t\t\tuniform mat4 modelMatrix;\n\t\t\tuniform mat4 modelViewMatrix;\n\t\t\tuniform mat4 projectionMatrix;\n\t\t\tuniform mat4 viewMatrix;\n\t\t\tuniform mat3 normalMatrix;\n\t\t\tuniform vec3 cameraPosition;\n\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec3 vColor;\n\n\t\t\t${Xc.LinearToSrgb}\n\t\t\t${Xc.hsv}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvUv = uv;\n\n\t\t\t\tvColor = lookup(color.rgb);\n\n\t\t\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t}\n\t\t`,fragmentShader:`\n\t\t\tprecision highp float;\n\t\t\tprecision highp int;\n\n\t\t\tuniform float emission_gain;\n\n\t\t\tuniform sampler2D mainTex;\n\t\t\tuniform float alphaTest;\n\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec3 vColor;\n\n\t\t\t${Xc.BloomColor}\n\t\t\t${Xc.SrgbToLinear}\n\n\t\t\tvoid main(){\n\t\t\t\tvec4 col = texture2D(mainTex, vUv);\n\t\t\t\tvec3 color = vColor;\n\t\t\t\tcolor = BloomColor(color, emission_gain);\n\t\t\t\tcolor = color * col.rgb;\n\t\t\t\tcolor = color * col.a;\n\t\t\t\tcolor = SrgbToLinear(color);\n\t\t\t\tgl_FragColor = vec4(color, 1.0);\n\t\t\t}\n\t\t`,side:2,transparent:!0,depthFunc:2,depthWrite:!0,depthTest:!1,blending:5,blendDst:201,blendDstAlpha:201,blendEquation:100,blendEquationAlpha:100,blendSrc:201,blendSrcAlpha:201});default:return new a.MeshBasicMaterial({vertexColors:!0,side:a.DoubleSide})}}var Jc=r(1771);class qc extends a.Loader{constructor(e){super(e),this.hdrLoader=new qs.x,this.type=a.HalfFloatType}load(e,t,r,n){Array.isArray(e)||(console.warn("THREE.HDRCubeTextureLoader signature has changed. Use .setDataType() instead."),this.setDataType(e),e=t,t=r,r=n,n=arguments[4]);const i=new a.CubeTexture;switch(i.type=this.type,i.type){case a.FloatType:case a.HalfFloatType:i.encoding=a.LinearEncoding,i.minFilter=a.LinearFilter,i.magFilter=a.LinearFilter,i.generateMipmaps=!1}const o=this;let s=0;function l(t,r,n,l){new a.FileLoader(o.manager).setPath(o.path).setResponseType("arraybuffer").setWithCredentials(o.withCredentials).load(e[t],(function(e){s++;const n=o.hdrLoader.parse(e);if(n){if(void 0!==n.data){const e=new a.DataTexture(n.data,n.width,n.height);e.type=i.type,e.encoding=i.encoding,e.format=i.format,e.minFilter=i.minFilter,e.magFilter=i.magFilter,e.generateMipmaps=i.generateMipmaps,i.images[t]=e}6===s&&(i.needsUpdate=!0,r&&r(i))}}),n,l)}for(let a=0;a<e.length;a++)l(a,t,r,n);return i}setDataType(e){return this.type=e,this.hdrLoader.setDataType(e),this}}class Kc extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){function t(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function r(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}function n(e,t,r,n){const i=parseInt(u[n].substr(e,t));if(i){const e=(o=r,a=i,"s"+Math.min(o,a)+"e"+Math.max(o,a));void 0===l[e]&&(s.push([r-1,i-1,1]),l[e]=s.length-1)}var o,a}const i={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},o=[],s=[],l={},c={},u=e.split("\n");for(let a=0,h=u.length;a<h;a++)if("ATOM"===u[a].substr(0,4)||"HETATM"===u[a].substr(0,6)){const e=parseFloat(u[a].substr(30,7)),n=parseFloat(u[a].substr(38,7)),s=parseFloat(u[a].substr(46,7)),l=parseInt(u[a].substr(6,5))-1;let h=t(u[a].substr(76,2)).toLowerCase();""===h&&(h=t(u[a].substr(12,2)).toLowerCase());const d=[e,n,s,i[h],r(h)];o.push(d),c[l]=d}else if("CONECT"===u[a].substr(0,6)){const e=parseInt(u[a].substr(6,5));n(11,5,e,a),n(16,5,e,a),n(21,5,e,a),n(26,5,e,a)}return function(){const e={geometryAtoms:new a.BufferGeometry,geometryBonds:new a.BufferGeometry,json:{atoms:o}},t=e.geometryAtoms,r=e.geometryBonds,n=[],i=[],l=[];for(let a=0,s=o.length;a<s;a++){const e=o[a],t=e[0],r=e[1],s=e[2];n.push(t,r,s);const l=e[3][0]/255,c=e[3][1]/255,u=e[3][2]/255;i.push(l,c,u)}for(let o=0,a=s.length;o<a;o++){const e=s[o],t=e[0],r=e[1],n=c[t],i=c[r];let a=n[0],u=n[1],h=n[2];l.push(a,u,h),a=i[0],u=i[1],h=i[2],l.push(a,u,h)}return t.setAttribute("position",new a.Float32BufferAttribute(n,3)),t.setAttribute("color",new a.Float32BufferAttribute(i,3)),r.setAttribute("position",new a.Float32BufferAttribute(l,3)),e}()}}let $c=null;function eu(){if(null===$c){const e=new ArrayBuffer(2),t=new Uint8Array(e),r=new Uint16Array(e);t[0]=170,t[1]=187,$c=43707===r[0]}return $c}const tu=[null,Float32Array,null,Int8Array,Int16Array,null,Int32Array,Uint8Array,Uint16Array,null,Uint32Array],ru={Uint16Array:"getUint16",Uint32Array:"getUint32",Int16Array:"getInt16",Int32Array:"getInt32",Float32Array:"getFloat32",Float64Array:"getFloat64"};function nu(e,t,r,n,i){const o=t.BYTES_PER_ELEMENT;let a;if(i===eu()||1===o)a=new t(e,r,n);else{const s=new DataView(e,r,n*o),l=ru[t.name],c=!i;a=new t(n);for(let e=0;e<n;e++)a[e]=s[l](e*o,c)}return a}class iu extends a.Loader{constructor(e){super(e)}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),e=e.replace(/\*/g,eu()?"be":"le"),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){const t=function(e){const t=new Uint8Array(e),r=t[0];let n=t[1];const i=!!(n>>7&1),o=n>>6&1,a=1===(n>>5&1),s=31&n;let l=0,c=0;if(a?(l=(t[2]<<16)+(t[3]<<8)+t[4],c=(t[5]<<16)+(t[6]<<8)+t[7]):(l=t[2]+(t[3]<<8)+(t[4]<<16),c=t[5]+(t[6]<<8)+(t[7]<<16)),0===r)throw new Error("PRWM decoder: Invalid format version: 0");if(1!==r)throw new Error("PRWM decoder: Unsupported format version: "+r);if(!i){if(0!==o)throw new Error("PRWM decoder: Indices type must be set to 0 for non-indexed geometries");if(0!==c)throw new Error("PRWM decoder: Number of indices must be set to 0 for non-indexed geometries")}let u=8;const h={};for(let f=0;f<s;f++){let r="";for(;u<t.length;){const e=t[u];if(u++,0===e)break;r+=String.fromCharCode(e)}n=t[u];const i=n>>7&1,o=1+(n>>4&3),s=tu[15&n];u++,u=4*Math.ceil(u/4);const c=nu(e,s,u,o*l,a);u+=s.BYTES_PER_ELEMENT*o*l,h[r]={type:i,cardinality:o,values:c}}u=4*Math.ceil(u/4);let d=null;return i&&(d=nu(e,1===o?Uint32Array:Uint16Array,u,c,a)),{version:r,attributes:h,indices:d}}(e),r=Object.keys(t.attributes),n=new a.BufferGeometry;for(let i=0;i<r.length;i++){const e=t.attributes[r[i]];n.setAttribute(r[i],new a.BufferAttribute(e.values,e.cardinality,e.normalized))}return null!==t.indices&&n.setIndex(new a.BufferAttribute(t.indices,1)),n}static isBigEndianPlatform(){return eu()}}class ou extends a.DataTextureLoader{constructor(e){super(e),this.type=a.HalfFloatType,this.maxRange=7}setDataType(e){return this.type=e,this}setMaxRange(e){return this.maxRange=e,this}loadCubemap(e,t,r,n){const i=new a.CubeTexture;let o=0;const s=this;function l(r){s.load(e[r],(function(e){i.images[r]=e,o++,6===o&&(i.needsUpdate=!0,t&&t(i))}),void 0,n)}for(let a=0;a<e.length;++a)l(a);return i.type=this.type,i.format=a.RGBAFormat,i.minFilter=a.LinearFilter,i.generateMipmaps=!1,i}parse(e){const t=au.decode(e),r=au.toRGBA8(t)[0],n=new Uint8Array(r),i=t.width*t.height*4,o=this.type===a.HalfFloatType?new Uint16Array(i):new Float32Array(i);for(let s=0;s<n.length;s+=4){const e=n[s+0]/255,t=n[s+1]/255,r=n[s+2]/255,i=n[s+3]/255;this.type===a.HalfFloatType?(o[s+0]=a.DataUtils.toHalfFloat(Math.min(e*i*this.maxRange,65504)),o[s+1]=a.DataUtils.toHalfFloat(Math.min(t*i*this.maxRange,65504)),o[s+2]=a.DataUtils.toHalfFloat(Math.min(r*i*this.maxRange,65504)),o[s+3]=a.DataUtils.toHalfFloat(1)):(o[s+0]=e*i*this.maxRange,o[s+1]=t*i*this.maxRange,o[s+2]=r*i*this.maxRange,o[s+3]=1)}return{width:t.width,height:t.height,data:o,format:a.RGBAFormat,type:this.type,flipY:!0}}}var au={toRGBA8:function(e){var t=e.width,r=e.height;if(null==e.tabs.acTL)return[au.toRGBA8.decodeImage(e.data,t,r,e).buffer];var n=[];null==e.frames[0].data&&(e.frames[0].data=e.data);for(var i=t*r*4,o=new Uint8Array(i),a=new Uint8Array(i),s=new Uint8Array(i),l=0;l<e.frames.length;l++){var c=e.frames[l],u=c.rect.x,h=c.rect.y,d=c.rect.width,f=c.rect.height,p=au.toRGBA8.decodeImage(c.data,d,f,e);if(0!=l)for(var m=0;m<i;m++)s[m]=o[m];if(0==c.blend?au._copyTile(p,d,f,o,t,r,u,h,0):1==c.blend&&au._copyTile(p,d,f,o,t,r,u,h,1),n.push(o.buffer.slice(0)),0==c.dispose);else if(1==c.dispose)au._copyTile(a,d,f,o,t,r,u,h,0);else if(2==c.dispose)for(m=0;m<i;m++)o[m]=s[m]}return n}};au.toRGBA8.decodeImage=function(e,t,r,n){var i=t*r,o=au.decode._getBPP(n),a=Math.ceil(t*o/8),s=new Uint8Array(4*i),l=new Uint32Array(s.buffer),c=n.ctype,u=n.depth,h=au._bin.readUshort;if(6==c){var d=i<<2;if(8==u)for(var f=0;f<d;f+=4)s[f]=e[f],s[f+1]=e[f+1],s[f+2]=e[f+2],s[f+3]=e[f+3];if(16==u)for(f=0;f<d;f++)s[f]=e[f<<1]}else if(2==c){var p=n.tabs.tRNS;if(null==p){if(8==u)for(f=0;f<i;f++){var m=3*f;l[f]=255<<24|e[m+2]<<16|e[m+1]<<8|e[m]}if(16==u)for(f=0;f<i;f++){m=6*f;l[f]=255<<24|e[m+4]<<16|e[m+2]<<8|e[m]}}else{var g=p[0],A=p[1],v=p[2];if(8==u)for(f=0;f<i;f++){var y=f<<2;m=3*f;l[f]=255<<24|e[m+2]<<16|e[m+1]<<8|e[m],e[m]==g&&e[m+1]==A&&e[m+2]==v&&(s[y+3]=0)}if(16==u)for(f=0;f<i;f++){y=f<<2,m=6*f;l[f]=255<<24|e[m+4]<<16|e[m+2]<<8|e[m],h(e,m)==g&&h(e,m+2)==A&&h(e,m+4)==v&&(s[y+3]=0)}}}else if(3==c){var x=n.tabs.PLTE,b=n.tabs.tRNS,w=b?b.length:0;if(1==u)for(var C=0;C<r;C++){var E=C*a,S=C*t;for(f=0;f<t;f++){y=S+f<<2;var T=3*(M=e[E+(f>>3)]>>7-((7&f)<<0)&1);s[y]=x[T],s[y+1]=x[T+1],s[y+2]=x[T+2],s[y+3]=M<w?b[M]:255}}if(2==u)for(C=0;C<r;C++)for(E=C*a,S=C*t,f=0;f<t;f++){y=S+f<<2,T=3*(M=e[E+(f>>2)]>>6-((3&f)<<1)&3);s[y]=x[T],s[y+1]=x[T+1],s[y+2]=x[T+2],s[y+3]=M<w?b[M]:255}if(4==u)for(C=0;C<r;C++)for(E=C*a,S=C*t,f=0;f<t;f++){y=S+f<<2,T=3*(M=e[E+(f>>1)]>>4-((1&f)<<2)&15);s[y]=x[T],s[y+1]=x[T+1],s[y+2]=x[T+2],s[y+3]=M<w?b[M]:255}if(8==u)for(f=0;f<i;f++){var M;y=f<<2,T=3*(M=e[f]);s[y]=x[T],s[y+1]=x[T+1],s[y+2]=x[T+2],s[y+3]=M<w?b[M]:255}}else if(4==c){if(8==u)for(f=0;f<i;f++){y=f<<2;var I=e[B=f<<1];s[y]=I,s[y+1]=I,s[y+2]=I,s[y+3]=e[B+1]}if(16==u)for(f=0;f<i;f++){var B;y=f<<2,I=e[B=f<<2];s[y]=I,s[y+1]=I,s[y+2]=I,s[y+3]=e[B+2]}}else if(0==c)for(g=n.tabs.tRNS?n.tabs.tRNS:-1,C=0;C<r;C++){var _=C*a,F=C*t;if(1==u)for(var P=0;P<t;P++){var R=(I=255*(e[_+(P>>>3)]>>>7-(7&P)&1))==255*g?0:255;l[F+P]=R<<24|I<<16|I<<8|I}else if(2==u)for(P=0;P<t;P++){R=(I=85*(e[_+(P>>>2)]>>>6-((3&P)<<1)&3))==85*g?0:255;l[F+P]=R<<24|I<<16|I<<8|I}else if(4==u)for(P=0;P<t;P++){R=(I=17*(e[_+(P>>>1)]>>>4-((1&P)<<2)&15))==17*g?0:255;l[F+P]=R<<24|I<<16|I<<8|I}else if(8==u)for(P=0;P<t;P++){R=(I=e[_+P])==g?0:255;l[F+P]=R<<24|I<<16|I<<8|I}else if(16==u)for(P=0;P<t;P++){I=e[_+(P<<1)],R=h(e,_+(P<<1))==g?0:255;l[F+P]=R<<24|I<<16|I<<8|I}}return s},au.decode=function(e){for(var t,r=new Uint8Array(e),n=8,i=au._bin,o=i.readUshort,a=i.readUint,s={tabs:{},frames:[]},l=new Uint8Array(r.length),c=0,u=0,h=[137,80,78,71,13,10,26,10],d=0;d<8;d++)if(r[d]!=h[d])throw"The input is not a PNG file!";for(;n<r.length;){var f=i.readUint(r,n);n+=4;var p=i.readASCII(r,n,4);if(n+=4,"IHDR"==p)au.decode._IHDR(r,n,s);else if("CgBI"==p)s.tabs[p]=r.slice(n,n+4);else if("IDAT"==p){for(d=0;d<f;d++)l[c+d]=r[n+d];c+=f}else if("acTL"==p)s.tabs[p]={num_frames:a(r,n),num_plays:a(r,n+4)},t=new Uint8Array(r.length);else if("fcTL"==p){var m;if(0!=u)(m=s.frames[s.frames.length-1]).data=au.decode._decompress(s,t.slice(0,u),m.rect.width,m.rect.height),u=0;var g={x:a(r,n+12),y:a(r,n+16),width:a(r,n+4),height:a(r,n+8)},A=o(r,n+22);A=o(r,n+20)/(0==A?100:A);var v={rect:g,delay:Math.round(1e3*A),dispose:r[n+24],blend:r[n+25]};s.frames.push(v)}else if("fdAT"==p){for(d=0;d<f-4;d++)t[u+d]=r[n+d+4];u+=f-4}else if("pHYs"==p)s.tabs[p]=[i.readUint(r,n),i.readUint(r,n+4),r[n+8]];else if("cHRM"==p){s.tabs[p]=[];for(d=0;d<8;d++)s.tabs[p].push(i.readUint(r,n+4*d))}else if("tEXt"==p||"zTXt"==p){null==s.tabs[p]&&(s.tabs[p]={});var y=i.nextZero(r,n),x=i.readASCII(r,n,y-n),b=n+f-y-1;if("tEXt"==p)S=i.readASCII(r,y+1,b);else{var w=au.decode._inflate(r.slice(y+2,y+2+b));S=i.readUTF8(w,0,w.length)}s.tabs[p][x]=S}else if("iTXt"==p){null==s.tabs[p]&&(s.tabs[p]={});y=0;var C=n;y=i.nextZero(r,C);x=i.readASCII(r,C,y-C);var E=r[C=y+1];C+=2,y=i.nextZero(r,C),i.readASCII(r,C,y-C),C=y+1,y=i.nextZero(r,C),i.readUTF8(r,C,y-C);var S;b=f-((C=y+1)-n);if(0==E)S=i.readUTF8(r,C,b);else{w=au.decode._inflate(r.slice(C,C+b));S=i.readUTF8(w,0,w.length)}s.tabs[p][x]=S}else if("PLTE"==p)s.tabs[p]=i.readBytes(r,n,f);else if("hIST"==p){var T=s.tabs.PLTE.length/3;s.tabs[p]=[];for(d=0;d<T;d++)s.tabs[p].push(o(r,n+2*d))}else if("tRNS"==p)3==s.ctype?s.tabs[p]=i.readBytes(r,n,f):0==s.ctype?s.tabs[p]=o(r,n):2==s.ctype&&(s.tabs[p]=[o(r,n),o(r,n+2),o(r,n+4)]);else if("gAMA"==p)s.tabs[p]=i.readUint(r,n)/1e5;else if("sRGB"==p)s.tabs[p]=r[n];else if("bKGD"==p)0==s.ctype||4==s.ctype?s.tabs[p]=[o(r,n)]:2==s.ctype||6==s.ctype?s.tabs[p]=[o(r,n),o(r,n+2),o(r,n+4)]:3==s.ctype&&(s.tabs[p]=r[n]);else if("IEND"==p)break;n+=f,i.readUint(r,n),n+=4}0!=u&&((m=s.frames[s.frames.length-1]).data=au.decode._decompress(s,t.slice(0,u),m.rect.width,m.rect.height));return s.data=au.decode._decompress(s,l,s.width,s.height),delete s.compress,delete s.interlace,delete s.filter,s},au.decode._decompress=function(e,t,r,n){var i=au.decode._getBPP(e),o=Math.ceil(r*i/8),a=new Uint8Array((o+1+e.interlace)*n);return t=e.tabs.CgBI?au.inflateRaw(t,a):au.decode._inflate(t,a),0==e.interlace?t=au.decode._filterZero(t,e,0,r,n):1==e.interlace&&(t=au.decode._readInterlace(t,e)),t},au.decode._inflate=function(e,t){return au.inflateRaw(new Uint8Array(e.buffer,2,e.length-6),t)},au.inflateRaw=function(){var e={H:{}};return e.H.N=function(t,r){var n,i,o=Uint8Array,a=0,s=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0;if(3==t[0]&&0==t[1])return r||new o(0);var m=e.H,g=m.b,A=m.e,v=m.R,y=m.n,x=m.A,b=m.Z,w=m.m,C=null==r;for(C&&(r=new o(t.length>>>2<<5));0==a;)if(a=g(t,p,1),s=g(t,p+1,2),p+=3,0!=s){if(C&&(r=e.H.W(r,f+(1<<17))),1==s&&(n=w.J,i=w.h,h=511,d=31),2==s){l=A(t,p,5)+257,c=A(t,p+5,5)+1,u=A(t,p+10,4)+4,p+=14;for(var E=1,S=0;S<38;S+=2)w.Q[S]=0,w.Q[S+1]=0;for(S=0;S<u;S++){var T=A(t,p+3*S,3);w.Q[1+(w.X[S]<<1)]=T,T>E&&(E=T)}p+=3*u,y(w.Q,E),x(w.Q,E,w.u),n=w.w,i=w.d,p=v(w.u,(1<<E)-1,l+c,t,p,w.v);var M=m.V(w.v,0,l,w.C);h=(1<<M)-1;var I=m.V(w.v,l,c,w.D);d=(1<<I)-1,y(w.C,M),x(w.C,M,n),y(w.D,I),x(w.D,I,i)}for(;;){var B=n[b(t,p)&h];p+=15&B;var _=B>>>4;if(_>>>8==0)r[f++]=_;else{if(256==_)break;var F=f+_-254;if(_>264){var P=w.q[_-257];F=f+(P>>>3)+A(t,p,7&P),p+=7&P}var R=i[b(t,p)&d];p+=15&R;var L=R>>>4,D=w.c[L],N=(D>>>4)+g(t,p,15&D);for(p+=15&D;f<F;)r[f]=r[f++-N],r[f]=r[f++-N],r[f]=r[f++-N],r[f]=r[f++-N];f=F}}}else{0!=(7&p)&&(p+=8-(7&p));var k=4+(p>>>3),O=t[k-4]|t[k-3]<<8;C&&(r=e.H.W(r,f+O)),r.set(new o(t.buffer,t.byteOffset+k,O),f),p=k+O<<3,f+=O}return r.length==f?r:r.slice(0,f)},e.H.W=function(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(r<<1);return n.set(e,0),n},e.H.R=function(t,r,n,i,o,a){for(var s=e.H.e,l=e.H.Z,c=0;c<n;){var u=t[l(i,o)&r];o+=15&u;var h=u>>>4;if(h<=15)a[c]=h,c++;else{var d=0,f=0;16==h?(f=3+s(i,o,2),o+=2,d=a[c-1]):17==h?(f=3+s(i,o,3),o+=3):18==h&&(f=11+s(i,o,7),o+=7);for(var p=c+f;c<p;)a[c]=d,c++}}return o},e.H.V=function(e,t,r,n){for(var i=0,o=0,a=n.length>>>1;o<r;){var s=e[o+t];n[o<<1]=0,n[1+(o<<1)]=s,s>i&&(i=s),o++}for(;o<a;)n[o<<1]=0,n[1+(o<<1)]=0,o++;return i},e.H.n=function(t,r){for(var n,i,o,a,s=e.H.m,l=t.length,c=s.j,u=0;u<=r;u++)c[u]=0;for(u=1;u<l;u+=2)c[t[u]]++;var h=s.K;for(n=0,c[0]=0,i=1;i<=r;i++)n=n+c[i-1]<<1,h[i]=n;for(o=0;o<l;o+=2)0!=(a=t[o+1])&&(t[o]=h[a],h[a]++)},e.H.A=function(t,r,n){for(var i=t.length,o=e.H.m.r,a=0;a<i;a+=2)if(0!=t[a+1])for(var s=a>>1,l=t[a+1],c=s<<4|l,u=r-l,h=t[a]<<u,d=h+(1<<u);h!=d;){n[o[h]>>>15-r]=c,h++}},e.H.l=function(t,r){for(var n=e.H.m.r,i=15-r,o=0;o<t.length;o+=2){var a=t[o]<<r-t[o+1];t[o]=n[a]>>>i}},e.H.M=function(e,t,r){r<<=7&t;var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8},e.H.I=function(e,t,r){r<<=7&t;var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},e.H.e=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1},e.H.b=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1},e.H.Z=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},e.H.i=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},e.H.m=function(){var e=Uint16Array,t=Uint32Array;return{K:new e(16),j:new e(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new e(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new t(32),J:new e(512),_:[],h:new e(32),$:[],w:new e(32768),C:[],v:[],d:new e(32768),D:[],u:new e(512),Q:[],r:new e(32768),s:new t(286),Y:new t(30),a:new t(19),t:new t(15e3),k:new e(65536),g:new e(32768)}}(),function(){for(var t=e.H.m,r=0;r<32768;r++){var n=r;n=(4278255360&(n=(4042322160&(n=(3435973836&(n=(2863311530&n)>>>1|(1431655765&n)<<1))>>>2|(858993459&n)<<2))>>>4|(252645135&n)<<4))>>>8|(16711935&n)<<8,t.r[r]=(n>>>16|n<<16)>>>17}function i(e,t,r){for(;0!=t--;)e.push(0,r)}for(r=0;r<32;r++)t.q[r]=t.S[r]<<3|t.T[r],t.c[r]=t.p[r]<<4|t.z[r];i(t._,144,8),i(t._,112,9),i(t._,24,7),i(t._,8,8),e.H.n(t._,9),e.H.A(t._,9,t.J),e.H.l(t._,9),i(t.$,32,5),e.H.n(t.$,5),e.H.A(t.$,5,t.h),e.H.l(t.$,5),i(t.Q,19,0),i(t.C,286,0),i(t.D,30,0),i(t.v,320,0)}(),e.H.N}(),au.decode._readInterlace=function(e,t){for(var r=t.width,n=t.height,i=au.decode._getBPP(t),o=i>>3,a=Math.ceil(r*i/8),s=new Uint8Array(n*a),l=0,c=[0,0,4,0,2,0,1],u=[0,4,0,2,0,1,0],h=[8,8,8,4,4,2,2],d=[8,8,4,4,2,2,1],f=0;f<7;){for(var p=h[f],m=d[f],g=0,A=0,v=c[f];v<n;)v+=p,A++;for(var y=u[f];y<r;)y+=m,g++;var x=Math.ceil(g*i/8);au.decode._filterZero(e,t,l,g,A);for(var b=0,w=c[f];w<n;){for(var C=u[f],E=l+b*x<<3;C<r;){var S;if(1==i)S=(S=e[E>>3])>>7-(7&E)&1,s[w*a+(C>>3)]|=S<<7-((7&C)<<0);if(2==i)S=(S=e[E>>3])>>6-(7&E)&3,s[w*a+(C>>2)]|=S<<6-((3&C)<<1);if(4==i)S=(S=e[E>>3])>>4-(7&E)&15,s[w*a+(C>>1)]|=S<<4-((1&C)<<2);if(i>=8)for(var T=w*a+C*o,M=0;M<o;M++)s[T+M]=e[(E>>3)+M];E+=i,C+=m}b++,w+=p}g*A!=0&&(l+=A*(1+x)),f+=1}return s},au.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},au.decode._filterZero=function(e,t,r,n,i){var o=au.decode._getBPP(t),a=Math.ceil(n*o/8),s=au.decode._paeth;o=Math.ceil(o/8);var l,c,u=e[r],h=0;if(u>1&&(e[r]=[0,0,1][u-2]),3==u)for(h=o;h<a;h++)e[h+1]=e[h+1]+(e[h+1-o]>>>1)&255;for(var d=0;d<i;d++)if(h=0,0==(u=e[(c=(l=r+d*a)+d+1)-1]))for(;h<a;h++)e[l+h]=e[c+h];else if(1==u){for(;h<o;h++)e[l+h]=e[c+h];for(;h<a;h++)e[l+h]=e[c+h]+e[l+h-o]}else if(2==u)for(;h<a;h++)e[l+h]=e[c+h]+e[l+h-a];else if(3==u){for(;h<o;h++)e[l+h]=e[c+h]+(e[l+h-a]>>>1);for(;h<a;h++)e[l+h]=e[c+h]+(e[l+h-a]+e[l+h-o]>>>1)}else{for(;h<o;h++)e[l+h]=e[c+h]+s(0,e[l+h-a],0);for(;h<a;h++)e[l+h]=e[c+h]+s(e[l+h-o],e[l+h-a],e[l+h-o-a])}return e},au.decode._paeth=function(e,t,r){var n=e+t-r,i=n-e,o=n-t,a=n-r;return i*i<=o*o&&i*i<=a*a?e:o*o<=a*a?t:r},au.decode._IHDR=function(e,t,r){var n=au._bin;r.width=n.readUint(e,t),t+=4,r.height=n.readUint(e,t),t+=4,r.depth=e[t],t++,r.ctype=e[t],t++,r.compress=e[t],t++,r.filter=e[t],t++,r.interlace=e[t],t++},au._bin={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},writeUshort:function(e,t,r){e[t]=r>>8&255,e[t+1]=255&r},readUint:function(e,t){return 16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3])},writeUint:function(e,t,r){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},readASCII:function(e,t,r){for(var n="",i=0;i<r;i++)n+=String.fromCharCode(e[t+i]);return n},writeASCII:function(e,t,r){for(var n=0;n<r.length;n++)e[t+n]=r.charCodeAt(n)},readBytes:function(e,t,r){for(var n=[],i=0;i<r;i++)n.push(e[t+i]);return n},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,r){for(var n,i="",o=0;o<r;o++)i+="%"+au._bin.pad(e[t+o].toString(16));try{n=decodeURIComponent(i)}catch(a){return au._bin.readASCII(e,t,r)}return n}},au._copyTile=function(e,t,r,n,i,o,a,s,l){for(var c=Math.min(t,i),u=Math.min(r,o),h=0,d=0,f=0;f<u;f++)for(var p=0;p<c;p++)if(a>=0&&s>=0?(h=f*t+p<<2,d=(s+f)*i+a+p<<2):(h=(-s+f)*t-a+p<<2,d=f*i+p<<2),0==l)n[d]=e[h],n[d+1]=e[h+1],n[d+2]=e[h+2],n[d+3]=e[h+3];else if(1==l){var m=e[h+3]*(1/255),g=e[h]*m,A=e[h+1]*m,v=e[h+2]*m,y=n[d+3]*(1/255),x=n[d]*y,b=n[d+1]*y,w=n[d+2]*y,C=1-m,E=m+y*C,S=0==E?0:1/E;n[d+3]=255*E,n[d+0]=(g+x*C)*S,n[d+1]=(A+b*C)*S,n[d+2]=(v+w*C)*S}else if(2==l){m=e[h+3],g=e[h],A=e[h+1],v=e[h+2],y=n[d+3],x=n[d],b=n[d+1],w=n[d+2];m==y&&g==x&&A==b&&v==w?(n[d]=0,n[d+1]=0,n[d+2]=0,n[d+3]=0):(n[d]=g,n[d+1]=A,n[d+2]=v,n[d+3]=m)}else if(3==l){m=e[h+3],g=e[h],A=e[h+1],v=e[h+2],y=n[d+3],x=n[d],b=n[d+1],w=n[d+2];if(m==y&&g==x&&A==b&&v==w)continue;if(m<220&&y>20)return!1}return!0};class su extends a.Loader{load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e){const t=new DataView(e),r=t.getUint32(0,!0),n=t.getUint32(4,!0);if(542658390!==r||150!==n)return void console.error("Not a valid VOX file");const i=[0,4294967295,4291624959,4288282623,4284940287,4281597951,4278255615,4294954239,4291611903,4288269567,4284927231,4281584895,4278242559,4294941183,4291598847,4288256511,4284914175,4281571839,4278229503,4294928127,4291585791,4288243455,4284901119,4281558783,4278216447,4294915071,4291572735,4288230399,4284888063,4281545727,4278203391,4294902015,4291559679,4288217343,4284875007,4281532671,4278190335,4294967244,4291624908,4288282572,4284940236,4281597900,4278255564,4294954188,4291611852,4288269516,4284927180,4281584844,4278242508,4294941132,4291598796,4288256460,4284914124,4281571788,4278229452,4294928076,4291585740,4288243404,4284901068,4281558732,4278216396,4294915020,4291572684,4288230348,4284888012,4281545676,4278203340,4294901964,4291559628,4288217292,4284874956,4281532620,4278190284,4294967193,4291624857,4288282521,4284940185,4281597849,4278255513,4294954137,4291611801,4288269465,4284927129,4281584793,4278242457,4294941081,4291598745,4288256409,4284914073,4281571737,4278229401,4294928025,4291585689,4288243353,4284901017,4281558681,4278216345,4294914969,4291572633,4288230297,4284887961,4281545625,4278203289,4294901913,4291559577,4288217241,4284874905,4281532569,4278190233,4294967142,4291624806,4288282470,4284940134,4281597798,4278255462,4294954086,4291611750,4288269414,4284927078,4281584742,4278242406,4294941030,4291598694,4288256358,4284914022,4281571686,4278229350,4294927974,4291585638,4288243302,4284900966,4281558630,4278216294,4294914918,4291572582,4288230246,4284887910,4281545574,4278203238,4294901862,4291559526,4288217190,4284874854,4281532518,4278190182,4294967091,4291624755,4288282419,4284940083,4281597747,4278255411,4294954035,4291611699,4288269363,4284927027,4281584691,4278242355,4294940979,4291598643,4288256307,4284913971,4281571635,4278229299,4294927923,4291585587,4288243251,4284900915,4281558579,4278216243,4294914867,4291572531,4288230195,4284887859,4281545523,4278203187,4294901811,4291559475,4288217139,4284874803,4281532467,4278190131,4294967040,4291624704,4288282368,4284940032,4281597696,4278255360,4294953984,4291611648,4288269312,4284926976,4281584640,4278242304,4294940928,4291598592,4288256256,4284913920,4281571584,4278229248,4294927872,4291585536,4288243200,4284900864,4281558528,4278216192,4294914816,4291572480,4288230144,4284887808,4281545472,4278203136,4294901760,4291559424,4288217088,4284874752,4281532416,4278190318,4278190301,4278190267,4278190250,4278190216,4278190199,4278190165,4278190148,4278190114,4278190097,4278251008,4278246656,4278237952,4278233600,4278224896,4278220544,4278211840,4278207488,4278198784,4278194432,4293787648,4292673536,4290445312,4289331200,4287102976,4285988864,4283760640,4282646528,4280418304,4279304192,4293848814,4292730333,4290493371,4289374890,4287137928,4286019447,4283782485,4282664004,4280427042,4279308561];let o,a=8;const s=[];for(;a<t.byteLength;){let r="";for(let e=0;e<4;e++)r+=String.fromCharCode(t.getUint8(a++,!0));const n=t.getUint32(a,!0);if(a+=4,t.getUint32(a,!0),a+=4,"SIZE"===r){const e=t.getUint32(a,!0);a+=4;const r=t.getUint32(a,!0);a+=4;const l=t.getUint32(a,!0);a+=4,o={palette:i,size:{x:e,y:r,z:l}},s.push(o),a+=n-12}else if("XYZI"===r){const r=t.getUint32(a,!0);a+=4,o.data=new Uint8Array(e,a,4*r),a+=4*r}else if("RGBA"===r){const e=[0];for(let r=0;r<256;r++)e[r+1]=t.getUint32(a,!0),a+=4;o.palette=e}else a+=n}return s}}class lu extends a.Mesh{constructor(e){const t=e.data,r=e.size,n=e.palette,i=[],o=[],s=[0,0,0,0,0,1,0,1,0,0,1,1,0,1,0,0,0,1],l=[1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0],c=[0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,1],u=[0,0,0,0,1,0,1,0,0,1,1,0,1,0,0,0,1,0],h=[0,0,1,0,0,0,1,0,1,1,0,0,1,0,1,0,0,0],d=[0,1,1,1,1,1,0,1,0,1,1,0,0,1,0,1,1,1];function f(e,t,n,a,s,l,c){t-=r.x/2,n-=r.z/2,a+=r.y/2;for(let r=0;r<18;r+=3)i.push(e[r+0]+t,e[r+1]+n,e[r+2]+a),o.push(s,l,c)}const p=r.x,m=r.x*r.y,g=new Uint8Array(r.x*r.y*r.z);for(let a=0;a<t.length;a+=4){g[t[a+0]+t[a+1]*p+t[a+2]*m]=255}let A=!1;for(let a=0;a<t.length;a+=4){const e=t[a+0],i=t[a+1],o=t[a+2],v=n[t[a+3]],y=(v>>0&255)/255,x=(v>>8&255)/255,b=(v>>16&255)/255;(y>0||x>0||b>0)&&(A=!0);const w=e+i*p+o*m;0!==g[w+1]&&e!==r.x-1||f(l,e,o,-i,y,x,b),0!==g[w-1]&&0!==e||f(s,e,o,-i,y,x,b),0!==g[w+p]&&i!==r.y-1||f(u,e,o,-i,y,x,b),0!==g[w-p]&&0!==i||f(c,e,o,-i,y,x,b),0!==g[w+m]&&o!==r.z-1||f(d,e,o,-i,y,x,b),0!==g[w-m]&&0!==o||f(h,e,o,-i,y,x,b)}const v=new a.BufferGeometry;v.setAttribute("position",new a.Float32BufferAttribute(i,3)),v.computeVertexNormals();const y=new a.MeshStandardMaterial;A&&(v.setAttribute("color",new a.Float32BufferAttribute(o,3)),y.vertexColors=!0),super(v,y)}}class cu extends a.DataTexture3D{constructor(e){const t=e.data,r=e.size,n=r.x,i=r.x*r.y,o=new Uint8Array(r.x*r.y*r.z);for(let a=0;a<t.length;a+=4){o[t[a+0]+t[a+1]*n+t[a+2]*i]=255}super(o,r.x,r.y,r.z),this.format=a.RedFormat,this.minFilter=a.NearestFilter,this.magFilter=a.LinearFilter,this.unpackAlignment=1}}class uu extends a.Loader{constructor(e,t={}){super(e),this.nodes={},this.materials={},this.passes={},this.names={},this.library=t}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);return o.setPath(i.path),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),r,n),this}getObjectByName(e){return this.names[e]}getObjectById(e){return this.library[e]||this.nodes[e]||this.materials[e]||this.passes[e]||this.names[e]}getNode(e){const t=this.getObjectById(e);return t||console.warn('Node "'+e+'" not found.'),t}resolve(e){switch(typeof e){case"boolean":case"number":return e;case"string":return/^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}$/i.test(e)||this.library[e]?this.getNode(e):e;default:if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t]=this.resolve(e[t]);else for(const t in e)"uuid"!==t&&(e[t]=this.resolve(e[t]))}return e}declare(e){let t,r,n;for(t in e.nodes)r=e.nodes[t],n=new o[r.nodeType+"Node"],r.name&&(n.name=r.name,this.names[n.name]=n),this.nodes[t]=n;for(t in e.materials)r=e.materials[t],n=new o[r.type],r.name&&(n.name=r.name,this.names[n.name]=n),this.materials[t]=n;for(t in e.passes)r=e.passes[t],n=new o[r.type],r.name&&(n.name=r.name,this.names[n.name]=n),this.passes[t]=n;return e.material&&(this.material=this.materials[e.material]),e.pass&&(this.pass=this.passes[e.pass]),e}parse(e){let t;for(t in(e=this.resolve(this.declare(e))).nodes)this.nodes[t].copy(e.nodes[t]);for(t in e.materials)this.materials[t].copy(e.materials[t]);for(t in e.passes)this.passes[t].copy(e.passes[t]);return this.material||this.pass||this}}class hu{static replaceUUIDObject(e,t,r,n){if(n=void 0===n||n,"object"===typeof t&&(t=t.uuid),"object"===typeof e){const i=Object.keys(e);for(let o=0;o<i.length;o++){const a=i[o];n&&(e[a]=this.replaceUUIDObject(e[a],t,r)),a===t&&(e[t]=e[a],delete e[a])}}return e===t?r:e}static replaceUUID(e,t,r){return this.replaceUUIDObject(e,t,r,!1),this.replaceUUIDObject(e.nodes,t,r),this.replaceUUIDObject(e.materials,t,r),this.replaceUUIDObject(e.passes,t,r),this.replaceUUIDObject(e.library,t,r,!1),e}}class du extends a.Loader{constructor(e){super(e),this.littleEndian=!0}load(e,t,r,n){const i=this,o=new a.FileLoader(i.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(r){try{t(i.parse(r,e))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}parse(e,t){const r=a.LoaderUtils.decodeText(new Uint8Array(e)),n=function(e){const t={},r=e.search(/[\r\n]DATA\s(\S*)\s/i),n=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(r-1));if(t.data=n[1],t.headerLen=n[0].length+r,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),null!==t.fields&&(t.fields=t.fields[1].split(" ")),null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map((function(e){return parseInt(e,10)}))),null!==t.count)t.count=t.count[1].split(" ").map((function(e){return parseInt(e,10)}));else{t.count=[];for(let e=0,r=t.fields.length;e<r;e++)t.count.push(1)}t.offset={};let i=0;for(let o=0,a=t.fields.length;o<a;o++)"ascii"===t.data?t.offset[t.fields[o]]=o:(t.offset[t.fields[o]]=i,i+=t.size[o]*t.count[o]);return t.rowSize=i,t}(r),i=[],o=[],s=[];if("ascii"===n.data){const e=n.offset,t=r.substr(n.headerLen).split("\n");for(let r=0,n=t.length;r<n;r++){if(""===t[r])continue;const n=t[r].split(" ");if(void 0!==e.x&&(i.push(parseFloat(n[e.x])),i.push(parseFloat(n[e.y])),i.push(parseFloat(n[e.z]))),void 0!==e.rgb){const t=parseFloat(n[e.rgb]),r=t>>16&255,i=t>>8&255,o=t>>0&255;s.push(r/255,i/255,o/255)}void 0!==e.normal_x&&(o.push(parseFloat(n[e.normal_x])),o.push(parseFloat(n[e.normal_y])),o.push(parseFloat(n[e.normal_z])))}}if("binary_compressed"===n.data){const t=new Uint32Array(e.slice(n.headerLen,n.headerLen+8)),r=t[0],a=t[1],l=function(e,t){const r=e.length,n=new Uint8Array(t);let i,o,a,s=0,l=0;do{if(i=e[s++],i<32){if(i++,l+i>t)throw new Error("Output buffer is not large enough");if(s+i>r)throw new Error("Invalid compressed data");do{n[l++]=e[s++]}while(--i)}else{if(o=i>>5,a=l-((31&i)<<8)-1,s>=r)throw new Error("Invalid compressed data");if(7===o&&(o+=e[s++],s>=r))throw new Error("Invalid compressed data");if(a-=e[s++],l+o+2>t)throw new Error("Output buffer is not large enough");if(a<0)throw new Error("Invalid compressed data");if(a>=l)throw new Error("Invalid compressed data");do{n[l++]=n[a++]}while(2+--o)}}while(s<r);return n}(new Uint8Array(e,n.headerLen+8,r),a),c=new DataView(l.buffer),u=n.offset;for(let e=0;e<n.points;e++)void 0!==u.x&&(i.push(c.getFloat32(n.points*u.x+n.size[0]*e,this.littleEndian)),i.push(c.getFloat32(n.points*u.y+n.size[1]*e,this.littleEndian)),i.push(c.getFloat32(n.points*u.z+n.size[2]*e,this.littleEndian))),void 0!==u.rgb&&(s.push(c.getUint8(n.points*u.rgb+n.size[3]*e+2)/255),s.push(c.getUint8(n.points*u.rgb+n.size[3]*e+1)/255),s.push(c.getUint8(n.points*u.rgb+n.size[3]*e+0)/255)),void 0!==u.normal_x&&(o.push(c.getFloat32(n.points*u.normal_x+n.size[4]*e,this.littleEndian)),o.push(c.getFloat32(n.points*u.normal_y+n.size[5]*e,this.littleEndian)),o.push(c.getFloat32(n.points*u.normal_z+n.size[6]*e,this.littleEndian)))}if("binary"===n.data){const t=new DataView(e,n.headerLen),r=n.offset;for(let e=0,a=0;e<n.points;e++,a+=n.rowSize)void 0!==r.x&&(i.push(t.getFloat32(a+r.x,this.littleEndian)),i.push(t.getFloat32(a+r.y,this.littleEndian)),i.push(t.getFloat32(a+r.z,this.littleEndian))),void 0!==r.rgb&&(s.push(t.getUint8(a+r.rgb+2)/255),s.push(t.getUint8(a+r.rgb+1)/255),s.push(t.getUint8(a+r.rgb+0)/255)),void 0!==r.normal_x&&(o.push(t.getFloat32(a+r.normal_x,this.littleEndian)),o.push(t.getFloat32(a+r.normal_y,this.littleEndian)),o.push(t.getFloat32(a+r.normal_z,this.littleEndian)))}const l=new a.BufferGeometry;i.length>0&&l.setAttribute("position",new a.Float32BufferAttribute(i,3)),o.length>0&&l.setAttribute("normal",new a.Float32BufferAttribute(o,3)),s.length>0&&l.setAttribute("color",new a.Float32BufferAttribute(s,3)),l.computeBoundingSphere();const c=new a.PointsMaterial({size:.005});s.length>0?c.vertexColors=!0:c.color.setHex(16777215*Math.random());const u=new a.Points(l,c);let h=t.split("").reverse().join("");return h=/([^\/]*)/.exec(h),h=h[1].split("").reverse().join(""),u.name=h,u}}let fu;class pu extends a.Loader{constructor(e,t={}){super(e),this.resourcePath=void 0!==t.resourcePath?t.resourcePath:""}load(e,t,r,n){const i=this,o=""===i.path?function(e,t){const r=e.indexOf(t);return-1===r?"./":e.substr(0,r)}(e,"Objects"):i.path,s=e.split(o).pop().split(".")[0],l=new a.FileLoader(this.manager);l.setPath(i.path),l.setResponseType("arraybuffer"),l.load(e,(function(r){try{t(i.parse(r,o,s))}catch(a){n?n(a):console.error(a),i.manager.itemError(e)}}),r,n)}parse(e,t,r){fu=(new mc).parse(e);const n=new a.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new mu(n).parse(r)}}class mu{constructor(e){this.textureLoader=e}parse(e){return this.materials=new gu(this.textureLoader).parse(),this.defaultLayerName=e,this.meshes=this.parseLayers(),{materials:this.materials,meshes:this.meshes}}parseLayers(){const e=[],t=[],r=new Au,n=this;return fu.layers.forEach((function(i){const o=r.parse(i.geometry,i),a=n.parseMesh(o,i);e[i.number]=a,-1===i.parent?t.push(a):e[i.parent].add(a)})),this.applyPivots(t),t}parseMesh(e,t){let r;const n=this.getMaterials(e.userData.matNames,t.geometry.type);return this.duplicateUVs(e,n),r="points"===t.geometry.type?new a.Points(e,n):"lines"===t.geometry.type?new a.LineSegments(e,n):new a.Mesh(e,n),t.name?r.name=t.name:r.name=this.defaultLayerName+"_layer_"+t.number,r.userData.pivot=t.pivot,r}applyPivots(e){e.forEach((function(e){e.traverse((function(e){const t=e.userData.pivot;if(e.position.x+=t[0],e.position.y+=t[1],e.position.z+=t[2],e.parent){const t=e.parent.userData.pivot;e.position.x-=t[0],e.position.y-=t[1],e.position.z-=t[2]}}))}))}getMaterials(e,t){const r=[],n=this;e.forEach((function(e,t){r[t]=n.getMaterialByName(e)})),"points"!==t&&"lines"!==t||r.forEach((function(e,n){const i={color:e.color};"points"===t?(i.size=.1,i.map=e.map,i.morphTargets=e.morphTargets,r[n]=new a.PointsMaterial(i)):"lines"===t&&(r[n]=new a.LineBasicMaterial(i))}));const i=r.filter(Boolean);return 1===i.length?i[0]:r}getMaterialByName(e){return this.materials.filter((function(t){return t.name===e}))[0]}duplicateUVs(e,t){let r=!1;Array.isArray(t)?t.forEach((function(e){e.aoMap&&(r=!0)})):t.aoMap&&(r=!0),r&&e.setAttribute("uv2",new a.BufferAttribute(e.attributes.uv.array,2))}}class gu{constructor(e){this.textureLoader=e}parse(){const e=[];this.textures={};for(const t in fu.materials)"LWO3"===fu.format?e.push(this.parseMaterial(fu.materials[t],t,fu.textures)):"LWO2"===fu.format&&e.push(this.parseMaterialLwo2(fu.materials[t],t,fu.textures));return e}parseMaterial(e,t,r){let n={name:t,side:this.getSide(e.attributes),flatShading:this.getSmooth(e.attributes)};const i=this.parseConnections(e.connections,e.nodes),o=this.parseTextureNodes(i.maps);this.parseAttributeImageMaps(i.attributes,r,o,e.maps);const a=this.parseAttributes(i.attributes,o);this.parseEnvMap(i,o,a),n=Object.assign(o,n),n=Object.assign(n,a);return new(this.getMaterialType(i.attributes))(n)}parseMaterialLwo2(e,t){let r={name:t,side:this.getSide(e.attributes),flatShading:this.getSmooth(e.attributes)};const n=this.parseAttributes(e.attributes,{});return r=Object.assign(r,n),new a.MeshPhongMaterial(r)}getSide(e){if(!e.side)return a.BackSide;switch(e.side){case 0:case 1:return a.BackSide;case 2:return a.FrontSide;case 3:return a.DoubleSide}}getSmooth(e){return!e.smooth||!e.smooth}parseConnections(e,t){const r={maps:{}},n=e.inputName,i=e.inputNodeName,o=e.nodeName,a=this;return n.forEach((function(e,n){if("Material"===e){const e=a.getNodeByRefName(i[n],t);r.attributes=e.attributes,r.envMap=e.fileName,r.name=i[n]}})),o.forEach((function(e,o){e===r.name&&(r.maps[n[o]]=a.getNodeByRefName(i[o],t))})),r}getNodeByRefName(e,t){for(const r in t)if(t[r].refName===e)return t[r]}parseTextureNodes(e){const t={};for(const r in e){const n=e[r],i=n.fileName;if(!i)return;const o=this.loadTexture(i);switch(void 0!==n.widthWrappingMode&&(o.wrapS=this.getWrappingType(n.widthWrappingMode)),void 0!==n.heightWrappingMode&&(o.wrapT=this.getWrappingType(n.heightWrappingMode)),r){case"Color":t.map=o;break;case"Roughness":t.roughnessMap=o,t.roughness=.5;break;case"Specular":t.specularMap=o,t.specular=16777215;break;case"Luminous":t.emissiveMap=o,t.emissive=8421504;break;case"Luminous Color":t.emissive=8421504;break;case"Metallic":t.metalnessMap=o,t.metalness=.5;break;case"Transparency":case"Alpha":t.alphaMap=o,t.transparent=!0;break;case"Normal":t.normalMap=o,void 0!==n.amplitude&&(t.normalScale=new a.Vector2(n.amplitude,n.amplitude));break;case"Bump":t.bumpMap=o}}return t.roughnessMap&&t.specularMap&&delete t.specularMap,t}parseAttributeImageMaps(e,t,r){for(const n in e){const i=e[n];if(i.maps){const e=i.maps[0],o=this.getTexturePathByIndex(e.imageIndex,t);if(!o)return;const a=this.loadTexture(o);switch(void 0!==e.wrap&&(a.wrapS=this.getWrappingType(e.wrap.w)),void 0!==e.wrap&&(a.wrapT=this.getWrappingType(e.wrap.h)),n){case"Color":r.map=a;break;case"Diffuse":r.aoMap=a;break;case"Roughness":r.roughnessMap=a,r.roughness=1;break;case"Specular":r.specularMap=a,r.specular=16777215;break;case"Luminosity":r.emissiveMap=a,r.emissive=8421504;break;case"Metallic":r.metalnessMap=a,r.metalness=1;break;case"Transparency":case"Alpha":r.alphaMap=a,r.transparent=!0;break;case"Normal":r.normalMap=a;break;case"Bump":r.bumpMap=a}}}}parseAttributes(e,t){const r={};return e.Color&&!t.map?r.color=(new a.Color).fromArray(e.Color.value):r.color=new a.Color,e.Transparency&&0!==e.Transparency.value&&(r.opacity=1-e.Transparency.value,r.transparent=!0),e["Bump Height"]&&(r.bumpScale=.1*e["Bump Height"].value),e["Refraction Index"]&&(r.refractionRatio=1/e["Refraction Index"].value),this.parsePhysicalAttributes(r,e,t),this.parseStandardAttributes(r,e,t),this.parsePhongAttributes(r,e,t),r}parsePhysicalAttributes(e,t){t.Clearcoat&&t.Clearcoat.value>0&&(e.clearcoat=t.Clearcoat.value,t["Clearcoat Gloss"]&&(e.clearcoatRoughness=.5*(1-t["Clearcoat Gloss"].value)))}parseStandardAttributes(e,t,r){t.Luminous&&(e.emissiveIntensity=t.Luminous.value,t["Luminous Color"]&&!r.emissive?e.emissive=(new a.Color).fromArray(t["Luminous Color"].value):e.emissive=new a.Color(8421504)),t.Roughness&&!r.roughnessMap&&(e.roughness=t.Roughness.value),t.Metallic&&!r.metalnessMap&&(e.metalness=t.Metallic.value)}parsePhongAttributes(e,t,r){t.Diffuse&&e.color.multiplyScalar(t.Diffuse.value),t.Reflection&&(e.reflectivity=t.Reflection.value,e.combine=a.AddOperation),t.Luminosity&&(e.emissiveIntensity=t.Luminosity.value,r.emissiveMap||r.map?e.emissive=new a.Color(8421504):e.emissive=e.color),t.Roughness||!t.Specular||r.specularMap||(t["Color Highlight"]?e.specular=(new a.Color).setScalar(t.Specular.value).lerp(e.color.clone().multiplyScalar(t.Specular.value),t["Color Highlight"].value):e.specular=(new a.Color).setScalar(t.Specular.value)),e.specular&&t.Glossiness&&(e.shininess=7+Math.pow(2,12*t.Glossiness.value+2))}parseEnvMap(e,t,r){if(e.envMap){const n=this.loadTexture(e.envMap);r.transparent&&r.opacity<.999?(n.mapping=a.EquirectangularRefractionMapping,void 0!==r.reflectivity&&(delete r.reflectivity,delete r.combine),void 0!==r.metalness&&delete r.metalness):n.mapping=a.EquirectangularReflectionMapping,t.envMap=n}}getTexturePathByIndex(e){let t="";return fu.textures?(fu.textures.forEach((function(r){r.index===e&&(t=r.fileName)})),t):t}loadTexture(e){if(!e)return null;return this.textureLoader.load(e,void 0,void 0,(function(){console.warn("LWOLoader: non-standard resource hierarchy. Use `resourcePath` parameter to specify root content directory.")}))}getWrappingType(e){switch(e){case 0:return console.warn('LWOLoader: "Reset" texture wrapping type is not supported in three.js'),a.ClampToEdgeWrapping;case 1:return a.RepeatWrapping;case 2:return a.MirroredRepeatWrapping;case 3:return a.ClampToEdgeWrapping}}getMaterialType(e){return e.Clearcoat&&e.Clearcoat.value>0?a.MeshPhysicalMaterial:e.Roughness?a.MeshStandardMaterial:a.MeshPhongMaterial}}class Au{parse(e,t){const r=new a.BufferGeometry;r.setAttribute("position",new a.Float32BufferAttribute(e.points,3));const n=this.splitIndices(e.vertexIndices,e.polygonDimensions);return r.setIndex(n),this.parseGroups(r,e),r.computeVertexNormals(),this.parseUVs(r,t,n),this.parseMorphTargets(r,t,n),r.translate(-t.pivot[0],-t.pivot[1],-t.pivot[2]),r}splitIndices(e,t){const r=[];let n=0;return t.forEach((function(t){if(t<4)for(let i=0;i<t;i++)r.push(e[n+i]);else if(4===t)r.push(e[n],e[n+1],e[n+2],e[n],e[n+2],e[n+3]);else if(t>4){for(let i=1;i<t-1;i++)r.push(e[n],e[n+i],e[n+i+1]);console.warn("LWOLoader: polygons with greater than 4 sides are not supported")}n+=t})),r}parseGroups(e,t){const r=fu.tags,n=[];let i=3;"lines"===t.type&&(i=2),"points"===t.type&&(i=1);const o=this.splitMaterialIndices(t.polygonDimensions,t.materialIndices);let a=0;const s={};let l,c,u=0,h=0;for(let d=0;d<o.length;d+=2){if(c=o[d+1],0===d&&(n[a]=r[c]),void 0===l&&(l=c),c!==l){let t;s[r[l]]?t=s[r[l]]:(t=a,s[r[l]]=a,n[a]=r[l],a++),e.addGroup(u,h,t),u+=h,l=c,h=0}h+=i}if(e.groups.length>0){let t;s[r[c]]?t=s[r[c]]:(t=a,s[r[c]]=a,n[a]=r[c]),e.addGroup(u,h,t)}e.userData.matNames=n}splitMaterialIndices(e,t){const r=[];return e.forEach((function(e,n){if(e<=3)r.push(t[2*n],t[2*n+1]);else if(4===e)r.push(t[2*n],t[2*n+1],t[2*n],t[2*n+1]);else for(let i=0;i<e-2;i++)r.push(t[2*n],t[2*n+1])})),r}parseUVs(e,t){const r=Array.from(Array(2*e.attributes.position.count),(function(){return 0}));for(const n in t.uvs){const e=t.uvs[n].uvs;t.uvs[n].uvIndices.forEach((function(t,n){r[2*t]=e[2*n],r[2*t+1]=e[2*n+1]}))}e.setAttribute("uv",new a.Float32BufferAttribute(r,2))}parseMorphTargets(e,t){let r=0;for(const n in t.morphTargets){const i=e.attributes.position.array.slice();e.morphAttributes.position||(e.morphAttributes.position=[]);const o=t.morphTargets[n].points,s=t.morphTargets[n].indices,l=t.morphTargets[n].type;s.forEach((function(e,t){"relative"===l?(i[3*e]+=o[3*t],i[3*e+1]+=o[3*t+1],i[3*e+2]+=o[3*t+2]):(i[3*e]=o[3*t],i[3*e+1]=o[3*t+1],i[3*e+2]=o[3*t+2])})),e.morphAttributes.position[r]=new a.Float32BufferAttribute(i,3),e.morphAttributes.position[r].name=n,r++}e.morphTargetsRelative=!1}}class vu extends a.Loader{constructor(e){super(e),this.propertyNameMapping={}}load(e,t,r,n){const i=this,o=new a.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){try{t(i.parse(r))}catch(o){n?n(o):console.error(o),i.manager.itemError(e)}}),r,n)}setPropertyNameMapping(e){this.propertyNameMapping=e}parse(e){function t(e){let t="",r=0;const n=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==n&&(t=n[1],r=new Blob([n[0]]).size);const i={comments:[],elements:[],headerLength:r,objInfo:""},o=t.split("\n");let a;function s(e,t){const r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}for(let l=0;l<o.length;l++){let e=o[l];if(e=e.trim(),""===e)continue;const t=e.split(/\s+/),r=t.shift();switch(e=t.join(" "),r){case"format":i.format=t[0],i.version=t[1];break;case"comment":i.comments.push(e);break;case"element":void 0!==a&&i.elements.push(a),a={},a.name=t[0],a.count=parseInt(t[1]),a.properties=[];break;case"property":a.properties.push(s(t,h.propertyNameMapping));break;case"obj_info":i.objInfo=e;break;default:console.log("unhandled",r,t)}}return void 0!==a&&i.elements.push(a),i}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function n(e,t){const n=t.split(/\s+/),i={};for(let o=0;o<e.length;o++)if("list"===e[o].type){const t=[],a=r(n.shift(),e[o].countType);for(let i=0;i<a;i++)t.push(r(n.shift(),e[o].itemType));i[e[o].name]=t}else i[e[o].name]=r(n.shift(),e[o].type);return i}function i(e,t){const r={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]};let i;let a="";null!==(i=/end_header\s([\s\S]*)$/.exec(e))&&(a=i[1]);const l=a.split("\n");let c=0,u=0;for(let o=0;o<l.length;o++){let e=l[o];if(e=e.trim(),""===e)continue;u>=t.elements[c].count&&(c++,u=0);const i=n(t.elements[c].properties,e);s(r,t.elements[c].name,i),u++}return o(r)}function o(e){let t=new a.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new a.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new a.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new a.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new a.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed(),t.setAttribute("uv",new a.Float32BufferAttribute(e.faceVertexUvs,2))),t.computeBoundingSphere(),t}function s(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){const t=r.vertex_indices||r.vertex_index,n=r.texcoord;3===t.length?(e.indices.push(t[0],t[1],t[2]),n&&6===n.length&&(e.faceVertexUvs.push(n[0],n[1]),e.faceVertexUvs.push(n[2],n[3]),e.faceVertexUvs.push(n[4],n[5]))):4===t.length&&(e.indices.push(t[0],t[1],t[3]),e.indices.push(t[1],t[2],t[3]))}}function l(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}}function c(e,t,r,n){const i={};let o,a=0;for(let s=0;s<r.length;s++)if("list"===r[s].type){const c=[];o=l(e,t+a,r[s].countType,n);const u=o[0];a+=o[1];for(let i=0;i<u;i++)o=l(e,t+a,r[s].itemType,n),c.push(o[0]),a+=o[1];i[r[s].name]=c}else o=l(e,t+a,r[s].type,n),i[r[s].name]=o[0],a+=o[1];return[i,a]}let u;const h=this;if(e instanceof ArrayBuffer){const r=a.LoaderUtils.decodeText(new Uint8Array(e)),n=t(r);u="ascii"===n.format?i(r,n):function(e,t){const r={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},n="binary_little_endian"===t.format,i=new DataView(e,t.headerLength);let a,l=0;for(let o=0;o<t.elements.length;o++)for(let e=0;e<t.elements[o].count;e++){a=c(i,l,t.elements[o].properties,n),l+=a[1];const e=a[0];s(r,t.elements[o].name,e)}return o(r)}(e,n)}else u=i(e,t(e));return u}}var yu=r(6141),xu=r(9280),bu=r(2947),wu=function(e,t){a.Mesh.call(this),this.type="Wireframe",this.geometry=void 0!==e?e:new yu.z,this.material=void 0!==t?t:new bu.Y({color:16777215*Math.random()})};wu.prototype=Object.assign(Object.create(a.Mesh.prototype),{constructor:wu,isWireframe:!0,computeLineDistances:function(){var e=new a.Vector3,t=new a.Vector3;return function(){var r=this.geometry,n=r.attributes.instanceStart,i=r.attributes.instanceEnd,o=new Float32Array(2*n.data.count);for(let a=0,l=0,c=n.data.count;a<c;a++,l+=2)e.fromBufferAttribute(n,a),t.fromBufferAttribute(i,a),o[l]=0===l?0:o[l-1],o[l+1]=o[l]+e.distanceTo(t);var s=new a.InstancedInterleavedBuffer(o,2,1);return r.setAttribute("instanceDistanceStart",new a.InterleavedBufferAttribute(s,1,0)),r.setAttribute("instanceDistanceEnd",new a.InterleavedBufferAttribute(s,1,1)),this}}()});var Cu=function(e){yu.z.call(this),this.type="WireframeGeometry2",this.fromWireframeGeometry(new a.WireframeGeometry(e))};Cu.prototype=Object.assign(Object.create(yu.z.prototype),{constructor:Cu,isWireframeGeometry2:!0});var Eu=r(7180),Su=r(2344);class Tu extends a.Mesh{constructor(e,t){this.lightProbe=e,this.size=t;const r=new a.ShaderMaterial({type:"LightProbeHelperMaterial",uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\tgl_FragColor = linearToOutputTexel( vec4( outgoingLight, 1.0 ) );","}"].join("\n")});super(new a.SphereGeometry(1,32,16),r),this.type="LightProbeHelper",this.onBeforeRender()}dispose(){this.geometry.dispose(),this.material.dispose()}onBeforeRender(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity}}const Mu=new a.Vector3,Iu=new a.Vector3;class Bu extends a.LineSegments{constructor(e,t,r){const n=void 0!==r?r:65535,i=e.geometry;if(!i||!i.isBufferGeometry)return void console.error("THREE.VertexTangentsHelper: geometry not an instance of THREE.BufferGeometry.",i);const o=i.attributes.tangent.count,s=new a.BufferGeometry,l=new a.Float32BufferAttribute(2*o*3,3);s.setAttribute("position",l),super(s,new a.LineBasicMaterial({color:n,toneMapped:!1})),this.type="VertexTangentsHelper",this.object=e,this.size=void 0!==t?t:1,this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0);const e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry,n=r.attributes.position,i=r.attributes.tangent;let o=0;for(let a=0,s=n.count;a<s;a++)Mu.set(n.getX(a),n.getY(a),n.getZ(a)).applyMatrix4(e),Iu.set(i.getX(a),i.getY(a),i.getZ(a)),Iu.transformDirection(e).multiplyScalar(this.size).add(Mu),t.setXYZ(o,Mu.x,Mu.y,Mu.z),o+=1,t.setXYZ(o,Iu.x,Iu.y,Iu.z),o+=1;t.needsUpdate=!0}}class _u extends a.Line{constructor(e,t,r,n){this.audio=e,this.range=t||1,this.divisionsInnerAngle=r||16,this.divisionsOuterAngle=n||2;const i=new a.BufferGeometry,o=this.divisionsInnerAngle+2*this.divisionsOuterAngle,s=new Float32Array(3*(3*o+3));i.setAttribute("position",new a.BufferAttribute(s,3));const l=new a.LineBasicMaterial({color:65280});super(i,[new a.LineBasicMaterial({color:16776960}),l]),this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,r=this.divisionsInnerAngle,n=this.divisionsOuterAngle,i=a.MathUtils.degToRad(e.panner.coneInnerAngle),o=a.MathUtils.degToRad(e.panner.coneOuterAngle),s=i/2,l=o/2;let c,u,h=0,d=0;const f=this.geometry,p=f.attributes.position;function m(e,r,n,i){const o=(r-e)/n;for(p.setXYZ(h,0,0,0),d++,c=e;c<r;c+=o)u=h+d,p.setXYZ(u,Math.sin(c)*t,0,Math.cos(c)*t),p.setXYZ(u+1,Math.sin(Math.min(c+o,r))*t,0,Math.cos(Math.min(c+o,r))*t),p.setXYZ(u+2,0,0,0),d+=3;f.addGroup(h,d,i),h+=d,d=0}f.clearGroups(),m(-l,-s,n,0),m(-s,s,r,1),m(s,l,n,0),p.needsUpdate=!0,i===o&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}const Fu=new a.Vector3,Pu=new a.Vector3,Ru=new a.Matrix3;class Lu extends a.LineSegments{constructor(e,t,r){const n=new a.BufferGeometry,i=void 0!==r?r:16711680;super(n,new a.LineBasicMaterial({color:i,toneMapped:!1})),this.object=e,this.size=void 0!==t?t:.1;let o=0;const s=this.object.geometry;if(s&&s.isGeometry)return void console.error("THREE.VertexNormalsHelper no longer supports Geometry. Use BufferGeometry instead.");s&&s.isBufferGeometry&&(o=s.attributes.normal.count);const l=new a.Float32BufferAttribute(2*o*3,3);n.setAttribute("position",l),this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),Ru.getNormalMatrix(this.object.matrixWorld);const e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry;if(r&&r.isGeometry)console.error("THREE.VertexNormalsHelper no longer supports Geometry. Use BufferGeometry instead.");else{if(r&&r.isBufferGeometry){const n=r.attributes.position,i=r.attributes.normal;let o=0;for(let r=0,a=n.count;r<a;r++)Fu.set(n.getX(r),n.getY(r),n.getZ(r)).applyMatrix4(e),Pu.set(i.getX(r),i.getY(r),i.getZ(r)),Pu.applyMatrix3(Ru).normalize().multiplyScalar(this.size).add(Fu),t.setXYZ(o,Fu.x,Fu.y,Fu.z),o+=1,t.setXYZ(o,Pu.x,Pu.y,Pu.z),o+=1}t.needsUpdate=!0}}}class Du extends a.Line{constructor(e,t){this.light=e,this.color=t;const r=new a.BufferGeometry;r.setAttribute("position",new a.Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere();super(r,new a.LineBasicMaterial({fog:!1})),this.type="RectAreaLightHelper";const n=new a.BufferGeometry;n.setAttribute("position",new a.Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new a.Mesh(n,new a.MeshBasicMaterial({side:a.BackSide,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.copy(this.light.matrixWorld).scale(this.scale),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}var Nu=r(9769),ku={fromCubeTexture:function(e){var t,r,n,i=0,o=new a.Vector3,s=new a.Vector3,l=new a.Color,c=[0,0,0,0,0,0,0,0,0],u=new a.SphericalHarmonics3,h=u.coefficients;for(let E=0;E<6;E++){var d=e.image[E],f=d.width,p=d.height,m=document.createElement("canvas");m.width=f,m.height=p;var g=m.getContext("2d");g.drawImage(d,0,0,f,p);var A=g.getImageData(0,0,f,p),v=A.data,y=A.width,x=2/y;for(let t=0,u=v.length;t<u;t+=4){l.setRGB(v[t]/255,v[t+1]/255,v[t+2]/255),Ou(l,e.encoding);var b=t/4,w=(b%y+.5)*x-1,C=1-(Math.floor(b/y)+.5)*x;switch(E){case 0:o.set(-1,C,-w);break;case 1:o.set(1,C,w);break;case 2:o.set(-w,1,-C);break;case 3:o.set(-w,-1,C);break;case 4:o.set(-w,C,1);break;case 5:o.set(w,C,-1)}r=o.lengthSq(),i+=n=4/(Math.sqrt(r)*r),s.copy(o).normalize(),a.SphericalHarmonics3.getBasisAt(s,c);for(let e=0;e<9;e++)h[e].x+=c[e]*l.r*n,h[e].y+=c[e]*l.g*n,h[e].z+=c[e]*l.b*n}}t=4*Math.PI/i;for(let a=0;a<9;a++)h[a].x*=t,h[a].y*=t,h[a].z*=t;return new a.LightProbe(u)},fromCubeRenderTarget:function(e,t){var r,n,i,o=0,s=new a.Vector3,l=new a.Vector3,c=new a.Color,u=[0,0,0,0,0,0,0,0,0],h=new a.SphericalHarmonics3,d=h.coefficients;for(let y=0;y<6;y++){var f=t.width,p=new Uint8Array(f*f*4);e.readRenderTargetPixels(t,0,0,f,f,p,y);var m=2/f;for(let e=0,r=p.length;e<r;e+=4){c.setRGB(p[e]/255,p[e+1]/255,p[e+2]/255),Ou(c,t.texture.encoding);var g=e/4,A=(g%f+.5)*m-1,v=1-(Math.floor(g/f)+.5)*m;switch(y){case 0:s.set(1,v,-A);break;case 1:s.set(-1,v,A);break;case 2:s.set(A,1,-v);break;case 3:s.set(A,-1,v);break;case 4:s.set(A,v,1);break;case 5:s.set(-A,v,-1)}n=s.lengthSq(),o+=i=4/(Math.sqrt(n)*n),l.copy(s).normalize(),a.SphericalHarmonics3.getBasisAt(l,u);for(let e=0;e<9;e++)d[e].x+=u[e]*c.r*i,d[e].y+=u[e]*c.g*i,d[e].z+=u[e]*c.b*i}}r=4*Math.PI/o;for(let a=0;a<9;a++)d[a].x*=r,d[a].y*=r,d[a].z*=r;return new a.LightProbe(h)}},Ou=function(e,t){switch(t){case a.sRGBEncoding:e.convertSRGBToLinear();break;case a.LinearEncoding:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.")}return e},Uu=r(4090),Qu=r(9080);class Vu{constructor(e,t,r,n,i){this.degree1=e,this.degree2=t,this.knots1=r,this.knots2=n,this.controlPoints=[];const o=r.length-e-1,s=n.length-t-1;for(let l=0;l<o;++l){this.controlPoints[l]=[];for(let e=0;e<s;++e){const t=i[l][e];this.controlPoints[l][e]=new a.Vector4(t.x,t.y,t.z,t.w)}}}getPoint(e,t,r){const n=this.knots1[0]+e*(this.knots1[this.knots1.length-1]-this.knots1[0]),i=this.knots2[0]+t*(this.knots2[this.knots2.length-1]-this.knots2[0]);(0,Uu.nl)(this.degree1,this.degree2,this.knots1,this.knots2,this.controlPoints,n,i,r)}}class Gu extends a.Curve{constructor(){super()}getPoint(e,t){const r=t||new a.Vector3;e=2*Math.PI*e;const n=-.22*Math.cos(e)-1.28*Math.sin(e)-.44*Math.cos(3*e)-.78*Math.sin(3*e),i=-.1*Math.cos(2*e)-.27*Math.sin(2*e)+.38*Math.cos(4*e)+.46*Math.sin(4*e),o=.7*Math.cos(3*e)-.4*Math.sin(3*e);return r.set(n,i,o).multiplyScalar(20)}}class zu extends a.Curve{constructor(e){super(),this.scale=void 0===e?5:e}getPoint(e,t){const r=t||new a.Vector3;e*=2*Math.PI;const n=16*Math.pow(Math.sin(e),3),i=13*Math.cos(e)-5*Math.cos(2*e)-2*Math.cos(3*e)-Math.cos(4*e);return r.set(n,i,0).multiplyScalar(this.scale)}}class ju extends a.Curve{constructor(e){super(),this.scale=void 0===e?70:e}getPoint(e,t){const r=t||new a.Vector3;e=4*e*Math.PI;const n=this.scale/2,i=n*(1+Math.cos(e)),o=n*Math.sin(e),s=2*n*Math.sin(e/2);return r.set(i,o,s)}}class Hu extends a.Curve{constructor(){super()}getPoint(e,t){const r=t||new a.Vector3;e*=2*Math.PI;const n=50*Math.sin(e),i=Math.cos(e)*(10+50*Math.cos(e)),o=Math.sin(e)*(10+50*Math.cos(e));return r.set(n,i,o)}}class Wu extends a.Curve{constructor(){super()}getPoint(e,t){const r=t||new a.Vector3,n=2*Math.PI*e*150/30,i=30*Math.cos(n),o=30*Math.sin(n),s=150*e;return r.set(i,o,s)}}class Zu extends a.Curve{constructor(e){super(),this.scale=void 0===e?10:e}getPoint(e,t){const r=t||new a.Vector3;e*=2*Math.PI;const n=(2+Math.cos(3*e))*Math.cos(2*e),i=(2+Math.cos(3*e))*Math.sin(2*e),o=Math.sin(3*e);return r.set(n,i,o).multiplyScalar(this.scale)}}class Xu extends a.Curve{constructor(e){super(),this.scale=void 0===e?10:e}getPoint(e,t){const r=t||new a.Vector3;e*=2*Math.PI;const n=(2+Math.cos(4*e))*Math.cos(3*e),i=(2+Math.cos(4*e))*Math.sin(3*e),o=Math.sin(4*e);return r.set(n,i,o).multiplyScalar(this.scale)}}class Yu extends a.Curve{constructor(e){super(),this.scale=void 0===e?10:e}getPoint(e,t){const r=t||new a.Vector3;e*=2*Math.PI;const n=(2+Math.cos(5*e))*Math.cos(2*e),i=(2+Math.cos(5*e))*Math.sin(2*e),o=Math.sin(5*e);return r.set(n,i,o).multiplyScalar(this.scale)}}class Ju extends a.Curve{constructor(e){super(),this.scale=void 0===e?10:e}getPoint(e,t){const r=t||new a.Vector3;e=4*e-2;const n=Math.pow(e,3)-3*e,i=Math.pow(e,4)-4*e*e,o=.2*Math.pow(e,5)-2*e;return r.set(n,i,o).multiplyScalar(this.scale)}}const qu=(e,t,r)=>r*(t-e)+e;class Ku extends a.Curve{constructor(e){super(),this.scale=void 0===e?1:e}getPoint(e,t){const r=t||new a.Vector3,n=.4*(e=qu(-4,4,e))*(e*e-7)*(e*e-10),i=Math.pow(e,4)-13*e*e,o=.1*e*(e*e-4)*(e*e-9)*(e*e-12);return r.set(n,i,o).multiplyScalar(this.scale)}}class $u extends a.Curve{constructor(e){super(),this.scale=void 0===e?40:e}getPoint(e,t){const r=t||new a.Vector3;e*=2*Math.PI;const n=Math.cos(2*e)*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),i=Math.sin(2*e)*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),o=.35*Math.sin(5*e);return r.set(n,i,o).multiplyScalar(this.scale)}}class eh extends a.Curve{constructor(e){super(),this.scale=void 0===e?40:e}getPoint(e,t){const r=t||new a.Vector3,n=e*Math.PI*2,i=Math.cos(2*n)*(1+.45*Math.cos(3*n)+.4*Math.cos(9*n)),o=Math.sin(2*n)*(1+.45*Math.cos(3*n)+.4*Math.cos(9*n)),s=.2*Math.sin(9*n);return r.set(i,o,s).multiplyScalar(this.scale)}}class th extends a.Curve{constructor(e){super(),this.scale=void 0===e?40:e}getPoint(e,t){const r=t||new a.Vector3,n=e*Math.PI*2,i=Math.cos(3*n)*(1+.3*Math.cos(5*n)+.5*Math.cos(10*n)),o=Math.sin(3*n)*(1+.3*Math.cos(5*n)+.5*Math.cos(10*n)),s=.2*Math.sin(20*n);return r.set(i,o,s).multiplyScalar(this.scale)}}class rh extends a.Curve{constructor(e){super(),this.scale=void 0===e?40:e}getPoint(e,t){const r=t||new a.Vector3,n=e*Math.PI*2,i=Math.cos(4*n)*(1+.5*(Math.cos(5*n)+.4*Math.cos(20*n))),o=Math.sin(4*n)*(1+.5*(Math.cos(5*n)+.4*Math.cos(20*n))),s=.35*Math.sin(15*n);return r.set(i,o,s).multiplyScalar(this.scale)}}const nh=new a.Matrix4,ih=new a.Object3D,oh=new a.Vector3;class ah extends a.EventDispatcher{constructor(){super(),this.isGeometry=!0,this.uuid=a.MathUtils.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){const t=(new a.Matrix3).getNormalMatrix(e);for(let r=0,n=this.vertices.length;r<n;r++){this.vertices[r].applyMatrix4(e)}for(let r=0,n=this.faces.length;r<n;r++){const e=this.faces[r];e.normal.applyMatrix3(t).normalize();for(let r=0,n=e.vertexNormals.length;r<n;r++)e.vertexNormals[r].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return nh.makeRotationX(e),this.applyMatrix4(nh),this}rotateY(e){return nh.makeRotationY(e),this.applyMatrix4(nh),this}rotateZ(e){return nh.makeRotationZ(e),this.applyMatrix4(nh),this}translate(e,t,r){return nh.makeTranslation(e,t,r),this.applyMatrix4(nh),this}scale(e,t,r){return nh.makeScale(e,t,r),this.applyMatrix4(nh),this}lookAt(e){return ih.lookAt(e),ih.updateMatrix(),this.applyMatrix4(ih.matrix),this}fromBufferGeometry(e){const t=this,r=null!==e.index?e.index:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const i=n.position,o=n.normal,s=n.color,l=n.uv,c=n.uv2;void 0!==c&&(this.faceVertexUvs[1]=[]);for(let d=0;d<i.count;d++)t.vertices.push((new a.Vector3).fromBufferAttribute(i,d)),void 0!==s&&t.colors.push((new a.Color).fromBufferAttribute(s,d));function u(e,r,n,i){const u=void 0===s?[]:[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()],h=void 0===o?[]:[(new a.Vector3).fromBufferAttribute(o,e),(new a.Vector3).fromBufferAttribute(o,r),(new a.Vector3).fromBufferAttribute(o,n)],d=new lh(e,r,n,h,u,i);t.faces.push(d),void 0!==l&&t.faceVertexUvs[0].push([(new a.Vector2).fromBufferAttribute(l,e),(new a.Vector2).fromBufferAttribute(l,r),(new a.Vector2).fromBufferAttribute(l,n)]),void 0!==c&&t.faceVertexUvs[1].push([(new a.Vector2).fromBufferAttribute(c,e),(new a.Vector2).fromBufferAttribute(c,r),(new a.Vector2).fromBufferAttribute(c,n)])}const h=e.groups;if(h.length>0)for(let a=0;a<h.length;a++){const e=h[a],t=e.start;for(let n=t,i=t+e.count;n<i;n+=3)void 0!==r?u(r.getX(n),r.getX(n+1),r.getX(n+2),e.materialIndex):u(n,n+1,n+2,e.materialIndex)}else if(void 0!==r)for(let a=0;a<r.count;a+=3)u(r.getX(a),r.getX(a+1),r.getX(a+2));else for(let a=0;a<i.count;a+=3)u(a,a+1,a+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(oh).negate(),this.translate(oh.x,oh.y,oh.z),this}normalize(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new a.Matrix4;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix4(n),this}computeFaceNormals(){const e=new a.Vector3,t=new a.Vector3;for(let r=0,n=this.faces.length;r<n;r++){const n=this.faces[r],i=this.vertices[n.a],o=this.vertices[n.b],a=this.vertices[n.c];e.subVectors(a,o),t.subVectors(i,o),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){const t=new Array(this.vertices.length);for(let r=0,n=this.vertices.length;r<n;r++)t[r]=new a.Vector3;if(e){const e=new a.Vector3,r=new a.Vector3;for(let n=0,i=this.faces.length;n<i;n++){const i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,a),r.subVectors(o,a),e.cross(r),t[i.a].add(e),t[i.b].add(e),t[i.c].add(e)}}else{this.computeFaceNormals();for(let e=0,r=this.faces.length;e<r;e++){const r=this.faces[e];t[r.a].add(r.normal),t[r.b].add(r.normal),t[r.c].add(r.normal)}}for(let r=0,n=this.vertices.length;r<n;r++)t[r].normalize();for(let r=0,n=this.faces.length;r<n;r++){const e=this.faces[r],n=e.vertexNormals;3===n.length?(n[0].copy(t[e.a]),n[1].copy(t[e.b]),n[2].copy(t[e.c])):(n[0]=t[e.a].clone(),n[1]=t[e.b].clone(),n[2]=t[e.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],r=t.vertexNormals;3===r.length?(r[0].copy(t.normal),r[1].copy(t.normal),r[2].copy(t.normal)):(r[0]=t.normal.clone(),r[1]=t.normal.clone(),r[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,r=this.faces.length;t<r;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,r=e.vertexNormals.length;t<r;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}const e=new ah;e.faces=this.faces;for(let t=0,r=this.morphTargets.length;t<r;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];const e=this.morphNormals[t].faceNormals,r=this.morphNormals[t].vertexNormals;for(let t=0,n=this.faces.length;t<n;t++){const t=new a.Vector3,n={a:new a.Vector3,b:new a.Vector3,c:new a.Vector3};e.push(t),r.push(n)}}const r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],n=r.faceNormals[e],i=r.vertexNormals[e];n.copy(t.normal),i.a.copy(t.vertexNormals[0]),i.b.copy(t.vertexNormals[1]),i.c.copy(t.vertexNormals[2])}}for(let t=0,r=this.faces.length;t<r;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new a.Box3),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new a.Sphere),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,r=0){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let n;const i=this.vertices.length,o=this.vertices,s=e.vertices,l=this.faces,c=e.faces,u=this.colors,h=e.colors;void 0!==t&&(n=(new a.Matrix3).getNormalMatrix(t));for(let a=0,d=s.length;a<d;a++){const e=s[a].clone();void 0!==t&&e.applyMatrix4(t),o.push(e)}for(let a=0,d=h.length;a<d;a++)u.push(h[a].clone());for(let a=0,d=c.length;a<d;a++){const e=c[a];let t,o;const s=e.vertexNormals,u=e.vertexColors,h=new lh(e.a+i,e.b+i,e.c+i);h.normal.copy(e.normal),void 0!==n&&h.normal.applyMatrix3(n).normalize();for(let r=0,i=s.length;r<i;r++)t=s[r].clone(),void 0!==n&&t.applyMatrix3(n).normalize(),h.vertexNormals.push(t);h.color.copy(e.color);for(let r=0,n=u.length;r<n;r++)o=u[r],h.vertexColors.push(o.clone());h.materialIndex=e.materialIndex+r,l.push(h)}for(let a=0,d=e.faceVertexUvs.length;a<d;a++){const t=e.faceVertexUvs[a];void 0===this.faceVertexUvs[a]&&(this.faceVertexUvs[a]=[]);for(let e=0,r=t.length;e<r;e++){const r=t[e],n=[];for(let e=0,t=r.length;e<t;e++)n.push(r[e].clone());this.faceVertexUvs[a].push(n)}}}mergeMesh(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}mergeVertices(e=4){const t={},r=[],n=[],i=Math.pow(10,e);for(let s=0,l=this.vertices.length;s<l;s++){const e=this.vertices[s],o=`${Math.round(e.x*i)}_${Math.round(e.y*i)}_${Math.round(e.z*i)}`;void 0===t[o]?(t[o]=s,r.push(this.vertices[s]),n[s]=r.length-1):n[s]=n[t[o]]}const o=[];for(let s=0,l=this.faces.length;s<l;s++){const e=this.faces[s];e.a=n[e.a],e.b=n[e.b],e.c=n[e.c];const t=[e.a,e.b,e.c];for(let r=0;r<3;r++)if(t[r]===t[(r+1)%3]){o.push(s);break}}for(let s=o.length-1;s>=0;s--){const e=o[s];this.faces.splice(e,1);for(let t=0,r=this.faceVertexUvs.length;t<r;t++)this.faceVertexUvs[t].splice(e,1)}const a=this.vertices.length-r.length;return this.vertices=r,a}setFromPoints(e){this.vertices=[];for(let t=0,r=e.length;t<r;t++){const r=e[t];this.vertices.push(new a.Vector3(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){const e=this.faces,t=e.length;for(let a=0;a<t;a++)e[a]._id=a;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));const r=this.faceVertexUvs[0],n=this.faceVertexUvs[1];let i,o;r&&r.length===t&&(i=[]),n&&n.length===t&&(o=[]);for(let a=0;a<t;a++){const t=e[a]._id;i&&i.push(r[t]),o&&o.push(n[t])}i&&(this.faceVertexUvs[0]=i),o&&(this.faceVertexUvs[1]=o)}toJSON(){const e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){const t=this.parameters;for(let r in t)void 0!==t[r]&&(e[r]=t[r]);return e}const t=[];for(let f=0;f<this.vertices.length;f++){const e=this.vertices[f];t.push(e.x,e.y,e.z)}const r=[],n=[],i={},o=[],a={},s=[],l={};for(let f=0;f<this.faces.length;f++){const e=this.faces[f],t=!0,n=!1,i=void 0!==this.faceVertexUvs[0][f],o=e.normal.length()>0,a=e.vertexNormals.length>0,s=1!==e.color.r||1!==e.color.g||1!==e.color.b,l=e.vertexColors.length>0;let p=0;if(p=c(p,0,0),p=c(p,1,t),p=c(p,2,n),p=c(p,3,i),p=c(p,4,o),p=c(p,5,a),p=c(p,6,s),p=c(p,7,l),r.push(p),r.push(e.a,e.b,e.c),r.push(e.materialIndex),i){const e=this.faceVertexUvs[0][f];r.push(d(e[0]),d(e[1]),d(e[2]))}if(o&&r.push(u(e.normal)),a){const t=e.vertexNormals;r.push(u(t[0]),u(t[1]),u(t[2]))}if(s&&r.push(h(e.color)),l){const t=e.vertexColors;r.push(h(t[0]),h(t[1]),h(t[2]))}}function c(e,t,r){return r?e|1<<t:e&~(1<<t)}function u(e){const t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==i[t]||(i[t]=n.length/3,n.push(e.x,e.y,e.z)),i[t]}function h(e){const t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==a[t]||(a[t]=o.length,o.push(e.getHex())),a[t]}function d(e){const t=e.x.toString()+e.y.toString();return void 0!==l[t]||(l[t]=s.length/2,s.push(e.x,e.y)),l[t]}return e.data={},e.data.vertices=t,e.data.normals=n,o.length>0&&(e.data.colors=o),s.length>0&&(e.data.uvs=[s]),e.data.faces=r,e}clone(){return(new ah).copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;const t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());const r=e.colors;for(let h=0,d=r.length;h<d;h++)this.colors.push(r[h].clone());const n=e.faces;for(let h=0,d=n.length;h<d;h++)this.faces.push(n[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){const t=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(let e=0,r=t.length;e<r;e++){const r=t[e],n=[];for(let e=0,t=r.length;e<t;e++){const t=r[e];n.push(t.clone())}this.faceVertexUvs[h].push(n)}}const i=e.morphTargets;for(let h=0,d=i.length;h<d;h++){const e={};if(e.name=i[h].name,void 0!==i[h].vertices){e.vertices=[];for(let t=0,r=i[h].vertices.length;t<r;t++)e.vertices.push(i[h].vertices[t].clone())}if(void 0!==i[h].normals){e.normals=[];for(let t=0,r=i[h].normals.length;t<r;t++)e.normals.push(i[h].normals[t].clone())}this.morphTargets.push(e)}const o=e.morphNormals;for(let h=0,d=o.length;h<d;h++){const e={};if(void 0!==o[h].vertexNormals){e.vertexNormals=[];for(let t=0,r=o[h].vertexNormals.length;t<r;t++){const r=o[h].vertexNormals[t],n={};n.a=r.a.clone(),n.b=r.b.clone(),n.c=r.c.clone(),e.vertexNormals.push(n)}}if(void 0!==o[h].faceNormals){e.faceNormals=[];for(let t=0,r=o[h].faceNormals.length;t<r;t++)e.faceNormals.push(o[h].faceNormals[t].clone())}this.morphNormals.push(e)}const a=e.skinWeights;for(let h=0,d=a.length;h<d;h++)this.skinWeights.push(a[h].clone());const s=e.skinIndices;for(let h=0,d=s.length;h<d;h++)this.skinIndices.push(s[h].clone());const l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);const c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());const u=e.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){const e=(new sh).fromGeometry(this),t=new a.BufferGeometry,r=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",new a.BufferAttribute(r,3).copyVector3sArray(e.vertices)),e.normals.length>0){const r=new Float32Array(3*e.normals.length);t.setAttribute("normal",new a.BufferAttribute(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){const r=new Float32Array(3*e.colors.length);t.setAttribute("color",new a.BufferAttribute(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){const r=new Float32Array(2*e.uvs.length);t.setAttribute("uv",new a.BufferAttribute(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){const r=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",new a.BufferAttribute(r,2).copyVector2sArray(e.uvs2))}t.groups=e.groups;for(let n in e.morphTargets){const r=[],i=e.morphTargets[n];for(let e=0,t=i.length;e<t;e++){const t=i[e],n=new a.Float32BufferAttribute(3*t.data.length,3);n.name=t.name,r.push(n.copyVector3sArray(t.data))}t.morphAttributes[n]=r}if(e.skinIndices.length>0){const r=new a.Float32BufferAttribute(4*e.skinIndices.length,4);t.setAttribute("skinIndex",r.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){const r=new a.Float32BufferAttribute(4*e.skinWeights.length,4);t.setAttribute("skinWeight",r.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}}ah.createBufferGeometryFromObject=e=>{let t=new a.BufferGeometry;const r=e.geometry;if(e.isPoints||e.isLine){const e=new a.Float32BufferAttribute(3*r.vertices.length,3),n=new a.Float32BufferAttribute(3*r.colors.length,3);if(t.setAttribute("position",e.copyVector3sArray(r.vertices)),t.setAttribute("color",n.copyColorsArray(r.colors)),r.lineDistances&&r.lineDistances.length===r.vertices.length){const e=new a.Float32BufferAttribute(r.lineDistances.length,1);t.setAttribute("lineDistance",e.copyArray(r.lineDistances))}null!==r.boundingSphere&&(t.boundingSphere=r.boundingSphere.clone()),null!==r.boundingBox&&(t.boundingBox=r.boundingBox.clone())}else e.isMesh&&(t=r.toBufferGeometry());return t};class sh{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){const t=[];let r,n,i;const o=e.faces;for(n=0;n<o.length;n++){const e=o[n];e.materialIndex!==i&&(i=e.materialIndex,void 0!==r&&(r.count=3*n-r.start,t.push(r)),r={start:3*n,materialIndex:i})}void 0!==r&&(r.count=3*n-r.start,t.push(r)),this.groups=t}fromGeometry(e){const t=e.faces,r=e.vertices,n=e.faceVertexUvs,i=n[0]&&n[0].length>0,o=n[1]&&n[1].length>0,s=e.morphTargets,l=s.length;let c;if(l>0){c=[];for(let e=0;e<l;e++)c[e]={name:s[e].name,data:[]};this.morphTargets.position=c}const u=e.morphNormals,h=u.length;let d;if(h>0){d=[];for(let e=0;e<h;e++)d[e]={name:u[e].name,data:[]};this.morphTargets.normal=d}const f=e.skinIndices,p=e.skinWeights,m=f.length===r.length,g=p.length===r.length;r.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let A=0;A<t.length;A++){const e=t[A];this.vertices.push(r[e.a],r[e.b],r[e.c]);const v=e.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const t=e.normal;this.normals.push(t,t,t)}const y=e.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const t=e.color;this.colors.push(t,t,t)}if(!0===i){const e=n[0][A];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",A),this.uvs.push(new a.Vector2,new a.Vector2,new a.Vector2))}if(!0===o){const e=n[1][A];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",A),this.uvs2.push(new a.Vector2,new a.Vector2,new a.Vector2))}for(let t=0;t<l;t++){const r=s[t].vertices;c[t].data.push(r[e.a],r[e.b],r[e.c])}for(let t=0;t<h;t++){const e=u[t].vertexNormals[A];d[t].data.push(e.a,e.b,e.c)}m&&this.skinIndices.push(f[e.a],f[e.b],f[e.c]),g&&this.skinWeights.push(p[e.a],p[e.b],p[e.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}class lh{constructor(e,t,r,n,i,o=0){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new a.Vector3,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new a.Color,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=o}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}var ch=r(1787)},6723:function(e,t,r){"use strict";r.d(t,{M:function(){return i}});var n=r(6173);const i=(()=>{const e=new n.Frustum,t=new n.Vector3,r=new n.Vector3,i=new n.Vector3,o=new n.Vector3,a=new n.Vector3,s=new n.Vector3,l=new n.Vector3,c=new n.Vector3,u=new n.Vector3,h=new n.Vector3,d=new n.Vector3,f=new n.Vector3,p=new n.Vector3,m=new n.Vector3;return class{constructor(e,t,r){this.camera=e,this.scene=t,this.startPoint=new n.Vector3,this.endPoint=new n.Vector3,this.collection=[],this.deep=r||Number.MAX_VALUE}select(t,r){return this.startPoint=t||this.startPoint,this.endPoint=r||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(e,this.scene),this.collection}updateFrustum(t,n){if(t=t||this.startPoint,n=n||this.endPoint,t.x===n.x&&(n.x+=Number.EPSILON),t.y===n.y&&(n.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera)r.copy(t),r.x=Math.min(t.x,n.x),r.y=Math.max(t.y,n.y),n.x=Math.max(t.x,n.x),n.y=Math.min(t.y,n.y),i.setFromMatrixPosition(this.camera.matrixWorld),o.copy(r),a.set(n.x,r.y,0),s.copy(n),l.set(r.x,n.y,0),o.unproject(this.camera),a.unproject(this.camera),s.unproject(this.camera),l.unproject(this.camera),f.copy(o).sub(i),p.copy(a).sub(i),m.copy(s).sub(i),f.normalize(),p.normalize(),m.normalize(),f.multiplyScalar(this.deep),p.multiplyScalar(this.deep),m.multiplyScalar(this.deep),f.add(i),p.add(i),m.add(i),(g=e.planes)[0].setFromCoplanarPoints(i,o,a),g[1].setFromCoplanarPoints(i,a,s),g[2].setFromCoplanarPoints(s,l,i),g[3].setFromCoplanarPoints(l,o,i),g[4].setFromCoplanarPoints(a,s,l),g[5].setFromCoplanarPoints(m,p,f),g[5].normal.multiplyScalar(-1);else if(this.camera.isOrthographicCamera){const r=Math.min(t.x,n.x),i=Math.max(t.y,n.y),f=Math.max(t.x,n.x),p=Math.min(t.y,n.y);var g;o.set(r,i,-1),a.set(f,i,-1),s.set(f,p,-1),l.set(r,p,-1),c.set(r,i,1),u.set(f,i,1),h.set(f,p,1),d.set(r,p,1),o.unproject(this.camera),a.unproject(this.camera),s.unproject(this.camera),l.unproject(this.camera),c.unproject(this.camera),u.unproject(this.camera),h.unproject(this.camera),d.unproject(this.camera),(g=e.planes)[0].setFromCoplanarPoints(o,c,u),g[1].setFromCoplanarPoints(a,u,h),g[2].setFromCoplanarPoints(h,d,l),g[3].setFromCoplanarPoints(d,c,o),g[4].setFromCoplanarPoints(a,s,l),g[5].setFromCoplanarPoints(h,u,c),g[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,r){if((r.isMesh||r.isLine||r.isPoints)&&void 0!==r.material&&(null===r.geometry.boundingSphere&&r.geometry.computeBoundingSphere(),t.copy(r.geometry.boundingSphere.center),t.applyMatrix4(r.matrixWorld),e.containsPoint(t)&&this.collection.push(r)),r.children.length>0)for(let t=0;t<r.children.length;t++)this.searchChildInFrustum(e,r.children[t])}}})()},1787:function(e,t,r){"use strict";let n;r.d(t,{z:function(){return i}});const i=()=>{if(n)return n;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!==typeof WebAssembly)return{supported:!1};let r,i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(e)&&(i="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB");const o=WebAssembly.instantiate(function(e){const r=new Uint8Array(e.length);for(let t=0;t<e.length;++t){const n=e.charCodeAt(t);r[t]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let n=0;for(let i=0;i<e.length;++i)r[n++]=r[i]<60?t[r[i]]:64*(r[i]-60)+r[++i];return r.buffer.slice(0,n)}(i),{}).then((e=>{r=e.instance,r.exports.__wasm_call_ctors()}));function a(e,t,n,i,o,a){const s=r.exports.sbrk,l=n+3&-4,c=s(l*i),u=s(o.length),h=new Uint8Array(r.exports.memory.buffer);h.set(o,u);const d=e(c,n,i,u,o.length);if(0===d&&a&&a(c,l,i),t.set(h.subarray(c,c+n*i)),s(c-s(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}const s={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return n={ready:o,supported:!0,decodeVertexBuffer(e,t,n,i,o){a(r.exports.meshopt_decodeVertexBuffer,e,t,n,i,r.exports[s[o]])},decodeIndexBuffer(e,t,n,i){a(r.exports.meshopt_decodeIndexBuffer,e,t,n,i)},decodeIndexSequence(e,t,n,i){a(r.exports.meshopt_decodeIndexSequence,e,t,n,i)},decodeGltfBuffer(e,t,n,i,o,c){a(r.exports[l[o]],e,t,n,i,r.exports[s[c]])}},n}},7180:function(e,t,r){"use strict";r.d(t,{w:function(){return s}});var n=r(4649),i=r(2344),o=r(9280),a=r(2947);class s extends i.w{constructor(e=new o.L,t=new a.Y({color:16777215*Math.random()})){super(e,t),(0,n.Z)(this,"type","Line2"),(0,n.Z)(this,"isLine2",!0)}}},9280:function(e,t,r){"use strict";r.d(t,{L:function(){return o}});var n=r(4649),i=r(6141);class o extends i.z{constructor(){super(),(0,n.Z)(this,"type","LineGeometry"),(0,n.Z)(this,"isLineGeometry",!0),(0,n.Z)(this,"setColors",(e=>{const t=e.length-3,r=new Float32Array(2*t);for(let n=0;n<t;n+=3)r[2*n]=e[n],r[2*n+1]=e[n+1],r[2*n+2]=e[n+2],r[2*n+3]=e[n+3],r[2*n+4]=e[n+4],r[2*n+5]=e[n+5];return super.setColors(r),this})),(0,n.Z)(this,"fromLine",(e=>{const t=e.geometry;return t.isBufferGeometry&&this.setPositions(Array.from(t.attributes.position.array)),this})),(0,n.Z)(this,"copy",(()=>this))}setPositions(e){const t=e.length-3,r=new Float32Array(2*t);for(let n=0;n<t;n+=3)r[2*n]=e[n],r[2*n+1]=e[n+1],r[2*n+2]=e[n+2],r[2*n+3]=e[n+3],r[2*n+4]=e[n+4],r[2*n+5]=e[n+5];return super.setPositions(r),this}}},2947:function(e,t,r){"use strict";r.d(t,{Y:function(){return a}});var n=r(4649),i=r(6173);const o={linewidth:{value:1},resolution:{value:new i.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},dashOffset:{value:0},gapSize:{value:1},opacity:{value:1}};i.ShaderLib.line={uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,o]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef ALPHA_TO_COVERAGE\n\n\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\tfloat a = vUv.x;\n\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\tfloat len2 = a * a + b * b;\n\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t}\n\n\t\t\t#else\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};class a extends i.ShaderMaterial{constructor(e={}){super({uniforms:i.UniformsUtils.clone(i.ShaderLib.line.uniforms),vertexShader:i.ShaderLib.line.vertexShader,fragmentShader:i.ShaderLib.line.fragmentShader,clipping:!0}),(0,n.Z)(this,"isLineMaterial",!0),(0,n.Z)(this,"dashed",!1),(0,n.Z)(this,"color",new i.Color(0)),(0,n.Z)(this,"lineWidth",0),(0,n.Z)(this,"dashScale",0),(0,n.Z)(this,"dashOffset",0),(0,n.Z)(this,"dashSize",0),(0,n.Z)(this,"opacity",0),(0,n.Z)(this,"resolution",new i.Vector2),(0,n.Z)(this,"alphaToCoverage",!1),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){const t=new i.Color(e);this.uniforms.diffuse.value=t.getHex()}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),e?(this.defines.ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),e?this.defines.USE_DASH="":delete this.defines.USE_DASH}}}),this.setValues(e)}}},2344:function(e,t,r){"use strict";r.d(t,{w:function(){return s}});var n=r(4649),i=r(6173),o=r(6141),a=r(2947);class s extends i.Mesh{constructor(e=new o.z,t=new a.Y({color:16777215*Math.random()})){super(e,t),(0,n.Z)(this,"type","LineSegments2"),(0,n.Z)(this,"isLineSegments2",!0),(0,n.Z)(this,"distStart",new i.Vector3),(0,n.Z)(this,"distEnd",new i.Vector3),(0,n.Z)(this,"computeLineDistances",(()=>{const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,n=new Float32Array(2*t.data.count);for(let i=0,a=0,s=t.data.count;i<s;i++,a+=2)this.distStart.fromBufferAttribute(t,i),this.distEnd.fromBufferAttribute(r,i),n[a]=0===a?0:n[a-1],n[a+1]=n[a]+this.distStart.distanceTo(this.distEnd);const o=new i.InstancedInterleavedBuffer(n,2,1);return e.setAttribute("instanceDistanceStart",new i.InterleavedBufferAttribute(o,1,0)),e.setAttribute("instanceDistanceEnd",new i.InterleavedBufferAttribute(o,1,1)),this})),(0,n.Z)(this,"rayStart",new i.Vector4),(0,n.Z)(this,"rayEnd",new i.Vector4),(0,n.Z)(this,"ssOrigin",new i.Vector4),(0,n.Z)(this,"ssOrigin3",new i.Vector3),(0,n.Z)(this,"mvMatrix",new i.Matrix4),(0,n.Z)(this,"line",new i.Line3),(0,n.Z)(this,"closestPoint",new i.Vector3),(0,n.Z)(this,"raycast",((e,t)=>{null===e.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');const r=e.ray,n=e.camera,o=n.projectionMatrix,a=this.geometry,s=this.material,l=s.resolution,c=s.linewidth+0,u=a.attributes.instanceStart,h=a.attributes.instanceEnd,d=-n.near;r.at(1,this.ssOrigin),this.ssOrigin.w=1,this.ssOrigin.applyMatrix4(n.matrixWorldInverse),this.ssOrigin.applyMatrix4(o),this.ssOrigin.multiplyScalar(1/this.ssOrigin.w),this.ssOrigin.x*=l.x/2,this.ssOrigin.y*=l.y/2,this.ssOrigin.z=0,this.ssOrigin3.set(this.ssOrigin.x,this.ssOrigin.y,this.ssOrigin.z);const f=this.matrixWorld;this.mvMatrix.multiplyMatrices(n.matrixWorldInverse,f);for(let p=0,m=u.count;p<m;p++){this.rayStart.fromBufferAttribute(u,p),this.rayEnd.fromBufferAttribute(h,p),this.rayStart.w=1,this.rayEnd.w=1,this.rayStart.applyMatrix4(this.mvMatrix),this.rayEnd.applyMatrix4(this.mvMatrix);if(this.rayStart.z>d&&this.rayEnd.z>d)continue;if(this.rayStart.z>d){const e=this.rayStart.z-this.rayEnd.z,t=(this.rayStart.z-d)/e;this.rayStart.lerp(this.rayEnd,t)}else if(this.rayEnd.z>d){const e=this.rayEnd.z-this.rayStart.z,t=(this.rayEnd.z-d)/e;this.rayEnd.lerp(this.rayStart,t)}this.rayStart.applyMatrix4(o),this.rayEnd.applyMatrix4(o),this.rayStart.multiplyScalar(1/this.rayStart.w),this.rayEnd.multiplyScalar(1/this.rayEnd.w),this.rayStart.x*=l.x/2,this.rayStart.y*=l.y/2,this.rayEnd.x*=l.x/2,this.rayEnd.y*=l.y/2,this.line.start.set(this.rayStart.x,this.rayStart.y,this.rayStart.z),this.line.start.z=0,this.line.end.set(this.rayEnd.x,this.rayEnd.y,this.rayEnd.z),this.line.end.z=0;const e=this.line.closestPointToPointParameter(this.ssOrigin3,!0);this.line.at(e,this.closestPoint);const n=i.MathUtils.lerp(this.rayStart.z,this.rayEnd.z,e),a=n>=-1&&n<=1,s=this.ssOrigin3.distanceTo(this.closestPoint)<.5*c;if(a&&s){this.line.start.fromBufferAttribute(u,p),this.line.end.fromBufferAttribute(h,p),this.line.start.applyMatrix4(f),this.line.end.applyMatrix4(f);const e=new i.Vector3,n=new i.Vector3;r.distanceSqToSegment(this.line.start,this.line.end,n,e),t.push({distance:r.origin.distanceTo(n),point:n,face:null,faceIndex:p,object:this,uv:void 0,pointOnLine:e})}}}))}}},6141:function(e,t,r){"use strict";r.d(t,{z:function(){return o}});var n=r(4649),i=r(6173);class o extends i.InstancedBufferGeometry{constructor(){super(),(0,n.Z)(this,"isLineSegmentsGeometry",!0),(0,n.Z)(this,"type","LineSegmentsGeometry"),(0,n.Z)(this,"boundingBox",null),(0,n.Z)(this,"boundingSphere",null),(0,n.Z)(this,"box",new i.Box3),(0,n.Z)(this,"vector",new i.Vector3);this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new i.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new i.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;if(e instanceof Float32Array)t=e;else{if(!Array.isArray(e))return console.error("LineSegmentsGeometry.setPosition requires either a Float32Array or regular array of numbers"),this;t=new Float32Array(e)}const r=new i.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new i.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceEnd",new i.InterleavedBufferAttribute(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;if(e instanceof Float32Array)t=e;else{if(!Array.isArray(e))return console.error("LineSegmentsGeometry.setColors requires either a Float32Array or regular array of numbers"),this;t=new Float32Array(e)}const r=new i.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new i.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceColorEnd",new i.InterleavedBufferAttribute(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(Array.from(e.attributes.position.array)),this}fromEdgesGeometry(e){return this.setPositions(Array.from(e.attributes.position.array)),this}fromMesh(e){return this.fromWireframeGeometry(new i.WireframeGeometry(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return t.isBufferGeometry&&this.setPositions(Array.from(t.attributes.position.array)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new i.Box3);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),this.box.setFromBufferAttribute(t),this.boundingBox.union(this.box))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new i.Sphere),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const r=this.boundingSphere.center;this.boundingBox&&this.boundingBox.getCenter(r);let n=0;for(let i=0,o=e.count;i<o;i++)this.vector.fromBufferAttribute(e,i),n=Math.max(n,r.distanceToSquared(this.vector)),this.vector.fromBufferAttribute(t,i),n=Math.max(n,r.distanceToSquared(this.vector));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}}},7074:function(e,t,r){"use strict";r.d(t,{g:function(){return o}});var n=r(6173);const i=new WeakMap;class o extends n.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig=null}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}load(e,t,r,o){const a=new n.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials);const s=new n.CompressedTexture;return a.load(e,(e=>{if(i.has(e)){return i.get(e).promise.then(t).catch(o)}this._createTexture([e]).then((function(e){s.copy(e),s.needsUpdate=!0,t&&t(s)})).catch(o)}),r,o),s}parseInternalAsync(e){const{levels:t}=e,r=new Set;for(let n=0;n<t.length;n++)r.add(t[n].data.buffer);return this._createTexture(Array.from(r),{...e,lowLevel:!0})}_createTexture(e,t={}){let r,o;const a=t;let s=0;for(let n=0;n<e.length;n++)s+=e[n].byteLength;const l=this._allocateWorker(s).then((t=>(r=t,o=this.workerNextTaskID++,new Promise(((t,n)=>{r._callbacks[o]={resolve:t,reject:n},r.postMessage({type:"transcode",id:o,buffers:e,taskConfig:a},e)}))))).then((e=>{const{mipmaps:t,width:r,height:i,format:o}=e,a=new n.CompressedTexture(t,r,i,o,n.UnsignedByteType);return a.minFilter=1===t.length?n.LinearFilter:n.LinearMipmapLinearFilter,a.magFilter=n.LinearFilter,a.generateMipmaps=!1,a.needsUpdate=!0,a}));return l.catch((()=>!0)).then((()=>{r&&o&&(r._taskLoad-=s,delete r._callbacks[o])})),i.set(e[0],{promise:l}),l}_initTranscoder(){if(!this.transcoderPending){const e=new n.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=new Promise(((t,r)=>{e.load("basis_transcoder.js",t,void 0,r)})),r=new n.FileLoader(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const i=new Promise(((e,t)=>{r.load("basis_transcoder.wasm",e,void 0,t)}));this.transcoderPending=Promise.all([t,i]).then((([e,t])=>{const r=o.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(o.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(o.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(o.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=t}))}return this.transcoderPending}_allocateWorker(e){return this._initTranscoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskLoad=0,e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:this.transcoderBinary}),e.onmessage=function(t){const r=t.data;switch(r.type){case"transcode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t}))}dispose(){for(let e=0;e<this.workerPool.length;e++)this.workerPool[e].terminate();return this.workerPool.length=0,this}}o.BasisFormat={ETC1S:0,UASTC_4x4:1},o.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},o.EngineFormat={RGBAFormat:n.RGBAFormat,RGBA_ASTC_4x4_Format:n.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:n.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:n.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:n.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:n.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:n.RGB_ETC1_Format,RGB_ETC2_Format:n.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:n.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:n.RGB_S3TC_DXT1_Format},o.BasisWorker=function(){let e,t,r;const n=_EngineFormat,i=_TranscoderFormat,o=_BasisFormat;onmessage=function(n){const i=n.data;switch(i.type){case"init":e=i.config,a=i.transcoderBinary,t=new Promise((e=>{r={wasmBinary:a,onRuntimeInitialized:e},BASIS(r)})).then((()=>{r.initializeBasis()}));break;case"transcode":t.then((()=>{try{const{width:e,height:t,hasAlpha:n,mipmaps:a,format:s}=i.taskConfig.lowLevel?function(e){const{basisFormat:t,width:n,height:i,hasAlpha:a}=e,{transcoderFormat:s,engineFormat:l}=c(t,n,i,a),p=r.getBytesPerBlockOrPixel(s);u(r.isFormatSupported(s),"THREE.BasisTextureLoader: Unsupported format.");const m=[];if(t===o.ETC1S){const t=new r.LowLevelETC1SImageTranscoder,{endpointCount:n,endpointsData:i,selectorCount:o,selectorsData:l,tablesData:c}=e.globalData;try{let r;r=t.decodePalettes(n,i,o,l),u(r,"THREE.BasisTextureLoader: decodePalettes() failed."),r=t.decodeTables(c),u(r,"THREE.BasisTextureLoader: decodeTables() failed.");for(let n=0;n<e.levels.length;n++){const i=e.levels[n],o=e.globalData.imageDescs[n],l=f(s,i.width,i.height),c=new Uint8Array(l);r=t.transcodeImage(s,c,l/p,i.data,h(s,i.width),d(s,i.height),i.width,i.height,i.index,o.rgbSliceByteOffset,o.rgbSliceByteLength,o.alphaSliceByteOffset,o.alphaSliceByteLength,o.imageFlags,a,!1,0,0),u(r,"THREE.BasisTextureLoader: transcodeImage() failed for level "+i.index+"."),m.push({data:c,width:i.width,height:i.height})}}finally{t.delete()}}else for(let o=0;o<e.levels.length;o++){const t=e.levels[o],n=f(s,t.width,t.height),i=new Uint8Array(n);u(r.transcodeUASTCImage(s,i,n/p,t.data,h(s,t.width),d(s,t.height),t.width,t.height,t.index,0,t.data.byteLength,0,a,!1,0,0,-1,-1),"THREE.BasisTextureLoader: transcodeUASTCImage() failed for level "+t.index+"."),m.push({data:i,width:t.width,height:t.height})}return{width:n,height:i,hasAlpha:a,mipmaps:m,format:l}}(i.taskConfig):function(e){const t=new r.BasisFile(new Uint8Array(e)),n=t.isUASTC()?o.UASTC_4x4:o.ETC1S,i=t.getImageWidth(0,0),a=t.getImageHeight(0,0),s=t.getNumLevels(0),l=t.getHasAlpha();function u(){t.close(),t.delete()}const{transcoderFormat:h,engineFormat:d}=c(n,i,a,l);if(!i||!a||!s)throw u(),new Error("THREE.BasisTextureLoader:\tInvalid texture");if(!t.startTranscoding())throw u(),new Error("THREE.BasisTextureLoader: .startTranscoding failed");const f=[];for(let r=0;r<s;r++){const e=t.getImageWidth(0,r),n=t.getImageHeight(0,r),i=new Uint8Array(t.getImageTranscodedSizeInBytes(0,r,h));if(!t.transcodeImage(i,0,r,h,0,l))throw u(),new Error("THREE.BasisTextureLoader: .transcodeImage failed.");f.push({data:i,width:e,height:n})}return u(),{width:i,height:a,hasAlpha:l,mipmaps:f,format:d}}(i.buffers[0]),l=[];for(let r=0;r<a.length;++r)l.push(a[r].data.buffer);self.postMessage({type:"transcode",id:i.id,width:e,height:t,hasAlpha:n,mipmaps:a,format:s},l)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}}))}var a};const a=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC1],engineFormat:[n.RGB_ETC1_Format,n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],s=a.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),l=a.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function c(t,r,a,c){let u,h;const d=t===o.ETC1S?s:l;for(let n=0;n<d.length;n++){const i=d[n];if(e[i.if]&&(i.basisFormat.includes(t)&&(!i.needsPowerOfTwo||p(r)&&p(a))))return u=i.transcoderFormat[c?1:0],h=i.engineFormat[c?1:0],{transcoderFormat:u,engineFormat:h}}return console.warn("THREE.BasisTextureLoader: No suitable compressed texture format found. Decoding to RGBA32."),u=i.RGBA32,h=n.RGBAFormat,{transcoderFormat:u,engineFormat:h}}function u(e,t){if(!e)throw new Error(t)}function h(e,t){return Math.ceil(t/r.getFormatBlockWidth(e))}function d(e,t){return Math.ceil(t/r.getFormatBlockHeight(e))}function f(e,t,n){const o=r.getBytesPerBlockOrPixel(e);if(r.formatIsUncompressed(e))return t*n*o;if(e===i.PVRTC1_4_RGB||e===i.PVRTC1_4_RGBA){const e=t+3&-4,r=n+3&-4;return(Math.max(8,e)*Math.max(8,r)*4+7)/8}return h(e,t)*d(e,n)*o}function p(e){return e<=2||0===(e&e-1)&&0!==e}}},1771:function(e,t,r){"use strict";r.d(t,{_:function(){return o}});var n=r(6173);const i=new WeakMap;class o extends n.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){const o=new n.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(e=>{const r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,r).then(t).catch(i)}),r,i)}decodeDracoFile(e,t,r,n){const i={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,i).then(t)}decodeGeometry(e,t){for(const i in t.attributeTypes){const e=t.attributeTypes[i];void 0!==e.BYTES_PER_ELEMENT&&(t.attributeTypes[i]=e.name)}const r=JSON.stringify(t);if(i.has(e)){const t=i.get(e);if(t.key===r)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const o=this.workerNextTaskID++,a=e.byteLength,s=this._getWorker(o,a).then((r=>(n=r,new Promise(((r,i)=>{n._callbacks[o]={resolve:r,reject:i},n.postMessage({type:"decode",id:o,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return s.catch((()=>!0)).then((()=>{n&&o&&this._releaseTask(n,o)})),i.set(e,{key:r,promise:s}),s}_createGeometry(e){const t=new n.BufferGeometry;e.index&&t.setIndex(new n.BufferAttribute(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const i=e.attributes[r],o=i.name,a=i.array,s=i.itemSize;t.setAttribute(o,new n.BufferAttribute(a,s))}return t}_loadLibrary(e,t){const r=new n.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise(((t,n)=>{r.load(e,t,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!==typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const n=a.toString(),i=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function a(){let e,t;function r(e,t,r,n,i,o){const a=o.num_components(),s=r.num_points()*a,l=s*i.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),u=e._malloc(l);t.GetAttributeDataArrayForAllPoints(r,o,c,l,u);const h=new i(e.HEAPF32.buffer,u,s).slice();return e._free(u),{name:n,array:h,itemSize:a}}onmessage=function(n){const i=n.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const n=i.buffer,o=i.taskConfig;t.then((e=>{const t=e.draco,a=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(n),n.byteLength);try{const e=function(e,t,n,i){const o=i.attributeIDs,a=i.attributeTypes;let s,l;const c=t.GetEncodedGeometryType(n);if(c===e.TRIANGULAR_MESH)s=new e.Mesh,l=t.DecodeBufferToMesh(n,s);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");s=new e.PointCloud,l=t.DecodeBufferToPointCloud(n,s)}if(!l.ok()||0===s.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const u={index:null,attributes:[]};for(const h in o){const n=self[a[h]];let l,c;if(i.useUniqueIDs)c=o[h],l=t.GetAttributeByUniqueId(s,c);else{if(c=t.GetAttributeId(s,e[o[h]]),-1===c)continue;l=t.GetAttribute(s,c)}u.attributes.push(r(e,t,s,h,n,l))}c===e.TRIANGULAR_MESH&&(u.index=function(e,t,r){const n=3*r.num_faces(),i=4*n,o=e._malloc(i);t.GetTrianglesUInt32Array(r,i,o);const a=new Uint32Array(e.HEAPF32.buffer,o,n).slice();return e._free(o),{array:a,itemSize:1}}(e,t,s));return e.destroy(s),u}(t,a,s,o),n=e.attributes.map((e=>e.array.buffer));e.index&&n.push(e.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:e},n)}catch(l){console.error(l),self.postMessage({type:"error",id:i.id,error:l.message})}finally{t.destroy(s),t.destroy(a)}}))}}}},5139:function(e,t,r){"use strict";r.d(t,{y:function(){return c}});var n=r(6173),i=r(6782),o=r(9080);let a,s,l;class c extends n.Loader{constructor(e){super(e)}load(e,t,r,i){const o=this,a=""===o.path?n.LoaderUtils.extractUrlBase(e):o.path,s=new n.FileLoader(this.manager);s.setPath(o.path),s.setResponseType("arraybuffer"),s.setRequestHeader(o.requestHeader),s.setWithCredentials(o.withCredentials),s.load(e,(function(r){try{t(o.parse(r,a))}catch(n){i?i(n):console.error(n),o.manager.itemError(e)}}),r,i)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===T(e,0,t.length)}(e))a=(new p).parse(e);else{const t=T(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let r=0;function n(t){const n=e[t-1];return e=e.slice(r+t),r++,n}for(let i=0;i<t.length;++i){if(n(1)===t[i])return!1}return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(A(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+A(t));a=(new f).parse(t)}const r=new n.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new u(r,this.manager).parse(a)}}class u{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){s=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),n=this.parseDeformers(),i=(new h).parse(n);return this.parseScene(n,i,r),l}parseConnections(){const e=new Map;if("Connections"in a){a.Connections.connections.forEach((function(t){const r=t[0],n=t[1],i=t[2];e.has(r)||e.set(r,{parents:[],children:[]});const o={ID:n,relationship:i};e.get(r).parents.push(o),e.has(n)||e.set(n,{parents:[],children:[]});const a={ID:r,relationship:i};e.get(n).children.push(a)}))}return e}parseImages(){const e={},t={};if("Video"in a.Objects){const r=a.Objects.Video;for(const n in r){const i=r[n];if(e[parseInt(n)]=i.RelativeFilename||i.Filename,"Content"in i){const e=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,o="string"===typeof i.Content&&""!==i.Content;if(e||o){const e=this.parseImage(r[n]);t[i.RelativeFilename||i.Filename]=e}}}}for(const r in e){const n=e[r];void 0!==t[n]?e[r]=t[n]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const t=e.Content,r=e.RelativeFilename||e.Filename,n=r.slice(r.lastIndexOf(".")+1).toLowerCase();let i;switch(n){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),i="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"===typeof t)return"data:"+i+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:i}))}}parseTextures(e){const t=new Map;if("Texture"in a.Objects){const r=a.Objects.Texture;for(const n in r){const i=this.parseTexture(r[n],e);t.set(parseInt(n),i)}}return t}parseTexture(e,t){const r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;const i=e.WrapModeU,o=e.WrapModeV,a=void 0!==i?i.value:0,s=void 0!==o?o.value:0;if(r.wrapS=0===a?n.RepeatWrapping:n.ClampToEdgeWrapping,r.wrapT=0===s?n.RepeatWrapping:n.ClampToEdgeWrapping,"Scaling"in e){const t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}return r}loadTexture(e,t){let r;const i=this.textureLoader.path,o=s.get(e.id).children;let a;void 0!==o&&o.length>0&&void 0!==t[o[0].ID]&&(r=t[o[0].ID],0!==r.indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));const l=e.FileName.slice(-3).toLowerCase();if("tga"===l){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new n.Texture):(t.setPath(this.textureLoader.path),a=t.load(r))}else"psd"===l?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new n.Texture):a=this.textureLoader.load(r);return this.textureLoader.setPath(i),a}parseMaterials(e){const t=new Map;if("Material"in a.Objects){const r=a.Objects.Material;for(const n in r){const i=this.parseMaterial(r[n],e);null!==i&&t.set(parseInt(n),i)}}return t}parseMaterial(e,t){const r=e.id,i=e.attrName;let o=e.ShadingModel;if("object"===typeof o&&(o=o.value),!s.has(r))return null;const a=this.parseParameters(e,t,r);let l;switch(o.toLowerCase()){case"phong":l=new n.MeshPhongMaterial;break;case"lambert":l=new n.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),l=new n.MeshPhongMaterial}return l.setValues(a),l.name=i,l}parseParameters(e,t,r){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new n.Color).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=(new n.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new n.Color).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=(new n.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new n.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new n.Color).fromArray(e.SpecularColor.value));const o=this;return s.get(r).children.forEach((function(e){const r=e.relationship;switch(r){case"Bump":i.bumpMap=o.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=o.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=o.getTexture(t,e.ID),void 0!==i.map&&(i.map.encoding=n.sRGBEncoding);break;case"DisplacementColor":i.displacementMap=o.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=o.getTexture(t,e.ID),void 0!==i.emissiveMap&&(i.emissiveMap.encoding=n.sRGBEncoding);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=o.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=o.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=n.EquirectangularReflectionMapping,i.envMap.encoding=n.sRGBEncoding);break;case"SpecularColor":i.specularMap=o.getTexture(t,e.ID),void 0!==i.specularMap&&(i.specularMap.encoding=n.sRGBEncoding);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=o.getTexture(t,e.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}})),i}getTexture(e,t){return"LayeredTexture"in a.Objects&&t in a.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=s.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in a.Objects){const r=a.Objects.Deformer;for(const n in r){const i=r[n],o=s.get(parseInt(n));if("Skin"===i.attrType){const t=this.parseSkeleton(o,r);t.ID=n,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=o.parents[0].ID,e[n]=t}else if("BlendShape"===i.attrType){const e={id:n};e.rawTargets=this.parseMorphTargets(o,r),e.id=n,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const r=[];return e.children.forEach((function(e){const i=t[e.ID];if("Cluster"!==i.attrType)return;const o={ID:e.ID,indices:[],weights:[],transformLink:(new n.Matrix4).fromArray(i.TransformLink.a)};"Indexes"in i&&(o.indices=i.Indexes.a,o.weights=i.Weights.a),r.push(o)})),{rawBones:r,bones:[]}}parseMorphTargets(e,t){const r=[];for(let n=0;n<e.children.length;n++){const i=e.children[n],o=t[i.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;a.geoID=s.get(parseInt(i.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(a)}return r}parseScene(e,t,r){l=new n.Group;const i=this.parseModels(e.skeletons,t,r),o=a.Objects.Model,c=this;i.forEach((function(e){const t=o[e.ID];c.setLookAtProperties(e,t);s.get(e.ID).parents.forEach((function(t){const r=i.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&l.add(e)})),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),l.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=C(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const u=(new d).parse();1===l.children.length&&l.children[0].isGroup&&(l.children[0].animations=u,l=l.children[0]),l.animations=u}parseModels(e,t,r){const i=new Map,o=a.Objects.Model;for(const a in o){const l=parseInt(a),c=o[a],u=s.get(l);let h=this.buildSkeleton(u,e,l,c.attrName);if(!h){switch(c.attrType){case"Camera":h=this.createCamera(u);break;case"Light":h=this.createLight(u);break;case"Mesh":h=this.createMesh(u,t,r);break;case"NurbsCurve":h=this.createCurve(u,t);break;case"LimbNode":case"Root":h=new n.Bone;break;case"Null":default:h=new n.Group}h.name=c.attrName?n.PropertyBinding.sanitizeNodeName(c.attrName):"",h.ID=l}this.getTransformData(h,c),i.set(l,h)}return i}buildSkeleton(e,t,r,i){let o=null;return e.parents.forEach((function(e){for(const a in t){const s=t[a];s.rawBones.forEach((function(t,a){if(t.ID===e.ID){const e=o;o=new n.Bone,o.matrixWorld.copy(t.transformLink),o.name=i?n.PropertyBinding.sanitizeNodeName(i):"",o.ID=r,s.bones[a]=o,null!==e&&o.add(e)}}))}})),o}createCamera(e){let t,r;if(e.children.forEach((function(e){const t=a.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)t=new n.Object3D;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let i=1;void 0!==r.NearPlane&&(i=r.NearPlane.value/1e3);let o=1e3;void 0!==r.FarPlane&&(o=r.FarPlane.value/1e3);let a=window.innerWidth,s=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(a=r.AspectWidth.value,s=r.AspectHeight.value);const l=a/s;let c=45;void 0!==r.FieldOfView&&(c=r.FieldOfView.value);const u=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new n.PerspectiveCamera(c,l,i,o),null!==u&&t.setFocalLength(u);break;case 1:t=new n.OrthographicCamera(-a/2,a/2,s/2,-s/2,i,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new n.Object3D}}return t}createLight(e){let t,r;if(e.children.forEach((function(e){const t=a.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)t=new n.Object3D;else{let e;e=void 0===r.LightType?0:r.LightType.value;let i=16777215;void 0!==r.Color&&(i=(new n.Color).fromArray(r.Color.value));let o=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(o=0);let a=0;void 0!==r.FarAttenuationEnd&&(a=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);const s=1;switch(e){case 0:t=new n.PointLight(i,o,a,s);break;case 1:t=new n.DirectionalLight(i,o);break;case 2:let e=Math.PI/3;void 0!==r.InnerAngle&&(e=n.MathUtils.degToRad(r.InnerAngle.value));let l=0;void 0!==r.OuterAngle&&(l=n.MathUtils.degToRad(r.OuterAngle.value),l=Math.max(l,1)),t=new n.SpotLight(i,o,a,e,l,s);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new n.PointLight(i,o)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let i,o=null,a=null;const s=[];return e.children.forEach((function(e){t.has(e.ID)&&(o=t.get(e.ID)),r.has(e.ID)&&s.push(r.get(e.ID))})),s.length>1?a=s:s.length>0?a=s[0]:(a=new n.MeshPhongMaterial({color:13421772}),s.push(a)),"color"in o.attributes&&s.forEach((function(e){e.vertexColors=!0})),o.FBX_Deformer?(i=new n.SkinnedMesh(o,a),i.normalizeSkinWeights()):i=new n.Mesh(o,a),i}createCurve(e,t){const r=e.children.reduce((function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e}),null),i=new n.LineBasicMaterial({color:3342591,linewidth:1});return new n.Line(r,i)}getTransformData(e,t){const r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?E(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){if("LookAtProperty"in t){s.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const r=a.Objects.Model[t.ID];if("Lcl_Translation"in r){const t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),l.add(e.target)):e.lookAt((new n.Vector3).fromArray(t))}}}))}}bindSkeleton(e,t,r){const i=this.parsePoseNodes();for(const o in e){const a=e[o];s.get(parseInt(a.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;s.get(t).parents.forEach((function(e){if(r.has(e.ID)){r.get(e.ID).bind(new n.Skeleton(a.bones),i[e.ID])}}))}}))}}parsePoseNodes(){const e={};if("Pose"in a.Objects){const t=a.Objects.Pose;for(const r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){const i=t[r].PoseNode;Array.isArray(i)?i.forEach((function(t){e[t.Node]=(new n.Matrix4).fromArray(t.Matrix.a)})):e[i.Node]=(new n.Matrix4).fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in a&&"AmbientColor"in a.GlobalSettings){const e=a.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],i=e[2];if(0!==t||0!==r||0!==i){const e=new n.Color(t,r,i);l.add(new n.AmbientLight(e,1))}}}}class h{parse(e){const t=new Map;if("Geometry"in a.Objects){const r=a.Objects.Geometry;for(const n in r){const i=s.get(parseInt(n)),o=this.parseGeometry(i,r[n],e);t.set(parseInt(n),o)}}return t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){const n=r.skeletons,i=[],o=e.parents.map((function(e){return a.Objects.Model[e.ID]}));if(0===o.length)return;const s=e.children.reduce((function(e,t){return void 0!==n[t.ID]&&(e=n[t.ID]),e}),null);e.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&i.push(r.morphTargets[e.ID])}));const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=E(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const u=C(c);return this.genGeometry(t,s,i,u)}genGeometry(e,t,r,i){const o=new n.BufferGeometry;e.attrName&&(o.name=e.attrName);const a=this.parseGeoNode(e,t),s=this.genBuffers(a),l=new n.Float32BufferAttribute(s.vertex,3);if(l.applyMatrix4(i),o.setAttribute("position",l),s.colors.length>0&&o.setAttribute("color",new n.Float32BufferAttribute(s.colors,3)),t&&(o.setAttribute("skinIndex",new n.Uint16BufferAttribute(s.weightsIndices,4)),o.setAttribute("skinWeight",new n.Float32BufferAttribute(s.vertexWeights,4)),o.FBX_Deformer=t),s.normal.length>0){const e=(new n.Matrix3).getNormalMatrix(i),t=new n.Float32BufferAttribute(s.normal,3);t.applyNormalMatrix(e),o.setAttribute("normal",t)}if(s.uvs.forEach((function(e,t){let r="uv"+(t+1).toString();0===t&&(r="uv"),o.setAttribute(r,new n.Float32BufferAttribute(s.uvs[t],2))})),a.material&&"AllSame"!==a.material.mappingType){let e=s.materialIndex[0],t=0;if(s.materialIndex.forEach((function(r,n){r!==e&&(o.addGroup(t,n-t,e),e=r,t=n)})),o.groups.length>0){const t=o.groups[o.groups.length-1],r=t.start+t.count;r!==s.materialIndex.length&&o.addGroup(r,s.materialIndex.length-r,e)}0===o.groups.length&&o.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(o,e,r,i),o}parseGeoNode(e,t){const r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,i){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[i]})}))}))),r}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,n=0,i=!1,o=[],a=[],s=[],l=[],c=[],u=[];const h=this;return e.vertexIndices.forEach((function(d,f){let p,m=!1;d<0&&(d^=-1,m=!0);let g=[],A=[];if(o.push(3*d,3*d+1,3*d+2),e.color){const t=x(f,r,d,e.color);s.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){A.push(e.weight),g.push(e.id)})),A.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const e=[0,0,0,0],t=[0,0,0,0];A.forEach((function(r,n){let i=r,o=g[n];t.forEach((function(t,r,n){if(i>t){n[r]=i,i=t;const a=e[r];e[r]=o,o=a}}))})),g=e,A=t}for(;A.length<4;)A.push(0),g.push(0);for(let e=0;e<4;++e)c.push(A[e]),u.push(g[e])}if(e.normal){const t=x(f,r,d,e.normal);a.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(p=x(f,r,d,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){const n=x(f,r,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])})),n++,m&&(h.genFace(t,e,o,p,a,s,l,c,u,n),r++,n=0,o=[],a=[],s=[],l=[],c=[],u=[])})),t}genFace(e,t,r,n,i,o,a,s,l,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(u-1)]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(u-1)]),e.vertexWeights.push(s[4*(u-1)+1]),e.vertexWeights.push(s[4*(u-1)+2]),e.vertexWeights.push(s[4*(u-1)+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(u-1)]),e.colors.push(o[3*(u-1)+1]),e.colors.push(o[3*(u-1)+2]),e.colors.push(o[3*u]),e.colors.push(o[3*u+1]),e.colors.push(o[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(a[r][0]),e.uvs[r].push(a[r][1]),e.uvs[r].push(a[r][2*(u-1)]),e.uvs[r].push(a[r][2*(u-1)+1]),e.uvs[r].push(a[r][2*u]),e.uvs[r].push(a[r][2*u+1])}))}addMorphTargets(e,t,r,n){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const i=this;r.forEach((function(r){r.rawTargets.forEach((function(r){const o=a.Objects.Geometry[r.geoID];void 0!==o&&i.genMorphGeometry(e,t,o,n,r.name)}))}))}genMorphGeometry(e,t,r,i,o){const a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==r.Vertices?r.Vertices.a:[],l=void 0!==r.Indexes?r.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c);for(let n=0;n<l.length;n++){const e=3*l[n];u[e]=s[3*n],u[e+1]=s[3*n+1],u[e+2]=s[3*n+2]}const h={vertexIndices:a,vertexPositions:u},d=this.genBuffers(h),f=new n.Float32BufferAttribute(d.vertex,3);f.name=o||r.attrName,f.applyMatrix4(i),e.morphAttributes.position.push(f)}parseNormals(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a;let i=[];return"IndexToDirect"===r&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:i,mappingType:t,referenceType:r}}parseUVs(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a;let i=[];return"IndexToDirect"===r&&(i=e.UVIndex.a),{dataSize:2,buffer:n,indices:i,mappingType:t,referenceType:r}}parseVertexColors(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a;let i=[];return"IndexToDirect"===r&&(i=e.ColorIndex.a),{dataSize:4,buffer:n,indices:i,mappingType:t,referenceType:r}}parseMaterialIndices(e){const t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const n=e.Materials.a,i=[];for(let o=0;o<n.length;++o)i.push(o);return{dataSize:1,buffer:n,indices:i,mappingType:t,referenceType:r}}parseNurbsGeometry(e){if(void 0===o.e)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new n.BufferGeometry;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new n.BufferGeometry;const r=t-1,i=e.KnotVector.a,a=[],s=e.Points.a;for(let o=0,h=s.length;o<h;o+=4)a.push((new n.Vector4).fromArray(s,o));let l,c;if("Closed"===e.Form)a.push(a[0]);else if("Periodic"===e.Form){l=r,c=i.length-1-l;for(let e=0;e<r;++e)a.push(a[e])}const u=new o.e(r,i,a,l,c).getPoints(12*a.length);return(new n.BufferGeometry).setFromPoints(u)}}class d{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const r in t){const n=t[r],i=this.addClip(n);e.push(i)}return e}parseClips(){if(void 0===a.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=a.Objects.AnimationCurveNode,t=new Map;for(const r in e){const n=e[r];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){const e={id:n.id,attr:n.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=a.Objects.AnimationCurve;for(const r in t){const n={id:t[r].id,times:t[r].KeyTime.a.map(v),values:t[r].KeyValueFloat.a},i=s.get(n.id);if(void 0!==i){const t=i.parents[0].ID,r=i.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=n:r.match(/Y/)?e.get(t).curves.y=n:r.match(/Z/)?e.get(t).curves.z=n:r.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=n)}}}parseAnimationLayers(e){const t=a.Objects.AnimationLayer,r=new Map;for(const i in t){const t=[],o=s.get(parseInt(i));if(void 0!==o){o.children.forEach((function(r,i){if(e.has(r.ID)){const o=e.get(r.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===t[i]){const e=s.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const o=a.Objects.Model[e.toString()];if(void 0===o)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",r);const s={modelName:o.attrName?n.PropertyBinding.sanitizeNodeName(o.attrName):"",ID:o.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};l.traverse((function(e){e.ID===o.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new n.Matrix4),"PreRotation"in o&&(s.preRotation=o.PreRotation.value),"PostRotation"in o&&(s.postRotation=o.PostRotation.value),t[i]=s}}t[i]&&(t[i][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===t[i]){const e=s.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,o=s.get(e).parents[0].ID,l=s.get(o).parents[0].ID,c=s.get(l).parents[0].ID,u=a.Objects.Model[c],h={modelName:u.attrName?n.PropertyBinding.sanitizeNodeName(u.attrName):"",morphName:a.Objects.Deformer[e].attrName};t[i]=h}t[i][o.attr]=o}}})),r.set(parseInt(i),t)}}return r}parseAnimStacks(e){const t=a.Objects.AnimationStack,r={};for(const n in t){const i=s.get(parseInt(n)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(i[0].ID);r[n]={name:t[n].attrName,layer:o}}return r}addClip(e){let t=[];const r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new n.AnimationClip(e.name,-1,t)}generateTracks(e){const t=[];let r=new n.Vector3,i=new n.Quaternion,o=new n.Vector3;if(e.transform&&e.transform.decompose(r,i,o),r=r.toArray(),i=(new n.Euler).setFromQuaternion(i,e.eulerOrder).toArray(),o=o.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==n&&t.push(n)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const r=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.S.curves,o,"scale");void 0!==r&&t.push(r)}if(void 0!==e.DeformPercent){const r=this.generateMorphTrack(e);void 0!==r&&t.push(r)}return t}generateVectorTrack(e,t,r,i){const o=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(o,t,r);return new n.VectorKeyframeTrack(e+"."+i,o,a)}generateRotationTrack(e,t,r,i,o,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(n.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(n.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(n.MathUtils.degToRad));const s=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(s,t,r);void 0!==i&&((i=i.map(n.MathUtils.degToRad)).push(a),i=(new n.Euler).fromArray(i),i=(new n.Quaternion).setFromEuler(i)),void 0!==o&&((o=o.map(n.MathUtils.degToRad)).push(a),o=(new n.Euler).fromArray(o),o=(new n.Quaternion).setFromEuler(o).invert());const c=new n.Quaternion,u=new n.Euler,h=[];for(let n=0;n<l.length;n+=3)u.set(l[n],l[n+1],l[n+2],a),c.setFromEuler(u),void 0!==i&&c.premultiply(i),void 0!==o&&c.multiply(o),c.toArray(h,n/3*4);return new n.QuaternionKeyframeTrack(e+".quaternion",s,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,r=t.values.map((function(e){return e/100})),i=l.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new n.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,r=t[0];for(let n=1;n<t.length;n++){const i=t[n];i!==r&&(t[e]=i,r=i,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){const n=r,i=[];let o=-1,a=-1,s=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==o){const e=t.x.values[o];i.push(e),n[0]=e}else i.push(n[0]);if(-1!==a){const e=t.y.values[a];i.push(e),n[1]=e}else i.push(n[1]);if(-1!==s){const e=t.z.values[s];i.push(e),n[2]=e}else i.push(n[2])})),i}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const r=e.values[t-1],n=e.values[t]-r,i=Math.abs(n);if(i>=180){const o=i/180,a=n/o;let s=r+a;const l=e.times[t-1],c=(e.times[t]-l)/o;let u=l+c;const h=[],d=[];for(;u<e.times[t];)h.push(u),u+=c,d.push(s),s+=a;e.times=M(e.times,t,h),e.values=M(e.values,t,d)}}}}class f{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new g,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,n){const i=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(i||o)return;const a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):s?t.parseNodeProperty(e,s,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:r},o=this.parseNodeAttr(n),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in a?("PoseNode"===r?a.PoseNode.push(i):void 0!==a[r].id&&(a[r]={},a[r][a[r].id]=a[r]),""!==o.id&&(a[r][o.id]=i)):"number"===typeof o.id?(a[r]={},a[r][o.id]=i):"Properties70"!==r&&(a[r]="PoseNode"===r?[i]:i),"number"===typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}}parseNodeProperty(e,t,r){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===n){const e=i.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]);let a=i.split(",").slice(3);a=a.map((function(e){return e.trim().replace(/^"/,"")})),n="connections",i=[t,r],function(e,t){for(let r=0,n=e.length,i=t.length;r<i;r++,n++)e[n]=t[r]}(i,a),void 0===o[n]&&(o[n]=[])}"Node"===n&&(o.id=i),n in o&&Array.isArray(o[n])?o[n].push(i):"a"!==n?o[n]=i:o.a=i,this.setCurrentProp(o,n),"a"===n&&","!==i.slice(-1)&&(o.a=S(i))}else this.parseNodeSpecialProperty(e,n,i)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=S(t.a))}parseNodeSpecialProperty(e,t,r){const n=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=n[0],o=n[1],a=n[2],s=n[3];let l=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=S(l)}this.getPrevNode()[i]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}}class p{parse(e){const t=new m(e);t.skip(23);const r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const n=new g;for(;!this.endOfContent(t);){const e=this.parseNode(t,r);null!==e&&n.add(e.name,e)}return n}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const r={},n=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(0===n)return null;const s=[];for(let h=0;h<i;h++)s.push(this.parseProperty(e));const l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",u=s.length>2?s[2]:"";for(r.singleProperty=1===i&&e.getOffset()===n;n>e.getOffset();){const n=this.parseNode(e,t);null!==n&&this.parseSubNode(a,r,n)}return r.propertyList=s,"number"===typeof l&&(r.id=l),""!==c&&(r.attrName=c),""!==u&&(r.attrType=u),""!==a&&(r.name=a),r}parseSubNode(e,t,r){if(!0===r.singleProperty){const e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){const e=[];r.propertyList.forEach((function(t,r){0!==r&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name){Object.keys(r).forEach((function(e){t[e]=r[e]}))}else if("Properties70"===e&&"P"===r.name){let e=r.propertyList[0],n=r.propertyList[1];const i=r.propertyList[2],o=r.propertyList[3];let a;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),a="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[e]={type:n,type2:i,flag:o,value:a}}else void 0===t[r.name]?"number"===typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){const t=e.getString(1);let r;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),o=e.getUint32(),a=e.getUint32();if(0===o)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}const s=(0,i.HT)(new Uint8Array(e.getArrayBuffer(a))),l=new m(s.buffer);switch(t){case"b":case"c":return l.getBooleanArray(n);case"d":return l.getFloat64Array(n);case"f":return l.getFloat32Array(n);case"i":return l.getInt32Array(n);case"l":return l.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class m{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1===(1&this.getUint8())}getBooleanArray(e){const t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let n=0;n<e;n++)t[n]=this.getUint8();const r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),n.LoaderUtils.decodeText(new Uint8Array(t))}}class g{add(e,t){this[e]=t}}function A(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function v(e){return e/46186158e3}const y=[];function x(e,t,r,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=r;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(i=n.indices[i]);const o=i*n.dataSize,a=o+n.dataSize;return function(e,t,r,n){for(let i=r,o=0;i<n;i++,o++)e[o]=t[i];return e}(y,n.buffer,o,a)}const b=new n.Euler,w=new n.Vector3;function C(e){const t=new n.Matrix4,r=new n.Matrix4,i=new n.Matrix4,o=new n.Matrix4,a=new n.Matrix4,s=new n.Matrix4,l=new n.Matrix4,c=new n.Matrix4,u=new n.Matrix4,h=new n.Matrix4,d=new n.Matrix4,f=new n.Matrix4,p=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(w.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(n.MathUtils.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(b.fromArray(t))}if(e.rotation){const t=e.rotation.map(n.MathUtils.degToRad);t.push(e.eulerOrder),i.makeRotationFromEuler(b.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(n.MathUtils.degToRad);t.push(e.eulerOrder),o.makeRotationFromEuler(b.fromArray(t)),o.invert()}e.scale&&a.scale(w.fromArray(e.scale)),e.scalingOffset&&l.setPosition(w.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(w.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(w.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(w.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));const m=r.clone().multiply(i).multiply(o),g=new n.Matrix4;g.extractRotation(h);const A=new n.Matrix4;A.copyPosition(h);const v=A.clone().invert().multiply(h),y=g.clone().invert().multiply(v),x=a,C=new n.Matrix4;if(0===p)C.copy(g).multiply(m).multiply(y).multiply(x);else if(1===p)C.copy(g).multiply(y).multiply(m).multiply(x);else{const e=(new n.Matrix4).scale((new n.Vector3).setFromMatrixScale(d)).clone().invert(),t=y.clone().multiply(e);C.copy(g).multiply(m).multiply(t).multiply(x)}const E=u.clone().invert(),S=s.clone().invert();let T=t.clone().multiply(c).multiply(u).multiply(r).multiply(i).multiply(o).multiply(E).multiply(l).multiply(s).multiply(a).multiply(S);const M=(new n.Matrix4).copyPosition(T),I=h.clone().multiply(M);return f.copyPosition(I),T=f.clone().multiply(C),T.premultiply(h.invert()),T}function E(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function S(e){return e.split(",").map((function(e){return parseFloat(e)}))}function T(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),n.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function M(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}},8569:function(e,t,r){"use strict";r.d(t,{E:function(){return i}});var n=r(6173);class i extends n.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new c(e)})),this.register((function(e){return new m(e)})),this.register((function(e){return new g(e)})),this.register((function(e){return new u(e)})),this.register((function(e){return new h(e)})),this.register((function(e){return new d(e)})),this.register((function(e){return new f(e)})),this.register((function(e){return new p(e)})),this.register((function(e){return new s(e)})),this.register((function(e){return new A(e)}))}load(e,t,r,i){const o=this;let a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:n.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const s=function(t){i?i(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},l=new n.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(r){try{o.parse(r,a,(function(r){t(r),o.manager.itemEnd(e)}),s)}catch(n){s(n)}}),r,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let o;const s={},c={};if("string"===typeof e)o=e;else{if(n.LoaderUtils.decodeText(new Uint8Array(e,0,4))===v){try{s[a.KHR_BINARY_GLTF]=new b(e)}catch(d){return void(i&&i(d))}o=s[a.KHR_BINARY_GLTF].content}else o=n.LoaderUtils.decodeText(new Uint8Array(e))}const u=JSON.parse(o);if(void 0===u.asset||u.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const h=new $(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let n=0;n<this.pluginCallbacks.length;n++){const e=this.pluginCallbacks[n](h);c[e.name]=e,s[e.name]=!0}if(u.extensionsUsed)for(let n=0;n<u.extensionsUsed.length;++n){const e=u.extensionsUsed[n],t=u.extensionsRequired||[];switch(e){case a.KHR_MATERIALS_UNLIT:s[e]=new l;break;case a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[e]=new S;break;case a.KHR_DRACO_MESH_COMPRESSION:s[e]=new w(u,this.dracoLoader);break;case a.KHR_TEXTURE_TRANSFORM:s[e]=new C;break;case a.KHR_MESH_QUANTIZATION:s[e]=new T;break;default:t.indexOf(e)>=0&&void 0===c[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}h.setExtensions(s),h.setPlugins(c),h.parse(r,i)}parseAsync(e,t){const r=this;return new Promise((function(n,i){r.parse(e,t,n,i)}))}}function o(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const a={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class s{constructor(e){this.parser=e,this.name=a.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let i=t.cache.get(r);if(i)return i;const o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let s;const l=new n.Color(16777215);void 0!==a.color&&l.fromArray(a.color);const c=void 0!==a.range?a.range:0;switch(a.type){case"directional":s=new n.DirectionalLight(l),s.target.position.set(0,0,-1),s.add(s.target);break;case"point":s=new n.PointLight(l),s.distance=c;break;case"spot":s=new n.SpotLight(l),s.distance=c,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,s.angle=a.spot.outerConeAngle,s.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return s.position.set(0,0,0),s.decay=2,void 0!==a.intensity&&(s.intensity=a.intensity),s.name=t.createUniqueName(a.name||"light_"+e),i=Promise.resolve(s),t.cache.add(r,i),i}createNodeAttachment(e){const t=this,r=this.parser,n=r.json.nodes[e],i=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return r._getNodeRef(t.cache,i,e)}))}}class l{constructor(){this.name=a.KHR_MATERIALS_UNLIT}getMaterialType(){return n.MeshBasicMaterial}extendParams(e,t,r){const i=[];e.color=new n.Color(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const t=o.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==o.baseColorTexture&&i.push(r.assignTexture(e,"map",o.baseColorTexture))}return Promise.all(i)}}class c{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&o.push(r.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&o.push(r.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(o.push(r.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){const e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new n.Vector2(e,e)}return Promise.all(o)}}class u{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new n.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=i.extensions[this.name];return void 0!==a.sheenColorFactor&&t.sheenColor.fromArray(a.sheenColorFactor),void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&o.push(r.assignTexture(t,"sheenColorMap",a.sheenColorTexture)),void 0!==a.sheenRoughnessTexture&&o.push(r.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(o)}}class h{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(r.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class d{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&o.push(r.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||0;const s=a.attenuationColor||[1,1,1];return t.attenuationColor=new n.Color(s[0],s[1],s[2]),Promise.all(o)}}class f{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class p{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],a=i.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&o.push(r.assignTexture(t,"specularIntensityMap",a.specularTexture));const s=a.specularColorFactor||[1,1,1];return t.specularColor=new n.Color(s[0],s[1],s[2]),void 0!==a.specularColorTexture&&o.push(r.assignTexture(t,"specularColorMap",a.specularColorTexture).then((function(e){e.encoding=n.sRGBEncoding}))),Promise.all(o)}}class m{constructor(e){this.parser=e,this.name=a.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],o=r.images[i.source],a=t.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o,a)}}class g{constructor(e){this.parser=e,this.name=a.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,n=r.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],a=n.images[o.source];let s=r.textureLoader;if(a.uri){const e=r.options.manager.getHandler(a.uri);null!==e&&(s=e)}return this.detectSupport().then((function(i){if(i)return r.loadTextureImage(e,a,s);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class A{constructor(e){this.name=a.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const e=r.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,i.ready]).then((function(t){const r=e.byteOffset||0,n=e.byteLength||0,o=e.count,a=e.byteStride,s=new ArrayBuffer(o*a),l=new Uint8Array(t[0],r,n);return i.decodeGltfBuffer(new Uint8Array(s),o,a,l,e.mode,e.filter),s}))}return null}}const v="glTF",y=1313821514,x=5130562;class b{constructor(e){this.name=a.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:n.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==v)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,i=new DataView(e,12);let o=0;for(;o<r;){const t=i.getUint32(o,!0);o+=4;const r=i.getUint32(o,!0);if(o+=4,r===y){const r=new Uint8Array(e,12+o,t);this.content=n.LoaderUtils.decodeText(r)}else if(r===x){const r=12+o;this.body=e.slice(r,r+t)}o+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class w{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=a.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(const c in o){const e=V[c]||c.toLowerCase();a[e]=o[c]}for(const c in e.attributes){const t=V[c]||c.toLowerCase();if(void 0!==o[c]){const n=r.accessors[e.attributes[c]],i=k[n.componentType];l[t]=i,s[t]=!0===n.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const r=e.attributes[t],n=s[t];void 0!==n&&(r.normalized=n)}t(e)}),a,l)}))}))}}class C{constructor(){this.name=a.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class E extends n.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new n.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(const t in s)e.uniforms[t]=s[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class S{constructor(){this.name=a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return E}extendParams(e,t,r){const i=t.extensions[this.name];e.color=new n.Color(1,1,1),e.opacity=1;const o=[];if(Array.isArray(i.diffuseFactor)){const t=i.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==i.diffuseTexture&&o.push(r.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new n.Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new n.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){const t=i.specularGlossinessTexture;o.push(r.assignTexture(e,"glossinessMap",t)),o.push(r.assignTexture(e,"specularMap",t))}return Promise.all(o)}createMaterial(e){const t=new E(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=n.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class T{constructor(){this.name=a.KHR_MESH_QUANTIZATION}}class M extends n.Interpolant{constructor(e,t,r,n){super(e,t,r,n)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n*3+n;for(let o=0;o!==n;o++)t[o]=r[i+o];return t}}M.prototype.beforeStart_=M.prototype.copySampleValue_,M.prototype.afterEnd_=M.prototype.copySampleValue_,M.prototype.interpolate_=function(e,t,r,n){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=n-t,u=(r-t)/c,h=u*u,d=h*u,f=e*l,p=f-l,m=-2*d+3*h,g=d-h,A=1-m,v=g-h+u;for(let y=0;y!==a;y++){const e=o[p+y+a],t=o[p+y+s]*c,r=o[f+y+a],n=o[f+y]*c;i[y]=A*e+v*t+m*r+g*n}return i};const I=new n.Quaternion;class B extends M{interpolate_(e,t,r,n){const i=super.interpolate_(e,t,r,n);return I.fromArray(i).normalize().toArray(i),i}}const _=0,F=1,P=2,R=3,L=4,D=5,N=6,k={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},O={9728:n.NearestFilter,9729:n.LinearFilter,9984:n.NearestMipmapNearestFilter,9985:n.LinearMipmapNearestFilter,9986:n.NearestMipmapLinearFilter,9987:n.LinearMipmapLinearFilter},U={33071:n.ClampToEdgeWrapping,33648:n.MirroredRepeatWrapping,10497:n.RepeatWrapping},Q={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},V={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},G={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},z={CUBICSPLINE:void 0,LINEAR:n.InterpolateLinear,STEP:n.InterpolateDiscrete},j="OPAQUE",H="MASK",W="BLEND";function Z(e,t,r){for(const n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function X(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Y(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){const r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,n=r.length;t<n;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function J(e){const t=e.extensions&&e.extensions[a.KHR_DRACO_MESH_COMPRESSION];let r;return r=t?"draco:"+t.bufferView+":"+t.indices+":"+q(t.attributes):e.indices+":"+q(e.attributes)+":"+e.mode,r}function q(e){let t="";const r=Object.keys(e).sort();for(let n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}function K(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class ${constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new o,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)?this.textureLoader=new n.ImageBitmapLoader(this.options.manager):this.textureLoader=new n.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new n.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(t){const o={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};Z(i,o,n),X(o,n),Promise.all(r._invokeAll((function(e){return e.afterRoot&&e.afterRoot(o)}))).then((function(){e(o)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const r=t[n].joints;for(let t=0,n=r.length;t<n;t++)e[r[t]].isBone=!0}for(let n=0,i=e.length;n<i;n++){const t=e[n];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(r[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const n=r.clone(),i=(e,t)=>{const r=this.associations.get(e);null!=r&&this.associations.set(t,r);for(const[n,o]of e.children.entries())i(o,t.children[n])};return i(r,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const n=e(t[r]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i&&r.push(i)}return r}getDependency(e,t){const r=e+":"+t;let n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[a.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(e,o){r.load(n.LoaderUtils.resolveURL(t.uri,i.path),e,void 0,(function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)}))}loadAccessor(e){const t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);const o=[];return void 0!==i.bufferView?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),void 0!==i.sparse&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then((function(e){const o=e[0],a=Q[i.type],s=k[i.componentType],l=s.BYTES_PER_ELEMENT,c=l*a,u=i.byteOffset||0,h=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;let f,p;if(h&&h!==c){const e=Math.floor(u/h),r="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let c=t.cache.get(r);c||(f=new s(o,e*h,i.count*h/l),c=new n.InterleavedBuffer(f,h/l),t.cache.add(r,c)),p=new n.InterleavedBufferAttribute(c,a,u%h/l,d)}else f=null===o?new s(i.count*a):new s(o,u,i.count*a),p=new n.BufferAttribute(f,a,d);if(void 0!==i.sparse){const t=Q.SCALAR,r=k[i.sparse.indices.componentType],l=i.sparse.indices.byteOffset||0,c=i.sparse.values.byteOffset||0,u=new r(e[1],l,i.sparse.count*t),h=new s(e[2],c,i.sparse.count*a);null!==o&&(p=new n.BufferAttribute(p.array.slice(),p.itemSize,p.normalized));for(let e=0,n=u.length;e<n;e++){const t=u[e];if(p.setX(t,h[e*a]),a>=2&&p.setY(t,h[e*a+1]),a>=3&&p.setZ(t,h[e*a+2]),a>=4&&p.setW(t,h[e*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,r=this.options,n=t.textures[e],i=t.images[n.source];let o=this.textureLoader;if(i.uri){const e=r.manager.getHandler(i.uri);null!==e&&(o=e)}return this.loadTextureImage(e,i,o)}loadTextureImage(e,t,r){const i=this,o=this.json,a=this.options,s=o.textures[e],l=(t.uri||t.bufferView)+":"+s.sampler;if(this.textureCache[l])return this.textureCache[l];const c=self.URL||self.webkitURL;let u=t.uri||"",h=!1;if(void 0!==t.bufferView)u=i.getDependency("bufferView",t.bufferView).then((function(e){h=!0;const r=new Blob([e],{type:t.mimeType});return u=c.createObjectURL(r),u}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(u).then((function(e){return new Promise((function(t,i){let o=t;!0===r.isImageBitmapLoader&&(o=function(e){const r=new n.Texture(e);r.needsUpdate=!0,t(r)}),r.load(n.LoaderUtils.resolveURL(e,a.path),o,void 0,i)}))})).then((function(t){!0===h&&c.revokeObjectURL(u),t.flipY=!1,s.name&&(t.name=s.name);const r=(o.samplers||{})[s.sampler]||{};return t.magFilter=O[r.magFilter]||n.LinearFilter,t.minFilter=O[r.minFilter]||n.LinearMipmapLinearFilter,t.wrapS=U[r.wrapS]||n.RepeatWrapping,t.wrapT=U[r.wrapT]||n.RepeatWrapping,i.associations.set(t,{textures:e}),t})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",u),null}));return this.textureCache[l]=d,d}assignTexture(e,t,r){const n=this;return this.getDependency("texture",r.index).then((function(i){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),n.extensions[a.KHR_TEXTURE_TRANSFORM]){const e=void 0!==r.extensions?r.extensions[a.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(i);i=n.extensions[a.KHR_TEXTURE_TRANSFORM].extendTexture(i,e),n.associations.set(i,t)}}return e[t]=i,i}))}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const i=void 0===t.attributes.tangent,o=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new n.PointsMaterial,n.Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){const e="LineBasicMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new n.LineBasicMaterial,n.Material.prototype.copy.call(t,r),t.color.copy(r.color),this.cache.add(e,t)),r=t}if(i||o||a){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),i&&(e+="derivative-tangents:"),o&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),o&&(t.vertexColors=!0),a&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=r}getMaterialType(){return n.MeshStandardMaterial}loadMaterial(e){const t=this,r=this.json,i=this.extensions,o=r.materials[e];let s;const l={},c=o.extensions||{},u=[];if(c[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=i[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=e.getMaterialType(),u.push(e.extendParams(l,o,t))}else if(c[a.KHR_MATERIALS_UNLIT]){const e=i[a.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),u.push(e.extendParams(l,o,t))}else{const r=o.pbrMetallicRoughness||{};if(l.color=new n.Color(1,1,1),l.opacity=1,Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;l.color.fromArray(e),l.opacity=e[3]}void 0!==r.baseColorTexture&&u.push(t.assignTexture(l,"map",r.baseColorTexture)),l.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,l.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(u.push(t.assignTexture(l,"metalnessMap",r.metallicRoughnessTexture)),u.push(t.assignTexture(l,"roughnessMap",r.metallicRoughnessTexture))),s=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),u.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))))}!0===o.doubleSided&&(l.side=n.DoubleSide);const h=o.alphaMode||j;if(h===W?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,h===H&&(l.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&s!==n.MeshBasicMaterial&&(u.push(t.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new n.Vector2(1,1),void 0!==o.normalTexture.scale)){const e=o.normalTexture.scale;l.normalScale.set(e,e)}return void 0!==o.occlusionTexture&&s!==n.MeshBasicMaterial&&(u.push(t.assignTexture(l,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(l.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&s!==n.MeshBasicMaterial&&(l.emissive=(new n.Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&s!==n.MeshBasicMaterial&&u.push(t.assignTexture(l,"emissiveMap",o.emissiveTexture)),Promise.all(u).then((function(){let r;return r=s===E?i[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new s(l),o.name&&(r.name=o.name),r.map&&(r.map.encoding=n.sRGBEncoding),r.emissiveMap&&(r.emissiveMap.encoding=n.sRGBEncoding),X(r,o),t.associations.set(r,{materials:e}),o.extensions&&Z(i,r,o),r}))}createUniqueName(e){const t=n.PropertyBinding.sanitizeNodeName(e||"");let r=t;for(let n=1;this.nodeNamesUsed[r];++n)r=t+"_"+n;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){const t=this,r=this.extensions,i=this.primitiveCache;function o(e){return r[a.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(r){return te(r,e,t)}))}const s=[];for(let l=0,c=e.length;l<c;l++){const r=e[l],c=J(r),u=i[c];if(u)s.push(u.promise);else{let e;e=r.extensions&&r.extensions[a.KHR_DRACO_MESH_COMPRESSION]?o(r):te(new n.BufferGeometry,r,t),i[c]={primitive:r,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,r=this.json,i=this.extensions,o=r.meshes[e],a=o.primitives,s=[];for(let c=0,u=a.length;c<u;c++){const e=void 0===a[c].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new n.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.FrontSide})),l.DefaultMaterial):this.getDependency("material",a[c].material);s.push(e)}var l;return s.push(t.loadGeometries(a)),Promise.all(s).then((function(r){const s=r.slice(0,r.length-1),l=r[r.length-1],c=[];for(let h=0,d=l.length;h<d;h++){const r=l[h],u=a[h];let d;const f=s[h];if(u.mode===L||u.mode===D||u.mode===N||void 0===u.mode)d=!0===o.isSkinnedMesh?new n.SkinnedMesh(r,f):new n.Mesh(r,f),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),u.mode===D?d.geometry=re(d.geometry,n.TriangleStripDrawMode):u.mode===N&&(d.geometry=re(d.geometry,n.TriangleFanDrawMode));else if(u.mode===F)d=new n.LineSegments(r,f);else if(u.mode===R)d=new n.Line(r,f);else if(u.mode===P)d=new n.LineLoop(r,f);else{if(u.mode!==_)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);d=new n.Points(r,f)}Object.keys(d.geometry.morphAttributes).length>0&&Y(d,o),d.name=t.createUniqueName(o.name||"mesh_"+e),X(d,o),u.extensions&&Z(i,d,u),t.assignFinalMaterial(d),c.push(d)}for(let n=0,i=c.length;n<i;n++)t.associations.set(c[n],{meshes:e,primitives:n});if(1===c.length)return c[0];const u=new n.Group;t.associations.set(u,{meshes:e});for(let e=0,t=c.length;e<t;e++)u.add(c[e]);return u}))}loadCamera(e){let t;const r=this.json.cameras[e],i=r[r.type];if(i)return"perspective"===r.type?t=new n.PerspectiveCamera(n.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new n.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),X(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return r.inverseBindMatrices=e,r}))}loadAnimation(e){const t=this.json.animations[e],r=[],i=[],o=[],a=[],s=[];for(let n=0,l=t.channels.length;n<l;n++){const e=t.channels[n],l=t.samplers[e.sampler],c=e.target,u=void 0!==c.node?c.node:c.id,h=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output;r.push(this.getDependency("node",u)),i.push(this.getDependency("accessor",h)),o.push(this.getDependency("accessor",d)),a.push(l),s.push(c)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(s)]).then((function(r){const i=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=[];for(let e=0,t=i.length;e<t;e++){const t=i[e],r=o[e],u=a[e],h=s[e],d=l[e];if(void 0===t)continue;let f;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,G[d.path]){case G.weights:f=n.NumberKeyframeTrack;break;case G.rotation:f=n.QuaternionKeyframeTrack;break;case G.position:case G.scale:default:f=n.VectorKeyframeTrack}const p=t.name?t.name:t.uuid,m=void 0!==h.interpolation?z[h.interpolation]:n.InterpolateLinear,g=[];G[d.path]===G.weights?t.traverse((function(e){e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(p);let A=u.array;if(u.normalized){const e=K(A.constructor),t=new Float32Array(A.length);for(let r=0,n=A.length;r<n;r++)t[r]=A[r]*e;A=t}for(let e=0,i=g.length;e<i;e++){const t=new f(g[e]+"."+G[d.path],r.array,A,m);"CUBICSPLINE"===h.interpolation&&(t.createInterpolant=function(e){return new(this instanceof n.QuaternionKeyframeTrack?B:M)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const u=t.name?t.name:"animation_"+e;return new n.AnimationClip(u,void 0,c)}))}createNodeMesh(e){const t=this.json,r=this,n=t.nodes[e];return void 0===n.mesh?null:r.getDependency("mesh",n.mesh).then((function(e){const t=r._getNodeRef(r.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,r=n.weights.length;t<r;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this.json,r=this.extensions,i=this,o=t.nodes[e],a=o.name?i.createUniqueName(o.name):"";return function(){const t=[],r=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return r&&t.push(r),void 0!==o.camera&&t.push(i.getDependency("camera",o.camera).then((function(e){return i._getNodeRef(i.cameraCache,o.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let s;if(s=!0===o.isBone?new n.Bone:t.length>1?new n.Group:1===t.length?t[0]:new n.Object3D,s!==t[0])for(let e=0,r=t.length;e<r;e++)s.add(t[e]);if(o.name&&(s.userData.name=o.name,s.name=a),X(s,o),o.extensions&&Z(r,s,o),void 0!==o.matrix){const e=new n.Matrix4;e.fromArray(o.matrix),s.applyMatrix4(e)}else void 0!==o.translation&&s.position.fromArray(o.translation),void 0!==o.rotation&&s.quaternion.fromArray(o.rotation),void 0!==o.scale&&s.scale.fromArray(o.scale);return i.associations.has(s)||i.associations.set(s,{}),i.associations.get(s).nodes=e,s}))}loadScene(e){const t=this.json,r=this.extensions,i=this.json.scenes[e],o=this,a=new n.Group;i.name&&(a.name=o.createUniqueName(i.name)),X(a,i),i.extensions&&Z(r,a,i);const s=i.nodes||[],l=[];for(let n=0,c=s.length;n<c;n++)l.push(ee(s[n],a,t,o));return Promise.all(l).then((function(){return o.associations=(e=>{const t=new Map;for(const[r,i]of o.associations)(r instanceof n.Material||r instanceof n.Texture)&&t.set(r,i);return e.traverse((e=>{const r=o.associations.get(e);null!=r&&t.set(e,r)})),t})(a),a}))}}function ee(e,t,r,i){const o=r.nodes[e];return i.getDependency("node",e).then((function(e){if(void 0===o.skin)return e;let t;return i.getDependency("skin",o.skin).then((function(e){t=e;const r=[];for(let n=0,o=t.joints.length;n<o;n++)r.push(i.getDependency("node",t.joints[n]));return Promise.all(r)})).then((function(r){return e.traverse((function(e){if(!e.isMesh)return;const i=[],o=[];for(let a=0,s=r.length;a<s;a++){const e=r[a];if(e){i.push(e);const r=new n.Matrix4;void 0!==t.inverseBindMatrices&&r.fromArray(t.inverseBindMatrices.array,16*a),o.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}e.bind(new n.Skeleton(i,o),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const n=[];if(o.children){const t=o.children;for(let o=0,a=t.length;o<a;o++){const a=t[o];n.push(ee(a,e,r,i))}}return Promise.all(n)}))}function te(e,t,r){const i=t.attributes,o=[];function a(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const n in i){const t=V[n]||n.toLowerCase();t in e.attributes||o.push(a(i[n],t))}if(void 0!==t.indices&&!e.index){const n=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));o.push(n)}return X(e,t),function(e,t,r){const i=t.attributes,o=new n.Box3;if(void 0===i.POSITION)return;{const e=r.json.accessors[i.POSITION],t=e.min,a=e.max;if(void 0===t||void 0===a)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new n.Vector3(t[0],t[1],t[2]),new n.Vector3(a[0],a[1],a[2])),e.normalized){const t=K(k[e.componentType]);o.min.multiplyScalar(t),o.max.multiplyScalar(t)}}const a=t.targets;if(void 0!==a){const e=new n.Vector3,t=new n.Vector3;for(let n=0,i=a.length;n<i;n++){const i=a[n];if(void 0!==i.POSITION){const n=r.json.accessors[i.POSITION],o=n.min,a=n.max;if(void 0!==o&&void 0!==a){if(t.setX(Math.max(Math.abs(o[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(o[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(o[2]),Math.abs(a[2]))),n.normalized){const e=K(k[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(e)}e.boundingBox=o;const s=new n.Sphere;o.getCenter(s.center),s.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=s}(e,t,r),Promise.all(o).then((function(){return void 0!==t.targets?function(e,t,r){let n=!1,i=!1;for(let s=0,l=t.length;s<l;s++){const e=t[s];if(void 0!==e.POSITION&&(n=!0),void 0!==e.NORMAL&&(i=!0),n&&i)break}if(!n&&!i)return Promise.resolve(e);const o=[],a=[];for(let s=0,l=t.length;s<l;s++){const l=t[s];if(n){const t=void 0!==l.POSITION?r.getDependency("accessor",l.POSITION):e.attributes.position;o.push(t)}if(i){const t=void 0!==l.NORMAL?r.getDependency("accessor",l.NORMAL):e.attributes.normal;a.push(t)}}return Promise.all([Promise.all(o),Promise.all(a)]).then((function(t){const r=t[0],o=t[1];return n&&(e.morphAttributes.position=r),i&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,r):e}))}function re(e,t){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const i=r.count-2,o=[];if(t===n.TriangleFanDrawMode)for(let n=1;n<=i;n++)o.push(r.getX(0)),o.push(r.getX(n)),o.push(r.getX(n+1));else for(let n=0;n<i;n++)n%2===0?(o.push(r.getX(n)),o.push(r.getX(n+1)),o.push(r.getX(n+2))):(o.push(r.getX(n+2)),o.push(r.getX(n+1)),o.push(r.getX(n)));o.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(o),a}},3994:function(e,t,r){"use strict";r.d(t,{a:function(){return S}});var n=r(6173),i=r(7074),o=r(2241).Buffer;let a,s,l;const c={env:{emscripten_notify_memory_growth:function(e){l=new Uint8Array(s.exports.memory.buffer)}}};class u{init(){return a||(a="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+h).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,c))).then(this._init):WebAssembly.instantiate(o.from(h,"base64"),c).then(this._init),a)}_init(e){s=e.instance,c.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!s)throw new Error("ZSTDDecoder: Await .init() before decoding.");const r=e.byteLength,n=s.exports.malloc(r);l.set(e,n),t=t||Number(s.exports.ZSTD_findDecompressedSize(n,r));const i=s.exports.malloc(t),o=s.exports.ZSTD_decompress(i,t,n,r),a=l.slice(i,i+o);return s.exports.free(n),s.exports.free(i),a}}const h="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";var d=r(2241).Buffer;new Uint8Array([0]);const f=[171,75,84,88,32,50,48,187,13,10,26,10];var p,m,g,A,v,y,x,b;!function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"}(p||(p={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(m||(m={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(g||(g={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(A||(A={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(v||(v={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(y||(y={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(x||(x={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(b||(b={}));class w{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=p.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:m.BASICFORMAT,versionNumber:2,descriptorBlockSize:40,colorModel:g.UNSPECIFIED,colorPrimaries:A.SRGB,transferFunction:A.SRGB,flags:y.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null}}class C{constructor(e,t,r,n){this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const r=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,n)}}function E(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):d.from(e).toString("utf8")}class S extends n.CompressedTextureLoader{constructor(e){super(e),this.basisLoader=new i.g(e),this.zstd=new u,this.zstd.init(),"undefined"!==typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.basisLoader.setTranscoderPath(e),this}setWorkerLimit(e){return this.basisLoader.setWorkerLimit(e),this}detectSupport(e){return this.basisLoader.detectSupport(e),this}dispose(){return this.basisLoader.dispose(),this}load(e,t,r,i){var o=this,a=new n.CompressedTexture;return new Promise((function(t,i){new n.FileLoader(o.manager).setPath(o.path).setResponseType("arraybuffer").load(e,t,r,i)})).then((function(e){o.parse(e,(function(e){a.copy(e),a.needsUpdate=!0,t&&t(a)}),i)})).catch(i),a}parse(e,t,r){var o=this,a=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,f.length);if(t[0]!==f[0]||t[1]!==f[1]||t[2]!==f[2]||t[3]!==f[3]||t[4]!==f[4]||t[5]!==f[5]||t[6]!==f[6]||t[7]!==f[7]||t[8]!==f[8]||t[9]!==f[9]||t[10]!==f[10]||t[11]!==f[11])throw new Error("Missing KTX 2.0 identifier.");const r=new w,n=17*Uint32Array.BYTES_PER_ELEMENT,i=new C(e,f.length,n,!0);r.vkFormat=i._nextUint32(),r.typeSize=i._nextUint32(),r.pixelWidth=i._nextUint32(),r.pixelHeight=i._nextUint32(),r.pixelDepth=i._nextUint32(),r.layerCount=i._nextUint32(),r.faceCount=i._nextUint32();const o=i._nextUint32();r.supercompressionScheme=i._nextUint32();const a=i._nextUint32(),s=i._nextUint32(),l=i._nextUint32(),c=i._nextUint32(),u=i._nextUint64(),h=i._nextUint64(),d=new C(e,f.length+n,3*o*8,!0);for(let f=0;f<o;f++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const p=new C(e,a,s,!0),m={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:{x:p._nextUint8()+1,y:p._nextUint8()+1,z:p._nextUint8()+1,w:p._nextUint8()+1},bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},g=(m.descriptorBlockSize/4-6)/4;for(let f=0;f<g;f++)m.samples[f]={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelID:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:p._nextUint32(),sampleUpper:p._nextUint32()};r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(m);const A=new C(e,l,c,!0);for(;A._offset<c;){const e=A._nextUint32(),t=A._scan(e),n=E(t),i=A._scan(e-t.byteLength);r.keyValue[n]=n.match(/^ktx/i)?E(i):i,A._offset%4&&A._skip(4-A._offset%4)}if(h<=0)return r;const v=new C(e,u,h,!0),y=v._nextUint16(),x=v._nextUint16(),b=v._nextUint32(),S=v._nextUint32(),T=v._nextUint32(),M=v._nextUint32(),I=[];for(let f=0;f<o;f++)I.push({imageFlags:v._nextUint32(),rgbSliceByteOffset:v._nextUint32(),rgbSliceByteLength:v._nextUint32(),alphaSliceByteOffset:v._nextUint32(),alphaSliceByteLength:v._nextUint32()});const B=u+v._offset,_=B+b,F=_+S,P=F+T,R=new Uint8Array(e.buffer,e.byteOffset+B,b),L=new Uint8Array(e.buffer,e.byteOffset+_,S),D=new Uint8Array(e.buffer,e.byteOffset+F,T),N=new Uint8Array(e.buffer,e.byteOffset+P,M);return r.globalData={endpointCount:y,selectorCount:x,imageDescs:I,endpointsData:R,selectorsData:L,tablesData:D,extendedData:N},r}(new Uint8Array(e));if(a.pixelDepth>0)throw new Error("THREE.KTX2Loader: Only 2D textures are currently supported.");if(a.layerCount>1)throw new Error("THREE.KTX2Loader: Array textures are not currently supported.");if(a.faceCount>1)throw new Error("THREE.KTX2Loader: Cube textures are not currently supported.");var s=T.getBasicDFD(a);return T.createLevels(a,this.zstd).then((function(e){var t=s.colorModel===g.UASTC?i.g.BasisFormat.UASTC_4x4:i.g.BasisFormat.ETC1S,r={levels:e,width:a.pixelWidth,height:a.pixelHeight,basisFormat:t,hasAlpha:T.getAlpha(a)};return t===i.g.BasisFormat.ETC1S&&(r.globalData=a.globalData),o.basisLoader.parseInternalAsync(r)})).then((function(e){e.encoding=s.transferFunction===v.SRGB?n.sRGBEncoding:n.LinearEncoding,e.premultiplyAlpha=T.getPremultiplyAlpha(a),t(e)})).catch(r),this}}var T={createLevels:async function(e,t){e.supercompressionScheme===p.ZSTD&&await t.init();for(var r=[],n=e.pixelWidth,i=e.pixelHeight,o=0;o<e.levels.length;o++){var a=Math.max(1,Math.floor(n/Math.pow(2,o))),s=Math.max(1,Math.floor(i/Math.pow(2,o))),l=e.levels[o].levelData;e.supercompressionScheme===p.ZSTD&&(l=t.decode(l,e.levels[o].uncompressedByteLength)),r.push({index:o,width:a,height:s,data:l})}return r},getBasicDFD:function(e){return e.dataFormatDescriptor[0]},getAlpha:function(e){var t=this.getBasicDFD(e);return t.colorModel===g.UASTC?(15&t.samples[0].channelID)===b.RGBA:2===t.samples.length&&(15&t.samples[1].channelID)===x.AAA},getPremultiplyAlpha:function(e){return!!(this.getBasicDFD(e).flags&y.ALPHA_PREMULTIPLIED)}}},5990:function(e,t,r){"use strict";r.d(t,{x:function(){return i}});var n=r(6173);class i extends n.DataTextureLoader{constructor(e){super(e),this.type=n.HalfFloatType}parse(e){const t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,r){t=t||1024;let n=e.pos,i=-1,o=0,a="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(i=s.indexOf("\n"))&&o<t&&n<e.byteLength;)a+=s,o+=s.length,n+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<i&&(!1!==r&&(e.pos+=o+i+1),a+s.slice(0,i))},i=function(e,t,r,n){const i=e[t+3],o=Math.pow(2,i-128)/255;r[n+0]=e[t+0]*o,r[n+1]=e[t+1]*o,r[n+2]=e[t+2]*o,r[n+3]=1},o=function(e,t,r,i){const o=e[t+3],a=Math.pow(2,o-128)/255;r[i+0]=n.DataUtils.toHalfFloat(Math.min(e[t+0]*a,65504)),r[i+1]=n.DataUtils.toHalfFloat(Math.min(e[t+1]*a,65504)),r[i+2]=n.DataUtils.toHalfFloat(Math.min(e[t+2]*a,65504)),r[i+3]=n.DataUtils.toHalfFloat(1)},a=new Uint8Array(e);a.pos=0;const s=function(e){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;if(e.pos>=e.byteLength||!(l=r(e)))return t(1,"no header found");if(!(c=l.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(s.valid|=1,s.programtype=c[1],s.string+=l+"\n";l=r(e),!1!==l;)if(s.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(n))&&(s.gamma=parseFloat(c[1],10)),(c=l.match(i))&&(s.exposure=parseFloat(c[1],10)),(c=l.match(o))&&(s.valid|=2,s.format=c[1]),(c=l.match(a))&&(s.valid|=4,s.height=parseInt(c[1],10),s.width=parseInt(c[2],10)),2&s.valid&&4&s.valid)break}else s.comments+=l+"\n";return 2&s.valid?4&s.valid?s:t(3,"missing image size specifier"):t(3,"missing format specifier")}(a);if(-1!==s){const e=s.width,r=s.height,l=function(e,r,n){const i=r;if(i<8||i>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(i!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");const o=new Uint8Array(4*r*n);if(!o.length)return t(4,"unable to allocate buffer space");let a=0,s=0;const l=4*i,c=new Uint8Array(4),u=new Uint8Array(l);let h=n;for(;h>0&&s<e.byteLength;){if(s+4>e.byteLength)return t(1);if(c[0]=e[s++],c[1]=e[s++],c[2]=e[s++],c[3]=e[s++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=i)return t(3,"bad rgbe scanline format");let r,n=0;for(;n<l&&s<e.byteLength;){r=e[s++];const i=r>128;if(i&&(r-=128),0===r||n+r>l)return t(3,"bad scanline data");if(i){const t=e[s++];for(let e=0;e<r;e++)u[n++]=t}else u.set(e.subarray(s,s+r),n),n+=r,s+=r}const d=i;for(let e=0;e<d;e++){let t=0;o[a]=u[e+t],t+=i,o[a+1]=u[e+t],t+=i,o[a+2]=u[e+t],t+=i,o[a+3]=u[e+t],a+=4}h--}return o}(a.subarray(a.pos),e,r);if(-1!==l){let t,a,c,u;switch(this.type){case n.FloatType:u=l.length/4;const e=new Float32Array(4*u);for(let t=0;t<u;t++)i(l,4*t,e,4*t);t=e,c=n.FloatType;break;case n.HalfFloatType:u=l.length/4;const r=new Uint16Array(4*u);for(let t=0;t<u;t++)o(l,4*t,r,3*t);t=r,c=n.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:r,data:t,header:s.string,gamma:s.gamma,exposure:s.exposure,format:a,type:c}}}return null}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,(function(e,r){switch(e.type){case n.FloatType:case n.HalfFloatType:e.encoding=n.LinearEncoding,e.minFilter=n.LinearFilter,e.magFilter=n.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)}),r,i)}}},876:function(e,t,r){"use strict";r.d(t,{L:function(){return i}});var n=r(4649);class i{constructor(e=Math){(0,n.Z)(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),(0,n.Z)(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),(0,n.Z)(this,"p",[]),(0,n.Z)(this,"perm",[]),(0,n.Z)(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),(0,n.Z)(this,"dot",((e,t,r)=>e[0]*t+e[1]*r)),(0,n.Z)(this,"dot3",((e,t,r,n)=>e[0]*t+e[1]*r+e[2]*n)),(0,n.Z)(this,"dot4",((e,t,r,n,i)=>e[0]*t+e[1]*r+e[2]*n+e[3]*i)),(0,n.Z)(this,"noise",((e,t)=>{let r,n,i;const o=(e+t)*(.5*(Math.sqrt(3)-1)),a=Math.floor(e+o),s=Math.floor(t+o),l=(3-Math.sqrt(3))/6,c=(a+s)*l,u=e-(a-c),h=t-(s-c);let d=0,f=1;u>h&&(d=1,f=0);const p=u-d+l,m=h-f+l,g=u-1+2*l,A=h-1+2*l,v=255&a,y=255&s,x=this.perm[v+this.perm[y]]%12,b=this.perm[v+d+this.perm[y+f]]%12,w=this.perm[v+1+this.perm[y+1]]%12;let C=.5-u*u-h*h;C<0?r=0:(C*=C,r=C*C*this.dot(this.grad3[x],u,h));let E=.5-p*p-m*m;E<0?n=0:(E*=E,n=E*E*this.dot(this.grad3[b],p,m));let S=.5-g*g-A*A;return S<0?i=0:(S*=S,i=S*S*this.dot(this.grad3[w],g,A)),70*(r+n+i)})),(0,n.Z)(this,"noise3d",((e,t,r)=>{let n,i,o,a;const s=(e+t+r)*(1/3),l=Math.floor(e+s),c=Math.floor(t+s),u=Math.floor(r+s),h=1/6,d=(l+c+u)*h,f=e-(l-d),p=t-(c-d),m=r-(u-d);let g,A,v,y,x,b;f>=p?p>=m?(g=1,A=0,v=0,y=1,x=1,b=0):f>=m?(g=1,A=0,v=0,y=1,x=0,b=1):(g=0,A=0,v=1,y=1,x=0,b=1):p<m?(g=0,A=0,v=1,y=0,x=1,b=1):f<m?(g=0,A=1,v=0,y=0,x=1,b=1):(g=0,A=1,v=0,y=1,x=1,b=0);const w=f-g+h,C=p-A+h,E=m-v+h,S=f-y+2*h,T=p-x+2*h,M=m-b+2*h,I=f-1+.5,B=p-1+.5,_=m-1+.5,F=255&l,P=255&c,R=255&u,L=this.perm[F+this.perm[P+this.perm[R]]]%12,D=this.perm[F+g+this.perm[P+A+this.perm[R+v]]]%12,N=this.perm[F+y+this.perm[P+x+this.perm[R+b]]]%12,k=this.perm[F+1+this.perm[P+1+this.perm[R+1]]]%12;let O=.6-f*f-p*p-m*m;O<0?n=0:(O*=O,n=O*O*this.dot3(this.grad3[L],f,p,m));let U=.6-w*w-C*C-E*E;U<0?i=0:(U*=U,i=U*U*this.dot3(this.grad3[D],w,C,E));let Q=.6-S*S-T*T-M*M;Q<0?o=0:(Q*=Q,o=Q*Q*this.dot3(this.grad3[N],S,T,M));let V=.6-I*I-B*B-_*_;return V<0?a=0:(V*=V,a=V*V*this.dot3(this.grad3[k],I,B,_)),32*(n+i+o+a)})),(0,n.Z)(this,"noise4d",((e,t,r,n)=>{const i=this.grad4,o=this.simplex,a=this.perm,s=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let c,u,h,d,f;const p=(e+t+r+n)*s,m=Math.floor(e+p),g=Math.floor(t+p),A=Math.floor(r+p),v=Math.floor(n+p),y=(m+g+A+v)*l,x=e-(m-y),b=t-(g-y),w=r-(A-y),C=n-(v-y),E=(x>b?32:0)+(x>w?16:0)+(b>w?8:0)+(x>C?4:0)+(b>C?2:0)+(w>C?1:0);let S,T,M,I,B,_,F,P,R,L,D,N;S=o[E][0]>=3?1:0,T=o[E][1]>=3?1:0,M=o[E][2]>=3?1:0,I=o[E][3]>=3?1:0,B=o[E][0]>=2?1:0,_=o[E][1]>=2?1:0,F=o[E][2]>=2?1:0,P=o[E][3]>=2?1:0,R=o[E][0]>=1?1:0,L=o[E][1]>=1?1:0,D=o[E][2]>=1?1:0,N=o[E][3]>=1?1:0;const k=x-S+l,O=b-T+l,U=w-M+l,Q=C-I+l,V=x-B+2*l,G=b-_+2*l,z=w-F+2*l,j=C-P+2*l,H=x-R+3*l,W=b-L+3*l,Z=w-D+3*l,X=C-N+3*l,Y=x-1+4*l,J=b-1+4*l,q=w-1+4*l,K=C-1+4*l,$=255&m,ee=255&g,te=255&A,re=255&v,ne=a[$+a[ee+a[te+a[re]]]]%32,ie=a[$+S+a[ee+T+a[te+M+a[re+I]]]]%32,oe=a[$+B+a[ee+_+a[te+F+a[re+P]]]]%32,ae=a[$+R+a[ee+L+a[te+D+a[re+N]]]]%32,se=a[$+1+a[ee+1+a[te+1+a[re+1]]]]%32;let le=.6-x*x-b*b-w*w-C*C;le<0?c=0:(le*=le,c=le*le*this.dot4(i[ne],x,b,w,C));let ce=.6-k*k-O*O-U*U-Q*Q;ce<0?u=0:(ce*=ce,u=ce*ce*this.dot4(i[ie],k,O,U,Q));let ue=.6-V*V-G*G-z*z-j*j;ue<0?h=0:(ue*=ue,h=ue*ue*this.dot4(i[oe],V,G,z,j));let he=.6-H*H-W*W-Z*Z-X*X;he<0?d=0:(he*=he,d=he*he*this.dot4(i[ae],H,W,Z,X));let de=.6-Y*Y-J*J-q*q-K*K;return de<0?f=0:(de*=de,f=de*de*this.dot4(i[se],Y,J,q,K)),27*(c+u+h+d+f)}));for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(let t=0;t<512;t++)this.perm[t]=this.p[255&t]}}},6149:function(e,t,r){"use strict";r.d(t,{Zw:function(){return h},iJ:function(){return f},az:function(){return c},z_:function(){return a},i_:function(){return u},TU:function(){return s}});var n=r(4649),i=r(6173);const o=1024,a=(e=1)=>{const t=new Float32Array(4096*e*3),r=new i.DataTexture(t,o,4*e,i.RGBAFormat,i.FloatType);return r.wrapS=i.RepeatWrapping,r.wrapT=i.RepeatWrapping,r.magFilter=i.NearestFilter,r.needsUpdate=!0,r},s=(e,t,r=0)=>{const n=Math.floor(1024);t.arcLengthDivisions=n/2,t.updateArcLengths();const i=t.getSpacedPoints(n),a=t.computeFrenetFrames(n,!0);for(let s=0;s<n;s++){const t=Math.floor(s/o),n=s%o;let c=i[s];l(e,n,c.x,c.y,c.z,0+t+4*r),c=a.tangents[s],l(e,n,c.x,c.y,c.z,1+t+4*r),c=a.normals[s],l(e,n,c.x,c.y,c.z,2+t+4*r),c=a.binormals[s],l(e,n,c.x,c.y,c.z,3+t+4*r)}e.needsUpdate=!0},l=(e,t,r,n,i,o)=>{const a=e.image,{data:s}=a,l=3072*o;s[3*t+l+0]=r,s[3*t+l+1]=n,s[3*t+l+2]=i,s[3*t+l+3]=1};function c(e){return{spineTexture:{value:e},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}}}function u(e,t,r=1){e.__ok||(e.__ok=!0,e.onBeforeCompile=e=>{if(e.__modified)return;e.__modified=!0,Object.assign(e.uniforms,t);const n=`\n\t\tuniform sampler2D spineTexture;\n\t\tuniform float pathOffset;\n\t\tuniform float pathSegment;\n\t\tuniform float spineOffset;\n\t\tuniform float spineLength;\n\t\tuniform int flow;\n\n\t\tfloat textureLayers = ${4*r}.;\n\t\tfloat textureStacks = 1.;\n\n\t\t${e.vertexShader}\n\t\t`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,"\n        void main() {\n        #include <beginnormal_vertex>\n\n        vec4 worldPos = modelMatrix * vec4(position, 1.);\n\n        bool bend = flow > 0;\n        float xWeight = bend ? 0. : 1.;\n\n        #ifdef USE_INSTANCING\n        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];\n        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];\n        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;\n        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;\n        #else\n        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;\n        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;\n        #endif\n\n        mt = mod(mt, textureStacks);\n        float rowOffset = floor(mt);\n\n        #ifdef USE_INSTANCING\n        rowOffset += instanceMatrix[3][1] * 4.;\n        #endif\n\n        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;\n        mat3 basis = mat3(a, b, c);\n\n        vec3 transformed = basis\n          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)\n          + spinePos;\n\n        vec3 transformedNormal = normalMatrix * (basis * objectNormal);\n\t\t\t").replace("#include <project_vertex>","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\t\t\t\tgl_Position = projectionMatrix * mvPosition;");e.vertexShader=n})}class h{constructor(e,t=1){(0,n.Z)(this,"curveArray",void 0),(0,n.Z)(this,"curveLengthArray",void 0),(0,n.Z)(this,"object3D",void 0),(0,n.Z)(this,"splineTexure",void 0),(0,n.Z)(this,"uniforms",void 0);const r=e.clone(),o=a(t),s=c(o);r.traverse((e=>{(e instanceof i.Mesh||e instanceof i.InstancedMesh)&&(e.material=e.material.clone(),u(e.material,s,t))})),this.curveArray=new Array(t),this.curveLengthArray=new Array(t),this.object3D=r,this.splineTexure=o,this.uniforms=s}updateCurve(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");const r=t.getLength();this.uniforms.spineLength.value=r,this.curveLengthArray[e]=r,this.curveArray[e]=t,s(this.splineTexure,t,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}const d=new i.Matrix4;class f extends h{constructor(e,t,r,o){const a=new i.InstancedMesh(r,o,e);a.instanceMatrix.setUsage(i.DynamicDrawUsage),super(a,t),(0,n.Z)(this,"offsets",void 0),(0,n.Z)(this,"whichCurve",void 0),this.offsets=new Array(e).fill(0),this.whichCurve=new Array(e).fill(0)}writeChanges(e){d.makeTranslation(this.curveLengthArray[this.whichCurve[e]],this.whichCurve[e],this.offsets[e]),this.object3D.setMatrixAt(e,d),this.object3D.instanceMatrix.needsUpdate=!0}moveIndividualAlongCurve(e,t){this.offsets[e]+=t,this.writeChanges(e)}setCurve(e,t){if(isNaN(t))throw Error("curve index being set is Not a Number (NaN)");this.whichCurve[e]=t,this.writeChanges(e)}}},4921:function(e,t,r){"use strict";r.d(t,{q:function(){return o}});var n=r(4649),i=r(6173);class o extends i.Mesh{constructor(){super(new i.BoxGeometry(1,1,1),o.material)}}(0,n.Z)(o,"SkyShader",{uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new i.Vector3},up:{value:new i.Vector3(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","void main() {","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( direction, vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","#include <tonemapping_fragment>","#include <encodings_fragment>","}"].join("\n")}),(0,n.Z)(o,"material",new i.ShaderMaterial({name:"SkyShader",fragmentShader:o.SkyShader.fragmentShader,vertexShader:o.SkyShader.vertexShader,uniforms:i.UniformsUtils.clone(o.SkyShader.uniforms),side:i.BackSide,depthWrite:!1}))},1291:function(e,t,r){"use strict";r.d(t,{x:function(){return l}});var n=r(4649),i=r(6173),o=r(7166),a=r(960),s=r(5354);class l{constructor(e,t){if((0,n.Z)(this,"renderer",void 0),(0,n.Z)(this,"_pixelRatio",void 0),(0,n.Z)(this,"_width",void 0),(0,n.Z)(this,"_height",void 0),(0,n.Z)(this,"renderTarget1",void 0),(0,n.Z)(this,"renderTarget2",void 0),(0,n.Z)(this,"writeBuffer",void 0),(0,n.Z)(this,"readBuffer",void 0),(0,n.Z)(this,"renderToScreen",void 0),(0,n.Z)(this,"passes",[]),(0,n.Z)(this,"copyPass",void 0),(0,n.Z)(this,"clock",void 0),this.renderer=e,void 0===t){const r={minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBAFormat},n=e.getSize(new i.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(t=new i.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,void 0===o.C&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===a.T&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new a.T(o.C),this.clock=new i.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;const n=this.passes.length;for(let i=0;i<n;i++){const t=this.passes[i];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),t.needsSwap){if(r){const t=this.renderer.getContext(),r=this.renderer.state.buffers.stencil;r.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),r.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==s.F&&(t instanceof s.F?r=!0:t instanceof s.M&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new i.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(r,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}},5354:function(e,t,r){"use strict";r.d(t,{M:function(){return a},F:function(){return o}});var n=r(4649),i=r(1901);class o extends i.w{constructor(e,t){super(),(0,n.Z)(this,"scene",void 0),(0,n.Z)(this,"camera",void 0),(0,n.Z)(this,"inverse",void 0),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const n=e.getContext(),i=e.state;let o,a;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(o=0,a=1):(o=1,a=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),i.buffers.stencil.setFunc(n.ALWAYS,o,4294967295),i.buffers.stencil.setClear(a),i.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(n.EQUAL,1,4294967295),i.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),i.buffers.stencil.setLocked(!0)}}class a extends i.w{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}},1901:function(e,t,r){"use strict";r.d(t,{T:function(){return a},w:function(){return o}});var n=r(4649),i=r(6173);class o{constructor(){(0,n.Z)(this,"enabled",!0),(0,n.Z)(this,"needsSwap",!0),(0,n.Z)(this,"clear",!1),(0,n.Z)(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,r,n,i){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}class a{constructor(e){(0,n.Z)(this,"camera",new i.OrthographicCamera(-1,1,1,-1,0,1)),(0,n.Z)(this,"geometry",new i.PlaneGeometry(2,2)),(0,n.Z)(this,"mesh",void 0),this.mesh=new i.Mesh(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}},5869:function(e,t,r){"use strict";r.d(t,{C:function(){return a}});var n=r(4649),i=r(6173),o=r(1901);class a extends o.w{constructor(e,t,r,o,a=0){super(),(0,n.Z)(this,"scene",void 0),(0,n.Z)(this,"camera",void 0),(0,n.Z)(this,"overrideMaterial",void 0),(0,n.Z)(this,"clearColor",void 0),(0,n.Z)(this,"clearAlpha",void 0),(0,n.Z)(this,"clearDepth",!1),(0,n.Z)(this,"_oldClearColor",new i.Color),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=o,this.clearAlpha=a,this.clear=!0,this.needsSwap=!1}render(e,t,r){let n,i=e.autoClear;e.autoClear=!1;let o=null;void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),n=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,n),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=i}}},960:function(e,t,r){"use strict";r.d(t,{T:function(){return a}});var n=r(4649),i=r(6173),o=r(1901);class a extends o.w{constructor(e,t="tDiffuse"){super(),(0,n.Z)(this,"textureID",void 0),(0,n.Z)(this,"uniforms",void 0),(0,n.Z)(this,"material",void 0),(0,n.Z)(this,"fsQuad",void 0),this.textureID=t,e instanceof i.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=i.UniformsUtils.clone(e.uniforms),this.material=new i.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new o.T(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}},7166:function(e,t,r){"use strict";r.d(t,{C:function(){return n}});const n={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")}},6015:function(e,t,r){"use strict";r.d(t,{Y:function(){return n}});const n={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vUv );","\tgl_FragColor = LinearTosRGB( tex );","}"].join("\n")}},9215:function(e,t,r){"use strict";r.d(t,{P:function(){return n}});const n={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n      varying vec2 vUv;\n\n      void main() {\n\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n      }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform float h;\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvec4 sum = vec4( 0.0 );\n\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n    \tgl_FragColor = sum;\n\n    }\n  "}},5396:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});const n={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n  ",fragmentShader:"\n  \n  uniform sampler2D tDiffuse;\n  uniform float v;\n\n  varying vec2 vUv;\n\n  void main() {\n\n    vec4 sum = vec4( 0.0 );\n\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n    gl_FragColor = sum;\n\n  }\n  "}},1860:function(e,t,r){"use strict";r.d(t,{G:function(){return l}});var n=r(6471),i=r.n(n);const o=[];function a(e,t,r,n=0,o=!1){for(const s of t)if(i()(r,s.args)){if(o)return;if(s.error)throw s.error;if(s.response)return s.response;throw s.promise}const a={args:r,promise:e(...r).then((e=>a.response=null==e||e)).catch((e=>a.error=null!=e?e:"unknown error")).then((()=>{n>0&&setTimeout((()=>{const e=t.indexOf(a);-1!==e&&t.splice(e,1)}),n)}))};if(t.push(a),!o)throw a.promise}function s(e,...t){if(void 0===t||0===t.length)e.splice(0,e.length);else{const r=e.find((e=>i()(t,e.args)));if(r){const t=e.indexOf(r);-1!==t&&e.splice(t,1)}}}function l(e,...t){return a(e,o,t,l.lifespan)}l.lifespan=0,l.clear=(...e)=>s(o,...e),l.preload=(e,...t)=>{a(e,o,t,l.lifespan,!0)},l.peek=(...e)=>{var t;return null==(t=o.find((t=>i()(e,t.args))))?void 0:t.response}},4649:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,{Z:function(){return n}})},5773:function(e,t,r){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r.d(t,{Z:function(){return n}})}}]);